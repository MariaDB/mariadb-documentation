<!DOCTYPE html>
<html>
<head data-cookie-domain=""
      data-cookie-path="/">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="apple-touch-icon" sizes="180x180" href="/kb/static/images/favicons/apple-touch-icon.159e713979be.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/kb/static/images/favicons/favicon-32x32.bc0ac1d5d11e.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/kb/static/images/favicons/favicon-16x16.5801f8f0f34e.png">
    <link rel="shortcut icon" href="/kb/static/images/favicons/favicon.d122d305dee4.ico" type="image/x-icon" />

    <title>设置复制 - Source - MariaDB Knowledge Base</title>

    <link href="/kb/static/css/main.f7633538c846.css" rel="stylesheet" type="text/css" />

    
        <meta name="robots" content="noindex, nofollow">
    

    

    <!-- FB Open Graph tags -->
    <meta property="og:title" content="设置复制 - Source" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://mariadb.com/kb/zh-cn/setting-up-replication/+source/" />
    <meta property="og:image" content="http://mariadb.comaskmonty-logo.png" />
    <meta property="og:site_name" content="MariaDB KnowledgeBase" />
    <meta property="fb:admins" content="514852603" />
    <meta property="og:description" content="" />

    <meta name="description" content="" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet"/>
    
</head>
<body class="mpkb nodes autoresize nodes_source jqui" id="nodes_source">





<div id="menu-mobile" class="visible-sm visible-xs">

    <div>
        <div id="mobile-close-menu" class="text-right">
            <a href="javascript:void(0)" title="Close Menu" id="back-main" class="toggle-menu">X<span></span></a>
        </div>
    </div>
    <div class="mainmenu-mobile">
        <ul class="ls-none ul-menu">
            <li data-sub="submenu5"><a class="open-form-search" href="/kb/search/" title="Search">Search </a></li>
            <li data-sub="submenu0"><a href="/products" title="Products">Products</a><span class="arrow-main"></span></li>
            <li data-sub="submenu1"><a href="/services" title="Services">Services</a><span class="arrow-main"></span></li>
            <li data-sub="submenu2"><a href="/resources" title="Resources">Resources</a><span class="arrow-main"></span></li>
            <li data-sub="submenu3"><a href="/about-us" title="About">About</a><span class="arrow-main"></span></li>
            <li data-sub="submenu4"><a href="/contact" title="Contact">Contact</a></li>
        </ul>
    </div>

    <div class="nav-top-mobile">
        <div class="select-box form">

            <ul class="inline-block-md mb-none top-nav">
                <li>

                </li>
                
                    <li>
                        <a href="/kb/user/login?next=/kb/zh-cn/setting-up-replication/+source/"> Login</a>
                    </li>
                
            </ul>



        </div>
        <p class="text-center copyright">Copyright &copy; 2024 MariaDB. All rights reserved.</p>
    </div>
</div>
<div class="violator-wrap d-none" id="top_violator">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12">
                <div class="violator-outer">
                    <div class="violator-inner">
                        <div class="row">
                            <div class="col-xs-12 col-sm-9 col-lg-7 col-lg-offset-2" id="top_violator_content">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="content-link" target="_blank" rel="nofollow noreferrer">
                                    <span>The Ultimate Guide to High Availability with MariaDB</span>
                                </a>
                            </div>
                            <div class="col-xs-12 col-sm-3" id="top_violator_cta">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="btn btn-mariadb" target="_blank" rel="nofollow noreferrer">Download Now</a>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-link close-btn">
                        <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24" width="15px" height="15px"><path d="M 4.9902344 3.9902344 A 1.0001 1.0001 0 0 0 4.2929688 5.7070312 L 10.585938 12 L 4.2929688 18.292969 A 1.0001 1.0001 0 1 0 5.7070312 19.707031 L 12 13.414062 L 18.292969 19.707031 A 1.0001 1.0001 0 1 0 19.707031 18.292969 L 13.414062 12 L 19.707031 5.7070312 A 1.0001 1.0001 0 0 0 18.980469 3.9902344 A 1.0001 1.0001 0 0 0 18.292969 4.2929688 L 12 10.585938 L 5.7070312 4.2929688 A 1.0001 1.0001 0 0 0 4.9902344 3.9902344 z"/></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="wrapper">
<div id="top-nav">
    <div class="container">
        <ul class="hidden-sm hidden-xs" >
            <li><a href="https://mariadb.com/kb/">Knowledge Base</a></li>
            <li><a href="https://mariadb.com/contact/">Contact</a></li>
            
                
                    <li>
                        <a href="/kb/user/login?next=/kb/zh-cn/setting-up-replication/+source/" rel="nofollow">Login</a>
                    </li>
                
            
            
            <li id="search-form">
                <form action="/kb/zh-cn/+search/" method="get" id="search-block-form" accept-charset="UTF-8">
                    <input id="search" title="Enter the terms you wish to search for."
                           placeholder="Search . . ." type="text"
                           name="q" value="" size="15" maxlength="128" class="form-text"
                           data-autocomplete-url="/kb/zh-cn/+search/autocomplete/">
                    <input type="hidden" name="quick" value="1" />
                    <input type="hidden" name="source" value="kb" />
                </form>
            </li>
            <li><a id="search-toggler" href="/kb/search/">Search</a></li>
            
        </ul>
    </div>
</div>
<div id="navbar-bottom" class="navbar">
    <div class="container">
        
        
        
        
        <div class="row">
            <div class="col-md-3 col-sm-9 col-xs-9">
                <a class="brand" href="/" title="MariaDB">
                    <img src="/kb/static/images/logo-2018-black.95f5978ae14d.png">
                </a>
            </div>
            <div class="col-md-9 hidden-sm hidden-xs">
                <div class="main-menu">
                    <ul id="main-menu" class="nav navbar-nav inline-block-sm">
    <li class="has-sub full-menu">
        <a href="/products" title="Products">Products</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/services" title="Services">Services</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/pricing" title="Pricing">Pricing</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/resources" title="Resources">Resources</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/about-us" title="About Us">About Us</a>
    </li>
    <li class="">
        <a class="button electric-eel small top-bar-right-download" href="/downloads/">Download</a>
    </li>
</ul>
                </div>
            </div>
            <div class="col-md-3 visible-sm visible-xs col-sm-3 col-xs-3 ps-rv">
                <div class="navbar-header text-right pull-right">
                    <button type="button" class="menu-control toggle-menu" id="open-menu">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="main">
    <div class="container">
        

        <div id="subheader1" class="clearfix">
            <div class="pull-left">
                
                <div id="breadcrumbs" class="breadcrumb">
                    <a href="/kb/zh-cn/">Knowledge Base</a>
                    


    
    » <a class="crumb" href="/kb/zh-cn/mariadb/">MariaDB - 简体中文</a>
    

    
    » <a class="crumb" href="/kb/zh-cn/mariadb-server/">MariaDB Server文档</a>
    

    
    » <a class="crumb" href="/kb/zh-cn/standard-replication/">MariaDB复制</a>
    


    » <a class="node_link crumb" href="/kb/zh-cn/setting-up-replication/">设置复制</a>


                </div>
                
            </div>
        </div>
    </div>
    <div class="container" id="container-main">
        <div class="row">
            
            
                
                <aside id="sidebar-first" class="sidebar col-md-2 hidden-xs hidden-sm hidden-print">
                    
                        
                        <ul id="category_menu" class="nav nav-pills nav-stacked">
                            <li><a href="/kb/zh-cn/">首页</a></li>
                            
                                
                                    <li><a href="/kb/zh-cn/+questions/">Open Questions</a></li>
                                
                                <li><a href="/kb/zh-cn/documentation/">MariaDB Server</a></li>
                                <li><a href="/kb/zh-cn/maxscale/">MariaDB MaxScale</a></li>
                                <li><a href="/kb/zh-cn/mariadb-columnstore/">MariaDB ColumnStore</a></li>
                                <li><a href="/kb/zh-cn/connectors/">Connectors</a></li>
                            

                        </ul>
                    

                    
                        <div>
    

<div class="well well-small box actions"><div>

        <a class="btn btn-block btn-small" href="/kb/zh-cn/setting-up-replication/">Return to article</a>
    
</div>
</div>

</div>
                    

                    

































                </aside>
            
            
            
                
            
            
            <section id="content" class="limited_width col-md-10 clearfix">
                
                    <h1>设置复制 - Source</h1>
                

                



                <div>
                    

    

    
    <div class="revision_info">
        <dl class="table">
            <dt>Revision</dt>
            <dd><a href="/kb/zh-cn/setting-up-replication/+r/127249/">127249</a></dd>
            <dt>用户</dt>
            <dd>
<span class="user" id="user-13772">
<a href="/kb/user/id/13772" title="Yingquan He">Yingquan He</a>
</span></dd>
            <dt>Date</dt>
            <dd>

<span class="datetime" title="2023-06-13 06:07">2023-06-13 06:07</span></dd>
        </dl>
    </div>
    


    

    
        
        <textarea id="answer_source" class="creole_source autogrow">&lt;&lt;include slug=&#34;replica_slave&#34;&gt;&gt;
&lt;&lt;toc&gt;&gt;
使 [[replication]] 工作需要在主服务器和从服务器上都进行一些步骤。

&lt;&lt;style class=&#34;bluebox&#34;&gt;&gt;
MariaDB 10.0 引入了带有 [[global-transaction-id|全局事务 ID]] 的复制功能。这些功能有许多好处，通常建议从 MariaDB 10.0 开始使用此功能。
&lt;&lt;/style&gt;&gt;

== 使用 Mariabackup 设置复制从服务器

如果您想使用 [[mariabackup|Mariabackup]] 设置复制从服务器，则可能会发现 [[setting-up-a-replication-slave-with-mariabackup|使用 Mariabackup 设置复制从服务器]] 中的信息很有用。

== 版本

通常，当在不同版本的 MariaDB 之间进行复制时，最好将主服务器设置为较旧版本，而从服务器设置为较新版本。MariaDB 版本通常是向后兼容的，而较旧版本则不总是向前兼容。另请参阅 [[#replicating-from-mysql-master-to-mariadb-slave|从 MySQL 主服务器复制到 MariaDB 从服务器]]。

== 配置主服务器

*如果尚未启用二进制日志记录，请启用它。有关详细信息，请参见 [[activating-the-binary-log|激活二进制日志]] 和 [[binary-log-formats|二进制日志格式]]。
*为主服务器分配一个唯一的 [[replication-and-binary-log-system-variables/#server_id|server_id]]。所有从服务器也必须分配 server_id。这可以是从 1 到 2^^32^^-1 的数字，并且每个复制组中的每个服务器必须是唯一的。
* 使用 [[mysqld-options-full-list#-log-basename|--log-basename]] 指定您的复制日志的唯一名称。如果未指定此名称，则将使用主机名，并且如果主机名发生更改，则会出现问题。
* 从服务器需要连接并开始复制服务器的权限。通常，这是通过创建专用的从服务器用户并仅授予该用户复制权限（REPLICATION SLAVE 权限）来完成的。

=== 为 MariaDB 启用复制的示例

将以下内容添加到您的 [[configuring-mariadb-with-mycnf|my.cnf]] 文件中，并重新启动数据库。
&lt;&lt;code&gt;&gt;
[mariadb]
log-bin
server_id=1
log-basename=master1
binlog-format=mixed
&lt;&lt;/code&gt;&gt;

服务器 ID 是网络中每个 MariaDB/MySQL 服务器的唯一编号。[[binary-log-formats|binlog-format]] 指定如何记录语句。这主要影响在主服务器和从服务器之间发送的 [[binary-log|二进制日志]] 的大小。

然后使用 [[mysql-command-line-client|{{{mysql}}}]] 命令行客户端执行以下 SQL：
&lt;&lt;sql&gt;&gt;
CREATE USER &#39;replication_user&#39;@&#39;%&#39; IDENTIFIED BY &#39;bigs3cret&#39;;
GRANT REPLICATION SLAVE ON *.* TO &#39;replication_user&#39;@&#39;%&#39;;
&lt;&lt;/sql&gt;&gt;

=== 为 MySQL 启用复制的示例

如果您想要从 MySQL 启用复制到 MariaDB，则可以使用与 MariaDB 服务器之间几乎相同的方式进行操作。主要区别在于 MySQL 不支持 ##log-basename##。

&lt;&lt;code&gt;&gt;
[mysqld]
log-bin
server_id=1
&lt;&lt;/code&gt;&gt;

== 需要检查的设置

有一些选项可能会影响或破坏复制。请检查以下设置以避免问题。
* [[server-system-variables#skip_networking|skip-networking]]。如果 ##skip-networking=1##，服务器将仅限制连接到 localhost，并阻止所有远程从服务器连接。
* [[server-system-variables/#bind_address|bind-address]]。类似地，如果服务器侦听 TCP/IP 连接的地址是 127.0.0.1（localhost），则远程从服务器连接将失败。

== 配置从服务器
* 为从服务器提供唯一的[[replication-and-binary-log-server-system-variables#server_id|server_id]]。所有服务器，无论是主服务器还是从服务器，都会被分配一个 server_id。这可以是从 1 到 2^^32^^-1 的数字，并且在复制组中每个服务器必须是唯一的。需要重新启动服务器才能使此选项的更改生效。

== 获取主服务器的二进制日志坐标
现在，您需要在查看二进制日志位置时防止对数据进行任何更改。您将使用此位置告诉从服务器应从哪个点开始复制。
* 在主服务器上，通过运行 &lt;&lt;code inline=&#39;true&#39;&gt;&gt;FLUSH TABLES WITH READ LOCK&lt;&lt;/code&gt;&gt; 刷新并锁定所有表。保持此会话运行 - 退出将释放锁定。
* 运行 ##[[show-master-status|SHOW MASTER STATUS]]## 获取二进制日志中的当前位置：
&lt;&lt;code&gt;&gt;
SHOW MASTER STATUS;
+--------------------+----------+--------------+------------------+
| File               | Position | Binlog_Do_DB | Binlog_Ignore_DB |
+--------------------+----------+--------------+------------------+
| master1-bin.000096 |      568 |              |                  |
+--------------------+----------+--------------+------------------+
&lt;&lt;/code&gt;&gt;
* 记录 //File// 和 //Position// 详细信息。如果刚启用二进制日志，则这些内容将为空。
* 现在，在锁定的情况下，将数据从主服务器复制到从服务器。有关如何执行此操作的详细信息，请参见[[backup-restore-and-import|备份、恢复和导入]]。
* 对于实时数据库的注意事项：您只需要制作数据的本地副本，无需保持主服务器锁定，直到从服务器导入数据。
* 复制数据后，您可以通过运行[[transactions-lock|UNLOCK TABLES]]来释放主服务器上的锁定。
&lt;&lt;code&gt;&gt;
UNLOCK TABLES;
&lt;&lt;/code&gt;&gt;

== 启动从服务器
* 导入数据后，您可以开始进行复制。首先运行[[change-master-to|CHANGE MASTER TO]]，确保 //MASTER_LOG_FILE// 匹配早期 SHOW MASTER STATUS 返回的文件，//MASTER_LOG_POS// 匹配位置。例如：
&lt;&lt;sql&gt;&gt;
CHANGE MASTER TO
  MASTER_HOST=&#39;master.domain.com&#39;,
  MASTER_USER=&#39;replication_user&#39;,
  MASTER_PASSWORD=&#39;bigs3cret&#39;,
  MASTER_PORT=3306,
  MASTER_LOG_FILE=&#39;master1-bin.000096&#39;,
  MASTER_LOG_POS=568,
  MASTER_CONNECT_RETRY=10;
&lt;&lt;/sql&gt;&gt;

如果您要针对从一开始就配置为复制的新主服务器启动从服务器，则无需指定 ##MASTER_LOG_FILE## 和 ##MASTER_LOG_POS##。

=== 使用全局事务 ID (GTID)
&lt;&lt;product mariadb from=10.0&gt;&gt;
MariaDB 10.0 引入了用于复制的全局事务 ID（GTID）。通常建议使用 MariaDB 10.0 的 GTID，因为这有许多好处。只需要将 ##MASTER_USE_GTID## 选项添加到 ##CHANGE MASTER## 语句中，例如：
&lt;&lt;sql&gt;&gt;
CHANGE MASTER TO MASTER_USE_GTID = slave_pos
&lt;&lt;/sql&gt;&gt;
有关完整说明，请参见[[global-transaction-id|全局事务 ID]]。
&lt;&lt;/product&gt;&gt;

*现在使用 [[start-slave|{{{START SLAVE}}}]] 命令启动从服务器：
&lt;&lt;sql&gt;&gt;
START SLAVE;
&lt;&lt;/sql&gt;&gt;

*通过执行 [[show-slave-status|{{{SHOW SLAVE STATUS}}}]] 命令检查复制是否正常工作：
&lt;&lt;sql&gt;&gt;
SHOW SLAVE STATUS \G
&lt;&lt;/sql&gt;&gt;

*如果复制正常工作，则 {{{Slave_IO_Running}}} 和 {{{Slave_SQL_Running}}} 的值都应为 {{{Yes}}}：
&lt;&lt;code&gt;&gt;
Slave_IO_Running: Yes
Slave_SQL_Running: Yes
&lt;&lt;/code&gt;&gt;

== 从 MySQL 主服务器复制到 MariaDB 从服务器

* 从 MySQL 5.5 复制到 MariaDB 5.5+ 应该可以正常工作。当使用 MariaDB 10.2+ 作为从服务器时，可能需要将 [[replication-and-binary-log-server-system-variables/#binlog_checksum|binlog_checksum]] 设置为 NONE。
* 从没有 GTID 的 MySQL 5.6 复制到 MariaDB 10+ 应该可以正常工作。
* 从带有 GTID、binlog_rows_query_log_events 和可忽略事件的 MySQL 5.6 复制起始于 MariaDB 10.0.22 和 MariaDB 10.1.8。在这种情况下，MariaDB 将删除 MySQL GTID 和其他不需要的事件，而是添加自己的 GTID。

== 参见
* [[binary-log-formats|基于语句、混合和行日志记录之间的差异]]
* [[replication-and-foreign-keys|复制和外键]]
* [[replication-as-a-backup-solution|复制作为备份解决方案]]
* [[multi-source-replication|多源复制]]
* [[global-transaction-id|全局事务 ID]]
* [[parallel-replication|并行复制]]
* [[replication-and-binary-log-server-system-variables|复制和二进制日志系统变量]]
* [[replication-and-binary-log-status-variables|复制和二进制日志状态变量]]
* [[semisynchronous-replication|半同步复制]]
* [[delayed-replication|延迟复制]]
* [[mariadb-vs-mysql-compatibility/#replication-compatibility|复制兼容性]]</textarea>
    


                    <div id="content_disclaimer" class="graybox">
                        Content reproduced on this site is the property of its respective owners,
                        and this content is not reviewed in advance by MariaDB. The views, information and opinions
                        expressed by this content do not necessarily represent those of MariaDB or any other party.
                    </div>
                </div>
            </section>

            
        </div>
    </div>
</div>

<!-- Footer -->
<footer id="footer">
    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-xs-12">
                    <ul class="list-inline text-center footer-nav">
                        <li>
                            <h5>
                                <a href="https://mariadb.com/products" title="Products">Products</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/services" title="Services">Services</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/pricing" title="Pricing">Pricing</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/resources" title="Resources">Resources</a>
                            </h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/about-us" title="About MariaDB">About Us</a></h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/download" title="Download">Download MariaDB</a></h5>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="row row-10">
                
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div id="block-footerformcontact" class="block block-block-content block-block-contentd754ee1b-3cc9-40e7-9ef4-f504f1197fb1">
                        
                            <h5 style="font-weight: 400;">Subscribe to our newsletter!</h5>
                            <script src="//app-sj15.marketo.com/js/forms2/js/forms2.min.js"></script><form id="mktoForm_1498"></form>
                            <script>
                                <!--//--><![CDATA[// ><!--
                                MktoForms2.loadForm("//app-sj15.marketo.com", "573-PXI-984", 1498);
                                //--><!]]]]><![CDATA[>
                                //--><!]]>
                            </script>
                        
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div class="footer-copyright">
                        <div class="text-center">
                            <ul class="list-inline no-margin">
                                <li>
                                    <a href="/legal" title="Legal">Legal</a>
                                </li>
                                <li>
                                    <a href="/privacy-policy" title="Privacy Policy">Privacy Policy</a>
                                </li>
                                <li>
                                    <a href="/cookie-policy/" title="Cookies">Cookie Policy</a>
                                </li>
                            </ul>
                            <p>Copyright &copy; 2024 MariaDB. All rights reserved.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</footer>
</div>

<div id="ajax_loading">
    <img src="/kb/static/images/ajax-loader.a51c5608d01a.gif" />
</div>

    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MK2847"
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MK2847');</script>
    <!-- End Google Tag Manager -->

</body>

<script type="text/javascript" src="/kb/static/js/main.1587e3a666fc.js" charset="utf-8"></script>

</html>