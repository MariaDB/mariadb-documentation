<!DOCTYPE html>
<html>
<head data-cookie-domain=""
      data-cookie-path="/">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="apple-touch-icon" sizes="180x180" href="/kb/static/images/favicons/apple-touch-icon.159e713979be.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/kb/static/images/favicons/favicon-32x32.bc0ac1d5d11e.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/kb/static/images/favicons/favicon-16x16.5801f8f0f34e.png">
    <link rel="shortcut icon" href="/kb/static/images/favicons/favicon.d122d305dee4.ico" type="image/x-icon" />

    <title>ALTER TABLE - Source - MariaDB Knowledge Base</title>

    <link href="/kb/static/css/main.f7633538c846.css" rel="stylesheet" type="text/css" />

    
        <meta name="robots" content="noindex, nofollow">
    

    

    <!-- FB Open Graph tags -->
    <meta property="og:title" content="ALTER TABLE - Source" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://mariadb.com/kb/zh-cn/alter-table/+source/" />
    <meta property="og:image" content="http://mariadb.comaskmonty-logo.png" />
    <meta property="og:site_name" content="MariaDB KnowledgeBase" />
    <meta property="fb:admins" content="514852603" />
    <meta property="og:description" content="" />

    <meta name="description" content="" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet"/>
    
</head>
<body class="mpkb nodes autoresize nodes_source jqui" id="nodes_source">





<div id="menu-mobile" class="visible-sm visible-xs">

    <div>
        <div id="mobile-close-menu" class="text-right">
            <a href="javascript:void(0)" title="Close Menu" id="back-main" class="toggle-menu">X<span></span></a>
        </div>
    </div>
    <div class="mainmenu-mobile">
        <ul class="ls-none ul-menu">
            <li data-sub="submenu5"><a class="open-form-search" href="/kb/search/" title="Search">Search </a></li>
            <li data-sub="submenu0"><a href="/products" title="Products">Products</a><span class="arrow-main"></span></li>
            <li data-sub="submenu1"><a href="/services" title="Services">Services</a><span class="arrow-main"></span></li>
            <li data-sub="submenu2"><a href="/resources" title="Resources">Resources</a><span class="arrow-main"></span></li>
            <li data-sub="submenu3"><a href="/about-us" title="About">About</a><span class="arrow-main"></span></li>
            <li data-sub="submenu4"><a href="/contact" title="Contact">Contact</a></li>
        </ul>
    </div>

    <div class="nav-top-mobile">
        <div class="select-box form">

            <ul class="inline-block-md mb-none top-nav">
                <li>

                </li>
                
                    <li>
                        <a href="/kb/user/login?next=/kb/zh-cn/alter-table/+source/"> Login</a>
                    </li>
                
            </ul>



        </div>
        <p class="text-center copyright">Copyright &copy; 2024 MariaDB. All rights reserved.</p>
    </div>
</div>
<div class="violator-wrap d-none" id="top_violator">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12">
                <div class="violator-outer">
                    <div class="violator-inner">
                        <div class="row">
                            <div class="col-xs-12 col-sm-9 col-lg-7 col-lg-offset-2" id="top_violator_content">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="content-link" target="_blank" rel="nofollow noreferrer">
                                    <span>The Ultimate Guide to High Availability with MariaDB</span>
                                </a>
                            </div>
                            <div class="col-xs-12 col-sm-3" id="top_violator_cta">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="btn btn-mariadb" target="_blank" rel="nofollow noreferrer">Download Now</a>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-link close-btn">
                        <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24" width="15px" height="15px"><path d="M 4.9902344 3.9902344 A 1.0001 1.0001 0 0 0 4.2929688 5.7070312 L 10.585938 12 L 4.2929688 18.292969 A 1.0001 1.0001 0 1 0 5.7070312 19.707031 L 12 13.414062 L 18.292969 19.707031 A 1.0001 1.0001 0 1 0 19.707031 18.292969 L 13.414062 12 L 19.707031 5.7070312 A 1.0001 1.0001 0 0 0 18.980469 3.9902344 A 1.0001 1.0001 0 0 0 18.292969 4.2929688 L 12 10.585938 L 5.7070312 4.2929688 A 1.0001 1.0001 0 0 0 4.9902344 3.9902344 z"/></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="wrapper">
<div id="top-nav">
    <div class="container">
        <ul class="hidden-sm hidden-xs" >
            <li><a href="https://mariadb.com/kb/">Knowledge Base</a></li>
            <li><a href="https://mariadb.com/contact/">Contact</a></li>
            
                
                    <li>
                        <a href="/kb/user/login?next=/kb/zh-cn/alter-table/+source/" rel="nofollow">Login</a>
                    </li>
                
            
            
            <li id="search-form">
                <form action="/kb/zh-cn/+search/" method="get" id="search-block-form" accept-charset="UTF-8">
                    <input id="search" title="Enter the terms you wish to search for."
                           placeholder="Search . . ." type="text"
                           name="q" value="" size="15" maxlength="128" class="form-text"
                           data-autocomplete-url="/kb/zh-cn/+search/autocomplete/">
                    <input type="hidden" name="quick" value="1" />
                    <input type="hidden" name="source" value="kb" />
                </form>
            </li>
            <li><a id="search-toggler" href="/kb/search/">Search</a></li>
            
        </ul>
    </div>
</div>
<div id="navbar-bottom" class="navbar">
    <div class="container">
        
        
        
        
        <div class="row">
            <div class="col-md-3 col-sm-9 col-xs-9">
                <a class="brand" href="/" title="MariaDB">
                    <img src="/kb/static/images/logo-2018-black.95f5978ae14d.png">
                </a>
            </div>
            <div class="col-md-9 hidden-sm hidden-xs">
                <div class="main-menu">
                    <ul id="main-menu" class="nav navbar-nav inline-block-sm">
    <li class="has-sub full-menu">
        <a href="/products" title="Products">Products</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/services" title="Services">Services</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/pricing" title="Pricing">Pricing</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/resources" title="Resources">Resources</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/about-us" title="About Us">About Us</a>
    </li>
    <li class="">
        <a class="button electric-eel small top-bar-right-download" href="/downloads/">Download</a>
    </li>
</ul>
                </div>
            </div>
            <div class="col-md-3 visible-sm visible-xs col-sm-3 col-xs-3 ps-rv">
                <div class="navbar-header text-right pull-right">
                    <button type="button" class="menu-control toggle-menu" id="open-menu">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="main">
    <div class="container">
        

        <div id="subheader1" class="clearfix">
            <div class="pull-left">
                
                <div id="breadcrumbs" class="breadcrumb">
                    <a href="/kb/zh-cn/">Knowledge Base</a>
                    


    
    » <a class="crumb" href="/kb/zh-cn/mariadb/">MariaDB - 简体中文</a>
    

    
    » <a class="crumb" href="/kb/zh-cn/mariadb-server/">MariaDB Server文档</a>
    

    
    » <a class="crumb" href="/kb/zh-cn/alter/">ALTER语句</a>
    


    » <a class="node_link crumb" href="/kb/zh-cn/alter-table/">ALTER TABLE</a>


                </div>
                
            </div>
        </div>
    </div>
    <div class="container" id="container-main">
        <div class="row">
            
            
                
                <aside id="sidebar-first" class="sidebar col-md-2 hidden-xs hidden-sm hidden-print">
                    
                        
                        <ul id="category_menu" class="nav nav-pills nav-stacked">
                            <li><a href="/kb/zh-cn/">首页</a></li>
                            
                                
                                    <li><a href="/kb/zh-cn/+questions/">Open Questions</a></li>
                                
                                <li><a href="/kb/zh-cn/documentation/">MariaDB Server</a></li>
                                <li><a href="/kb/zh-cn/maxscale/">MariaDB MaxScale</a></li>
                                <li><a href="/kb/zh-cn/mariadb-columnstore/">MariaDB ColumnStore</a></li>
                                <li><a href="/kb/zh-cn/connectors/">Connectors</a></li>
                            

                        </ul>
                    

                    
                        <div>
    

<div class="well well-small box actions"><div>

        <a class="btn btn-block btn-small" href="/kb/zh-cn/alter-table/">Return to article</a>
    
</div>
</div>

</div>
                    

                    

































                </aside>
            
            
            
                
            
            
            <section id="content" class="limited_width col-md-10 clearfix">
                
                    <h1>ALTER TABLE - Source</h1>
                

                



                <div>
                    

    

    
    <div class="revision_info">
        <dl class="table">
            <dt>Revision</dt>
            <dd><a href="/kb/zh-cn/alter-table/+r/60559/">60559</a></dd>
            <dt>用户</dt>
            <dd>
<span class="user" id="user-5480">
<a href="/kb/user/id/5480" title="longshuai Ma">longshuai Ma</a>
</span></dd>
            <dt>Date</dt>
            <dd>

<span class="datetime" title="2017-09-26 05:55">2017-09-26 05:55</span></dd>
        </dl>
    </div>
    


    

    
        
        <textarea id="answer_source" class="creole_source autogrow">== 语法
&lt;&lt;code&gt;&gt;
ALTER [ONLINE] [IGNORE] TABLE tbl_name
    [WAIT n | NOWAIT]
    alter_specification [, alter_specification] ...

alter_specification:
    table_option ...
  | ADD [COLUMN] col_name column_definition
        [FIRST | AFTER col_name ]
  | ADD [COLUMN] (col_name column_definition,...)
  | ADD {INDEX|KEY} [index_name]
        [index_type] (index_col_name,...) [index_option] ...
  | ADD [CONSTRAINT [symbol]] PRIMARY KEY
        [index_type] (index_col_name,...) [index_option] ...
  | ADD [CONSTRAINT [symbol]]
        UNIQUE [INDEX|KEY] [index_name]
        [index_type] (index_col_name,...) [index_option] ...
  | ADD FULLTEXT [INDEX|KEY] [index_name]
        (index_col_name,...) [index_option] ...
  | ADD SPATIAL [INDEX|KEY] [index_name]
        (index_col_name,...) [index_option] ...
  | ADD [CONSTRAINT [symbol]]
        FOREIGN KEY [index_name] (index_col_name,...)
        reference_definition
  | ALTER [COLUMN] col_name SET DEFAULT literal | (expression)
  | ALTER [COLUMN] col_name DROP DEFAULT
  | CHANGE [COLUMN] old_col_name new_col_name column_definition
        [FIRST|AFTER col_name]
  | MODIFY [COLUMN] col_name column_definition
        [FIRST | AFTER col_name]
  | DROP [COLUMN] [IF EXISTS] col_name [RESTRICT|CASCADE]
  | DROP PRIMARY KEY
  | DROP {INDEX|KEY} index_name
  | DROP FOREIGN KEY fk_symbol
  | DROP CONSTRAINT constraint_name
  | DISABLE KEYS
  | ENABLE KEYS
  | RENAME [TO] new_tbl_name
  | ORDER BY col_name [, col_name] ...
  | CONVERT TO CHARACTER SET charset_name [COLLATE collation_name]
  | [DEFAULT] CHARACTER SET [=] charset_name
  | [DEFAULT] COLLATE [=] collation_name
  | DISCARD TABLESPACE
  | IMPORT TABLESPACE
  | ALGORITHM [=] {DEFAULT|INPLACE|COPY}
  | LOCK [=] {DEFAULT|NONE|SHARED|EXCLUSIVE}
  | FORCE
  | partition_options
  | ADD PARTITION (partition_definition)
  | DROP PARTITION partition_names
  | COALESCE PARTITION number
  | REORGANIZE PARTITION [partition_names INTO (partition_definitions)]
  | ANALYZE PARTITION partition_names
  | CHECK PARTITION partition_names
  | OPTIMIZE PARTITION partition_names
  | REBUILD PARTITION partition_names
  | REPAIR PARTITION partition_names
  | EXCHANGE PARTITION partition_name WITH TABLE tbl_name
  | REMOVE PARTITIONING

column_definition:
    data_type [NOT NULL | NULL] [DEFAULT default_value | (expression)]
      [AUTO_INCREMENT] [UNIQUE [KEY] | [PRIMARY] KEY]
      [COMMENT &#39;string&#39;]
      [COLUMN_FORMAT {FIXED|DYNAMIC|DEFAULT}]
      [STORAGE {DISK|MEMORY|DEFAULT}]
  | data_type [GENERATED ALWAYS]  AS   ( &lt;expression&gt; )  {VIRTUAL | PERSISTENT}
      [UNIQUE] [UNIQUE KEY] [COMMENT &#39;string&#39;]

index_col_name:
    col_name [(length)] [ASC | DESC]

index_type:
    USING {BTREE | HASH | RTREE}

index_option:
    KEY_BLOCK_SIZE [=] value
  | index_type
  | WITH PARSER parser_name
  | COMMENT &#39;string&#39;
  | CLUSTERING={YES| NO}

table_options:
    table_option [[,] table_option] ...  (see CREATE TABLE options)
&lt;&lt;/code&gt;&gt;

&lt;&lt;product mariadb from=&#34;10.0.2&#34;&gt;&gt;
引入了##IF EXISTS## 和 ##IF NOT EXISTS## 子句，包括：

&lt;&lt;code&gt;&gt;
ADD COLUMN       [IF NOT EXISTS]
ADD INDEX        [IF NOT EXISTS]
ADD FOREIGN KEY  [IF NOT EXISTS]
ADD PARTITION    [IF NOT EXISTS]
CREATE INDEX     [IF NOT EXISTS]

DROP COLUMN      [IF EXISTS]
DROP INDEX       [IF EXISTS]
DROP FOREIGN KEY [IF EXISTS]
DROP PARTITION   [IF EXISTS]
CHANGE COLUMN    [IF EXISTS]
MODIFY COLUMN    [IF EXISTS]
DROP INDEX       [IF EXISTS]
&lt;&lt;/code&gt;&gt;

&lt;&lt;toc&gt;&gt;

当在子句中使用了 ##IF EXISTS## 和 ##IF NOT EXISTS##，当不满足存在和不存在的条件时不会报错。但会产生一个warning信息，并且ALTER将会移动到下一个子句(或结束)。

这是在 MDEV-318 中实现的。
&lt;&lt;/product&gt;&gt;

&lt;&lt;product mariadb from=10.0.4&gt;&gt;
在MariaDB 10.0.4中引入了 ##ALTER TABLE  ... EXCHANGE PARTITION##
&lt;&lt;/product&gt;&gt;

&lt;&lt;product mariadb from=&#34;10.2.1&#34;&gt;&gt;
在MariaDB 10.2.1中引入了 ##DEFAULT## 表达式和 ##DROP CONSTRAINT## 子句
&lt;&lt;/product&gt;&gt;

== 描述

##ALTER TABLE## 可以让你改变已存在表的结构。例如，可以添加或删除字段、创建和销毁索引、改变已存在字段的类型、重命名字段或重命名表自身。你还可以修改表的注释信息和表的存储引擎。

如果有其他连接正在使用表，将激活一个 [[metadata-locking|metadata lock]] ，这使得ALTER语句会一直等待 直到锁被释放。非事务(non-transactional)表也同样如此。

当向一个(或多个)包含重复值的字段创建 ##UNIQUE## 索引，将会报错并终止ALTER语句。可以指定 [[ignore|IGNORE]] 选项来忽略已存在的重复值，禁止报错并强制创建 ##UNIQUE## 索引。这在某列(或某几列)应该具有UNIQUE属性时但却包含了重复值时很有用；但是，它无法控制已经存在和已经被删除的行。另外还需注意，  ##ALTER TABLE ... EXCHANGE PARTITION## 语句接受 ##IGNORE## 选项，但会忽略它。

关于表选项的详细信息，见 ##[[create-table|CREATE TABLE]]## 。

该语句同样可用来重命名一个表。详细信息见 ##[[rename-table|RENAME TABLE]]## 。

当要创建索引时，在创建过程中存储引擎会使用一个可配置的缓冲区。增大缓冲区大小可以加速索引的创建。 [[aria|Aria]] 和 [[myisam|MyISAM]] 分别根据变量 ##[[aria-server-system-variables#aria_sort_buffer_size|aria_sort_buffer_size]]## 或 ##[[myisam-server-system-variables#myisam_sort_buffer_size|myisam_sort_buffer_size]]## 定义的值大小来分配缓冲区，它同样用于 ##[[repair-table|REPAIR TABLE]]##。 而[[innodb|InnoDB/XtraDB]] 会根据变量##[[xtradbinnodb-server-system-variables#innodb_sort_buffer_size|innodb_sort_buffer_size]]## 定义的值大小分配3个缓冲区。

=== Index Type

不同存储引擎所允许的索引类型的详细信息见 [[storage-engine-index-types|Storage Engine Index Types]] 。

##CLUSTERING={YES|NO}## 仅对 [[tokudb|Tokudb]] 有效。

##[[create-index|CREATE INDEX]]## 和 ##[[drop-index|DROP INDEX]]## 同样可用来添加或删除索引。

=== Character Sets 和 Collations
&lt;&lt;code&gt;&gt;
CONVERT TO CHARACTER SET charset_name [COLLATE collation_name]
[DEFAULT] CHARACTER SET [=] charset_name
[DEFAULT] COLLATE [=] collation_name
&lt;&lt;/code&gt;&gt;
设置 [[data-types-character-sets-and-collations|character sets and collations]] 的详细信息见 [[setting-character-sets-and-collations|Setting Character Sets and Collations]] 。

&lt;&lt;product mariadb from=10.3.0&gt;&gt;
=== WAIT/NOWAIT
设置锁等待超时时间. 见 [[wait-and-nowait|WAIT and NOWAIT]] 。
&lt;&lt;/product&gt;&gt;

=== ADD COLUMN [IF NOT EXISTS]  (col_name column_definition,...)

向表中添加一列。语法和 [[create-table|CREATE TABLE]] 中的相同。如果使用了 &lt;&lt;fixed&gt;&gt;IF NOT EXISTS&lt;&lt;/fixed&gt;&gt; ，当字段已存在时不会添加列。这在脚本中修改表结构很有用。

##FIRST##和##AFTER##字句会影响数据文件datafile中字段的物理顺序。使用##FIRST##可以将字段添加到表的最左边的位置(即作为第一列)。或者使用##AFTER##使得新添加的列在任意指定的字段之后。注意，直到目前为止，字段的物理位置顺序通常是无关紧要的。

=== DROP COLUMN [IF EXISTS] col_name [CASCADE|RESTRICT]
从表中删除列。如果使用了 &lt;&lt;fixed&gt;&gt;IF EXISTS&lt;&lt;/fixed&gt;&gt; ，当字段不存在时不会报错。如果字段是某个或某些索引的一部分，删除字段将会从索引中将其删除，除非你在同一时刻创建一个同名的新字段。如果索引中的所有字段都被删除了，则索引会自动被删除。如果在视图或触发器中引用了某个字段，将在下次访问视图或触发器时报错。

从MariaDB 10.2.8开始，从多列复合的UNIQUE约束中删除某个字段是不被允许的，例如：

&lt;&lt;product mariadb from=10.2.8&gt;&gt;
不允许从多列复合的&lt;&lt;fixed&gt;&gt;UNIQUE&lt;&lt;/fixed&gt;&gt;约束中删除字段，例如：
&lt;&lt;code&gt;&gt;
CREATE TABLE a (
  a int,
  b int,
  primary key (a,b)
);

ALTER TABLE x DROP COLUMN a;
[42000][1072] Key column &#39;A&#39; doesn&#39;t exist in table
&lt;&lt;/code&gt;&gt;
原因是删除字段##a##的过程中将导致新的约束要求字段##b##中的所有值都是唯一的。要删除##UNIQUE##索引中的字段，需要显式指定##DROP PRIMARY KEY##以及##ADD PRIMARY KEY##。在MariaDB 10.2.7及之前的版本，都可以直接删除字段并应用新的约束，如下：
&lt;&lt;code&gt;&gt;
ALTER TABLE x DROP COLUMN a;
Query OK, 0 rows affected (0.46 sec)

DESC x;
+-------+---------+------+-----+---------+-------+
| Field | Type    | Null | Key | Default | Extra |
+-------+---------+------+-----+---------+-------+
| b     | int(11) | NO   | PRI | NULL    |       |
+-------+---------+------+-----+---------+-------+
&lt;&lt;/code&gt;&gt;
&lt;&lt;/product&gt;&gt;
&lt;&lt;fixed&gt;&gt;RESTRICT&lt;&lt;/fixed&gt;&gt; 和 &lt;&lt;fixed&gt;&gt;CASCADE&lt;&lt;/fixed&gt;&gt; 使得从其他数据库系统移植数据变得更简单，但在MariaDB中，它们没有任何作用。

=== MODIFY COLUMN
可用来修改字段类型。被修改的列的位置顺序和修改前位置相同，且该列上的所有索引都继续保留。注意，当modifiy字段时，必须重新指定新字段的所有属性。
&lt;&lt;sql&gt;&gt;
CREATE TABLE t1 (a INT UNSIGNED AUTO_INCREMENT, PRIMARY KEY((a));
ALTER TABLE t1 MODIFY a BIGINT UNSIGNED AUTO_INCREMENT;
&lt;&lt;/sql&gt;&gt;

=== CHANGE COLUMN
工作方式和 ##MODIFY COLUMN## 类似，但可以修改字段名称。被修改的列的位置顺序和修改前位置相同，且该列上的所有索引都继续保留。

&lt;&lt;sql&gt;&gt;
CREATE TABLE t1 (a INT UNSIGNED AUTO_INCREMENT, PRIMARY KEY(a));
ALTER TABLE t1 CHANGE a b BIGINT UNSIGNED AUTO_INCREMENT;
&lt;&lt;/sql&gt;&gt;

=== ENABLE/ DISABLE KEYS

##DISABLE KEYS## 将禁用存储引擎支持的所有非unique索引 (至少是MyISAM和Aria)。这可以加速 [[how-to-quickly-insert-data-into-mariadb|speed up inserts]]向空表插入数据的过程。

##ENABLE KEYS## 将启用所有被禁用的索引。

=== ENGINE/FORCE 重建表

##ALTER TABLE## 可以强制MariaDB进行表重建(re-build)。在MariaDB 10.0以前，这只能通过设置##ENGINE##为原值来实现。在MariaDB 10.0中，可以使用##FORCE##选项。例如，对于一个InnoDB表，可以使用下面的语句进行表重建：

&lt;&lt;sql&gt;&gt;
ALTER TABLE tab_name ENGINE = InnoDB;
&lt;&lt;/sql&gt;&gt;

从MariaDB 10.0开始，这等价于：

&lt;&lt;sql&gt;&gt;
ALTER TABLE tab_name FORCE;
&lt;&lt;/sql&gt;&gt;

对于InnoDB存储引擎，ALTER TABLE将在 [[xtradbinnodb-server-system-variables#innodb_file_per_table|innodb_file_per_table]] 设置为##ON##时回收未使用的空间(例如，之前删除行后遗留下来的空间)。如果该变量的值为##OFF##，在ALTER TABLE后将不会回收未使用的空间，但随后新插入数据时可以重用这些空间。

=== IMPORT TABLESPACE

这用于导入由 [[flush-tables-for-export|FLUSH TABLES FOR EXPORT]] 创建的InnoDB表。

导入的过程如下：

&lt;&lt;code&gt;&gt;
CREATE TABLE t…; /* using the output from SHOW CREATE TABLE */
ALTER TABLE t DISCARD TABLESPACE; /* effectively corrupts the database! */
/* copy the file t.ibd to the file system */
ALTER TABLE t IMPORT TABLESPACE;
&lt;&lt;/code&gt;&gt;

其他存储引擎无需使用##ALTER TABLE ... IMPORT##。这些数据被拷贝后可以立刻被访问。

=== ALGORITHM / ALTER TABLE何时会拷贝所有数据?

在MariaDB 10.0之前，ALTER TABLE操作表时会创建该表的临时副本，这会导致操作大表时速度缓慢。从MariaDB 10.0开始，ALTER TABLE的许多操作都可以直接在原地(in-place)操作，不再需要创建表的临时副本。

随着时间的推移，可能越来越多的操作都不再需要拷贝全表数据。以下是目前不需要表拷贝动作的ALTER TABLE行为：

* 修改字段名称。  
* 扩大整型数据类型的显示宽度，例如INT(2)--&gt;INT(3)。  
* 修改表注释。  
* 向enum的列表尾部添加值。  
* 重命名表。  

如果要执行多个ALTER TABLE操作，并且其中可能有一个或多个操作要求重建表，那么可以很方便地将这些操作组合在单个ALTER TABLE语句中，以便只执行一次重建操作。

从MariaDB 10.0开始，ALTER TABLE开始支持##ALGORITHM##字句，该字句可以使用3种值：

* ALGORITHM=DEFAULT (未指定ALGORITHM子句时的默认值)
* ALGORITHM=COPY
* ALGORITHM=INPLACE

设置##ALGORITHM=COPY##时，即使是那些没必要拷贝表数据的操作也会进行copy。这会导致大量表数据的拷贝。

设置##ALGORITHM=INPLACE##时，将采用in-place技术(原地执行操作)，它会禁止表数据拷贝。如果某操作要求拷贝表数据，将会报如下错误：

&lt;&lt;code&gt;&gt;
CREATE TABLE t1 (a INT, e ENUM (&#39;red&#39;,&#39;green&#39;));
ALTER TABLE t1 MODIFY e EMUM(&#39;red&#39;,&#39;green&#39;,&#39;blue&#39;), ALGORITHM=INPLACE;
-&gt; Query OK, 0 rows affected (0.11 sec)
-&gt; Records: 0  Duplicates: 0  Warnings: 0

ALTER TABLE t1 ADD c INT, ALGORITHM=INPLACE;
-&gt; ERROR 1845 (0A000): ALGORITHM=INPLACE is not supported for this operation. Try ALGORITHM=COPY.
&lt;&lt;/code&gt;&gt;

默认的行为(##ALGORITHM=DEFAULT##，或未设置##ALGORITHM##子句)通常仅在需要拷贝时进行表数据拷贝。可以通过设置系统变量[[server-system-variables#old_alter_table|old_alter_table]] 的值为##ON##(默认为##OFF##)来改变它的行为，这种情况下将使用pre-MySQL 5.0的拷贝算法进行表拷贝。

&lt;&lt;product mariadb from=10.0.11&gt;&gt;
从MariaDB 10.0.11开始，Online ALTER TABLE同样可以操作已分区表。
&lt;&lt;/product&gt;&gt;

=== LOCK

不同的操作、不同的存储引擎，##ALTER TABLE##采用的锁策略也不同。在某些情况下完全不需要任何锁，某些情况下仅需要读锁，某些情况下又需要写锁。##LOCK##子句可以指定一个固定的锁策略。它会强制使用该锁策略(即使指定的锁策略可能比操作正常需求的锁策略更严格)，但如果存储引擎上的某个操作要求比指定的策略更严格的策略，将生成错误信息。##LOCK##子句接受的值包括：

* ##DEFAULT##: 采用所允许的最高并发级别的锁。
* ##NONE:## 不采用任何锁，这可能会经常性地产生错误信息。
* ##SHARED##: 采用读锁。
* ##EXCLUSIVE##: 采用写锁。

不指定##LOCK##子句时，默认##LOCK=DEFAULT##。

此外，可以使用##ALTER ONLINE TABLE##确保##ALTER TABLE##子句不会阻塞任何正在并发的操作(不使用任何锁)，这等价于##LOCK=NONE##。

当设置##ALGORITHM=INPLACE##算法时，某些情况下会需要一些临时文件，这些临时文件创建在 [[server-system-variables#tmpdir|tmpdir]] 系统变量指定的临时目录内。

&lt;&lt;style class=&#34;redbox&#34;&gt;&gt;
注意，如果使用了COPY算法，那么 [[xtradbinnodb-server-system-variables#innodb_file_per_table|innodb_file_per_table]] 和 [[xtradbinnodb-server-system-variables#innodb_file_format|innodb_file_format]] 变量的当前值会在InnoDB表重建时被提交。
&lt;&lt;/style&gt;&gt;

=== 处理进度报告Progress Reports

从MariaDB 5.3开始，可以在支持进度报告协议的客户端上获取##ALTER TABLE##的处理进度。例如，从e [[mysql-command-line-client|mysql client]]客户端：

&lt;&lt;code&gt;&gt;
ALTER TABLE test ENGINE=Aria;
Stage: 1 of 2 &#39;copy to tmp table&#39;    46% of stage
&lt;&lt;/code&gt;&gt;

The progress report is also shown in [[show-processlist|SHOW PROCESSLIST]]
以及 [[information-schema-processlist-table|information_schema.processlist]] 表同样也可以显示处理进度。

=== 权限说明Privileges
ALTER TABLE要求至少有//ALTER//权限。重命名表还需要//DROP//，//CREATE//以及//INSERT//权限(因为重命名表是重建表的过程，需要拷贝整个表数据到临时副本，并使用副本填充新表)。

== 示例
添加一个字段：
&lt;&lt;sql&gt;&gt;
ALTER TABLE t1 ADD x INT;
&lt;&lt;/sql&gt;&gt;

删除一个字段：
&lt;&lt;sql&gt;&gt;
ALTER TABLE t1 DROP x;
&lt;&lt;/sql&gt;&gt;

修改一个字段的类型：
&lt;&lt;sql&gt;&gt;
ALTER TABLE t1 MODIFY x bigint unsigned;
&lt;&lt;/sql&gt;&gt;

修改一个字段的名称和类型：
&lt;&lt;sql&gt;&gt;
ALTER TABLE t1 CHANGE a b bigint unsigned auto_increment;
&lt;&lt;/sql&gt;&gt;

整合多个子句到单个ALTER TABLE语句中，使用逗号分隔：
&lt;&lt;sql&gt;&gt;
ALTER TABLE t1 DROP x, ADD x2 INT,  CHANGE y y2 INT;
&lt;&lt;/sql&gt;&gt;

修改存储引擎：
&lt;&lt;sql&gt;&gt;
ALTER TABLE t1 ENGINE = InnoDB;
&lt;&lt;/sql&gt;&gt;

强制重建表(如果上面的例子中存储引擎已经是InnoDB，也将会重建表)：
&lt;&lt;sql&gt;&gt;
ALTER TABLE t1 FORCE;
&lt;&lt;/sql&gt;&gt;

== See Also
* [[create-table|CREATE TABLE]]
* [[drop-table|DROP TABLE]]
* [[character-sets-and-collations|Character Sets and Collations]]
* [[show-create-table|SHOW CREATE TABLE]]
* [[alter-table-statement|ALTER TABLE in SQL99]]</textarea>
    


                    <div id="content_disclaimer" class="graybox">
                        Content reproduced on this site is the property of its respective owners,
                        and this content is not reviewed in advance by MariaDB. The views, information and opinions
                        expressed by this content do not necessarily represent those of MariaDB or any other party.
                    </div>
                </div>
            </section>

            
        </div>
    </div>
</div>

<!-- Footer -->
<footer id="footer">
    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-xs-12">
                    <ul class="list-inline text-center footer-nav">
                        <li>
                            <h5>
                                <a href="https://mariadb.com/products" title="Products">Products</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/services" title="Services">Services</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/pricing" title="Pricing">Pricing</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/resources" title="Resources">Resources</a>
                            </h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/about-us" title="About MariaDB">About Us</a></h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/download" title="Download">Download MariaDB</a></h5>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="row row-10">
                
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div id="block-footerformcontact" class="block block-block-content block-block-contentd754ee1b-3cc9-40e7-9ef4-f504f1197fb1">
                        
                            <h5 style="font-weight: 400;">Subscribe to our newsletter!</h5>
                            <script src="//app-sj15.marketo.com/js/forms2/js/forms2.min.js"></script><form id="mktoForm_1498"></form>
                            <script>
                                <!--//--><![CDATA[// ><!--
                                MktoForms2.loadForm("//app-sj15.marketo.com", "573-PXI-984", 1498);
                                //--><!]]]]><![CDATA[>
                                //--><!]]>
                            </script>
                        
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div class="footer-copyright">
                        <div class="text-center">
                            <ul class="list-inline no-margin">
                                <li>
                                    <a href="/legal" title="Legal">Legal</a>
                                </li>
                                <li>
                                    <a href="/privacy-policy" title="Privacy Policy">Privacy Policy</a>
                                </li>
                                <li>
                                    <a href="/cookie-policy/" title="Cookies">Cookie Policy</a>
                                </li>
                            </ul>
                            <p>Copyright &copy; 2024 MariaDB. All rights reserved.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</footer>
</div>

<div id="ajax_loading">
    <img src="/kb/static/images/ajax-loader.a51c5608d01a.gif" />
</div>

    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MK2847"
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MK2847');</script>
    <!-- End Google Tag Manager -->

</body>

<script type="text/javascript" src="/kb/static/js/main.1587e3a666fc.js" charset="utf-8"></script>

</html>