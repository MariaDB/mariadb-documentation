<!DOCTYPE html>
<html>
<head data-cookie-domain=""
      data-cookie-path="/">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="apple-touch-icon" sizes="180x180" href="/kb/static/images/favicons/apple-touch-icon.159e713979be.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/kb/static/images/favicons/favicon-32x32.bc0ac1d5d11e.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/kb/static/images/favicons/favicon-16x16.5801f8f0f34e.png">
    <link rel="shortcut icon" href="/kb/static/images/favicons/favicon.d122d305dee4.ico" type="image/x-icon" />

    <title>创建用户 - Source - MariaDB Knowledge Base</title>

    <link href="/kb/static/css/main.f7633538c846.css" rel="stylesheet" type="text/css" />

    
        <meta name="robots" content="noindex, nofollow">
    

    

    <!-- FB Open Graph tags -->
    <meta property="og:title" content="创建用户 - Source" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://mariadb.com/kb/zh-cn/create-user/+source/" />
    <meta property="og:image" content="http://mariadb.comaskmonty-logo.png" />
    <meta property="og:site_name" content="MariaDB KnowledgeBase" />
    <meta property="fb:admins" content="514852603" />
    <meta property="og:description" content="" />

    <meta name="description" content="" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet"/>
    
</head>
<body class="mpkb nodes autoresize nodes_source jqui" id="nodes_source">





<div id="menu-mobile" class="visible-sm visible-xs">

    <div>
        <div id="mobile-close-menu" class="text-right">
            <a href="javascript:void(0)" title="Close Menu" id="back-main" class="toggle-menu">X<span></span></a>
        </div>
    </div>
    <div class="mainmenu-mobile">
        <ul class="ls-none ul-menu">
            <li data-sub="submenu5"><a class="open-form-search" href="/kb/search/" title="Search">Search </a></li>
            <li data-sub="submenu0"><a href="/products" title="Products">Products</a><span class="arrow-main"></span></li>
            <li data-sub="submenu1"><a href="/services" title="Services">Services</a><span class="arrow-main"></span></li>
            <li data-sub="submenu2"><a href="/resources" title="Resources">Resources</a><span class="arrow-main"></span></li>
            <li data-sub="submenu3"><a href="/about-us" title="About">About</a><span class="arrow-main"></span></li>
            <li data-sub="submenu4"><a href="/contact" title="Contact">Contact</a></li>
        </ul>
    </div>

    <div class="nav-top-mobile">
        <div class="select-box form">

            <ul class="inline-block-md mb-none top-nav">
                <li>

                </li>
                
                    <li>
                        <a href="/kb/user/login?next=/kb/zh-cn/create-user/+source/"> Login</a>
                    </li>
                
            </ul>



        </div>
        <p class="text-center copyright">Copyright &copy; 2025 MariaDB. All rights reserved.</p>
    </div>
</div>
<div class="violator-wrap d-none" id="top_violator">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12">
                <div class="violator-outer">
                    <div class="violator-inner">
                        <div class="row">
                            <div class="col-xs-12 col-sm-9 col-lg-7 col-lg-offset-2" id="top_violator_content">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="content-link" target="_blank" rel="nofollow noreferrer">
                                    <span>The Ultimate Guide to High Availability with MariaDB</span>
                                </a>
                            </div>
                            <div class="col-xs-12 col-sm-3" id="top_violator_cta">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="btn btn-mariadb" target="_blank" rel="nofollow noreferrer">Download Now</a>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-link close-btn">
                        <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24" width="15px" height="15px"><path d="M 4.9902344 3.9902344 A 1.0001 1.0001 0 0 0 4.2929688 5.7070312 L 10.585938 12 L 4.2929688 18.292969 A 1.0001 1.0001 0 1 0 5.7070312 19.707031 L 12 13.414062 L 18.292969 19.707031 A 1.0001 1.0001 0 1 0 19.707031 18.292969 L 13.414062 12 L 19.707031 5.7070312 A 1.0001 1.0001 0 0 0 18.980469 3.9902344 A 1.0001 1.0001 0 0 0 18.292969 4.2929688 L 12 10.585938 L 5.7070312 4.2929688 A 1.0001 1.0001 0 0 0 4.9902344 3.9902344 z"/></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="wrapper">
<div id="top-nav">
    <div class="container">
        <ul class="hidden-sm hidden-xs" >
            <li><a href="https://mariadb.com/kb/">Knowledge Base</a></li>
            <li><a href="https://mariadb.com/contact/">Contact</a></li>
            
                
                    <li>
                        <a href="/kb/user/login?next=/kb/zh-cn/create-user/+source/" rel="nofollow">Login</a>
                    </li>
                
            
            
            <li id="search-form">
                <form action="/kb/zh-cn/+search/" method="get" id="search-block-form" accept-charset="UTF-8">
                    <input id="search" title="Enter the terms you wish to search for."
                           placeholder="Search . . ." type="text"
                           name="q" value="" size="15" maxlength="128" class="form-text"
                           data-autocomplete-url="/kb/zh-cn/+search/autocomplete/">
                    <input type="hidden" name="quick" value="1" />
                    <input type="hidden" name="source" value="kb" />
                </form>
            </li>
            <li><a id="search-toggler" href="/kb/search/">Search</a></li>
            
        </ul>
    </div>
</div>
<div id="navbar-bottom" class="navbar">
    <div class="container">
        
        
        
        
        <div class="row">
            <div class="col-md-3 col-sm-9 col-xs-9">
                <a class="brand" href="/" title="MariaDB">
                    <img src="/kb/static/images/logo-2018-black.95f5978ae14d.png">
                </a>
            </div>
            <div class="col-md-9 hidden-sm hidden-xs">
                <div class="main-menu">
                    <ul id="main-menu" class="nav navbar-nav inline-block-sm">
    <li class="has-sub full-menu">
        <a href="/products" title="Products">Products</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/services" title="Services">Services</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/pricing" title="Pricing">Pricing</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/resources" title="Resources">Resources</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/about-us" title="About Us">About Us</a>
    </li>
    <li class="">
        <a class="button electric-eel small top-bar-right-download" href="/downloads/">Download</a>
    </li>
</ul>
                </div>
            </div>
            <div class="col-md-3 visible-sm visible-xs col-sm-3 col-xs-3 ps-rv">
                <div class="navbar-header text-right pull-right">
                    <button type="button" class="menu-control toggle-menu" id="open-menu">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="main">
    <div class="container">
        

        <div id="subheader1" class="clearfix">
            <div class="pull-left">
                
                <div id="breadcrumbs" class="breadcrumb">
                    <a href="/kb/zh-cn/">Knowledge Base</a>
                    


    
    » <a class="crumb" href="/kb/zh-cn/mariadb/">MariaDB - 简体中文</a>
    

    
    » <a class="crumb" href="/kb/zh-cn/mariadb-server/">MariaDB Server文档</a>
    


    » <a class="node_link crumb" href="/kb/zh-cn/create-user/">创建用户</a>


                </div>
                
            </div>
        </div>
    </div>
    <div class="container" id="container-main">
        <div class="row">
            
            
                
                <aside id="sidebar-first" class="sidebar col-md-2 hidden-xs hidden-sm hidden-print">
                    
                        
                        <ul id="category_menu" class="nav nav-pills nav-stacked">
                            <li><a href="/kb/zh-cn/">首页</a></li>
                            
                                
                                    <li><a href="/kb/zh-cn/+questions/">Open Questions</a></li>
                                
                                <li><a href="/kb/zh-cn/documentation/">MariaDB Server</a></li>
                                <li><a href="/kb/zh-cn/maxscale/">MariaDB MaxScale</a></li>
                                <li><a href="/kb/zh-cn/mariadb-columnstore/">MariaDB ColumnStore</a></li>
                                <li><a href="/kb/zh-cn/connectors/">Connectors</a></li>
                            

                        </ul>
                    

                    
                        <div>
    

<div class="well well-small box actions"><div>

        <a class="btn btn-block btn-small" href="/kb/zh-cn/create-user/">Return to article</a>
    
</div>
</div>

</div>
                    

                    

































                </aside>
            
            
            
                
            
            
            <section id="content" class="limited_width col-md-10 clearfix">
                
                    <h1>创建用户 - Source</h1>
                

                



                <div>
                    

    

    
    <div class="revision_info">
        <dl class="table">
            <dt>Revision</dt>
            <dd><a href="/kb/zh-cn/create-user/+r/126127/">126127</a></dd>
            <dt>用户</dt>
            <dd>
<span class="user" id="user-13772">
<a href="/kb/user/id/13772" title="Yingquan He">Yingquan He</a>
</span></dd>
            <dt>Date</dt>
            <dd>

<span class="datetime" title="2023-05-24 15:02">2023-05-24 15:02</span></dd>
        </dl>
    </div>
    


    

    
        
        <textarea id="answer_source" class="creole_source autogrow">== 语法
&lt;&lt;code&gt;&gt;
CREATE [OR REPLACE] USER [IF NOT EXISTS] 
 &lt;&lt;creole&gt;&gt;//user_specification// [,//user_specification// ...] &lt;&lt;/creole&gt;&gt;
  &lt;&lt;creole&gt;&gt;[REQUIRE {NONE | //tls_option// [[AND] //tls_option// ...] }]&lt;&lt;/creole&gt;&gt;
 &lt;&lt;creole&gt;&gt; [WITH //resource_option// [//resource_option// ...] ]&lt;&lt;/creole&gt;&gt;
 &lt;&lt;creole&gt;&gt; [//lock_option//] [//password_option//] &lt;&lt;/creole&gt;&gt;

&lt;&lt;creole&gt;&gt;//user_specification//:&lt;&lt;/creole&gt;&gt;
  &lt;&lt;creole&gt;&gt;username [//authentication_option//]&lt;&lt;/creole&gt;&gt;

&lt;&lt;creole&gt;&gt;//authentication_option//:&lt;&lt;/creole&gt;&gt;
  IDENTIFIED BY &#39;password&#39; 
  | IDENTIFIED BY PASSWORD &#39;password_hash&#39;
&lt;&lt;creole&gt;&gt;  | IDENTIFIED {VIA|WITH} //authentication_rule// [OR //authentication_rule//&lt;&lt;/creole&gt;&gt;  ...]

&lt;&lt;creole&gt;&gt;//authentication_rule//:&lt;&lt;/creole&gt;&gt;
    authentication_plugin
  | authentication_plugin {USING|AS} &#39;authentication_string&#39;
  | authentication_plugin {USING|AS} PASSWORD(&#39;password&#39;)

&lt;&lt;creole&gt;&gt;//tls_option//:&lt;&lt;/creole&gt;&gt;
  SSL 
  | X509
  | CIPHER &#39;cipher&#39;
  | ISSUER &#39;issuer&#39;
  | SUBJECT &#39;subject&#39;

&lt;&lt;creole&gt;&gt;//resource_option//:&lt;&lt;/creole&gt;&gt;
  MAX_QUERIES_PER_HOUR count
  | MAX_UPDATES_PER_HOUR count
  | MAX_CONNECTIONS_PER_HOUR count
  | MAX_USER_CONNECTIONS count
  | MAX_STATEMENT_TIME time

&lt;&lt;creole&gt;&gt;//password_option//:&lt;&lt;/creole&gt;&gt;
  PASSWORD EXPIRE
  | PASSWORD EXPIRE DEFAULT
  | PASSWORD EXPIRE NEVER
  | PASSWORD EXPIRE INTERVAL N DAY

&lt;&lt;creole&gt;&gt;//lock_option//:&lt;&lt;/creole&gt;&gt;
    ACCOUNT LOCK
  | ACCOUNT UNLOCK
}
&lt;&lt;/code&gt;&gt;

&lt;&lt;toc&gt;&gt;

== 描述

##CREATE USER## 语句创建新的 MariaDB 帐户。要使用它，您必须具有全局 [[grant/#create-user|CREATE USER]] 特权或 [[grant#table-privileges|INSERT]] 特权以访问 [[the-mysql-database-tables|mysql]] 数据库。对于每个帐户，##CREATE USER## 在 [[mysqluser-table|mysql.user]] (在 MariaDB 10.3 之前是表，在 MariaDB 10.4 之后是视图) 或 [[mysqlglobal_priv-table|mysql.global_priv_table]] (从 MariaDB 10.4 开始) 中创建一个没有权限的新行。

如果指定的任何帐户或指定的帐户的任何权限已经存在，则服务器将返回 ##ERROR 1396 (HY000)##。如果发生错误，##CREATE USER## 仍将创建未产生错误的帐户。对于未创建的所有用户，只产生一个错误：

&lt;&lt;code wrap=true&gt;&gt;
ERROR 1396 (HY000): 
  Operation CREATE USER failed for &#39;u1&#39;@&#39;%&#39;,&#39;u2&#39;@&#39;%&#39;
&lt;&lt;/code&gt;&gt;

当 ##CREATE USER##、[[drop-user|DROP USER]]、[[create-role|CREATE ROLE]] 和 [[drop-role|DROP ROLE]] 失败时，它们都会产生相同的错误代码。

有关指定帐户名称的详细信息，请参阅下面的 [[#account-names|帐户名称]]。

== OR REPLACE
如果使用可选的 ##OR REPLACE## 子句，则基本上是以下快捷方式：

&lt;&lt;code lang=mysql inline=false&gt;&gt;
DROP USER IF EXISTS name;
CREATE USER name ...;
&lt;&lt;/code&gt;&gt;

例如：

&lt;&lt;code lang=mysql inline=false&gt;&gt;
CREATE USER foo2@test IDENTIFIED BY &#39;password&#39;;
ERROR 1396 (HY000): Operation CREATE USER failed for &#39;foo2&#39;@&#39;test&#39;

CREATE OR REPLACE USER foo2@test IDENTIFIED BY &#39;password&#39;;
Query OK, 0 rows affected (0.00 sec)
&lt;&lt;/code&gt;&gt;

== IF NOT EXISTS
当使用 ##IF NOT EXISTS## 子句时，如果指定的用户已经存在，则 MariaDB 将返回一个警告而不是错误。

例如：

&lt;&lt;code&gt;&gt;
CREATE USER foo2@test IDENTIFIED BY &#39;password&#39;;
ERROR 1396 (HY000): Operation CREATE USER failed for &#39;foo2&#39;@&#39;test&#39;

CREATE USER IF NOT EXISTS foo2@test IDENTIFIED BY &#39;password&#39;;
Query OK, 0 rows affected, 1 warning (0.00 sec)

显示警告;
+-------+------+----------------------------------------------------+
| Level | Code | Message                                            |
+-------+------+----------------------------------------------------+
| Note  | 1973 | Can&#39;t create user &#39;foo2&#39;@&#39;test&#39;; it already exists |
+-------+------+----------------------------------------------------+
&lt;&lt;/code&gt;&gt;

== 认证选项

=== IDENTIFIED BY &#39;password&#39;

可选的 ##IDENTIFIED BY## 子句可用于为帐户提供密码。密码应以明文形式指定。在存储在 [[mysqluser-table|mysql.user]]/[[mysqlglobal_priv-table|mysql.global_priv_table]] 表中之前，它将由 [[password|PASSWORD]] 函数进行哈希处理。

例如，如果我们的密码是 ##mariadb##，则可以使用以下命令创建用户：

&lt;&lt;sql&gt;&gt;
CREATE USER foo2@test IDENTIFIED BY &#39;mariadb&#39;;
&lt;&lt;/sql&gt;&gt;

如果您没有在 ##IDENTIFIED BY## 子句中指定密码，则该用户将能够无密码连接。空白密码不是匹配任何密码的通配符。如果没有设置密码，则用户必须在不提供密码的情况下连接。

此子句支持的唯一 [[authentication-plugins|认证插件]] 是 [[authentication-plugin-mysql_native_password|mysql_native_password]] 和 [[authentication-plugin-mysql_old_password|mysql_old_password]]。

=== IDENTIFIED BY PASSWORD &#39;password_hash&#39;

可选的 ##IDENTIFIED BY PASSWORD## 子句可用于提供已经被哈希处理的密码的帐户。密码应指定为由 [[password|PASSWORD]] 函数提供的哈希值。它将按原样存储在 [[mysqluser-table|mysql.user]]/[[mysqlglobal_priv-table|mysql.global_priv_table]] 表中。

例如，如果我们的密码是 ##mariadb##，则可以使用以下命令查找哈希值：

&lt;&lt;sql&gt;&gt;
SELECT PASSWORD(&#39;mariadb&#39;);
+-------------------------------------------+
| PASSWORD(&#39;mariadb&#39;)                       |
+-------------------------------------------+
| *54958E764CE10E50764C2EECBB71D01F08549980 |
+-------------------------------------------+
1 row in set (0.00 sec)
&lt;&lt;/sql&gt;&gt;

然后，我们可以使用哈希值创建用户：

&lt;&lt;sql&gt;&gt;
CREATE USER foo2@test IDENTIFIED BY PASSWORD &#39;*54958E764CE10E50764C2EECBB71D01F08549980&#39;;
&lt;&lt;/sql&gt;&gt;

如果您没有在 ##IDENTIFIED BY## 子句中指定密码，则该用户将能够无密码连接。空白密码不是匹配任何密码的通配符。如果没有设置密码，则用户必须在不提供密码的情况下连接。

这个子句支持的唯一[[authentication-plugins|认证插件]]是[[authentication-plugin-mysql_native_password|mysql_native_password]]和[[authentication-plugin-mysql_old_password|mysql_old_password]]。

=== 通过认证插件认证

可选的##IDENTIFIED VIA认证插件##允许您指定帐户应由特定的[[authentication-plugins|认证插件]]进行身份验证。插件名称必须是作为[[show-plugins|SHOW PLUGINS]]的活动认证插件。如果它没有显示在该输出中，则需要使用[[install-plugin|INSTALL PLUGIN]]或[[install-soname|INSTALL SONAME]]安装它。

例如，这可以与PAM认证插件一起使用：

&lt;&lt;sql&gt;&gt;
CREATE USER foo2@test IDENTIFIED VIA pam;
&lt;&lt;/sql&gt;&gt;

某些认证插件允许在USING或AS关键字之后指定其他参数。例如，PAM认证插件接受服务名称：

&lt;&lt;sql&gt;&gt;
CREATE USER foo2@test IDENTIFIED VIA pam USING &#39;mariadb&#39;;
&lt;&lt;/sql&gt;&gt;

附加参数的确切含义取决于特定的认证插件。

&lt;&lt;product mariadb from=&#34;10.4.0&#34;&gt;&gt;
如果作为[[password|PASSWORD（）]]函数的参数提供了明文密码，则可以使用##USING##或##AS##关键字将纯文本密码提供给插件。这仅适用于已实现[[password|PASSWORD（）]]函数钩子的认证插件。例如，[[authentication-plugin-ed25519|ed25519]]认证插件支持此操作：

&lt;&lt;sql&gt;&gt;
CREATE USER safe@&#39;%&#39; IDENTIFIED VIA ed25519 USING PASSWORD(&#39;secret&#39;);
&lt;&lt;/sql&gt;&gt;
&lt;&lt;/product&gt;&gt;

&lt;&lt;product mariadb from=&#34;10.4.3&#34;&gt;&gt;
可以指定多个认证插件，它们都可以作为用户身份验证的替代方式：

&lt;&lt;sql&gt;&gt;
CREATE USER safe@&#39;%&#39; IDENTIFIED VIA ed25519 USING PASSWORD(&#39;secret&#39;) OR unix_socket;
&lt;&lt;/sql&gt;&gt;
&lt;&lt;/product&gt;&gt;

默认情况下，当您创建一个没有指定认证插件的用户时，MariaDB使用[[authentication-plugin-mysql_native_password|mysql_native_password]]插件。

== TLS 选项

默认情况下，MariaDB在服务器和客户端之间传输数据时不加密。当服务器和客户端在同一主机上运行或在通过其他方式保证安全性的网络中运行时，这通常是可以接受的。但是，在服务器和客户端存在于不同网络或它们在高风险网络中的情况下，缺乏加密确实会引入安全问题，因为恶意行为者有可能窃听它们之间在网络上传输的流量。

为了缓解这个问题，MariaDB允许您使用传输层安全性（TLS）协议在服务器和客户端之间加密传输的数据。TLS以前称为安全套接字层（SSL），但严格来说SSL协议是TLS的前身，并且该协议的版本现在被认为是不安全的。文档仍经常使用术语SSL，出于兼容性原因，与TLS相关的服务器系统和状态变量仍使用前缀ssl_，但在内部，MariaDB仅支持其安全的后继者。

有关如何确定您的MariaDB服务器是否具有TLS支持的更多信息，请参见[[secure-connections-overview|Secure Connections Overview]]。

您可以为特定用户帐户设置某些与TLS相关的限制。例如，您可能会将其用于需要访问敏感数据的用户帐户，同时将其发送到您无法控制的网络。可以使用[[create-user|CREATE USER]]、[[alter-user|ALTER USER]]或[[grant|GRANT]]语句为用户帐户启用这些限制。以下选项可用：

&lt;&lt;style class=&#34;darkheader-nospace-borders&#34;&gt;&gt;
|= 选项 |= 描述
| ##REQUIRE NONE## | 此账户不需要使用 TLS，但仍可使用。
| ##REQUIRE SSL## | 此账户必须使用 TLS，但不需要有效的 X509 证书。此选项不能与其他 TLS 选项组合使用。
| ##REQUIRE X509## | 此账户必须使用 TLS，并且必须具有有效的 X509 证书。此选项意味着 ##REQUIRE SSL##。此选项不能与其他 TLS 选项组合使用。
| ##REQUIRE ISSUER &#39;issuer&#39; | 此账户必须使用 TLS，并且必须具有有效的 X509 证书。此外，证书颁发机构必须是通过字符串 ##issuer## 指定的那个。此选项意味着 ##REQUIRE X509##。此选项可以与 ##SUBJECT## 和 ##CIPHER## 选项以任意顺序组合使用。
| ##REQUIRE SUBJECT &#39;subject&#39; | 此账户必须使用 TLS，并且必须具有有效的 X509 证书。此外，证书的主题必须是通过字符串 ##subject## 指定的那个。此选项意味着 ##REQUIRE X509##。此选项可以与 ##ISSUER## 和 ##CIPHER## 选项以任意顺序组合使用。
| ##REQUIRE CIPHER &#39;cipher&#39; | 此账户必须使用 TLS，但不需要有效的 X509 证书。此外，连接所使用的加密必须使用字符串 ##cipher## 中指定的特定密码方法。此选项意味着 ##REQUIRE SSL##。此选项可以与 ##ISSUER## 和 ##SUBJECT## 选项以任意顺序组合使用。
&lt;&lt;/style&gt;&gt;

##REQUIRE## 关键字必须仅用于指定选项的一次，而 ##AND## 关键字可用于分隔单个选项，但不是必需的。

例如，您可以创建一个需要以下 TLS 选项的用户帐户：

&lt;&lt;code lang=sql wrap=true&gt;&gt;
CREATE USER &#39;alice&#39;@&#39;%&#39;
 REQUIRE SUBJECT &#39;/CN=alice/O=My Dom, Inc./C=US/ST=Oregon/L=Portland&#39;
 AND ISSUER &#39;/C=FI/ST=Somewhere/L=City/ O=Some Company/CN=Peter Parker/emailAddress=p.parker@marvel.com&#39;
 AND CIPHER &#39;SHA-DES-CBC3-EDH-RSA&#39;;
&lt;&lt;/code&gt;&gt;

如果为特定用户帐户设置了这些选项中的任何一个，则尝试使用该用户帐户连接的任何客户端都必须配置为使用 TLS 连接。

有关如何在客户端和服务器上启用 TLS 的信息，请参见 [[securing-connections-for-client-and-server|Securing Connections for Client and Server]]。

== 资源限制选项

可以为某些服务器资源设置每个帐户的限制。下表显示了每个帐户可以设置的值：

&lt;&lt;style class=&#34;darkheader-nospace-borders&#34;&gt;&gt;
|= 限制类型 |= 描述
| ##MAX_QUERIES_PER_HOUR## | 帐户每小时可以发出的语句数量（包括更新）
| ##MAX_UPDATES_PER_HOUR## | 帐户每小时可以发出的更新（而不是查询）数量
| ##MAX_CONNECTIONS_PER_HOUR## | 帐户每小时可以启动的连接数量
| ##MAX_USER_CONNECTIONS## | 可以从同一帐户接受的同时连接数；如果为 0，则将使用 ##max_connections##；如果 ##max_connections## 为 0，则此帐户的同时连接没有限制。
| ##MAX_STATEMENT_TIME## | 用户执行的语句的超时时间（以秒为单位）。另请参见 [[aborting-statements|Aborting Statements that Exceed a Certain Time to Execute]]。

如果将这些限制中的任何一个设置为 ##0##，则该用户的该资源没有限制。

以下是创建具有资源限制的用户的示例：

&lt;&lt;sql&gt;&gt;
CREATE USER &#39;someone&#39;@&#39;localhost&#39; WITH
    MAX_USER_CONNECTIONS 10
    MAX_QUERIES_PER_HOUR 200;
&lt;&lt;/sql&gt;&gt;

这些资源按帐户跟踪，这意味着 ##&#39;user&#39;@&#39;server&#39;##；而不是按用户名或连接计数。

可以使用 [[flush|FLUSH USER_RESOURCES]]、[[flush|FLUSH PRIVILEGES]] 或 [[mysqladmin|mysqladmin reload]] 重置所有用户的计数。

每个帐户的资源限制存储在 [[the-mysql-database-tables|mysql]] 数据库中的 [[mysqluser-table|user]] 表中。用于资源限制的列名为 ##max_questions##、##max_updates##、##max_connections##（##MAX_CONNECTIONS_PER_HOUR## 的别名）和 ##max_user_connections##（##MAX_USER_CONNECTIONS## 的别名）。

== 帐户名称

帐户名称由用户名组件和主机名组件组成，并指定为##&#39;user_name&#39;@&#39;host_name&#39;##。

用户名和主机名可以不加引号，也可以使用双引号（##&#34;##）或单引号（##&#39;##）作为字符串引用，或使用反引号（##`##）作为标识符引用。在使用特殊字符（如连字符）或通配符字符时必须使用引号。如果使用引号，则必须分别引用用户名和主机名（例如##&#39;user_name&#39;@&#39;host_name&#39;##）。

=== 主机名组件

如果未提供主机名，则假定为##“%”##。

主机名可以包含通配符字符 ##%## 和 ##_##。它们与 [[like|LIKE]] 子句一样匹配。如果需要字面匹配通配符字符（例如匹配带有下划线的域名），请在字符前加上反斜杠。有关转义通配符字符的更多信息，请参见 ##LIKE##。

主机名匹配不区分大小写。主机名可以匹配域名或 IP 地址。使用 ##localhost## 作为主机名，仅允许本地客户端连接。在 Linux 上，回环接口（127.0.0.1）不会将“localhost”视为本地连接：这意味着仅通过 UNIX 域套接字连接才会匹配“localhost”。

您可以使用网络掩码来匹配一系列 IP 地址，使用##“base_ip/netmask”##作为主机名。如果用户具有 IP 地址 //ip_addr//，则如果满足以下条件，将允许连接：

&lt;&lt;code&gt;&gt;
ip_addr &amp; netmask = base_ip
&lt;&lt;/code&gt;&gt;

例如，给定用户：

&lt;&lt;code&gt;&gt;
CREATE USER &#39;maria&#39;@&#39;247.150.130.0/255.255.255.0&#39;;
&lt;&lt;/code&gt;&gt;

满足此条件的 IP 地址范围从 247.150.130.0 到 247.150.130.255。

使用 ##255.255.255.255## 等效于根本不使用网络掩码。IPv6 地址不能使用网络掩码。

请注意，在使用##“%”##通配符主机创建用户时添加的凭据并不总是授予访问权限。例如，某些系统带有匿名本地主机用户，在从本地主机连接时，这将优先考虑。

在 MariaDB 10.6 之前，主机名组件最长可达 60 个字符。从 MariaDB 10.6 开始，它可以达到 255 个字符。

=== 用户名组件

用户名必须完全匹配，包括大小写。空用户名称为空白帐户，并允许与任何用户名组件匹配的登录尝试。这些将在下一节中更详细地描述。

有关用作用户名的有效标识符，请参见[[identifier-names|标识符名称]]。

有可能在用户连接时匹配多个帐户。MariaDB 根据以下标准排序后选择第一个匹配的帐户：

* 具有精确主机名的帐户在使用主机名中的通配符之前排序。使用网络掩码的主机名被视为排序时是精确的。
* 具有主机名中的通配符的帐户根据第一个通配符字符的位置排序。具有较晚通配符字符的主机名排在具有较早通配符字符的主机名之前。
* 具有非空用户名的帐户在具有空用户名的帐户之前排序。
* 具有空用户名的帐户最后排序。如前所述，这些称为匿名帐户。这些将在下一节中更详细地描述。

以下表格显示了按这些标准排序的示例帐户：

&lt;&lt;code&gt;&gt;
+---------+-------------+
| User    | Host        |
+---------+-------------+
| joffrey | 192.168.0.3 |
|         | 192.168.0.% |
| joffrey | 192.168.%   |
|         | 192.168.%   |
+---------+-------------+
&lt;&lt;/code&gt;&gt;

一旦连接成功，您只能获得与匹配的帐户授予的特权，而不是所有可能匹配的帐户。例如，考虑以下命令：

&lt;&lt;sql&gt;&gt;
CREATE USER &#39;joffrey&#39;@&#39;192.168.0.3&#39;;
CREATE USER &#39;joffrey&#39;@&#39;%&#39;;
GRANT SELECT ON test.t1 to &#39;joffrey&#39;@&#39;192.168.0.3&#39;;
GRANT SELECT ON test.t2 to &#39;joffrey&#39;@&#39;%&#39;;
&lt;&lt;/sql&gt;&gt;

如果您从 &lt;&lt;code&gt;&gt;192.168.0.3&lt;&lt;/code&gt;&gt; 连接为 joffrey，则对于表 ##test.t1##，您将具有 ##SELECT## 特权，但对于表 ##test.t2##，您将没有特权。如果您从任何其他 IP 地址连接为 joffrey，则对于表 ##test.t2##，您将具有 ##SELECT## 特权，但对于表 ##test.t1##，您将没有特权。

在 10.6 之前，用户名可以长达 80 个字符，在 10.6 及之后，它可以长达 128 个字符。

=== 匿名帐户

匿名帐户是指帐户名称的用户名部分为空的帐户。这些帐户充当特殊的捕获所有帐户。如果用户尝试从主机登录系统，并且存在一个匿名帐户，其主机名部分与用户的主机相匹配，则如果没有更具体的帐户匹配用户输入的用户名，则用户将作为匿名帐户登录。

例如，以下是一些匿名帐户：

&lt;&lt;sql&gt;&gt;
CREATE USER &#39;&#39;@&#39;localhost&#39;;
CREATE USER &#39;&#39;@&#39;192.168.0.3&#39;;
&lt;&lt;/sql&gt;&gt;

==== 修复一个遗留的默认匿名账户

在某些系统上，[[mysqldb-table|mysql.db]] 表中默认情况下有一些 ##&#39;&#39;@&#39;%&#39;## 匿名帐户条目。不幸的是，在 [[mysqluser-table|mysql.user]]/[[mysqlglobal_priv-table|mysql.global_priv_table]] 表中没有匹配的条目，这意味着这个匿名帐户不存在，但是它确实具有特权 - 通常是在由 [[mysql_install_db|mysql_install_db]] 创建的默认 ##test## 数据库上。这些无账户特权是MySQL权限系统不太先进时留下的遗产。

这种情况意味着如果您尝试创建一个 ##&#39;&#39;@&#39;%&#39;## 帐户，则会遇到错误。例如：

&lt;&lt;sql&gt;&gt;
CREATE USER &#39;&#39;@&#39;%&#39;;
ERROR 1396 (HY000): Operation CREATE USER failed for &#39;&#39;@&#39;%&#39;
&lt;&lt;/sql&gt;&gt;

修复方法是[[delete|DELETE]] [[mysqldb-table|mysql.db]] 表中的行，然后执行[[flush|FLUSH PRIVILEGES]]：

&lt;&lt;sql&gt;&gt;
DELETE FROM mysql.db WHERE User=&#39;&#39; AND Host=&#39;%&#39;;
FLUSH PRIVILEGES;
&lt;&lt;/sql&gt;&gt;

然后可以创建用户账户：

&lt;&lt;sql&gt;&gt;
CREATE USER &#39;&#39;@&#39;%&#39;;
Query OK, 0 rows affected (0.01 sec)
&lt;&lt;/sql&gt;&gt;

有关更多信息，请参见 MDEV-13486。

== 密码过期
&lt;&lt;product mariadb from=10.4.3&gt;&gt;
除了根据 [[server-system-variables/#default_password_lifetime|default_password_lifetime]] 自动过期密码之外，还可以在个别用户的基础上设置密码过期时间，覆盖全局设置，例如：

&lt;&lt;sql&gt;&gt;
CREATE USER &#39;monty&#39;@&#39;localhost&#39; PASSWORD EXPIRE INTERVAL 120 DAY;
&lt;&lt;/sql&gt;&gt;

有关更多详细信息，请参见 [[user-password-expiry|用户密码过期]]。
&lt;&lt;/product&gt;&gt;

== 账户锁定
&lt;&lt;product mariadb from=10.4.2&gt;&gt;
账户锁定允许特权管理员锁定 / 解锁用户账户。如果已锁定账户，则不允许新的客户端连接（现有连接不受影响）。例如：
&lt;&lt;sql&gt;&gt;
CREATE USER &#39;marijn&#39;@&#39;localhost&#39; ACCOUNT LOCK;
&lt;&lt;/sql&gt;&gt;

有关更多详细信息，请参见[[account-locking|账户锁定]]。
&lt;&lt;/product&gt;&gt;

从 MariaDB 10.4.7 和 MariaDB 10.5.8 开始，//lock_option// 和 //password_option// 子句可以以任意顺序出现。

== 参见

* [[troubleshooting-connection-issues|故障排除连接问题]]
* [[authentication-from-mariadb-104|MariaDB 10.4 起的身份验证]]
* [[identifier-names/|标识符名称]]
* [[grant|GRANT]]
* [[alter-user|ALTER USER]]
* [[drop-user|DROP USER]]
* [[set-password|SET PASSWORD]]
* [[show-create-user|SHOW CREATE USER]]
* [[mysqluser-table|mysql.user 表]]
* [[mysqlglobal_priv-table|mysql.global_priv_table]]
* [[password-validation-plugins|密码验证插件]] - 允许设置密码的基本条件
* [[authentication-plugins|身份验证插件]] - 允许使用各种身份验证方法，并开发新的身份验证方法。</textarea>
    


                    <div id="content_disclaimer" class="graybox">
                        Content reproduced on this site is the property of its respective owners,
                        and this content is not reviewed in advance by MariaDB. The views, information and opinions
                        expressed by this content do not necessarily represent those of MariaDB or any other party.
                    </div>
                </div>
            </section>

            
        </div>
    </div>
</div>

<!-- Footer -->
<footer id="footer">
    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-xs-12">
                    <ul class="list-inline text-center footer-nav">
                        <li>
                            <h5>
                                <a href="https://mariadb.com/products" title="Products">Products</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/services" title="Services">Services</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/pricing" title="Pricing">Pricing</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/resources" title="Resources">Resources</a>
                            </h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/about-us" title="About MariaDB">About Us</a></h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/download" title="Download">Download MariaDB</a></h5>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="row row-10">
                
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div id="block-footerformcontact" class="block block-block-content block-block-contentd754ee1b-3cc9-40e7-9ef4-f504f1197fb1">
                        
                            <h5 style="font-weight: 400;">Subscribe to our newsletter!</h5>
                            <script src="//app-sj15.marketo.com/js/forms2/js/forms2.min.js"></script><form id="mktoForm_1498"></form>
                            <script>
                                <!--//--><![CDATA[// ><!--
                                MktoForms2.loadForm("//app-sj15.marketo.com", "573-PXI-984", 1498);
                                //--><!]]]]><![CDATA[>
                                //--><!]]>
                            </script>
                        
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div class="footer-copyright">
                        <div class="text-center">
                            <ul class="list-inline no-margin">
                                <li>
                                    <a href="/legal" title="Legal">Legal</a>
                                </li>
                                <li>
                                    <a href="/privacy-policy" title="Privacy Policy">Privacy Policy</a>
                                </li>
                                <li>
                                    <a href="/cookie-policy/" title="Cookies">Cookie Policy</a>
                                </li>
                            </ul>
                            <p>Copyright &copy; 2025 MariaDB. All rights reserved.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</footer>
</div>

<div id="ajax_loading">
    <img src="/kb/static/images/ajax-loader.a51c5608d01a.gif" />
</div>

    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MK2847"
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MK2847');</script>
    <!-- End Google Tag Manager -->

</body>

<script type="text/javascript" src="/kb/static/js/main.1587e3a666fc.js" charset="utf-8"></script>

</html>