<!DOCTYPE html>
<html>
<head data-cookie-domain=""
      data-cookie-path="/">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="apple-touch-icon" sizes="180x180" href="/kb/static/images/favicons/apple-touch-icon.159e713979be.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/kb/static/images/favicons/favicon-32x32.bc0ac1d5d11e.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/kb/static/images/favicons/favicon-16x16.5801f8f0f34e.png">
    <link rel="shortcut icon" href="/kb/static/images/favicons/favicon.d122d305dee4.ico" type="image/x-icon" />

    <title>Replication Threads - Source - MariaDB Knowledge Base</title>

    <link href="/kb/static/css/main.f7633538c846.css" rel="stylesheet" type="text/css" />

    
        <meta name="robots" content="noindex, nofollow">
    

    

    <!-- FB Open Graph tags -->
    <meta property="og:title" content="Replication Threads - Source" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://mariadb.com/kb/zh-cn/replication-threads/+source/" />
    <meta property="og:image" content="http://mariadb.comaskmonty-logo.png" />
    <meta property="og:site_name" content="MariaDB KnowledgeBase" />
    <meta property="fb:admins" content="514852603" />
    <meta property="og:description" content="" />

    <meta name="description" content="" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet"/>
    
</head>
<body class="mpkb nodes autoresize nodes_source jqui" id="nodes_source">





<div id="menu-mobile" class="visible-sm visible-xs">

    <div>
        <div id="mobile-close-menu" class="text-right">
            <a href="javascript:void(0)" title="Close Menu" id="back-main" class="toggle-menu">X<span></span></a>
        </div>
    </div>
    <div class="mainmenu-mobile">
        <ul class="ls-none ul-menu">
            <li data-sub="submenu5"><a class="open-form-search" href="/kb/search/" title="Search">Search </a></li>
            <li data-sub="submenu0"><a href="/products" title="Products">Products</a><span class="arrow-main"></span></li>
            <li data-sub="submenu1"><a href="/services" title="Services">Services</a><span class="arrow-main"></span></li>
            <li data-sub="submenu2"><a href="/resources" title="Resources">Resources</a><span class="arrow-main"></span></li>
            <li data-sub="submenu3"><a href="/about-us" title="About">About</a><span class="arrow-main"></span></li>
            <li data-sub="submenu4"><a href="/contact" title="Contact">Contact</a></li>
        </ul>
    </div>

    <div class="nav-top-mobile">
        <div class="select-box form">

            <ul class="inline-block-md mb-none top-nav">
                <li>

                </li>
                
                    <li>
                        <a href="/kb/user/login?next=/kb/zh-cn/replication-threads/+source/"> Login</a>
                    </li>
                
            </ul>



        </div>
        <p class="text-center copyright">Copyright &copy; 2024 MariaDB. All rights reserved.</p>
    </div>
</div>
<div class="violator-wrap d-none" id="top_violator">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12">
                <div class="violator-outer">
                    <div class="violator-inner">
                        <div class="row">
                            <div class="col-xs-12 col-sm-9 col-lg-7 col-lg-offset-2" id="top_violator_content">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="content-link" target="_blank" rel="nofollow noreferrer">
                                    <span>The Ultimate Guide to High Availability with MariaDB</span>
                                </a>
                            </div>
                            <div class="col-xs-12 col-sm-3" id="top_violator_cta">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="btn btn-mariadb" target="_blank" rel="nofollow noreferrer">Download Now</a>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-link close-btn">
                        <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24" width="15px" height="15px"><path d="M 4.9902344 3.9902344 A 1.0001 1.0001 0 0 0 4.2929688 5.7070312 L 10.585938 12 L 4.2929688 18.292969 A 1.0001 1.0001 0 1 0 5.7070312 19.707031 L 12 13.414062 L 18.292969 19.707031 A 1.0001 1.0001 0 1 0 19.707031 18.292969 L 13.414062 12 L 19.707031 5.7070312 A 1.0001 1.0001 0 0 0 18.980469 3.9902344 A 1.0001 1.0001 0 0 0 18.292969 4.2929688 L 12 10.585938 L 5.7070312 4.2929688 A 1.0001 1.0001 0 0 0 4.9902344 3.9902344 z"/></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="wrapper">
<div id="top-nav">
    <div class="container">
        <ul class="hidden-sm hidden-xs" >
            <li><a href="https://mariadb.com/kb/">Knowledge Base</a></li>
            <li><a href="https://mariadb.com/contact/">Contact</a></li>
            
                
                    <li>
                        <a href="/kb/user/login?next=/kb/zh-cn/replication-threads/+source/" rel="nofollow">Login</a>
                    </li>
                
            
            
            <li id="search-form">
                <form action="/kb/zh-cn/+search/" method="get" id="search-block-form" accept-charset="UTF-8">
                    <input id="search" title="Enter the terms you wish to search for."
                           placeholder="Search . . ." type="text"
                           name="q" value="" size="15" maxlength="128" class="form-text"
                           data-autocomplete-url="/kb/zh-cn/+search/autocomplete/">
                    <input type="hidden" name="quick" value="1" />
                    <input type="hidden" name="source" value="kb" />
                </form>
            </li>
            <li><a id="search-toggler" href="/kb/search/">Search</a></li>
            
        </ul>
    </div>
</div>
<div id="navbar-bottom" class="navbar">
    <div class="container">
        
        
        
        
        <div class="row">
            <div class="col-md-3 col-sm-9 col-xs-9">
                <a class="brand" href="/" title="MariaDB">
                    <img src="/kb/static/images/logo-2018-black.95f5978ae14d.png">
                </a>
            </div>
            <div class="col-md-9 hidden-sm hidden-xs">
                <div class="main-menu">
                    <ul id="main-menu" class="nav navbar-nav inline-block-sm">
    <li class="has-sub full-menu">
        <a href="/products" title="Products">Products</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/services" title="Services">Services</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/pricing" title="Pricing">Pricing</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/resources" title="Resources">Resources</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/about-us" title="About Us">About Us</a>
    </li>
    <li class="">
        <a class="button electric-eel small top-bar-right-download" href="/downloads/">Download</a>
    </li>
</ul>
                </div>
            </div>
            <div class="col-md-3 visible-sm visible-xs col-sm-3 col-xs-3 ps-rv">
                <div class="navbar-header text-right pull-right">
                    <button type="button" class="menu-control toggle-menu" id="open-menu">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="main">
    <div class="container">
        

        <div id="subheader1" class="clearfix">
            <div class="pull-left">
                
                <div id="breadcrumbs" class="breadcrumb">
                    <a href="/kb/zh-cn/">Knowledge Base</a>
                    


    
    » <a class="crumb" href="/kb/zh-cn/mariadb/">MariaDB - 简体中文</a>
    

    
    » <a class="crumb" href="/kb/zh-cn/mariadb-server/">MariaDB Server文档</a>
    

    
    » <a class="crumb" href="/kb/zh-cn/standard-replication/">MariaDB复制</a>
    


    » <a class="node_link crumb" href="/kb/zh-cn/replication-threads/">Replication Threads</a>


                </div>
                
            </div>
        </div>
    </div>
    <div class="container" id="container-main">
        <div class="row">
            
            
                
                <aside id="sidebar-first" class="sidebar col-md-2 hidden-xs hidden-sm hidden-print">
                    
                        
                        <ul id="category_menu" class="nav nav-pills nav-stacked">
                            <li><a href="/kb/zh-cn/">首页</a></li>
                            
                                
                                    <li><a href="/kb/zh-cn/+questions/">Open Questions</a></li>
                                
                                <li><a href="/kb/zh-cn/documentation/">MariaDB Server</a></li>
                                <li><a href="/kb/zh-cn/maxscale/">MariaDB MaxScale</a></li>
                                <li><a href="/kb/zh-cn/mariadb-columnstore/">MariaDB ColumnStore</a></li>
                                <li><a href="/kb/zh-cn/connectors/">Connectors</a></li>
                            

                        </ul>
                    

                    
                        <div>
    

<div class="well well-small box actions"><div>

        <a class="btn btn-block btn-small" href="/kb/zh-cn/replication-threads/">Return to article</a>
    
</div>
</div>

</div>
                    

                    

































                </aside>
            
            
            
                
            
            
            <section id="content" class="limited_width col-md-10 clearfix">
                
                    <h1>Replication Threads - Source</h1>
                

                



                <div>
                    

    

    
    <div class="revision_info">
        <dl class="table">
            <dt>Revision</dt>
            <dd><a href="/kb/zh-cn/replication-threads/+r/127259/">127259</a></dd>
            <dt>用户</dt>
            <dd>
<span class="user" id="user-13772">
<a href="/kb/user/id/13772" title="Yingquan He">Yingquan He</a>
</span></dd>
            <dt>Date</dt>
            <dd>

<span class="datetime" title="2023-06-14 02:00">2023-06-14 02:00</span></dd>
        </dl>
    </div>
    


    

    
        
        <textarea id="answer_source" class="creole_source autogrow">&lt;&lt;include slug=&#34;replica_slave&#34;&gt;&gt;
&lt;&lt;toc&gt;&gt;

MariaDB的[[高可用性性能调优Mariadb复制|复制]]实现需要几种类型的线程。

== 主服务器上的线程

主服务器通常只有一种与复制相关的线程：二进制日志转储线程。

如果启用了[[半同步复制|半同步复制]]，则主服务器还具有ACK接收器线程。

=== 二进制日志转储线程

二进制日志转储线程在主服务器上运行，并将[[binary-log | binary log]] 转储到副本。可以通过运行[[show-processlist | SHOW PROCESSLIST]]语句并查找[[thread-command-values | thread command]]为##“Binlog Dump”##的线程来识别此线程。

主服务器为连接到主服务器的每个副本创建一个单独的二进制日志转储线程。可以通过执行[[show-slave-hosts | SHOW SLAVE HOSTS]]语句来确定连接到主服务器的副本。

==== 二进制日志转储线程和关闭过程

当主服务器关闭并经过正常关闭过程时，主服务器以随机顺序终止客户端线程。默认情况下，主服务器也认为其二进制日志转储线程是常规客户端线程。因此，在客户端线程仍然存在时可以终止二进制日志转储线程，这意味着在正常关闭期间可以在主服务器上写入不会被复制的数据。即使使用[[半同步复制|半同步复制]]也是如此。

在MariaDB 10.4及更高版本中，可以通过使用[[mariadb-admin]]实用程序或[[shutdown | SHUTDOWN]]命令关闭服务器并提供特殊选项来解决此问题。

例如，可以通过使用[[mariadb-admin]]实用程序并提供##--wait-for-all-slaves##选项以及使用实用程序执行##shutdown##命令来解决此问题：

&lt;&lt;code&gt;&gt;
mariadb-admin --wait-for-all-slaves shutdown
&lt;&lt;/code&gt;&gt;

或者可以通过使用[[shutdown | SHUTDOWN]]命令关闭服务器并向命令提供##WAIT FOR ALL SLAVES##选项来解决此问题：

&lt;&lt;sql&gt;&gt;
SHUTDOWN WAIT FOR ALL SLAVES;
&lt;&lt;/sql&gt;&gt;

当提供这些特殊选项之一时，服务器仅在所有客户端线程被杀死后才杀死其二进制日志转储线程，并且仅在最后一个[[binary-log | binary log]]已发送到所有连接的副本后才完成关机。

在MariaDB 10.4及更高版本中，仍无法默认启用此行为。这意味着，在使用[[systemd]]或[[sysvinit | sysVinit]]等工具关闭服务器时，当前无法访问此行为。

在MariaDB 10.3及之前版本中，建议在关闭旧的主服务器之前手动将副本切换到新的主服务器。

=== ACK接收器线程

当启用[[半同步复制|半同步复制]]时，半同步副本会向其主服务器发送确认（ACK）以确认它们已接收某个事务。主服务器创建ACK接收器线程以接收这些ACK。

== 副本上的线程

副本有三种与复制相关的线程：副本I/O线程，副本SQL线程和工作线程，这些线程仅在使用[[parallel-replication | parallel replication]]时适用。

当使用[[multi-source-replication | multi-source replication]]时，每个独立的复制连接都有其自己的每种类型的副本线程。

=== 副本I/O线程

副本的I/O线程从主服务器接收[[binary-log | binary log]]事件并将其写入其[[relay-log | relay log]]。

==== 二进制日志位置

可以通过执行[[show-slave-status | SHOW SLAVE STATUS]]语句来检查副本I / O线程的[[binary-log | binary log]]位置。它将显示为## Master_Log_File ##和## Read_Master_Log_Pos ##列。

可以通过使用[[change-master-to | CHANGE MASTER]]语句设置副本I / O线程的[[binary-log | binary log]]位置，并设置[[change-master-to /＃master_log_file | MASTER_LOG_FILE]]和[[change-master-to /＃master_log_pos | MASTER_LOG_POS]]选项。

副本I/O线程的[[binary-log | binary log]]位置和大多数其他[[change-master-to | CHANGE MASTER]]选项的值都写入默认的## master.info ##文件或由[[mysqld-options /＃-master-info-file | master_info_file]]选项配置的文件中。当[[#master_use_gtid | MASTER_USE_GTID]]选项设置为## NO##时，副本I / O线程会在下载事件时保持此[[binary-log | binary log]]位置更新。否则，该文件不会按事件更新。有关更多信息，请参见[[change-master-to /＃option-persistence | CHANGE MASTER TO：Option Persistence]]。

以下是翻译的文本：

=== 副本SQL线程

副本SQL线程从[[relay-log | relay log]]中读取事件。它对它们的处理取决于是否使用[[parallel-replication | parallel replication]]。如果未使用[[parallel-replication | parallel replication]]，则SQL线程将事件应用于其本地数据的副本。如果使用[[parallel-replication | parallel replication]]，则SQL线程将事件移交给其工作线程以并行应用。

==== Relay Log Position

可以通过执行[[show-slave-status | SHOW SLAVE STATUS]]语句来检查副本SQL线程的[[relay-log | relay log]]位置。它将显示为##Relay_Log_File##和##Relay_Log_Pos##列。

可以通过使用[[change-master-to | CHANGE MASTER]]语句设置副本SQL线程的[[relay-log | relay log]]位置，方法是设置[[change-master-to/#relay_log_file | RELAY_LOG_FILE]]和[[change-master-to/#relay_log_pos | RELAY_LOG_POS]]选项。

副本SQL线程的[[relay-log | relay log]]位置写入默认的##relay-log.info##文件或由[[replication-and-binary-log-system-variables/#relay_log_info_file | relay_log_info_file]]系统变量配置的文件中。副本SQL线程在应用事件时会保持此[[relay-log | relay log]]位置更新。有关更多信息，请参见[[change-master-to/#option-persistence | CHANGE MASTER TO：选项持久性]]。

==== Binary Log Position

可以通过执行[[show-slave-status | SHOW SLAVE STATUS]]语句来检查副本SQL线程的当前[[relay-log | relay log]]位置的相应[[binary-log | binary log]]位置。它将显示为##Relay_Master_Log_File##和##Exec_Master_Log_Pos##列。

==== GTID位置

如果副本正在复制包含[[gtid | GTID]]的[[binary-log | binary log]]事件，则[[replication-threads / #replica-sql-thread | 副本SQL线程]]将每个应用于[[mysqlgtid_slave_pos-table | mysql.gtid_slave_pos]]表中的GTID写入。可以通过[[gtid / #gtid_slave_pos | gtid_slave_pos]]系统变量检查和修改此GTID。

如果副本启用了[[replication-and-binary-log-system-variables/#log_slave_updates | log_slave_updates]]系统变量，并且如果副本启用了[[binary-log | binary log]]，则由[[replication-threads / #replica-sql-thread | 副本SQL线程]]写入的每个写入也将进入副本的[[binary-log | binary log]]。这意味着，复制事务的[[gtid | GTIDs]]将反映在[[gtid / #gtid_binlog_pos | gtid_binlog_pos]]系统变量的值中。

有关更多信息，请参见[[change-master-to/#gtid-persistence | CHANGE MASTER TO：GTID Persistence]]。

=== 工作者线程

当使用[[parallel-replication | parallel replication]]时，SQL线程将事件移交给其工作线程以并行应用。</textarea>
    


                    <div id="content_disclaimer" class="graybox">
                        Content reproduced on this site is the property of its respective owners,
                        and this content is not reviewed in advance by MariaDB. The views, information and opinions
                        expressed by this content do not necessarily represent those of MariaDB or any other party.
                    </div>
                </div>
            </section>

            
        </div>
    </div>
</div>

<!-- Footer -->
<footer id="footer">
    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-xs-12">
                    <ul class="list-inline text-center footer-nav">
                        <li>
                            <h5>
                                <a href="https://mariadb.com/products" title="Products">Products</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/services" title="Services">Services</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/pricing" title="Pricing">Pricing</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/resources" title="Resources">Resources</a>
                            </h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/about-us" title="About MariaDB">About Us</a></h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/download" title="Download">Download MariaDB</a></h5>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="row row-10">
                
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div id="block-footerformcontact" class="block block-block-content block-block-contentd754ee1b-3cc9-40e7-9ef4-f504f1197fb1">
                        
                            <h5 style="font-weight: 400;">Subscribe to our newsletter!</h5>
                            <script src="//app-sj15.marketo.com/js/forms2/js/forms2.min.js"></script><form id="mktoForm_1498"></form>
                            <script>
                                <!--//--><![CDATA[// ><!--
                                MktoForms2.loadForm("//app-sj15.marketo.com", "573-PXI-984", 1498);
                                //--><!]]]]><![CDATA[>
                                //--><!]]>
                            </script>
                        
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div class="footer-copyright">
                        <div class="text-center">
                            <ul class="list-inline no-margin">
                                <li>
                                    <a href="/legal" title="Legal">Legal</a>
                                </li>
                                <li>
                                    <a href="/privacy-policy" title="Privacy Policy">Privacy Policy</a>
                                </li>
                                <li>
                                    <a href="/cookie-policy/" title="Cookies">Cookie Policy</a>
                                </li>
                            </ul>
                            <p>Copyright &copy; 2024 MariaDB. All rights reserved.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</footer>
</div>

<div id="ajax_loading">
    <img src="/kb/static/images/ajax-loader.a51c5608d01a.gif" />
</div>

    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MK2847"
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MK2847');</script>
    <!-- End Google Tag Manager -->

</body>

<script type="text/javascript" src="/kb/static/js/main.1587e3a666fc.js" charset="utf-8"></script>

</html>