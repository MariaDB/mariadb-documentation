<!DOCTYPE html>
<html>
<head data-cookie-domain=""
      data-cookie-path="/">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="apple-touch-icon" sizes="180x180" href="/kb/static/images/favicons/apple-touch-icon.159e713979be.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/kb/static/images/favicons/favicon-32x32.bc0ac1d5d11e.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/kb/static/images/favicons/favicon-16x16.5801f8f0f34e.png">
    <link rel="shortcut icon" href="/kb/static/images/favicons/favicon.d122d305dee4.ico" type="image/x-icon" />

    <title>How to Quickly Insert Data Into MariaDB - Source - MariaDB Knowledge Base</title>

    <link href="/kb/static/css/main.f7633538c846.css" rel="stylesheet" type="text/css" />

    
        <meta name="robots" content="noindex, nofollow">
    

    

    <!-- FB Open Graph tags -->
    <meta property="og:title" content="How to Quickly Insert Data Into MariaDB - Source" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://mariadb.com/kb/zh-cn/how-to-quickly-insert-data-into-mariadb/+source/" />
    <meta property="og:image" content="http://mariadb.comaskmonty-logo.png" />
    <meta property="og:site_name" content="MariaDB KnowledgeBase" />
    <meta property="fb:admins" content="514852603" />
    <meta property="og:description" content="" />

    <meta name="description" content="" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet"/>
    
</head>
<body class="mpkb nodes autoresize nodes_source jqui" id="nodes_source">





<div id="menu-mobile" class="visible-sm visible-xs">

    <div>
        <div id="mobile-close-menu" class="text-right">
            <a href="javascript:void(0)" title="Close Menu" id="back-main" class="toggle-menu">X<span></span></a>
        </div>
    </div>
    <div class="mainmenu-mobile">
        <ul class="ls-none ul-menu">
            <li data-sub="submenu5"><a class="open-form-search" href="/kb/search/" title="Search">Search </a></li>
            <li data-sub="submenu0"><a href="/products" title="Products">Products</a><span class="arrow-main"></span></li>
            <li data-sub="submenu1"><a href="/services" title="Services">Services</a><span class="arrow-main"></span></li>
            <li data-sub="submenu2"><a href="/resources" title="Resources">Resources</a><span class="arrow-main"></span></li>
            <li data-sub="submenu3"><a href="/about-us" title="About">About</a><span class="arrow-main"></span></li>
            <li data-sub="submenu4"><a href="/contact" title="Contact">Contact</a></li>
        </ul>
    </div>

    <div class="nav-top-mobile">
        <div class="select-box form">

            <ul class="inline-block-md mb-none top-nav">
                <li>

                </li>
                
                    <li>
                        <a href="/kb/user/login?next=/kb/zh-cn/how-to-quickly-insert-data-into-mariadb/+source/"> Login</a>
                    </li>
                
            </ul>



        </div>
        <p class="text-center copyright">Copyright &copy; 2025 MariaDB. All rights reserved.</p>
    </div>
</div>
<div class="violator-wrap d-none" id="top_violator">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12">
                <div class="violator-outer">
                    <div class="violator-inner">
                        <div class="row">
                            <div class="col-xs-12 col-sm-9 col-lg-7 col-lg-offset-2" id="top_violator_content">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="content-link" target="_blank" rel="nofollow noreferrer">
                                    <span>The Ultimate Guide to High Availability with MariaDB</span>
                                </a>
                            </div>
                            <div class="col-xs-12 col-sm-3" id="top_violator_cta">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="btn btn-mariadb" target="_blank" rel="nofollow noreferrer">Download Now</a>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-link close-btn">
                        <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24" width="15px" height="15px"><path d="M 4.9902344 3.9902344 A 1.0001 1.0001 0 0 0 4.2929688 5.7070312 L 10.585938 12 L 4.2929688 18.292969 A 1.0001 1.0001 0 1 0 5.7070312 19.707031 L 12 13.414062 L 18.292969 19.707031 A 1.0001 1.0001 0 1 0 19.707031 18.292969 L 13.414062 12 L 19.707031 5.7070312 A 1.0001 1.0001 0 0 0 18.980469 3.9902344 A 1.0001 1.0001 0 0 0 18.292969 4.2929688 L 12 10.585938 L 5.7070312 4.2929688 A 1.0001 1.0001 0 0 0 4.9902344 3.9902344 z"/></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="wrapper">
<div id="top-nav">
    <div class="container">
        <ul class="hidden-sm hidden-xs" >
            <li><a href="https://mariadb.com/kb/">Knowledge Base</a></li>
            <li><a href="https://mariadb.com/contact/">Contact</a></li>
            
                
                    <li>
                        <a href="/kb/user/login?next=/kb/zh-cn/how-to-quickly-insert-data-into-mariadb/+source/" rel="nofollow">Login</a>
                    </li>
                
            
            
            <li id="search-form">
                <form action="/kb/zh-cn/+search/" method="get" id="search-block-form" accept-charset="UTF-8">
                    <input id="search" title="Enter the terms you wish to search for."
                           placeholder="Search . . ." type="text"
                           name="q" value="" size="15" maxlength="128" class="form-text"
                           data-autocomplete-url="/kb/zh-cn/+search/autocomplete/">
                    <input type="hidden" name="quick" value="1" />
                    <input type="hidden" name="source" value="kb" />
                </form>
            </li>
            <li><a id="search-toggler" href="/kb/search/">Search</a></li>
            
        </ul>
    </div>
</div>
<div id="navbar-bottom" class="navbar">
    <div class="container">
        
        
        
        
        <div class="row">
            <div class="col-md-3 col-sm-9 col-xs-9">
                <a class="brand" href="/" title="MariaDB">
                    <img src="/kb/static/images/logo-2018-black.95f5978ae14d.png">
                </a>
            </div>
            <div class="col-md-9 hidden-sm hidden-xs">
                <div class="main-menu">
                    <ul id="main-menu" class="nav navbar-nav inline-block-sm">
    <li class="has-sub full-menu">
        <a href="/products" title="Products">Products</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/services" title="Services">Services</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/pricing" title="Pricing">Pricing</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/resources" title="Resources">Resources</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/about-us" title="About Us">About Us</a>
    </li>
    <li class="">
        <a class="button electric-eel small top-bar-right-download" href="/downloads/">Download</a>
    </li>
</ul>
                </div>
            </div>
            <div class="col-md-3 visible-sm visible-xs col-sm-3 col-xs-3 ps-rv">
                <div class="navbar-header text-right pull-right">
                    <button type="button" class="menu-control toggle-menu" id="open-menu">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="main">
    <div class="container">
        

        <div id="subheader1" class="clearfix">
            <div class="pull-left">
                
                <div id="breadcrumbs" class="breadcrumb">
                    <a href="/kb/zh-cn/">Knowledge Base</a>
                    


    
    » <a class="crumb" href="/kb/zh-cn/mariadb/">MariaDB - 简体中文</a>
    

    
    » <a class="crumb" href="/kb/zh-cn/mariadb-server/">MariaDB Server文档</a>
    


    » <a class="node_link crumb" href="/kb/zh-cn/how-to-quickly-insert-data-into-mariadb/">How to Quickly Insert Data Into MariaDB</a>


                </div>
                
            </div>
        </div>
    </div>
    <div class="container" id="container-main">
        <div class="row">
            
            
                
                <aside id="sidebar-first" class="sidebar col-md-2 hidden-xs hidden-sm hidden-print">
                    
                        
                        <ul id="category_menu" class="nav nav-pills nav-stacked">
                            <li><a href="/kb/zh-cn/">首页</a></li>
                            
                                
                                <li><a href="/kb/zh-cn/documentation/">MariaDB Server</a></li>
                                <li><a href="/kb/zh-cn/maxscale/">MariaDB MaxScale</a></li>
                                <li><a href="/kb/zh-cn/mariadb-columnstore/">MariaDB ColumnStore</a></li>
                                <li><a href="/kb/zh-cn/connectors/">Connectors</a></li>
                            

                        </ul>
                    

                    
                        <div>
    

<div class="well well-small box actions"><div>

        <a class="btn btn-block btn-small" href="/kb/zh-cn/how-to-quickly-insert-data-into-mariadb/">Return to article</a>
    
</div>
</div>

</div>
                    

                    

































                </aside>
            
            
            
                
            
            
            <section id="content" class="limited_width col-md-10 clearfix">
                
                    <h1>How to Quickly Insert Data Into MariaDB - Source</h1>
                

                



                <div>
                    

    

    
    <div class="revision_info">
        <dl class="table">
            <dt>Revision</dt>
            <dd><a href="/kb/zh-cn/how-to-quickly-insert-data-into-mariadb/+r/68206/">68206</a></dd>
            <dt>用户</dt>
            <dd>
<span class="user" id="user-5480">
<a href="/kb/user/id/5480" title="longshuai Ma">longshuai Ma</a>
</span></dd>
            <dt>Date</dt>
            <dd>

<span class="datetime" title="2018-04-19 08:35">2018-04-19 08:35</span></dd>
        </dl>
    </div>
    


    

    
        
        <textarea id="answer_source" class="creole_source autogrow">&lt;&lt;toc&gt;&gt;

本文介绍了向MariaDB中快速插入数据的几种不同技术。

== 背景

当要向MariaDB中插入新的数据时，以下过程会影响插入所消耗的时间：(按时间消耗长短降序排序)

* 将数据sync到磁盘上(它是事务结束的一部分)
* 添加新的键值。索引越大，更新键值所消耗的时间就越长。
* 检查外键约束(如果存在)。
* 将行添加到存储引擎中。
* 将待插入数据发送给服务器。

下面介绍几种向表中快速插入数据的技术(按效率的提升程度降序排序)。

== 1.禁用索引(key)

你可以临时禁用非唯一索引。特别是在表中数据很少甚至没有数据的时候，禁用非唯一索引可以极大提升插入速度。

&lt;&lt;code&gt;&gt;
ALTER TABLE table_name DISABLE KEYS;
BEGIN;
... inserting data with INSERT or LOAD DATA ....
COMMIT;
ALTER TABLE table_name ENABLE KEYS;
&lt;&lt;/code&gt;&gt;

多数存储引擎(至少MyISAM和Aria是如此)的##ENABLE KEYS##会扫描表中的行并收集索引键值，然后对它们排序，最后创建索引块。因此，先禁用KEY，插入数据后启用KEY的整体速度比每行都更新一次索引的速度至少要快一个数量级，并且所需要的buffer也更少。

&lt;&lt;style class=&#34;bluebox&#34;&gt;&gt;
**注意：**当使用##[[insert|INSERT]]##或
##[[load-data-infile|LOAD DATA]]##向**空表**中插入数据时，MariaDB会**自动**先##[[alter-table|DISABLE KEYS]]##，插入成功后再**自动**##[[alter-table|ENABLE KEYS]]##。
&lt;&lt;/style&gt;&gt;

当插入海量数据时，花在完整性检查上的时间也会很长。可以通过设置系统变量##[[server-system-variables#unique_checks|unique_checks]]##和##[[server-system-variables#foreign_key_checks|foreign_key_checks]]##来禁用##UNIQUE##索引以及[[foreign-keys|foreign keys]]约束对数据的检查：

&lt;&lt;code&gt;&gt;
SET @@session.unique_checks = 0;
SET @@session.foreign_key_checks = 0;
&lt;&lt;/code&gt;&gt;

对于XtraDB/InnoDB表，可以临时将[[auto_increment-handling-in-xtradbinnodb|AUTO_INCREMENT lock mode]]设置为2，如下：

&lt;&lt;code&gt;&gt;
SET @@global.innodb_autoinc_lock_mode = 2;
&lt;&lt;/code&gt;&gt;

此外，如果表上有[[triggers|INSERT触发器]]，或者##[[virtual-columns|PERSISTENT]]##字段，可以先删除它们，在数据插入完成之后再重建它们。

== 2.Loading text files

向MariaDB中插入数据**最快的方式**是使用##[[load-data-infile|LOAD DATA INFILE]]##命令。

该命令最简单的格式为：

&lt;&lt;sql&gt;&gt;
LOAD DATA INFILE &#39;file_name&#39; INTO TABLE table_name;
&lt;&lt;/sql&gt;&gt;

可以使用下面的语句来读取客户端所在机器上的文件并插入到MariaDB服务器上：

&lt;&lt;sql&gt;&gt;
LOAD DATA LOCAL INFILE &#39;file_name&#39; INTO TABLE table_name;
&lt;&lt;/sql&gt;&gt;

从客户端上读取文件的速度比直接在服务端上读取文件的速度要慢一些，但差距不会很大。

##LOAD DATA INFILE##之所以很快，是因为：

# 不需要解析SQL语句。
# 读取数据时可以一次读取很多个数据块。
# 如果load data之前表是空的，则所有的非唯一索引都会先禁用，插入数据成功后才启用。
# 它会告诉存储引擎先缓存一些行的数据，达到一定数量后再一次性插入到表中(至少MyISAM和Aria存储引擎支持该行为)。
# 对于空表，某些事务性引擎(如Aria)不会记录数据插入的事务日志，因为我们可以随时通过truncate操作来回滚。

由于以上速度优势，当你需要插入**大量**数据的时候，你可以先创建一个本地数据文件，然后使用##LOAD DATA INFILE##来插入它们，这比直接##INSERT##要快。

在MariaDB 5.3中，你还能看到##LOAD DATA INFILE##的进度报告[[progress-reporting|progress reporting]]。

=== 2.1 mysqlimport

你可以使用[[mysqlimport]]并行导入多个文件。例如：

&lt;&lt;sql&gt;&gt;
mysqlimport --use-threads=10 database text-file-name [text-file-name...]
&lt;&lt;/sql&gt;&gt;

[[mysqlimport]]内部会使用[[load-data-infile|LOAD DATA INFILE]]来读取数据并插入数据，因此速度也非常快。

== 3.使用INSERT语句插入数据

=== 3.1 使用大事务(Using big transactions)

当需要使用单行insert语句(一次插入一行)插入数据时，可以将它们放进##BEGIN / END##中，从而避免每行一次事务(意味着每行都需要将数据sync到磁盘)。例如，每个begin/end中包含1000次insert，这至少提升1000倍插入效率。

&lt;&lt;sql&gt;&gt;
BEGIN;
INSERT ...
INSERT ...
END;
BEGIN;
INSERT ...
INSERT ...
END;
...
&lt;&lt;/sql&gt;&gt;

之所以上面使用了多个BEGIN/END语句而不是一个BEGIN/END的原因是前者会占用更少的事务日志空间。

=== 3.2 insert语句的多值插入

你可以使用insert语句一次性插入多行数据：

&lt;&lt;sql&gt;&gt;
INSERT INTO table_name values(1,&#34;row 1&#34;),(2, &#34;row 2&#34;),...;
&lt;&lt;/sql&gt;&gt;

系统变量##[[mysqld-options-full-list|max_allowed_packet]]##控制了该语句允许的最大行数量。

== 4.同时向多个表中插入数据(Inserting data into several tables at once)

如果你想一次性向多个表中插入数据，最好的方法是使用多行语句并且一次性发送给服务端：

&lt;&lt;sql&gt;&gt;
INSERT INTO table_name_1 (auto_increment_key, data) VALUES (NULL,&#34;row 1&#34;);
INSERT INTO table_name_2 (auto_increment, reference, data) values (NULL, LAST_INSERT_ID(), &#34;row 2&#34;);
&lt;&lt;/sql&gt;&gt;

##[[last_insert_id|LAST_INSERT_ID()]]##函数回返回##auto_increment##的最后一个值。

默认情况下，客户端##mysql##命令会将上面的语句按一个整体发送给服务端。

可以通过下面的方式来测试##mysql##的行为：

&lt;&lt;code&gt;&gt;
delimiter ;;
select 1; select 2;;
delimiter ;
&lt;&lt;/code&gt;&gt;

&lt;&lt;style class=&#34;bluebox&#34;&gt;&gt;
**note:** for multi-query statements to work, your client must specify the
##CLIENT_MULTI_STATEMENTS## flag to ##mysql_real_connect()##.
&lt;&lt;/style&gt;&gt;

== 5.可以优化插入速度的服务器变量

&lt;&lt;style class=&#34;darkheader-nospace-borders&#34;&gt;&gt;
|= Option                     |= Description
| ##[[xtradbinnodb-server-system-variables#innodb_buffer_pool_size|innodb_buffer_pool_size]]## | 如果你的InnoDB/XtraDB表中有多个索引，可增大该值|
| ##[[myisam-system-variables#key_buffer_size|key_buffer_size]]##         | 如果你的MyISAM表中有多个索引，可增大该值|
| ##[[server-system-variables#max_allowed_packet|max_allowed_packet]]##      | 增大该值以允许insert语句可以一次性插入更多的行(即增加insert语句中括号的个数)|
| ##[[server-system-variables#read_buffer_size|read_buffer_size]]##          | ##LOAD DATA##读取文件时的块大小|
&lt;&lt;/style&gt;&gt;

完整的服务变量，可参见[[mysqld-options-full-list|mysqld options]]。</textarea>
    


                    <div id="content_disclaimer" class="graybox">
                        Content reproduced on this site is the property of its respective owners,
                        and this content is not reviewed in advance by MariaDB. The views, information and opinions
                        expressed by this content do not necessarily represent those of MariaDB or any other party.
                    </div>
                </div>
            </section>

            
        </div>
    </div>
</div>

<!-- Footer -->
<footer id="footer">
    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-xs-12">
                    <ul class="list-inline text-center footer-nav">
                        <li>
                            <h5>
                                <a href="https://mariadb.com/products" title="Products">Products</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/services" title="Services">Services</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/pricing" title="Pricing">Pricing</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/resources" title="Resources">Resources</a>
                            </h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/about-us" title="About MariaDB">About Us</a></h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/download" title="Download">Download MariaDB</a></h5>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="row row-10">
                
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div id="block-footerformcontact" class="block block-block-content block-block-contentd754ee1b-3cc9-40e7-9ef4-f504f1197fb1">
                        
                            <h5 style="font-weight: 400;">Subscribe to our newsletter!</h5>
                            <script src="//app-sj15.marketo.com/js/forms2/js/forms2.min.js"></script><form id="mktoForm_1498"></form>
                            <script>
                                <!--//--><![CDATA[// ><!--
                                MktoForms2.loadForm("//app-sj15.marketo.com", "573-PXI-984", 1498);
                                //--><!]]]]><![CDATA[>
                                //--><!]]>
                            </script>
                        
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div class="footer-copyright">
                        <div class="text-center">
                            <ul class="list-inline no-margin">
                                <li>
                                    <a href="/legal" title="Legal">Legal</a>
                                </li>
                                <li>
                                    <a href="/privacy-policy" title="Privacy Policy">Privacy Policy</a>
                                </li>
                                <li>
                                    <a href="/cookie-policy/" title="Cookies">Cookie Policy</a>
                                </li>
                            </ul>
                            <p>Copyright &copy; 2025 MariaDB. All rights reserved.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</footer>
</div>

<div id="ajax_loading">
    <img src="/kb/static/images/ajax-loader.a51c5608d01a.gif" />
</div>

    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MK2847"
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MK2847');</script>
    <!-- End Google Tag Manager -->

</body>

<script type="text/javascript" src="/kb/static/js/main.1587e3a666fc.js" charset="utf-8"></script>

</html>