<!DOCTYPE html>
<html>
<head data-cookie-domain=""
      data-cookie-path="/">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="apple-touch-icon" sizes="180x180" href="/kb/static/images/favicons/apple-touch-icon.159e713979be.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/kb/static/images/favicons/favicon-32x32.bc0ac1d5d11e.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/kb/static/images/favicons/favicon-16x16.5801f8f0f34e.png">
    <link rel="shortcut icon" href="/kb/static/images/favicons/favicon.d122d305dee4.ico" type="image/x-icon" />

    <title>Aria 存储引擎 - Source - MariaDB Knowledge Base</title>

    <link href="/kb/static/css/main.f7633538c846.css" rel="stylesheet" type="text/css" />

    
        <meta name="robots" content="noindex, nofollow">
    

    

    <!-- FB Open Graph tags -->
    <meta property="og:title" content="Aria 存储引擎 - Source" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://mariadb.com/kb/zh-cn/aria-storage-engine/+source/" />
    <meta property="og:image" content="http://mariadb.comaskmonty-logo.png" />
    <meta property="og:site_name" content="MariaDB KnowledgeBase" />
    <meta property="fb:admins" content="514852603" />
    <meta property="og:description" content="" />

    <meta name="description" content="" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet"/>
    
</head>
<body class="mpkb nodes autoresize nodes_source jqui" id="nodes_source">





<div id="menu-mobile" class="visible-sm visible-xs">

    <div>
        <div id="mobile-close-menu" class="text-right">
            <a href="javascript:void(0)" title="Close Menu" id="back-main" class="toggle-menu">X<span></span></a>
        </div>
    </div>
    <div class="mainmenu-mobile">
        <ul class="ls-none ul-menu">
            <li data-sub="submenu5"><a class="open-form-search" href="/kb/search/" title="Search">Search </a></li>
            <li data-sub="submenu0"><a href="/products" title="Products">Products</a><span class="arrow-main"></span></li>
            <li data-sub="submenu1"><a href="/services" title="Services">Services</a><span class="arrow-main"></span></li>
            <li data-sub="submenu2"><a href="/resources" title="Resources">Resources</a><span class="arrow-main"></span></li>
            <li data-sub="submenu3"><a href="/about-us" title="About">About</a><span class="arrow-main"></span></li>
            <li data-sub="submenu4"><a href="/contact" title="Contact">Contact</a></li>
        </ul>
    </div>

    <div class="nav-top-mobile">
        <div class="select-box form">

            <ul class="inline-block-md mb-none top-nav">
                <li>

                </li>
                
                    <li>
                        <a href="/kb/user/login?next=/kb/zh-cn/aria-storage-engine/+source/"> Login</a>
                    </li>
                
            </ul>



        </div>
        <p class="text-center copyright">Copyright &copy; 2025 MariaDB. All rights reserved.</p>
    </div>
</div>
<div class="violator-wrap d-none" id="top_violator">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12">
                <div class="violator-outer">
                    <div class="violator-inner">
                        <div class="row">
                            <div class="col-xs-12 col-sm-9 col-lg-7 col-lg-offset-2" id="top_violator_content">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="content-link" target="_blank" rel="nofollow noreferrer">
                                    <span>The Ultimate Guide to High Availability with MariaDB</span>
                                </a>
                            </div>
                            <div class="col-xs-12 col-sm-3" id="top_violator_cta">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="btn btn-mariadb" target="_blank" rel="nofollow noreferrer">Download Now</a>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-link close-btn">
                        <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24" width="15px" height="15px"><path d="M 4.9902344 3.9902344 A 1.0001 1.0001 0 0 0 4.2929688 5.7070312 L 10.585938 12 L 4.2929688 18.292969 A 1.0001 1.0001 0 1 0 5.7070312 19.707031 L 12 13.414062 L 18.292969 19.707031 A 1.0001 1.0001 0 1 0 19.707031 18.292969 L 13.414062 12 L 19.707031 5.7070312 A 1.0001 1.0001 0 0 0 18.980469 3.9902344 A 1.0001 1.0001 0 0 0 18.292969 4.2929688 L 12 10.585938 L 5.7070312 4.2929688 A 1.0001 1.0001 0 0 0 4.9902344 3.9902344 z"/></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="wrapper">
<div id="top-nav">
    <div class="container">
        <ul class="hidden-sm hidden-xs" >
            <li><a href="https://mariadb.com/kb/">Knowledge Base</a></li>
            <li><a href="https://mariadb.com/contact/">Contact</a></li>
            
                
                    <li>
                        <a href="/kb/user/login?next=/kb/zh-cn/aria-storage-engine/+source/" rel="nofollow">Login</a>
                    </li>
                
            
            
            <li id="search-form">
                <form action="/kb/zh-cn/+search/" method="get" id="search-block-form" accept-charset="UTF-8">
                    <input id="search" title="Enter the terms you wish to search for."
                           placeholder="Search . . ." type="text"
                           name="q" value="" size="15" maxlength="128" class="form-text"
                           data-autocomplete-url="/kb/zh-cn/+search/autocomplete/">
                    <input type="hidden" name="quick" value="1" />
                    <input type="hidden" name="source" value="kb" />
                </form>
            </li>
            <li><a id="search-toggler" href="/kb/search/">Search</a></li>
            
        </ul>
    </div>
</div>
<div id="navbar-bottom" class="navbar">
    <div class="container">
        
        
        
        
        <div class="row">
            <div class="col-md-3 col-sm-9 col-xs-9">
                <a class="brand" href="/" title="MariaDB">
                    <img src="/kb/static/images/logo-2018-black.95f5978ae14d.png">
                </a>
            </div>
            <div class="col-md-9 hidden-sm hidden-xs">
                <div class="main-menu">
                    <ul id="main-menu" class="nav navbar-nav inline-block-sm">
    <li class="has-sub full-menu">
        <a href="/products" title="Products">Products</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/solutions" title="Solutions">Solutions</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/resources" title="Resources">Resources</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/about-us" title="Company">Company</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/pricing" title="Pricing">Pricing</a>
    </li>
    
    <li class="">
        <a class="button electric-eel small top-bar-right-download" href="/downloads/">Download</a>
    </li>
</ul>
                </div>
            </div>
            <div class="col-md-3 visible-sm visible-xs col-sm-3 col-xs-3 ps-rv">
                <div class="navbar-header text-right pull-right">
                    <button type="button" class="menu-control toggle-menu" id="open-menu">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="main">
    <div class="container">
        

        <div id="subheader1" class="clearfix">
            <div class="pull-left">
                
                <div id="breadcrumbs" class="breadcrumb">
                    <a href="/kb/zh-cn/">Knowledge Base</a>
                    


    
    » <a class="crumb" href="/kb/zh-cn/mariadb/">MariaDB - 简体中文</a>
    


    » <a class="node_link crumb" href="/kb/zh-cn/aria-storage-engine/">Aria 存储引擎</a>


                </div>
                
            </div>
        </div>
    </div>
    <div class="container" id="container-main">
        <div class="row">
            
            
                
                <aside id="sidebar-first" class="sidebar col-md-2 hidden-xs hidden-sm hidden-print">
                    
                        
                        <ul id="category_menu" class="nav nav-pills nav-stacked">
                            <li><a href="/kb/zh-cn/">首页</a></li>
                            
                                
                                <li><a href="/kb/zh-cn/documentation/">MariaDB Server</a></li>
                                <li><a href="/kb/zh-cn/maxscale/">MariaDB MaxScale</a></li>
                                <li><a href="/kb/zh-cn/mariadb-columnstore/">MariaDB ColumnStore</a></li>
                                <li><a href="/kb/zh-cn/connectors/">Connectors</a></li>
                            

                        </ul>
                    

                    
                        <div>
    

<div class="well well-small box actions"><div>

        <a class="btn btn-block btn-small" href="/kb/zh-cn/aria-storage-engine/">Return to article</a>
    
</div>
</div>

</div>
                    

                    

































                </aside>
            
            
            
                
            
            
            <section id="content" class="limited_width col-md-10 clearfix">
                
                    <h1>Aria 存储引擎 - Source</h1>
                

                



                <div>
                    

    

    
    <div class="revision_info">
        <dl class="table">
            <dt>Revision</dt>
            <dd><a href="/kb/zh-cn/aria-storage-engine/+r/127177/">127177</a></dd>
            <dt>用户</dt>
            <dd>
<span class="user" id="user-1257">
<a href="/kb/user/id/1257" title="hei yingzi">hei yingzi</a>
</span></dd>
            <dt>Date</dt>
            <dd>

<span class="datetime" title="2023-06-12 03:19">2023-06-12 03:19</span></dd>
        </dl>
    </div>
    


    

    
        
        <textarea id="answer_source" class="creole_source autogrow">&lt;&lt;toc&gt;&gt;
[[Aria]] 存储引擎从 MariaDB 5.1 开始默认编译，并且在启动 MariaDB 时需要“使用”。

从 MariaDB 10.4 开始，所有 [[system-tables|系统表]] 都是 Aria。

此外，内部磁盘上的表格使用 Aria 表格格式而不是 [[MyISAM]] 表格格式。这应该会加速一些 [[group-by|GROUP BY]] 和 [[count-distinct|DISTINCT]] 查询，因为 Aria 具有比 MyISAM 更好的缓存。

&lt;&lt;style class=&#34;greenbox&#34;&gt;&gt;
注意：**//Aria//** 存储引擎以前称为 //**Maria**//（有关重命名的详细信息，请参见[[the-aria-name|Aria 名称]]），并且在以前版本的 [[MariaDB]] 中，该引擎仍然被称为 Maria。
&lt;&lt;/style&gt;&gt;

在 [[create-table|CREATE TABLE]] 和 [[alter-table|ALTER TABLE]] 中，Aria 表格的以下选项：

* **##TRANSACTIONAL= 0 {{{|}}} 1##：** 如果为 Aria 表格设置了 ##TRANSACTIONAL## 表格选项，则该表格将是崩溃安全的。这是通过将表格的任何更改记录到 Aria 的事务日志中并在语句结束时同步这些写入来实现的。这将略微减慢写入和更新速度。但是，好处是如果服务器在语句结束之前崩溃，则所有非持久性更改将回滚到语句开始时的状态。这还需要每行和键存储事务 ID（以允许并发插入和选择）多达 6 个字节。
** 对于分区表不支持 ##TRANSACTIONAL=1##。
** Aria 表格的 ##TRANSACTIONAL## 表格选项默认值取决于表格的 ##ROW_FORMAT## 表格选项的值。有关更多详细信息，请参见下文。
** 如果为 Aria 表格设置了 ##TRANSACTIONAL## 表格选项，则该表格实际上不支持事务。有关更多信息，请参见 MDEV-21364。在此上下文中，“事务”只是指“崩溃安全”。
* **##PAGE_CHECKSUM= 0 {{{|}}} 1##：** 如果索引和数据应使用页面校验和以获得额外的安全性。
* **##TABLE_CHECKSUM= 0 {{{|}}} 1##：** 与 MySQL 5.1 中的 ##CHECKSUM## 相同
* **##ROW_FORMAT=PAGE {{{|}}} FIXED {{{|}}} DYNAMIC##：** 表格的 [[aria-storage-formats|行格式]]。
** 默认值为 ##PAGE##。
** 要模拟 MyISAM，请设置 ##ROW_FORMAT=FIXED## 或 ##ROW_FORMAT=DYNAMIC##

##TRANSACTIONAL## 和 ##ROW_FORMAT## 表格选项的交互如下：

* 如果设置了 ##TRANSACTIONAL=1##，则仅支持 ##PAGE## 行格式。如果将 ##ROW_FORMAT## 设置为其他某个值，则 Aria 将发出警告，但仍将强制行格式为 ##PAGE##。
* 如果设置了 ##TRANSACTIONAL=0##，则该表格将不具备崩溃安全性，并且支持任何行格式。
* 如果未设置 ##TRANSACTIONAL## 的任何值，则支持任何行格式。如果设置了 ##ROW_FORMAT##，则表格将使用该行格式。否则，表格将使用默认的 ##PAGE## 行格式。在这种情况下，如果表格使用了 ##PAGE## 行格式，则它将是崩溃安全的。如果它使用其他某些行格式，则它将不具备崩溃安全性。

其他一些改进包括：

* [[checksum-table|CHECKSUM TABLE]] 现在忽略空字段中的值。这使得 ##CHECKSUM TABLE## 更快，并修复了某些情况下，相同的表定义可能会根据 [[aria-storage-formats|行格式]] 给出不同的校验和值的情况。缺点是该值现在与其他 MySQL 安装不同。新的校验和计算对所有使用默认计算方式和内部计算校验和的 MyISAM 表格引擎都是固定的。注意：具有内部校验和的旧 MyISAM 表格将返回与之前相同的校验和。要根据新规则进行计算以修复它们，您必须执行 ##[[alter-table|ALTER TABLE]]##。您可以使用选项 &lt;&lt;code&gt;&gt;--old&lt;&lt;/code&gt;&gt; 以 mariadbd//mysqld 或在执行 ##CHECKSUM TABLE ...  EXTENDED;## 时将系统变量 &#39;##@@old##&#39; 设置为 ##1## 来使用旧的计算校验和的方法。
* 在启动时，Aria 将检查 Aria 日志，并在服务器未正确关闭时自动从最后一个检查点恢复表格。请参见[[#aria-log-files|Aria 日志文件]]

== Aria 的启动选项

有关完整列表，请参见[[aria-server-system-variables|Aria 系统变量]]。

在正常操作中，您需要考虑的唯一变量是：

* [[aria-server-system-variables#aria_pagecache_buffer_size|aria-pagecache-buffer-size]]
** 这是所有索引和数据页面缓存的位置。这个值越大，Aria 就越快。
*[[[aria-server-system-variables#aria_block_size|aria-block-size]]
** 默认值 8192 对于大多数情况来说应该是可以的。更高的值唯一的问题在于，在块中查找打包键需要更长时间，因为必须搜索大约 8192/2 才能找到每个键。我们计划通过在页面末尾添加一个字典来解决这个问题，以便在开始扫描之前能够在块内进行二进制搜索。在完成此操作并且即使您没有击中磁盘，关键查找也需要太长时间时，您应该考虑将其缩小。
** 可以尝试的可能值为 ##2048##、##4096## 或 ##8192##
** 请注意，您不能更改此值而不进行转储、删除旧表格并删除所有日志文件，然后恢复您的 Aria 表格。（这是唯一需要转储和加载的选项）
* [[aria-server-system-variables#aria_log_purge_type|aria-log-purge-type]]
** 如果要保留事务日志的副本（作为额外备份），请将其设置为 &#34;##at_flush##&#34;。日志将保留直到您执行 [[flush|FLUSH ENGINE LOGS]]。

== Aria 日志文件

##aria_log_control## 文件是一个非常短的日志文件（52 字节），其中包含与日志记录和检查点相关的所有 Aria 表格的当前状态。特别地，它包含以下信息：
&lt;&lt;code&gt;&gt;
Aria 文件版本：1
块大小：8192
maria_uuid：ee948482-6cb7-11ed-accb-3c7c3ff16468
last_checkpoint_lsn：(1,0x235a)
last_log_number：1
trid：28
recovery_failures：0
&lt;&lt;/code&gt;&gt;

* ##uuid## 是每个系统的唯一标识符。所有创建的 Aria 文件都将在其 .MAI 标头中拥有此标识符的副本。这主要用于检查是否有人在 MariaDB 服务器之间复制了 Aria 文件。
* ##last_checkpoint_lsn## 和 ##last_log_number## 是有关当前 aria_log 文件的信息。
* ##trid## 是迄今为止看到的最高事务编号。用于恢复。

##aria_log.*## 文件包含更改 Aria 文件（包括创建表、删除表、插入等）的所有操作的日志。这是一个“正常”的 WAL（预写式日志），类似于 InnoDB 日志文件，只是 aria_logs 包含了重做和撤销。当旧的 aria_log 文件不再需要时，它们会自动删除（最后一个检查点或任何正在运行的事务不再需要引用旧数据）。

=== 缺少有效 ID
错误 ##Missing valid id at start of file. File is not a valid aria control file## 意味着某些东西覆盖了文件中至少前 4 个字节。这可能是由于文件系统（硬件或软件）的问题，或者是一个 bug，其中 MariaDB 内部的线程写入了错误的文件描述符（在这种情况下，您应该 [[reporting-bugs|报告此 bug]]，并附上控制文件的副本以进行协助）。

在关机的情况下，如果出现损坏的日志文件，则应该能够通过删除所有 aria_log 文件来修复该问题。
如果控制文件损坏，则必须删除 aria_control_file 和所有 aria_log.* 文件。
这样做的效果是，在打开 Aria 表格时，服务器将认为它已从另一个系统移动，并自动检查和修复它。如果没有问题，表格将被打开，并可以像往常一样使用。也请参见 [[aria-faq/#when-is-it-safe-to-remove-old-log-files|什么时候可以安全地删除旧日志文件]]。

== 另请参阅
* [[aria-faq|Aria 常见问题解答]]</textarea>
    


                    <div id="content_disclaimer" class="graybox">
                        Content reproduced on this site is the property of its respective owners,
                        and this content is not reviewed in advance by MariaDB. The views, information and opinions
                        expressed by this content do not necessarily represent those of MariaDB or any other party.
                    </div>
                </div>
            </section>

            
        </div>
    </div>
</div>

<!-- Footer -->
<footer id="footer">
    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-xs-12">
                    <ul class="list-inline text-center footer-nav">
                        <li>
                            <h5>
                                <a href="https://mariadb.com/products" title="Products">Products</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/solutions" title="Solutions">Solutions</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/resources" title="Resources">Resources</a>
                            </h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/about-us" title="About MariaDB">Company</a></h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/pricing" title="Pricing">Pricing</a>
                            </h5>
                        </li>
                        
                        
                        <li>
                            <h5><a href="https://mariadb.com/downloads" title="Download">Download MariaDB</a></h5>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="row row-10">
                
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div id="block-footerformcontact" class="block block-block-content block-block-contentd754ee1b-3cc9-40e7-9ef4-f504f1197fb1">
                        
                            <h5 style="font-weight: 400;">Subscribe to our newsletter!</h5>
                            <script src="//app-sj15.marketo.com/js/forms2/js/forms2.min.js"></script><form id="mktoForm_1498"></form>
                            <script>
                                <!--//--><![CDATA[// ><!--
                                MktoForms2.loadForm("//app-sj15.marketo.com", "573-PXI-984", 1498);
                                //--><!]]]]><![CDATA[>
                                //--><!]]>
                            </script>
                        
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div class="footer-copyright">
                        <div class="text-center">
                            <ul class="list-inline no-margin">
                                <li>
                                    <a href="/legal" title="Legal">Legal</a>
                                </li>
                                <li>
                                    <a href="/privacy-policy" title="Privacy Policy">Privacy Policy</a>
                                </li>
                                <li>
                                    <a href="/cookie-policy/" title="Cookies">Cookie Policy</a>
                                </li>
                            </ul>
                            <p>Copyright &copy; 2025 MariaDB. All rights reserved.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</footer>
</div>

<div id="ajax_loading">
    <img src="/kb/static/images/ajax-loader.a51c5608d01a.gif" />
</div>

    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MK2847"
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MK2847');</script>
    <!-- End Google Tag Manager -->

</body>

<script type="text/javascript" src="/kb/static/js/main.1587e3a666fc.js" charset="utf-8"></script>

</html>