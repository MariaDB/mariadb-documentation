<!DOCTYPE html>
<html>
<head data-cookie-domain=""
      data-cookie-path="/">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="apple-touch-icon" sizes="180x180" href="/kb/static/images/favicons/apple-touch-icon.159e713979be.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/kb/static/images/favicons/favicon-32x32.bc0ac1d5d11e.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/kb/static/images/favicons/favicon-16x16.5801f8f0f34e.png">
    <link rel="shortcut icon" href="/kb/static/images/favicons/favicon.d122d305dee4.ico" type="image/x-icon" />

    <title>Ottimizzazioni delle subquery non-semi-join - MariaDB Knowledge Base</title>

    <link href="/kb/static/css/main.f7633538c846.css" rel="stylesheet" type="text/css" />

    

    

    <!-- FB Open Graph tags -->
    <meta property="og:title" content="Ottimizzazioni delle subquery non-semi-join" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://mariadb.com/kb/it/non-semi-join-subquery-optimizations/" />
    <meta property="og:image" content="http://mariadb.comaskmonty-logo.png" />
    <meta property="og:site_name" content="MariaDB KnowledgeBase" />
    <meta property="fb:admins" content="514852603" />
    <meta property="og:description" content="
Alcuni tipi di subquery &#34;IN&#34; non possono essere trasformate in semi-join. Queste subquery possono essere sia correlate sia non correlate. MariaDB, per avere buone performance..." />

    <meta name="description" content="
Alcuni tipi di subquery &#34;IN&#34; non possono essere trasformate in semi-join. Queste subquery possono essere sia correlate sia non correlate. MariaDB, per avere buone performance..." />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet"/>
    
</head>
<body class="mpkb nodes products nodes_view jqui" id="nodes_view">





<div id="menu-mobile" class="visible-sm visible-xs">

    <div>
        <div id="mobile-close-menu" class="text-right">
            <a href="javascript:void(0)" title="Close Menu" id="back-main" class="toggle-menu">X<span></span></a>
        </div>
    </div>
    <div class="mainmenu-mobile">
        <ul class="ls-none ul-menu">
            <li data-sub="submenu5"><a class="open-form-search" href="/kb/search/" title="Search">Search </a></li>
            <li data-sub="submenu0"><a href="/products" title="Products">Products</a><span class="arrow-main"></span></li>
            <li data-sub="submenu1"><a href="/services" title="Services">Services</a><span class="arrow-main"></span></li>
            <li data-sub="submenu2"><a href="/resources" title="Resources">Resources</a><span class="arrow-main"></span></li>
            <li data-sub="submenu3"><a href="/about-us" title="About">About</a><span class="arrow-main"></span></li>
            <li data-sub="submenu4"><a href="/contact" title="Contact">Contact</a></li>
        </ul>
    </div>

    <div class="nav-top-mobile">
        <div class="select-box form">

            <ul class="inline-block-md mb-none top-nav">
                <li>

                </li>
                
                    <li>
                        <a href="/kb/user/login?next=/kb/it/non-semi-join-subquery-optimizations/"> Login</a>
                    </li>
                
            </ul>



        </div>
        <p class="text-center copyright">Copyright &copy; 2025 MariaDB. All rights reserved.</p>
    </div>
</div>
<div class="violator-wrap d-none" id="top_violator">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12">
                <div class="violator-outer">
                    <div class="violator-inner">
                        <div class="row">
                            <div class="col-xs-12 col-sm-9 col-lg-7 col-lg-offset-2" id="top_violator_content">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="content-link" target="_blank" rel="nofollow noreferrer">
                                    <span>The Ultimate Guide to High Availability with MariaDB</span>
                                </a>
                            </div>
                            <div class="col-xs-12 col-sm-3" id="top_violator_cta">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="btn btn-mariadb" target="_blank" rel="nofollow noreferrer">Download Now</a>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-link close-btn">
                        <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24" width="15px" height="15px"><path d="M 4.9902344 3.9902344 A 1.0001 1.0001 0 0 0 4.2929688 5.7070312 L 10.585938 12 L 4.2929688 18.292969 A 1.0001 1.0001 0 1 0 5.7070312 19.707031 L 12 13.414062 L 18.292969 19.707031 A 1.0001 1.0001 0 1 0 19.707031 18.292969 L 13.414062 12 L 19.707031 5.7070312 A 1.0001 1.0001 0 0 0 18.980469 3.9902344 A 1.0001 1.0001 0 0 0 18.292969 4.2929688 L 12 10.585938 L 5.7070312 4.2929688 A 1.0001 1.0001 0 0 0 4.9902344 3.9902344 z"/></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="wrapper">
<div id="top-nav">
    <div class="container">
        <ul class="hidden-sm hidden-xs" >
            <li><a href="https://mariadb.com/kb/">Knowledge Base</a></li>
            <li><a href="https://mariadb.com/contact/">Contact</a></li>
            
                
                    <li>
                        <a href="/kb/user/login?next=/kb/it/non-semi-join-subquery-optimizations/" rel="nofollow">Accesso</a>
                    </li>
                
            
            
            <li id="search-form">
                <form action="/kb/it/+search/" method="get" id="search-block-form" accept-charset="UTF-8">
                    <input id="search" title="Enter the terms you wish to search for."
                           placeholder="Search . . ." type="text"
                           name="q" value="" size="15" maxlength="128" class="form-text"
                           data-autocomplete-url="/kb/it/+search/autocomplete/">
                    <input type="hidden" name="quick" value="1" />
                    <input type="hidden" name="source" value="kb" />
                </form>
            </li>
            <li><a id="search-toggler" href="/kb/search/">Search</a></li>
            
        </ul>
    </div>
</div>
<div id="navbar-bottom" class="navbar">
    <div class="container">
        
        
        
        
        <div class="row">
            <div class="col-md-3 col-sm-9 col-xs-9">
                <a class="brand" href="/" title="MariaDB">
                    <img src="/kb/static/images/logo-2018-black.95f5978ae14d.png">
                </a>
            </div>
            <div class="col-md-9 hidden-sm hidden-xs">
                <div class="main-menu">
                    <ul id="main-menu" class="nav navbar-nav inline-block-sm">
    <li class="has-sub full-menu">
        <a href="/products" title="Products">Products</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/services" title="Services">Services</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/pricing" title="Pricing">Pricing</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/resources" title="Resources">Resources</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/about-us" title="About Us">About Us</a>
    </li>
    <li class="">
        <a class="button electric-eel small top-bar-right-download" href="/downloads/">Download</a>
    </li>
</ul>
                </div>
            </div>
            <div class="col-md-3 visible-sm visible-xs col-sm-3 col-xs-3 ps-rv">
                <div class="navbar-header text-right pull-right">
                    <button type="button" class="menu-control toggle-menu" id="open-menu">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="main">
    <div class="container">
        

        <div id="subheader1" class="clearfix">
            <div class="pull-left">
                
                <div id="breadcrumbs" class="breadcrumb">
                    <a href="/kb/it/">Knowledge Base</a>
                    


    
    » <a class="crumb" href="/kb/it/mariadb-italiano/">MariaDB - Italiano</a>
    

    
    » <a class="crumb" href="/kb/it/documentazione-di-mariadb/">Documentazione di MariaDB</a>
    

    
    » <a class="crumb" href="/kb/it/ottimizzazione/">Ottimizzazione</a>
    

    
    » <a class="crumb" href="/kb/it/lottimizzatore-delle-query/">L&#39;ottimizzatore delle query</a>
    

    
    » <a class="crumb" href="/kb/it/ottimizzazioni-delle-subquery/">Ottimizzazioni delle subquery</a>
    


    » <a class="node_link crumb" href="/kb/it/non-semi-join-subquery-optimizations/">Ottimizzazioni delle subquery non-semi-join</a>


                </div>
                
            </div>
        </div>
    </div>
    <div class="container" id="container-main">
        <div class="row">
            
            
                
                <aside id="sidebar-first" class="sidebar col-md-2 hidden-xs hidden-sm hidden-print">
                    
                        
                        <ul id="category_menu" class="nav nav-pills nav-stacked">
                            <li><a href="/kb/it/">Pagina iniziale</a></li>
                            
                                
                                    <li><a href="/kb/it/+questions/">Domande Aperte</a></li>
                                
                                <li><a href="/kb/it/documentation/">MariaDB Server</a></li>
                                <li><a href="/kb/it/maxscale/">MariaDB MaxScale</a></li>
                                <li><a href="/kb/it/mariadb-columnstore/">MariaDB ColumnStore</a></li>
                                <li><a href="/kb/it/connectors/">Connectors</a></li>
                            

                        </ul>
                    

                    
<div>



<div class="well well-small box actions"><div>

        <a class="btn btn-block btn-blue btn-sm" href="/kb/it/non-semi-join-subquery-optimizations/+history" rel="nofollow">Cronologia</a>
        
        
        
        <a class="btn btn-block btn-blue btn-sm" href="/kb/it/non-semi-join-subquery-optimizations/+source/">Source</a>
        
        <a class="btn btn-block btn-blue btn-sm flag" href="/kb/it/non-semi-join-subquery-optimizations/+flag"
                data-flag-url="/kb/it/non-semi-join-subquery-optimizations/+flag" rel="nofollow">
                Flag as Spam / Inappropriate</a>
        
        <a class="btn btn-block btn-blue btn-sm" href="/kb/it/non-semi-join-subquery-optimizations/+translate/">
                Traduci</a>
        

</div>
</div>





<div class="well well-small box node_info"><div>

    <dl>
        <dt>Creato</dt>
        <dd>

<span class="datetime" title="2012-04-25 18:48">12 anni, 11 mesi ago</span></dd>

        <dt>Modificato</dt>
        <dd>

<span class="datetime" title="2012-04-29 20:17">12 anni, 10 mesi ago</span></dd>

        <dt>Tipo</dt>
        <dd>article</dd>

        <dt>Stato</dt>
        <dd>active</dd>

        <dt>Licenza</dt>
        <dd>
            
                <a href="/kb/it/non-semi-join-subquery-optimizations/+license/">CC BY-SA / Gnu FDL</a>
            
        </dd>

        
    </dl>

    
    <ul class="rss_feeds">
        <li><a href="/kb/it/non-semi-join-subquery-optimizations/+history/feed/">
            Cronologia</a>
        </li>
        <li><a href="/kb/it/non-semi-join-subquery-optimizations/+comments/feed/">
            Commenti</a>
        </li>
    </ul>
    

</div>
</div>





    
    
    

<div class="well well-small box attachments"><div><div class="edit_link pull-right"><a href="/kb/it/non-semi-join-subquery-optimizations/+edit/attachments/">Edit</a></div><h5>Attachments</h5></div><div>

        
            <div class="no_data">No attachments exist</div>
        
    
</div>
</div>

    



    
    
        

<div class="well well-small box"><div><h5>Versioni Localizzate</h5></div><div>

        <ul>
            
            <li><a href="/kb/en/non-semi-join-subquery-optimizations/">Non-semi-join Subquery Optimizations</a> [en]</li>
            
        </ul>
        
</div>
</div>

    






</div>


                    

































                </aside>
            
            
            
                
            
            
                
            
            <section id="content" class="limited_width col-md-8 clearfix">
                
                    <h1>Ottimizzazioni delle subquery non-semi-join</h1>
                

                



                <div>
                    
    

    
    
    

    <div class="node creole">
        
        
        


    
    <div class="answer formatted">
        <div class="table_of_contents well well-small">
<h3>Contents</h3>
 <ol class="toc">

    <li class=""><a href="#applicabilità" title="Applicabilità">Applicabilità</a>    <ol class="toc">

        <li class=""><a href="#subquery-in-una-disgiunzione-or" title="Subquery in una disgiunzione (OR)">Subquery in una disgiunzione (OR)</a></li>

        <li class=""><a href="#predicato-di-negazione-delle-subquery-not-in" title="Predicato di negazione delle subquery (NOT IN)">Predicato di negazione delle subquery (NOT IN)</a></li>

        <li class=""><a href="#subquery-nelle-clausole-select-o-having" title="Subquery nelle clausole SELECT o HAVING">Subquery nelle clausole SELECT o HAVING</a></li>

        <li class=""><a href="#subquery-con-una-union" title="Subquery con una UNION">Subquery con una UNION</a>    </ol>
</li>

    <li class=""><a href="#la-materializzazione-per-le-subquery-in-non-correlate" title="La materializzazione per le subquery IN non correlate">La materializzazione per le subquery IN non correlate</a>    <ol class="toc">

        <li class=""><a href="#le-basi-della-materializzazione" title="Le basi della materializzazione">Le basi della materializzazione</a></li>

        <li class=""><a href="#esecuzione-efficiente-sensibile-ai-null" title="Esecuzione efficiente sensibile ai NULL">Esecuzione efficiente sensibile ai NULL</a></li>

        <li class=""><a href="#limitazioni" title="Limitazioni">Limitazioni</a>    </ol>
</li>

    <li class=""><a href="#trasformazione-da-in-a-exists" title="Trasformazione da-IN-a-EXISTS">Trasformazione da-IN-a-EXISTS</a></li>

    <li class=""><a href="#performance" title="Performance">Performance</a>    <ol class="toc">

        <li class=""><a href="#esempio-di-velocizzazione-tra-mysql-5x-e-mariadb-5152" title="Esempio di velocizzazione tra MySQL 5.x e MariaDB 5.1/5.2">Esempio di velocizzazione tra MySQL 5.x e MariaDB 5.1/5.2</a></li>

        <li class=""><a href="#linee-guida-sulle-performance" title="Linee guida sulle performance">Linee guida sulle performance</a>    </ol>
</li>

    <li class=""><a href="#controllo-dellottimizzatore" title="Controllo dell&#39;ottimizzatore">Controllo dell&#39;ottimizzatore</a> </ol>
</li>
</div><p>
Alcuni tipi di subquery "IN" non possono essere trasformate in <a href="ottimizzazioni-delle-semi-join">semi-join</a>. Queste subquery possono essere sia correlate sia non correlate. MariaDB, per avere buone performance in tutti i casi, ha diverse strategie alternative per questi tipi di subquery. Qualora sia possibile applicare diverse strategie, l'ottimizzatore sceglie quella ottimale basandosi su una stima dei costi.</p>
<p>Le due strategie principali per le non-semi-join sono la materializzazione (detta anche materializzazione outside-in) e la trasformazione da-in-a-exists. La prima è applicabile solo per le subquery non correlate, mentre la seconda può essere usata sia per le correlate sia per le non correlate.</p>
<h2 class="anchored_heading" id="applicabilità">Applicabilità</h2>
<p>Le subquery IN non possono essere trasformate in semi-join nei seguenti casi. Gli esempi sono utilizzano il database <em>World</em> della regression test suite di MariaDB.</p>
<h3 class="anchored_heading" id="subquery-in-una-disgiunzione-or">Subquery in una disgiunzione (OR)</h3>
<p>La subquery si trova direttamente o indirettamente in una operazione OR nella clausola WHERE della query esterna.</p>
<p>Schema:</p>
<pre class="fixed"><span class="k">SELECT</span> <span class="p">...</span> <span class="k">FROM</span> <span class="p">...</span> <span class="k">WHERE</span> <span class="p">(</span><span class="n">espr1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">esprN</span><span class="p">)</span> <span class="p">[</span><span class="k">NOT</span><span class="p">]</span> <span class="k">IN</span> <span class="p">(</span><span class="k">SELECT</span> <span class="p">...</span> <span class="p">)</span> <span class="k">OR</span> <span class="n">espr</span><span class="p">;</span>
</pre><p>Esempio:</p>
<pre class="fixed"><span class="k">SELECT</span> <span class="n">Name</span> <span class="k">FROM</span> <span class="n">Country</span>
<span class="k">WHERE</span> <span class="p">(</span><span class="n">Code</span> <span class="k">IN</span> <span class="p">(</span><span class="k">select</span> <span class="n">Country</span> <span class="k">from</span> <span class="n">City</span> <span class="k">where</span> <span class="n">City</span><span class="p">.</span><span class="n">Population</span> <span class="o">&gt;</span> <span class="mi">100000</span><span class="p">)</span> <span class="k">OR</span>
       <span class="n">Name</span> <span class="k">LIKE</span> <span class="s1">&#39;L%&#39;</span><span class="p">)</span> <span class="k">AND</span>
      <span class="n">surfacearea</span> <span class="o">&gt;</span> <span class="mi">1000000</span><span class="p">;</span>
</pre><h3 class="anchored_heading" id="predicato-di-negazione-delle-subquery-not-in">Predicato di negazione delle subquery (NOT IN)</h3>
<p>Schema:</p>
<pre class="fixed"><span class="k">SELECT</span> <span class="p">...</span> <span class="k">FROM</span> <span class="p">...</span> <span class="k">WHERE</span> <span class="p">...</span> <span class="p">(</span><span class="n">espr1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">esprN</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">IN</span> <span class="p">(</span><span class="k">SELECT</span> <span class="p">...</span> <span class="p">)</span> <span class="p">...;</span>
</pre><p>Esempio:</p>
<pre class="fixed"><span class="k">SELECT</span> <span class="n">Country</span><span class="p">.</span><span class="n">Name</span>
<span class="k">FROM</span> <span class="n">Country</span><span class="p">,</span> <span class="n">CountryLanguage</span> 
<span class="k">WHERE</span> <span class="n">Code</span> <span class="k">NOT</span> <span class="k">IN</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">Country</span> <span class="k">FROM</span> <span class="n">CountryLanguage</span> <span class="k">WHERE</span> <span class="k">Language</span> <span class="o">=</span> <span class="s1">&#39;English&#39;</span><span class="p">)</span>
  <span class="k">AND</span> <span class="n">CountryLanguage</span><span class="p">.</span><span class="k">Language</span> <span class="o">=</span> <span class="s1">&#39;French&#39;</span>
  <span class="k">AND</span> <span class="n">Code</span> <span class="o">=</span> <span class="n">Country</span><span class="p">;</span>
</pre><h3 class="anchored_heading" id="subquery-nelle-clausole-select-o-having">Subquery nelle clausole SELECT o HAVING</h3>
<p>La subquery si trova nelle clausole SELECT o HAVING della query esterna.</p>
<p>Query pattern:</p>
<pre class="fixed"><span class="k">SELECT</span> <span class="n">campo1</span><span class="p">,</span> <span class="p">...,</span> <span class="p">(</span><span class="k">SELECT</span> <span class="p">...)</span>  <span class="k">WHERE</span> <span class="p">...;</span>
<span class="k">SELECT</span> <span class="p">...</span>  <span class="k">WHERE</span> <span class="p">...</span> <span class="k">HAVING</span> <span class="p">(</span><span class="k">SELECT</span> <span class="p">...);</span>
</pre><p>Esempio:</p>
<pre class="fixed"><span class="k">select</span> <span class="n">Name</span><span class="p">,</span> <span class="n">City</span><span class="p">.</span><span class="n">id</span> <span class="k">in</span> <span class="p">(</span><span class="k">select</span> <span class="n">capital</span> <span class="k">from</span> <span class="n">Country</span> <span class="k">where</span> <span class="n">capital</span> <span class="k">is</span> <span class="k">not</span> <span class="k">null</span><span class="p">)</span> <span class="k">as</span> <span class="n">is_capital</span>
<span class="k">from</span> <span class="n">City</span>
<span class="k">where</span> <span class="n">City</span><span class="p">.</span><span class="n">population</span> <span class="o">&gt;</span> <span class="mi">10000000</span><span class="p">;</span>
</pre><h3 class="anchored_heading" id="subquery-con-una-union">Subquery con una UNION</h3>
<p>La subquery stessa è una UNION, mentre il predicato IN può trovarsi in qualsiasi punto della query.</p>
<p>Schema:</p>
<pre class="fixed"><span class="p">...</span> <span class="p">[</span><span class="k">NOT</span><span class="p">]</span> <span class="k">IN</span> <span class="p">(</span><span class="k">SELECT</span> <span class="p">...</span> <span class="k">UNION</span> <span class="k">SELECT</span> <span class="p">...)</span>
</pre><p>Esempio:</p>
<pre class="fixed"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">from</span> <span class="n">City</span> <span class="k">where</span> <span class="p">(</span><span class="n">Name</span><span class="p">,</span> <span class="mi">91</span><span class="p">)</span> <span class="k">IN</span>
<span class="p">(</span><span class="k">SELECT</span> <span class="n">Name</span><span class="p">,</span> <span class="n">round</span><span class="p">(</span><span class="n">Population</span><span class="o">/</span><span class="mi">1000</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">City</span> <span class="k">WHERE</span> <span class="n">Country</span> <span class="o">=</span> <span class="ss">&quot;IND&quot;</span> <span class="k">AND</span> <span class="n">Population</span> <span class="o">&gt;</span> <span class="mi">2500000</span>
<span class="k">UNION</span>
 <span class="k">SELECT</span> <span class="n">Name</span><span class="p">,</span> <span class="n">round</span><span class="p">(</span><span class="n">Population</span><span class="o">/</span><span class="mi">1000</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">City</span> <span class="k">WHERE</span> <span class="n">Country</span> <span class="o">=</span> <span class="ss">&quot;IND&quot;</span> <span class="k">AND</span> <span class="n">Population</span> <span class="o">&lt;</span> <span class="mi">100000</span><span class="p">);</span>
</pre><h2 class="anchored_heading" id="la-materializzazione-per-le-subquery-in-non-correlate">La materializzazione per le subquery IN non correlate</h2>
<h3 class="anchored_heading" id="le-basi-della-materializzazione">Le basi della materializzazione</h3>
<p>L'idea di base della materializzazione delle subquery è eseguire subquery e registrare il risultato in una tabella temporanea interna le cui colonne sono tutte indicizzate. Naturalmente, questo è possibile solo se la subquery  non è correlata. Il predicato IN verifica se l'operando di sinistra è presente nel risultato. Pertanto non è necessario registrare le righe duplicate della subquery nella tabella temporanea. Registrare le righe in modo univoco ha due vantaggi: le dimensioni della tabella temporanea sono più ridotte e l'indice su tutte le colonne può essere univoco.</p>
<p>Se le dimensioni della tabella temporanea sono minori della variabile tmp_table_size system, la tabella è una HEAP in memoria, con l'indice di tipo hash. Nei rari casi in cui il risultato della subquery eccede questo limite, la tabella temporanea viene registrata su disco con ARIA o MyISAM, con l'indice di tipo B-tree (ARIA è il default).</p>
<p>La materializzazione avviene su richiesta durante la prima esecuzione del predicato IN. Una volta materializzata la subquery, il predicato IN viene elaborato in modo molto efficiente tramite ricerche sugli indice dell'espressione esterna nell'indice univoco della tabella temporanea materializzata. Se c'è una corrispondenza, IN è vero, altrimenti è falso.</p>
<h3 class="anchored_heading" id="esecuzione-efficiente-sensibile-ai-null">Esecuzione efficiente sensibile ai NULL</h3>
<p>I predicati IN possono restituire NULL se uno qualsiasi dei suoi argomenti è NULL. A seconda della sua posizione in una query, un valore NULL può essere equivalente a FALSE. Questo avviene quando, sostituendo NULL con FALSE, si otterrebbero esattamente gli stessi risultati. Quando IN restituisce NULL, non è distinguibile da FALSE se il predicato:</p>
<ul start="1"><li>non è negato,
</li><li>non è passato a una funzione come argomento,
</li><li>è in una clausola WHERE oppure ON.
</li></ul>
<p>In tutti questi casi, IN viene elaborato come descritto nel paragrafo precedente con una ricerca sugli indici nella subquery materializzata. In tutti i casi rimanenti, quando NULL non può essere distinto da FALSE, non è possibile utilizzare le ricerche sugli indici. Non si tratta di una limitazione del server, ma è una conseguenza della semantica di NULL nello standard ANSI SQL.</p>
<p>Si supponga che un predicato venga valutato come </p><pre class="fixed"><span class="k">NULL</span> <span class="k">IN</span> <span class="p">(</span><span class="k">select</span>
<span class="n">not_null_col</span> <span class="k">from</span> <span class="n">t1</span><span class="p">)</span>
</pre><p>, cioè che l'operatore di sinistra sia un valore NULL, e che non ci siano NULL nella the subquery. In questo caso il valore di IN non è né FALSE, né TRUE; piuttosto, è NULL. Se si eseguisse una ricerca su indice con il NULL nella chiave, quel valore non può essere trovato in not_null_col, e il predicato IN
restituirebbe erroneamente FALSE.</p>
<p>In generale, una valore NULL su qualsiasi lato di IN agisce come "jolly" che corrisponde a qualsiasi valore, e se esiste una corrispondenza, il risultato di IN è NULL. Si consideri il seguente esempio:</p>
<p>Se l'argomento di sinistra di IN è la riga: <code class="fixed" style="white-space:pre-wrap"><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
</code>,
e il risultato della subquery a destra è la tabella:</p>
<pre class="fixed"><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="k">NULL</span><span class="p">)</span>
<span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
</pre><p>Il predicato IN corrisponde alla riga <code class="fixed" style="white-space:pre-wrap"><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
</code>,
e il risultato di IN è NULL. Le corrispondenze in cui i valori differenti su qualsiasi lato della IN corrispondono a un NULL sull'altro lato della IN, si chiamano <em>partial match</em>.</p>
<p>Per poter calcolare in modo efficiente il risultato di un predicato IN in presenza di valori NULL, MariaDB implementa due particolari algoritmi per <a href="http://askmonty.org/worklog/Server-Sprint/?tid=68">il partial matching, descritti qui nel dettaglio</a>.</p>
<ul start="1"><li>Partial match con il rowid-merge<br>
Questa tecnica viene usata quando il numero delle righe del risultato della subquery supera un certo limite. Vengono creati indici speciali su alcune delle colonne della tabella temporanea, e vengono uniti con la scansione individuale di ogni indice, effettuando un'operazione simile a set-intersection.
</li></ul>
<ul start="1"><li>Partial matching con la scansione della tabella<br>
Questo algoritmo di usa per tabelle molto piccole quando il carico di lavoro della tecnica rowid-merge non è giustificato. Allora il server fa semplicemente una scansione della subquery materializzara, e cerca i partial match. Poiché tale strategia non necessita di alcun buffer in memoria, viene usata anche quando non c'è memoria a sufficienza per gli indici dell'algoritmo rowid-merge.
</li></ul>
<h3 class="anchored_heading" id="limitazioni">Limitazioni</h3>
<p>La stratezia della materializzazione delle subquery in teoria è universale; tuttavia, a causa di alcune limitazioni tecniche del server MariaDB, vi sono alcuni casi in cui non può essere usata. </p>
<ul start="1"><li>Campi BLOB<br>
O l'operando di sinistra del predicato IN è un campo di tipo BLOB, o la subquery
estrae uno o più campi BLOB.
</li></ul>
<ul start="1"><li>Campi incompatibili<br>
TODO
</li></ul>
<p>In questi casi, il server rimedia utilizzando la trasformazione 
<a href="ottimizzazioni-delle-subquery-non-semi-join#trasformazione-da-in-a-exists">da-IN-a-EXISTS</a>
transformation.</p>
<h2 class="anchored_heading" id="trasformazione-da-in-a-exists">Trasformazione da-IN-a-EXISTS</h2>
<p>Questa ottimizzazione è l'unica strategia di esecuzione delle subquery che esisteva nelle versioni di MariaDB e MySQL antecedenti a <a href="/kb/en/what-is-mariadb-53/">MariaDB 5.3</a>. Sono stati apportati vari cambiamenti e corretti numerosi bug nel codice di questa funzionalità, ma rimane essenzialmente uguale a prima.</p>
<p>Per il momento si rimanda il lettore alla 
<a href="http://dev.mysql.com/doc/refman/5.5/en/in-subquery-optimization.html">documentazione di MySQL</a> per approfondire questa ottimizzazione.</p>
<h2 class="anchored_heading" id="performance">Performance</h2>
<h3 class="anchored_heading" id="esempio-di-velocizzazione-tra-mysql-5x-e-mariadb-5152">Esempio di velocizzazione tra MySQL 5.x e <a href="/kb/en/what-is-mariadb-51/">MariaDB 5.1</a>/5.2</h3>
<p>A seconda della query e dei dati, una delle tue strategie descritte qui potrebbe essere esponenzialmente più veloce o più lenta dell'altra.</p>
<p>Le versioni più vecchie di MariaDB e tutte le attuali versioni di MySQL (comprese MySQL 5.5 e MySQL 5.6 DMR, al luglio 2011) implementano solo la trasformazione da-IN-a-EXISTS. Come illustrato sotto, questa strategia è inferiore nella maggior parte dei casi alla materializzazione delle subquery.</p>
<p>Si consideri la query seguente sui dati del benchmark DBT3 scale 10. Si vogliono trovare i clienti che hanno il bilancio più alto nel loro stato:</p>
<pre class="fixed"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">part</span>
<span class="k">WHERE</span> <span class="n">p_partkey</span> <span class="k">IN</span>
      <span class="p">(</span><span class="k">SELECT</span> <span class="n">l_partkey</span> <span class="k">FROM</span> <span class="n">lineitem</span>
       <span class="k">WHERE</span> <span class="n">l_shipdate</span> <span class="k">between</span> <span class="s1">&#39;1997-01-01&#39;</span> <span class="k">and</span> <span class="s1">&#39;1997-02-01&#39;</span><span class="p">)</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">p_retailprice</span> <span class="k">DESC</span> <span class="k">LIMIT</span> <span class="mi">10</span><span class="p">;</span>
</pre><p>I tempi di esecuzione di questa query sono i seguenti:</p>
<ul start="1"><li>Tempo di esecuzione in <a href="/kb/en/what-is-mariadb-52/">MariaDB 5.2</a>/MySQL 5.x (tutte le versioni di MySQL): <strong>&gt; 1 h</strong><br>
  La query impiega più di un'ora (non abbiamo voluto aspettare oltre), perché fa un uso poco pratico delle subquery in casi simili. L'istruzione EXPLAIN, sotto, mostra che la subquery viene trasformata in una correlata, il che indica una trasformazione da-IN-a-EXISTS.<br>
</li></ul>
<pre class="highlight fixed"><pre>
+--+------------------+--------+--------------+-------------------+----+------+---------------------------+
|id|select_type       |table   |type          |key                |ref |rows  |Extra                      |
+--+------------------+--------+--------------+-------------------+----+------+---------------------------+
| 1|PRIMARY           |part    |ALL           |NULL               |NULL|199755|Using where; Using filesort|
| 2|DEPENDENT SUBQUERY|lineitem|index_subquery|i_l_suppkey_partkey|func|    14|Using where                |
+--+------------------+--------+--------------+-------------------+----+------+---------------------------+
</pre></pre><ul start="1"><li>Tempo di esecuzione in <a href="/kb/en/what-is-mariadb-53/">MariaDB 5.3</a>: <strong>43 secondi</strong><br>
  In <a href="/kb/en/what-is-mariadb-53/">MariaDB 5.3</a>, la stessa query impiega meno di un minuto.
  La EXPLAIN mostra che la subquery resta non correlata, e questo significa che viene materializzata.<br>
</li></ul>
<pre class="highlight fixed"><pre>
+--+------------+-----------+------+------------------+----+------+-------------------------------+
|id|select_type |table      |type  |key               |ref |rows  |Extra                          |
+--+------------+-----------+------+------------------+----+------+-------------------------------+
| 1|PRIMARY     |part       |ALL   |NULL              |NULL|199755|Using temporary; Using filesort|
| 1|PRIMARY     |&lt;subquery2&gt;|eq_ref|distinct_key      |func|     1|                               |
| 2|MATERIALIZED|lineitem   |range |l_shipdate_partkey|NULL|160060|Using where; Using index       |
+--+------------+-----------+------+------------------+----+------+-------------------------------+
</pre></pre><p>La velocizzazione qui è praticamente infinita, perché MySQL e le più vecchie versioni di MariaDB non possono completare la query in un tempo ragionevole.</p>
<p>Per mostrare i benefici del partial match, è stata estesa la tabella <em>customer</em> del benchmark DBT3 con due colonne aggiuntive:</p>
<ul start="1"><li>c_pref_nationkey - lo stato da cui si preferisce acquistare,
</li><li>c_pref_brand - il brand preferito.
</li></ul>
<p>Entrambe hanno un prefisso con la percentuale di valori NULL presenti, quindi ad esempio c_pref_nationkey_05 ha un 5% di valori NULL.</p>
<p>Si consideri la query "Trova tutti i clienti che non hanno acquistato dallo stato preferito, o il brand preferito in un dato intervallo di tempo":</p>
<pre class="fixed"><span class="k">SELECT</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">customer</span>
<span class="k">WHERE</span> <span class="p">(</span><span class="n">c_custkey</span><span class="p">,</span> <span class="n">c_pref_nationkey_05</span><span class="p">,</span> <span class="n">c_pref_brand_05</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">IN</span>
  <span class="p">(</span><span class="k">SELECT</span> <span class="n">o_custkey</span><span class="p">,</span> <span class="n">s_nationkey</span><span class="p">,</span> <span class="n">p_brand</span>
   <span class="k">FROM</span> <span class="n">orders</span><span class="p">,</span> <span class="n">supplier</span><span class="p">,</span> <span class="n">part</span><span class="p">,</span> <span class="n">lineitem</span>
   <span class="k">WHERE</span> <span class="n">l_orderkey</span> <span class="o">=</span> <span class="n">o_orderkey</span> <span class="k">and</span>
         <span class="n">l_suppkey</span> <span class="o">=</span> <span class="n">s_suppkey</span> <span class="k">and</span>
         <span class="n">l_partkey</span> <span class="o">=</span> <span class="n">p_partkey</span> <span class="k">and</span>
         <span class="n">p_retailprice</span> <span class="o">&lt;</span> <span class="mi">1200</span> <span class="k">and</span>
         <span class="n">l_shipdate</span> <span class="o">&gt;=</span> <span class="s1">&#39;1996-04-01&#39;</span> <span class="k">and</span> <span class="n">l_shipdate</span> <span class="o">&lt;</span> <span class="s1">&#39;1996-04-05&#39;</span> <span class="k">and</span>
         <span class="n">o_orderdate</span> <span class="o">&gt;=</span> <span class="s1">&#39;1996-04-01&#39;</span> <span class="k">and</span> <span class="n">o_orderdate</span> <span class="o">&lt;</span> <span class="s1">&#39;1996-04-05&#39;</span><span class="p">);</span>
</pre><ul start="1"><li>Tempo di esecuzione in <a href="/kb/en/what-is-mariadb-52/">MariaDB 5.2</a>/MySQL 5.x (any MySQL): <strong>40 secondi</strong>
</li><li>Tempo di esecuzione in <a href="/kb/en/what-is-mariadb-53/">MariaDB 5.3</a>: <strong>2 secondi</strong>
</li></ul>
<p>Questa query è stata velocizzata di 20 volte.</p>
<h3 class="anchored_heading" id="linee-guida-sulle-performance">Linee guida sulle performance</h3>
<p>  TODO</p>
<h2 class="anchored_heading" id="controllo-dellottimizzatore">Controllo dell'ottimizzatore</h2>
<p>In alcuni casi potrebbe essere necessario forzare una scelta per l'ottimizzatore. Tipicamente questo avviene per scopi di benchmark o di test, o per imitare il comportamento di una versione più vecchia del server, o se l'ottimizzatore ha fatto una scelta infelice.</p>
<p>Tutte le strategie sopra possono essere controllare con i seguenti switch nella variabile di sistema <a href="http://kb.askmonty.org/it/optimizer_switch-in-mariadb-53">optimizer_switch</a>:</p>
<ul start="1"><li>materialization=on/off<br>
In casi molto particolari, anche se si forza la materializzazione, l'ottimizzazione potrebbe ricorrere comunque alla strategia da-IN-a-EXISTS perché la materializzazione non è applicabile. Nei casi in cui la materializzazione richiede il partial match (perché sono presenti i valori NULL), vi sono due switch che controllano le due strategie di partial match:<br>
<ul start="1"><li>partial_match_rowid_merge=on/off<br>
   Questo switch controlla la strategia Rowid-merge. In aggiunta, la variabile di sistema <code class="fixed" style="white-space:pre-wrap">rowid_merge_buff_size</code> determina la memoria massima disponibile per l'algoritmo Rowid-merge. 
</li><li>partial_match_table_scan=on/off<br>
   Determina la strategia alternatica di partial match, che esegue la scansione completa di una tabella.
</li></ul>
</li></ul>
<ul start="1"><li>in_to_exists=on/off<br>
Questo switch controlla la trasformazione da-IN-a-EXISTS.
</li></ul>
<ul start="1"><li>Variabili di sistema tmp_table_size e max_heap_table_size<br>
  La variabile <em>tmp_table_size</em> determina il limite massimo per le tabelle temporanee interne di tipo MEMORY. Se una tabella temporanea interna supera questo limite, viene convertita automaticamente in una tabella su disco, di tipo Aria o MyISAM, con un indice B-tree. Si noti però che una tabella MEMORY non può essere più grande di <em>max_heap_table_size</em>.
</li></ul>
<p>I due principali switch - <em>materialization</em> e <em>in_to_exists</em> non possono essere off contemporaneamente. Se entrambi sono off, il server produce un errore.</p>

    </div>


        
            <div id="subscribe" class="well well-small hide hidden-print"
                 data-subscribe-url="/kb/it/non-semi-join-subquery-optimizations/+subscriptions/add"
                 data-unsubscribe-url="/kb/it/non-semi-join-subquery-optimizations/+subscriptions/remove">
            </div>
        

        
        
    
        <div class="simple_section_nav">
            <ul class="nav nav-pills">
                
                    <li><a href="/kb/it/semi-join-subquery-optimizations/">
                        ← Ottimizzazioni delle semi-join
                    </a>
                    </li>
                
                
                    <li><a href="/kb/it/ottimizzazioni-delle-subquery/">
                        ↑ Ottimizzazioni delle subquery ↑
                    </a>
                    </li>
                
                
            </ul>
        </div>
    

        

        
        <h2>Commenti</h2>
        
    
    <div id="comments" data-node-id="2663" data-comments-url="/kb/it/non-semi-join-subquery-optimizations/+comments"
         data-reply-url="/kb/it/non-semi-join-subquery-optimizations/comments/post/">
        Sto caricando i commenti......
    </div>

        

    </div>


                    <div id="content_disclaimer" class="graybox">
                        Content reproduced on this site is the property of its respective owners,
                        and this content is not reviewed in advance by MariaDB. The views, information and opinions
                        expressed by this content do not necessarily represent those of MariaDB or any other party.
                    </div>
                </div>
            </section>

            
                <div id="right_bar" class="col-md-2">
                    
    
        
        <ul class="section_navigation well well-small hidden-xs hidden-sm">
            
                <li class="parent"><a href="/kb/it/ottimizzazioni-delle-subquery/">
                    ↑ Ottimizzazioni delle subquery ↑
                </a>
                </li>
            
            
                
                    <li>
                        <a href="/kb/it/lottimizzazione-table-pullout/">
                            
                            L&#39;ottimizzazione Table Pullout
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/it/subquery-cache/">
                            <span class="pull-right not_primary"></span>
                            La cache delle Subquery
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/it/subquery-optimizations-map/">
                            
                            Mappa delle ottimizzazioni delle subquery
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/it/optimizing-group-by-and-distinct-clauses-in-subqueries/">
                            
                            Ottimizzare le clausole GROUP BY e DISTINCT nelle subquery
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/it/exists-to-in-optimization/">
                            
                            Ottimizzazione da EXISTS a IN
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/it/semi-join-subquery-optimizations/">
                            
                            Ottimizzazioni delle semi-join
                        </a>
                    </li>
                
            
                
                    <li class="active">
                        <span>Ottimizzazioni delle subquery non-semi-join</span>
                        
                    </li>
                
            
        </ul>
    
    

                </div>
            
        </div>
    </div>
</div>

<!-- Footer -->
<footer id="footer">
    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-xs-12">
                    <ul class="list-inline text-center footer-nav">
                        <li>
                            <h5>
                                <a href="https://mariadb.com/products" title="Products">Products</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/services" title="Services">Services</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/pricing" title="Pricing">Pricing</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/resources" title="Resources">Resources</a>
                            </h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/about-us" title="About MariaDB">About Us</a></h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/download" title="Download">Download MariaDB</a></h5>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="row row-10">
                
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div id="block-footerformcontact" class="block block-block-content block-block-contentd754ee1b-3cc9-40e7-9ef4-f504f1197fb1">
                        
                            <h5 style="font-weight: 400;">Subscribe to our newsletter!</h5>
                            <script src="//app-sj15.marketo.com/js/forms2/js/forms2.min.js"></script><form id="mktoForm_1498"></form>
                            <script>
                                <!--//--><![CDATA[// ><!--
                                MktoForms2.loadForm("//app-sj15.marketo.com", "573-PXI-984", 1498);
                                //--><!]]]]><![CDATA[>
                                //--><!]]>
                            </script>
                        
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div class="footer-copyright">
                        <div class="text-center">
                            <ul class="list-inline no-margin">
                                <li>
                                    <a href="/legal" title="Legal">Legal</a>
                                </li>
                                <li>
                                    <a href="/privacy-policy" title="Privacy Policy">Privacy Policy</a>
                                </li>
                                <li>
                                    <a href="/cookie-policy/" title="Cookies">Cookie Policy</a>
                                </li>
                            </ul>
                            <p>Copyright &copy; 2025 MariaDB. All rights reserved.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</footer>
</div>

<div id="ajax_loading">
    <img src="/kb/static/images/ajax-loader.a51c5608d01a.gif" />
</div>

    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MK2847"
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MK2847');</script>
    <!-- End Google Tag Manager -->

</body>

<script type="text/javascript" src="/kb/static/js/main.1587e3a666fc.js" charset="utf-8"></script>

</html>