<!DOCTYPE html>
<html>
<head data-cookie-domain=""
      data-cookie-path="/">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="apple-touch-icon" sizes="180x180" href="/kb/static/images/favicons/apple-touch-icon.159e713979be.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/kb/static/images/favicons/favicon-32x32.bc0ac1d5d11e.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/kb/static/images/favicons/favicon-16x16.5801f8f0f34e.png">
    <link rel="shortcut icon" href="/kb/static/images/favicons/favicon.d122d305dee4.ico" type="image/x-icon" />

    <title>La Query Cache - Source - MariaDB Knowledge Base</title>

    <link href="/kb/static/css/main.f7633538c846.css" rel="stylesheet" type="text/css" />

    
        <meta name="robots" content="noindex, nofollow">
    

    

    <!-- FB Open Graph tags -->
    <meta property="og:title" content="La Query Cache - Source" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://mariadb.com/kb/it/the-query-cache/+source/" />
    <meta property="og:image" content="http://mariadb.comaskmonty-logo.png" />
    <meta property="og:site_name" content="MariaDB KnowledgeBase" />
    <meta property="fb:admins" content="514852603" />
    <meta property="og:description" content="" />

    <meta name="description" content="" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet"/>
    
</head>
<body class="mpkb nodes autoresize nodes_source jqui" id="nodes_source">





<div id="menu-mobile" class="visible-sm visible-xs">

    <div>
        <div id="mobile-close-menu" class="text-right">
            <a href="javascript:void(0)" title="Close Menu" id="back-main" class="toggle-menu">X<span></span></a>
        </div>
    </div>
    <div class="mainmenu-mobile">
        <ul class="ls-none ul-menu">
            <li data-sub="submenu5"><a class="open-form-search" href="/kb/search/" title="Search">Search </a></li>
            <li data-sub="submenu0"><a href="/products" title="Products">Products</a><span class="arrow-main"></span></li>
            <li data-sub="submenu1"><a href="/services" title="Services">Services</a><span class="arrow-main"></span></li>
            <li data-sub="submenu2"><a href="/resources" title="Resources">Resources</a><span class="arrow-main"></span></li>
            <li data-sub="submenu3"><a href="/about-us" title="About">About</a><span class="arrow-main"></span></li>
            <li data-sub="submenu4"><a href="/contact" title="Contact">Contact</a></li>
        </ul>
    </div>

    <div class="nav-top-mobile">
        <div class="select-box form">

            <ul class="inline-block-md mb-none top-nav">
                <li>

                </li>
                
                    <li>
                        <a href="/kb/user/login?next=/kb/it/the-query-cache/+source/"> Login</a>
                    </li>
                
            </ul>



        </div>
        <p class="text-center copyright">Copyright &copy; 2025 MariaDB. All rights reserved.</p>
    </div>
</div>
<div class="violator-wrap d-none" id="top_violator">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12">
                <div class="violator-outer">
                    <div class="violator-inner">
                        <div class="row">
                            <div class="col-xs-12 col-sm-9 col-lg-7 col-lg-offset-2" id="top_violator_content">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="content-link" target="_blank" rel="nofollow noreferrer">
                                    <span>The Ultimate Guide to High Availability with MariaDB</span>
                                </a>
                            </div>
                            <div class="col-xs-12 col-sm-3" id="top_violator_cta">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="btn btn-mariadb" target="_blank" rel="nofollow noreferrer">Download Now</a>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-link close-btn">
                        <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24" width="15px" height="15px"><path d="M 4.9902344 3.9902344 A 1.0001 1.0001 0 0 0 4.2929688 5.7070312 L 10.585938 12 L 4.2929688 18.292969 A 1.0001 1.0001 0 1 0 5.7070312 19.707031 L 12 13.414062 L 18.292969 19.707031 A 1.0001 1.0001 0 1 0 19.707031 18.292969 L 13.414062 12 L 19.707031 5.7070312 A 1.0001 1.0001 0 0 0 18.980469 3.9902344 A 1.0001 1.0001 0 0 0 18.292969 4.2929688 L 12 10.585938 L 5.7070312 4.2929688 A 1.0001 1.0001 0 0 0 4.9902344 3.9902344 z"/></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="wrapper">
<div id="top-nav">
    <div class="container">
        <ul class="hidden-sm hidden-xs" >
            <li><a href="https://mariadb.com/kb/">Knowledge Base</a></li>
            <li><a href="https://mariadb.com/contact/">Contact</a></li>
            
                
                    <li>
                        <a href="/kb/user/login?next=/kb/it/the-query-cache/+source/" rel="nofollow">Accesso</a>
                    </li>
                
            
            
            <li id="search-form">
                <form action="/kb/it/+search/" method="get" id="search-block-form" accept-charset="UTF-8">
                    <input id="search" title="Enter the terms you wish to search for."
                           placeholder="Search . . ." type="text"
                           name="q" value="" size="15" maxlength="128" class="form-text"
                           data-autocomplete-url="/kb/it/+search/autocomplete/">
                    <input type="hidden" name="quick" value="1" />
                    <input type="hidden" name="source" value="kb" />
                </form>
            </li>
            <li><a id="search-toggler" href="/kb/search/">Search</a></li>
            
        </ul>
    </div>
</div>
<div id="navbar-bottom" class="navbar">
    <div class="container">
        
        
        
        
        <div class="row">
            <div class="col-md-3 col-sm-9 col-xs-9">
                <a class="brand" href="/" title="MariaDB">
                    <img src="/kb/static/images/logo-2018-black.95f5978ae14d.png">
                </a>
            </div>
            <div class="col-md-9 hidden-sm hidden-xs">
                <div class="main-menu">
                    <ul id="main-menu" class="nav navbar-nav inline-block-sm">
    <li class="has-sub full-menu">
        <a href="/products" title="Products">Products</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/solutions" title="Solutions">Solutions</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/resources" title="Resources">Resources</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/about-us" title="Company">Company</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/pricing" title="Pricing">Pricing</a>
    </li>
    
    <li class="">
        <a class="button electric-eel small top-bar-right-download" href="/downloads/">Download</a>
    </li>
</ul>
                </div>
            </div>
            <div class="col-md-3 visible-sm visible-xs col-sm-3 col-xs-3 ps-rv">
                <div class="navbar-header text-right pull-right">
                    <button type="button" class="menu-control toggle-menu" id="open-menu">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="main">
    <div class="container">
        

        <div id="subheader1" class="clearfix">
            <div class="pull-left">
                
                <div id="breadcrumbs" class="breadcrumb">
                    <a href="/kb/it/">Knowledge Base</a>
                    


    
    » <a class="crumb" href="/kb/it/mariadb-italiano/">MariaDB - Italiano</a>
    

    
    » <a class="crumb" href="/kb/it/documentazione-di-mariadb/">Documentazione di MariaDB</a>
    

    
    » <a class="crumb" href="/kb/it/ottimizzazione/">Ottimizzazione</a>
    

    
    » <a class="crumb" href="/kb/it/buffer-e-cache/">Buffer e cache</a>
    


    » <a class="node_link crumb" href="/kb/it/the-query-cache/">La Query Cache</a>


                </div>
                
            </div>
        </div>
    </div>
    <div class="container" id="container-main">
        <div class="row">
            
            
                
                <aside id="sidebar-first" class="sidebar col-md-2 hidden-xs hidden-sm hidden-print">
                    
                        
                        <ul id="category_menu" class="nav nav-pills nav-stacked">
                            <li><a href="/kb/it/">Pagina iniziale</a></li>
                            
                                
                                    <li><a href="/kb/it/+questions/">Domande Aperte</a></li>
                                
                                <li><a href="/kb/it/documentation/">MariaDB Server</a></li>
                                <li><a href="/kb/it/maxscale/">MariaDB MaxScale</a></li>
                                <li><a href="/kb/it/mariadb-columnstore/">MariaDB ColumnStore</a></li>
                                <li><a href="/kb/it/connectors/">Connectors</a></li>
                            

                        </ul>
                    

                    
                        <div>
    

<div class="well well-small box actions"><div>

        <a class="btn btn-block btn-small" href="/kb/it/the-query-cache/">Return to article</a>
    
</div>
</div>

</div>
                    

                    

































                </aside>
            
            
            
                
            
            
            <section id="content" class="limited_width col-md-10 clearfix">
                
                    <h1>La Query Cache - Source</h1>
                

                



                <div>
                    

    

    
    <div class="revision_info">
        <dl class="table">
            <dt>Revisione</dt>
            <dd><a href="/kb/it/the-query-cache/+r/21476/">21476</a></dd>
            <dt>Utente</dt>
            <dd>
<span class="user" id="user-982">
<a href="/kb/user/id/982" title="Federico Razzoli">Federico Razzoli</a>
</span></dd>
            <dt>Data</dt>
            <dd>

<span class="datetime" title="2013-10-18 12:14">2013-10-18 12:14</span></dd>
        </dl>
    </div>
    


    

    
        
        <textarea id="answer_source" class="creole_source autogrow">&lt;&lt;toc&gt;&gt;
La cache delle query registra i risultati delle SELECT, in modo che in futuro, se si riceverà una query identica, sarà possibile restituire i risultati velocemente.

Questo è molto utile in ambienti high-read e low-write (come la maggior parte dei siti web).

== Configurare la Query Cache

Se MariaDB non è stata esplicitamente compilata senza la cache delle query, questa sarà sempre disponibile. La variabile server di sistema [[server-system-variables#have_query_cache|have_query_cache]] dice se la query cache è disponibile.

&lt;&lt;sql&gt;&gt;
MariaDB [(none)]&gt; SHOW VARIABLES LIKE &#39;have_query_cache&#39;;
+------------------+-------+
| Variable_name    | Value |
+------------------+-------+
| have_query_cache | YES   |
+------------------+-------+
&lt;&lt;/sql&gt;&gt;

Se è impostata a ##NO##, non sarà possibile abilitate la cache delle query a meno di non ricompilare o reinstallare una versione di MariaDB con la cache.

Per sapere se la cache è abilitata, si veda la variabile di sistema [[server-system-variables#query_cache_type|query_cache_type]]. Per abilitarla, si può impostare query_cache_type a ##1##.

== Come funziona la Query Cache

Quando la query cache è abilitata e una query SELECT viene elaborata, la cache delle query viene esaminata per vedere se contiene la query. Se non la contiene, la query verrà elaborata normalmente e registrata, con l&#39;insieme dei risultati, nella query cache. Se la query è già nella cache, i risultati vengono estratti dalla cache, il che è molto più semplice di un&#39;elaborazione normale.

Ogni volta che i dati della tabella vengono modificati, i risultati di tutte le query influenzate da quei dati vengono eliminati. Non è possibile in alcun modo leggere risultati obsoleti dalla cache delle query.

Quando lo spazio allocato per la query cache è pieno, i risultati più vecchi vengono eliminati.

== Query registrate nella Query Cache

Se la variabile di sistema [[server-system-variables#query_cache_type|query_cache_type]] è impostata a ##1##, o ##ON##, tutte le query che non superano le dimensioni massime vengono registrate nella cache, tranne il caso in cui contengano una clausola SQL_NO_CACHE, o il caso in cui per la loro natura il caching non abbia senso, per esempio se contengono una funzione che restituisce l&#39;ora corrente.

Se una delle seguenti funzioni è presente in una query, questa non verrà registrata nella cache:
 
&lt;&lt;style class=&#34;table-class&#34;&gt;&gt;

| [[benchmark|BENCHMARK()]] | [[connection_id|CONNECTION_ID()]] |
| [[convert_tz|CONVERT_TZ()]] | [[curdate|CURDATE()]] |
| [[current_date|CURRENT_DATE()]] | [[current_time|CURRENT_TIME()]] |
| [[current_timestamp|CURRENT_TIMESTAMP()]] | [[curtime|CURTIME()]] |
| [[database|DATABASE()]] | [[encrypt|ENCRYPT()]] (one parameter) |
| [[found_rows|FOUND_ROWS()]] | [[get_lock|GET_LOCK()]] |
| [[last_insert_id|LAST_INSERT_ID()]] | [[load_file|LOAD_FILE()]]	|
| [[master_pos_wait|MASTER_POS_WAIT() ]] | [[now|NOW()]] |
| [[rand|RAND()]] | [[release_lock|RELEASE_LOCK()]] |
| [[sleep|SLEEP()]] | [[sysdate|SYSDATE()]] |
| [[unix_timestamp|UNIX_TIMESTAMP()]] (no parameters) | [[user|USER()]] |
| [[uuid|UUID()]] | [[uuid_short|UUID_SHORT()]] |
&lt;&lt;/style&gt;&gt;

A query will also not be added to the cache if:
* it is of the form:
** SELECT SQL_NO_CACHE ...
** SELECT ... INTO OUTFILE ...
** SELECT ... INTO DUMPFILE ...
** SELECT ... FOR UPDATE
** SELECT * FROM ... WHERE autoincrement_column IS NULL
** SELECT ... LOCK IN SHARE MODE
* it uses TEMPORARY table
* it uses no tables at all
* it generates a warning
* the user has a column-level privilege on any table in the query
* it accesses a partitioned table (&gt;=MariaDB/MySQL 5.5.23)
* it accesses a table from INFORMATION_SCHEMA, mysql or the performance_schema database
* it makes use of user or local variables
* it makes use of stored functions
* it makes use of user-defined functions
* it is inside a transaction with the SERIALIZABLE isolation level

The query itself can also specify that it is not to be stored in the cache by using the SQL_NO_CACHE attribute. Query-level control is an effective way to use the cache more optimally.

It is also possible to specify that //no// queries must be stored in the cache unless the query requires it. To do this, the [[server-system-variables#query_cache_type|query_cache_type]] server variable must be set to ##2##, or ##DEMAND##. Then, only queries with the SQL_NO_CACHE attribute are cached.

== Limiting the size of the Query Cache

There are two main ways to limit the size of the query cache. First, the overall size in bytes is determined by the [[server-system-variables#query_cache_size|query_cache_size]] system variable. About 40KB is needed for various query cache structures, and setting the variable to a size lower than this will result in a warning.

The query cache size is allocated in 1024 byte-blocks. Setting a size that is not a multiple of 1024 will result in it being rounded down the nearest multiple, and a warning being triggered.

&lt;&lt;sql&gt;&gt;
MariaDB [(none)]&gt; SHOW VARIABLES LIKE &#39;query_cache_size&#39;;
+------------------+----------+
| Variable_name    | Value    |
+------------------+----------+
| query_cache_size | 67108864 |
+------------------+----------+

MariaDB [(none)]&gt; SET GLOBAL query_cache_size = 8000000;
Query OK, 0 rows affected, 1 warning (0.03 sec)

MariaDB [(none)]&gt; SHOW VARIABLES LIKE &#39;query_cache_size&#39;;
+------------------+---------+
| Variable_name    | Value   |
+------------------+---------+
| query_cache_size | 7999488 |
+------------------+---------+
&lt;&lt;/sql&gt;&gt;

The ideal size of the query cache is very dependent on the specific needs of each system. Setting a value too small will result in query results being dropped from the cache when they could potentially be re-used later. Setting a value too high could result in reduced performance due to lock contention, as the query cache is locked during updates.

The second way to limit the cache is to have a maximum size for each set of query results. This prevents a single query with a huge result set taking up most of the available memory and knocking a large number of smaller queries out of the cache. This is determined by the [[server-system-variables#query_cache_limit|query_cache_limit]] system variable.

== Examining the Query Cache
A number of status variables provide information about the query cache.

&lt;&lt;sql&gt;&gt;
MariaDB [(none)]&gt; SHOW STATUS LIKE &#39;Qcache%&#39;;
+-------------------------+----------+
| Variable_name           | Value    |
+-------------------------+----------+
| Qcache_free_blocks      | 1158     |
| Qcache_free_memory      | 3760784  |
| Qcache_hits             | 31943398 |
| Qcache_inserts          | 42998029 |
| Qcache_lowmem_prunes    | 34695322 |
| Qcache_not_cached       | 652482   |
| Qcache_queries_in_cache | 4628     |
| Qcache_total_blocks     | 11123    |
+-------------------------+----------+
&lt;&lt;/sql&gt;&gt;

##Qcache_inserts## contains the number of queries added to the query cache, ##Qcache_hits## contains the number of queries that have made use of the query cache, while ##Qcache_lowmem_prunes## contains the number of queries that were dropped from the cache due to lack of memory.

The above example could indicate a poorly performing cache. More queries have been added, and more queries have been dropped, than have actually been used.

Note that queries returned from the query cache do not increment the ##Com_select## status variable, so to find the total number of valid queries run on the server, add ##Com_select## to ##Qcache_hits##.

== Query Cache Fragmentation
The Query Cache uses blocks of variable length, and over time may become fragmented. A high ##Qcache_free_blocks## relative to ##Qcache_total_blocks## may indicate fragmentation. [[flush-query-cache|FLUSH QUERY CACHE]] will defragment the query cache without dropping any queries:

&lt;&lt;sql&gt;&gt;
MariaDB [(none)]&gt; FLUSH QUERY CACHE;
&lt;&lt;/sql&gt;&gt;

After this, there will only be one free block:

&lt;&lt;sql&gt;&gt;
MariaDB [(none)]&gt; SHOW STATUS LIKE &#39;Qcache%&#39;;
+-------------------------+----------+
| Variable_name           | Value    |
+-------------------------+----------+
| Qcache_free_blocks      | 1        |
| Qcache_free_memory      | 6101576  |
| Qcache_hits             | 31981126 |
| Qcache_inserts          | 43002404 |
| Qcache_lowmem_prunes    | 34696486 |
| Qcache_not_cached       | 655607   |
| Qcache_queries_in_cache | 4197     |
| Qcache_total_blocks     | 8833     |
+-------------------------+----------+
&lt;&lt;/sql&gt;&gt;

== Emptying and Disabling the Query Cache

To empty, or clear all results from the query cache, use [[reset|RESET QUERY CACHE]]. [[flush|FLUSH TABLES]] will have the same effect.

Setting either [[[[server-system-variables#query_cache_type|query_cache_type]] or [[server-system-variables#query_cache_size|query_cache_size]] to ##0## will disable the query cache, but to free up the most resources, set both to ##0## when you wish to disable caching.</textarea>
    


                    <div id="content_disclaimer" class="graybox">
                        Content reproduced on this site is the property of its respective owners,
                        and this content is not reviewed in advance by MariaDB. The views, information and opinions
                        expressed by this content do not necessarily represent those of MariaDB or any other party.
                    </div>
                </div>
            </section>

            
        </div>
    </div>
</div>

<!-- Footer -->
<footer id="footer">
    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-xs-12">
                    <ul class="list-inline text-center footer-nav">
                        <li>
                            <h5>
                                <a href="https://mariadb.com/products" title="Products">Products</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/solutions" title="Solutions">Solutions</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/resources" title="Resources">Resources</a>
                            </h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/about-us" title="About MariaDB">Company</a></h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/pricing" title="Pricing">Pricing</a>
                            </h5>
                        </li>
                        
                        
                        <li>
                            <h5><a href="https://mariadb.com/downloads" title="Download">Download MariaDB</a></h5>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="row row-10">
                
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div id="block-footerformcontact" class="block block-block-content block-block-contentd754ee1b-3cc9-40e7-9ef4-f504f1197fb1">
                        
                            <h5 style="font-weight: 400;">Subscribe to our newsletter!</h5>
                            <script src="//app-sj15.marketo.com/js/forms2/js/forms2.min.js"></script><form id="mktoForm_1498"></form>
                            <script>
                                <!--//--><![CDATA[// ><!--
                                MktoForms2.loadForm("//app-sj15.marketo.com", "573-PXI-984", 1498);
                                //--><!]]]]><![CDATA[>
                                //--><!]]>
                            </script>
                        
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div class="footer-copyright">
                        <div class="text-center">
                            <ul class="list-inline no-margin">
                                <li>
                                    <a href="/legal" title="Legal">Legal</a>
                                </li>
                                <li>
                                    <a href="/privacy-policy" title="Privacy Policy">Privacy Policy</a>
                                </li>
                                <li>
                                    <a href="/cookie-policy/" title="Cookies">Cookie Policy</a>
                                </li>
                            </ul>
                            <p>Copyright &copy; 2025 MariaDB. All rights reserved.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</footer>
</div>

<div id="ajax_loading">
    <img src="/kb/static/images/ajax-loader.a51c5608d01a.gif" />
</div>

    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MK2847"
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MK2847');</script>
    <!-- End Google Tag Manager -->

</body>

<script type="text/javascript" src="/kb/static/js/main.1587e3a666fc.js" charset="utf-8"></script>

</html>