<!DOCTYPE html>
<html>
<head data-cookie-domain=""
      data-cookie-path="/">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="apple-touch-icon" sizes="180x180" href="/kb/static/images/favicons/apple-touch-icon.159e713979be.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/kb/static/images/favicons/favicon-32x32.bc0ac1d5d11e.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/kb/static/images/favicons/favicon-16x16.5801f8f0f34e.png">
    <link rel="shortcut icon" href="/kb/static/images/favicons/favicon.d122d305dee4.ico" type="image/x-icon" />

    <title>Usare la libreria client non-bloccante - MariaDB Knowledge Base</title>

    <link href="/kb/static/css/main.f7633538c846.css" rel="stylesheet" type="text/css" />

    

    

    <!-- FB Open Graph tags -->
    <meta property="og:title" content="Usare la libreria client non-bloccante" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://mariadb.com/kb/it/using-the-non-blocking-library/" />
    <meta property="og:image" content="http://mariadb.comaskmonty-logo.png" />
    <meta property="og:site_name" content="MariaDB KnowledgeBase" />
    <meta property="fb:admins" content="514852603" />
    <meta property="og:description" content="
L&#39;API client non-bloccante di MariaDB è progettata allo stesso modo delle normali chiamate bloccanti, perché sia più semplice apprenderla e ricordarla. E&#39; inoltre semplice tr..." />

    <meta name="description" content="
L&#39;API client non-bloccante di MariaDB è progettata allo stesso modo delle normali chiamate bloccanti, perché sia più semplice apprenderla e ricordarla. E&#39; inoltre semplice tr..." />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet"/>
    
</head>
<body class="mpkb nodes products nodes_view jqui" id="nodes_view">





<div id="menu-mobile" class="visible-sm visible-xs">

    <div>
        <div id="mobile-close-menu" class="text-right">
            <a href="javascript:void(0)" title="Close Menu" id="back-main" class="toggle-menu">X<span></span></a>
        </div>
    </div>
    <div class="mainmenu-mobile">
        <ul class="ls-none ul-menu">
            <li data-sub="submenu5"><a class="open-form-search" href="/kb/search/" title="Search">Search </a></li>
            <li data-sub="submenu0"><a href="/products" title="Products">Products</a><span class="arrow-main"></span></li>
            <li data-sub="submenu1"><a href="/services" title="Services">Services</a><span class="arrow-main"></span></li>
            <li data-sub="submenu2"><a href="/resources" title="Resources">Resources</a><span class="arrow-main"></span></li>
            <li data-sub="submenu3"><a href="/about-us" title="About">About</a><span class="arrow-main"></span></li>
            <li data-sub="submenu4"><a href="/contact" title="Contact">Contact</a></li>
        </ul>
    </div>

    <div class="nav-top-mobile">
        <div class="select-box form">

            <ul class="inline-block-md mb-none top-nav">
                <li>

                </li>
                
                    <li>
                        <a href="/kb/user/login?next=/kb/it/using-the-non-blocking-library/"> Login</a>
                    </li>
                
            </ul>



        </div>
        <p class="text-center copyright">Copyright &copy; 2025 MariaDB. All rights reserved.</p>
    </div>
</div>
<div class="violator-wrap d-none" id="top_violator">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12">
                <div class="violator-outer">
                    <div class="violator-inner">
                        <div class="row">
                            <div class="col-xs-12 col-sm-9 col-lg-7 col-lg-offset-2" id="top_violator_content">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="content-link" target="_blank" rel="nofollow noreferrer">
                                    <span>The Ultimate Guide to High Availability with MariaDB</span>
                                </a>
                            </div>
                            <div class="col-xs-12 col-sm-3" id="top_violator_cta">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="btn btn-mariadb" target="_blank" rel="nofollow noreferrer">Download Now</a>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-link close-btn">
                        <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24" width="15px" height="15px"><path d="M 4.9902344 3.9902344 A 1.0001 1.0001 0 0 0 4.2929688 5.7070312 L 10.585938 12 L 4.2929688 18.292969 A 1.0001 1.0001 0 1 0 5.7070312 19.707031 L 12 13.414062 L 18.292969 19.707031 A 1.0001 1.0001 0 1 0 19.707031 18.292969 L 13.414062 12 L 19.707031 5.7070312 A 1.0001 1.0001 0 0 0 18.980469 3.9902344 A 1.0001 1.0001 0 0 0 18.292969 4.2929688 L 12 10.585938 L 5.7070312 4.2929688 A 1.0001 1.0001 0 0 0 4.9902344 3.9902344 z"/></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="wrapper">
<div id="top-nav">
    <div class="container">
        <ul class="hidden-sm hidden-xs" >
            <li><a href="https://mariadb.com/kb/">Knowledge Base</a></li>
            <li><a href="https://mariadb.com/contact/">Contact</a></li>
            
                
                    <li>
                        <a href="/kb/user/login?next=/kb/it/using-the-non-blocking-library/" rel="nofollow">Accesso</a>
                    </li>
                
            
            
            <li id="search-form">
                <form action="/kb/it/+search/" method="get" id="search-block-form" accept-charset="UTF-8">
                    <input id="search" title="Enter the terms you wish to search for."
                           placeholder="Search . . ." type="text"
                           name="q" value="" size="15" maxlength="128" class="form-text"
                           data-autocomplete-url="/kb/it/+search/autocomplete/">
                    <input type="hidden" name="quick" value="1" />
                    <input type="hidden" name="source" value="kb" />
                </form>
            </li>
            <li><a id="search-toggler" href="/kb/search/">Search</a></li>
            
        </ul>
    </div>
</div>
<div id="navbar-bottom" class="navbar">
    <div class="container">
        
        
        
        
        <div class="row">
            <div class="col-md-3 col-sm-9 col-xs-9">
                <a class="brand" href="/" title="MariaDB">
                    <img src="/kb/static/images/logo-2018-black.95f5978ae14d.png">
                </a>
            </div>
            <div class="col-md-9 hidden-sm hidden-xs">
                <div class="main-menu">
                    <ul id="main-menu" class="nav navbar-nav inline-block-sm">
    <li class="has-sub full-menu">
        <a href="/products" title="Products">Products</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/solutions" title="Solutions">Solutions</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/resources" title="Resources">Resources</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/about-us" title="Company">Company</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/pricing" title="Pricing">Pricing</a>
    </li>
    
    <li class="">
        <a class="button electric-eel small top-bar-right-download" href="/downloads/">Download</a>
    </li>
</ul>
                </div>
            </div>
            <div class="col-md-3 visible-sm visible-xs col-sm-3 col-xs-3 ps-rv">
                <div class="navbar-header text-right pull-right">
                    <button type="button" class="menu-control toggle-menu" id="open-menu">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="main">
    <div class="container">
        

        <div id="subheader1" class="clearfix">
            <div class="pull-left">
                
                <div id="breadcrumbs" class="breadcrumb">
                    <a href="/kb/it/">Knowledge Base</a>
                    


    
    » <a class="crumb" href="/kb/it/mariadb-italiano/">MariaDB - Italiano</a>
    

    
    » <a class="crumb" href="/kb/it/sviluppo/">Sviluppo</a>
    

    
    » <a class="crumb" href="/kb/it/usare-mariadb-con-i-propri-programmi-api/">Usare MariaDB con i propri programmi (API)</a>
    

    
    » <a class="crumb" href="/kb/it/libreria-client-non-bloccante/">Libreria client non bloccante</a>
    


    » <a class="node_link crumb" href="/kb/it/using-the-non-blocking-library/">Usare la libreria client non-bloccante</a>


                </div>
                
            </div>
        </div>
    </div>
    <div class="container" id="container-main">
        <div class="row">
            
            
                
                <aside id="sidebar-first" class="sidebar col-md-2 hidden-xs hidden-sm hidden-print">
                    
                        
                        <ul id="category_menu" class="nav nav-pills nav-stacked">
                            <li><a href="/kb/it/">Pagina iniziale</a></li>
                            
                                
                                    <li><a href="/kb/it/+questions/">Domande Aperte</a></li>
                                
                                <li><a href="/kb/it/documentation/">MariaDB Server</a></li>
                                <li><a href="/kb/it/maxscale/">MariaDB MaxScale</a></li>
                                <li><a href="/kb/it/mariadb-columnstore/">MariaDB ColumnStore</a></li>
                                <li><a href="/kb/it/connectors/">Connectors</a></li>
                            

                        </ul>
                    

                    
<div>



<div class="well well-small box actions"><div>

        <a class="btn btn-block btn-blue btn-sm" href="/kb/it/using-the-non-blocking-library/+history" rel="nofollow">Cronologia</a>
        
        
        
        <a class="btn btn-block btn-blue btn-sm" href="/kb/it/using-the-non-blocking-library/+source/">Source</a>
        
        <a class="btn btn-block btn-blue btn-sm flag" href="/kb/it/using-the-non-blocking-library/+flag"
                data-flag-url="/kb/it/using-the-non-blocking-library/+flag" rel="nofollow">
                Flag as Spam / Inappropriate</a>
        
        <a class="btn btn-block btn-blue btn-sm" href="/kb/it/using-the-non-blocking-library/+translate/">
                Traduci</a>
        

</div>
</div>





<div class="well well-small box node_info"><div>

    <dl>
        <dt>Creato</dt>
        <dd>

<span class="datetime" title="2012-03-05 14:57">13 anni, 2 mesi ago</span></dd>

        <dt>Modificato</dt>
        <dd>

<span class="datetime" title="2012-04-14 08:08">13 anni, 1 mese ago</span></dd>

        <dt>Tipo</dt>
        <dd>article</dd>

        <dt>Stato</dt>
        <dd>active</dd>

        <dt>Licenza</dt>
        <dd>
            
                <a href="/kb/it/using-the-non-blocking-library/+license/">CC BY-SA / Gnu FDL</a>
            
        </dd>

        
    </dl>

    
    <ul class="rss_feeds">
        <li><a href="/kb/it/using-the-non-blocking-library/+history/feed/">
            Cronologia</a>
        </li>
        <li><a href="/kb/it/using-the-non-blocking-library/+comments/feed/">
            Commenti</a>
        </li>
    </ul>
    

</div>
</div>





    
    
    

<div class="well well-small box attachments"><div><div class="edit_link pull-right"><a href="/kb/it/using-the-non-blocking-library/+edit/attachments/">Edit</a></div><h5>Attachments</h5></div><div>

        
            <div class="no_data">No attachments exist</div>
        
    
</div>
</div>

    



    
    
        

<div class="well well-small box"><div><h5>Versioni Localizzate</h5></div><div>

        <ul>
            
            <li><a href="/kb/en/using-the-non-blocking-library/">Using the Non-blocking Library</a> [en]</li>
            
        </ul>
        
</div>
</div>

    






</div>


                    

































                </aside>
            
            
            
                
            
            
                
            
            <section id="content" class="limited_width col-md-8 clearfix">
                
                    <h1>Usare la libreria client non-bloccante</h1>
                

                



                <div>
                    
    

    
    
    

    <div class="node creole">
        
        
        


    
    <div class="answer formatted">
        <div class="table_of_contents well well-small">
<h3>Contents</h3>
 <ol class="toc">

    <li class=""><a href="#impostare-mysql_opt_nonblock" title="Impostare MYSQL_OPT_NONBLOCK">Impostare MYSQL_OPT_NONBLOCK</a></li>

    <li class=""><a href="#combinare-operazioni-bloccanti-e-non-bloccanti" title="Combinare operazioni bloccanti e non-bloccanti">Combinare operazioni bloccanti e non-bloccanti</a></li>

    <li class=""><a href="#terminare-una-operazione-non-bloccante-prima-del-tempo" title="Terminare una operazione non-bloccante prima del tempo">Terminare una operazione non-bloccante prima del tempo</a></li>

    <li class=""><a href="#restrizioni" title="Restrizioni">Restrizioni</a>    <ol class="toc">

        <li class=""><a href="#dns" title="DNS">DNS</a></li>

        <li class=""><a href="#connessioni-con-le-named-pipes-e-la-memoria-condivisa-di-windows" title="Connessioni con le Named Pipes e la memoria condivisa di Windows">Connessioni con le Named Pipes e la memoria condivisa di Windows</a>    </ol>
 </ol>
</li>
</div>
<p>L'API client non-bloccante di MariaDB è progettata allo stesso modo delle normali chiamate bloccanti, perché sia più semplice apprenderla e ricordarla. E' inoltre semplice tradurre il codice che utilizza l'API bloccante in modo che utilizzi quella non-bloccante (o vice versa). Infine è facile mischiare chiamate bloccanti e chiamate non bloccanti nelle stesse porzioni di codice.</p>
<p>Per ogni chiamata alla libreria che potrebbe bloccare i socket I/o, come '<code class="fixed" style="white-space:pre-wrap">int mysql_real_query(MYSQL, query, lunghezza_query)</code>', sono state introdotte due nuove funzioni non-bloccanti:</p>
<pre class="fixed"><span class="kt">int</span> <span class="n">mysql_real_query_start</span><span class="p">(</span><span class="o">&amp;</span><span class="n">status</span><span class="p">,</span> <span class="n">MYSQL</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">lunghezza_query</span><span class="p">)</span>
<span class="kt">int</span> <span class="n">mysql_real_query_start</span><span class="p">(</span><span class="o">&amp;</span><span class="n">status</span><span class="p">,</span> <span class="n">MYSQL</span><span class="p">,</span> <span class="n">stato_di_attesa</span><span class="p">)</span>
</pre><p>Per effettuare operazioni non bloccanti, una applicazione chiama prima <code>mysql_real_query_start()</code> invece di <code>mysql_real_query()</code>, passando gli stessi parametri.</p>
<p>Se <code>mysql_real_query_start()</code> restituisce zero, allora l'operazione è stata completata senza blocchi, e 'status' è impostato al valore che normalmente verrebbe restituito da <code>mysql_real_query()</code>.</p>
<p>Altrimenti, il valore restituito da <code>mysql_real_query_start()</code> è una maschera di bit che indica gli eventi che la libreria sta aspettando. Può essere <code>MYSQL_WAIT_READ</code>, <code>MYSQL_WAIT_WRITE</code> o <code>MYSQL_WAIT_EXCEPT</code>, che corrispondono ai flag simili di <code>select()</code> e <code>poll()</code>; può includere <code>MYSQL_WAIT_TIMEOUT</code> quando attende il verificarsi di un timeout (ad esempio il timeout della connessione).</p>
<p>In questo caso, l'applicazione continua l'esecuzione ed eventualmente controlla che le condizioni appropriate si verifichino nel socket (o attende il timeout). Quando accade, l'applicazione può recuperare l'operazione chiamando  <code>mysql_real_query_cont()</code>, passando in 'wait_status' una maschera di bit che indica gli eventi effettivamente verificatisi.</p>
<p>Così come <code>mysql_real_query_start()</code>, <code>mysql_real_query_cont()</code> restituisce zero quando ha terminato, o una maschera di bit degli eventi che deve attendere. Quindi l'applicazione continua ripetutamente a chiamare <code>mysql_real_query_cont()</code>, intervallato con altre elaborazioni a suo piacimento, finché non viene restituito zero; dopodiché il risultato dell'operazione verrà registrato in 'status'.</p>
<p>Alcune chiamate, come <code>mysql_option()</code>, non utilizzano alcun socket I/O, pertanto non bloccano mai l'esecuzione. Per queste funzioni, non vi sono chiamate separate <code>_start()</code> e <code>_cont()</code>. Si veda la pagina "<a href="/kb/en/non-blocking-api-reference/">Riferimento all'API non-bloccante</a>" per un elenco completo delle funzioni bloccanti e quelle non-bloccanti.</p>
<p>Il controllo degli eventi sui socket / timeout può essere effettuato con <code>select()</code>, o <code>poll()</code>, o un meccanismo simile. Però spesso viene fatto utilizzando un framework di livello più altro (come libevent), che fornisce meccanismi per registrare ed effettuare certe azioni al determinarsi di certe condizioni.</p>
<p>Il descrittore del socket che deve essere controllato quando si attendono gli eventi può essere ottenuto con <code>mysql_get_socket()</code>. La durata di un qualsiasi timeout si può ottenere con <code>mysql_get_timeout_value()</code>.</p>
<p>Ecco un esempio triviale (ma completo) su come eseguire una query con l'API non-bloccante. L'esempio è reperibile nei sorgenti di MariaDB, in <code>client/async_example.c</code>. (Un altro esempio più esteso e realistico, che fa uso di libevent, si trova in <code>tests/async_queries.c</code>):</p>
<pre class="fixed"><span class="k">static</span> <span class="kt">void</span> <span class="nf">run_query</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">host</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">user</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">password</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">err</span><span class="p">,</span> <span class="n">status</span><span class="p">;</span>
  <span class="n">MYSQL</span> <span class="n">mysql</span><span class="p">,</span> <span class="o">*</span><span class="n">ret</span><span class="p">;</span>
  <span class="n">MYSQL_RES</span> <span class="o">*</span><span class="n">res</span><span class="p">;</span>
  <span class="n">MYSQL_ROW</span> <span class="n">row</span><span class="p">;</span>

  <span class="n">mysql_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mysql</span><span class="p">);</span>
  <span class="n">mysql_options</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mysql</span><span class="p">,</span> <span class="n">MYSQL_OPT_NONBLOCK</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

  <span class="n">status</span> <span class="o">=</span> <span class="n">mysql_real_connect_start</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ret</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">mysql</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  <span class="k">while</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">wait_for_mysql</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mysql</span><span class="p">,</span> <span class="n">status</span><span class="p">);</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">mysql_real_connect_cont</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ret</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">mysql</span><span class="p">,</span> <span class="n">status</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ret</span><span class="p">)</span>
    <span class="n">fatal</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mysql</span><span class="p">,</span> <span class="s">&quot;Failed to mysql_real_connect()&quot;</span><span class="p">);</span>

  <span class="n">status</span> <span class="o">=</span> <span class="n">mysql_real_query_start</span><span class="p">(</span><span class="o">&amp;</span><span class="n">err</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">mysql</span><span class="p">,</span> <span class="n">SL</span><span class="p">(</span><span class="s">&quot;SHOW STATUS&quot;</span><span class="p">));</span>
  <span class="k">while</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">wait_for_mysql</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mysql</span><span class="p">,</span> <span class="n">status</span><span class="p">);</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">mysql_real_query_cont</span><span class="p">(</span><span class="o">&amp;</span><span class="n">err</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">mysql</span><span class="p">,</span> <span class="n">status</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span>
    <span class="n">fatal</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mysql</span><span class="p">,</span> <span class="s">&quot;mysql_real_query() returns error&quot;</span><span class="p">);</span>

  <span class="cm">/* Questo metodo non può bloccare. */</span>
  <span class="n">res</span><span class="o">=</span> <span class="n">mysql_use_result</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mysql</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">res</span><span class="p">)</span>
    <span class="n">fatal</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mysql</span><span class="p">,</span> <span class="s">&quot;mysql_use_result() returns error&quot;</span><span class="p">);</span>

  <span class="k">for</span> <span class="p">(;;)</span> <span class="p">{</span>
    <span class="n">status</span><span class="o">=</span> <span class="n">mysql_fetch_row_start</span><span class="p">(</span><span class="o">&amp;</span><span class="n">row</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">status</span><span class="o">=</span> <span class="n">wait_for_mysql</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mysql</span><span class="p">,</span> <span class="n">status</span><span class="p">);</span>
      <span class="n">status</span><span class="o">=</span> <span class="n">mysql_fetch_row_cont</span><span class="p">(</span><span class="o">&amp;</span><span class="n">row</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">status</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">row</span><span class="p">)</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">mysql_errno</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mysql</span><span class="p">))</span>
    <span class="n">fatal</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mysql</span><span class="p">,</span> <span class="s">&quot;Got error while retrieving rows&quot;</span><span class="p">);</span>
  <span class="n">mysql_free_result</span><span class="p">(</span><span class="n">res</span><span class="p">);</span>
  <span class="n">mysql_close</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mysql</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Funzione ausiliare che attende gli eventi nel socket. */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">wait_for_mysql</span><span class="p">(</span><span class="n">MYSQL</span> <span class="o">*</span><span class="n">mysql</span><span class="p">,</span> <span class="kt">int</span> <span class="n">status</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">struct</span> <span class="n">pollfd</span> <span class="n">pfd</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">timeout</span><span class="p">,</span> <span class="n">res</span><span class="p">;</span>

  <span class="n">pfd</span><span class="p">.</span><span class="n">fd</span> <span class="o">=</span> <span class="n">mysql_get_socket</span><span class="p">(</span><span class="n">mysql</span><span class="p">);</span>
  <span class="n">pfd</span><span class="p">.</span><span class="n">events</span> <span class="o">=</span>
    <span class="p">(</span><span class="n">status</span> <span class="o">&amp;</span> <span class="n">MYSQL_WAIT_READ</span> <span class="o">?</span> <span class="nl">POLLIN</span> <span class="p">:</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span>
    <span class="p">(</span><span class="n">status</span> <span class="o">&amp;</span> <span class="n">MYSQL_WAIT_WRITE</span> <span class="o">?</span> <span class="nl">POLLOUT</span> <span class="p">:</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span>
    <span class="p">(</span><span class="n">status</span> <span class="o">&amp;</span> <span class="n">MYSQL_WAIT_EXCEPT</span> <span class="o">?</span> <span class="nl">POLLPRI</span> <span class="p">:</span> <span class="mi">0</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&amp;</span> <span class="n">MYSQL_WAIT_TIMEOUT</span><span class="p">)</span>
    <span class="n">timeout</span> <span class="o">=</span> <span class="mi">1000</span><span class="o">*</span><span class="n">mysql_get_timeout_value</span><span class="p">(</span><span class="n">mysql</span><span class="p">);</span>
  <span class="k">else</span>
    <span class="n">timeout</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="n">res</span> <span class="o">=</span> <span class="n">poll</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pfd</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">timeout</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">res</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">MYSQL_WAIT_TIMEOUT</span><span class="p">;</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">res</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">MYSQL_WAIT_TIMEOUT</span><span class="p">;</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pfd</span><span class="p">.</span><span class="n">revents</span> <span class="o">&amp;</span> <span class="n">POLLIN</span><span class="p">)</span> <span class="n">status</span> <span class="o">|=</span> <span class="n">MYSQL_WAIT_READ</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pfd</span><span class="p">.</span><span class="n">revents</span> <span class="o">&amp;</span> <span class="n">POLLOUT</span><span class="p">)</span> <span class="n">status</span> <span class="o">|=</span> <span class="n">MYSQL_WAIT_WRITE</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pfd</span><span class="p">.</span><span class="n">revents</span> <span class="o">&amp;</span> <span class="n">POLLPRI</span><span class="p">)</span> <span class="n">status</span> <span class="o">|=</span> <span class="n">MYSQL_WAIT_EXCEPT</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">status</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre><h2 class="anchored_heading" id="impostare-mysql_opt_nonblock">Impostare MYSQL_OPT_NONBLOCK</h2>
<p>Prima di utilizzare le operazioni non-bloccanti, è necessario abilitare impostando l'opzione <code>MYSQL_OPT_NONBLOCK</code>:</p>
<pre class="fixed"><span class="n">mysql_options</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mysql</span><span class="p">,</span> <span class="n">MYSQL_OPT_NONBLOCK</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</pre><p>Questa chiamata può essere effettuata in qualsiasi momento <span>&mdash;</span> tipicamente si trova all'inizio, prima di <code>mysql_real_connect()</code> <span>&mdash;</span> per iniziare ad utilizzare le operazioni non-bloccanti.</p>
<p>Se si tenta di eseguire un'operazione non bloccante senza impostare l'opzione <code>MYSQL_OPT_NONBLOCK</code>, normalmente il programma va in crash con un'eccezione di puntatore <code>NULL</code>.</p>
<p>L'argomento di <code>MYSQL_OPT_NONBLOCK</code> indica le dimensioni dellos tack utilizzato per salvare lo stato dell'operazione non-bloccante quando questa attende l'I/O e l'applicazione sta facendo altro. Normalmente, le applicazioni non hanno mai bisogno di modificare questo argomento, ed è possibile passare uno zero per impostarlo al valore predefinito. </p>
<h2 class="anchored_heading" id="combinare-operazioni-bloccanti-e-non-bloccanti">Combinare operazioni bloccanti e non-bloccanti</h2>
<p>E' possibile combinare azioni bloccanti e non-bloccanti sulla stessa connessione a <code>MYSQL</code>.</p>
<p>Un'applicazione può perciò effettuare un normale <code>mysql_real_connect()</code> bloccante e in seguito eseguire un <code>mysql_real_query_start()</code> non-bloccante. Viceversa, può anche effettuare <code>mysql_real_connect_start()</code> e più tardi <code>mysql_real_query()</code> sulla connessione restituita.</p>
<p>Combinare queste operazioni può essere utile per scrivere codice che utilizzi la più semplice API bloccante laddove le attese non sono un problema. Per esempio può stabilire la connessione all'avvio del programma, o lanciare piccole query che vengono eseguite in mezzo ad altre, che richiedono molto più tempo.</p>
<p>L'unica restrizione è che, prima di iniziare una nuova operazione (bloccante o meno) tutte le precedenti operazioni non-bloccanti devono essere concluse. Si veda la prossima sezione sotto: "Terminare una operazione non-bloccante prima del tempo".</p>
<h2 class="anchored_heading" id="terminare-una-operazione-non-bloccante-prima-del-tempo">Terminare una operazione non-bloccante prima del tempo</h2>
<p>Quando una operazione non-bloccante viene lanciata con <code>mysql_real_query_start()</code> o qualche altra funzione <code>_start()</code>, deve terminare prima che una nuova operazione possa iniziare. Per questo l'applicazione deve continuare a chiamare <code>mysql_real_query_cont()</code> finché non viene restituito zero, che significa che l'operazione è stata completata. Non è permesso lanciare un'operazione "in attesa" a metà della sua esecuzione e avviarne una nuova.</p>
<p>E' tuttavia permesso terminare la connessione completamente con <code>mysql_close()</code> anche mentre un'operazione non-bloccante è ancora in esecuzione. Una nuova connessione dovrà poi essere istanziata con <code>mysql_real_connect</code>, prima che altre query possano essere lanciate, sia che si utilizzi un nuovo oggetto <code>MYSQL</code> sia che si riusi quello vecchio.</p>
<p>In futuro, potrebbe essere implementato un nuovo meccanismo di abort, che permetta di terminare forzatamente un'operazione in corso appena possibile (ma sarà comunque necessario chiamara <code>mysql_real_query_cont()</code> un'ultima volta dopo l'abort, perché ripulisca l'operazione e restituisca immediatamente il codice di errore opportuno).</p>
<h2 class="anchored_heading" id="restrizioni">Restrizioni</h2>
<h3 class="anchored_heading" id="dns">DNS</h3>
<p>Quando un nome host viene passato a <code>mysql_real_connect_start()</code> (invece di un socket Unix locale o un indirizzo IP), la libreria potrebbe aver bisogno di cercare il nome host in un DNS, a seconda della configurazione che si ha (per esempio se il nome non è in <code>/etc/hosts</code> o nella cache). Queste ricerche DNS <strong>non</strong> sono in modalità non-bloccante. Questo significa che that <code>mysql_real_connect_start()</code> non restituisce il controllo all'applicazione mentre attende la risposta dal DNS. Perciò l'applicazione potrebbe rimanere bloccata per un po', se il DNS è lento o non è in funzione.</p>
<p>Se questo è un problema, l'applicazione può passare un indirizzo IP anzichè un nome host a <code>mysql_real_connect_start()</code>. L'indirizzo IP può essere ottenuto dall'applicazione con una qualsiasi operazione di ricerca DNS non bloccante che sia disponibile nel sistema operativo o nei framework utilizzati. In alternativa, una soluzione semplice potrebbe essere aggiungere il nome al file locale degli host (<code>/etc/hosts</code> su macchine Posix/Unix/Linux).</p>
<h3 class="anchored_heading" id="connessioni-con-le-named-pipes-e-la-memoria-condivisa-di-windows">Connessioni con le Named Pipes e la memoria condivisa di Windows</h3>
<p>L'API non bloccante non supporta in alcun modo le connessioni attraverso le named pipes o la memoria condivisa di Windows.</p>
<p>E' comunque possibile usarle, sia con l'API bloccante sia con quella non-bloccante. Tuttavia, le operazioni che necessitano di attendere l'I/O su una named pipe non restituiscono il controllo all'applicazione, ma la tengono bloccata finché non saranno completate, esattamente come le normali chiamate all'API bloccante.</p>

    </div>


        
            <div id="subscribe" class="well well-small hide hidden-print"
                 data-subscribe-url="/kb/it/using-the-non-blocking-library/+subscriptions/add"
                 data-unsubscribe-url="/kb/it/using-the-non-blocking-library/+subscriptions/remove">
            </div>
        

        
        
    
        <div class="simple_section_nav">
            <ul class="nav nav-pills">
                
                    <li><a href="/kb/it/mariasql-for-nodejs/">
                        ← mariasql per node.js
                    </a>
                    </li>
                
                
                    <li><a href="/kb/it/libreria-client-non-bloccante/">
                        ↑ Libreria client non bloccante ↑
                    </a>
                    </li>
                
                
            </ul>
        </div>
    

        

        
        <h2>Commenti</h2>
        
    
    <div id="comments" data-node-id="2440" data-comments-url="/kb/it/using-the-non-blocking-library/+comments"
         data-reply-url="/kb/it/using-the-non-blocking-library/comments/post/">
        Sto caricando i commenti......
    </div>

        

    </div>


                    <div id="content_disclaimer" class="graybox">
                        Content reproduced on this site is the property of its respective owners,
                        and this content is not reviewed in advance by MariaDB. The views, information and opinions
                        expressed by this content do not necessarily represent those of MariaDB or any other party.
                    </div>
                </div>
            </section>

            
                <div id="right_bar" class="col-md-2">
                    
    
        
        <ul class="section_navigation well well-small hidden-xs hidden-sm">
            
                <li class="parent"><a href="/kb/it/libreria-client-non-bloccante/">
                    ↑ Libreria client non bloccante ↑
                </a>
                </li>
            
            
                
                    <li>
                        <a href="/kb/it/non-blocking-api-reference/">
                            
                            Guida di riferimento dell&#39;API non-bloccante
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/it/informazioni-sulle-operazioni-non-bloccanti-nella-libreria-client/">
                            
                            Informazioni sulle operazioni non-bloccanti nella libreria client
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/it/mariasql-for-nodejs/">
                            
                            mariasql per node.js
                        </a>
                    </li>
                
            
                
                    <li class="active">
                        <span>Usare la libreria client non-bloccante</span>
                        
                    </li>
                
            
        </ul>
    
    

                </div>
            
        </div>
    </div>
</div>

<!-- Footer -->
<footer id="footer">
    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-xs-12">
                    <ul class="list-inline text-center footer-nav">
                        <li>
                            <h5>
                                <a href="https://mariadb.com/products" title="Products">Products</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/solutions" title="Solutions">Solutions</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/resources" title="Resources">Resources</a>
                            </h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/about-us" title="About MariaDB">Company</a></h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/pricing" title="Pricing">Pricing</a>
                            </h5>
                        </li>
                        
                        
                        <li>
                            <h5><a href="https://mariadb.com/downloads" title="Download">Download MariaDB</a></h5>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="row row-10">
                
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div id="block-footerformcontact" class="block block-block-content block-block-contentd754ee1b-3cc9-40e7-9ef4-f504f1197fb1">
                        
                            <h5 style="font-weight: 400;">Subscribe to our newsletter!</h5>
                            <script src="//app-sj15.marketo.com/js/forms2/js/forms2.min.js"></script><form id="mktoForm_1498"></form>
                            <script>
                                <!--//--><![CDATA[// ><!--
                                MktoForms2.loadForm("//app-sj15.marketo.com", "573-PXI-984", 1498);
                                //--><!]]]]><![CDATA[>
                                //--><!]]>
                            </script>
                        
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div class="footer-copyright">
                        <div class="text-center">
                            <ul class="list-inline no-margin">
                                <li>
                                    <a href="/legal" title="Legal">Legal</a>
                                </li>
                                <li>
                                    <a href="/privacy-policy" title="Privacy Policy">Privacy Policy</a>
                                </li>
                                <li>
                                    <a href="/cookie-policy/" title="Cookies">Cookie Policy</a>
                                </li>
                            </ul>
                            <p>Copyright &copy; 2025 MariaDB. All rights reserved.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</footer>
</div>

<div id="ajax_loading">
    <img src="/kb/static/images/ajax-loader.a51c5608d01a.gif" />
</div>

    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MK2847"
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MK2847');</script>
    <!-- End Google Tag Manager -->

</body>

<script type="text/javascript" src="/kb/static/js/main.1587e3a666fc.js" charset="utf-8"></script>

</html>