<!DOCTYPE html>
<html>
<head data-cookie-domain=""
      data-cookie-path="/">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="apple-touch-icon" sizes="180x180" href="/kb/static/images/favicons/apple-touch-icon.159e713979be.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/kb/static/images/favicons/favicon-32x32.bc0ac1d5d11e.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/kb/static/images/favicons/favicon-16x16.5801f8f0f34e.png">
    <link rel="shortcut icon" href="/kb/static/images/favicons/favicon.d122d305dee4.ico" type="image/x-icon" />

    <title>Come forzare i piani delle query - MariaDB Knowledge Base</title>

    <link href="/kb/static/css/main.f7633538c846.css" rel="stylesheet" type="text/css" />

    

    

    <!-- FB Open Graph tags -->
    <meta property="og:title" content="Come forzare i piani delle query" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://mariadb.com/kb/it/how-to-force-query-plans/" />
    <meta property="og:image" content="http://mariadb.comaskmonty-logo.png" />
    <meta property="og:site_name" content="MariaDB KnowledgeBase" />
    <meta property="fb:admins" content="514852603" />
    <meta property="og:description" content="
L&#39;ottimizzatore si basa in gran parte sui costi di esecuzione nel cercare di trovare il piano ottimale per ciascuna query. Tuttavia può succedere che non abbia sufficienti in..." />

    <meta name="description" content="
L&#39;ottimizzatore si basa in gran parte sui costi di esecuzione nel cercare di trovare il piano ottimale per ciascuna query. Tuttavia può succedere che non abbia sufficienti in..." />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet"/>
    
</head>
<body class="mpkb nodes products nodes_view jqui" id="nodes_view">





<div id="menu-mobile" class="visible-sm visible-xs">

    <div>
        <div id="mobile-close-menu" class="text-right">
            <a href="javascript:void(0)" title="Close Menu" id="back-main" class="toggle-menu">X<span></span></a>
        </div>
    </div>
    <div class="mainmenu-mobile">
        <ul class="ls-none ul-menu">
            <li data-sub="submenu5"><a class="open-form-search" href="/kb/search/" title="Search">Search </a></li>
            <li data-sub="submenu0"><a href="/products" title="Products">Products</a><span class="arrow-main"></span></li>
            <li data-sub="submenu1"><a href="/services" title="Services">Services</a><span class="arrow-main"></span></li>
            <li data-sub="submenu2"><a href="/resources" title="Resources">Resources</a><span class="arrow-main"></span></li>
            <li data-sub="submenu3"><a href="/about-us" title="About">About</a><span class="arrow-main"></span></li>
            <li data-sub="submenu4"><a href="/contact" title="Contact">Contact</a></li>
        </ul>
    </div>

    <div class="nav-top-mobile">
        <div class="select-box form">

            <ul class="inline-block-md mb-none top-nav">
                <li>

                </li>
                
                    <li>
                        <a href="/kb/user/login?next=/kb/it/how-to-force-query-plans/"> Login</a>
                    </li>
                
            </ul>



        </div>
        <p class="text-center copyright">Copyright &copy; 2024 MariaDB. All rights reserved.</p>
    </div>
</div>
<div class="violator-wrap d-none" id="top_violator">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12">
                <div class="violator-outer">
                    <div class="violator-inner">
                        <div class="row">
                            <div class="col-xs-12 col-sm-9 col-lg-7 col-lg-offset-2" id="top_violator_content">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="content-link" target="_blank" rel="nofollow noreferrer">
                                    <span>The Ultimate Guide to High Availability with MariaDB</span>
                                </a>
                            </div>
                            <div class="col-xs-12 col-sm-3" id="top_violator_cta">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="btn btn-mariadb" target="_blank" rel="nofollow noreferrer">Download Now</a>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-link close-btn">
                        <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24" width="15px" height="15px"><path d="M 4.9902344 3.9902344 A 1.0001 1.0001 0 0 0 4.2929688 5.7070312 L 10.585938 12 L 4.2929688 18.292969 A 1.0001 1.0001 0 1 0 5.7070312 19.707031 L 12 13.414062 L 18.292969 19.707031 A 1.0001 1.0001 0 1 0 19.707031 18.292969 L 13.414062 12 L 19.707031 5.7070312 A 1.0001 1.0001 0 0 0 18.980469 3.9902344 A 1.0001 1.0001 0 0 0 18.292969 4.2929688 L 12 10.585938 L 5.7070312 4.2929688 A 1.0001 1.0001 0 0 0 4.9902344 3.9902344 z"/></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="wrapper">
<div id="top-nav">
    <div class="container">
        <ul class="hidden-sm hidden-xs" >
            <li><a href="https://mariadb.com/kb/">Knowledge Base</a></li>
            <li><a href="https://mariadb.com/contact/">Contact</a></li>
            
                
                    <li>
                        <a href="/kb/user/login?next=/kb/it/how-to-force-query-plans/" rel="nofollow">Accesso</a>
                    </li>
                
            
            
            <li id="search-form">
                <form action="/kb/it/+search/" method="get" id="search-block-form" accept-charset="UTF-8">
                    <input id="search" title="Enter the terms you wish to search for."
                           placeholder="Search . . ." type="text"
                           name="q" value="" size="15" maxlength="128" class="form-text"
                           data-autocomplete-url="/kb/it/+search/autocomplete/">
                    <input type="hidden" name="quick" value="1" />
                    <input type="hidden" name="source" value="kb" />
                </form>
            </li>
            <li><a id="search-toggler" href="/kb/search/">Search</a></li>
            
        </ul>
    </div>
</div>
<div id="navbar-bottom" class="navbar">
    <div class="container">
        
        
        
        
        <div class="row">
            <div class="col-md-3 col-sm-9 col-xs-9">
                <a class="brand" href="/" title="MariaDB">
                    <img src="/kb/static/images/logo-2018-black.95f5978ae14d.png">
                </a>
            </div>
            <div class="col-md-9 hidden-sm hidden-xs">
                <div class="main-menu">
                    <ul id="main-menu" class="nav navbar-nav inline-block-sm">
    <li class="has-sub full-menu">
        <a href="/products" title="Products">Products</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/services" title="Services">Services</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/pricing" title="Pricing">Pricing</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/resources" title="Resources">Resources</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/about-us" title="About Us">About Us</a>
    </li>
    <li class="">
        <a class="button electric-eel small top-bar-right-download" href="/downloads/">Download</a>
    </li>
</ul>
                </div>
            </div>
            <div class="col-md-3 visible-sm visible-xs col-sm-3 col-xs-3 ps-rv">
                <div class="navbar-header text-right pull-right">
                    <button type="button" class="menu-control toggle-menu" id="open-menu">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="main">
    <div class="container">
        

        <div id="subheader1" class="clearfix">
            <div class="pull-left">
                
                <div id="breadcrumbs" class="breadcrumb">
                    <a href="/kb/it/">Knowledge Base</a>
                    


    
    » <a class="crumb" href="/kb/it/mariadb-italiano/">MariaDB - Italiano</a>
    

    
    » <a class="crumb" href="/kb/it/documentazione-di-mariadb/">Documentazione di MariaDB</a>
    

    
    » <a class="crumb" href="/kb/it/ottimizzazione/">Ottimizzazione</a>
    


    » <a class="node_link crumb" href="/kb/it/how-to-force-query-plans/">Come forzare i piani delle query</a>


                </div>
                
            </div>
        </div>
    </div>
    <div class="container" id="container-main">
        <div class="row">
            
            
                
                <aside id="sidebar-first" class="sidebar col-md-2 hidden-xs hidden-sm hidden-print">
                    
                        
                        <ul id="category_menu" class="nav nav-pills nav-stacked">
                            <li><a href="/kb/it/">Pagina iniziale</a></li>
                            
                                
                                    <li><a href="/kb/it/+questions/">Domande Aperte</a></li>
                                
                                <li><a href="/kb/it/documentation/">MariaDB Server</a></li>
                                <li><a href="/kb/it/maxscale/">MariaDB MaxScale</a></li>
                                <li><a href="/kb/it/mariadb-columnstore/">MariaDB ColumnStore</a></li>
                                <li><a href="/kb/it/connectors/">Connectors</a></li>
                            

                        </ul>
                    

                    
<div>



<div class="well well-small box actions"><div>

        <a class="btn btn-block btn-blue btn-sm" href="/kb/it/how-to-force-query-plans/+history" rel="nofollow">Cronologia</a>
        
        
        
        <a class="btn btn-block btn-blue btn-sm" href="/kb/it/how-to-force-query-plans/+source/">Source</a>
        
        <a class="btn btn-block btn-blue btn-sm flag" href="/kb/it/how-to-force-query-plans/+flag"
                data-flag-url="/kb/it/how-to-force-query-plans/+flag" rel="nofollow">
                Flag as Spam / Inappropriate</a>
        
        <a class="btn btn-block btn-blue btn-sm" href="/kb/it/how-to-force-query-plans/+translate/">
                Traduci</a>
        

</div>
</div>





<div class="well well-small box node_info"><div>

    <dl>
        <dt>Creato</dt>
        <dd>

<span class="datetime" title="2011-10-14 13:02">12 anni, 5 mesi ago</span></dd>

        <dt>Modificato</dt>
        <dd>

<span class="datetime" title="2011-10-14 21:41">12 anni, 5 mesi ago</span></dd>

        <dt>Tipo</dt>
        <dd>article</dd>

        <dt>Stato</dt>
        <dd>active</dd>

        <dt>Licenza</dt>
        <dd>
            
                <a href="/kb/it/how-to-force-query-plans/+license/">CC BY-SA / Gnu FDL</a>
            
        </dd>

        
    </dl>

    
    <ul class="rss_feeds">
        <li><a href="/kb/it/how-to-force-query-plans/+history/feed/">
            Cronologia</a>
        </li>
        <li><a href="/kb/it/how-to-force-query-plans/+comments/feed/">
            Commenti</a>
        </li>
    </ul>
    

</div>
</div>





    
    
    

<div class="well well-small box attachments"><div><div class="edit_link pull-right"><a href="/kb/it/how-to-force-query-plans/+edit/attachments/">Edit</a></div><h5>Attachments</h5></div><div>

        
            <div class="no_data">No attachments exist</div>
        
    
</div>
</div>

    



    
    
        

<div class="well well-small box"><div><h5>Versioni Localizzate</h5></div><div>

        <ul>
            
            <li><a href="/kb/en/index-hints-how-to-force-query-plans/">Index Hints: How to Force Query Plans</a> [en]</li>
            
        </ul>
        
</div>
</div>

    






</div>


                    

































                </aside>
            
            
            
                
            
            
                
            
            <section id="content" class="limited_width col-md-8 clearfix">
                
                    <h1>Come forzare i piani delle query</h1>
                

                



                <div>
                    
    

    
    
    

    <div class="node creole">
        
        
        


    
    <div class="answer formatted">
        <div class="table_of_contents well well-small">
<h3>Contents</h3>
 <ol class="toc">

    <li class=""><a href="#preparare-il-database-di-esempio-world" title="Preparare il database di esempio world">Preparare il database di esempio world</a></li>

    <li class=""><a href="#forzare-lordine-delle-join" title="Forzare l&#39;ordine delle JOIN">Forzare l&#39;ordine delle JOIN</a></li>

    <li class=""><a href="#forzare-la-scelta-di-un-indice-specifico-per-la-clausola-fixedwherefixed" title="Forzare la scelta di un indice specifico per la clausola WHERE">Forzare la scelta di un indice specifico per la clausola WHERE</a>    <ol class="toc">

        <li class=""><a href="#usare-un-insieme-limitato-di-indici" title="Usare un insieme limitato di indici">Usare un insieme limitato di indici</a></li>

        <li class=""><a href="#ignorare-alcuni-indici" title="Ignorare alcuni indici">Ignorare alcuni indici</a></li>

        <li class=""><a href="#forzare-luso-di-un-indice" title="Forzare l&#39;uso di un indice">Forzare l&#39;uso di un indice</a>    </ol>
</li>

    <li class=""><a href="#forzare-luso-di-un-indice-per-fixedorder-byfixed-o-per-fixedgroup-byfixed" title="Forzare l&#39;uso di un indice per ORDER BY o per GROUP BY">Forzare l&#39;uso di un indice per ORDER BY o per GROUP BY</a>    <ol class="toc">

        <li class=""><a href="#aiutare-lottimizzatore-a-ottimizzare-fixedgroup-byfixed-e-fixedorder-byfixed" title="Aiutare l&#39;ottimizzatore a ottimizzare GROUP BY e ORDER BY">Aiutare l&#39;ottimizzatore a ottimizzare GROUP BY e ORDER BY</a></li>

        <li class=""><a href="#forzareproibire-luso-delle-tabelle-temporeanee-per-fixedgroup-byfixed" title="Forzare/proibire l&#39;uso delle tabelle temporeanee per GROUP BY">Forzare/proibire l&#39;uso delle tabelle temporeanee per GROUP BY</a>    </ol>
</li>

    <li class=""><a href="#forzare-luso-di-una-tabella-temporanea" title="Forzare l&#39;uso di una tabella temporanea">Forzare l&#39;uso di una tabella temporanea</a></li>

    <li class=""><a href="#loptimizer-switch" title="L&#39;optimizer switch">L&#39;optimizer switch</a> </ol>
</li>
</div>
<p>L'ottimizzatore si basa in gran parte sui costi di esecuzione nel cercare di trovare il piano ottimale per ciascuna query. Tuttavia può succedere che non abbia sufficienti informazioni per identificare un piano perfetto; in questi casi è possibile forzare la scelta di un particolare piano.</p>
<p>E' possibile esaminare il piano per una <a href="/kb/en/select/">SELECT</a> scrivendo <a href="/kb/en/explain/">EXPLAIN</a> prima dell'istruzione.</p>
<p>Per i seguenti esempi, si userà il <a href="http://dev.mysql.com/doc/world-setup/en/world-setup.html">database world</a>.</p>
<h2 class="anchored_heading" id="preparare-il-database-di-esempio-world">Preparare il database di esempio world</h2>
<p>Si scarichi il database da <a href="ftp://ftp.askmonty.org/public/world.sql.gz">ftp://ftp.askmonty.org/public/world.sql.gz</a></p>
<p>Lo si installi:</p>
<pre class="fixed">mysqladmin create world
zcat world.sql.gz | ../client/mysql world
</pre><p>oppure:</p>
<pre class="fixed">mysqladmin create world
gunzip world.sql.gz
../client/mysql world &lt; world.sql
</pre><h2 class="anchored_heading" id="forzare-lordine-delle-join">Forzare l'ordine delle JOIN</h2>
<p>E' possibile forzare l'ordine delle JOIN utilizzando <a href="/kb/en/join/">STRAIGHT_JOIN</a> nella clausola <a href="/kb/en/select/">SELECT</a> o nella clausola <a href="/kb/en/join/">JOIN</a>.</p>
<p>Il caso più semplice è quello in cui si forza l'ordine delle tabelle nella clausola <code class="highlight fixed" style="white-space:pre-wrap">FROM</code> e si specifica <code class="highlight fixed" style="white-space:pre-wrap">SELECT STRAIGHT_JOIN</code>:</p>
<pre class="fixed">SELECT STRAIGHT_JOIN SUM(City.Population) FROM Country,City WHERE
City.CountryCode=Country.Code AND Country.HeadOfState=&#34;Vladimir Putin&#34;;
</pre><p>Se si desidera forzare l'ordine delle JOIN per una quantità limitata di tabelle, si può utilizzare <code class="highlight fixed" style="white-space:pre-wrap">STRAIGHT_JOIN</code> nella clausola <code class="highlight fixed" style="white-space:pre-wrap">FROM</code>: verrà imposto un ordine solo per le tabelle connesse da <code class="highlight fixed" style="white-space:pre-wrap">STRAIGHT_JOIN</code>.</p>
<pre class="fixed">SELECT SUM(City.Population) FROM Country STRAIGHT_JOIN City WHERE
City.CountryCode=Country.Code AND Country.HeadOfState=&#34;Vladimir Putin&#34;;
</pre><p>In entrambi i casi, <code class="highlight fixed" style="white-space:pre-wrap">Country</code> verrà letta per prima e per ogni Paese corrispondente (uno in questo caso) verrà cercata una corrispondenza in tutte le righe di <code class="highlight fixed" style="white-space:pre-wrap">City</code>. Poiché vi è soltanto un record corrispondente, questa query sarà più veloce di quella originale.</p>
<p>L'output di <a href="/kb/en/explain/">EXPLAIN</a> per gli esempi di cui sopra è:</p>
<div class="cstm-style darkheader-nospace-borders"><table><tr><th>id</th><th>select_type</th><th>table</th><th>type</th><th>possible_keys</th><th>key</th><th>key_len</th><th>ref</th><th>rows</th><th>Extra</th></tr>
<tr><td>1</td><td>SIMPLE</td><td>Country</td><td>ALL</td><td>PRIMARY</td><td>NULL</td><td>NULL</td><td>NULL</td><td>239</td><td>Using where</td></tr>
<tr><td>1</td><td>SIMPLE</td><td>City</td><td>ALL</td><td>NULL</td><td>NULL</td><td>NULL</td><td>NULL</td><td>4079</td><td>Using where; Using join buffer (flat, BNL join)</td></tr>
</table>
</div><p>Questo è uno dei rari casi in cui il valore <code class="highlight fixed" style="white-space:pre-wrap">ALL</code> è accettabile, perché la scansione della tabella <code class="highlight fixed" style="white-space:pre-wrap">Country</code> troverà soltanto una corrispondenza.</p>
<h2 class="anchored_heading" id="forzare-la-scelta-di-un-indice-specifico-per-la-clausola-fixedwherefixed">Forzare la scelta di un indice specifico per la clausola <code class="highlight fixed" style="white-space:pre-wrap">WHERE</code></h2>
<p>In alcuni casi l'ottimizzatore potrebbe scegliere un indice non ottimale o non scegliere alcun indice, anche se teoricamente potrebbe usarne alcuni.</p>
<p>In questo caso si può dire all'ottimizzatore di utilizzare un insieme di indici limitato, di ignorare uno o più indici, oppure forzare l'uso di alcuni indici.</p>
<h3 class="anchored_heading" id="usare-un-insieme-limitato-di-indici">Usare un insieme limitato di indici</h3>
<p>E' possibile limitare gli indici che l'ottimizzatore prenderà in considerazione tramite l'opzione <a href="/kb/en/join/">USE INDEX</a>.</p>
<pre class="fixed">USE INDEX [{FOR {JOIN|ORDER BY|GROUP BY}] ([elenco_indici])
</pre><p>Il default è <code class="highlight fixed" style="white-space:pre-wrap">FOR JOIN</code>, che significa che il suggerimento vale solo per la clausola <code class="highlight fixed" style="white-space:pre-wrap">WHERE</code>.</p>
<p><code class="highlight fixed" style="white-space:pre-wrap">USE INDEX</code> deve essere specificato dopo il nome della tabella nella clausola <code class="highlight fixed" style="white-space:pre-wrap">FROM</code>.</p>
<p>Esempio:</p>
<pre class="fixed">CREATE INDEX Name ON City (Name);
CREATE INDEX CountryCode ON City (Countrycode);
EXPLAIN SELECT Name FROM City USE INDEX (CountryCode)
WHERE name=&#34;Helsingborg&#34; AND countrycode=&#34;SWE&#34;;
</pre><p>Risultato:</p>
<div class="cstm-style darkheader-nospace-borders"><table><tr><th>id</th><th>select_type</th><th>table</th><th>type</th><th>possible_keys</th><th>key</th><th>key_len</th><th>ref</th><th>rows</th><th>Extra</th></tr>
<tr><td>1</td><td>SIMPLE</td><td>City</td><td>ref</td><td>CountryCode</td><td>CountryCode</td><td>3</td><td>const</td><td>14</td><td>Using where</td></tr>
</table>
</div><p>Senza l'uso di <code class="highlight fixed" style="white-space:pre-wrap">USE INDEX</code>, anche l'indice <code class="highlight fixed" style="white-space:pre-wrap">Name</code> sarebbe stato incluso in <code class="highlight fixed" style="white-space:pre-wrap">possible keys</code>.</p>
<h3 class="anchored_heading" id="ignorare-alcuni-indici">Ignorare alcuni indici</h3>
<p>E' possibile dire all'ottimizzatore di non considerare alcuni indici con l'opzione <a href="/kb/en/join/">IGNORE INDEX</a>.</p>
<pre class="fixed">IGNORE INDEX [{FOR {JOIN|ORDER BY|GROUP BY}] ([elenco_indici])
</pre><p><code class="highlight fixed" style="white-space:pre-wrap">IGNORE INDEX</code> deve essere specificato dopo il nome della tabella nella clausola <code class="highlight fixed" style="white-space:pre-wrap">FROM</code>.</p>
<p>Esempio:</p>
<pre class="fixed">CREATE INDEX Name ON City (Name);
CREATE INDEX CountryCode ON City (Countrycode);
EXPLAIN SELECT Name FROM City IGNORE INDEX (Name)
WHERE name=&#34;Helsingborg&#34; AND countrycode=&#34;SWE&#34;;
</pre><p>Risultato:</p>
<div class="cstm-style darkheader-nospace-borders"><table><tr><th>id</th><th>select_type</th><th>table</th><th>type</th><th>possible_keys</th><th>key</th><th>key_len</th><th>ref</th><th>rows</th><th>Extra</th></tr>
<tr><td>1</td><td>SIMPLE</td><td>City</td><td>ref</td><td>CountryCode</td><td>CountryCode</td><td>3</td><td>const</td><td>14</td><td>Using where</td></tr>
</table>
</div><p>Il beneficio dell'uso di <code class="highlight fixed" style="white-space:pre-wrap">IGNORE_INDEX</code> invece di <code class="highlight fixed" style="white-space:pre-wrap">USE_INDEX</code> è che il primo non disabilita eventuali nuovi indici che potrebbero essere aggiunti in futuro.</p>
<h3 class="anchored_heading" id="forzare-luso-di-un-indice">Forzare l'uso di un indice</h3>
<p>Forzare la scelta di un indice è utile soprattutto quando l'ottimizzatore decide di effettuare una scansione completa di una tabella nonostante l'uso di una certa chiave sia più auspicabile.</p>
<pre class="fixed">CREATE INDEX Name ON City (Name);
EXPLAIN SELECT Name,CountryCode FROM City FORCE INDEX (Name)
WHERE name&gt;=&#34;A&#34; and CountryCode &gt;=&#34;A&#34;;
</pre><p>Risultato:</p>
<div class="cstm-style darkheader-nospace-borders"><table><tr><th>id</th><th>select_type</th><th>table</th><th>type</th><th>possible_keys</th><th>key</th><th>key_len</th><th>ref</th><th>rows</th><th>Extra</th></tr>
<tr><td>1</td><td>SIMPLE</td><td>City</td><td>range</td><td>Name</td><td>Name</td><td>35</td><td>NULL</td><td>4079</td><td>Using where</td></tr>
</table>
</div><p><code class="highlight fixed" style="white-space:pre-wrap">FORCE_INDEX</code> impone all'ottimizzatore di considerare solo gli indici specificati (come <code class="highlight fixed" style="white-space:pre-wrap">USE_INDEX</code>, ma in più dice all'ottimizzatore di considerare una scansione completa della tabella come qualcosa di estremamente costoso. Tuttavia, se nessuno degli indici specificati è adatto, la scansione completa avverrà comunque.</p>
<h2 class="anchored_heading" id="forzare-luso-di-un-indice-per-fixedorder-byfixed-o-per-fixedgroup-byfixed">Forzare l'uso di un indice per <code class="highlight fixed" style="white-space:pre-wrap">ORDER BY</code> o per <code class="highlight fixed" style="white-space:pre-wrap">GROUP BY</code></h2>
<p>L'ottimizzatore cerca di utilizzare gli indici per elaborare le clausole <code class="highlight fixed" style="white-space:pre-wrap">ORDER BY</code> e <code class="highlight fixed" style="white-space:pre-wrap">GROUP BY</code>.</p>
<p>Per forzare o ignorare un indice specifico, è possibile usare <code class="highlight fixed" style="white-space:pre-wrap">USE INDEX</code>, <code class="highlight fixed" style="white-space:pre-wrap">IGNORE INDEX</code> e <code class="highlight fixed" style="white-space:pre-wrap">FORCE INDEX</code> come si è fatto sopra per la clausola <code class="highlight fixed" style="white-space:pre-wrap">WHERE</code>:</p>
<pre class="fixed">USE INDEX [{FOR {JOIN|ORDER BY|GROUP BY}] ([elenco_indici])
</pre><p>Queste opzioni devono essere specificate dopo il nome della tabella nella clausola <code class="highlight fixed" style="white-space:pre-wrap">FROM</code>.</p>
<p>Esempio:</p>
<pre class="fixed">CREATE INDEX Name ON City (Name);
EXPLAIN SELECT Name,Count(*) FROM City
FORCE INDEX FOR GROUP BY (Name)
WHERE population &gt;= 10000000 GROUP BY Name;
</pre><p>Risultato:</p>
<div class="cstm-style darkheader-nospace-borders"><table><tr><th>id</th><th>select_type</th><th>table</th><th>type</th><th>possible_keys</th><th>key</th><th>key_len</th><th>ref</th><th>rows</th><th>Extra</th></tr>
<tr><td>1</td><td>SIMPLE</td><td>City</td><td>index</td><td>NULL</td><td>Name</td><td>35</td><td>NULL</td><td>4079</td><td>Using where</td></tr>
</table>
</div><p>Senza l'opzione <code class="highlight fixed" style="white-space:pre-wrap">FORCE INDEX</code>, il valore della colonna extra sarebbe <code class="highlight fixed" style="white-space:pre-wrap">Using where; Using temporary; Using
filesort</code>, perchè l'ottimizzatore creerebbe una tabella temporanea e la ordinerebbe.</p>
<h3 class="anchored_heading" id="aiutare-lottimizzatore-a-ottimizzare-fixedgroup-byfixed-e-fixedorder-byfixed">Aiutare l'ottimizzatore a ottimizzare <code class="highlight fixed" style="white-space:pre-wrap">GROUP BY</code> e <code class="highlight fixed" style="white-space:pre-wrap">ORDER BY</code></h3>
<p>L'ottimizzatore usa diverse strategie per ottimizzare <code class="highlight fixed" style="white-space:pre-wrap">GROUP BY</code> e <code class="highlight fixed" style="white-space:pre-wrap">ORDER BY</code>:</p>
<ul start="1"><li>Elaborarla con un indice:
<ul start="1"><li>Scansionare la tabella seguendo l'ordine dell'indice e inviare i dati man mano. (Funziona solo se la clausola <code class="highlight fixed" style="white-space:pre-wrap">ORDER BY</code> / <code class="highlight fixed" style="white-space:pre-wrap">GROUP BY</code> può essere risolta con un indice dopo la propagazione delle costanti).
</li></ul>
</li></ul>
<ul start="1"><li>Filesort:
<ul start="1"><li>Scansionare la tabella da ordinare e collezionare le chiavi ordinate in un file temporaneo.
</li><li>Ordinare le chiavi + riferimenti in  righe (con il filesort)
</li><li>Scansionare la tabella nell'ordine stabilito
</li></ul>
</li></ul>
<ul start="1"><li>Usare una tabella temporanea per <code class="highlight fixed" style="white-space:pre-wrap">ORDER BY</code>.
<ul start="1"><li>Creare una tabella temporanea (in memoria) per i dati da ordinare. (Se però diventa più grande di <code class="highlight fixed" style="white-space:pre-wrap">max_heap_table_size</code> o contiene colonne BLOB, verranno usate tabelle Aria o MyISAM su disco)
</li><li>Ordinare le chiavi + riferimenti in  righe (con il filesort)
</li><li>Scansionare la tabella nell'ordine stabilito
</li></ul>
</li></ul>
<p>Se i campi da ordinare non sono tutti nella prima <a href="/kb/en/join/">JOIN</a>, viene sempre usata una tabella temporanea.</p>
<ul start="1"><li>Usare una tabella temporanea per <code class="highlight fixed" style="white-space:pre-wrap">GROUP BY</code>:
<ul start="1"><li>Creare una tabella temporanea contenente i risultati del raggruppamento con un indice che corrisponde ai campi usati nella clausola <code class="highlight fixed" style="white-space:pre-wrap">GROUP BY</code>.
</li><li>Produrre una riga di risultati
</li><li>Se nella tabella temporanea esiste già una riga con l'indice usato per la <code class="highlight fixed" style="white-space:pre-wrap">GROUP BY</code>, aggiungere ad esso i nuovi risultati. Altrimenti, creare una nuova riga.
</li><li>Prima di inviare i risultati al client, ordinare le righe con il filesort per avere i risultati nell'ordine del <code class="highlight fixed" style="white-space:pre-wrap">GROUP BY</code>.
</li></ul>
</li></ul>
<h3 class="anchored_heading" id="forzareproibire-luso-delle-tabelle-temporeanee-per-fixedgroup-byfixed">Forzare/proibire l'uso delle tabelle temporeanee per <code class="highlight fixed" style="white-space:pre-wrap">GROUP BY</code></h3>
<p>Usare una tabella in memoria (come descritto sopra) è solitamente l'opzione più veloce per risolvere la clausola <code class="highlight fixed" style="white-space:pre-wrap">GROUP BY</code> quando i risultati sono pochi, ma non è ottimale quando l'insieme dei risultati è molto grande.
E' possibile informare di questo l'ottimizzatore utilizzando <code class="highlight fixed" style="white-space:pre-wrap">SELECT SQL_SMALL_RESULT</code> o <code class="highlight fixed" style="white-space:pre-wrap">SELECT SQL_BIG_RESULT</code>:</p>
<pre class="fixed">EXPLAIN SELECT SQL_SMALL_RESULT Name,Count(*) AS Cities FROM City GROUP BY Name HAVING Cities &gt; 2;
</pre><p>Risultato:</p>
<div class="cstm-style darkheader-nospace-borders"><table><tr><th>id</th><th>select_type</th><th>table</th><th>type</th><th>possible_keys</th><th>key</th><th>key_len</th><th>ref</th><th>rows</th><th>Extra</th></tr>
<tr><td>1</td><td>SIMPLE</td><td>City</td><td>ALL</td><td>NULL</td><td>NULL</td><td>NULL</td><td>NULL</td><td>4079</td><td>Using temporary; Using filesort</td></tr>
</table>
</div><p>Esempio opposto:</p>
<pre class="fixed">EXPLAIN SELECT SQL_BIG_RESULT Name,Count(*) AS Cities FROM City
GROUP BY Name HAVING Cities &gt; 2;
</pre><p>Risultato:</p>
<div class="cstm-style darkheader-nospace-borders"><table><tr><th>id</th><th>select_type</th><th>table</th><th>type</th><th>possible_keys</th><th>key</th><th>key_len</th><th>ref</th><th>rows</th><th>Extra</th></tr>
<tr><td>1</td><td>SIMPLE</td><td>City</td><td>ALL</td><td>NULL</td><td>NULL</td><td>NULL</td><td>NULL</td><td>4079</td><td>Using filesort</td></tr>
</table>
</div><p>La differenza è che se si specifica <code class="highlight fixed" style="white-space:pre-wrap">SQL_SMALL_RESULT</code> viene creata una tabella temporanea.</p>
<h2 class="anchored_heading" id="forzare-luso-di-una-tabella-temporanea">Forzare l'uso di una tabella temporanea</h2>
<p>In alcuni casi è possibile forzare l'uso di una tabella temporanea per i risultati, per rilasciare al più presto possibile i lock a livello di tabella o di riga.</p>
<p>Per farlo, si specifica l'opzione <code class="highlight fixed" style="white-space:pre-wrap">SQL_BUFFER_RESULT</code>:</p>
<pre class="fixed">CREATE INDEX Name ON City (Name);
EXPLAIN SELECT SQL_BUFFER_RESULT Name,Count(*) AS Cities FROM City
GROUP BY Name HAVING Cities &gt; 2;
</pre><p>Risultato:</p>
<div class="cstm-style darkheader-nospace-borders"><table><tr><th>id</th><th>select_type</th><th>table</th><th>type</th><th>possible_keys</th><th>key</th><th>key_len</th><th>ref</th><th>rows</th><th>Extra</th></tr>
<tr><td>1</td><td>SIMPLE</td><td>City</td><td>index</td><td>NULL</td><td>Name</td><td>35</td><td>NULL</td><td>4079</td><td>Using index; Using temporary</td></tr>
</table>
</div><p>Senza l'opzione <code class="highlight fixed" style="white-space:pre-wrap">SQL_BUFFER_RESULT</code> la tabella temporanea non sarebbe stata usata.</p>
<h2 class="anchored_heading" id="loptimizer-switch">L'optimizer switch</h2>
<p>In <a href="/kb/en/what-is-mariadb-53/">MariaDB 5.3</a> è stato aggiunto l'<a href="/kb/en/mariadb-53-optimizer_switch/">optimizer
switch</a>, che permette di specificare quali algoritmi devono essere presi in considerazione nell'ottimizzare una query.</p>
<p>Si veda la sezione <a href="/kb/en/optimizer/">optimizer</a> per ulteriori informazioni su tali algoritmi.</p>

    </div>


        
            <div id="subscribe" class="well well-small hide hidden-print"
                 data-subscribe-url="/kb/it/how-to-force-query-plans/+subscriptions/add"
                 data-unsubscribe-url="/kb/it/how-to-force-query-plans/+subscriptions/remove">
            </div>
        

        
        
    
        <div class="simple_section_nav">
            <ul class="nav nav-pills">
                
                    <li><a href="/kb/it/how-to-limittimeout-queries/">
                        ← Come applicare un limite o un timeout alle query
                    </a>
                    </li>
                
                
                    <li><a href="/kb/it/ottimizzazione/">
                        ↑ Ottimizzazione ↑
                    </a>
                    </li>
                
                
                    <li class="pull-right"><a href="/kb/it/converting-tables-from-myisam-to-innodb/">
                        Convertire le tabelle da MyISAM a InnoDB →
                    </a>
                    </li>
                
            </ul>
        </div>
    

        

        
        <h2>Commenti</h2>
        
    
    <div id="comments" data-node-id="1827" data-comments-url="/kb/it/how-to-force-query-plans/+comments"
         data-reply-url="/kb/it/how-to-force-query-plans/comments/post/">
        Sto caricando i commenti......
    </div>

        

    </div>


                    <div id="content_disclaimer" class="graybox">
                        Content reproduced on this site is the property of its respective owners,
                        and this content is not reviewed in advance by MariaDB. The views, information and opinions
                        expressed by this content do not necessarily represent those of MariaDB or any other party.
                    </div>
                </div>
            </section>

            
                <div id="right_bar" class="col-md-2">
                    
    
        
        <ul class="section_navigation well well-small hidden-xs hidden-sm">
            
                <li class="parent"><a href="/kb/it/ottimizzazione/">
                    ↑ Ottimizzazione ↑
                </a>
                </li>
            
            
                
                    <li>
                        <a href="/kb/it/buffer-e-cache/">
                            
                            Buffer e cache
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/it/lottimizzatore-delle-query/">
                            
                            L&#39;ottimizzatore delle query
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/it/ottimizzare-le-strutture-dati/">
                            
                            Ottimizzare le strutture dati
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/it/ottimizzazione-e-indici/">
                            
                            Ottimizzazione e indici
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/it/variabili-di-sistema/">
                            
                            Variabili di sistema
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/it/how-to-limittimeout-queries/">
                            
                            Come applicare un limite o un timeout alle query
                        </a>
                    </li>
                
            
                
                    <li class="active">
                        <span>Come forzare i piani delle query</span>
                        
                    </li>
                
            
                
                    <li>
                        <a href="/kb/it/converting-tables-from-myisam-to-innodb/">
                            
                            Convertire le tabelle da MyISAM a InnoDB
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/it/inserire-dati-velocemente-in-mariadb/">
                            
                            Inserire dati velocemente in MariaDB
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/it/row-based-replication-with-no-primary-key/">
                            
                            La replica basata sulle righe senza chiave primaria
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/it/le-group-commit-del-binlog-e-innodb_flush_log_at_trx_commit/">
                            
                            Le Group Commit del binlog e innodb_flush_log_at_trx_commit
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/it/limit-rows-examined/">
                            
                            LIMIT ROWS EXAMINED
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/it/mariadb-optimization-for-mysql-users/">
                            
                            MariaDB Optimization for MySQL Users
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/it/optimize-table/">
                            <span class="pull-right not_primary"></span>
                            OPTIMIZE TABLE
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/it/hardware-optimization/">
                            
                            Ottimizzazione hardware
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/it/pool-di-thread-in-mariadb-51-53/">
                            
                            Pool di Thread in MariaDB 5.1 - 5.3
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/it/thread-pool-in-mariadb-55/">
                            
                            Pool di Thread in MariaDB 5.5
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/it/segmented-key-cache/">
                            
                            Segmentazione della Cache degli Indici
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/it/slow-query-log-extended-statistics/">
                            
                            Statistiche estese dello Slow Query Log
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/it/user-statistics/">
                            
                            Statistiche Utente
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/it/variabili-server-di-sistema/">
                            
                            Variabili server di sistema
                        </a>
                    </li>
                
            
        </ul>
    
    

                </div>
            
        </div>
    </div>
</div>

<!-- Footer -->
<footer id="footer">
    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-xs-12">
                    <ul class="list-inline text-center footer-nav">
                        <li>
                            <h5>
                                <a href="https://mariadb.com/products" title="Products">Products</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/services" title="Services">Services</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/pricing" title="Pricing">Pricing</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/resources" title="Resources">Resources</a>
                            </h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/about-us" title="About MariaDB">About Us</a></h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/download" title="Download">Download MariaDB</a></h5>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="row row-10">
                
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div id="block-footerformcontact" class="block block-block-content block-block-contentd754ee1b-3cc9-40e7-9ef4-f504f1197fb1">
                        
                            <h5 style="font-weight: 400;">Subscribe to our newsletter!</h5>
                            <script src="//app-sj15.marketo.com/js/forms2/js/forms2.min.js"></script><form id="mktoForm_1498"></form>
                            <script>
                                <!--//--><![CDATA[// ><!--
                                MktoForms2.loadForm("//app-sj15.marketo.com", "573-PXI-984", 1498);
                                //--><!]]]]><![CDATA[>
                                //--><!]]>
                            </script>
                        
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div class="footer-copyright">
                        <div class="text-center">
                            <ul class="list-inline no-margin">
                                <li>
                                    <a href="/legal" title="Legal">Legal</a>
                                </li>
                                <li>
                                    <a href="/privacy-policy" title="Privacy Policy">Privacy Policy</a>
                                </li>
                                <li>
                                    <a href="/cookie-policy/" title="Cookies">Cookie Policy</a>
                                </li>
                            </ul>
                            <p>Copyright &copy; 2024 MariaDB. All rights reserved.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</footer>
</div>

<div id="ajax_loading">
    <img src="/kb/static/images/ajax-loader.a51c5608d01a.gif" />
</div>

    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MK2847"
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MK2847');</script>
    <!-- End Google Tag Manager -->

</body>

<script type="text/javascript" src="/kb/static/js/main.1587e3a666fc.js" charset="utf-8"></script>

</html>