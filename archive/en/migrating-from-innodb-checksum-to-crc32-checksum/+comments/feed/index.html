<?xml version="1.0" encoding="utf-8"?>
<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title>MariaDB Knowledge Base Comments for: Migrating from 'innodb' checksum to 'crc32' checksum</title><link>https://mariadb.com/kb/en/migrating-from-innodb-checksum-to-crc32-checksum/+comments/feed/</link><description></description><atom:link href="https://mariadb.com/kb/en/migrating-from-innodb-checksum-to-crc32-checksum/+comments/feed/" rel="self"></atom:link><language>en-us</language><lastBuildDate>Mon, 06 Jan 2025 16:44:32 +0000</lastBuildDate><item><title>Re: Migrating from 'innodb' checksum to 'crc32' checksum</title><link>https://mariadb.com/kb/en/migrating-from-innodb-checksum-to-crc32-checksum/+comments/6427</link><description>&lt;p&gt;Noted and Thank you Ian!&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Keshan Nageswaran</dc:creator><guid>https://mariadb.com/kb/en/migrating-from-innodb-checksum-to-crc32-checksum/+comments/6427</guid></item><item><title>Re: Migrating from 'innodb' checksum to 'crc32' checksum</title><link>https://mariadb.com/kb/en/migrating-from-innodb-checksum-to-crc32-checksum/+comments/6426</link><description>&lt;p&gt;No, &lt;code&gt;innochecksum&lt;/code&gt; does not fully support &lt;code&gt;full_crc32&lt;/code&gt; - see &lt;a href="https://jira.mariadb.org/browse/MDEV-26907"&gt;MDEV-26907&lt;/a&gt;. If &lt;code&gt;innochecksum&lt;/code&gt; is a required part of your workflow, you could stick with &lt;code&gt;crc32&lt;/code&gt;.&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Ian Gilfillan</dc:creator><guid>https://mariadb.com/kb/en/migrating-from-innodb-checksum-to-crc32-checksum/+comments/6426</guid></item><item><title>Re: Migrating from 'innodb' checksum to 'crc32' checksum</title><link>https://mariadb.com/kb/en/migrating-from-innodb-checksum-to-crc32-checksum/+comments/6425</link><description>&lt;p&gt;Thank you for this Marko. The solutions provided are of real help for us. One last question, does the &lt;code&gt;innodchecksum&lt;/code&gt; utility support &lt;code&gt;full_crc32&lt;/code&gt; validation?&lt;/p&gt;
&lt;p&gt;&lt;em&gt;"and then start the server with &lt;code&gt;innodb_checksum_algorithm=strict_full_crc32&lt;/code&gt; so that new files will be created in the full_crc32 format, and for any old-format files only the crc32 page checksums will be allowed."&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;In my understanding from the above statement, I believe we would end up having mix of crc32(old pages) and full_crc32(new pages), will this cause any issues during checksum validation with &lt;code&gt;innodchecksum&lt;/code&gt; utility?&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Keshan Nageswaran</dc:creator><guid>https://mariadb.com/kb/en/migrating-from-innodb-checksum-to-crc32-checksum/+comments/6425</guid></item><item><title>Re: Migrating from 'innodb' checksum to 'crc32' checksum</title><link>https://mariadb.com/kb/en/migrating-from-innodb-checksum-to-crc32-checksum/+comments/6423</link><description>&lt;p&gt;I realize that it might be helpful to add back the &lt;code class="fixed" style="white-space:pre-wrap"&gt;innodb&lt;/code&gt; and &lt;code class="fixed" style="white-space:pre-wrap"&gt;none&lt;/code&gt; checksum algorithms to the &lt;code class="fixed" style="white-space:pre-wrap"&gt;innochecksum&lt;/code&gt; utility. This would require some code refactoring, duplicating some InnoDB source code instead of compiling that code with special options for inclusion in &lt;code class="unknown_macro"&gt;&amp;lt;&amp;lt;&lt;span class="macro_name"&gt;code&lt;/span&gt;&lt;span class="macro_arg_string"&gt;&amp;gt;innochecksum&amp;lt;&amp;lt;/code&lt;/span&gt;&amp;gt;&amp;gt;&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;On the other hand, you could use the &lt;code class="fixed" style="white-space:pre-wrap"&gt;innochecksum&lt;/code&gt; utility from an older release to verify that the page checksums are valid and to convert them to the &lt;code class="fixed" style="white-space:pre-wrap"&gt;crc32&lt;/code&gt; checksum. If you do not care about the verification step, then you should be able to blindly rewrite the page checksums to the &lt;code class="fixed" style="white-space:pre-wrap"&gt;crc32&lt;/code&gt; format.&lt;/p&gt;
&lt;p&gt;Still, I think that the best solution would be to rebuild all InnoDB tables, simply by &lt;code class="fixed" style="white-space:pre-wrap"&gt;OPTIMIZE TABLE&lt;/code&gt;. To see which tables are not in the full_crc32 format yet, try the following trick from &lt;a href="https://jira.mariadb.org/browse/MDEV-32230"&gt;MDEV-32230&lt;/a&gt;:
&lt;code class="fixed" style="white-space:pre-wrap"&gt;SELECT name FROM INFORMATION_SCHEMA.INNODB_SYS_TABLESPACES WHERE row_format IS NULL;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;I am afraid that the only way to convert the InnoDB system tablespace to the &lt;code class="fixed" style="white-space:pre-wrap"&gt;full_crc32&lt;/code&gt; format would be to rebuild the entire database from a logical dump. The next best thing that you could do is to use &lt;code class="fixed" style="white-space:pre-wrap"&gt;innochecksum&lt;/code&gt; to convert each page to the &lt;code class="fixed" style="white-space:pre-wrap"&gt;crc32&lt;/code&gt; checksum, and then start the server with &lt;code class="fixed" style="white-space:pre-wrap"&gt;innodb_checksum_algorithm=strict_full_crc32&lt;/code&gt; so that new files will be created in the &lt;code class="fixed" style="white-space:pre-wrap"&gt;full_crc32&lt;/code&gt; format, and for any old-format files only the &lt;code class="fixed" style="white-space:pre-wrap"&gt;crc32&lt;/code&gt; page checksums will be allowed.&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Marko Mäkelä</dc:creator><guid>https://mariadb.com/kb/en/migrating-from-innodb-checksum-to-crc32-checksum/+comments/6423</guid></item><item><title>Re: Migrating from 'innodb' checksum to 'crc32' checksum</title><link>https://mariadb.com/kb/en/migrating-from-innodb-checksum-to-crc32-checksum/+comments/6422</link><description>&lt;p&gt;Thank you for the detailed explanation. &lt;/p&gt;
&lt;p&gt;The issue that I am facing right now. I am trying to upgrade MariaDB from 10.4.10 to 10.11.4. The checksum algorithm used in 10.4.10 is &lt;strong&gt;innodb&lt;/strong&gt;. The checksum we are trying to use in 10.11.4 is &lt;strong&gt;full_crc32&lt;/strong&gt;. We take physical backups in 10.4.10. The restore process includes &lt;a href="https://mariadb.com/kb/en/innochecksum/"&gt;innochecksum utility&lt;/a&gt; to compare checksums generated with stored checksums to identify any damages to data pages. &lt;/p&gt;
&lt;p&gt;When I try restore of the backup taken in 10.4.10 with &lt;strong&gt;innodb&lt;/strong&gt; checksum to &lt;a href="/kb/en/mariadb-10-11-4-release-notes/"&gt;MariaDB 10.11.4&lt;/a&gt; with &lt;strong&gt;full_crc32&lt;/strong&gt; checksum. Checksum comparison fails for each innodb tables in my database at the first page complaining as following; &lt;/p&gt;
&lt;pre&gt;{
Fail: page::0 invalid
Exceeded the maximum allowed checksum mismatch count::1 current::0
Error: Page 0 checksum mismatch, can't continue.
}&lt;/pre&gt;
&lt;p&gt;As mentioned previously we use innochecksum utility to make this comparison. The initial understanding is that innochecksum utility has removed deprecated checksum algorithms from use (&lt;strong&gt;innnodb&lt;/strong&gt;, &lt;strong&gt;none&lt;/strong&gt;). Hence, it will not be supported. &lt;a href="https://jira.mariadb.org/browse/MDEV-25105"&gt;MDEV-25105&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Then we decided to migrate the checksum algorithm to a algorithm(crc32) supported in innochecksum utility and &lt;a href="/kb/en/mariadb-10410-release-notes/"&gt;MariaDB 10.4.10&lt;/a&gt; (full_crc32 was not considered as it was not introduced in 10.4.10 version), then, take physical backups. Hence, the physical backups taken would be compatible with &lt;a href="/kb/en/mariadb-10-11-4-release-notes/"&gt;MariaDB 10.11.4&lt;/a&gt; if we use &lt;strong&gt;crc32/full_crc32&lt;/strong&gt; algorithm.&lt;/p&gt;
&lt;h4 class="anchored_heading" id="my-followup-questions"&gt;My followup questions:&lt;/h4&gt;
&lt;ul&gt;&lt;li&gt;how can I rebuild all innodb tables during migration of &lt;strong&gt;innodb_checksum_algorithm&lt;/strong&gt; configuration to have all blocks updated and not wait until it gets updated over time?
&lt;/li&gt;&lt;li&gt;Ideal scenario that I would like to achieve is to use 10.4.10 backups in 10.11.4 with the migrated checksum algorithm (innodb-&amp;gt;full_crc32). How can I achieve it?
&lt;/li&gt;&lt;li&gt;I had the same understanding as you mentioned that no change required. What could be the reason for the failure during checksum validation at first page?  
&lt;/li&gt;&lt;/ul&gt;
&lt;div style="margin-left:2em"&gt;&lt;ul&gt;&lt;li&gt;Is it because mismatch of checksum algorithms used (backup has &lt;strong&gt;innodb&lt;/strong&gt; and validating server has &lt;strong&gt;crc32/full_crc32&lt;/strong&gt; assigned in configuration) ?   
&lt;/li&gt;&lt;li&gt;In that case, what is recommended? How we can check for integrity of data during restore?
&lt;/li&gt;&lt;li&gt;can &lt;strong&gt;write&lt;/strong&gt; option specified in &lt;a href="https://mariadb.com/kb/en/innochecksum/"&gt;innochecksum utility&lt;/a&gt; be used to rewrite the new checksum algorithm for all .ibd tables if there is no way to rebuild all blocks at once?&lt;/li&gt;&lt;/ul&gt;
&lt;/div&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Keshan Nageswaran</dc:creator><guid>https://mariadb.com/kb/en/migrating-from-innodb-checksum-to-crc32-checksum/+comments/6422</guid></item><item><title>Re: Migrating from 'innodb' checksum to 'crc32' checksum</title><link>https://mariadb.com/kb/en/migrating-from-innodb-checksum-to-crc32-checksum/+comments/6417</link><description>&lt;p&gt;&lt;strong&gt;Scenario&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;If we are migrating from &lt;strong&gt;innodb&lt;/strong&gt; -&amp;gt; &lt;strong&gt;crc32/full_crc32&lt;/strong&gt; checksum algorithm. Should we execute the checksum validation using innochecksum utility during restore of backup. &lt;strong&gt;Note:&lt;/strong&gt; The backup contains &lt;strong&gt;innodb&lt;/strong&gt; checksum stored and server has &lt;strong&gt;crc32&lt;/strong&gt; checksum configuration.  As I remember, new checksum will only be used/picked up when blocks are modified. &lt;/p&gt;
&lt;ul start="1"&gt;&lt;li&gt;Instead of waiting for blocks to be modified over time for the new checksum to be used, how can we rebuild the tables so all blocks gets updated?
&lt;/li&gt;&lt;li&gt;Should we skip the checksum validation during restore?&lt;/li&gt;&lt;/ul&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Keshan Nageswaran</dc:creator><guid>https://mariadb.com/kb/en/migrating-from-innodb-checksum-to-crc32-checksum/+comments/6417</guid></item><item><title>Re: Migrating from 'innodb' checksum to 'crc32' checksum</title><link>https://mariadb.com/kb/en/migrating-from-innodb-checksum-to-crc32-checksum/+comments/6415</link><description>&lt;p&gt;As you can read in &lt;a href="https://jira.mariadb.org/browse/MDEV-25105"&gt;MDEV-25105&lt;/a&gt;, no action is needed when you are migrating to the &lt;a href="/kb/en/what-is-mariadb-102/"&gt;MariaDB 10.2&lt;/a&gt; default &lt;code class="fixed" style="white-space:pre-wrap"&gt;innodb_checksum_algorithm=crc32&lt;/code&gt; or the &lt;a href="/kb/en/what-is-mariadb-105/"&gt;MariaDB 10.5&lt;/a&gt; default (&lt;a href="https://jira.mariadb.org/browse/MDEV-19534"&gt;MDEV-19534&lt;/a&gt;) &lt;code class="fixed" style="white-space:pre-wrap"&gt;innodb_checksum_algorithm=full_crc32&lt;/code&gt; that was introduced in &lt;a href="/kb/en/what-is-mariadb-104/"&gt;MariaDB 10.4&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The &lt;code class="fixed" style="white-space:pre-wrap"&gt;full_crc32&lt;/code&gt; checksum was introduced, because the old approach to checksums was insecure. In the old design, any page of a data file can use any of the previously supported checksum algorithms. The older checksums were extremely slow to compute and insecure; as a work-around someone got the idea to make it possible to disable page checksums. The &lt;code class="fixed" style="white-space:pre-wrap"&gt;crc32&lt;/code&gt; checksum is a little better if you ignore &lt;a href="https://jira.mariadb.org/browse/MDEV-17958"&gt;MDEV-17958&lt;/a&gt;, but it does not cover the entire data page and it is being computed as an insecure way (an exclusive OR of several CRC-32C checksums).&lt;/p&gt;
&lt;p&gt;Before &lt;a href="/kb/en/what-is-mariadb-104/"&gt;MariaDB 10.4&lt;/a&gt;, the most secure option was to set &lt;code class="fixed" style="white-space:pre-wrap"&gt;innodb_checksum_algorithm=strict_crc32&lt;/code&gt; so that only the &lt;code class="fixed" style="white-space:pre-wrap"&gt;crc32&lt;/code&gt; checksum is allowed on any data pages. A corrupted page could accidentally carry a checksum that is valid when using one of the other algorithms.&lt;/p&gt;
&lt;p&gt;The &lt;code class="fixed" style="white-space:pre-wrap"&gt;full_crc32&lt;/code&gt; checksum format is identified by a flag in the first page of the data file. If a file was created in this format, all its data pages must always use the same checksum, no matter what &lt;code class="fixed" style="white-space:pre-wrap"&gt;innodb_checksum_algorithm&lt;/code&gt; was later set to. Another guarantee is that all unused parts of data pages will be filled with NUL bytes.&lt;/p&gt;
&lt;p&gt;Data files that were created before MySQL 5.1.48 or &lt;a href="/kb/en/mariadb-5148-release-notes/"&gt;MariaDB 5.1.48&lt;/a&gt; could contain arbitrary garbage in unused parts of data pages. Even though we try to keep this in mind, sometimes bugs like &lt;a href="https://jira.mariadb.org/browse/MDEV-27800"&gt;MDEV-27800&lt;/a&gt; happen. The only way to convert files to the secure &lt;code class="fixed" style="white-space:pre-wrap"&gt;innodb_checksum_algorithm=full_crc32&lt;/code&gt; format is to rebuild the tables. I believe that the system tablespace can only be converted by dumping and reloading the entire database.&lt;/p&gt;
&lt;p&gt;It is not feasible to implement logic in a tool like &lt;code class="fixed" style="white-space:pre-wrap"&gt;innochecksum&lt;/code&gt; to try to determine which parts of each page might be unused and would need to be zeroed out, because this cannot always be determined by looking at an individual data page in isolation from others.&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Marko Mäkelä</dc:creator><guid>https://mariadb.com/kb/en/migrating-from-innodb-checksum-to-crc32-checksum/+comments/6415</guid></item><item><title>Re: Migrating from 'innodb' checksum to 'crc32' checksum</title><link>https://mariadb.com/kb/en/migrating-from-innodb-checksum-to-crc32-checksum/+comments/6411</link><description>&lt;p&gt;Thank you for the explanation!&lt;/p&gt;
&lt;p&gt;I agree, checksum is only used as blocks are modified.&lt;/p&gt;
&lt;p&gt;I have noticed is if any block in .ibd tables that were not modified over time after checksum change(innodb -&amp;gt; crc32), and when these .ibd tables used for restoring, checksum check fails against crc32. 
During the above scenario what is recommended? rewrite the blocks that were not updated with new checksum algorithm? so it would pass the checksum check during restore process?&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Keshan Nageswaran</dc:creator><guid>https://mariadb.com/kb/en/migrating-from-innodb-checksum-to-crc32-checksum/+comments/6411</guid></item><item><title>Re: Migrating from 'innodb' checksum to 'crc32' checksum</title><link>https://mariadb.com/kb/en/migrating-from-innodb-checksum-to-crc32-checksum/+comments/6410</link><description>&lt;p&gt;Yes, the table can be created and populated with the &lt;code&gt;innodb&lt;/code&gt; checksum, and then the algorithm changed at a later stage, and everything should work smoothly. The only thing to take note of is that blocks using the crc32 checksum will be incompatible with earlier versions, so there's no going back. There is no need to use &lt;code&gt;innodbchecksum&lt;/code&gt;, and no specific point at which the change happens, as the new checksum is only used as blocks are modified over time.&lt;/p&gt;
&lt;p&gt;If you want to put yourself at ease, you can use &lt;a href="/kb/en/check-table/"&gt;CHECK TABLE&lt;/a&gt;.&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Ian Gilfillan</dc:creator><guid>https://mariadb.com/kb/en/migrating-from-innodb-checksum-to-crc32-checksum/+comments/6410</guid></item><item><title>Re: Migrating from 'innodb' checksum to 'crc32' checksum</title><link>https://mariadb.com/kb/en/migrating-from-innodb-checksum-to-crc32-checksum/+comments/6409</link><description>&lt;p&gt;This applies for existing data that was supported by 'innodb' checksum? Or I should be rewriting the &lt;em&gt;.ibd&lt;/em&gt; tables with crc32 checksum using &lt;a href="https://mariadb.com/kb/en/innochecksum/"&gt;innodbchecksum&lt;/a&gt; utility? &lt;/p&gt;
&lt;p&gt;One more question, how would I validate that there wasn't any damage to pages after the change?&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Keshan Nageswaran</dc:creator><guid>https://mariadb.com/kb/en/migrating-from-innodb-checksum-to-crc32-checksum/+comments/6409</guid></item><item><title>Re: Migrating from 'innodb' checksum to 'crc32' checksum</title><link>https://mariadb.com/kb/en/migrating-from-innodb-checksum-to-crc32-checksum/+comments/6408</link><description>&lt;p&gt;There should be no steps necessary. After changing &lt;a href="/kb/en/innodb-system-variables/#innodb_checksum_algorithm"&gt;innodb_checksum_algorithm&lt;/a&gt;, blocks are updated gradually as data is modified.&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Ian Gilfillan</dc:creator><guid>https://mariadb.com/kb/en/migrating-from-innodb-checksum-to-crc32-checksum/+comments/6408</guid></item></channel></rss>