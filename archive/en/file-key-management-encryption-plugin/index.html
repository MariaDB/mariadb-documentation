<!DOCTYPE html>
<html>
<head data-cookie-domain=""
      data-cookie-path="/">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="apple-touch-icon" sizes="180x180" href="/kb/static/images/favicons/apple-touch-icon.159e713979be.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/kb/static/images/favicons/favicon-32x32.bc0ac1d5d11e.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/kb/static/images/favicons/favicon-16x16.5801f8f0f34e.png">
    <link rel="shortcut icon" href="/kb/static/images/favicons/favicon.d122d305dee4.ico" type="image/x-icon" />

    <title>File Key Management Encryption Plugin - MariaDB Knowledge Base</title>

    <link href="/kb/static/css/main.f7633538c846.css" rel="stylesheet" type="text/css" />

    

    

    <!-- FB Open Graph tags -->
    <meta property="og:title" content="File Key Management Encryption Plugin" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://mariadb.com/kb/en/file-key-management-encryption-plugin/" />
    <meta property="og:image" content="http://mariadb.comaskmonty-logo.png" />
    <meta property="og:site_name" content="MariaDB KnowledgeBase" />
    <meta property="fb:admins" content="514852603" />
    <meta property="og:description" content="A key management and encryption plugin for data-at-rest encryption that uses a plain-text file." />

    <meta name="description" content="A key management and encryption plugin for data-at-rest encryption that uses a plain-text file." />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet"/>
    
</head>
<body class="mpkb nodes products nodes_view jqui" id="nodes_view">





<div id="menu-mobile" class="visible-sm visible-xs">

    <div>
        <div id="mobile-close-menu" class="text-right">
            <a href="javascript:void(0)" title="Close Menu" id="back-main" class="toggle-menu">X<span></span></a>
        </div>
    </div>
    <div class="mainmenu-mobile">
        <ul class="ls-none ul-menu">
            <li data-sub="submenu5"><a class="open-form-search" href="/kb/search/" title="Search">Search </a></li>
            <li data-sub="submenu0"><a href="/products" title="Products">Products</a><span class="arrow-main"></span></li>
            <li data-sub="submenu1"><a href="/services" title="Services">Services</a><span class="arrow-main"></span></li>
            <li data-sub="submenu2"><a href="/resources" title="Resources">Resources</a><span class="arrow-main"></span></li>
            <li data-sub="submenu3"><a href="/about-us" title="About">About</a><span class="arrow-main"></span></li>
            <li data-sub="submenu4"><a href="/contact" title="Contact">Contact</a></li>
        </ul>
    </div>

    <div class="nav-top-mobile">
        <div class="select-box form">

            <ul class="inline-block-md mb-none top-nav">
                <li>

                </li>
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/file-key-management-encryption-plugin/"> Login</a>
                    </li>
                
            </ul>



        </div>
        <p class="text-center copyright">Copyright &copy; 2024 MariaDB. All rights reserved.</p>
    </div>
</div>
<div class="violator-wrap d-none" id="top_violator">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12">
                <div class="violator-outer">
                    <div class="violator-inner">
                        <div class="row">
                            <div class="col-xs-12 col-sm-9 col-lg-7 col-lg-offset-2" id="top_violator_content">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="content-link" target="_blank" rel="nofollow noreferrer">
                                    <span>The Ultimate Guide to High Availability with MariaDB</span>
                                </a>
                            </div>
                            <div class="col-xs-12 col-sm-3" id="top_violator_cta">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="btn btn-mariadb" target="_blank" rel="nofollow noreferrer">Download Now</a>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-link close-btn">
                        <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24" width="15px" height="15px"><path d="M 4.9902344 3.9902344 A 1.0001 1.0001 0 0 0 4.2929688 5.7070312 L 10.585938 12 L 4.2929688 18.292969 A 1.0001 1.0001 0 1 0 5.7070312 19.707031 L 12 13.414062 L 18.292969 19.707031 A 1.0001 1.0001 0 1 0 19.707031 18.292969 L 13.414062 12 L 19.707031 5.7070312 A 1.0001 1.0001 0 0 0 18.980469 3.9902344 A 1.0001 1.0001 0 0 0 18.292969 4.2929688 L 12 10.585938 L 5.7070312 4.2929688 A 1.0001 1.0001 0 0 0 4.9902344 3.9902344 z"/></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="wrapper">
<div id="top-nav">
    <div class="container">
        <ul class="hidden-sm hidden-xs" >
            <li><a href="https://mariadb.com/kb/">Knowledge Base</a></li>
            <li><a href="https://mariadb.com/contact/">Contact</a></li>
            
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/file-key-management-encryption-plugin/" rel="nofollow">Login</a>
                    </li>
                
            
            
            <li id="search-form">
                <form action="/kb/en/+search/" method="get" id="search-block-form" accept-charset="UTF-8">
                    <input id="search" title="Enter the terms you wish to search for."
                           placeholder="Search . . ." type="text"
                           name="q" value="" size="15" maxlength="128" class="form-text"
                           data-autocomplete-url="/kb/en/+search/autocomplete/">
                    <input type="hidden" name="quick" value="1" />
                    <input type="hidden" name="source" value="kb" />
                </form>
            </li>
            <li><a id="search-toggler" href="/kb/search/">Search</a></li>
            
        </ul>
    </div>
</div>
<div id="navbar-bottom" class="navbar">
    <div class="container">
        
        
        
        
        <div class="row">
            <div class="col-md-3 col-sm-9 col-xs-9">
                <a class="brand" href="/" title="MariaDB">
                    <img src="/kb/static/images/logo-2018-black.95f5978ae14d.png">
                </a>
            </div>
            <div class="col-md-9 hidden-sm hidden-xs">
                <div class="main-menu">
                    <ul id="main-menu" class="nav navbar-nav inline-block-sm">
    <li class="has-sub full-menu">
        <a href="/products" title="Products">Products</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/services" title="Services">Services</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/pricing" title="Pricing">Pricing</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/resources" title="Resources">Resources</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/about-us" title="About Us">About Us</a>
    </li>
    <li class="">
        <a class="button electric-eel small top-bar-right-download" href="/downloads/">Download</a>
    </li>
</ul>
                </div>
            </div>
            <div class="col-md-3 visible-sm visible-xs col-sm-3 col-xs-3 ps-rv">
                <div class="navbar-header text-right pull-right">
                    <button type="button" class="menu-control toggle-menu" id="open-menu">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="main">
    <div class="container">
        

        <div id="subheader1" class="clearfix">
            <div class="pull-left">
                
                <div id="breadcrumbs" class="breadcrumb">
                    <a href="/kb/en/">Knowledge Base</a>
                    


    
    » <a class="crumb" href="/kb/en/documentation/">MariaDB Server Documentation</a>
    

    
    » <a class="crumb" href="/kb/en/mariadb-administration/">MariaDB Administration</a>
    

    
    » <a class="crumb" href="/kb/en/user-server-security/">User &amp; Server Security</a>
    

    
    » <a class="crumb" href="/kb/en/securing-mariadb/">Securing MariaDB</a>
    

    
    » <a class="crumb" href="/kb/en/securing-mariadb-encryption/">Encryption</a>
    

    
    » <a class="crumb" href="/kb/en/encryption-data-at-rest-encryption/">Data-at-Rest Encryption</a>
    

    
    » <a class="crumb" href="/kb/en/key-management-and-encryption-plugins/">Key Management and Encryption Plugins</a>
    


    » <a class="node_link crumb" href="/kb/en/file-key-management-encryption-plugin/">File Key Management Encryption Plugin</a>


                </div>
                
            </div>
        </div>
    </div>
    <div class="container" id="container-main">
        <div class="row">
            
            
                
                <aside id="sidebar-first" class="sidebar col-md-2 hidden-xs hidden-sm hidden-print">
                    
                        
                        <ul id="category_menu" class="nav nav-pills nav-stacked">
                            <li><a href="/kb/en/">Home</a></li>
                            
                                
                                    <li><a href="/kb/en/+questions/">Open Questions</a></li>
                                
                                <li><a href="/kb/en/documentation/">MariaDB Server</a></li>
                                <li><a href="/kb/en/maxscale/">MariaDB MaxScale</a></li>
                                <li><a href="/kb/en/mariadb-columnstore/">MariaDB ColumnStore</a></li>
                                <li><a href="/kb/en/connectors/">Connectors</a></li>
                            

                        </ul>
                    

                    
<div>



<div class="well well-small box actions"><div>

        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/file-key-management-encryption-plugin/+history" rel="nofollow">History</a>
        
        
        
        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/file-key-management-encryption-plugin/+source/">Source</a>
        
        <a class="btn btn-block btn-blue btn-sm flag" href="/kb/en/file-key-management-encryption-plugin/+flag"
                data-flag-url="/kb/en/file-key-management-encryption-plugin/+flag" rel="nofollow">
                Flag as Spam / Inappropriate</a>
        
        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/file-key-management-encryption-plugin/+translate/">
                Translate</a>
        

</div>
</div>





<div class="well well-small box node_info"><div>

    <dl>
        <dt>Created</dt>
        <dd>

<span class="datetime" title="2019-01-14 20:18">5 years, 6 months ago</span></dd>

        <dt>Modified</dt>
        <dd>

<span class="datetime" title="2024-07-23 11:15">1 week, 5 days ago</span></dd>

        <dt>Type</dt>
        <dd>article</dd>

        <dt>Status</dt>
        <dd>active</dd>

        <dt>License</dt>
        <dd>
            
                <a href="/kb/en/file-key-management-encryption-plugin/+license/">CC BY-SA / Gnu FDL</a>
            
        </dd>

        
    </dl>

    
    <ul class="rss_feeds">
        <li><a href="/kb/en/file-key-management-encryption-plugin/+history/feed/">
            History</a>
        </li>
        <li><a href="/kb/en/file-key-management-encryption-plugin/+comments/feed/">
            Comments</a>
        </li>
    </ul>
    

</div>
</div>





    
    
    

<div class="well well-small box attachments"><div><div class="edit_link pull-right"><a href="/kb/en/file-key-management-encryption-plugin/+edit/attachments/">Edit</a></div><h5>Attachments</h5></div><div>

        
            <div class="no_data">No attachments exist</div>
        
    
</div>
</div>

    



    
    






</div>


                    

































                </aside>
            
            
            
                
            
            
                
            
            <section id="content" class="limited_width col-md-8 clearfix">
                
                    <h1>File Key Management Encryption Plugin</h1>
                

                



                <div>
                    
    

    
    
    

    <div class="node creole">
        
        
        


    
    <div class="answer formatted">
        <div class="table_of_contents well well-small">
<h3>Contents</h3>
 <ol class="toc">

    <li class=""><a href="#overview" title="Overview">Overview</a></li>

    <li class=""><a href="#installing-the-file-key-management-plugins-package" title="Installing the File Key Management Plugin&#39;s Package">Installing the File Key Management Plugin&#39;s Package</a></li>

    <li class=""><a href="#installing-the-plugin" title="Installing the Plugin">Installing the Plugin</a></li>

    <li class=""><a href="#uninstalling-the-plugin" title="Uninstalling the Plugin">Uninstalling the Plugin</a></li>

    <li class=""><a href="#creating-the-key-file" title="Creating the Key File">Creating the Key File</a>    <ol class="toc">

        <li class=""><a href="#configuring-the-path-to-an-unencrypted-key-file" title="Configuring the Path to an Unencrypted Key File">Configuring the Path to an Unencrypted Key File</a>    </ol>
</li>

    <li class=""><a href="#encrypting-the-key-file" title="Encrypting the Key File">Encrypting the Key File</a>    <ol class="toc">

        <li class=""><a href="#configuring-the-path-to-an-encrypted-key-file" title="Configuring the Path to an Encrypted Key File">Configuring the Path to an Encrypted Key File</a>    </ol>
</li>

    <li class=""><a href="#choosing-an-encryption-algorithm" title="Choosing an Encryption Algorithm">Choosing an Encryption Algorithm</a>    <ol class="toc">

        <li class=""><a href="#configuring-the-encryption-algorithm" title="Configuring the Encryption Algorithm">Configuring the Encryption Algorithm</a>    </ol>
</li>

    <li class=""><a href="#using-the-file-key-management-plugin" title="Using the File Key Management Plugin">Using the File Key Management Plugin</a></li>

    <li class=""><a href="#using-multiple-encryption-keys" title="Using Multiple Encryption Keys">Using Multiple Encryption Keys</a></li>

    <li class=""><a href="#key-rotation" title="Key Rotation">Key Rotation</a></li>

    <li class=""><a href="#versions" title="Versions">Versions</a></li>

    <li class=""><a href="#system-variables" title="System Variables">System Variables</a>    <ol class="toc">

        <li class=""><a href="#file_key_management_encryption_algorithm" title="file_key_management_encryption_algorithm">file_key_management_encryption_algorithm</a></li>

        <li class=""><a href="#file_key_management_filekey" title="file_key_management_filekey">file_key_management_filekey</a></li>

        <li class=""><a href="#file_key_management_filename" title="file_key_management_filename">file_key_management_filename</a>    </ol>
</li>

    <li class=""><a href="#options" title="Options">Options</a>    <ol class="toc">

        <li class=""><a href="#file_key_management" title="file_key_management">file_key_management</a>    </ol>
 </ol>
</li>
</div>
<p>MariaDB's <a href="/kb/en/data-at-rest-encryption/">data-at-rest encryption</a> requires the use of a <a href="/kb/en/encryption-key-management/">key management and encryption plugin</a>. These plugins are responsible both for the management of encryption keys and for the actual encryption and decryption of data.</p>
<p>MariaDB supports the use of <a href="/kb/en/encryption-key-management/#using-multiple-encryption-keys">multiple encryption keys</a>. Each encryption key uses a 32-bit integer as a key identifier. If the specific plugin supports <a href="/kb/en/encryption-key-management/#key-rotation">key rotation</a>, then encryption keys can also be rotated, which creates a new version of the encryption key.</p>
<p>The File Key Management plugin that ships with MariaDB is a <a href="/kb/en/encryption-key-management/">key management and encryption plugin</a> that reads encryption keys from a plain-text file.</p>
<h2 class="anchored_heading" id="overview">Overview</h2>
<p>The File Key Management plugin is the easiest <a href="/kb/en/encryption-key-management/">key management and encryption plugin</a> to set up for users who want to use <a href="/kb/en/data-at-rest-encryption/">data-at-rest encryption</a>. Some of the plugin's primary features are:</p>
<ul start="1"><li>It reads encryption keys from a plain-text key file.
</li><li>As an extra protection mechanism, the plain-text key file can be encrypted.
</li><li>It supports multiple encryption keys.
</li><li>It does <strong>not</strong> support key rotation.
</li><li>It supports two different algorithms for encrypting data. 
</li></ul>
<p>It can also serve as an example and as a starting point when developing a key management and encryption plugin with the <a href="/kb/en/encryption-plugin-api/">encryption plugin API</a>.</p>
<h2 class="anchored_heading" id="installing-the-file-key-management-plugins-package">Installing the File Key Management Plugin's Package</h2>
<p>The File Key Management plugin is included in MariaDB packages as the <code>file_key_management.so</code> or <code>file_key_management.dll</code> shared library. The shared library is in the main server package, so no additional package installations are necessary. The plug-in must be installed into MariaDB however as follows.</p>
<h2 class="anchored_heading" id="installing-the-plugin">Installing the Plugin</h2>
<p>Although the plugin's shared library is distributed with MariaDB by default, the plugin is not actually installed by MariaDB by default. The plugin can be installed by providing the <code><a href="/kb/en/mysqld-options/#-plugin-load">--plugin-load</a></code> or the <code><a href="/kb/en/mysqld-options/#-plugin-load-add">--plugin-load-add</a></code> options. This can be specified as a command-line argument to <code><a href="/kb/en/mysqld-options/">mysqld</a></code> or it can be specified in a relevant server <a href="/kb/en/configuring-mariadb-with-option-files/#option-groups">option group</a> in an <a href="/kb/en/configuring-mariadb-with-option-files/">option file</a>. For example:</p>
<pre class="fixed">[mariadb]
...
plugin_load_add = file_key_management
</pre><h2 class="anchored_heading" id="uninstalling-the-plugin">Uninstalling the Plugin</h2>
<p>Before you uninstall the plugin, you should ensure that <a href="/kb/en/data-at-rest-encryption/">data-at-rest encryption</a> is completely disabled, and that MariaDB no longer needs the plugin to decrypt tables or other files.</p>
<p>You can uninstall the plugin dynamically by executing <code><a href="/kb/en/uninstall-soname/">UNINSTALL SONAME</a></code> or <code><a href="/kb/en/uninstall-plugin/">UNINSTALL PLUGIN</a></code>. For example:</p>
<pre class="fixed"><span class="n">UNINSTALL</span> <span class="n">SONAME</span> <span class="s1">&#39;file_key_management&#39;</span><span class="p">;</span>
</pre><p>If you installed the plugin by providing the <code><a href="/kb/en/mysqld-options/#-plugin-load">--plugin-load</a></code> or the <code><a href="/kb/en/mysqld-options/#-plugin-load-add">--plugin-load-add</a></code> options in a relevant server <a href="/kb/en/configuring-mariadb-with-option-files/#option-groups">option group</a> in an <a href="/kb/en/configuring-mariadb-with-option-files/">option file</a>, then those options should be removed to prevent the plugin from being loaded the next time the server is restarted.</p>
<h2 class="anchored_heading" id="creating-the-key-file">Creating the Key File</h2>
<p>In order to encrypt your tables with encryption keys using the File Key Management plugin, you first need to create the file that contains the encryption keys. The file needs to contain two pieces of information for each encryption key. First, each encryption key needs to be identified with a 32-bit integer as the key identifier. Second, the encryption key itself needs to be provided in hex-encoded form. These two pieces of information need to be separated by a semicolon. For example, the file is formatted in the following way:</p>
<pre class="fixed">&lt;encryption_key_id1&gt;;&lt;hex-encoded_encryption_key1&gt;
&lt;encryption_key_id2&gt;;&lt;hex-encoded_encryption_key2&gt;
</pre><p>You can also optionally encrypt the key file to make it less accessible from the file system. That is explained further in the section below.</p>
<p>The File Key Management plugin uses <a href="https://en.wikipedia.org/wiki/Advanced_Encryption_Standard">Advanced Encryption Standard (AES)</a> to encrypt data, which supports 128-bit, 192-bit, and 256-bit encryption keys. Therefore, the plugin also supports 128-bit, 192-bit, and 256-bit encryption keys.</p>
<p>You can generate random encryption keys using the <code><a href="https://www.openssl.org/docs/man1.1.1/man1/rand.html">openssl rand</a></code> command. For example, to create a random 256-bit (32-byte) encryption key, you would run the following command:</p>
<pre class="fixed">$ openssl rand -hex 32
a7addd9adea9978fda19f21e6be987880e68ac92632ca052e5bb42b1a506939a
</pre><p>The key file still needs to have a key identifier for each encryption key added to the beginning of each line. Key identifiers do not need to be contiguous. </p>
<p>For example, to append three new encryption keys to a new key file, you could execute the following:</p>
<pre class="fixed">$ (echo -n &#34;1;&#34; ; openssl rand -hex 32 ) | sudo tee -a  /etc/mysql/encryption/keyfile
$ (echo -n &#34;2;&#34; ; openssl rand -hex 32 ) | sudo tee -a  /etc/mysql/encryption/keyfile
$ (echo -n &#34;100;&#34; ; openssl rand -hex 32 ) | sudo tee -a  /etc/mysql/encryption/keyfile
</pre><p>The new key file would look something like the following after this step:</p>
<pre class="fixed">1;a7addd9adea9978fda19f21e6be987880e68ac92632ca052e5bb42b1a506939a
2;49c16acc2dffe616710c9ba9a10b94944a737de1beccb52dc1560abfdd67388b
100;8db1ee74580e7e93ab8cf157f02656d356c2f437d548d5bf16bf2a56932954a3
</pre><p>The key identifiers give you a way to reference the encryption keys from MariaDB. In the example above, you could reference these encryption keys using the key identifiers <code>1</code>, <code>2</code> or <code>100</code> with the <code><a href="/kb/en/create-table/#encryption_key_id">ENCRYPTION_KEY_ID</a></code> table option or with system variables such as <code><a href="/kb/en/innodb-system-variables/#innodb_default_encryption_key_id">innodb_default_encryption_key_id</a></code>. You do not necessarily need multiple encryption keys--the encryption key with the key identifier <code>1</code> is the only mandatory encryption key.</p>
<h3 class="anchored_heading" id="configuring-the-path-to-an-unencrypted-key-file">Configuring the Path to an Unencrypted Key File</h3>
<p>If the key file is unencrypted, then the File Key Management plugin only requires the <code><a href="#file_key_management_filename">file_key_management_filename</a></code> system variable to be configured.</p>
<p>This system variable can be specified as command-line arguments to <code><a href="/kb/en/mysqld-options/">mysqld</a></code> or it can be specified in a relevant server <a href="/kb/en/configuring-mariadb-with-option-files/#option-groups">option group</a> in an <a href="/kb/en/configuring-mariadb-with-option-files/">option file</a>. For example:</p>
<pre class="fixed">[mariadb]
...
loose_file_key_management_filename = /etc/mysql/encryption/keyfile
</pre><p>Note that the <code><a href="/kb/en/mysqld-options/#-loose-">loose</a></code> option prefix is specified. This option prefix is used in case the plugin hasn't been installed yet.</p>
<h2 class="anchored_heading" id="encrypting-the-key-file">Encrypting the Key File</h2>
<p>By enabling the File Key Management plugin and setting the appropriate path on the <code><a href="#file_key_management_filename">file_key_management_filename</a></code> system variable, you can begin using the plugin to manage your encryption keys.  But, there is a security risk in doing so, given that the keys are stored in plain text on your system.  You can reduce this exposure using file permissions, but it's better to encrypt the whole key file to further restrict access.</p>
<p>There are some important details to keep in mind about encrypting the key file, such as:</p>
<ul start="1"><li>The only algorithm that MariaDB currently supports to encrypt the key file is <a href="https://en.wikipedia.org/wiki/Block_cipher_mode_of_operation#CBC">Cipher Block Chaining (CBC)</a> mode of <a href="https://en.wikipedia.org/wiki/Advanced_Encryption_Standard">Advanced Encryption Standard (AES)</a>.
</li><li>The encryption key size can be 128-bits, 192-bits, or 256-bits.
</li><li>The encryption key is created from the <a href="https://en.wikipedia.org/wiki/SHA-1">SHA-1</a> hash of the encryption password.
</li><li>The encryption password has a max length of 256 characters.
</li></ul>
<p>You can generate a random encryption password using the <code><a href="https://www.openssl.org/docs/man1.1.1/man1/rand.html">openssl rand</a></code> command. For example, to create a random 256 character encryption password, you could execute the following:</p>
<pre class="fixed">$ sudo openssl rand -hex 128 &gt; /etc/mysql/encryption/keyfile.key
</pre><p>You can encrypt the key file using the <code><a href="https://www.openssl.org/docs/man1.1.1/man1/enc.html">openssl enc</a></code> command. For example, to encrypt the key file with the encryption password created in the previous step, you could execute the following:</p>
<pre class="fixed">$ sudo openssl enc -aes-256-cbc -md sha1 \
   -pass file:/etc/mysql/encryption/keyfile.key \
   -in /etc/mysql/encryption/keyfile \
   -out /etc/mysql/encryption/keyfile.enc
</pre><div class="cstm-style yellowbox"><p><strong>Note:</strong> some more recent <code>openssl</code> versions may complain with</p>
<pre>
*** WARNING : deprecated key derivation used.
Using -iter or -pbkdf2 would be better.
</pre>
<p>Keys generated that way won't work with the current implementation of the plugin though. Also as SHA1 is only used to generate the actual AES encryption key, from a long random string, it's not really an issue here. SHA1 deprecation is mostly related to checksum / signing use cases, not to what we are using it here for. </p>
</div><p>Running this command reads the unencrypted <code>keyfile</code> file created above and creates a new encrypted <code>keyfile.enc</code> file, using the encryption password stored in <code>keyfile.key</code>.  Once you've finished preparing your system, you can delete the unencrypted <code>keyfile</code> file, as it's no longer necessary.</p>
<h3 class="anchored_heading" id="configuring-the-path-to-an-encrypted-key-file">Configuring the Path to an Encrypted Key File</h3>
<p>If the key file is encrypted, then the File Key Management plugin requires both the <code><a href="#file_key_management_filename">file_key_management_filename</a></code>  and the <code><a href="#file_key_management_filekey">file_key_management_filekey</a></code> system variables to be configured.</p>
<p>The <code><a href="#file_key_management_filekey">file_key_management_filekey</a></code> system variable can be provided in two forms:</p>
<ul start="1"><li>It can be the actual plain-text encryption password. This is not recommended, since the plain-text encryption password would be visible in the output of the <code><a href="/kb/en/show-variables/">SHOW VARIABLES</a></code> statement.
</li><li>If it is prefixed with <code>FILE:</code>, then it can be a path to a file that contains the plain-text encryption password.
</li></ul>
<p>These system variables can be specified as command-line arguments to <code><a href="/kb/en/mysqld-options/">mysqld</a></code> or they can be specified in a relevant server <a href="/kb/en/configuring-mariadb-with-option-files/#option-groups">option group</a> in an <a href="/kb/en/configuring-mariadb-with-option-files/">option file</a>. For example:</p>
<pre class="fixed">[mariadb]
...
loose_file_key_management_filename = /etc/mysql/encryption/keyfile.enc
loose_file_key_management_filekey = FILE:/etc/mysql/encryption/keyfile.key
</pre><p>Note that the <code><a href="/kb/en/mysqld-options/#-loose-">loose</a></code> option prefix is specified. This option prefix is used in case the plugin hasn't been installed yet.</p>
<h2 class="anchored_heading" id="choosing-an-encryption-algorithm">Choosing an Encryption Algorithm</h2>
<p>The File Key Management plugin currently supports two encryption algorithms for encrypting data: <code>AES_CBC</code> and <code>AES_CTR</code>. Both of these algorithms use <a href="https://en.wikipedia.org/wiki/Advanced_Encryption_Standard">Advanced Encryption Standard (AES)</a> in different modes. AES uses 128-bit blocks, and supports 128-bit, 192-bit, and 256-bit keys. The modes are:</p>
<ul start="1"><li>The <code>AES_CBC</code> mode uses AES in the <a href="http://en.wikipedia.org/wiki/Block_cipher_mode_of_operation#Cipher_Block_Chaining_.28CBC.29">Cipher Block Chaining (CBC)</a> mode.
</li><li>The <code>AES_CTR</code> mode uses AES in two slightly different modes in different contexts. When encrypting tablespace pages (such as pages in InnoDB, XtraDB, and Aria tables), it uses AES in the 
<a href="http://en.wikipedia.org/wiki/Block_cipher_mode_of_operation#Counter_.28CTR.29">Counter (CTR)</a> mode. When encrypting temporary files (where the cipher text is allowed to be larger than the plain text), it uses AES in the authenticated <a href="http://en.wikipedia.org/wiki/Galois/Counter_Mode">Galois/Counter Mode (GCM)</a>.
</li></ul>
<p>The recommended algorithm is <code>AES_CTR</code>, but this algorithm is only available when MariaDB is built with recent versions of <a href="https://www.openssl.org/">OpenSSL</a>. If the server is built with <a href="https://www.wolfssl.com/products/wolfssl/">wolfSSL</a> or <a href="https://www.wolfssl.com/products/yassl/">yaSSL</a>, then this algorithm is not available. See <a href="/kb/en/tls-and-cryptography-libraries-used-by-mariadb/">TLS and Cryptography Libraries Used by MariaDB</a> for more information about which libraries are used on which platforms.</p>
<h3 class="anchored_heading" id="configuring-the-encryption-algorithm">Configuring the Encryption Algorithm</h3>
<p>The encryption algorithm can be configured by setting the <code><a href="#file_key_management_encryption_algorithm">file_key_management_encryption_algorithm</a></code> system variable.</p>
<p>This system variable can be set to one of the following values:</p>
<div class="cstm-style darkheader-nospace-borders"><table><tr><th>System Variable Value</th><th>Description</th></tr>
<tr><td><code>AES_CBC</code></td><td>Data is encrypted using AES in the <a href="http://en.wikipedia.org/wiki/Block_cipher_mode_of_operation#Cipher_Block_Chaining_.28CBC.29">Cipher Block Chaining (CBC)</a> mode. This is the default value.</td></tr>
<tr><td><code>AES_CTR</code></td><td>Data is encrypted using AES either in the <a href="http://en.wikipedia.org/wiki/Block_cipher_mode_of_operation#Counter_.28CTR.29">Counter (CTR)</a> mode or in the authenticated <a href="http://en.wikipedia.org/wiki/Galois/Counter_Mode">Galois/Counter Mode (GCM)</a> mode, depending on context. This is only supported in some builds. See the previous section for more information.</td></tr>
</table>
</div><p>This system variable can be specified as command-line arguments to <code><a href="/kb/en/mysqld-options/">mysqld</a></code> or it can be specified in a relevant server <a href="/kb/en/configuring-mariadb-with-option-files/#option-groups">option group</a> in an <a href="/kb/en/configuring-mariadb-with-option-files/">option file</a>. For example:</p>
<pre class="fixed">[mariadb]
...
loose_file_key_management_encryption_algorithm = AES_CTR
</pre><p>Note that the <code><a href="/kb/en/mysqld-options/#-loose-">loose</a></code> option prefix is specified. This option prefix is used in case the plugin hasn't been installed yet.</p>
<div class="cstm-style bluebox"><p>Note that this variable does not affect the algorithm that MariaDB uses to decrypt the key file. This variable only affects the encryption algorithm that MariaDB uses to encrypt and decrypt data. The only algorithm that MariaDB currently supports to encrypt the key file is <a href="https://en.wikipedia.org/wiki/Block_cipher_mode_of_operation#CBC">Cipher Block Chaining (CBC)</a> mode of <a href="https://en.wikipedia.org/wiki/Advanced_Encryption_Standard">Advanced Encryption Standard (AES)</a>.</p>
</div><h2 class="anchored_heading" id="using-the-file-key-management-plugin">Using the File Key Management Plugin</h2>
<p>Once the File Key Management Plugin is enabled, you can use it by creating an encrypted table:</p>
<pre class="fixed">CREATE TABLE t (i int) ENGINE=InnoDB ENCRYPTED=YES
</pre><p>Now, table <code>t</code> will be encrypted using the encryption key from the key file.</p>
<p>For more information on how to use encryption, see <a href="/kb/en/data-at-rest-encryption/">Data at Rest Encryption</a>.</p>
<h2 class="anchored_heading" id="using-multiple-encryption-keys">Using Multiple Encryption Keys</h2>
<p>The File Key Management Plugin supports <a href="/kb/en/encryption-key-management/#using-multiple-encryption-keys">using multiple encryption keys</a>. Each encryption key can be defined with a different 32-bit integer as a key identifier.</p>
<p>When <a href="/kb/en/innodb-encryption/">encrypting InnoDB tables</a>, the key that is used to encrypt tables <a href="/kb/en/innodb-xtradb-encryption-keys/">can be changed</a>.</p>
<p>When <a href="/kb/en/aria-encryption/">encrypting Aria tables</a>, the key that is used to encrypt tables <a href="/kb/en/aria-encryption-keys/">cannot currently be changed</a>.</p>
<h2 class="anchored_heading" id="key-rotation">Key Rotation</h2>
<p>The File Key Management plugin does not currently support <a href="/kb/en/encryption-key-management/#key-rotation">key rotation</a>. See <a href="https://jira.mariadb.org/browse/MDEV-20713">MDEV-20713</a> for more information.</p>
<h2 class="anchored_heading" id="versions">Versions</h2>
<div class="cstm-style darkheader-nospace-borders"><table><tr><th>Version</th><th>Status</th><th>Introduced</th></tr>
<tr><td>1.0</td><td>Stable</td><td><a href="/kb/en/mariadb-10118-release-notes/">MariaDB 10.1.18</a></td></tr>
<tr><td>1.0</td><td>Gamma</td><td><a href="/kb/en/mariadb-10113-release-notes/">MariaDB 10.1.13</a></td></tr>
<tr><td>1.0</td><td>Alpha</td><td><a href="/kb/en/mariadb-1013-release-notes/">MariaDB 10.1.3</a></td></tr>
</table>
</div><h2 class="anchored_heading" id="system-variables">System Variables</h2>
<h3 class="anchored_heading" id="file_key_management_encryption_algorithm"><code>file_key_management_encryption_algorithm</code></h3>
<ul start="1"><li><strong>Description:</strong> This system variable is used to determine which algorithm the plugin will use to encrypt data.
<ul start="1"><li>The recommended algorithm is <code>AES_CTR</code>, but this algorithm is only available when MariaDB is built with recent versions of <a href="https://www.openssl.org/">OpenSSL</a>. If the server is built with <a href="https://www.wolfssl.com/products/wolfssl/">wolfSSL</a> or <a href="https://www.wolfssl.com/products/yassl/">yaSSL</a>, then this algorithm is not available. See <a href="/kb/en/tls-and-cryptography-libraries-used-by-mariadb/">TLS and Cryptography Libraries Used by MariaDB</a> for more information about which libraries are used on which platforms.
</li></ul>
</li><li><strong>Commandline:</strong> <code class="fixed" style="white-space:pre-wrap">--file-key-management-encryption-algorithm=value</code>
</li><li><strong>Scope:</strong> Global
</li><li><strong>Dynamic:</strong> No
</li><li><strong>Data Type:</strong> <code>enumerated</code>
</li><li><strong>Default Value:</strong> <code>AES_CBC</code>
</li><li><strong>Valid Values:</strong> <code>AES_CBC</code>, <code>AES_CTR</code>
</li></ul>
<hr>
<h3 class="anchored_heading" id="file_key_management_filekey"><code>file_key_management_filekey</code></h3>
<ul start="1"><li><strong>Description:</strong> This system variable is used to determine the encryption password that is used to decrypt the key file defined by <code><a href="#file_key_management_filename">file_key_management_filename</a></code>.
<ul start="1"><li>If this system variable's value is prefixed with <code>FILE:</code>, then it is interpreted as a path to a file that contains the plain-text encryption password.
</li><li>If this system variable's value is <strong>not</strong> prefixed with <code>FILE:</code>, then it is interpreted as the plain-text encryption password. However, this is not recommended.
</li><li>The encryption password has a max length of 256 characters.
</li><li>The only algorithm that MariaDB currently supports when decrypting the key file is <a href="https://en.wikipedia.org/wiki/Block_cipher_mode_of_operation#CBC">Cipher Block Chaining (CBC)</a> mode of <a href="https://en.wikipedia.org/wiki/Advanced_Encryption_Standard">Advanced Encryption Standard (AES)</a>. The encryption key size can be 128-bits, 192-bits, or 256-bits. The encryption key is calculated by taking a <a href="https://en.wikipedia.org/wiki/SHA-1">SHA-1</a> hash of the encryption password. 
</li></ul>
</li><li><strong>Commandline:</strong> <code class="fixed" style="white-space:pre-wrap">--file-key-management-filekey=value</code>
</li><li><strong>Scope:</strong> Global
</li><li><strong>Dynamic:</strong> No
</li><li><strong>Data Type:</strong> <code>string</code>
</li><li><strong>Default Value:</strong> (empty)
</li></ul>
<hr>
<h3 class="anchored_heading" id="file_key_management_filename"><code>file_key_management_filename</code></h3>
<ul start="1"><li><strong>Description:</strong> This system variable is used to determine the path to the file that contains the encryption keys. If <code><a href="#file_key_management_filekey">file_key_management_filekey</a></code> is set, then this file can be encrypted with <a href="https://en.wikipedia.org/wiki/Block_cipher_mode_of_operation#CBC">Cipher Block Chaining (CBC)</a> mode of <a href="https://en.wikipedia.org/wiki/Advanced_Encryption_Standard">Advanced Encryption Standard (AES)</a>.
</li><li><strong>Commandline:</strong> <code class="fixed" style="white-space:pre-wrap">--file-key-management-filename=value</code>
</li><li><strong>Scope:</strong> Global
</li><li><strong>Dynamic:</strong> No
</li><li><strong>Data Type:</strong> <code>string</code>
</li><li><strong>Default Value:</strong> (empty)
</li></ul>
<hr>
<h2 class="anchored_heading" id="options">Options</h2>
<h3 class="anchored_heading" id="file_key_management"><code>file_key_management</code></h3>
<ul start="1"><li><strong>Description:</strong> Controls how the server should treat the plugin when the server starts up.
<ul start="1"><li>Valid values are:
<ul start="1"><li><code>OFF</code> - Disables the plugin without removing it from the <code><a href="/kb/en/mysqlplugin-table/">mysql.plugins</a></code> table.
</li><li><code>ON</code> - Enables the plugin. If the plugin cannot be initialized, then the server will still continue starting up, but the plugin will be disabled.
</li><li><code>FORCE</code> - Enables the plugin. If the plugin cannot be initialized, then the server will fail to start with an error.
</li><li><code>FORCE_PLUS_PERMANENT</code> - Enables the plugin. If the plugin cannot be initialized, then the server will fail to start with an error. In addition, the plugin cannot be uninstalled with <code><a href="/kb/en/uninstall-soname/">UNINSTALL SONAME</a></code> or <code><a href="/kb/en/uninstall-plugin/">UNINSTALL PLUGIN</a></code> while the server is running.
</li></ul>
</li><li>See <a href="/kb/en/plugin-overview/#configuring-plugin-activation-at-server-startup">Plugin Overview: Configuring Plugin Activation at Server Startup</a> for more information.
</li></ul>
</li><li><strong>Commandline:</strong> <code class="fixed" style="white-space:pre-wrap">--file-key-management=value</code>
</li><li><strong>Data Type:</strong> <code>enumerated</code>
</li><li><strong>Default Value:</strong> <code>ON</code>
</li><li><strong>Valid Values:</strong> <code>OFF</code>, <code>ON</code>, <code>FORCE</code>, <code>FORCE_PLUS_PERMANENT</code>
</li></ul>
<hr>

    </div>


        
            <div id="subscribe" class="well well-small hide hidden-print"
                 data-subscribe-url="/kb/en/file-key-management-encryption-plugin/+subscriptions/add"
                 data-unsubscribe-url="/kb/en/file-key-management-encryption-plugin/+subscriptions/remove">
            </div>
        

        
        
    
        <div class="simple_section_nav">
            <ul class="nav nav-pills">
                
                    <li><a href="/kb/en/encryption-key-management/">
                        ← Encryption Key Management
                    </a>
                    </li>
                
                
                    <li><a href="/kb/en/key-management-and-encryption-plugins/">
                        ↑ Key Management and Encryption Plugins ↑
                    </a>
                    </li>
                
                
                    <li class="pull-right"><a href="/kb/en/hashicorp-key-management-plugin/">
                        Hashicorp Key Management Plugin →
                    </a>
                    </li>
                
            </ul>
        </div>
    

        

        
        <h2>Comments</h2>
        
    
    <div id="comments" data-node-id="8321" data-comments-url="/kb/en/file-key-management-encryption-plugin/+comments"
         data-reply-url="/kb/en/file-key-management-encryption-plugin/comments/post/">
        Comments loading...
    </div>

        

    </div>


                    <div id="content_disclaimer" class="graybox">
                        Content reproduced on this site is the property of its respective owners,
                        and this content is not reviewed in advance by MariaDB. The views, information and opinions
                        expressed by this content do not necessarily represent those of MariaDB or any other party.
                    </div>
                </div>
            </section>

            
                <div id="right_bar" class="col-md-2">
                    
    
        
        <ul class="section_navigation well well-small hidden-xs hidden-sm">
            
                <li class="parent"><a href="/kb/en/key-management-and-encryption-plugins/">
                    ↑ Key Management and Encryption Plugins ↑
                </a>
                </li>
            
            
                
                    <li>
                        <a href="/kb/en/encryption-key-management/">
                            
                            Encryption Key Management
                        </a>
                    </li>
                
            
                
                    <li class="active">
                        <span>File Key Management Encryption Plugin</span>
                        
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/hashicorp-key-management-plugin/">
                            
                            Hashicorp Key Management Plugin
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/aws-key-management-encryption-plugin/">
                            
                            AWS Key Management Encryption Plugin
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/aws-key-management-encryption-plugin-setup-guide/">
                            
                            Amazon Web Services (AWS) Key Management Service (KMS) Encryption Plugin Setup Guide
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/aws-key-management-encryption-plugin-advanced-usage/">
                            
                            Amazon Web Services (AWS) Key Management Service (KMS) Encryption Plugin Advanced Usage
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/eperi-key-management-encryption-plugin/">
                            
                            Eperi Key Management Encryption Plugin
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/encryption-plugin-api/">
                            <span class="pull-right not_primary"></span>
                            Encryption Plugin API
                        </a>
                    </li>
                
            
        </ul>
    
    

                </div>
            
        </div>
    </div>
</div>

<!-- Footer -->
<footer id="footer">
    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-xs-12">
                    <ul class="list-inline text-center footer-nav">
                        <li>
                            <h5>
                                <a href="https://mariadb.com/products" title="Products">Products</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/services" title="Services">Services</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/pricing" title="Pricing">Pricing</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/resources" title="Resources">Resources</a>
                            </h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/about-us" title="About MariaDB">About Us</a></h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/download" title="Download">Download MariaDB</a></h5>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="row row-10">
                
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div id="block-footerformcontact" class="block block-block-content block-block-contentd754ee1b-3cc9-40e7-9ef4-f504f1197fb1">
                        
                            <h5 style="font-weight: 400;">Subscribe to our newsletter!</h5>
                            <script src="//app-sj15.marketo.com/js/forms2/js/forms2.min.js"></script><form id="mktoForm_1498"></form>
                            <script>
                                <!--//--><![CDATA[// ><!--
                                MktoForms2.loadForm("//app-sj15.marketo.com", "573-PXI-984", 1498);
                                //--><!]]]]><![CDATA[>
                                //--><!]]>
                            </script>
                        
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div class="footer-copyright">
                        <div class="text-center">
                            <ul class="list-inline no-margin">
                                <li>
                                    <a href="/legal" title="Legal">Legal</a>
                                </li>
                                <li>
                                    <a href="/privacy-policy" title="Privacy Policy">Privacy Policy</a>
                                </li>
                                <li>
                                    <a href="/cookie-policy/" title="Cookies">Cookie Policy</a>
                                </li>
                            </ul>
                            <p>Copyright &copy; 2024 MariaDB. All rights reserved.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</footer>
</div>

<div id="ajax_loading">
    <img src="/kb/static/images/ajax-loader.a51c5608d01a.gif" />
</div>

    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MK2847"
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MK2847');</script>
    <!-- End Google Tag Manager -->

</body>

<script type="text/javascript" src="/kb/static/js/main.1587e3a666fc.js" charset="utf-8"></script>

</html>