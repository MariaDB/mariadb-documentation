<!DOCTYPE html>
<html>
<head data-cookie-domain=""
      data-cookie-path="/">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="apple-touch-icon" sizes="180x180" href="/kb/static/images/favicons/apple-touch-icon.159e713979be.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/kb/static/images/favicons/favicon-32x32.bc0ac1d5d11e.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/kb/static/images/favicons/favicon-16x16.5801f8f0f34e.png">
    <link rel="shortcut icon" href="/kb/static/images/favicons/favicon.d122d305dee4.ico" type="image/x-icon" />

    <title>Block-Based Join Algorithms - MariaDB Knowledge Base</title>

    <link href="/kb/static/css/main.f7633538c846.css" rel="stylesheet" type="text/css" />

    

    

    <!-- FB Open Graph tags -->
    <meta property="og:title" content="Block-Based Join Algorithms" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://mariadb.com/kb/en/block-based-join-algorithms/" />
    <meta property="og:image" content="http://mariadb.comaskmonty-logo.png" />
    <meta property="og:site_name" content="MariaDB KnowledgeBase" />
    <meta property="fb:admins" content="514852603" />
    <meta property="og:description" content="Algorithms that employ a join buffer for the first join before starting to look in the second." />

    <meta name="description" content="Algorithms that employ a join buffer for the first join before starting to look in the second." />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet"/>
    
</head>
<body class="mpkb nodes products nodes_view jqui" id="nodes_view">





<div id="menu-mobile" class="visible-sm visible-xs">

    <div>
        <div id="mobile-close-menu" class="text-right">
            <a href="javascript:void(0)" title="Close Menu" id="back-main" class="toggle-menu">X<span></span></a>
        </div>
    </div>
    <div class="mainmenu-mobile">
        <ul class="ls-none ul-menu">
            <li data-sub="submenu5"><a class="open-form-search" href="/kb/search/" title="Search">Search </a></li>
            <li data-sub="submenu0"><a href="/products" title="Products">Products</a><span class="arrow-main"></span></li>
            <li data-sub="submenu1"><a href="/services" title="Services">Services</a><span class="arrow-main"></span></li>
            <li data-sub="submenu2"><a href="/resources" title="Resources">Resources</a><span class="arrow-main"></span></li>
            <li data-sub="submenu3"><a href="/about-us" title="About">About</a><span class="arrow-main"></span></li>
            <li data-sub="submenu4"><a href="/contact" title="Contact">Contact</a></li>
        </ul>
    </div>

    <div class="nav-top-mobile">
        <div class="select-box form">

            <ul class="inline-block-md mb-none top-nav">
                <li>

                </li>
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/block-based-join-algorithms/"> Login</a>
                    </li>
                
            </ul>



        </div>
        <p class="text-center copyright">Copyright &copy; 2025 MariaDB. All rights reserved.</p>
    </div>
</div>
<div class="violator-wrap d-none" id="top_violator">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12">
                <div class="violator-outer">
                    <div class="violator-inner">
                        <div class="row">
                            <div class="col-xs-12 col-sm-9 col-lg-7 col-lg-offset-2" id="top_violator_content">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="content-link" target="_blank" rel="nofollow noreferrer">
                                    <span>The Ultimate Guide to High Availability with MariaDB</span>
                                </a>
                            </div>
                            <div class="col-xs-12 col-sm-3" id="top_violator_cta">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="btn btn-mariadb" target="_blank" rel="nofollow noreferrer">Download Now</a>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-link close-btn">
                        <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24" width="15px" height="15px"><path d="M 4.9902344 3.9902344 A 1.0001 1.0001 0 0 0 4.2929688 5.7070312 L 10.585938 12 L 4.2929688 18.292969 A 1.0001 1.0001 0 1 0 5.7070312 19.707031 L 12 13.414062 L 18.292969 19.707031 A 1.0001 1.0001 0 1 0 19.707031 18.292969 L 13.414062 12 L 19.707031 5.7070312 A 1.0001 1.0001 0 0 0 18.980469 3.9902344 A 1.0001 1.0001 0 0 0 18.292969 4.2929688 L 12 10.585938 L 5.7070312 4.2929688 A 1.0001 1.0001 0 0 0 4.9902344 3.9902344 z"/></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="wrapper">
<div id="top-nav">
    <div class="container">
        <ul class="hidden-sm hidden-xs" >
            <li><a href="https://mariadb.com/kb/">Knowledge Base</a></li>
            <li><a href="https://mariadb.com/contact/">Contact</a></li>
            
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/block-based-join-algorithms/" rel="nofollow">Login</a>
                    </li>
                
            
            
            <li id="search-form">
                <form action="/kb/en/+search/" method="get" id="search-block-form" accept-charset="UTF-8">
                    <input id="search" title="Enter the terms you wish to search for."
                           placeholder="Search . . ." type="text"
                           name="q" value="" size="15" maxlength="128" class="form-text"
                           data-autocomplete-url="/kb/en/+search/autocomplete/">
                    <input type="hidden" name="quick" value="1" />
                    <input type="hidden" name="source" value="kb" />
                </form>
            </li>
            <li><a id="search-toggler" href="/kb/search/">Search</a></li>
            
        </ul>
    </div>
</div>
<div id="navbar-bottom" class="navbar">
    <div class="container">
        
        
        
        
        <div class="row">
            <div class="col-md-3 col-sm-9 col-xs-9">
                <a class="brand" href="/" title="MariaDB">
                    <img src="/kb/static/images/logo-2018-black.95f5978ae14d.png">
                </a>
            </div>
            <div class="col-md-9 hidden-sm hidden-xs">
                <div class="main-menu">
                    <ul id="main-menu" class="nav navbar-nav inline-block-sm">
    <li class="has-sub full-menu">
        <a href="/products" title="Products">Products</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/services" title="Services">Services</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/pricing" title="Pricing">Pricing</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/resources" title="Resources">Resources</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/about-us" title="About Us">About Us</a>
    </li>
    <li class="">
        <a class="button electric-eel small top-bar-right-download" href="/downloads/">Download</a>
    </li>
</ul>
                </div>
            </div>
            <div class="col-md-3 visible-sm visible-xs col-sm-3 col-xs-3 ps-rv">
                <div class="navbar-header text-right pull-right">
                    <button type="button" class="menu-control toggle-menu" id="open-menu">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="main">
    <div class="container">
        

        <div id="subheader1" class="clearfix">
            <div class="pull-left">
                
                <div id="breadcrumbs" class="breadcrumb">
                    <a href="/kb/en/">Knowledge Base</a>
                    


    
    » <a class="crumb" href="/kb/en/training-tutorials/">Training &amp; Tutorials</a>
    

    
    » <a class="crumb" href="/kb/en/advanced-mariadb-articles/">Advanced MariaDB Articles</a>
    

    
    » <a class="crumb" href="/kb/en/development-articles/">Development Articles</a>
    

    
    » <a class="crumb" href="/kb/en/mariadb-internals-documentation/">MariaDB Internals Documentation</a>
    

    
    » <a class="crumb" href="/kb/en/mariadb-internals-documentation-query-optimizer/">Query Optimizer</a>
    


    » <a class="node_link crumb" href="/kb/en/block-based-join-algorithms/">Block-Based Join Algorithms</a>


                </div>
                
            </div>
        </div>
    </div>
    <div class="container" id="container-main">
        <div class="row">
            
            
                
                <aside id="sidebar-first" class="sidebar col-md-2 hidden-xs hidden-sm hidden-print">
                    
                        
                        <ul id="category_menu" class="nav nav-pills nav-stacked">
                            <li><a href="/kb/en/">Home</a></li>
                            
                                
                                    <li><a href="/kb/en/+questions/">Open Questions</a></li>
                                
                                <li><a href="/kb/en/documentation/">MariaDB Server</a></li>
                                <li><a href="/kb/en/maxscale/">MariaDB MaxScale</a></li>
                                <li><a href="/kb/en/mariadb-columnstore/">MariaDB ColumnStore</a></li>
                                <li><a href="/kb/en/connectors/">Connectors</a></li>
                            

                        </ul>
                    

                    
<div>



<div class="well well-small box actions"><div>

        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/block-based-join-algorithms/+history" rel="nofollow">History</a>
        
        
        
        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/block-based-join-algorithms/+source/">Source</a>
        
        <a class="btn btn-block btn-blue btn-sm flag" href="/kb/en/block-based-join-algorithms/+flag"
                data-flag-url="/kb/en/block-based-join-algorithms/+flag" rel="nofollow">
                Flag as Spam / Inappropriate</a>
        
        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/block-based-join-algorithms/+translate/">
                Translate</a>
        

</div>
</div>





<div class="well well-small box node_info"><div>

    <dl>
        <dt>Created</dt>
        <dd>

<span class="datetime" title="2011-08-01 18:59">13 years, 6 months ago</span></dd>

        <dt>Modified</dt>
        <dd>

<span class="datetime" title="2022-12-13 09:32">2 years, 1 month ago</span></dd>

        <dt>Type</dt>
        <dd>article</dd>

        <dt>Status</dt>
        <dd>active</dd>

        <dt>License</dt>
        <dd>
            
                <a href="/kb/en/block-based-join-algorithms/+license/">CC BY-SA / Gnu FDL</a>
            
        </dd>

        
    </dl>

    
    <ul class="rss_feeds">
        <li><a href="/kb/en/block-based-join-algorithms/+history/feed/">
            History</a>
        </li>
        <li><a href="/kb/en/block-based-join-algorithms/+comments/feed/">
            Comments</a>
        </li>
    </ul>
    

</div>
</div>





    
    
    

<div class="well well-small box attachments"><div><div class="edit_link pull-right"><a href="/kb/en/block-based-join-algorithms/+edit/attachments/">Edit</a></div><h5>Attachments</h5></div><div>

        
            <div class="no_data">No attachments exist</div>
        
    
</div>
</div>

    



    
    
        

<div class="well well-small box"><div><h5>Localized Versions</h5></div><div>

        <ul>
            
            <li><a href="/kb/it/block-based-join-algorithms/">Algoritmi per le Join basati sui blocchi</a> [it]</li>
            
        </ul>
        
</div>
</div>

    






</div>


                    

































                </aside>
            
            
            
                
            
            
                
            
            <section id="content" class="limited_width col-md-8 clearfix">
                
                    <h1>Block-Based Join Algorithms</h1>
                

                



                <div>
                    
    

    
    
    

    <div class="node creole">
        
        
        


    
    <div class="answer formatted">
        <div class="table_of_contents well well-small">
<h3>Contents</h3>
 <ol class="toc">

    <li class=""><a href="#block-nested-loop-join" title="Block Nested Loop Join">Block Nested Loop Join</a>    <ol class="toc">

        <li class=""><a href="#how-block-nested-loop-join-works" title="How Block Nested Loop Join Works">How Block Nested Loop Join Works</a></li>

        <li class=""><a href="#more-efficient-usage-of-join-buffer-space" title="More Efficient Usage of Join Buffer Space">More Efficient Usage of Join Buffer Space</a></li>

        <li class=""><a href="#incremental-join-buffers" title="Incremental Join Buffers">Incremental Join Buffers</a></li>

        <li class=""><a href="#using-join-buffers-for-simple-outer-joins-and-semi-joins" title="Using Join Buffers for Simple Outer Joins and Semi-joins">Using Join Buffers for Simple Outer Joins and Semi-joins</a>    </ol>
</li>

    <li class=""><a href="#block-hash-join" title="Block Hash Join">Block Hash Join</a>    <ol class="toc">

        <li class=""><a href="#how-block-hash-join-works" title="How Block Hash Join Works">How Block Hash Join Works</a>    </ol>
</li>

    <li class=""><a href="#batch-key-access-join" title="Batch Key Access Join">Batch Key Access Join</a>    <ol class="toc">

        <li class=""><a href="#how-batch-keys-access-join-works" title="How Batch Keys Access Join Works">How Batch Keys Access Join Works</a></li>

        <li class=""><a href="#interaction-of-bka-join-with-the-mrr-functions" title="Interaction of BKA Join With the MRR Functions">Interaction of BKA Join With the MRR Functions</a>    </ol>
</li>

    <li class=""><a href="#managing-usage-of-block-based-join-algorithms" title="Managing Usage of Block-Based Join Algorithms">Managing Usage of Block-Based Join Algorithms</a>    <ol class="toc">

        <li class=""><a href="#size-of-join-buffers" title="Size of Join Buffers">Size of Join Buffers</a></li>

        <li class=""><a href="#related-mrr-settings" title="Related MRR Settings">Related MRR Settings</a>    </ol>
 </ol>
</li>
</div>
<p>In the versions of MariaDB/MySQL before 5.3 only one block-based join algorithm was implemented: the Block Nested Loops (BNL) join algorithm which could only be used for inner joins.</p>
<p><a href="/kb/en/what-is-mariadb-53/">MariaDB 5.3</a> enhanced the implementation of BNL joins and provides a variety of block-based join algorithms that can be used for inner joins, outer joins, and semi-joins. Block-based join algorithms in MariaDB employ a join buffer to accumulate records of the first join operand before they start looking for matches in the second join operand.</p>
<p>This page documents the various block-based join algorithms.</p>
<ul start="1"><li>Block Nested Loop (BNL) join
</li><li>Block Nested Loop Hash (BNLH) join
</li><li>Block Index join known as Batch Key Access (BKA) join
</li><li>Block Index Hash join known as Batch Key Access Hash (BKAH) join
</li></ul>
<h2 class="anchored_heading" id="block-nested-loop-join">Block Nested Loop Join</h2>
<p>The major difference between the implementation of BNL join in <a href="/kb/en/what-is-mariadb-53/">MariaDB 5.3</a>
compared to earlier versions of MariaDB/MySQL is that the former uses a new
format for records written into join buffers. This new format allows:</p>
<ul start="1"><li>More efficient use of buffer space for null field values and field values of
  flexible length types (like the varchar type)
</li><li>Support for so-called <em>incremental</em> join buffers saving buffer space for
  multi-way joins
</li><li>Use of the algorithm for outer joins and semi-joins
</li></ul>
<h3 class="anchored_heading" id="how-block-nested-loop-join-works">How Block Nested Loop Join Works</h3>
<p>The algorithm performs a join operation of tables t1 and t2 according to the following schema.
<br>The records of the first operand are written into the join buffer one by one until the buffer is full.
<br>The records of the second operand are read from the base/temporary table one by one. For every read record r2 of table t2 the join buffer is scanned, and, for any record r1 from the buffer such that r2 matches r1 the concatenation of the interesting fields of r1 and r2 is sent to the result stream of the corresponding partial join.
<br>To read the records of t2 a full table scan, a full index scan or a range index scan is performed. Only the records that meet the condition pushed to table t2 are checked for a match of the records from the join buffer. 
<br>When the scan of the table t2 is finished a new portion of the records of the first operand fills the buffer and matches for these records are looked for in t2.
<br>The buffer refills and scans of the second operand that look for matches in the join buffer are performed again and again until the records of first operand are exhausted.
<br>In total the algorithm scans the second operand as many times as many refills of the join buffer occur. </p>
<h3 class="anchored_heading" id="more-efficient-usage-of-join-buffer-space">More Efficient Usage of Join Buffer Space</h3>
<p>No join buffer space is used for null field values. 
<br>Any field value of  a flexible length type  is not padded by 0 up to the maximal field size anymore.</p>
<h3 class="anchored_heading" id="incremental-join-buffers">Incremental Join Buffers</h3>
<p>If we have a  query with a join of three tables t1, t2, t3 such that table t1 is joined with table t2 and  the result of this join operation is joined with table t3 then two join buffers can be used to execute the query. The first join buffer B1 is used to store the records comprising interesting fields of table t1, while the second join buffer B2 contains the records with fields from the partial join of t1 and t2. The interesting fields of any record r1 from B1 are copied into B2 for any record record r1,r2 from the partial join of t1 and t2.
One could suggest storing in B2 just  a pointer to the position of the r1 fields  in B1 together with the interesting fields from t2. So for any record r2 matching the record r1 the buffer B2 would contain a reference to the fields of r1 in B1 and the fields of r2. In this case the buffer B2 is called incremental.
Incremental buffers allow to avoid copying field values from one buffer into another. They also allow to save a significant amount of buffer space if for a record from t1 several matches from t2 are expected.   </p>
<h3 class="anchored_heading" id="using-join-buffers-for-simple-outer-joins-and-semi-joins">Using Join Buffers for Simple Outer Joins and Semi-joins</h3>
<p>If  a join buffer is used for a simple left outer join of tables t1 and t1
   t1 LEFT JOIN t2 ON P(t1,t2)
then each record r1 stored in the buffer is provided with a match flag. Initially this flag is set off. As soon as the first match for r1 is found this flag is set on. When all matching candidates from t2 have been check, the record the join buffer are scanned and for those of them that still have there match flags off null-complemented rows are generated. 
The same match flag is used for any record in the join buffer is a semi-join operation
   t1 SEMI JOIN t2 ON P(t1,t2) 
 is performed with a block based join algorithm. When this match flag is set to on for a record r1 in the buffer no matches from table t2 for record r1 are looked for anymore.</p>
<h2 class="anchored_heading" id="block-hash-join">Block Hash Join</h2>
<p>Block based hash join algorithm is a new option to be used for join operations in <a href="/kb/en/what-is-mariadb-53/">MariaDB 5.3</a>. It can be employed in the cases when there are equi-join sub-condition for the joined tables, in the other words when equalities of the form t2.f1= e1(t1),...,t2.fn=en(t1) can be extracted from the full join condition. As any block based join algorithm this one used a join buffer filled with the records of
the first operand and looks through the records of the second operand to find matches for the records in the buffer.</p>
<h3 class="anchored_heading" id="how-block-hash-join-works">How Block Hash Join Works</h3>
<p>For each refill of the join buffer and each record r1 from it the algorithm builds a hash table with the keys constructed over the values e1(r1),...en(r1). Then the records of t2 are looked through. For each record r2 from t2 that the condition pushed to the table t2 a hash key over the fields r2.f1,..., r2.fn is calculated to probe into the hash table. The probing returns those records from the buffer to which r2 matches.
As for BNL join algorithm this algorithm  scans the second operand as many time as many refills of the buffer occur. Yet it has to look only through the records of one bucket in the hash table when looking for the records to which  a record  from t2 matches, not through all records in the join buffer as BNL join algorithm does.
The implementation of this algorithm in MariaDB builds the hash table with hash keys at the very end of the join buffer. That's why the number of records written into the buffer at one refill is less then for BNL join algorithms. However a much shorter list of possible matching candidates makes this the block hash join algorithm usually much faster then BNL join.</p>
<h2 class="anchored_heading" id="batch-key-access-join">Batch Key Access Join</h2>
<p>Batch Keys Access join algorithm performs index look-ups when looking for possible matching candidates provided by the second join operand. With this respect the algorithm behave itself as the regular join algorithm. Yet BKA performs index look-ups for a batch of the records from the join buffer. For conventional  database engines like InnoDB/MyISAM  it allows to fetch matching candidates in an optimal way. For the engines with remote data store such as FederateX/Spider the algorithm allows to save on transfers between the MySQL node and the data store nodes.</p>
<h3 class="anchored_heading" id="how-batch-keys-access-join-works">How Batch Keys Access Join Works</h3>
<p>The implementation of the algorithm in 5.3 heavily exploits the multi-range-read interface and its properties. The interface hides the actual mechanism of fetching possible candidates for matching records from the table to be joined.
As any block based join algorithm the BKA join repeatedly fills the join buffer with records of the first operand and for each refill it finds records from the join table that could match the records in the buffer.
To find such records it asks the MRR interface to perform index look-ups with the keys constructed over all records from the buffer. Together with each key the interface receives  a return address - a reference to the record over which  this key has been constructed. The actual implementation functions of the MRR interface organize and optimize somehow the process of fetching the records of the joined table by the received keys. Each fetched record r2 is appended with the return address associated with the key by which the record has been found and the result is passed to the BKA join procedure. The procedure takes the record  r1  from the join buffer by the return address, joins it with r2 and checks the join condition. If the condition is evaluated to true the joined records is sent to the result stream of the join operation. So for each record returned by the MRR interface only one record from the join buffer is accessed.
The number of records from table t2 fetched by the BKA join  is exactly the same as for the regular nested loops join algorithm. Yet BKA join allows  to optimize the order in which the records are fetched.</p>
<h3 class="anchored_heading" id="interaction-of-bka-join-with-the-mrr-functions">Interaction of BKA Join With the MRR Functions</h3>
<p>BKA join interacts with the MRR functions respecting the following contract.
The join procedure calls the MRR function multi_range_read_init passing it the callback functions that
allows to initialize reading keys for the records in the join buffer and to iterate over these keys. It also passes the parameters of the buffer for MRR needs allocated within the join buffer space.
Then BKA join repeatedly calls the MRR function multi_range_read_next. The function works as an iterator function over the records fetched by index look-ups with the keys produced by a callback function set in the call of  multi_range_read_init. A call of the function multi_range_read_next returns the next fetched record through the dedicated record buffer, and the associated reference to the matched record from the join buffer as the output parameter of the function. </p>
<h2 class="anchored_heading" id="managing-usage-of-block-based-join-algorithms">Managing Usage of Block-Based Join Algorithms</h2>
<p>Currently 4 different types of block-based join algorithms are supported. For a particular join operation each of them can be employed with a regular (flat) join buffer or  with an incremental join buffer.</p>
<p>Three optimizer switches -  <code>join_cache_incremental</code>, <code>join_cache_hashed</code>, <code>join_cache_bka</code> – and the system variable <a href="/kb/en/server-system-variables/#join_cache_level">join_cache_level</a> control which of the 8 variants of the block-based algorithms will be used for join operations.</p>
<p>If <code>join_cache_bka</code> is off then BKA and BKAH join algorithms are not allowed.
If <code>join_cache_hashed</code> is off then BNLH and BKAH join algorithms are not allowed.
If <code>join_cache_incremental</code> is off then no incremental variants of the block-based join algorithms are allowed.</p>
<p>By default the switches <code>join_cache_incremental</code>, <code>join_cache_hashed</code>, <code>join_cache_bka</code> are set to 'on'.
However it does not mean that by default any of block-based join algorithms is allowed to be used. All of them are allowed only if the system variable <a href="/kb/en/server-system-variables/#join_cache_level">join_cache_level</a> is set to 8. This variable can take an integer value in the interval from 0 to 8.</p>
<p>If the value is set to 0 no block-based algorithm can be used for a join operation.
The values from 1 to 8 correspond to the following variants of block-based join algorithms :</p>
<ul start="1"><li>1 – Flat BNL
</li><li>2 – Incremental BNL
</li><li>3 – Flat BNLH
</li><li>4 – Incremental BNLH
</li><li>5 – Flat BKA
</li><li>6 – Incremental BKA
</li><li>7 – Flat BKAH
</li><li>8 – Incremental BKAH
</li></ul>
<p>If the value of <a href="/kb/en/server-system-variables/#join_cache_level">join_cache_level</a> is set to N, any of block-based algorithms with the level greater than N is disallowed.</p>
<p>So if <a href="/kb/en/server-system-variables/#join_cache_level">join_cache_level</a> is set to 5, no usage of BKAH is allowed and usage of incremental BKA is not allowed either while usage of all remaining variants are controlled by the settings of the optimizer switches <code>join_cache_incremental</code>, <code>join_cache_hashed</code>, <code>join_cache_bka</code>.</p>
<p>By default <a href="/kb/en/server-system-variables/#join_cache_level">join_cache_level</a> is set to 2. In other words only usage of flat or incremental BNL is allowed.</p>
<p>By default block-based algorithms can be used only for regular (inner) join operations. To allow them for outer join operations (left outer joins and right outer joins) the optimizer switch  <code>outer_join_with_cache</code> has to be set to 'on'.
Setting the optimizer switch <code>semijoin_with_cache</code> to 'on' allows using these algorithms for semi-join operations.</p>
<p>Currently, only incremental variants of the block-based join algorithms can be used for nested outer joins and nested semi-joins.</p>
<h3 class="anchored_heading" id="size-of-join-buffers">Size of Join Buffers</h3>
<p>The maximum size of join buffers used by block-based algorithms is controlled by setting the <a href="/kb/en/server-system-variables/#join_buffer_size">join_buffer_size</a> system variable.
This value must be large enough in order for the join buffer employed for a join operation to contain all relevant fields for at least one joined record.</p>
<p><a href="/kb/en/what-is-mariadb-53/">MariaDB 5.3</a> introduced the system variable <a href="/kb/en/server-system-variables/#join_buffer_space_limit">join_buffer_space_limit</a> that limits the total memory used for join buffers in a query.</p>
<p>To optimize the usage of the join buffers within the limit set by <code>join_buffer_space_limit</code>, one should use the <a href="/kb/en/server-system-variables/#optimizer_switch">optimizer switch</a> <code>optimize_join_buffer_size=on</code>.
When this flag is set to 'off' (default until <a href="/kb/en/mariadb-1042-release-notes/">MariaDB 10.4.2</a>), the size of the used join buffer is taken directly from the <a href="/kb/en/server-system-variables/#join_buffer_size">join_buffer_size</a> system variable.
When this flag is set to 'on' (default from <a href="/kb/en/mariadb-1043-release-notes/">MariaDB 10.4.3</a>) then the size of the buffer depends on the estimated number of rows in the partial join whose records are to be stored in the buffer. </p>
<h3 class="anchored_heading" id="related-mrr-settings">Related MRR Settings</h3>
<p>To use BKA/BKAH join algorithms for InnoDB/MyISAM, one must set the optimizer switch <code>mrr</code> to 'on'. When using these algorithms for InnoDB/MyISAM the overall performance of the join operations can be dramatically improved if the optimizer switch <code>mrr_sort_keys</code> is set 'on'.</p>

    </div>


        
            <div id="subscribe" class="well well-small hide hidden-print"
                 data-subscribe-url="/kb/en/block-based-join-algorithms/+subscriptions/add"
                 data-unsubscribe-url="/kb/en/block-based-join-algorithms/+subscriptions/remove">
            </div>
        

        
        
    
        <div class="simple_section_nav">
            <ul class="nav nav-pills">
                
                    <li><a href="/kb/en/table-elimination/">
                        ← Table Elimination
                    </a>
                    </li>
                
                
                    <li><a href="/kb/en/mariadb-internals-documentation-query-optimizer/">
                        ↑ Query Optimizer ↑
                    </a>
                    </li>
                
                
                    <li class="pull-right"><a href="/kb/en/condition-selectivity-computation-internals/">
                        Condition Selectivity Computation Internals →
                    </a>
                    </li>
                
            </ul>
        </div>
    

        

        
        <h2>Comments</h2>
        
    
    <div id="comments" data-node-id="1733" data-comments-url="/kb/en/block-based-join-algorithms/+comments"
         data-reply-url="/kb/en/block-based-join-algorithms/comments/post/">
        Comments loading...
    </div>

        

    </div>


                    <div id="content_disclaimer" class="graybox">
                        Content reproduced on this site is the property of its respective owners,
                        and this content is not reviewed in advance by MariaDB. The views, information and opinions
                        expressed by this content do not necessarily represent those of MariaDB or any other party.
                    </div>
                </div>
            </section>

            
                <div id="right_bar" class="col-md-2">
                    
    
        
        <ul class="section_navigation well well-small hidden-xs hidden-sm">
            
                <li class="parent"><a href="/kb/en/mariadb-internals-documentation-query-optimizer/">
                    ↑ Query Optimizer ↑
                </a>
                </li>
            
            
                
                    <li>
                        <a href="/kb/en/optimization-strategies/">
                            <span class="pull-right not_primary"></span>
                            Optimization Strategies
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/optimizations-for-derived-tables/">
                            <span class="pull-right not_primary"></span>
                            Optimizations for Derived Tables
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-internals-documentation-optimizer-trace/">
                            
                            Optimizer Trace
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/statistics-for-optimizing-queries/">
                            <span class="pull-right not_primary"></span>
                            Statistics for Optimizing Queries
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/table-elimination/">
                            <span class="pull-right not_primary"></span>
                            Table Elimination
                        </a>
                    </li>
                
            
                
                    <li class="active">
                        <span>Block-Based Join Algorithms</span>
                        
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/condition-selectivity-computation-internals/">
                            
                            Condition Selectivity Computation Internals
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/extended-keys/">
                            
                            Extended Keys
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/minmax-optimization/">
                            
                            MIN/MAX optimization
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/notes-when-an-index-cannot-be-used/">
                            
                            Notes When an Index Cannot Be Used
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/optimizer-debugging-with-gdb/">
                            
                            Optimizer Debugging With GDB
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/optimizer-development/">
                            
                            Optimizer Development
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/optimizer_max_sel_arg_weight/">
                            
                            optimizer_max_sel_arg_weight
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/range-optimizer/">
                            
                            Range Optimizer
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/rowid-filtering-optimization/">
                            <span class="pull-right not_primary"></span>
                            Rowid Filtering Optimization
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/the-optimizer-cost-model-from-mariadb-11-0/">
                            
                            The Optimizer Cost Model from MariaDB 11.0
                        </a>
                    </li>
                
            
        </ul>
    
    

                </div>
            
        </div>
    </div>
</div>

<!-- Footer -->
<footer id="footer">
    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-xs-12">
                    <ul class="list-inline text-center footer-nav">
                        <li>
                            <h5>
                                <a href="https://mariadb.com/products" title="Products">Products</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/services" title="Services">Services</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/pricing" title="Pricing">Pricing</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/resources" title="Resources">Resources</a>
                            </h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/about-us" title="About MariaDB">About Us</a></h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/download" title="Download">Download MariaDB</a></h5>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="row row-10">
                
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div id="block-footerformcontact" class="block block-block-content block-block-contentd754ee1b-3cc9-40e7-9ef4-f504f1197fb1">
                        
                            <h5 style="font-weight: 400;">Subscribe to our newsletter!</h5>
                            <script src="//app-sj15.marketo.com/js/forms2/js/forms2.min.js"></script><form id="mktoForm_1498"></form>
                            <script>
                                <!--//--><![CDATA[// ><!--
                                MktoForms2.loadForm("//app-sj15.marketo.com", "573-PXI-984", 1498);
                                //--><!]]]]><![CDATA[>
                                //--><!]]>
                            </script>
                        
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div class="footer-copyright">
                        <div class="text-center">
                            <ul class="list-inline no-margin">
                                <li>
                                    <a href="/legal" title="Legal">Legal</a>
                                </li>
                                <li>
                                    <a href="/privacy-policy" title="Privacy Policy">Privacy Policy</a>
                                </li>
                                <li>
                                    <a href="/cookie-policy/" title="Cookies">Cookie Policy</a>
                                </li>
                            </ul>
                            <p>Copyright &copy; 2025 MariaDB. All rights reserved.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</footer>
</div>

<div id="ajax_loading">
    <img src="/kb/static/images/ajax-loader.a51c5608d01a.gif" />
</div>

    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MK2847"
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MK2847');</script>
    <!-- End Google Tag Manager -->

</body>

<script type="text/javascript" src="/kb/static/js/main.1587e3a666fc.js" charset="utf-8"></script>

</html>