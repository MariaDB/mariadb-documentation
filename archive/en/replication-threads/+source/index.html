<!DOCTYPE html>
<html>
<head data-cookie-domain=""
      data-cookie-path="/">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="apple-touch-icon" sizes="180x180" href="/kb/static/images/favicons/apple-touch-icon.159e713979be.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/kb/static/images/favicons/favicon-32x32.bc0ac1d5d11e.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/kb/static/images/favicons/favicon-16x16.5801f8f0f34e.png">
    <link rel="shortcut icon" href="/kb/static/images/favicons/favicon.d122d305dee4.ico" type="image/x-icon" />

    <title>Replication Threads - Source - MariaDB Knowledge Base</title>

    <link href="/kb/static/css/main.f7633538c846.css" rel="stylesheet" type="text/css" />

    
        <meta name="robots" content="noindex, nofollow">
    

    

    <!-- FB Open Graph tags -->
    <meta property="og:title" content="Replication Threads - Source" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://mariadb.com/kb/en/replication-threads/+source/" />
    <meta property="og:image" content="http://mariadb.comaskmonty-logo.png" />
    <meta property="og:site_name" content="MariaDB KnowledgeBase" />
    <meta property="fb:admins" content="514852603" />
    <meta property="og:description" content="" />

    <meta name="description" content="" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet"/>
    
</head>
<body class="mpkb nodes autoresize nodes_source jqui" id="nodes_source">





<div id="menu-mobile" class="visible-sm visible-xs">

    <div>
        <div id="mobile-close-menu" class="text-right">
            <a href="javascript:void(0)" title="Close Menu" id="back-main" class="toggle-menu">X<span></span></a>
        </div>
    </div>
    <div class="mainmenu-mobile">
        <ul class="ls-none ul-menu">
            <li data-sub="submenu5"><a class="open-form-search" href="/kb/search/" title="Search">Search </a></li>
            <li data-sub="submenu0"><a href="/products" title="Products">Products</a><span class="arrow-main"></span></li>
            <li data-sub="submenu1"><a href="/services" title="Services">Services</a><span class="arrow-main"></span></li>
            <li data-sub="submenu2"><a href="/resources" title="Resources">Resources</a><span class="arrow-main"></span></li>
            <li data-sub="submenu3"><a href="/about-us" title="About">About</a><span class="arrow-main"></span></li>
            <li data-sub="submenu4"><a href="/contact" title="Contact">Contact</a></li>
        </ul>
    </div>

    <div class="nav-top-mobile">
        <div class="select-box form">

            <ul class="inline-block-md mb-none top-nav">
                <li>

                </li>
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/replication-threads/+source/"> Login</a>
                    </li>
                
            </ul>



        </div>
        <p class="text-center copyright">Copyright &copy; 2024 MariaDB. All rights reserved.</p>
    </div>
</div>
<div class="violator-wrap d-none" id="top_violator">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12">
                <div class="violator-outer">
                    <div class="violator-inner">
                        <div class="row">
                            <div class="col-xs-12 col-sm-9 col-lg-7 col-lg-offset-2" id="top_violator_content">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="content-link" target="_blank" rel="nofollow noreferrer">
                                    <span>The Ultimate Guide to High Availability with MariaDB</span>
                                </a>
                            </div>
                            <div class="col-xs-12 col-sm-3" id="top_violator_cta">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="btn btn-mariadb" target="_blank" rel="nofollow noreferrer">Download Now</a>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-link close-btn">
                        <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24" width="15px" height="15px"><path d="M 4.9902344 3.9902344 A 1.0001 1.0001 0 0 0 4.2929688 5.7070312 L 10.585938 12 L 4.2929688 18.292969 A 1.0001 1.0001 0 1 0 5.7070312 19.707031 L 12 13.414062 L 18.292969 19.707031 A 1.0001 1.0001 0 1 0 19.707031 18.292969 L 13.414062 12 L 19.707031 5.7070312 A 1.0001 1.0001 0 0 0 18.980469 3.9902344 A 1.0001 1.0001 0 0 0 18.292969 4.2929688 L 12 10.585938 L 5.7070312 4.2929688 A 1.0001 1.0001 0 0 0 4.9902344 3.9902344 z"/></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="wrapper">
<div id="top-nav">
    <div class="container">
        <ul class="hidden-sm hidden-xs" >
            <li><a href="https://mariadb.com/kb/">Knowledge Base</a></li>
            <li><a href="https://mariadb.com/contact/">Contact</a></li>
            
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/replication-threads/+source/" rel="nofollow">Login</a>
                    </li>
                
            
            
            <li id="search-form">
                <form action="/kb/en/+search/" method="get" id="search-block-form" accept-charset="UTF-8">
                    <input id="search" title="Enter the terms you wish to search for."
                           placeholder="Search . . ." type="text"
                           name="q" value="" size="15" maxlength="128" class="form-text"
                           data-autocomplete-url="/kb/en/+search/autocomplete/">
                    <input type="hidden" name="quick" value="1" />
                    <input type="hidden" name="source" value="kb" />
                </form>
            </li>
            <li><a id="search-toggler" href="/kb/search/">Search</a></li>
            
        </ul>
    </div>
</div>
<div id="navbar-bottom" class="navbar">
    <div class="container">
        
        
        
        
        <div class="row">
            <div class="col-md-3 col-sm-9 col-xs-9">
                <a class="brand" href="/" title="MariaDB">
                    <img src="/kb/static/images/logo-2018-black.95f5978ae14d.png">
                </a>
            </div>
            <div class="col-md-9 hidden-sm hidden-xs">
                <div class="main-menu">
                    <ul id="main-menu" class="nav navbar-nav inline-block-sm">
    <li class="has-sub full-menu">
        <a href="/products" title="Products">Products</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/services" title="Services">Services</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/pricing" title="Pricing">Pricing</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/resources" title="Resources">Resources</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/about-us" title="About Us">About Us</a>
    </li>
    <li class="">
        <a class="button electric-eel small top-bar-right-download" href="/downloads/">Download</a>
    </li>
</ul>
                </div>
            </div>
            <div class="col-md-3 visible-sm visible-xs col-sm-3 col-xs-3 ps-rv">
                <div class="navbar-header text-right pull-right">
                    <button type="button" class="menu-control toggle-menu" id="open-menu">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="main">
    <div class="container">
        

        <div id="subheader1" class="clearfix">
            <div class="pull-left">
                
                <div id="breadcrumbs" class="breadcrumb">
                    <a href="/kb/en/">Knowledge Base</a>
                    


    
    » <a class="crumb" href="/kb/en/documentation/">MariaDB Server Documentation</a>
    

    
    » <a class="crumb" href="/kb/en/replication-cluster-multi-master/">High Availability &amp; Performance Tuning</a>
    

    
    » <a class="crumb" href="/kb/en/standard-replication/">MariaDB Replication</a>
    


    » <a class="node_link crumb" href="/kb/en/replication-threads/">Replication Threads</a>


                </div>
                
            </div>
        </div>
    </div>
    <div class="container" id="container-main">
        <div class="row">
            
            
                
                <aside id="sidebar-first" class="sidebar col-md-2 hidden-xs hidden-sm hidden-print">
                    
                        
                        <ul id="category_menu" class="nav nav-pills nav-stacked">
                            <li><a href="/kb/en/">Home</a></li>
                            
                                
                                    <li><a href="/kb/en/+questions/">Open Questions</a></li>
                                
                                <li><a href="/kb/en/documentation/">MariaDB Server</a></li>
                                <li><a href="/kb/en/maxscale/">MariaDB MaxScale</a></li>
                                <li><a href="/kb/en/mariadb-columnstore/">MariaDB ColumnStore</a></li>
                                <li><a href="/kb/en/connectors/">Connectors</a></li>
                            

                        </ul>
                    

                    
                        <div>
    

<div class="well well-small box actions"><div>

        <a class="btn btn-block btn-small" href="/kb/en/replication-threads/">Return to article</a>
    
</div>
</div>

</div>
                    

                    

































                </aside>
            
            
            
                
            
            
            <section id="content" class="limited_width col-md-10 clearfix">
                
                    <h1>Replication Threads - Source</h1>
                

                



                <div>
                    

    

    
    <div class="revision_info">
        <dl class="table">
            <dt>Revision</dt>
            <dd><a href="/kb/en/replication-threads/+r/130225/">130225</a></dd>
            <dt>User</dt>
            <dd>
<span class="user" id="user-3487">
<a href="/kb/user/id/3487" title="Geoff Montee">Geoff Montee</a>
</span></dd>
            <dt>Date</dt>
            <dd>

<span class="datetime" title="2023-09-13 07:25">2023-09-13 07:25</span></dd>
        </dl>
    </div>
    


    

    
        
        <textarea id="answer_source" class="creole_source autogrow">&lt;&lt;include slug=&#34;replica_slave&#34;&gt;&gt;
&lt;&lt;toc&gt;&gt;

MariaDB&#39;s [[high-availability-performance-tuning-mariadb-replication|replication]] implementation requires several types of threads.

== Threads on the Primary

The primary usually only has one type of replication-related thread: the binary log dump thread.

If [[semisynchronous-replication|semisynchronous replication]] is enabled, then the primary also has an ACK receiver thread.

=== Binary Log Dump Thread

The binary log dump thread runs on the primary and dumps the [[binary-log|binary log]] to the replica. This thread can be identified by running the [[show-processlist|SHOW PROCESSLIST]] statement and finding the thread where the [[thread-command-values|thread command]] is ##&#34;Binlog Dump&#34;##.

The primary creates a separate binary log dump thread for each replica connected to the primary. You can identify which replicas are connected to the primary by executing the [[show-slave-hosts|SHOW SLAVE HOSTS]] statement.

==== Binary Log Dump Threads and the Shutdown Process

When a primary server is shutdown and it goes through the normal shutdown process, the primary kills client threads in random order. By default, the primary also considers its binary log dump threads to be regular client threads. As a consequence, the binary log dump threads can be killed while client threads still exist, and this means that data can be written on the primary during a normal shutdown that won&#39;t be replicated. This is true even if [[semisynchronous-replication|semi-synchronous replication]] is being used. Data is not lost, it is stored in the primary server&#39;s binary log. The replicas on reconnection, after the primary server restarts, will resume at the exact position they where killed off during the primary shutdown. No data is lost.

In MariaDB 10.4 and later, this problem can be solved by shutting down the server using either the [[mariadb-admin]] utility or the [[shutdown|SHUTDOWN]] command, and providing a special option.

For example, this problem can be solved by shutting down the server with the [[mariadb-admin]] utility and by providing the ##--wait-for-all-slaves## option to the utility and by executing the ##shutdown## command with the utility:

&lt;&lt;code&gt;&gt;
mariadb-admin --wait-for-all-slaves shutdown
&lt;&lt;/code&gt;&gt;

Or this problem can be solved by shutting down the server with the [[shutdown|SHUTDOWN]] command and by providing the ##WAIT FOR ALL SLAVES## option to the command:

&lt;&lt;sql&gt;&gt;
SHUTDOWN WAIT FOR ALL SLAVES;
&lt;&lt;/sql&gt;&gt;

When one of these special options is provided, the server only kills its binary log dump threads after all client threads have been killed, and it only completes the shutdown after the last [[binary-log|binary log]] has been sent to all connected replicas.

In MariaDB 10.4 and later, it is still not possible to enable this behavior by default. This means that this behavior is currently inaccessible when shutting down the server using tools like [[systemd]] or [[sysvinit|sysVinit]].

In MariaDB 10.3 and before, it is recommended to manually switchover replicas to a new primary before shutting down the old primary.

=== ACK Receiver Thread

When [[semisynchronous-replication|semisynchronous replication]] is enabled, semisynchronous replicas send acknowledgements (ACKs) to their primary to confirm that they have received some transaction. The primary creates an ACK receiver thread to receive these ACKs.

== Threads on the Replica

The replica has three types of replication-related threads: the replica I/O thread, the replica SQL thread, and worker threads, which are only applicable when [[parallel-replication|parallel replication]] is in use.

When [[multi-source-replication|multi-source replication]] is in use, each independent replication connection has its own replica threads of each type.

=== Replica I/O Thread

The replica&#39;s I/O thread receives the [[binary-log|binary log]] events from the primary and writes them to its [[relay-log|relay log]].

==== Binary Log Position

The [[binary-log|binary log]] position of the replica&#39;s I/O thread can be checked by executing the [[show-slave-status|SHOW SLAVE STATUS]] statement. It will be shown as the ##Master_Log_File## and ##Read_Master_Log_Pos## columns.

The [[binary-log|binary log]] position of the replica&#39;s I/O thread can be set by setting the [[change-master-to/#master_log_file|MASTER_LOG_FILE]] and [[change-master-to/#master_log_pos|MASTER_LOG_POS]] options with the [[change-master-to|CHANGE MASTER]] statement.

The [[binary-log|binary log]] position of the replica&#39;s I/O thread and the values of most other [[change-master-to|CHANGE MASTER]] options are written to either the default ##master.info## file or the file that is configured by the [[mysqld-options/#-master-info-file|master_info_file]] option. The replica&#39;s I/O thread keeps this [[binary-log|binary log]] position updated as it downloads events only when the [[#master_use_gtid|MASTER_USE_GTID]] option is set to ##NO##.  Otherwise the file is not updated on a per event basis. See [[change-master-to/#option-persistence|CHANGE MASTER TO: Option Persistence]] for more information.

=== Replica SQL Thread

The replica&#39;s SQL thread reads events from the [[relay-log|relay log]]. What it does with them depends on whether [[parallel-replication|parallel replication]] is in use. If [[parallel-replication|parallel replication]] is not in use, then the SQL thread applies the events to its local copy of the data. If [[parallel-replication|parallel replication]] is in use, then the SQL thread hands off the events to its worker threads to apply in parallel.

==== Relay Log Position

The [[relay-log|relay log]] position of the replica&#39;s SQL thread can be checked by executing the [[show-slave-status|SHOW SLAVE STATUS]] statement. It will be shown as the ##Relay_Log_File## and ##Relay_Log_Pos## columns.

The [[relay-log|relay log]] position of the replica&#39;s SQL thread can be set by setting the [[change-master-to/#relay_log_file|RELAY_LOG_FILE]] and [[change-master-to/#relay_log_pos|RELAY_LOG_POS]] options with the [[change-master-to|CHANGE MASTER]] statement.

The [[relay-log|relay log]] position of the replica&#39;s SQL thread is written to either the default ##relay-log.info## file or the file that is configured by the [[replication-and-binary-log-system-variables/#relay_log_info_file|relay_log_info_file]] system variable. The replica&#39;s SQL thread keeps this [[relay-log|relay log]] position updated as it applies events. See [[change-master-to/#option-persistence|CHANGE MASTER TO: Option Persistence]] for more information.

==== Binary Log Position

The corresponding [[binary-log|binary log]] position of the current [[relay-log|relay log]] position of the replica&#39;s SQL thread can be checked by executing the [[show-slave-status|SHOW SLAVE STATUS]] statement. It will be shown as the ##Relay_Master_Log_File## and ##Exec_Master_Log_Pos## columns.

==== GTID Position

If the replica is replicating [[binary-log|binary log]] events that contain [[gtid|GTIDs]], then the [[replication-threads/#replica-sql-thread|replica&#39;s&#39;s SQL thread]] will write every GTID that it applies to the [[mysqlgtid_slave_pos-table|mysql.gtid_slave_pos]] table. This GTID can be inspected and modified through the [[gtid/#gtid_slave_pos|gtid_slave_pos]] system variable.

If the replica has the [[replication-and-binary-log-system-variables/#log_slave_updates|log_slave_updates]] system variable enabled and if the replica has the [[binary-log|binary log]] enabled, then every write by the [[replication-threads/#replica-sql-thread|replica&#39;s SQL thread]] will also go into the replica&#39;s [[binary-log|binary log]]. This means that [[gtid|GTIDs]] of replicated transactions would be reflected in the value of the [[gtid/#gtid_binlog_pos|gtid_binlog_pos]] system variable.

See [[change-master-to/#gtid-persistence|CHANGE MASTER TO: GTID Persistence]] for more information.

=== Worker Threads

When [[parallel-replication|parallel replication]] is in use, then the SQL thread hands off the events to its worker threads to apply in parallel.</textarea>
    


                    <div id="content_disclaimer" class="graybox">
                        Content reproduced on this site is the property of its respective owners,
                        and this content is not reviewed in advance by MariaDB. The views, information and opinions
                        expressed by this content do not necessarily represent those of MariaDB or any other party.
                    </div>
                </div>
            </section>

            
        </div>
    </div>
</div>

<!-- Footer -->
<footer id="footer">
    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-xs-12">
                    <ul class="list-inline text-center footer-nav">
                        <li>
                            <h5>
                                <a href="https://mariadb.com/products" title="Products">Products</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/services" title="Services">Services</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/pricing" title="Pricing">Pricing</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/resources" title="Resources">Resources</a>
                            </h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/about-us" title="About MariaDB">About Us</a></h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/download" title="Download">Download MariaDB</a></h5>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="row row-10">
                
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div id="block-footerformcontact" class="block block-block-content block-block-contentd754ee1b-3cc9-40e7-9ef4-f504f1197fb1">
                        
                            <h5 style="font-weight: 400;">Subscribe to our newsletter!</h5>
                            <script src="//app-sj15.marketo.com/js/forms2/js/forms2.min.js"></script><form id="mktoForm_1498"></form>
                            <script>
                                <!--//--><![CDATA[// ><!--
                                MktoForms2.loadForm("//app-sj15.marketo.com", "573-PXI-984", 1498);
                                //--><!]]]]><![CDATA[>
                                //--><!]]>
                            </script>
                        
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div class="footer-copyright">
                        <div class="text-center">
                            <ul class="list-inline no-margin">
                                <li>
                                    <a href="/legal" title="Legal">Legal</a>
                                </li>
                                <li>
                                    <a href="/privacy-policy" title="Privacy Policy">Privacy Policy</a>
                                </li>
                                <li>
                                    <a href="/cookie-policy/" title="Cookies">Cookie Policy</a>
                                </li>
                            </ul>
                            <p>Copyright &copy; 2024 MariaDB. All rights reserved.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</footer>
</div>

<div id="ajax_loading">
    <img src="/kb/static/images/ajax-loader.a51c5608d01a.gif" />
</div>

    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MK2847"
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MK2847');</script>
    <!-- End Google Tag Manager -->

</body>

<script type="text/javascript" src="/kb/static/js/main.1587e3a666fc.js" charset="utf-8"></script>

</html>