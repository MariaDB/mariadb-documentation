<!DOCTYPE html>
<html>
<head data-cookie-domain=""
      data-cookie-path="/">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="apple-touch-icon" sizes="180x180" href="/kb/static/images/favicons/apple-touch-icon.159e713979be.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/kb/static/images/favicons/favicon-32x32.bc0ac1d5d11e.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/kb/static/images/favicons/favicon-16x16.5801f8f0f34e.png">
    <link rel="shortcut icon" href="/kb/static/images/favicons/favicon.d122d305dee4.ico" type="image/x-icon" />

    <title>Sharded MariaDB Enterprise Spider Topology Backup and Restore - MariaDB Knowledge Base</title>

    <link href="/kb/static/css/main.f7633538c846.css" rel="stylesheet" type="text/css" />

    

    

    <!-- FB Open Graph tags -->
    <meta property="og:title" content="Sharded MariaDB Enterprise Spider Topology Backup and Restore" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://mariadb.com/kb/en/sharded-mariadb-enterprise-spider-topology-backup-and-restore/" />
    <meta property="og:image" content="http://mariadb.comaskmonty-logo.png" />
    <meta property="og:site_name" content="MariaDB KnowledgeBase" />
    <meta property="fb:admins" content="514852603" />
    <meta property="og:description" content="
Overview
When using Spider in the Sharded MariaDB Enterprise Spider topology, backup and restore operations can be performed using MariaDB Backup or MariaDB Dump. These opera..." />

    <meta name="description" content="
Overview
When using Spider in the Sharded MariaDB Enterprise Spider topology, backup and restore operations can be performed using MariaDB Backup or MariaDB Dump. These opera..." />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet"/>
    
</head>
<body class="mpkb nodes products nodes_view jqui" id="nodes_view">





<div id="menu-mobile" class="visible-sm visible-xs">

    <div>
        <div id="mobile-close-menu" class="text-right">
            <a href="javascript:void(0)" title="Close Menu" id="back-main" class="toggle-menu">X<span></span></a>
        </div>
    </div>
    <div class="mainmenu-mobile">
        <ul class="ls-none ul-menu">
            <li data-sub="submenu5"><a class="open-form-search" href="/kb/search/" title="Search">Search </a></li>
            <li data-sub="submenu0"><a href="/products" title="Products">Products</a><span class="arrow-main"></span></li>
            <li data-sub="submenu1"><a href="/services" title="Services">Services</a><span class="arrow-main"></span></li>
            <li data-sub="submenu2"><a href="/resources" title="Resources">Resources</a><span class="arrow-main"></span></li>
            <li data-sub="submenu3"><a href="/about-us" title="About">About</a><span class="arrow-main"></span></li>
            <li data-sub="submenu4"><a href="/contact" title="Contact">Contact</a></li>
        </ul>
    </div>

    <div class="nav-top-mobile">
        <div class="select-box form">

            <ul class="inline-block-md mb-none top-nav">
                <li>

                </li>
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/sharded-mariadb-enterprise-spider-topology-backup-and-restore/"> Login</a>
                    </li>
                
            </ul>



        </div>
        <p class="text-center copyright">Copyright &copy; 2025 MariaDB. All rights reserved.</p>
    </div>
</div>
<div class="violator-wrap d-none" id="top_violator">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12">
                <div class="violator-outer">
                    <div class="violator-inner">
                        <div class="row">
                            <div class="col-xs-12 col-sm-9 col-lg-7 col-lg-offset-2" id="top_violator_content">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="content-link" target="_blank" rel="nofollow noreferrer">
                                    <span>The Ultimate Guide to High Availability with MariaDB</span>
                                </a>
                            </div>
                            <div class="col-xs-12 col-sm-3" id="top_violator_cta">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="btn btn-mariadb" target="_blank" rel="nofollow noreferrer">Download Now</a>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-link close-btn">
                        <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24" width="15px" height="15px"><path d="M 4.9902344 3.9902344 A 1.0001 1.0001 0 0 0 4.2929688 5.7070312 L 10.585938 12 L 4.2929688 18.292969 A 1.0001 1.0001 0 1 0 5.7070312 19.707031 L 12 13.414062 L 18.292969 19.707031 A 1.0001 1.0001 0 1 0 19.707031 18.292969 L 13.414062 12 L 19.707031 5.7070312 A 1.0001 1.0001 0 0 0 18.980469 3.9902344 A 1.0001 1.0001 0 0 0 18.292969 4.2929688 L 12 10.585938 L 5.7070312 4.2929688 A 1.0001 1.0001 0 0 0 4.9902344 3.9902344 z"/></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="wrapper">
<div id="top-nav">
    <div class="container">
        <ul class="hidden-sm hidden-xs" >
            <li><a href="https://mariadb.com/kb/">Knowledge Base</a></li>
            <li><a href="https://mariadb.com/contact/">Contact</a></li>
            
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/sharded-mariadb-enterprise-spider-topology-backup-and-restore/" rel="nofollow">Login</a>
                    </li>
                
            
            
            <li id="search-form">
                <form action="/kb/en/+search/" method="get" id="search-block-form" accept-charset="UTF-8">
                    <input id="search" title="Enter the terms you wish to search for."
                           placeholder="Search . . ." type="text"
                           name="q" value="" size="15" maxlength="128" class="form-text"
                           data-autocomplete-url="/kb/en/+search/autocomplete/">
                    <input type="hidden" name="quick" value="1" />
                    <input type="hidden" name="source" value="kb" />
                </form>
            </li>
            <li><a id="search-toggler" href="/kb/search/">Search</a></li>
            
        </ul>
    </div>
</div>
<div id="navbar-bottom" class="navbar">
    <div class="container">
        
        
        
        
        <div class="row">
            <div class="col-md-3 col-sm-9 col-xs-9">
                <a class="brand" href="/" title="MariaDB">
                    <img src="/kb/static/images/logo-2018-black.95f5978ae14d.png">
                </a>
            </div>
            <div class="col-md-9 hidden-sm hidden-xs">
                <div class="main-menu">
                    <ul id="main-menu" class="nav navbar-nav inline-block-sm">
    <li class="has-sub full-menu">
        <a href="/products" title="Products">Products</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/solutions" title="Solutions">Solutions</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/resources" title="Resources">Resources</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/about-us" title="Company">Company</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/pricing" title="Pricing">Pricing</a>
    </li>
    
    <li class="">
        <a class="button electric-eel small top-bar-right-download" href="/downloads/">Download</a>
    </li>
</ul>
                </div>
            </div>
            <div class="col-md-3 visible-sm visible-xs col-sm-3 col-xs-3 ps-rv">
                <div class="navbar-header text-right pull-right">
                    <button type="button" class="menu-control toggle-menu" id="open-menu">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="main">
    <div class="container">
        

        <div id="subheader1" class="clearfix">
            <div class="pull-left">
                
                <div id="breadcrumbs" class="breadcrumb">
                    <a href="/kb/en/">Knowledge Base</a>
                    


    
    » <a class="crumb" href="/kb/en/documentation/">MariaDB Server Documentation</a>
    

    
    » <a class="crumb" href="/kb/en/columns-storage-engines-and-plugins/">Columns, Storage Engines, and Plugins</a>
    

    
    » <a class="crumb" href="/kb/en/storage-engines/">Storage Engines</a>
    

    
    » <a class="crumb" href="/kb/en/spider/">Spider</a>
    

    
    » <a class="crumb" href="/kb/en/spider-storage-engine-introduction/">Spider Storage Engine Introduction</a>
    

    
    » <a class="crumb" href="/kb/en/mariadb-enterprise-spider-operations/">MariaDB Enterprise Spider Operations</a>
    

    
    » <a class="crumb" href="/kb/en/sharded-mariadb-enterprise-spider-topology-operations/">Sharded MariaDB Enterprise Spider Topology Operations</a>
    


    » <a class="node_link crumb" href="/kb/en/sharded-mariadb-enterprise-spider-topology-backup-and-restore/">Sharded MariaDB Enterprise Spider Topology Backup and Restore</a>


                </div>
                
            </div>
        </div>
    </div>
    <div class="container" id="container-main">
        <div class="row">
            
            
                
                <aside id="sidebar-first" class="sidebar col-md-2 hidden-xs hidden-sm hidden-print">
                    
                        
                        <ul id="category_menu" class="nav nav-pills nav-stacked">
                            <li><a href="/kb/en/">Home</a></li>
                            
                                
                                    <li><a href="/kb/en/+questions/">Open Questions</a></li>
                                
                                <li><a href="/kb/en/documentation/">MariaDB Server</a></li>
                                <li><a href="/kb/en/maxscale/">MariaDB MaxScale</a></li>
                                <li><a href="/kb/en/mariadb-columnstore/">MariaDB ColumnStore</a></li>
                                <li><a href="/kb/en/connectors/">Connectors</a></li>
                            

                        </ul>
                    

                    
<div>



<div class="well well-small box actions"><div>

        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/sharded-mariadb-enterprise-spider-topology-backup-and-restore/+history" rel="nofollow">History</a>
        
        
        
        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/sharded-mariadb-enterprise-spider-topology-backup-and-restore/+source/">Source</a>
        
        <a class="btn btn-block btn-blue btn-sm flag" href="/kb/en/sharded-mariadb-enterprise-spider-topology-backup-and-restore/+flag"
                data-flag-url="/kb/en/sharded-mariadb-enterprise-spider-topology-backup-and-restore/+flag" rel="nofollow">
                Flag as Spam / Inappropriate</a>
        
        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/sharded-mariadb-enterprise-spider-topology-backup-and-restore/+translate/">
                Translate</a>
        

</div>
</div>





<div class="well well-small box node_info"><div>

    <dl>
        <dt>Created</dt>
        <dd>

<span class="datetime" title="2025-03-06 08:43">2 months ago</span></dd>

        <dt>Modified</dt>
        <dd>

<span class="datetime" title="2025-04-30 11:45">4 days, 22 hours ago</span></dd>

        <dt>Type</dt>
        <dd>article</dd>

        <dt>Status</dt>
        <dd>active</dd>

        <dt>License</dt>
        <dd>
            
                <a href="/kb/en/sharded-mariadb-enterprise-spider-topology-backup-and-restore/+license/">CC BY-SA / Gnu FDL</a>
            
        </dd>

        
    </dl>

    
    <ul class="rss_feeds">
        <li><a href="/kb/en/sharded-mariadb-enterprise-spider-topology-backup-and-restore/+history/feed/">
            History</a>
        </li>
        <li><a href="/kb/en/sharded-mariadb-enterprise-spider-topology-backup-and-restore/+comments/feed/">
            Comments</a>
        </li>
    </ul>
    

</div>
</div>





    
    
    

<div class="well well-small box attachments"><div><div class="edit_link pull-right"><a href="/kb/en/sharded-mariadb-enterprise-spider-topology-backup-and-restore/+edit/attachments/">Edit</a></div><h5>Attachments</h5></div><div>

        
            <div class="no_data">No attachments exist</div>
        
    
</div>
</div>

    



    
    






</div>


                    

































                </aside>
            
            
            
                
            
            
                
            
            <section id="content" class="limited_width col-md-8 clearfix">
                
                    <h1>Sharded MariaDB Enterprise Spider Topology Backup and Restore</h1>
                

                



                <div>
                    
    

    
    
    

    <div class="node creole">
        
        
        


    
    <div class="answer formatted">
        <div class="table_of_contents well well-small">
<h3>Contents</h3>
 <ol class="toc">

 <li class=""><a href="#overview" title="Overview">Overview</a></li>

 <li class=""><a href="#mariadb-backup" title="MariaDB Backup">MariaDB Backup</a> <ol class="toc">

    <li class=""><a href="#backup-spider-with-mariadb-backup" title="Backup Spider with MariaDB Backup">Backup Spider with MariaDB Backup</a> </ol>
</li>

 <li class=""><a href="#restore-spider-with-mariadb-backup" title="Restore Spider with MariaDB Backup">Restore Spider with MariaDB Backup</a></li>

 <li class=""><a href="#mariadb-dump" title="MariaDB Dump">MariaDB Dump</a> <ol class="toc">

    <li class=""><a href="#backup-spider-with-mariadb-dump" title="Backup Spider with MariaDB Dump">Backup Spider with MariaDB Dump</a> </ol>
</li>

 <li class=""><a href="#restore-spider-from-mariadb-dump" title="Restore Spider from MariaDB Dump">Restore Spider from MariaDB Dump</a></li>
</div>
<h1 class="anchored_heading" id="overview">Overview</h1>
<p>When using Spider in the Sharded MariaDB Enterprise Spider topology, backup and restore operations can be performed using <a href="/kb/en/mariabackup/">MariaDB Backup</a> or <a href="/kb/en/mariadb-dump/">MariaDB Dump</a>. These operations must be performed on the Spider Node as well as on each Data Node.</p>
<h1 class="anchored_heading" id="mariadb-backup">MariaDB Backup</h1>
<p>MariaDB Backup can be used to perform backup operations on Spider deployments.</p>
<h2 class="anchored_heading" id="backup-spider-with-mariadb-backup">Backup Spider with MariaDB Backup</h2>
<p> <a href="/kb/en/mariabackup/">MariaDB Backup</a> can be used to create a physical backup of a Sharded MariaDB Enterprise Spider topology. MariaDB Backup must be used to backup the Spider Node and all Data Nodes. The Spider Node and Data Nodes must be locked to guarantee that the backups of the Spider Node and Data Nodes are consistent.</p>
<p>The backup of the Spider Node contains:</p>
<ul start="1"><li>Physical backup for Spider Tables
</li><li>Physical backup for tables that use InnoDB, Aria, MyISAM, and MyRocks
</li><li>Physical backup for any other database objects on the Spider Node
</li></ul>
<p>The backups of the Data Nodes contain:</p>
<ul start="1"><li>Physical backup for Data Tables
</li><li>Physical backup for tables that use InnoDB, Aria, MyISAM, and MyRocks
</li><li>Physical backup for any other database objects on the Data Node
</li></ul>
<p>The following procedure shows how to take a consistent backup of a Spider Node and Data Nodes deployed in a Sharded MariaDB Enterprise Spider topology.</p>
<p>1. On the Spider Node and on each Data Node, create a user account to perform the backup using the <a href="/kb/en/create-user/">CREATE USER</a> and <a href="/kb/en/grant/">GRANT</a> statements.</p>
<p>For MariaDB Enterprise Server 10.5 and later:</p>
<pre class="fixed">CREATE USER 'mariadb-backup'@'localhost'
   IDENTIFIED BY 'mb_passwd';

GRANT RELOAD, PROCESS, LOCK TABLES, BINLOG MONITOR
   ON *.*
   TO 'mariadb-backup'@'localhost';
</pre><p>2. On each Data Node, grant the user account Spider uses when operating on Data Nodes sufficient privileges to lock any Data Tables using the <a href="/kb/en/grant/">GRANT</a> statement.</p>
<p>For example, on the hq_server Data Node:</p>
<pre class="fixed">GRANT LOCK TABLES ON hq_sales.* TO 'spider_user'@'192.0.2.2';
</pre><p>On the eastern_server Data Node:</p>
<pre class="fixed">GRANT LOCK TABLES ON eastern_sales.* TO 'spider_user'@'192.0.2.2';
</pre><p>On the western_server Data Node:</p>
<pre class="fixed">GRANT LOCK TABLES ON western_sales.* TO 'spider_user'@'192.0.2.2';
</pre><p>3. On the Spider Node, acquire a read lock on Spider Tables using the LOCK TABLES statement:</p>
<pre class="fixed">LOCK TABLES spider_sharded_sales.invoices READ;
</pre><p>Keep this session open during the rest of the procedure.</p>
<p>The read lock will propagate to the Data Tables on each Data Node as well. The read locks will prevent the Data Tables from changing during the backup, so the backups on the Spider Node and Data Nodes are consistent.</p>
<p>4. On each Data Node, perform the backup using <a href="/kb/en/mariabackup/">MariaDB Backup</a> .</p>
<p>With MariaDB Backup 10.5 and later, use the mariadb-backup command:</p>
<pre class="fixed">$ sudo mariadb-backup --backup \
   --target-dir=/data/backups/full \
   --user=mariadb-backup \
   --password='mb_passwd'
</pre><p>5. On the Spider Node, after backing up each Data Node, perform a backup with <a href="/kb/en/mariabackup/">MariaDB Backup</a> .</p>
<p>With MariaDB Backup 10.5 and later, use the mariadb-backup command:</p>
<pre class="fixed">$ sudo mariadb-backup --backup \
   --target-dir=/data/backups/full \
   --user=mariadb-backup \
   --password='mb_passwd'
</pre><p>6. On the Spider Node, after the backup is complete, in your original session, use the <a href="/kb/en/transactions-unlock-tables/">UNLOCK TABLES</a> statement to release the table locks:</p>
<pre class="fixed">UNLOCK TABLES;
</pre><p>7. On the Spider Node and each of the Data Nodes, prepare each of the backups using MariaDB Backup.</p>
<p>With MariaDB Backup 10.5 and later, use the mariadb-backup command:</p>
<pre class="fixed">$ sudo mariadb-backup --prepare \
   --target-dir=/data/backups/full
</pre><p>The Spider Node and Data Nodes now each have a complete backup of the data directory. Backups should be tested to confirm they are complete and consistent.</p>
<h1 class="anchored_heading" id="restore-spider-with-mariadb-backup">Restore Spider with MariaDB Backup</h1>
<p><a href="/kb/en/mariabackup/">MariaDB Backup</a>  can restore a Sharded MariaDB Enterprise Spider topology from a backup taken with MariaDB Backup.</p>
<p>1. On the Spider Node and on each Data Node, stop the MariaDB Server process:</p>
<pre class="fixed">
$ sudo systemctl stop mariadb
</pre><p>2. On the Spider Node and on each Data Node, empty the data directory:</p>
<pre class="fixed">$ sudo rm -fr /var/lib/mysql/*
</pre><p>3. On the Spider Node and on each Data Node, restore the backup for that server using MariaDB Backup.</p>
<p>With MariaDB Backup 10.5 and later, use the mariadb-backup command:</p>
<pre class="fixed">$ sudo mariadb-backup --copy-back \
   --target-dir=/data/backups/full
</pre><p>4. On the Spider Node and on each Data Node, confirm that the restored files are owned by the user that owns the MariaDB Server process:</p>
<pre class="fixed">$ sudo chown -R mysql:mysql /var/lib/mysql
</pre><p>5. On the Spider Node and on each Data Node, start the MariaDB Server process:</p>
<pre class="fixed">$ sudo systemctl start mariadb</pre><p>6. On the Spider Node, query a Spider Table to test it:</p>
<pre class="fixed">SELECT * FROM spider_sharded_sales.invoices;
</pre><pre class="fixed">+-----------+------------+-------------+----------------------------+---------------+----------------+
| branch_id | invoice_id | customer_id | invoice_date               | invoice_total | payment_method |
+-----------+------------+-------------+----------------------------+---------------+----------------+
|         1 |          1 |           1 | 2020-05-10 12:35:10.000000 |       1087.23 | CREDIT_CARD    |
|         1 |          2 |           2 | 2020-05-10 14:17:32.000000 |       1508.57 | WIRE_TRANSFER  |
|         1 |          3 |           3 | 2020-05-10 14:25:16.000000 |        227.15 | CASH           |
|         2 |          1 |           2 | 2020-05-10 12:31:00.000000 |       1351.04 | CREDIT_CARD    |
|         2 |          2 |           2 | 2020-05-10 12:45:27.000000 |        162.11 | WIRE_TRANSFER  |
|         2 |          3 |           4 | 2020-05-10 13:11:23.000000 |        350.00 | CASH           |
|         3 |          1 |           5 | 2020-05-10 12:31:00.000000 |        111.50 | CREDIT_CARD    |
|         3 |          2 |           8 | 2020-05-10 12:45:27.000000 |       1509.23 | WIRE_TRANSFER  |
|         3 |          3 |           3 | 2020-05-10 13:11:23.000000 |       3301.66 | CASH           |
+-----------+------------+-------------+----------------------------+---------------+----------------+
</pre><h1 class="anchored_heading" id="mariadb-dump">MariaDB Dump</h1>
<p><a href="/kb/en/mariadb-dump/">MariaDB Dump</a>  generates backup files containing the SQL statements necessary to recreate the database. MariaDB Dump is included with MariaDB Server and can be used to backup databases in Spider deployments. The MariaDB Client can then be used to restore databases from a MariaDB Dump backup.</p>
<h2 class="anchored_heading" id="backup-spider-with-mariadb-dump">Backup Spider with MariaDB Dump</h2>
<p><a href="/kb/en/mariadb-dump/">MariaDB Dump</a>  can be used to create a logical backup of a Sharded MariaDB Enterprise Spider topology. MariaDB Dump must be used to backup the Spider Node and all Data Nodes. The Spider Node and Data Nodes must be locked to guarantee that the backups of the Spider Node and Data Nodes are consistent.</p>
<p>The backup of the Spider Node contains:</p>
<ul start="1"><li>Table definitions for Spider Tables
</li><li>Table definitions for all tables
</li><li>Table data for tables that use InnoDB, Aria, MyISAM, and MyRocks
</li><li>Definitions for any other user accounts, privileges, views, and triggers on the Spider Node
</li></ul>
<p>The backups of the Data Nodes contain:</p>
<ul start="1"><li>Table definitions for Data Tables
</li><li>Table definitions for all tables
</li><li>Table data for tables that use InnoDB, Aria, MyISAM, and MyRocks
</li><li>Definitions for any other user accounts, privileges, views, and triggers on the Data Node
</li></ul>
<p>The following procedure shows how to take a consistent backup of a Spider Node and Data Nodes deployed in a Sharded MariaDB Enterprise Spider topology.</p>
<p>1. On the Spider Node and on each Data Node, create a user account to perform the backup using the <a href="/kb/en/create-user/">CREATE USER</a> and <a href="/kb/en/grant/">GRANT</a> statements:</p>
<pre class="fixed">CREATE USER 'mariadb-dump'@'localhost'
   IDENTIFIED BY 'md_passwd';

GRANT SELECT, INSERT, SHOW VIEW, TRIGGER, CREATE, ALTER, EVENT, RELOAD, LOCK TABLES
   ON *.*
   TO 'mariadb-dump'@'localhost';
</pre><p>2. On each Data Node, grant the user account Spider uses to operate on the Data Nodes sufficient privileges to lock any Data Tables using the GRANT statement.</p>
<p>For example, on the hq_server Data Node:</p>
<pre class="fixed">GRANT LOCK TABLES ON hq_sales.* TO 'spider_user'@'192.0.2.2';
</pre><p>On the <code>eastern_server</code> Data Node:</p>
<pre class="fixed">GRANT LOCK TABLES ON eastern_sales.* TO 'spider_user'@'192.0.2.2';
</pre><p>On the <code>western_server</code> Data Node:</p>
<pre class="fixed">GRANT LOCK TABLES ON western_sales.* TO 'spider_user'@'192.0.2.2';
</pre><p>3. On the Spider Node, acquire a read lock on Spider Tables using the <a href="/kb/en/lock-tables/">LOCK TABLES</a> statement:</p>
<pre class="fixed">LOCK TABLES spider_sharded_sales.invoices READ;
</pre><p>Keep this session open during the rest of the procedure.</p>
<p>The read lock will propagate to the Data Tables on each Data Node as well. The read locks will prevent the Data Tables from changing during the backup, so the backups of the Spider Node and Data Nodes are consistent.</p>
<p>4. On each Data Node, perform the backup using MariaDB Dump.
With MariaDB Dump 10.5 and later, use the mariadb-dump command:</p>
<pre class="fixed">$ mariadb-dump \
   --user=mariadb-dump \
   --password='md_passwd' \
   --ssl-verify-server-cert \
   --ssl-ca ~/mariadb_chain.pem \
   --all-databases \
   --single-transaction \
   --default-character-set=utf8mb4 \
   &gt; mariadb_dump.sql
</pre><p>5. On the Spider Node, once the Data Nodes are backed up, perform a backup using MariaDB Dump.</p>
<p>With MariaDB Dump 10.5 and later, use the mariadb-dump command:</p>
<pre class="fixed">$ mariadb-dump \
   --user=mariadb-dump \
   --password='md_passwd' \
   --ssl-verify-server-cert \
   --ssl-ca ~/mariadb_chain.pem \
   --all-databases \
   --single-transaction \
   --default-character-set=utf8mb4 \
   &gt; mariadb_dump.sql
</pre><p>6. On the Spider Node, after the backups are complete, in your original session use the <a href="/kb/en/transactions-unlock-tables/">UNLOCK TABLES</a> statement to release the table locks:</p>
<pre class="fixed">UNLOCK TABLES;
</pre><p>The Spider Node and the Data Node now each have a mariadb_dump.sql backup file. This backup file contains the SQL statements needed to recreate the schema on the Spider Node and the schema and data on the Data Nodes. Backups should be tested to confirm they are complete and consistent.</p>
<h1 class="anchored_heading" id="restore-spider-from-mariadb-dump">Restore Spider from MariaDB Dump</h1>
<p>MariaDB Client can restore a Sharded MariaDB Enterprise Spider topology from a backup taken with <a href="/kb/en/mariadb-dump/">MariaDB Dump</a> backup.</p>
<p>1. Stop all traffic to the Spider Node and each Data Node.</p>
<p>2. On the Spider Node, restore the backup for that server using MariaDB Client.</p>
<p>With MariaDB Client 10.5 and later, use the mariadb command:</p>
<pre class="fixed">$ mariadb \
   --user=mariadb-dump \
   --password='md_passwd' \
   --ssl-verify-server-cert \
   --ssl-ca ~/mariadb_chain.pem \
   --default-character-set=utf8mb4 \
   &lt; mariadb_dump.sql
</pre><p>3. On the Data Node, restore the backup for that server using MariaDB Client.</p>
<p>With MariaDB Client 10.5 and later, use the mariadb command:</p>
<pre class="fixed">$ mariadb \
   --user=mariadb-dump \
   --password='md_passwd' \
   --ssl-verify-server-cert \
   --ssl-ca ~/mariadb_chain.pem \
   --default-character-set=utf8mb4 \
   &lt; mariadb_dump.sql
</pre><p>4. On the Spider Node, query a Spider Table to test it:</p>
<pre class="fixed">SELECT * FROM spider_sharded_sales.invoices;
</pre><pre class="fixed">
+-----------+------------+-------------+----------------------------+---------------+----------------+
| branch_id | invoice_id | customer_id | invoice_date               | invoice_total | payment_method |
+-----------+------------+-------------+----------------------------+---------------+----------------+
|         1 |          1 |           1 | 2020-05-10 12:35:10.000000 |       1087.23 | CREDIT_CARD    |
|         1 |          2 |           2 | 2020-05-10 14:17:32.000000 |       1508.57 | WIRE_TRANSFER  |
|         1 |          3 |           3 | 2020-05-10 14:25:16.000000 |        227.15 | CASH           |
|         2 |          1 |           2 | 2020-05-10 12:31:00.000000 |       1351.04 | CREDIT_CARD    |
|         2 |          2 |           2 | 2020-05-10 12:45:27.000000 |        162.11 | WIRE_TRANSFER  |
|         2 |          3 |           4 | 2020-05-10 13:11:23.000000 |        350.00 | CASH           |
|         3 |          1 |           5 | 2020-05-10 12:31:00.000000 |        111.50 | CREDIT_CARD    |
|         3 |          2 |           8 | 2020-05-10 12:45:27.000000 |       1509.23 | WIRE_TRANSFER  |
|         3 |          3 |           3 | 2020-05-10 13:11:23.000000 |       3301.66 | CASH           |
+-----------+------------+-------------+----------------------------+---------------+----------------+
</pre>
    </div>


        
            <div id="subscribe" class="well well-small hide hidden-print"
                 data-subscribe-url="/kb/en/sharded-mariadb-enterprise-spider-topology-backup-and-restore/+subscriptions/add"
                 data-unsubscribe-url="/kb/en/sharded-mariadb-enterprise-spider-topology-backup-and-restore/+subscriptions/remove">
            </div>
        

        
        
    
        <div class="simple_section_nav">
            <ul class="nav nav-pills">
                
                    <li><a href="/kb/en/sharded-mariadb-enterprise-spider-topology-add-a-shard/">
                        ← Sharded MariaDB Enterprise Spider Topology Add a Shard
                    </a>
                    </li>
                
                
                    <li><a href="/kb/en/sharded-mariadb-enterprise-spider-topology-operations/">
                        ↑ Sharded MariaDB Enterprise Spider Topology Operations ↑
                    </a>
                    </li>
                
                
            </ul>
        </div>
    

        

        
        <h2>Comments</h2>
        
    
    <div id="comments" data-node-id="15945" data-comments-url="/kb/en/sharded-mariadb-enterprise-spider-topology-backup-and-restore/+comments"
         data-reply-url="/kb/en/sharded-mariadb-enterprise-spider-topology-backup-and-restore/comments/post/">
        Comments loading...
    </div>

        

    </div>


                    <div id="content_disclaimer" class="graybox">
                        Content reproduced on this site is the property of its respective owners,
                        and this content is not reviewed in advance by MariaDB. The views, information and opinions
                        expressed by this content do not necessarily represent those of MariaDB or any other party.
                    </div>
                </div>
            </section>

            
                <div id="right_bar" class="col-md-2">
                    
    
        
        <ul class="section_navigation well well-small hidden-xs hidden-sm">
            
                <li class="parent"><a href="/kb/en/sharded-mariadb-enterprise-spider-topology-operations/">
                    ↑ Sharded MariaDB Enterprise Spider Topology Operations ↑
                </a>
                </li>
            
            
                
                    <li>
                        <a href="/kb/en/sharded-mariadb-enterprise-spider-topology-add-a-shard/">
                            
                            Sharded MariaDB Enterprise Spider Topology Add a Shard
                        </a>
                    </li>
                
            
                
                    <li class="active">
                        <span>Sharded MariaDB Enterprise Spider Topology Backup and Restore</span>
                        
                    </li>
                
            
        </ul>
    
    

                </div>
            
        </div>
    </div>
</div>

<!-- Footer -->
<footer id="footer">
    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-xs-12">
                    <ul class="list-inline text-center footer-nav">
                        <li>
                            <h5>
                                <a href="https://mariadb.com/products" title="Products">Products</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/solutions" title="Solutions">Solutions</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/resources" title="Resources">Resources</a>
                            </h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/about-us" title="About MariaDB">Company</a></h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/pricing" title="Pricing">Pricing</a>
                            </h5>
                        </li>
                        
                        
                        <li>
                            <h5><a href="https://mariadb.com/downloads" title="Download">Download MariaDB</a></h5>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="row row-10">
                
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div id="block-footerformcontact" class="block block-block-content block-block-contentd754ee1b-3cc9-40e7-9ef4-f504f1197fb1">
                        
                            <h5 style="font-weight: 400;">Subscribe to our newsletter!</h5>
                            <script src="//app-sj15.marketo.com/js/forms2/js/forms2.min.js"></script><form id="mktoForm_1498"></form>
                            <script>
                                <!--//--><![CDATA[// ><!--
                                MktoForms2.loadForm("//app-sj15.marketo.com", "573-PXI-984", 1498);
                                //--><!]]]]><![CDATA[>
                                //--><!]]>
                            </script>
                        
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div class="footer-copyright">
                        <div class="text-center">
                            <ul class="list-inline no-margin">
                                <li>
                                    <a href="/legal" title="Legal">Legal</a>
                                </li>
                                <li>
                                    <a href="/privacy-policy" title="Privacy Policy">Privacy Policy</a>
                                </li>
                                <li>
                                    <a href="/cookie-policy/" title="Cookies">Cookie Policy</a>
                                </li>
                            </ul>
                            <p>Copyright &copy; 2025 MariaDB. All rights reserved.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</footer>
</div>

<div id="ajax_loading">
    <img src="/kb/static/images/ajax-loader.a51c5608d01a.gif" />
</div>

    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MK2847"
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MK2847');</script>
    <!-- End Google Tag Manager -->

</body>

<script type="text/javascript" src="/kb/static/js/main.1587e3a666fc.js" charset="utf-8"></script>

</html>