<!DOCTYPE html>
<html>
<head data-cookie-domain=""
      data-cookie-path="/">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="apple-touch-icon" sizes="180x180" href="/kb/static/images/favicons/apple-touch-icon.159e713979be.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/kb/static/images/favicons/favicon-32x32.bc0ac1d5d11e.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/kb/static/images/favicons/favicon-16x16.5801f8f0f34e.png">
    <link rel="shortcut icon" href="/kb/static/images/favicons/favicon.d122d305dee4.ico" type="image/x-icon" />

    <title>Query Cache - MariaDB Knowledge Base</title>

    <link href="/kb/static/css/main.f7633538c846.css" rel="stylesheet" type="text/css" />

    

    

    <!-- FB Open Graph tags -->
    <meta property="og:title" content="Query Cache" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://mariadb.com/kb/en/query-cache/" />
    <meta property="og:image" content="http://mariadb.comaskmonty-logo.png" />
    <meta property="og:site_name" content="MariaDB KnowledgeBase" />
    <meta property="fb:admins" content="514852603" />
    <meta property="og:description" content="Caching SELECT queries for better performance." />

    <meta name="description" content="Caching SELECT queries for better performance." />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet"/>
    
</head>
<body class="mpkb nodes products nodes_view jqui" id="nodes_view">





<div id="menu-mobile" class="visible-sm visible-xs">

    <div>
        <div id="mobile-close-menu" class="text-right">
            <a href="javascript:void(0)" title="Close Menu" id="back-main" class="toggle-menu">X<span></span></a>
        </div>
    </div>
    <div class="mainmenu-mobile">
        <ul class="ls-none ul-menu">
            <li data-sub="submenu5"><a class="open-form-search" href="/kb/search/" title="Search">Search </a></li>
            <li data-sub="submenu0"><a href="/products" title="Products">Products</a><span class="arrow-main"></span></li>
            <li data-sub="submenu1"><a href="/services" title="Services">Services</a><span class="arrow-main"></span></li>
            <li data-sub="submenu2"><a href="/resources" title="Resources">Resources</a><span class="arrow-main"></span></li>
            <li data-sub="submenu3"><a href="/about-us" title="About">About</a><span class="arrow-main"></span></li>
            <li data-sub="submenu4"><a href="/contact" title="Contact">Contact</a></li>
        </ul>
    </div>

    <div class="nav-top-mobile">
        <div class="select-box form">

            <ul class="inline-block-md mb-none top-nav">
                <li>

                </li>
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/query-cache/"> Login</a>
                    </li>
                
            </ul>



        </div>
        <p class="text-center copyright">Copyright &copy; 2024 MariaDB. All rights reserved.</p>
    </div>
</div>
<div class="violator-wrap d-none" id="top_violator">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12">
                <div class="violator-outer">
                    <div class="violator-inner">
                        <div class="row">
                            <div class="col-xs-12 col-sm-9 col-lg-7 col-lg-offset-2" id="top_violator_content">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="content-link" target="_blank" rel="nofollow noreferrer">
                                    <span>The Ultimate Guide to High Availability with MariaDB</span>
                                </a>
                            </div>
                            <div class="col-xs-12 col-sm-3" id="top_violator_cta">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="btn btn-mariadb" target="_blank" rel="nofollow noreferrer">Download Now</a>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-link close-btn">
                        <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24" width="15px" height="15px"><path d="M 4.9902344 3.9902344 A 1.0001 1.0001 0 0 0 4.2929688 5.7070312 L 10.585938 12 L 4.2929688 18.292969 A 1.0001 1.0001 0 1 0 5.7070312 19.707031 L 12 13.414062 L 18.292969 19.707031 A 1.0001 1.0001 0 1 0 19.707031 18.292969 L 13.414062 12 L 19.707031 5.7070312 A 1.0001 1.0001 0 0 0 18.980469 3.9902344 A 1.0001 1.0001 0 0 0 18.292969 4.2929688 L 12 10.585938 L 5.7070312 4.2929688 A 1.0001 1.0001 0 0 0 4.9902344 3.9902344 z"/></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="wrapper">
<div id="top-nav">
    <div class="container">
        <ul class="hidden-sm hidden-xs" >
            <li><a href="https://mariadb.com/kb/">Knowledge Base</a></li>
            <li><a href="https://mariadb.com/contact/">Contact</a></li>
            
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/query-cache/" rel="nofollow">Login</a>
                    </li>
                
            
            
            <li id="search-form">
                <form action="/kb/en/+search/" method="get" id="search-block-form" accept-charset="UTF-8">
                    <input id="search" title="Enter the terms you wish to search for."
                           placeholder="Search . . ." type="text"
                           name="q" value="" size="15" maxlength="128" class="form-text"
                           data-autocomplete-url="/kb/en/+search/autocomplete/">
                    <input type="hidden" name="quick" value="1" />
                    <input type="hidden" name="source" value="kb" />
                </form>
            </li>
            <li><a id="search-toggler" href="/kb/search/">Search</a></li>
            
        </ul>
    </div>
</div>
<div id="navbar-bottom" class="navbar">
    <div class="container">
        
        
        
        
        <div class="row">
            <div class="col-md-3 col-sm-9 col-xs-9">
                <a class="brand" href="/" title="MariaDB">
                    <img src="/kb/static/images/logo-2018-black.95f5978ae14d.png">
                </a>
            </div>
            <div class="col-md-9 hidden-sm hidden-xs">
                <div class="main-menu">
                    <ul id="main-menu" class="nav navbar-nav inline-block-sm">
    <li class="has-sub full-menu">
        <a href="/products" title="Products">Products</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/services" title="Services">Services</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/pricing" title="Pricing">Pricing</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/resources" title="Resources">Resources</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/about-us" title="About Us">About Us</a>
    </li>
    <li class="">
        <a class="button electric-eel small top-bar-right-download" href="/downloads/">Download</a>
    </li>
</ul>
                </div>
            </div>
            <div class="col-md-3 visible-sm visible-xs col-sm-3 col-xs-3 ps-rv">
                <div class="navbar-header text-right pull-right">
                    <button type="button" class="menu-control toggle-menu" id="open-menu">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="main">
    <div class="container">
        

        <div id="subheader1" class="clearfix">
            <div class="pull-left">
                
                <div id="breadcrumbs" class="breadcrumb">
                    <a href="/kb/en/">Knowledge Base</a>
                    


    
    » <a class="crumb" href="/kb/en/documentation/">MariaDB Server Documentation</a>
    

    
    » <a class="crumb" href="/kb/en/replication-cluster-multi-master/">High Availability &amp; Performance Tuning</a>
    

    
    » <a class="crumb" href="/kb/en/optimization-and-tuning/">Optimization and Tuning</a>
    

    
    » <a class="crumb" href="/kb/en/buffers-caches-and-threads/">Buffers, Caches and Threads</a>
    


    » <a class="node_link crumb" href="/kb/en/query-cache/">Query Cache</a>


                </div>
                
            </div>
        </div>
    </div>
    <div class="container" id="container-main">
        <div class="row">
            
            
                
                <aside id="sidebar-first" class="sidebar col-md-2 hidden-xs hidden-sm hidden-print">
                    
                        
                        <ul id="category_menu" class="nav nav-pills nav-stacked">
                            <li><a href="/kb/en/">Home</a></li>
                            
                                
                                    <li><a href="/kb/en/+questions/">Open Questions</a></li>
                                
                                <li><a href="/kb/en/documentation/">MariaDB Server</a></li>
                                <li><a href="/kb/en/maxscale/">MariaDB MaxScale</a></li>
                                <li><a href="/kb/en/mariadb-columnstore/">MariaDB ColumnStore</a></li>
                                <li><a href="/kb/en/connectors/">Connectors</a></li>
                            

                        </ul>
                    

                    
<div>



<div class="well well-small box actions"><div>

        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/query-cache/+history" rel="nofollow">History</a>
        
        
        
        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/query-cache/+source/">Source</a>
        
        <a class="btn btn-block btn-blue btn-sm flag" href="/kb/en/query-cache/+flag"
                data-flag-url="/kb/en/query-cache/+flag" rel="nofollow">
                Flag as Spam / Inappropriate</a>
        
        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/query-cache/+translate/">
                Translate</a>
        

</div>
</div>





<div class="well well-small box node_info"><div>

    <dl>
        <dt>Created</dt>
        <dd>

<span class="datetime" title="2013-04-13 21:59">11 years, 5 months ago</span></dd>

        <dt>Modified</dt>
        <dd>

<span class="datetime" title="2023-12-22 15:32">9 months, 1 week ago</span></dd>

        <dt>Type</dt>
        <dd>article</dd>

        <dt>Status</dt>
        <dd>active</dd>

        <dt>License</dt>
        <dd>
            
                <a href="/kb/en/query-cache/+license/">CC BY-SA / Gnu FDL</a>
            
        </dd>

        
    </dl>

    
    <ul class="rss_feeds">
        <li><a href="/kb/en/query-cache/+history/feed/">
            History</a>
        </li>
        <li><a href="/kb/en/query-cache/+comments/feed/">
            Comments</a>
        </li>
    </ul>
    

</div>
</div>





    
    
    

<div class="well well-small box attachments"><div><div class="edit_link pull-right"><a href="/kb/en/query-cache/+edit/attachments/">Edit</a></div><h5>Attachments</h5></div><div>

        
            <div class="no_data">No attachments exist</div>
        
    
</div>
</div>

    



    
    
        

<div class="well well-small box"><div><h5>Localized Versions</h5></div><div>

        <ul>
            
            <li><a href="/kb/it/the-query-cache/">La Query Cache</a> [it]</li>
            
        </ul>
        
</div>
</div>

    






</div>


                    

































                </aside>
            
            
            
                
            
            
                
            
            <section id="content" class="limited_width col-md-8 clearfix">
                
                    <h1>Query Cache</h1>
                

                



                <div>
                    
    

    
    
    

    <div class="node creole">
        
        
        


    
    <div class="answer formatted">
        <div class="table_of_contents well well-small">
<h3>Contents</h3>
 <ol class="toc">

    <li class=""><a href="#setting-up-the-query-cache" title="Setting Up the Query Cache">Setting Up the Query Cache</a></li>

    <li class=""><a href="#how-the-query-cache-works" title="How the Query Cache Works">How the Query Cache Works</a></li>

    <li class=""><a href="#queries-stored-in-the-query-cache" title="Queries Stored in the Query Cache">Queries Stored in the Query Cache</a></li>

    <li class=""><a href="#limiting-the-size-of-the-query-cache" title="Limiting the Size of the Query Cache">Limiting the Size of the Query Cache</a></li>

    <li class=""><a href="#examining-the-query-cache" title="Examining the Query Cache">Examining the Query Cache</a></li>

    <li class=""><a href="#query-cache-fragmentation" title="Query Cache Fragmentation">Query Cache Fragmentation</a></li>

    <li class=""><a href="#emptying-and-disabling-the-query-cache" title="Emptying and disabling the Query Cache">Emptying and disabling the Query Cache</a></li>

    <li class=""><a href="#limitations" title="Limitations">Limitations</a></li>

    <li class=""><a href="#lock-tables-and-the-query-cache" title="LOCK TABLES and the Query Cache">LOCK TABLES and the Query Cache</a></li>

    <li class=""><a href="#transactions-and-the-query-cache" title="Transactions and the Query Cache">Transactions and the Query Cache</a></li>

    <li class=""><a href="#query-cache-internal-structure" title="Query Cache Internal Structure">Query Cache Internal Structure</a></li>

    <li class=""><a href="#timeout-and-mutex-contention" title="Timeout and Mutex Contention">Timeout and Mutex Contention</a></li>

    <li class=""><a href="#sql_no_cache-and-sql_cache" title="SQL_NO_CACHE and SQL_CACHE">SQL_NO_CACHE and SQL_CACHE</a> </ol>
</li>
</div><p>
The query cache stores results of SELECT queries so that if the identical query is received in future, the results can be quickly returned.</p>
<p>This is extremely useful in high-read, low-write environments (such as most websites). It does not scale well in environments with high throughput on multi-core machines, so it is disabled by default.</p>
<div class="cstm-style redbox"><p>Note that the query cache cannot be enabled in certain environments. See <a href="#limitations">Limitations</a>.</p>
</div><h2 class="anchored_heading" id="setting-up-the-query-cache">Setting Up the Query Cache</h2>
<p>Unless MariaDB has been specifically built without the query cache, the query cache will always be available, although inactive. The <a href="/kb/en/server-system-variables/#have_query_cache">have_query_cache</a> server variable will show whether the query cache is available.</p>
<pre class="fixed"><span class="k">SHOW</span> <span class="n">VARIABLES</span> <span class="k">LIKE</span> <span class="s1">&#39;have_query_cache&#39;</span><span class="p">;</span>
<span class="o">+</span><span class="c1">------------------+-------+</span>
<span class="o">|</span> <span class="n">Variable_name</span>    <span class="o">|</span> <span class="n">Value</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">------------------+-------+</span>
<span class="o">|</span> <span class="n">have_query_cache</span> <span class="o">|</span> <span class="n">YES</span>   <span class="o">|</span>
<span class="o">+</span><span class="c1">------------------+-------+</span>
</pre><p>If this is set to <code>NO</code>, you cannot enable the query cache unless you rebuild or reinstall a version of MariaDB with the cache available.</p>
<p>To see if the cache is enabled, view the <a href="/kb/en/server-system-variables/#query_cache_type">query_cache_type</a> server variable. It is enabled by default in MariaDB versions up to 10.1.6, but disabled starting with <a href="/kb/en/mariadb-1017-release-notes/">MariaDB 10.1.7</a> - if needed enable it by setting <code>query_cache_type</code> to <code>1</code>.</p>
<p>Although enabled in versions prior to <a href="/kb/en/mariadb-1017-release-notes/">MariaDB 10.1.7</a>, the <a href="/kb/en/server-system-variables/#query_cache_size">query_cache_size</a> is by default 0KB there, which effectively disables the query cache. From 10.1.7 on the cache size defaults to 1MB. If needed set the cache to a size large enough amount, for example:</p>
<pre class="fixed"><span class="k">SET</span> <span class="k">GLOBAL</span> <span class="n">query_cache_size</span> <span class="o">=</span> <span class="mi">1000000</span><span class="p">;</span>
</pre><p>Starting from <a href="/kb/en/mariadb-1017-release-notes/">MariaDB 10.1.7</a>, <code>query_cache_type</code> is automatically set to ON if the server is started with the <code>query_cache_size</code> set to a non-zero (and non-default) value. </p>
<p>See <a href="#limiting-the-size-of-the-query-cache">Limiting the size of the Query Cache</a> below for details.</p>
<h2 class="anchored_heading" id="how-the-query-cache-works">How the Query Cache Works</h2>
<p>When the query cache is enabled and a new SELECT query is processed, the query cache is examined to see if the query appears in the cache. </p>
<p>Queries are considered identical if they use the same database, same protocol version and same default character set. Prepared statements are always considered as different to non-prepared statements, see <a href="#query-cache-internal-structure">Query cache internal structure</a> for more info.</p>
<p>If the identical query is not found in the cache, the query will be processed normally and then stored, along with its result set, in the query cache. If the query is found in the cache, the results will be pulled from the cache, which is much quicker than processing it normally.</p>
<p>Queries are examined in a case-sensitive manner, so :</p>
<pre class="fixed"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">t</span>
</pre><p>Is different from :</p>
<pre class="fixed"><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">t</span>
</pre><p>Comments are also considered and can make the queries differ, so :</p>
<pre class="fixed"><span class="cm">/* retry */</span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">t</span>
</pre><p>Is different from :</p>
<pre class="fixed"><span class="cm">/* retry2 */</span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">t</span>
</pre><p>See the <a href="/kb/en/server-system-variables/#query_cache_strip_comments">query_cache_strip_comments</a> server variable for an option to strip comments before searching. </p>
<p>Each time changes are made to the data in a table, all affected results in the query cache are cleared. It is not possible to retrieve stale data from the query cache.</p>
<p>When the space allocated to query cache is exhausted, the oldest results will be dropped from the cache.</p>
<p>When using <code>query_cache_type=ON</code>, and the query specifies <code>SQL_NO_CACHE</code> (case-insensitive), the server will not cache the query and will not fetch results from the query cache.</p>
<p>When using <code>query_cache_type=DEMAND</code> (after <a href="https://jira.mariadb.org/browse/MDEV-6631">MDEV-6631</a> feature request) and the query specifies <code>SQL_CACHE</code>, the server will cache the query.</p>
<p>One important point of <a href="https://jira.mariadb.org/browse/MDEV-6631">MDEV-6631</a> is : switching between <code>query_cache_type=ON</code> and <code>query_cache_type=DEMAND</code> can "turn off" query cache of old queries without the <code>SQL_CACHE</code> string, that's not yet defined if we should include another <code>query_cache_type</code> (DEMAND_NO_PRUNE) value or not to allow use of old queries</p>
<h2 class="anchored_heading" id="queries-stored-in-the-query-cache">Queries Stored in the Query Cache</h2>
<p>If the <a href="/kb/en/server-system-variables/#query_cache_type">query_cache_type</a> system variable is set to <code>1</code>, or <code>ON</code>, all queries fitting the size constraints will be stored in the cache unless they contain a <code>SQL_NO_CACHE</code> clause, or are of a nature that caching makes no sense, for example making use of a function that returns the current time. Queries with <code>SQL_NO_CACHE</code> will not attempt to acquire query cache lock.</p>
<p>If any of the following functions are present in a query, it will not be cached. Queries with these functions are sometimes called 'non-deterministic' - don't get confused with the use of this term in other contexts.</p>
<div class="cstm-style table-class"><table><tr><td><a href="/kb/en/benchmark/">BENCHMARK()</a></td><td><a href="/kb/en/connection_id/">CONNECTION_ID()</a></td></tr>
<tr><td><a href="/kb/en/convert_tz/">CONVERT_TZ()</a></td><td><a href="/kb/en/curdate/">CURDATE()</a></td></tr>
<tr><td><a href="/kb/en/current_date/">CURRENT_DATE()</a></td><td><a href="/kb/en/current_time/">CURRENT_TIME()</a></td></tr>
<tr><td><a href="/kb/en/current_timestamp/">CURRENT_TIMESTAMP()</a></td><td><a href="/kb/en/curtime/">CURTIME()</a></td></tr>
<tr><td><a href="/kb/en/database/">DATABASE()</a></td><td><a href="/kb/en/encrypt/">ENCRYPT()</a> (one parameter)</td></tr>
<tr><td><a href="/kb/en/found_rows/">FOUND_ROWS()</a></td><td><a href="/kb/en/get_lock/">GET_LOCK()</a></td></tr>
<tr><td><a href="/kb/en/last_insert_id/">LAST_INSERT_ID()</a></td><td><a href="/kb/en/load_file/">LOAD_FILE()</a></td></tr>
<tr><td><a href="/kb/en/master_pos_wait/">MASTER_POS_WAIT()</a></td><td><a href="/kb/en/now/">NOW()</a></td></tr>
<tr><td><a href="/kb/en/rand/">RAND()</a></td><td><a href="/kb/en/release_lock/">RELEASE_LOCK()</a></td></tr>
<tr><td><a href="/kb/en/sleep/">SLEEP()</a></td><td><a href="/kb/en/sysdate/">SYSDATE()</a></td></tr>
<tr><td><a href="/kb/en/unix_timestamp/">UNIX_TIMESTAMP()</a> (no parameters)</td><td><a href="/kb/en/user/">USER()</a></td></tr>
<tr><td><a href="/kb/en/uuid/">UUID()</a></td><td><a href="/kb/en/uuid_short/">UUID_SHORT()</a></td></tr>
</table>
</div><p>A query will also not be added to the cache if:</p>
<ul start="1"><li>It is of the form:
<ul start="1"><li>SELECT SQL_NO_CACHE ...
</li><li>SELECT ... INTO OUTFILE ...
</li><li>SELECT ... INTO DUMPFILE ...
</li><li>SELECT ... FOR UPDATE
</li><li>SELECT * FROM ... WHERE autoincrement_column IS NULL
</li><li>SELECT ... LOCK IN SHARE MODE
</li></ul>
</li><li>It uses TEMPORARY table
</li><li>It uses no tables at all
</li><li>It generates a warning
</li><li>The user has a column-level privilege on any table in the query
</li><li>It accesses a table from INFORMATION_SCHEMA, mysql or the performance_schema database
</li><li>It makes use of user or local variables
</li><li>It makes use of stored functions
</li><li>It makes use of user-defined functions
</li><li>It is inside a transaction with the SERIALIZABLE isolation level
</li><li>It is quering a table inside a transaction after the same table executed a query cache invalidation using INSERT, UPDATE or DELETE
</li></ul>
<p>The query itself can also specify that it is not to be stored in the cache by using the <code>SQL_NO_CACHE</code> attribute. Query-level control is an effective way to use the cache more optimally.</p>
<p>It is also possible to specify that <em>no</em> queries must be stored in the cache unless the query requires it. To do this, the <a href="/kb/en/server-system-variables/#query_cache_type">query_cache_type</a> server variable must be set to <code>2</code>, or <code>DEMAND</code>. Then, only queries with the <code>SQL_CACHE</code> attribute are cached.</p>
<h2 class="anchored_heading" id="limiting-the-size-of-the-query-cache">Limiting the Size of the Query Cache</h2>
<p>There are two main ways to limit the size of the query cache. First, the overall size in bytes is determined by the <a href="/kb/en/server-system-variables/#query_cache_size">query_cache_size</a> server variable. About 40KB is needed for various query cache structures.</p>
<p>The query cache size is allocated in 1024 byte-blocks, thus it should be set to a multiple of 1024. </p>
<p>The query result is stored using a minimum block size of <a href="/kb/en/server-system-variables/#query_cache_min_res_unit">query_cache_min_res_unit</a>. Check two conditions to use a good value of this variable: Query cache insert result blocks with locks, each new block insert lock query cache, a small value will increase locks and fragmentation and waste less memory for small results, a big value will increase memory use wasting more memory for small results but it reduce locks. Test with your workload for fine tune this variable.</p>
<p>If the <a href="/kb/en/sql-mode/">strict mode</a> is enabled, setting the query cache size to an invalid value will cause an error. Otherwise, it will be set to the nearest permitted value, and a warning will be triggered.</p>
<pre class="fixed"><span class="k">SHOW</span> <span class="n">VARIABLES</span> <span class="k">LIKE</span> <span class="s1">&#39;query_cache_size&#39;</span><span class="p">;</span>
<span class="o">+</span><span class="c1">------------------+----------+</span>
<span class="o">|</span> <span class="n">Variable_name</span>    <span class="o">|</span> <span class="n">Value</span>    <span class="o">|</span>
<span class="o">+</span><span class="c1">------------------+----------+</span>
<span class="o">|</span> <span class="n">query_cache_size</span> <span class="o">|</span> <span class="mi">67108864</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">------------------+----------+</span>

<span class="k">SET</span> <span class="k">GLOBAL</span> <span class="n">query_cache_size</span> <span class="o">=</span> <span class="mi">8000000</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="k">rows</span> <span class="n">affected</span><span class="p">,</span> <span class="mi">1</span> <span class="n">warning</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">03</span> <span class="n">sec</span><span class="p">)</span>

<span class="k">SHOW</span> <span class="n">VARIABLES</span> <span class="k">LIKE</span> <span class="s1">&#39;query_cache_size&#39;</span><span class="p">;</span>
<span class="o">+</span><span class="c1">------------------+---------+</span>
<span class="o">|</span> <span class="n">Variable_name</span>    <span class="o">|</span> <span class="n">Value</span>   <span class="o">|</span>
<span class="o">+</span><span class="c1">------------------+---------+</span>
<span class="o">|</span> <span class="n">query_cache_size</span> <span class="o">|</span> <span class="mi">7999488</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">------------------+---------+</span>
</pre><p>The ideal size of the query cache is very dependent on the specific needs of each system. Setting a value too small will result in query results being dropped from the cache when they could potentially be re-used later. Setting a value too high could result in reduced performance due to lock contention, as the query cache is locked during updates.</p>
<p>The second way to limit the cache is to have a maximum size for each set of query results. This prevents a single query with a huge result set taking up most of the available memory and knocking a large number of smaller queries out of the cache. This is determined by the <a href="/kb/en/server-system-variables/#query_cache_limit">query_cache_limit</a> server variable.</p>
<p>If you attempt to set a query cache that is too small (the amount depends on the architecture), the resizing will fail and the query cache will be set to zero, for example :</p>
<pre class="fixed wrap"><span class="k">SET</span> <span class="k">GLOBAL</span> <span class="n">query_cache_size</span><span class="o">=</span><span class="mi">40000</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="k">rows</span> <span class="n">affected</span><span class="p">,</span> <span class="mi">2</span> <span class="n">warnings</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">03</span> <span class="n">sec</span><span class="p">)</span>

<span class="k">SHOW</span> <span class="n">WARNINGS</span><span class="p">;</span>
<span class="o">+</span><span class="c1">---------+------+-----------------------------------------------------------------+</span>
<span class="o">|</span> <span class="k">Level</span>   <span class="o">|</span> <span class="n">Code</span> <span class="o">|</span> <span class="n">Message</span>                                                         <span class="o">|</span>
<span class="o">+</span><span class="c1">---------+------+-----------------------------------------------------------------+</span>
<span class="o">|</span> <span class="n">Warning</span> <span class="o">|</span> <span class="mi">1292</span> <span class="o">|</span> <span class="n">Truncated</span> <span class="n">incorrect</span> <span class="n">query_cache_size</span> <span class="n">value</span><span class="p">:</span> <span class="s1">&#39;40000&#39;</span>             <span class="o">|</span>
<span class="o">|</span> <span class="n">Warning</span> <span class="o">|</span> <span class="mi">1282</span> <span class="o">|</span> <span class="n">Query</span> <span class="k">cache</span> <span class="n">failed</span> <span class="k">to</span> <span class="k">set</span> <span class="k">size</span> <span class="mi">39936</span><span class="p">;</span> <span class="k">new</span> <span class="n">query</span> <span class="k">cache</span> <span class="k">size</span> <span class="k">is</span> <span class="mi">0</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">---------+------+-----------------------------------------------------------------+</span>
</pre><h2 class="anchored_heading" id="examining-the-query-cache">Examining the Query Cache</h2>
<p>A number of status variables provide information about the query cache.</p>
<pre class="fixed"><span class="k">SHOW</span> <span class="n">STATUS</span> <span class="k">LIKE</span> <span class="s1">&#39;Qcache%&#39;</span><span class="p">;</span>
<span class="o">+</span><span class="c1">-------------------------+----------+</span>
<span class="o">|</span> <span class="n">Variable_name</span>           <span class="o">|</span> <span class="n">Value</span>    <span class="o">|</span>
<span class="o">+</span><span class="c1">-------------------------+----------+</span>
<span class="o">|</span> <span class="n">Qcache_free_blocks</span>      <span class="o">|</span> <span class="mi">1158</span>     <span class="o">|</span>
<span class="o">|</span> <span class="n">Qcache_free_memory</span>      <span class="o">|</span> <span class="mi">3760784</span>  <span class="o">|</span>
<span class="o">|</span> <span class="n">Qcache_hits</span>             <span class="o">|</span> <span class="mi">31943398</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Qcache_inserts</span>          <span class="o">|</span> <span class="mi">42998029</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Qcache_lowmem_prunes</span>    <span class="o">|</span> <span class="mi">34695322</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Qcache_not_cached</span>       <span class="o">|</span> <span class="mi">652482</span>   <span class="o">|</span>
<span class="o">|</span> <span class="n">Qcache_queries_in_cache</span> <span class="o">|</span> <span class="mi">4628</span>     <span class="o">|</span>
<span class="o">|</span> <span class="n">Qcache_total_blocks</span>     <span class="o">|</span> <span class="mi">11123</span>    <span class="o">|</span>
<span class="o">+</span><span class="c1">-------------------------+----------+</span>
</pre><p><code>Qcache_inserts</code> contains the number of queries added to the query cache, <code>Qcache_hits</code> contains the number of queries that have made use of the query cache, while <code>Qcache_lowmem_prunes</code> contains the number of queries that were dropped from the cache due to lack of memory.</p>
<p>The above example could indicate a poorly performing cache. More queries have been added, and more queries have been dropped, than have actually been used.</p>
<p>Note that before <a href="/kb/en/what-is-mariadb-55/">MariaDB 5.5</a>, queries returned from the query cache did not increment the <a href="/kb/en/server-status-variables/#com_select">Com_select</a> status variable, so to find the total number of valid queries run on the server, add <a href="/kb/en/server-status-variables/#com_select">Com_select</a> to <a href="/kb/en/server-status-variables/#qcache_hits">Qcache_hits</a>. Starting from <a href="/kb/en/what-is-mariadb-55/">MariaDB 5.5</a>, results returned by the query cache count towards <code>Com_select</code> (see <a href="https://jira.mariadb.org/browse/MDEV-4981">MDEV-4981</a>).</p>
<p>The <a href="/kb/en/query_cache_info-plugin/">QUERY_CACHE_INFO plugin</a> creates the <a href="/kb/en/information-schema-query_cache_info-table/">QUERY_CACHE_INFO</a>  table in the <a href="/kb/en/information_schema/">INFORMATION_SCHEMA</a>, allowing you to examine the contents of the query cache.</p>
<h2 class="anchored_heading" id="query-cache-fragmentation">Query Cache Fragmentation</h2>
<p>The Query Cache uses blocks of variable length, and over time may become fragmented. A high <code>Qcache_free_blocks</code> relative to <code>Qcache_total_blocks</code> may indicate fragmentation. <a href="/kb/en/flush-query-cache/">FLUSH QUERY CACHE</a> will defragment the query cache without dropping any queries :</p>
<pre class="fixed"><span class="n">FLUSH</span> <span class="n">QUERY</span> <span class="k">CACHE</span><span class="p">;</span>
</pre><p>After this, there will only be one free block :</p>
<pre class="fixed"><span class="k">SHOW</span> <span class="n">STATUS</span> <span class="k">LIKE</span> <span class="s1">&#39;Qcache%&#39;</span><span class="p">;</span>
<span class="o">+</span><span class="c1">-------------------------+----------+</span>
<span class="o">|</span> <span class="n">Variable_name</span>           <span class="o">|</span> <span class="n">Value</span>    <span class="o">|</span>
<span class="o">+</span><span class="c1">-------------------------+----------+</span>
<span class="o">|</span> <span class="n">Qcache_free_blocks</span>      <span class="o">|</span> <span class="mi">1</span>        <span class="o">|</span>
<span class="o">|</span> <span class="n">Qcache_free_memory</span>      <span class="o">|</span> <span class="mi">6101576</span>  <span class="o">|</span>
<span class="o">|</span> <span class="n">Qcache_hits</span>             <span class="o">|</span> <span class="mi">31981126</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Qcache_inserts</span>          <span class="o">|</span> <span class="mi">43002404</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Qcache_lowmem_prunes</span>    <span class="o">|</span> <span class="mi">34696486</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">Qcache_not_cached</span>       <span class="o">|</span> <span class="mi">655607</span>   <span class="o">|</span>
<span class="o">|</span> <span class="n">Qcache_queries_in_cache</span> <span class="o">|</span> <span class="mi">4197</span>     <span class="o">|</span>
<span class="o">|</span> <span class="n">Qcache_total_blocks</span>     <span class="o">|</span> <span class="mi">8833</span>     <span class="o">|</span>
<span class="o">+</span><span class="c1">-------------------------+----------+</span>
</pre><h2 class="anchored_heading" id="emptying-and-disabling-the-query-cache">Emptying and disabling the Query Cache</h2>
<p>To empty or clear all results from the query cache, use <a href="/kb/en/reset/">RESET QUERY CACHE</a>. <a href="/kb/en/flush/">FLUSH TABLES</a> will have the same effect.</p>
<p>Setting either <a href="/kb/en/server-system-variables/#query_cache_type">query_cache_type</a> or <a href="/kb/en/server-system-variables/#query_cache_size">query_cache_size</a> to <code>0</code> will disable the query cache, but to free up the most resources, set both to <code>0</code> when you wish to disable caching.</p>
<h2 class="anchored_heading" id="limitations">Limitations</h2>
<ul start="1"><li>The query cache needs to be disabled in order to use <a href="/kb/en/oqgraph/">OQGRAPH</a>.
</li><li>The query cache is not used by the <a href="/kb/en/spider/">Spider</a> storage engine (amongst others).
</li><li>The query cache also needs to be disabled for MariaDB <a href="/kb/en/galera/">Galera</a> cluster versions prior to "5.5.40-galera", "10.0.14-galera" and "10.1.2".
</li></ul>
<h2 class="anchored_heading" id="lock-tables-and-the-query-cache">LOCK TABLES and the Query Cache</h2>
<p>The query cache can be used when tables have a write lock (which may seem confusing since write locks should avoid table reads). This behaviour can be changed by setting the <a href="/kb/en/server-system-variables/#query_cache_wlock_invalidate">query_cache_wlock_invalidate</a> system variable to <code>ON</code>, in which case each write lock will invalidate the table query cache. Setting to <code>OFF</code>, the default, means that cached queries can be returned even when a table lock is being held. For example:</p>
<pre class="fixed"><span class="mi">1</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">T1</span>
<span class="o">+</span><span class="c1">---+</span>
<span class="o">|</span> <span class="n">a</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">---+</span>
<span class="o">|</span> <span class="mi">1</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">---+</span>
<span class="c1">-- Here the query is cached</span>

<span class="c1">-- From another connection execute:</span>
<span class="mi">2</span><span class="o">&gt;</span> <span class="k">LOCK</span> <span class="n">TABLES</span> <span class="n">T1</span> <span class="k">WRITE</span><span class="p">;</span>

<span class="c1">-- Expected result with: query_cache_wlock_invalidate = OFF</span>
<span class="mi">1</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">T1</span>
<span class="o">+</span><span class="c1">---+</span>
<span class="o">|</span> <span class="n">a</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">---+</span>
<span class="o">|</span> <span class="mi">1</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">---+</span>
<span class="c1">-- read from query cache</span>


<span class="c1">-- Expected result with: query_cache_wlock_invalidate = ON</span>
<span class="mi">1</span><span class="o">&gt;</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">T1</span>
<span class="c1">-- Waiting Table Write Lock</span>
</pre><h2 class="anchored_heading" id="transactions-and-the-query-cache">Transactions and the Query Cache</h2>
<p>The query cache handles transactions. Internally a flag (FLAGS_IN_TRANS) is set to 0 when a query was executed outside a transaction, and to 1 when the query was inside a transaction (<a href="begin">BEGIN</a> / <a href="/kb/en/commit/">COMMIT</a> / <a href="/kb/en/rollback/">ROLLBACK</a>). This flag is part of the "query cache hash", in others words one query inside a transaction is different from a query outside a transaction. </p>
<p>Queries that change rows (<a href="/kb/en/insert/">INSERT</a> / <a href="/kb/en/update/">UPDATE</a> / <a href="/kb/en/delete/">DELETE</a> / <a href="/kb/en/truncate/">TRUNCATE</a>) inside a transaction will invalidate all queries from the table, and turn off the query cache to the changed table. Transactions that don't end with COMMIT / ROLLBACK check that even without COMMIT / ROLLBACK, the query cache is turned off to allow row level locking and consistency level.</p>
<p>Examples:</p>
<pre class="fixed"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">T1</span> <span class="o">&lt;</span><span class="k">first</span> <span class="k">insert</span> <span class="k">to</span> <span class="n">query</span> <span class="k">cache</span><span class="p">,</span> <span class="k">using</span> <span class="n">FLAGS_IN_TRANS</span><span class="o">=</span><span class="mi">0</span><span class="o">&gt;</span>
<span class="o">+</span><span class="c1">---+</span>
<span class="o">|</span> <span class="n">a</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">---+</span>
<span class="o">|</span> <span class="mi">1</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">---+</span>
</pre><pre class="fixed"><span class="k">BEGIN</span><span class="p">;</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">T1</span> <span class="o">&lt;</span><span class="k">first</span> <span class="k">insert</span> <span class="k">to</span> <span class="n">query</span> <span class="k">cache</span><span class="p">,</span> <span class="k">using</span> <span class="n">FLAGS_IN_TRANS</span><span class="o">=</span><span class="mi">1</span><span class="o">&gt;</span>
<span class="o">+</span><span class="c1">---+</span>
<span class="o">|</span> <span class="n">a</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">---+</span>
<span class="o">|</span> <span class="mi">1</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">---+</span>
</pre><pre class="fixed"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">T1</span> <span class="o">&lt;</span><span class="k">result</span> <span class="k">from</span> <span class="n">query</span> <span class="k">cache</span><span class="p">,</span> <span class="k">using</span> <span class="n">FLAGS_IN_TRANS</span><span class="o">=</span><span class="mi">1</span><span class="o">&gt;</span>
<span class="o">+</span><span class="c1">---+</span>
<span class="o">|</span> <span class="n">a</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">---+</span>
<span class="o">|</span> <span class="mi">1</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">---+</span>
</pre><pre class="fixed wrap"><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">T1</span> <span class="k">VALUES</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>  <span class="o">&lt;</span><span class="n">invalidate</span> <span class="n">queries</span> <span class="k">from</span> <span class="k">table</span> <span class="n">T1</span> <span class="k">and</span> <span class="n">disable</span> <span class="n">query</span> <span class="k">cache</span> <span class="k">to</span> <span class="k">table</span> <span class="n">T1</span><span class="o">&gt;</span>
</pre><pre class="fixed">SELECT * FROM T1 &lt;don't use query cache, a normal query from innodb table&gt;
+---+
| a |
+---+
| 1 |
| 2 |
+---+
</pre><pre class="fixed">SELECT * FROM T1 &lt;don't use query cache, a normal query from innodb table&gt;
+---+
| a |
+---+
| 1 |
| 2 |
+---+
</pre><pre class="fixed"><span class="k">COMMIT</span><span class="p">;</span>  <span class="o">&lt;</span><span class="n">query</span> <span class="k">cache</span> <span class="k">is</span> <span class="n">now</span> <span class="n">turned</span> <span class="k">on</span> <span class="k">to</span> <span class="n">T1</span> <span class="k">table</span><span class="o">&gt;</span>
</pre><pre class="fixed"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">T1</span> <span class="o">&lt;</span><span class="k">first</span> <span class="k">insert</span> <span class="k">to</span> <span class="n">query</span> <span class="k">cache</span><span class="p">,</span> <span class="k">using</span> <span class="n">FLAGS_IN_TRANS</span><span class="o">=</span><span class="mi">0</span><span class="o">&gt;</span>
<span class="o">+</span><span class="c1">---+</span>
<span class="o">|</span> <span class="n">a</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">---+</span>
<span class="o">|</span> <span class="mi">1</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">---+</span>
</pre><pre class="fixed"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">T1</span> <span class="o">&lt;</span><span class="k">result</span> <span class="k">from</span> <span class="n">query</span> <span class="k">cache</span><span class="p">,</span> <span class="k">using</span> <span class="n">FLAGS_IN_TRANS</span><span class="o">=</span><span class="mi">0</span><span class="o">&gt;</span>
<span class="o">+</span><span class="c1">---+</span>
<span class="o">|</span> <span class="n">a</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">---+</span>
<span class="o">|</span> <span class="mi">1</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">---+</span>
</pre><h2 class="anchored_heading" id="query-cache-internal-structure">Query Cache Internal Structure</h2>
<p>Internally, each flag that can change a result using the same query is a different query. For example, using the latin1 charset and using the utf8 charset with the same query are treated as different queries by the query cache. </p>
<p>Some fields that differentiate queries are (from "Query_cache_query_flags" internal structure) :</p>
<ul start="1"><li>query (string)
</li><li>current database schema name (string)
</li><li>client long flag (0/1)
</li><li>client protocol 4.1 (0/1)
</li><li>protocol type (internal value)
</li><li>more results exists (protocol flag)
</li><li>in trans (inside transaction or not)
</li><li>autocommit (<a href="/kb/en/server-system-variables/#autocommit">autocommit</a> session variable)
</li><li>pkt_nr (protocol flag)
</li><li>character set client (<a href="/kb/en/server-system-variables/#character_set_client">character_set_client</a> session variable)
</li><li>character set results (<a href="/kb/en/server-system-variables/#character_set_results">character_set_results</a> session variable)
</li><li>collation connection (<a href="/kb/en/server-system-variables/#collation_connection">collation_connection</a> session variable)
</li><li>limit (<a href="/kb/en/server-system-variables/#sql_select_limit">sql_select_limit</a> session variable)
</li><li>time zone (<a href="/kb/en/server-system-variables/#time_zone">time_zone</a> session variable)
</li><li>sql_mode (<a href="/kb/en/server-system-variables/#sql_mode">sql_mode</a> session variable)
</li><li>max_sort_length (<a href="/kb/en/server-system-variables/#max_sort_length">max_sort_length</a> session variable)
</li><li>group_concat_max_len (<a href="/kb/en/server-system-variables/#group_concat_max_len">group_concat_max_len</a> session variable)
</li><li>default_week_format (<a href="/kb/en/server-system-variables/#default_week_format">default_week_format</a> session variable)
</li><li>div_precision_increment (<a href="/kb/en/server-system-variables/#div_precision_increment">div_precision_increment</a> session variable)
</li><li>lc_time_names  (<a href="/kb/en/server-system-variables/#lc_time_names">lc_time_names</a> session variable)
</li></ul>
<p>More information can be found by viewing the source code (<a href="/kb/en/what-is-mariadb-101/">MariaDB 10.1</a>) :</p>
<ul><li><a href="https://github.com/MariaDB/server/blob/10.1/sql/sql_cache.cc">https://github.com/MariaDB/server/blob/10.1/sql/sql_cache.cc</a>
</li><li><a href="https://github.com/MariaDB/server/blob/10.1/sql/sql_cache.h">https://github.com/MariaDB/server/blob/10.1/sql/sql_cache.h</a>
</li></ul>
<h2 class="anchored_heading" id="timeout-and-mutex-contention">Timeout and Mutex Contention</h2>
<p>When searching for a query inside the query cache, a try_lock function waits with a timeout of 50ms. If the lock fails, the query isn't executed via the query cache. This timeout is hard coded (<a href="https://jira.mariadb.org/browse/MDEV-6766">MDEV-6766</a> include two variables to tune this timeout).</p>
<p>From the sql_cache.cc, function "try_lock" using TIMEOUT :</p>
<pre class="fixed">        struct timespec waittime;
        set_timespec_nsec(waittime,(ulong)(50000000L));  /* Wait for 50 msec */
        int res= mysql_cond_timedwait(&amp;COND_cache_status_changed,
                                      &amp;structure_guard_mutex, &amp;waittime);
        if (res == ETIMEDOUT)
          break;
</pre><p>When inserting a query inside the query cache or aborting a query cache insert (using the <a href="/kb/en/kill/">KILL</a> command for example), a try_lock function waits until the query cache returns; no timeout is used in this case.</p>
<p>When two processes execute the same query, only the last process stores the query result. All other processes increase the <a href="/kb/en/server-status-variables/#qcache_not_cached">Qcache_not_cached</a> status variable.</p>
<h2 class="anchored_heading" id="sql_no_cache-and-sql_cache">SQL_NO_CACHE and SQL_CACHE</h2>
<p>There are two aspects to the query cache: placing a query in the cache, and retrieving it from the cache.</p>
<ol start="1"><li>Adding a query to the query cache. This is done automatically for cacheable queries (see (<a href="#queries-stored-in-the-query-cache">Queries Stored in the Query Cache</a>) when the <a href="/kb/en/server-system-variables/#query_cache_type">query_cache_type</a> system variable is set to <code>1</code>, or <code>ON</code> and the query contains no SQL_NO_CACHE clause, or when the <a href="/kb/en/server-system-variables/#query_cache_type">query_cache_type</a> system variable is set to <code>2</code>, or <code>DEMAND</code>, and the query contains the SQL_CACHE clause.
</li><li>Retrieving a query from the cache. This is done after the server receives the query and before the query parser. In this case one point should be considered: 
</li></ol>
<p>When using SQL_NO_CACHE, it should be after the first SELECT hint, for example :</p>
<pre class="fixed"><span class="k">SELECT</span> <span class="n">SQL_NO_CACHE</span> <span class="p">....</span> <span class="k">FROM</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">SQL_CACHE</span> <span class="p">...)</span> <span class="k">AS</span> <span class="n">temp_table</span> 
</pre><p>instead of</p>
<pre class="fixed"><span class="k">SELECT</span> <span class="n">SQL_CACHE</span> <span class="p">....</span> <span class="k">FROM</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">SQL_NO_CACHE</span> <span class="p">...)</span> <span class="k">AS</span> <span class="n">temp_table</span> 
</pre><p>The second query will be checked. The query cache only checks if SQL_NO_CACHE/SQL_CACHE exists after the first SELECT. (More info at <a href="https://jira.mariadb.org/browse/MDEV-6631">MDEV-6631</a>)</p>

    </div>


        
            <div id="subscribe" class="well well-small hide hidden-print"
                 data-subscribe-url="/kb/en/query-cache/+subscriptions/add"
                 data-unsubscribe-url="/kb/en/query-cache/+subscriptions/remove">
            </div>
        

        
        
    
        <div class="simple_section_nav">
            <ul class="nav nav-pills">
                
                    <li><a href="/kb/en/innodb-change-buffering/">
                        ← InnoDB Change Buffering
                    </a>
                    </li>
                
                
                    <li><a href="/kb/en/buffers-caches-and-threads/">
                        ↑ Buffers, Caches and Threads ↑
                    </a>
                    </li>
                
                
                    <li class="pull-right"><a href="/kb/en/segmented-key-cache/">
                        Segmented Key Cache →
                    </a>
                    </li>
                
            </ul>
        </div>
    

        

        
        <h2>Comments</h2>
        
    
    <div id="comments" data-node-id="3326" data-comments-url="/kb/en/query-cache/+comments"
         data-reply-url="/kb/en/query-cache/comments/post/">
        Comments loading...
    </div>

        

    </div>


                    <div id="content_disclaimer" class="graybox">
                        Content reproduced on this site is the property of its respective owners,
                        and this content is not reviewed in advance by MariaDB. The views, information and opinions
                        expressed by this content do not necessarily represent those of MariaDB or any other party.
                    </div>
                </div>
            </section>

            
                <div id="right_bar" class="col-md-2">
                    
    
        
        <ul class="section_navigation well well-small hidden-xs hidden-sm">
            
                <li class="parent"><a href="/kb/en/buffers-caches-and-threads/">
                    ↑ Buffers, Caches and Threads ↑
                </a>
                </li>
            
            
                
                    <li>
                        <a href="/kb/en/thread-pool/">
                            
                            Thread Pool
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/thread-states/">
                            
                            Thread States
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/innodb-buffer-pool/">
                            <span class="pull-right not_primary"></span>
                            InnoDB Buffer Pool
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/innodb-change-buffering/">
                            <span class="pull-right not_primary"></span>
                            InnoDB Change Buffering
                        </a>
                    </li>
                
            
                
                    <li class="active">
                        <span>Query Cache</span>
                        
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/segmented-key-cache/">
                            <span class="pull-right not_primary"></span>
                            Segmented Key Cache
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/subquery-cache/">
                            <span class="pull-right not_primary"></span>
                            Subquery Cache
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/thread-command-values/">
                            
                            Thread Command Values
                        </a>
                    </li>
                
            
        </ul>
    
    

                </div>
            
        </div>
    </div>
</div>

<!-- Footer -->
<footer id="footer">
    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-xs-12">
                    <ul class="list-inline text-center footer-nav">
                        <li>
                            <h5>
                                <a href="https://mariadb.com/products" title="Products">Products</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/services" title="Services">Services</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/pricing" title="Pricing">Pricing</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/resources" title="Resources">Resources</a>
                            </h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/about-us" title="About MariaDB">About Us</a></h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/download" title="Download">Download MariaDB</a></h5>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="row row-10">
                
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div id="block-footerformcontact" class="block block-block-content block-block-contentd754ee1b-3cc9-40e7-9ef4-f504f1197fb1">
                        
                            <h5 style="font-weight: 400;">Subscribe to our newsletter!</h5>
                            <script src="//app-sj15.marketo.com/js/forms2/js/forms2.min.js"></script><form id="mktoForm_1498"></form>
                            <script>
                                <!--//--><![CDATA[// ><!--
                                MktoForms2.loadForm("//app-sj15.marketo.com", "573-PXI-984", 1498);
                                //--><!]]]]><![CDATA[>
                                //--><!]]>
                            </script>
                        
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div class="footer-copyright">
                        <div class="text-center">
                            <ul class="list-inline no-margin">
                                <li>
                                    <a href="/legal" title="Legal">Legal</a>
                                </li>
                                <li>
                                    <a href="/privacy-policy" title="Privacy Policy">Privacy Policy</a>
                                </li>
                                <li>
                                    <a href="/cookie-policy/" title="Cookies">Cookie Policy</a>
                                </li>
                            </ul>
                            <p>Copyright &copy; 2024 MariaDB. All rights reserved.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</footer>
</div>

<div id="ajax_loading">
    <img src="/kb/static/images/ajax-loader.a51c5608d01a.gif" />
</div>

    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MK2847"
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MK2847');</script>
    <!-- End Google Tag Manager -->

</body>

<script type="text/javascript" src="/kb/static/js/main.1587e3a666fc.js" charset="utf-8"></script>

</html>