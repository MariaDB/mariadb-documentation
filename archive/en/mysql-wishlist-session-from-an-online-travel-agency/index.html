<!DOCTYPE html>
<html>
<head data-cookie-domain=""
      data-cookie-path="/">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="apple-touch-icon" sizes="180x180" href="/kb/static/images/favicons/apple-touch-icon.159e713979be.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/kb/static/images/favicons/favicon-32x32.bc0ac1d5d11e.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/kb/static/images/favicons/favicon-16x16.5801f8f0f34e.png">
    <link rel="shortcut icon" href="/kb/static/images/favicons/favicon.d122d305dee4.ico" type="image/x-icon" />

    <title>MySQL &#34;Wishlist&#34; Session from an online travel agency - MariaDB Knowledge Base</title>

    <link href="/kb/static/css/main.f7633538c846.css" rel="stylesheet" type="text/css" />

    

    

    <!-- FB Open Graph tags -->
    <meta property="og:title" content="MySQL &#34;Wishlist&#34; Session from an online travel agency" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://mariadb.com/kb/en/mysql-wishlist-session-from-an-online-travel-agency/" />
    <meta property="og:image" content="http://mariadb.comaskmonty-logo.png" />
    <meta property="og:site_name" content="MariaDB KnowledgeBase" />
    <meta property="fb:admins" content="514852603" />
    <meta property="og:description" content="Currently critical issues
DROP TABLE is slow
When dropping a partitioned table using the compressed InnoDB storage engine, we have experienced this to be very slow in some cas..." />

    <meta name="description" content="Currently critical issues
DROP TABLE is slow
When dropping a partitioned table using the compressed InnoDB storage engine, we have experienced this to be very slow in some cas..." />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet"/>
    
</head>
<body class="mpkb nodes products nodes_view jqui" id="nodes_view">





<div id="menu-mobile" class="visible-sm visible-xs">

    <div>
        <div id="mobile-close-menu" class="text-right">
            <a href="javascript:void(0)" title="Close Menu" id="back-main" class="toggle-menu">X<span></span></a>
        </div>
    </div>
    <div class="mainmenu-mobile">
        <ul class="ls-none ul-menu">
            <li data-sub="submenu5"><a class="open-form-search" href="/kb/search/" title="Search">Search </a></li>
            <li data-sub="submenu0"><a href="/products" title="Products">Products</a><span class="arrow-main"></span></li>
            <li data-sub="submenu1"><a href="/services" title="Services">Services</a><span class="arrow-main"></span></li>
            <li data-sub="submenu2"><a href="/resources" title="Resources">Resources</a><span class="arrow-main"></span></li>
            <li data-sub="submenu3"><a href="/about-us" title="About">About</a><span class="arrow-main"></span></li>
            <li data-sub="submenu4"><a href="/contact" title="Contact">Contact</a></li>
        </ul>
    </div>

    <div class="nav-top-mobile">
        <div class="select-box form">

            <ul class="inline-block-md mb-none top-nav">
                <li>

                </li>
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/mysql-wishlist-session-from-an-online-travel-agency/"> Login</a>
                    </li>
                
            </ul>



        </div>
        <p class="text-center copyright">Copyright &copy; 2025 MariaDB. All rights reserved.</p>
    </div>
</div>
<div class="violator-wrap d-none" id="top_violator">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12">
                <div class="violator-outer">
                    <div class="violator-inner">
                        <div class="row">
                            <div class="col-xs-12 col-sm-9 col-lg-7 col-lg-offset-2" id="top_violator_content">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="content-link" target="_blank" rel="nofollow noreferrer">
                                    <span>The Ultimate Guide to High Availability with MariaDB</span>
                                </a>
                            </div>
                            <div class="col-xs-12 col-sm-3" id="top_violator_cta">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="btn btn-mariadb" target="_blank" rel="nofollow noreferrer">Download Now</a>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-link close-btn">
                        <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24" width="15px" height="15px"><path d="M 4.9902344 3.9902344 A 1.0001 1.0001 0 0 0 4.2929688 5.7070312 L 10.585938 12 L 4.2929688 18.292969 A 1.0001 1.0001 0 1 0 5.7070312 19.707031 L 12 13.414062 L 18.292969 19.707031 A 1.0001 1.0001 0 1 0 19.707031 18.292969 L 13.414062 12 L 19.707031 5.7070312 A 1.0001 1.0001 0 0 0 18.980469 3.9902344 A 1.0001 1.0001 0 0 0 18.292969 4.2929688 L 12 10.585938 L 5.7070312 4.2929688 A 1.0001 1.0001 0 0 0 4.9902344 3.9902344 z"/></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="wrapper">
<div id="top-nav">
    <div class="container">
        <ul class="hidden-sm hidden-xs" >
            <li><a href="https://mariadb.com/kb/">Knowledge Base</a></li>
            <li><a href="https://mariadb.com/contact/">Contact</a></li>
            
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/mysql-wishlist-session-from-an-online-travel-agency/" rel="nofollow">Login</a>
                    </li>
                
            
            
            <li id="search-form">
                <form action="/kb/en/+search/" method="get" id="search-block-form" accept-charset="UTF-8">
                    <input id="search" title="Enter the terms you wish to search for."
                           placeholder="Search . . ." type="text"
                           name="q" value="" size="15" maxlength="128" class="form-text"
                           data-autocomplete-url="/kb/en/+search/autocomplete/">
                    <input type="hidden" name="quick" value="1" />
                    <input type="hidden" name="source" value="kb" />
                </form>
            </li>
            <li><a id="search-toggler" href="/kb/search/">Search</a></li>
            
        </ul>
    </div>
</div>
<div id="navbar-bottom" class="navbar">
    <div class="container">
        
        
        
        
        <div class="row">
            <div class="col-md-3 col-sm-9 col-xs-9">
                <a class="brand" href="/" title="MariaDB">
                    <img src="/kb/static/images/logo-2018-black.95f5978ae14d.png">
                </a>
            </div>
            <div class="col-md-9 hidden-sm hidden-xs">
                <div class="main-menu">
                    <ul id="main-menu" class="nav navbar-nav inline-block-sm">
    <li class="has-sub full-menu">
        <a href="/products" title="Products">Products</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/solutions" title="Solutions">Solutions</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/resources" title="Resources">Resources</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/about-us" title="Company">Company</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/pricing" title="Pricing">Pricing</a>
    </li>
    
    <li class="">
        <a class="button electric-eel small top-bar-right-download" href="/downloads/">Download</a>
    </li>
</ul>
                </div>
            </div>
            <div class="col-md-3 visible-sm visible-xs col-sm-3 col-xs-3 ps-rv">
                <div class="navbar-header text-right pull-right">
                    <button type="button" class="menu-control toggle-menu" id="open-menu">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="main">
    <div class="container">
        

        <div id="subheader1" class="clearfix">
            <div class="pull-left">
                
                <div id="breadcrumbs" class="breadcrumb">
                    <a href="/kb/en/">Knowledge Base</a>
                    


    
    » <a class="crumb" href="/kb/en/training-tutorials/">Training &amp; Tutorials</a>
    

    
    » <a class="crumb" href="/kb/en/advanced-mariadb-articles/">Advanced MariaDB Articles</a>
    

    
    » <a class="crumb" href="/kb/en/development-articles/">Development Articles</a>
    

    
    » <a class="crumb" href="/kb/en/general-development-information/">General Development Information</a>
    

    
    » <a class="crumb" href="/kb/en/development-plans/">Plans</a>
    


    » <a class="node_link crumb" href="/kb/en/mysql-wishlist-session-from-an-online-travel-agency/">MySQL &#34;Wishlist&#34; Session from an online travel agency</a>


                </div>
                
            </div>
        </div>
    </div>
    <div class="container" id="container-main">
        <div class="row">
            
            
                
                <aside id="sidebar-first" class="sidebar col-md-2 hidden-xs hidden-sm hidden-print">
                    
                        
                        <ul id="category_menu" class="nav nav-pills nav-stacked">
                            <li><a href="/kb/en/">Home</a></li>
                            
                                
                                    <li><a href="/kb/en/+questions/">Open Questions</a></li>
                                
                                <li><a href="/kb/en/documentation/">MariaDB Server</a></li>
                                <li><a href="/kb/en/maxscale/">MariaDB MaxScale</a></li>
                                <li><a href="/kb/en/mariadb-columnstore/">MariaDB ColumnStore</a></li>
                                <li><a href="/kb/en/connectors/">Connectors</a></li>
                            

                        </ul>
                    

                    
<div>



<div class="well well-small box actions"><div>

        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/mysql-wishlist-session-from-an-online-travel-agency/+history" rel="nofollow">History</a>
        
        
        
        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/mysql-wishlist-session-from-an-online-travel-agency/+source/">Source</a>
        
        <a class="btn btn-block btn-blue btn-sm flag" href="/kb/en/mysql-wishlist-session-from-an-online-travel-agency/+flag"
                data-flag-url="/kb/en/mysql-wishlist-session-from-an-online-travel-agency/+flag" rel="nofollow">
                Flag as Spam / Inappropriate</a>
        

</div>
</div>





<div class="well well-small box node_info"><div>

    <dl>
        <dt>Created</dt>
        <dd>

<span class="datetime" title="2011-06-21 10:49">13 years, 10 months ago</span></dd>

        <dt>Modified</dt>
        <dd>

<span class="datetime" title="2012-02-01 13:23">13 years, 3 months ago</span></dd>

        <dt>Type</dt>
        <dd>question</dd>

        <dt>Status</dt>
        <dd>active</dd>

        <dt>License</dt>
        <dd>
            
                <a href="/kb/en/mysql-wishlist-session-from-an-online-travel-agency/+license/">CC BY-SA / Gnu FDL</a>
            
        </dd>

        
    </dl>

    
    <ul class="rss_feeds">
        <li><a href="/kb/en/mysql-wishlist-session-from-an-online-travel-agency/+history/feed/">
            History</a>
        </li>
        <li><a href="/kb/en/mysql-wishlist-session-from-an-online-travel-agency/+comments/feed/">
            Comments</a>
        </li>
    </ul>
    

</div>
</div>





    
    
    

<div class="well well-small box attachments"><div><div class="edit_link pull-right"><a href="/kb/en/mysql-wishlist-session-from-an-online-travel-agency/+edit/attachments/">Edit</a></div><h5>Attachments</h5></div><div>

        
            <div class="no_data">No attachments exist</div>
        
    
</div>
</div>

    



    
    






</div>


                    

































                </aside>
            
            
            
                
            
            
                
            
            <section id="content" class="limited_width col-md-8 clearfix">
                
                    <h1>MySQL &#34;Wishlist&#34; Session from an online travel agency</h1>
                

                



                <div>
                    
    

    
    
    

    <div class="node creole">
        
        
        
    <div class="question formatted">
        <h2 class="anchored_heading" id="currently-critical-issues">Currently critical issues</h2>
<h3 class="anchored_heading" id="drop-table-is-slow">DROP TABLE is slow</h3>
<p>When dropping a partitioned table using the compressed InnoDB storage engine, we have experienced this to be very slow in some cases - sometimes the drop takes several hours, logjamming replication. This is currently a showstopped for rolling out a large MyISAM-to-InnoDB conversion that we consider to be important to be able to scale further.</p>
<h3 class="anchored_heading" id="scaling-replication">Scaling replication</h3>
<p>We experienced replication speed problems in the sql_slave thread this year, for the first time. This is apparently to our code being written to MyISAM originally, and now not using transactions to batch writes enough in the first place, plus added disk write latency from a filer as a target disk.</p>
<div style="margin-left:2em"><p> Monty stated that MariaDB is about to contain an interesting patch wrt to Group Commit which leverages the fact
 that all items in one Group Commit must be logically independent, hence could in theory be applied in parallel.
 The goal of the patch is to make this theory a practicality.</p>
</div>
<h3 class="anchored_heading" id="utf-8-issues-memory-engine-limitations">UTF-8 issues, MEMORY engine limitations</h3>
<p>UTF-8 currently stalled because of MEMORY tables being fixed length in query plans with 'using temporary'. A single
VARCHAR(255) CHARSET utf8 causes 765 bytes to be used per row if it ever goes 'using temporary'. <code>--</code> Kris, Eric</p>
<div style="margin-left:2em"><div style="margin-left:2em"><p>Variable length memory tables existed with limits, need sponsorship. <code>--</code> Monty</p>
</div>
</div>
<h3 class="anchored_heading" id="the-adminlogging-problem">The "Adminlogging problem"</h3>
<p>Many writes we have need to track the previous values so that they are being shipped to an auditing database elsewhere on a different machine. Many ways to solve that problem exist, most suck.</p>
<p>Using RBR binlog, parse that output: We are currently parsing "mysqlbinlog -vv" output. A binlog parsing library exposed to the usual scripting languages would make that much easier. Also, the binlog does not contain all data needed for an audit log (application level user information needs to be embedded somehow).</p>
<div style="margin-left:2em"><p> We can log the statement including all comments in the statement once, and have each row point back to the statement
 that caused this row to be changed. You'd have the change from the RBR record, and could get the higher level app user
 from a comment in the statement. - Monty</p>
<div style="margin-left:2em"><p> I like. Binlog is written anyway, so no additional overhead. <code>--</code> Kris</p>
</div>
</div>
<p>Another solution would be triggers.</p>
<div style="margin-left:2em"><p> They suck. Executed synchronously, slow, hard to debug, prone to breakage. Also higher level app data missing. <code>--</code> Kris</p>
</div>
<p>Specialized statements? "SELECT FROM DELETE/SELECT FROM UPDATE": Write statements returning a result set of old values. Actually INSERT FROM DELETE/INSERT FROM UPDATE would be needed to make it transactional. <code>--</code> Yves, Ruud</p>
<div style="margin-left:2em"><p> Please spec this. <code>--</code> Monty</p>
</div>
<p>MySQL 5.5. provides an Audit plugin API for this. Check it out, write UDP sender into eventlogging as such a plugin. It is easy, and does exactly what we want. Also, this is the least ugly way to solve this. <code>--</code> Kris</p>
<h2 class="anchored_heading" id="more-replication-wishes">More replication wishes</h2>
<h3 class="anchored_heading" id="replication-synchronisation-global-unique-id">Replication synchronisation (Global Unique Id)</h3>
<p>At the moment we build our replication hierarchies at most 2 levels deep, and use a host language wrapper around SHOW MASTER STATUS and SELECT MASTER_POS_WAIT() to create waypoints where needed. This does not work across more than 1 hop (2 levels), as master binlog positions do not translate past one slave.</p>
<p>A mechanism that allows to create such waypoints across any number of hops would be useful from a correctness perspective. I would also allow us more flexibility in how we build our replication hierarchies.</p>
<h3 class="anchored_heading" id="large-table-upload-causes-replication-lag">Large table upload causes replication lag</h3>
<p>Some events are known independent events, and can cause large replication lag due to their sheer size. For example, sometimes we upload large new tables to a master, and the data download then delays normal processing in all slaves. It would be nice for a mechanism to exist to leverage additional connections to download this out-of-band.</p>
<p>Please note that such a mechanism should not change the security model of replication too much (direction of connect from slave to master, port usage, etc).</p>
<h3 class="anchored_heading" id="inverse-sharding">Inverse Sharding</h3>
<p>We shard data. In some cases, for some users which do care less about speed and more about reporting, it would be convenient to have a way to unshard data. Is FederatedX a solution? Can be have replication so that a slave can be slave to multiple masters provided the data sets of the masters are nonoverlapping? <code>--</code> Eric</p>
<div style="margin-left:2em"><p> Let's add names, DEFAULT being the optional default name. START SLAVE IO_THREAD DEFAULT, 
 CHANGE DEFAULT MASTER TO ... and so on. <code>--</code> Monty</p>
</div>
<h3 class="anchored_heading" id="making-slaves-in-a-non-sucky-way">Making slaves in a non-sucky way</h3>
<p>Right now we mylvmbackup a slave, restore it to a new box, recover the InnoDB and connect it to the master. We'd like to have a command that can be issues to an empty database, will download the data from a master (or a co-slave), and then attach the new slave to the master (using the configuration provided on the command line or by the co-slave). At the SQL level. With progress report. <code>--</code> Nicolai</p>
<div style="margin-left:2em"><p> And please have the data move at disk speed, no index creation, ship binary index data from the co-slave or master. This can be fast! <code>--</code> Kris</p>
</div>
<h3 class="anchored_heading" id="stable-snapshot">Stable snapshot</h3>
<p>"FLUSH TABLES WITH READ LOCK" can still break, if a checkpoint occurs under the lock.</p>
<p>Can we have FLUSH TABLES WITH READ LOCK AND NO CHECKPOINT and a FORCE CHECKPOINT for InnoDB, or have FLUSH TABLES force this checkpoint when applied to InnoDB? <code>--</code> Kris, SimonM</p>
<h3 class="anchored_heading" id="server-restart-required-replication">Server restart required (Replication)</h3>
<p>About every replication config change requires a server restart to be picked up. Please fix!</p>
<h3 class="anchored_heading" id="rbr-conflict-resultion-sp">RBR conflict resultion SP</h3>
<p>In RBR, when there is any kind of RBR problem, call a SP. The SP gets all required data made available somehow, can define a resolution policy. 4 Outcomes: Choose old, choose new, fail (error) and synthesize (merge) new row.</p>
<h3 class="anchored_heading" id="compressed-binlog">Compressed binlog</h3>
<p>Write the binlog optionally in a compressed fashion at the event level.</p>
<h3 class="anchored_heading" id="async-binlog-shipping">Async binlog shipping</h3>
<p>On binlog rotation, run a SP asynchronously. Note than execution of for example a shell command through a UDF must not lock anything! Provide sufficient environmental data to the SP (binlog names old and new, binlog position for old and new log, etc).</p>
<h3 class="anchored_heading" id="use-tables-not-files">Use tables, not files</h3>
<p>Get rid of master.info, relay.info. These should be InnoDB tables in mysql.*.</p>
<h2 class="anchored_heading" id="less-critical-wishes">Less critical wishes</h2>
<h3 class="anchored_heading" id="async-query-api-so-that-we-can-mapreduce-at-the-client-level">Async query API so that we can map/reduce at the client level</h3>
<p>Provide an API in mysqlclient.so so that we can write application side map/reduce query-shards-in-parallel actions.</p>
<h3 class="anchored_heading" id="make-indexes-first-level-objects">Make Indexes first level objects</h3>
<p>An index should be able to exist as an object that is not tied to a physical table. That would allow for indices that are global to a partition, and for functional indexes or indices on virtual columns.</p>
<h3 class="anchored_heading" id="alter-table-progress-report">ALTER TABLE progress report</h3>
<p>ALTER TABLE can take a long time. We know how to go into $datadir and find the secret files and observe them, but we'd rather see progress in SHOW PROCESSLIST.</p>
<div style="margin-left:2em"><p> done while you wait (*closes emacs*). <code>--</code> Monty</p>
</div>
<h3 class="anchored_heading" id="fast-alter-table">Fast ALTER TABLE</h3>
<p>Can we have proper fast ALTER TABLE? That would include online index drop/create, and versioned schema plus version numbers at the page level or the row level. Rows would be upgraded to the most recent schema version not at ALTER TABLE time, but whenever their row/page is being dirtied for whatever reason. <code>--</code> Kris, Herald.</p>
<div style="margin-left:2em"><p> There is the facebook hack for online ALTER TABLE. <code>--</code> SkySQL</p>
<div style="margin-left:2em"><p> Yes. We know. It is as much part of the problem space as it is part of the solution space. <code>--</code> Kris, Herald</p>
</div>
</div>
<h3 class="anchored_heading" id="nested-transactions-in-txn-flag">Nested transactions / In TXN flag</h3>
<p>"I would like to have nested transactions. They would make some things I need to solve a lot easier (layering in code, lower layers with their own TXNs being called by upper layers with or without a TXN going on)." <code>--</code> Yves</p>
<div style="margin-left:2em"><p> "I would like to see a viable definition of nested transactions. I would like to know what it 
 means when an inner TXN does a COMMIT and then the outer TXN does a ROLLBACK. Are there
 any other ways to solve your layering problem?" <code>--</code> Kris</p>
</div>
<p>Another group asked about solutions for the same layering problem, but in a different way:
"We would like to have a flag or status variable that tells code if it currently is inside a transaction,
and optionally, if that is an implied (autocommit = 0) or explicit (autocommit = 1 and BEGIN WORK 
was issued) transaction."</p>
<h3 class="anchored_heading" id="compressed-myisamaria">Compressed MyISAM/Aria</h3>
<p>We are using MyISAM in some places for mostly append-only tables and very large sizes (20 TB and more target size). We are considering Aria for this, if Aria is comparable in space efficiency to MyISAM, and has nicer recovery after an unplanned shutdown.</p>
<p>MyISAM tables we are using are being compressed with myisampack/myisamchk when they are finished with being written to. This process is at the moment cumbersome, as it involves a FLUSH TABLES and external commands being run outside of the DB server. </p>
<p>Having an SQL command that online packs MyISAM/Aria tables would be useful, as this would handle open file handles and other stuff more nicely, and also can be controlled from the client using only SQL.</p>
<p>Having ARCHIVE-Engine like row-level compression would be even nicer, but will probably create all kind of problems when writes happen to already compressed rows.</p>
<p>For our current DWH needs just a COMPRESS TABLE/UNCOMPRESS TABLE command would be sufficient, and is probably a lot less invasive.</p>
<h3 class="anchored_heading" id="get_lock-improvements">GET_LOCK() improvements</h3>
<p>"At the moment GET_LOCK() in limited to one lock per connection. Acquiring a second lock while holding one releases the initial lock. This has been done in order to avoid deadlocking problems, we presume.</p>
<p>Having a deadlock detection system in place, and being able to pick up multiple locks at once or gradually would be useful." <code>--</code> Yves</p>
<div style="margin-left:2em"><p> There are voices (mine, for one) which state that if you are using GET_LOCK instead of InnoDB row locks then you 
 are doing it wrong. Using GET_LOCK more is a step into the wrong direction, technology-wise. <code>--</code> Kris</p>
</div>
<h3 class="anchored_heading" id="basic-dwh-improvements">Basic DWH improvements</h3>
<p>"Hash Join would help in many places." <code>--</code> Yves
"Hash Joins would be useful." <code>--</code> Debs</p>
<div style="margin-left:2em"><p> "Way ahead of you." <code>--</code> Monty</p>
</div>
<p>"Also subselects..." <code>--</code> Yves, Debs</p>
<div style="margin-left:2em"><p> "We hear you." <code>--</code> Monty</p>
</div>
<p>"Some large join take ages to execute. Probably due to tmp tables to disk." <code>--</code> Liz</p>
<div style="margin-left:2em"><p> Probably better of with Hash Joins? Show query examples, please. <code>--</code> Monty</p>
</div>
<h3 class="anchored_heading" id="better-explain-better-stats">Better EXPLAIN, better stats</h3>
<p>Better EXPLAIN, more statistics, display real I/O data for queries, list causes for WAIT. </p>
<div style="margin-left:2em"><p> PERFORMANCE_SCHEMA, MySQL 5.5 stuff plus addons.
 WL Item for better EXPLAIN exists. <code>--</code> Monty</p>
<div style="margin-left:2em"><p> Please link this item here. <code>--</code> Kris</p>
</div>
</div>
<p>"Better statistics for queries." "For example log query skeletons a la mysqldumpslow, but live from the parser." <code>--</code> Monty</p>
<div style="margin-left:2em"><p> Yes, please. Remember we have tables with time-tailed names (_YYYYMMDD), variable length WHERE ... IN (...) lists, and variable length extended insert statements. <code>--</code> Yves</p>
</div>
<h3 class="anchored_heading" id="optimizer-woes">Optimizer woes</h3>
<p>"Unquoted numbers cause weird query plans." <code>--</code> Ruud</p>
<div style="margin-left:2em"><p> Yes, they have to, thanks to numeric casting in SQL. This is not really solveable. <code>--</code> Monty</p>
<div style="margin-left:2em"><p> In MongoDB (gasp!) it can be made such that a query that uses a full scan instead of an index is an error. MySQL
 also can log queries not using an index in the slow log, which is good. But, can we make such implied casts
  somehow cause an error optionally, that would make that SQL easier to find in Development. <code>--</code> Kris</p>
</div>
</div>
<h3 class="anchored_heading" id="using-memcached-as-a-backend">Using memcached as a backend</h3>
<p>Using memcache as a backend. <code>--</code> Liz</p>
<div style="margin-left:2em"><p> done. <code>--</code> Monty</p>
</div>
<h3 class="anchored_heading" id="moving-ibd-files-physically">Moving ibd files physically</h3>
<p>For individual table restore and for shipment of precalculated/preloaded data it would be useful to detach ibd files, ship them and reattach them elsewhere, in binary form, at disk speed, no index creation necessary.</p>
<div style="margin-left:2em"><p> Possible with InnoDB and XtraDB as the donor, xtrabackup as the program and a properly configured XtraDB as the receiver. <code>--</code> Kris</p>
<div style="margin-left:2em"><p> InnoDB should be able to do this natively, via ALTER TABLE ... DETACH/ATTACH. <code>--</code> Everybody else.</p>
</div>
</div>
<h3 class="anchored_heading" id="more-data-load-issues">More data load issues</h3>
<p>SELECT INTO OUTFILE LOCAL? We do have LOAD DATA INFILE LOCAL.</p>
<div style="margin-left:2em"><p> Yes, but as implemented it is a security risk, also messes with firewall config due to the way it connects. <code>--</code> Kris</p>
<div style="margin-left:2em"><p> Does not. <code>--</code> Monty</p>
<div style="margin-left:2em"><p> Ok, I will write this up in a better way. <code>--</code> Kris</p>
</div>
</div>
</div>
<p>Also, please try mysqldumper. <code>--</code> SkySQL</p>
<h3 class="anchored_heading" id="server-restart-required-innodb">Server restart required (InnoDB)</h3>
<p>About every second innodb config change requires a server restart to be picked up. Please fix!</p>
<h3 class="anchored_heading" id="information_schema">INFORMATION_SCHEMA</h3>
<p>Faster I_S. Consider a server with one million tables. Make I_S not suck on this.</p>
<h3 class="anchored_heading" id="grants-roles-ldap">GRANTS, ROLES, LDAP</h3>
<p>We would be able to specify users as roles (e.g. developer, webuser, admin) and then assign a set of roles to users. One role is the default role picked up on login, the others can be picked up and dropped with a command.</p>
<p>Example (Kris):
Define role developer, developer has access to ALL on schema x.*.
Define role dba, dba has ALL on *.* with grant option.
Define user debs with default role developer, additional role dba.</p>
<p>Debs logs in (username, password from LDAP, possibly also role info from LDAP (optional)).
Debs has developer rights.
Debs issues TAKE ROLE DBA or something. She now has DBA privileges.
Debs issues DROP ROLE DBA. She now has Developer privileges.</p>
<p>A change of a role definition should be picked up when a role is picked up. For example role DBA changes privs. Debs has been logged in for 3 days as Developer. When she TAKEs ROLE DBA, the new DBA definition is picked up.</p>
<p>A change of role lists should be picked up at login.</p>
<p>The database should be able to work fine with one million users, one million roles. Do not keep all data in memory, load the required info on login into a cache (size changeable without restart). On login, load the requested data, if it is not in cache already.</p>
<p>Example: SET GLOBAL USERNAME_CACHE = 1000000; <code>--</code> yes, we pay that memory overhead
SET GLOBAL ROLE_CACHE = 1000000; <code>--</code> here as well</p>
<p>As users log in, these caches fill up. If we SET GLOBAL ROLE_CACHE=1000, this works as a LRU for the 1000 most recently used...</p>
<p>Example (Simon):</p>
<p>Initial thoughts are:</p>
<pre class="fixed"><span class="k">CREATE</span> <span class="n">ROLE</span> <span class="n">ROLE_NAME</span>                 <span class="c1">-- makes the role exist;</span>
<span class="k">GRANT</span> <span class="p">....</span> <span class="k">ON</span> <span class="n">db</span><span class="p">.</span><span class="k">table</span> <span class="k">TO</span> <span class="n">ROLE_NAME</span><span class="p">;</span>  <span class="c1">-- add grants to a &quot;role&quot;, similar to grants currently given to a user.</span>

<span class="k">GRANT</span> <span class="n">ROLE</span> <span class="n">ROLE_NAME1</span> <span class="k">TO</span> <span class="s1">&#39;USER&#39;</span><span class="o">@</span><span class="s1">&#39;...&#39;</span> <span class="p">[</span><span class="n">IDENTIFIED</span> <span class="k">BY</span> <span class="p">[</span><span class="n">PASSWORD</span><span class="p">]</span> <span class="s1">&#39;xxxxxx&#39;</span><span class="p">];</span>  <span class="c1">-- add role&#39;s grants to user</span>
<span class="k">GRANT</span> <span class="n">ROLE</span> <span class="n">ROLE_NAME2</span> <span class="k">TO</span> <span class="s1">&#39;USER&#39;</span><span class="o">@</span><span class="s1">&#39;...&#39;</span><span class="p">;</span>  <span class="c1">-- add role&#39;s grants to user</span>
</pre><p>with corresponding revokes:</p>
<pre class="fixed"><span class="k">REVOKE</span> <span class="n">ROLE</span> <span class="n">ROLE_NAME1</span> <span class="k">FROM</span> <span class="s1">&#39;USER&#39;</span><span class="o">@</span><span class="s1">&#39;..&#39;</span><span class="p">;</span> <span class="c1">-- remove role&#39;s grants from a user</span>
<span class="k">REVOKE</span> <span class="p">...</span> <span class="k">ON</span> <span class="n">db</span><span class="p">.</span><span class="k">table</span> <span class="k">FROM</span> <span class="n">ROLE_NAME1</span><span class="p">;</span>  <span class="c1">-- remove grants from a role</span>
</pre><p>and probably something like</p>
<pre class="fixed"><span class="k">SHOW</span> <span class="n">ROLES</span><span class="p">;</span>            <span class="c1">-- list all roles known</span>
<span class="k">SHOW</span> <span class="n">ROLE</span> <span class="n">ROLE_NAME1</span><span class="p">;</span>  <span class="c1">-- show the &quot;grants&quot; for a role</span>

<span class="k">SHOW</span> <span class="n">GRANTS</span> <span class="k">FOR</span> <span class="s1">&#39;user&#39;</span><span class="o">@</span><span class="s1">&#39;location&#39;</span> <span class="c1">-- should include the &#39;roles&#39; the user has been granted.</span>
</pre><p>Note: also would be nice if there were something like the equivalent of mk-show-grants which shows ALL grants for ALL users. We use this all the time as there's no SQL equivalent at the moment.</p>
<h3 class="anchored_heading" id="views">Views</h3>
<p>Views are parsed for every access, never cached. <code>--</code> Monty, Ruud</p>
<h3 class="anchored_heading" id="tablespace">TABLESPACE</h3>
<p>Proper tablespace management a la Oracle. <code>--</code> SimonM</p>
<div style="margin-left:2em"><p> Why? Please state benefits, spec it. <code>--</code> Monty</p>
</div>
<p>Simon replied:</p>
<p>My thoughts: We have database instances which have data ranging from: 20G to 2TB and some archive db servers containing up to 40TB of data target size.</p>
<p>Managing this with InnoDB as one large "blob" (one or more ibdata files) is not comfortable. innodb_filer_per_table splits this blob over multiple "different sized" files. Possibly more efficient is to have multiple "reasonably fixed" sized files [the tablespaces] (a smaller number than a per table count).</p>
<ul start="1"><li>An instance contains one or more tablespaces.
</li><li>A tablespace contains one or more datafiles (say 10G-50G depending on instance, DBA configurable)
</li><li>It should be possible to increase the size of a datafile
</li><li>It should be possible to assign a database or table to a specific tablespace
</li><li>It should also be possible to move tables out of a datafile (prior to perhaps dropping the file).
</li><li>Practicalities: make it possible to easily export/import a tablespace (with it's contents) from one instance to another.
</li></ul>
<p>It's true this does sound like quite a lot of extra work. Benefits are:</p>
<ul start="1"><li>easier to move around the files between instances
</li><li>space freed up by DELETE OR UPDATEs would be available to other tables (not the case with file_per_table unless you rebuild the table with ALTER TABLE)
</li><li>locating specific tablespaces on a specific location means that you can tune for better performance: e.g. move different tablespaces onto different disks/filesystems/LUNs.  (this is hard to do now cleanly)
</li></ul>
<p>So most of this is to help with management of the on-disk/file data operationally.</p>
<div style="margin-left:2em"><p> If NOT using XFS with O_DIRECT, there is an in-memory write lock on the inode, that is, a filesystem can have 
 only one write at a time happening to a filesystem file. Tablespaces and datafiles are a way to generate 
 concurrency here, if XFS+O_DIRECT is not an option.</p>
</div>
<div style="margin-left:2em"><p> Tablespaces, if done right, can provide LVM services to a storage engine in a way independent of the OS.</p>
</div>
<div style="margin-left:2em"><p> Tablespaces, if done right, can expose an API internally, that all storage engines can use instead of talking to the
 filesystem directly. That would unify the actual storage management of all storage engines.</p>
</div>
<h3 class="anchored_heading" id="get-rid-of-myisam-in-mysql">Get  rid of MyISAM in mysql.*</h3>
<p>You should be able to use any general storage engine in mysql.*, e.g. InnoDB.</p>
<h3 class="anchored_heading" id="get-rid-of-log-tables-in-mysql">Get rid of log tables in mysql.*</h3>
<p>The mysql.* schema is a config repository. It was a mistake to place potential log tables in here, e.g. the general log and slow query log tables.</p>
<h3 class="anchored_heading" id="timezone-issues">Timezone issues</h3>
<p>Currently, timezones are part of the session, not part of the column. Data types exist that take timezone data from the session into account (broken!), other data types never do that.</p>
<p>In general, this needs to be treated either the drizzle way (make all charsets utf8, make all time data utc), or the MySQL string way (store charset with each string, store TZ with each date or time, and provide blob-types as well as non-tz types for string resp. date/time types).</p>
<p>Essentially this is a request to create DATE_TZ, TIME_TZ, DATETIME_TZ and TIMESTAMP_TZ, relegate the timezone in a session to the same function as the charset in a session ('this is what the client uses'), and convert accordingly.</p>
<h3 class="anchored_heading" id="microtime">Microtime</h3>
<p>Make these date and time zones actually store microsecond resolution. Thanks.</p>
<h3 class="anchored_heading" id="dynamic-enum">Dynamic ENUM</h3>
<p>Create a ENUM-type like data type that does string compression (at a scale). For example, create a type LOOKUP(255) CHARSET utf8. We store browser user-agent strings here, you store bigint unsigned numbers internally, and create a lookup structure so that each occurrence of a string is physically stored only once. Convert from VARCHAR to LOOKUP using ALTER TABLE.</p>
<h3 class="anchored_heading" id="multiple-buffer-pool">Multiple Buffer pool</h3>
<p>Innodb multiple buffer pools, but size of each, and to which pool will  a page go configured by the dba (instead of random/hash as in 5.5, at table level).</p>
<h3 class="anchored_heading" id="innodb-temp-tables">InnoDB temp tables</h3>
<p>Discussed internally: is it not possible to use Innodb temporary tables or similar for this perhaps in an explicit tempdb (like Sybase)?</p>
<p>That is: tables are always temporary, cleaned up on server restart, writes to tables do not need to be (should not be) flushed.</p>
<p>That would make the MEMORY engine thing from above irrelevant.</p>
<h2 class="anchored_heading" id="providing-input-to-monty-program">Providing Input to Monty Program</h2>
<h3 class="anchored_heading" id="running-an-instance-with-profiling-on">Running an instance with profiling on</h3>
<p>Monty requested that we set up a slave with full profiling enabled, and if possible even divert a minimum amount of production load to it. The profiling data will be useful if made accessible to his team, as it contains useful information from real world load for his teams.</p>
<p>Also, it will be useful if the box were to run oprofile on a regular basis (with symbols installed), as this provides additional useful information.</p>
<h3 class="anchored_heading" id="other-engines">Other engines</h3>
<p>We should try out other engines for fast inserts/DWH uses: Infobright, InfiniDB, PBXT, ...</p>

    </div>



    
        <h2>Answer</h2>
    
    <div class="answer formatted">
        
    </div>


        
            <div id="subscribe" class="well well-small hide hidden-print"
                 data-subscribe-url="/kb/en/mysql-wishlist-session-from-an-online-travel-agency/+subscriptions/add"
                 data-unsubscribe-url="/kb/en/mysql-wishlist-session-from-an-online-travel-agency/+subscriptions/remove">
            </div>
        

        
        
    
        <div class="simple_section_nav">
            <ul class="nav nav-pills">
                
                
                    <li><a href="/kb/en/development-plans/">
                        ↑ Plans ↑
                    </a>
                    </li>
                
                
            </ul>
        </div>
    

        

        
        <h2>Comments</h2>
        
    
    <div id="comments" data-node-id="1631" data-comments-url="/kb/en/mysql-wishlist-session-from-an-online-travel-agency/+comments"
         data-reply-url="/kb/en/mysql-wishlist-session-from-an-online-travel-agency/comments/post/">
        Comments loading...
    </div>

        

    </div>


                    <div id="content_disclaimer" class="graybox">
                        Content reproduced on this site is the property of its respective owners,
                        and this content is not reviewed in advance by MariaDB. The views, information and opinions
                        expressed by this content do not necessarily represent those of MariaDB or any other party.
                    </div>
                </div>
            </section>

            
                <div id="right_bar" class="col-md-2">
                    
    
        
        <ul class="section_navigation well well-small hidden-xs hidden-sm">
            
                <li class="parent"><a href="/kb/en/development-plans/">
                    ↑ Plans ↑
                </a>
                </li>
            
            
                
                    <li>
                        <a href="/kb/en/mariadb-server-roadmap/">
                            
                            MariaDB Server Roadmap
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/old-plans/">
                            
                            Old Plans
                        </a>
                    </li>
                
            
        </ul>
    
    

                </div>
            
        </div>
    </div>
</div>

<!-- Footer -->
<footer id="footer">
    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-xs-12">
                    <ul class="list-inline text-center footer-nav">
                        <li>
                            <h5>
                                <a href="https://mariadb.com/products" title="Products">Products</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/solutions" title="Solutions">Solutions</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/resources" title="Resources">Resources</a>
                            </h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/about-us" title="About MariaDB">Company</a></h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/pricing" title="Pricing">Pricing</a>
                            </h5>
                        </li>
                        
                        
                        <li>
                            <h5><a href="https://mariadb.com/downloads" title="Download">Download MariaDB</a></h5>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="row row-10">
                
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div id="block-footerformcontact" class="block block-block-content block-block-contentd754ee1b-3cc9-40e7-9ef4-f504f1197fb1">
                        
                            <h5 style="font-weight: 400;">Subscribe to our newsletter!</h5>
                            <script src="//app-sj15.marketo.com/js/forms2/js/forms2.min.js"></script><form id="mktoForm_1498"></form>
                            <script>
                                <!--//--><![CDATA[// ><!--
                                MktoForms2.loadForm("//app-sj15.marketo.com", "573-PXI-984", 1498);
                                //--><!]]]]><![CDATA[>
                                //--><!]]>
                            </script>
                        
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div class="footer-copyright">
                        <div class="text-center">
                            <ul class="list-inline no-margin">
                                <li>
                                    <a href="/legal" title="Legal">Legal</a>
                                </li>
                                <li>
                                    <a href="/privacy-policy" title="Privacy Policy">Privacy Policy</a>
                                </li>
                                <li>
                                    <a href="/cookie-policy/" title="Cookies">Cookie Policy</a>
                                </li>
                            </ul>
                            <p>Copyright &copy; 2025 MariaDB. All rights reserved.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</footer>
</div>

<div id="ajax_loading">
    <img src="/kb/static/images/ajax-loader.a51c5608d01a.gif" />
</div>

    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MK2847"
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MK2847');</script>
    <!-- End Google Tag Manager -->

</body>

<script type="text/javascript" src="/kb/static/js/main.1587e3a666fc.js" charset="utf-8"></script>

</html>