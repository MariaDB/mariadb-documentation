<!DOCTYPE html>
<html>
<head data-cookie-domain=""
      data-cookie-path="/">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="apple-touch-icon" sizes="180x180" href="/kb/static/images/favicons/apple-touch-icon.159e713979be.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/kb/static/images/favicons/favicon-32x32.bc0ac1d5d11e.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/kb/static/images/favicons/favicon-16x16.5801f8f0f34e.png">
    <link rel="shortcut icon" href="/kb/static/images/favicons/favicon.d122d305dee4.ico" type="image/x-icon" />

    <title>InnoDB Page Compression - Source - MariaDB Knowledge Base</title>

    <link href="/kb/static/css/main.f7633538c846.css" rel="stylesheet" type="text/css" />

    
        <meta name="robots" content="noindex, nofollow">
    

    

    <!-- FB Open Graph tags -->
    <meta property="og:title" content="InnoDB Page Compression - Source" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://mariadb.com/kb/en/innodb-page-compression/+source/" />
    <meta property="og:image" content="http://mariadb.comaskmonty-logo.png" />
    <meta property="og:site_name" content="MariaDB KnowledgeBase" />
    <meta property="fb:admins" content="514852603" />
    <meta property="og:description" content="" />

    <meta name="description" content="" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet"/>
    
</head>
<body class="mpkb nodes autoresize nodes_source jqui" id="nodes_source">





<div id="menu-mobile" class="visible-sm visible-xs">

    <div>
        <div id="mobile-close-menu" class="text-right">
            <a href="javascript:void(0)" title="Close Menu" id="back-main" class="toggle-menu">X<span></span></a>
        </div>
    </div>
    <div class="mainmenu-mobile">
        <ul class="ls-none ul-menu">
            <li data-sub="submenu5"><a class="open-form-search" href="/kb/search/" title="Search">Search </a></li>
            <li data-sub="submenu0"><a href="/products" title="Products">Products</a><span class="arrow-main"></span></li>
            <li data-sub="submenu1"><a href="/services" title="Services">Services</a><span class="arrow-main"></span></li>
            <li data-sub="submenu2"><a href="/resources" title="Resources">Resources</a><span class="arrow-main"></span></li>
            <li data-sub="submenu3"><a href="/about-us" title="About">About</a><span class="arrow-main"></span></li>
            <li data-sub="submenu4"><a href="/contact" title="Contact">Contact</a></li>
        </ul>
    </div>

    <div class="nav-top-mobile">
        <div class="select-box form">

            <ul class="inline-block-md mb-none top-nav">
                <li>

                </li>
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/innodb-page-compression/+source/"> Login</a>
                    </li>
                
            </ul>



        </div>
        <p class="text-center copyright">Copyright &copy; 2024 MariaDB. All rights reserved.</p>
    </div>
</div>
<div class="violator-wrap d-none" id="top_violator">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12">
                <div class="violator-outer">
                    <div class="violator-inner">
                        <div class="row">
                            <div class="col-xs-12 col-sm-9 col-lg-7 col-lg-offset-2" id="top_violator_content">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="content-link" target="_blank" rel="nofollow noreferrer">
                                    <span>The Ultimate Guide to High Availability with MariaDB</span>
                                </a>
                            </div>
                            <div class="col-xs-12 col-sm-3" id="top_violator_cta">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="btn btn-mariadb" target="_blank" rel="nofollow noreferrer">Download Now</a>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-link close-btn">
                        <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24" width="15px" height="15px"><path d="M 4.9902344 3.9902344 A 1.0001 1.0001 0 0 0 4.2929688 5.7070312 L 10.585938 12 L 4.2929688 18.292969 A 1.0001 1.0001 0 1 0 5.7070312 19.707031 L 12 13.414062 L 18.292969 19.707031 A 1.0001 1.0001 0 1 0 19.707031 18.292969 L 13.414062 12 L 19.707031 5.7070312 A 1.0001 1.0001 0 0 0 18.980469 3.9902344 A 1.0001 1.0001 0 0 0 18.292969 4.2929688 L 12 10.585938 L 5.7070312 4.2929688 A 1.0001 1.0001 0 0 0 4.9902344 3.9902344 z"/></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="wrapper">
<div id="top-nav">
    <div class="container">
        <ul class="hidden-sm hidden-xs" >
            <li><a href="https://mariadb.com/kb/">Knowledge Base</a></li>
            <li><a href="https://mariadb.com/contact/">Contact</a></li>
            
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/innodb-page-compression/+source/" rel="nofollow">Login</a>
                    </li>
                
            
            
            <li id="search-form">
                <form action="/kb/en/+search/" method="get" id="search-block-form" accept-charset="UTF-8">
                    <input id="search" title="Enter the terms you wish to search for."
                           placeholder="Search . . ." type="text"
                           name="q" value="" size="15" maxlength="128" class="form-text"
                           data-autocomplete-url="/kb/en/+search/autocomplete/">
                    <input type="hidden" name="quick" value="1" />
                    <input type="hidden" name="source" value="kb" />
                </form>
            </li>
            <li><a id="search-toggler" href="/kb/search/">Search</a></li>
            
        </ul>
    </div>
</div>
<div id="navbar-bottom" class="navbar">
    <div class="container">
        
        
        
        
        <div class="row">
            <div class="col-md-3 col-sm-9 col-xs-9">
                <a class="brand" href="/" title="MariaDB">
                    <img src="/kb/static/images/logo-2018-black.95f5978ae14d.png">
                </a>
            </div>
            <div class="col-md-9 hidden-sm hidden-xs">
                <div class="main-menu">
                    <ul id="main-menu" class="nav navbar-nav inline-block-sm">
    <li class="has-sub full-menu">
        <a href="/products" title="Products">Products</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/services" title="Services">Services</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/pricing" title="Pricing">Pricing</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/resources" title="Resources">Resources</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/about-us" title="About Us">About Us</a>
    </li>
    <li class="">
        <a class="button electric-eel small top-bar-right-download" href="/downloads/">Download</a>
    </li>
</ul>
                </div>
            </div>
            <div class="col-md-3 visible-sm visible-xs col-sm-3 col-xs-3 ps-rv">
                <div class="navbar-header text-right pull-right">
                    <button type="button" class="menu-control toggle-menu" id="open-menu">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="main">
    <div class="container">
        

        <div id="subheader1" class="clearfix">
            <div class="pull-left">
                
                <div id="breadcrumbs" class="breadcrumb">
                    <a href="/kb/en/">Knowledge Base</a>
                    


    
    » <a class="crumb" href="/kb/en/documentation/">MariaDB Server Documentation</a>
    

    
    » <a class="crumb" href="/kb/en/columns-storage-engines-and-plugins/">Columns, Storage Engines, and Plugins</a>
    

    
    » <a class="crumb" href="/kb/en/storage-engines/">Storage Engines</a>
    

    
    » <a class="crumb" href="/kb/en/innodb/">InnoDB</a>
    


    » <a class="node_link crumb" href="/kb/en/innodb-page-compression/">InnoDB Page Compression</a>


                </div>
                
            </div>
        </div>
    </div>
    <div class="container" id="container-main">
        <div class="row">
            
            
                
                <aside id="sidebar-first" class="sidebar col-md-2 hidden-xs hidden-sm hidden-print">
                    
                        
                        <ul id="category_menu" class="nav nav-pills nav-stacked">
                            <li><a href="/kb/en/">Home</a></li>
                            
                                
                                    <li><a href="/kb/en/+questions/">Open Questions</a></li>
                                
                                <li><a href="/kb/en/documentation/">MariaDB Server</a></li>
                                <li><a href="/kb/en/maxscale/">MariaDB MaxScale</a></li>
                                <li><a href="/kb/en/mariadb-columnstore/">MariaDB ColumnStore</a></li>
                                <li><a href="/kb/en/connectors/">Connectors</a></li>
                            

                        </ul>
                    

                    
                        <div>
    

<div class="well well-small box actions"><div>

        <a class="btn btn-block btn-small" href="/kb/en/innodb-page-compression/">Return to article</a>
    
</div>
</div>

</div>
                    

                    

































                </aside>
            
            
            
                
            
            
            <section id="content" class="limited_width col-md-10 clearfix">
                
                    <h1>InnoDB Page Compression - Source</h1>
                

                



                <div>
                    

    

    
    <div class="revision_info">
        <dl class="table">
            <dt>Revision</dt>
            <dd><a href="/kb/en/innodb-page-compression/+r/119887/">119887</a></dd>
            <dt>User</dt>
            <dd>
<span class="user" id="user-2460">
<a href="/kb/user/id/2460" title="Jan Lindström">Jan Lindström</a>
</span></dd>
            <dt>Date</dt>
            <dd>

<span class="datetime" title="2022-10-18 11:01">2022-10-18 11:01</span></dd>
        </dl>
    </div>
    


    

    
        
        <textarea id="answer_source" class="creole_source autogrow">&lt;&lt;toc&gt;&gt;

== Overview

InnoDB page compression provides a way to compress InnoDB tables.

== Use Cases

* InnoDB page compression can be used on any storage device and any file system.

* InnoDB page compression is most efficient on file systems that support sparse files. See [[#saving-storage-space-with-sparse-files|Saving Storage Space with Sparse Files]] for more information.

* InnoDB page compression is most beneficial on solid state drives (SSDs) and other flash storage. See [[#optimized-for-flash-storage|Optimized for Flash Storage]] for more information.

* InnoDB page compression performs best when your storage device and file system support atomic writes, since that allows the [[xtradbinnodb-doublewrite-buffer|InnoDB doublewrite buffer]] to be disabled. See [[atomic-write-support|Atomic Write Support]] for more information. 

== Comparison with the ##COMPRESSED## Row Format

InnoDB page compression is a modern way to compress your InnoDB tables. It is similar to InnoDB&#39;s [[innodb-compressed-row-format|COMPRESSED]] row format, but it has many advantages. Some of the differences are:

* With InnoDB page compression, compressed pages are immediately decompressed after being read from the tablespace file, and only uncompressed pages are stored in the buffer pool. In contrast, with InnoDB&#39;s [[innodb-compressed-row-format|COMPRESSED]] row format, compressed pages are decompressed immediately after they are read from the tablespace file, and both the uncompressed and compressed pages are stored in the buffer pool. This means that the [[innodb-compressed-row-format|COMPRESSED]] row format uses more space in the buffer pool than InnoDB page compression does.
* With InnoDB page compression, pages are compressed just before being written to the tablespace file. In contrast, with InnoDB&#39;s [[innodb-compressed-row-format|COMPRESSED]] row format, pages are re-compressed immediately after any changes, and the compressed pages are stored in the buffer pool alongside the uncompressed pages. These changes are then occasionally flushed to disk. This means that the [[innodb-compressed-row-format|COMPRESSED]] row format re-compresses data more frequently than InnoDB page compression does.
* With InnoDB page compression, multiple compression algorithms are supported. In contrast, with InnoDB&#39;s [[innodb-compressed-row-format|COMPRESSED]] row format, [[https://www.zlib.net/|zlib]] is the only supported compression algorithm. This means that the [[innodb-compressed-row-format|COMPRESSED]] row format has less compression options than InnoDB page compression does.

In general, InnoDB page compression is superior to the [[innodb-compressed-row-format|COMPRESSED]] row format.

== Comparison with Storage Engine-Independent Column Compression
* See [[storage-engine-independent-column-compression#comparison-with-innodb-page-compression|Storage Engine-Independent Column Compression - Comparison with InnoDB Page Compression]].

== Configuring the InnoDB Page Compression Algorithm

There is not currently a table option to set different InnoDB page compression algorithms for individual tables.

However, the server-wide InnoDB page compression algorithm can be configured by setting the
[[innodb-system-variables#innodb_compression_algorithm|innodb_compression_algorithm]] system variable.

When this system variable is changed, the InnoDB page compression algorithm does not change for existing pages that were already compressed with a different InnoDB page compression algorithm. InnoDB is able to handle this situation without issues, because every page in an InnoDB tablespace contains metadata about the InnoDB page compression algorithm in the page header. This means that InnoDB supports having uncompressed pages and pages compressed with different InnoDB page compression algorithms in the same InnoDB tablespace at the same time.

This system variable can be set to one of the following values:

&lt;&lt;style class=&#34;darkheader-nospace-borders&#34;&gt;&gt;
|=System Variable Value |= Description
|##none##    | Pages are not compressed. This is the default value in MariaDB 10.2.3 and before, and MariaDB 10.1.21 and before.
|##zlib## | Pages are compressed using the bundled [[https://www.zlib.net/|zlib]] compression algorithm. This is the default value in MariaDB 10.2.4 and later, and MariaDB 10.1.22 and later.
|##lz4## | Pages are compressed using the [[https://code.google.com/p/lz4/|lz4]] compression algorithm.
|##lzo## | Pages are compressed using the [[http://www.oberhumer.com/opensource/lzo/|lzo]] compression algorithm.
|##lzma## | Pages are compressed using the [[http://tukaani.org/xz/|lzma]] compression algorithm.
|##bzip2## | Pages are compressed using the [[http://www.bzip.org/|bzip2]] compression algorithm.
|##snappy## | Pages are compressed using the [[http://google.github.io/snappy/|snappy]] algorithm.
&lt;&lt;/style&gt;&gt;

However, on many distributions, the standard MariaDB builds do not support all InnoDB page compression algorithms by default. From MariaDB 10.7, algorithms can be [[compression-plugins|installed as a plugin]].

This system variable can be changed dynamically with [[set/#global-session|SET GLOBAL]]. For example:

&lt;&lt;sql&gt;&gt;
SET GLOBAL innodb_compression_algorithm=&#39;lzma&#39;;
&lt;&lt;/sql&gt;&gt;

This system variable can also be set in a server [[configuring-mariadb-with-option-files/#option-groups|option group]] in an [[configuring-mariadb-with-option-files|option file]] prior to starting up the server. For example:

&lt;&lt;code&gt;&gt;
[mariadb]
...
innodb_compression_algorithm=lzma
&lt;&lt;/code&gt;&gt;

=== Checking Supported InnoDB Page Compression Algorithms

On many distributions, the standard MariaDB builds do not support all InnoDB page compression algorithms by default. Therefore, if you want to use a specific InnoDB page compression algorithm, then you should check whether your MariaDB build supports it.

The [[https://www.zlib.net/|zlib]] compression algorithm is always supported. From MariaDB 10.7, algorithms can be [[compression-plugins|installed as a plugin]].

A MariaDB build&#39;s support for other InnoDB page compression algorithms can be checked by querying the following status variables with [[show-status|SHOW GLOBAL STATUS]]:

&lt;&lt;style class=&#34;darkheader-nospace-borders&#34;&gt;&gt;
|=Status Variable |= Description
|[[innodb-server-status-variables/#innodb_have_lz4|Innodb_have_lz4]] | Whether InnoDB supports the [[https://code.google.com/p/lz4/|lz4]] compression algorithm.
|[[innodb-server-status-variables/#innodb_have_lzo|Innodb_have_lzo]] | Whether InnoDB supports the [[http://www.oberhumer.com/opensource/lzo/|lzo]] compression algorithm.
|[[innodb-server-status-variables/#innodb_have_lzma|Innodb_have_lzma]] | Whether InnoDB supports the [[http://tukaani.org/xz/|lzma]] compression algorithm.
|[[innodb-server-status-variables/#innodb_have_bzip2|Innodb_have_bzip2]] | Whether InnoDB supports the [[http://www.bzip.org/|bzip2]] compression algorithm.
|[[innodb-server-status-variables/#innodb_have_snappy|Innodb_have_snappy]] | Whether InnoDB supports the [[http://google.github.io/snappy/|snappy]] compression algorithm.
&lt;&lt;/style&gt;&gt;

For example:

&lt;&lt;sql&gt;&gt;
SHOW GLOBAL STATUS WHERE Variable_name IN (
   &#39;Innodb_have_lz4&#39;, 
   &#39;Innodb_have_lzo&#39;, 
   &#39;Innodb_have_lzma&#39;, 
   &#39;Innodb_have_bzip2&#39;, 
   &#39;Innodb_have_snappy&#39;
);
+--------------------+-------+
| Variable_name      | Value |
+--------------------+-------+
| Innodb_have_lz4    | OFF   |
| Innodb_have_lzo    | OFF   |
| Innodb_have_lzma   | ON    |
| Innodb_have_bzip2  | OFF   |
| Innodb_have_snappy | OFF   |
+--------------------+-------+
&lt;&lt;/sql&gt;&gt;

=== Adding Support for an InnoDB Page Compression Algorithm

On many distributions, the standard MariaDB builds do not support all InnoDB page compression algorithms by default. From MariaDB 10.7, algorithms can be [[compression-plugins|installed as a plugin]], but in earlier versions, if you want to use certain InnoDB page compression algorithms, then you may need to do the following:

* Download the package for the desired compression library from the above links.
* Install the package for the desired compression library. 
* Compile MariaDB from the source distribution.

The general steps for compiling MariaDB are:

* Download and unpack the source code distribution:

&lt;&lt;code&gt;&gt;
wget https://downloads.mariadb.com/MariaDB/mariadb-10.4.8/source/mariadb-10.4.8.tar.gz
tar -xvzf mariadb-10.4.8.tar.gz
cd mariadb-10.4.8/
&lt;&lt;/code&gt;&gt;

* Configure the build using [[generic-build-instructions/#using-cmake|cmake]]:

&lt;&lt;code&gt;&gt;
cmake .
&lt;&lt;/code&gt;&gt;

* Check [[https://cmake.org/runningcmake/|CMakeCache.txt]] to confirm that it has found the desired compression library on your system.

* Compile the build:

&lt;&lt;code&gt;&gt;
make
&lt;&lt;/code&gt;&gt;

* Either install the build:

&lt;&lt;code&gt;&gt;
make install
&lt;&lt;/code&gt;&gt;

Or make a package to install:

&lt;&lt;code&gt;&gt;
make package
&lt;&lt;/code&gt;&gt;


See [[compiling-mariadb-from-source|Compiling MariaDB From Source]] for more information.

== Enabling InnoDB Page Compression

InnoDB page compression is not enabled by default. However, InnoDB page compression can be enabled for just individual InnoDB tables or it can be enabled for all new InnoDB tables by default.

InnoDB page compression is also only supported if the InnoDB table is in a [[innodb-file-per-table-tablespaces|file per-table]] tablespace. Therefore, the [[innodb-system-variables#innodb_file_per_table|innodb_file_per_table]] system variable must be set to ##ON## to use InnoDB page compression.

InnoDB page compression is only supported if the InnoDB table uses the ##Barracuda## [[xtradbinnodb-file-format|file format]].Therefore, in MariaDB 10.1 and before, the [[innodb-system-variables#innodb_file_format|innodb_file_format]] system variable must be set to ##Barracuda## to use InnoDB page compression.

InnoDB page compression is also only supported if the InnoDB table&#39;s [[innodb-row-formats-overview|row format]] is [[innodb-compact-row-format|COMPACT]] or [[innodb-dynamic-row-format|DYNAMIC]].

=== Enabling InnoDB Page Compression by Default

In MariaDB 10.2.3 and later, InnoDB page compression can be enabled for all new InnoDB tables by default by setting the [[innodb-system-variables/#innodb_compression_default|innodb_compression_default]] system variable to ##ON##.

This system variable can be set to one of the following values:

&lt;&lt;style class=&#34;darkheader-nospace-borders&#34;&gt;&gt;
|=System Variable Value |= Description
|##OFF##    | New InnoDB tables do not use InnoDB page compression. This is the default value.
|##ON## | New InnoDB tables use InnoDB page compression.
&lt;&lt;/style&gt;&gt;

This system variable can be changed dynamically with [[set/#global-session|SET GLOBAL]]. For example:

&lt;&lt;sql&gt;&gt;
SET GLOBAL innodb_compression_default=ON;
&lt;&lt;/sql&gt;&gt;

This system variable&#39;s session value can be changed dynamically with [[set/#global-session|SET SESSION]]. For example:

&lt;&lt;sql&gt;&gt;
SET GLOBAL innodb_file_per_table=ON;

SET GLOBAL innodb_file_format=&#39;Barracuda&#39;;

SET GLOBAL innodb_default_row_format=&#39;dynamic&#39;;

SET GLOBAL innodb_compression_algorithm=&#39;lzma&#39;;

SET SESSION  innodb_compression_default=ON;

CREATE TABLE users (
   user_id int not null, 
   b varchar(200), 
   primary key(user_id)
) 
   ENGINE=InnoDB;
&lt;&lt;/sql&gt;&gt;

This system variable can also be set in a server [[configuring-mariadb-with-option-files/#option-groups|option group]] in an [[configuring-mariadb-with-option-files|option file]] prior to starting up the server. For example:

&lt;&lt;code&gt;&gt;
[mariadb]
...
innodb_compression_default=ON
&lt;&lt;/code&gt;&gt;

=== Enabling InnoDB Page Compression for Individual Tables

InnoDB page compression can be enabled for individual tables by setting the [[create-table/#page_compressed|PAGE_COMPRESSED]] table option to ##1##. For example:

&lt;&lt;sql&gt;&gt;
SET GLOBAL innodb_file_per_table=ON;

SET GLOBAL innodb_file_format=&#39;Barracuda&#39;;

SET GLOBAL innodb_default_row_format=&#39;dynamic&#39;;

SET GLOBAL innodb_compression_algorithm=&#39;lzma&#39;;

CREATE TABLE users (
   user_id int not null, 
   b varchar(200), 
   primary key(user_id)
) 
   ENGINE=InnoDB
   PAGE_COMPRESSED=1;
&lt;&lt;/sql&gt;&gt;

== Configuring the Compression Level

Some InnoDB page compression algorithms support a compression level option, which configures how the InnoDB page compression algorithm will balance speed and compression.

The compression level&#39;s supported values range from ##1## to ##9##. The range goes from the fastest to the most compact, which means that ##1## is the fastest and ##9## is the most compact.

Only the following InnoDB page compression algorithms currently support compression levels:

* [[https://www.zlib.net/|zlib]]
* [[http://tukaani.org/xz/|lzma]] 

If an InnoDB page compression algorithm does not support compression levels, then it ignores any provided compression level value.

=== Configuring the Default Compression Level

The default compression level can be configured by setting the
[[innodb-system-variables#innodb_compression_level|innodb_compression_level]] system variable.

This system variable&#39;s default value is ##6##.

This system variable can be changed dynamically with [[set/#global-session|SET GLOBAL]]. For example:

&lt;&lt;sql&gt;&gt;
SET GLOBAL innodb_compression_level=9;
&lt;&lt;/sql&gt;&gt;

This system variable can also be set in a server [[configuring-mariadb-with-option-files/#option-groups|option group]] in an [[configuring-mariadb-with-option-files|option file]] prior to starting up the server. For example:

&lt;&lt;code&gt;&gt;
[mariadb]
...
innodb_compression_level=9
&lt;&lt;/code&gt;&gt;

=== Configuring the Compression Level for Individual Tables

The compression level for individual tables can also be configured by setting the [[create-table/#page_compression_level|PAGE_COMPRESSION_LEVEL]] table option for the table. For example:

&lt;&lt;sql&gt;&gt;
SET GLOBAL innodb_file_per_table=ON;

SET GLOBAL innodb_file_format=&#39;Barracuda&#39;;

SET GLOBAL innodb_default_row_format=&#39;dynamic&#39;;

SET GLOBAL innodb_compression_algorithm=&#39;lzma&#39;;

CREATE TABLE users (
   user_id int not null, 
   b varchar(200), 
   primary key(user_id)
) 
   ENGINE=InnoDB
   PAGE_COMPRESSED=1
   PAGE_COMPRESSION_LEVEL=9;
&lt;&lt;/sql&gt;&gt;

== Configuring the Failure Threshold and Maximum Padding

InnoDB page compression can encounter compression failures.

InnoDB page compression&#39;s failure threshold can be configured. If InnoDB encounters more compression failures than the failure threshold, then it pads pages with zeroed out bytes before attempting to compress them as a way to reduce failures. If the failure rate stays above the failure threshold, then InnoDB pads pages with more zeroed out bytes in 128 byte increments.  

InnoDB page compression&#39;s maximum padding can also be configured.

=== Configuring the Failure Threshold

The failure threshold can be configured by setting the [[innodb-system-variables/#innodb_compression_failure_threshold_pct|innodb_compression_failure_threshold_pct]] system variable.

This system variable&#39;s supported values range from ##0## to ##100##.

This system variable&#39;s default value is ##5##.

This system variable can be changed dynamically with [[set/#global-session|SET GLOBAL]]. For example:

&lt;&lt;sql&gt;&gt;
SET GLOBAL innodb_compression_failure_threshold_pct=10;
&lt;&lt;/sql&gt;&gt;

This system variable can also be set in a server [[configuring-mariadb-with-option-files/#option-groups|option group]] in an [[configuring-mariadb-with-option-files|option file]] prior to starting up the server. For example:

&lt;&lt;code&gt;&gt;
[mariadb]
...
innodb_compression_failure_threshold_pct=10
&lt;&lt;/code&gt;&gt;

=== Configuring the Maximum Padding

The maximum padding can be configured by setting the [[innodb-system-variables/#innodb_compression_pad_pct_max|innodb_compression_pad_pct_max]] system variable.

This system variable&#39;s supported values range from ##0## to ##75##.

This system variable&#39;s default value is ##50##.

This system variable can be changed dynamically with [[set/#global-session|SET GLOBAL]]. For example:

&lt;&lt;sql&gt;&gt;
SET GLOBAL innodb_compression_pad_pct_max=75;
&lt;&lt;/sql&gt;&gt;

This system variable can also be set in a server [[configuring-mariadb-with-option-files/#option-groups|option group]] in an [[configuring-mariadb-with-option-files|option file]] prior to starting up the server. For example:

&lt;&lt;code&gt;&gt;
[mariadb]
...
innodb_compression_pad_pct_max=75
&lt;&lt;/code&gt;&gt;

== Saving Storage Space with Sparse Files

When InnoDB page compression is used, InnoDB may still write the compressed page to the tablespace file with the original size of the uncompressed page, which would be equivalent to the value of the [[innodb-system-variables#innodb_page_size|innodb_page_size]] system variable. This is done by design, because when InnoDB&#39;s I/O code needs to read the page from disk, it can only read the full page size. However, this is obviously not optimal.

On file systems that support sparse files, this problem is solved by writing the tablespace file as a sparse file using the //punch hole// technique. With the //punch hole// technique, InnoDB will only write the actual compressed page size to the tablespace file, aligned to sector size. The rest of the page is trimmed.

This //punch hole// technique allows InnoDB to read the compressed page from disk as the full page size, even though the compressed page really takes up less space on the file system.

There are some potential disadvantages to using sparse files:

* Some utilities may require special options in order to handle sparse files in an efficient manner.
* Most existing file systems are slow to [[https://linux.die.net/man/2/unlink|unlink()]] sparse files. As a consequence, if a tablespace file is a sparse file, then dropping the table can be very slow.

=== Sparse File Support on Linux

On Linux, the following file systems support sparse files:

* ##ext3##
* ##ext4##
* ##xfs##
* ##btrfs##
* ##nvmfs##

On Linux, file systems need to support the [[https://linux.die.net/man/2/fallocate|fallocate()]] system call with the ##FALLOC_FL_PUNCH_HOLE## and ##FALLOC_FL_KEEP_SIZE## flags. For example:

&lt;&lt;code&gt;&gt;
fallocate(file_handle, FALLOC_FL_PUNCH_HOLE | FALLOC_FL_KEEP_SIZE, file_offset, remainder_len);
&lt;&lt;/code&gt;&gt;

Some Linux utilities may require special options in order to work with sparse files efficiently. For example:

* The [[https://linux.die.net/man/1/ls|ls]] utility will report the non-sparse size of the tablespace file when executed with default behavior, but ##[[https://linux.die.net/man/1/ls|ls -s]]## will report the actual amount of storage allocated for the tablespace file.
* The [[https://linux.die.net/man/1/cp|cp]] utility is pretty good at auto-detecting sparse files, but it also provides the [[https://linux.die.net/man/1/cp|cp --sparse=always]] and [[https://linux.die.net/man/1/cp|cp --sparse=never]] options, if the auto-detection is not desired.
* The [[https://linux.die.net/man/1/tar|tar]] utility will archive sparse files with their non-sparse size when executed with default behavior, but [[https://linux.die.net/man/1/tar|tar --sparse]] will auto-detect sparse files, and archive them with their sparse size.

=== Sparse File Support on Windows

On Windows, the following file systems support sparse files:

* ##NTFS##

On Windows, file systems need to support the [[https://docs.microsoft.com/en-us/windows/win32/api/ioapiset/nf-ioapiset-deviceiocontrol|DeviceIoControl()]] function with the [[https://docs.microsoft.com/en-us/windows/win32/api/winioctl/ni-winioctl-fsctl_set_sparse|FSCTL_SET_SPARSE]] and [[https://docs.microsoft.com/en-us/windows/win32/api/winioctl/ni-winioctl-fsctl_set_zero_data|FSCTL_SET_ZERO_DATA]] control codes. For example:

&lt;&lt;code&gt;&gt;
DeviceIoControl(file_handle, FSCTL_SET_SPARSE, inbuf, inbuf_size, 
   outbuf, outbuf_size,  NULL, &amp;overlapped)
...
DeviceIoControl(file_handle, FSCTL_SET_ZERO_DATA, inbuf, inbuf_size, 
   outbuf, outbuf_size,  NULL, &amp;overlapped)
&lt;&lt;/code&gt;&gt;

=== Configuring InnoDB to use Sparse Files

In MariaDB 10.3 and later, InnoDB uses the //punch hole// technique to create sparse files used automatically when the underlying file system supports sparse files.

In MariaDB 10.2 and before, InnoDB can be configured to use the //punch hole// technique to create sparse files by configuring the [[innodb-system-variables#innodb_use_trim|innodb_use_trim]] and [[innodb-system-variables#innodb_use_fallocate|innodb_use_fallocate]] system variables. These system variables can be set in a server [[configuring-mariadb-with-option-files/#option-groups|option group]] in an [[configuring-mariadb-with-option-files|option file]] prior to starting up the server. For example:

&lt;&lt;code&gt;&gt;
[mariadb]
...
innodb_use_trim=ON
innodb_use_fallocate=ON
&lt;&lt;/code&gt;&gt;

== Optimized for Flash Storage

InnoDB page compression was designed to be optimized on solid state drives (SSDs) and other flash storage.

InnoDB page compression was originally developed by collaborating with [[http://fusionio.com|Fusion-io]]. As a consequence, it was originally designed to work best on [[fusion-io-introduction|FusionIO devices]] using [[https://ieeexplore.ieee.org/document/6558434|NVMFS]]. [[http://fusionio.com|Fusion-io]] has since been acquired by [[https://www.westerndigital.com/|Western Digital]], and they have decided not to continue supporting [[https://ieeexplore.ieee.org/document/6558434|NVMFS]].

However, InnoDB page compression is still likely to be most optimized on solid state drives (SSDs) and other flash storage.

InnoDB page compression works without any issues on hard disk drives (HDDs). However, since its compression relies on the use of sparse files, the data may be somewhat fragmented on disk. This fragmentation may hurt performance on HDDs, since they handle random reads and writes much more slowly than flash storage.

== Configuring InnoDB Page Flushing

With InnoDB page compression, pages are compressed when they are flushed to disk. Therefore, it can be helpful to optimize the configuration of InnoDB&#39;s page flushing. See [[innodb-page-flushing|InnoDB Page Flushing]] for more information.

== Monitoring InnoDB Page Compression

InnoDB page compression can be monitored by querying the following status variables with [[show-status|SHOW GLOBAL STATUS]]:

&lt;&lt;style class=&#34;darkheader-nospace-borders&#34;&gt;&gt;
|= Status Variable |= Description
| [[xtradbinnodb-server-status-variables#innodb_page_compression_saved|Innodb_page_compression_saved]] | Bytes saved by compression
| [[xtradbinnodb-server-status-variables#innodb_page_compression_trim_sect512|Innodb_page_compression_trim_sect512]] | Number of 512 sectors trimmed
| [[xtradbinnodb-server-status-variables#innodb_page_compression_trim_sect1024|Innodb_page_compression_trim_sect1024]] | Number of 1024 sectors trimmed
| [[xtradbinnodb-server-status-variables#innodb_page_compression_trim_sect2048|Innodb_page_compression_trim_sect2048]] | Number of 2048 sectors trimmed
| [[xtradbinnodb-server-status-variables#innodb_page_compression_trim_sect4096|Innodb_page_compression_trim_sect4096]] | Number of 4096 sectors trimmed
| [[xtradbinnodb-server-status-variables#innodb_page_compression_trim_sect8192|Innodb_page_compression_trim_sect8192]] | Number of 8192 sectors trimmed
| [[xtradbinnodb-server-status-variables#innodb_page_compression_trim_sect16384|Innodb_page_compression_trim_sect16384]] | Number of 16384 sectors trimmed
| [[xtradbinnodb-server-status-variables#innodb_page_compression_trim_sect32768|Innodb_page_compression_trim_sect32768]] | Number of 32768 sectors trimmed
| [[xtradbinnodb-server-status-variables#innodb_num_pages_page_compressed|Innodb_num_pages_page_compressed]] | Number of pages compressed
| [[xtradbinnodb-server-status-variables#innodb_num_page_compressed_trim_op|Innodb_num_page_compressed_trim_op]] | Number of trim operations
| [[xtradbinnodb-server-status-variables#innodb_num_page_compressed_trim_op_saved|Innodb_num_page_compressed_trim_op_saved]] | Number of trim operations saved
| [[xtradbinnodb-server-status-variables#innodb_num_pages_page_decompressed |Innodb_num_pages_page_decompressed]] | Number of pages decompressed
| [[xtradbinnodb-server-status-variables#innodb_num_pages_page_compression_error|Innodb_num_pages_page_compression_error]] | Number of compression errors
&lt;&lt;/style&gt;&gt;

With InnoDB page compression, a page is only compressed when it is flushed to disk. This means that if you are monitoring InnoDB page compression via these status variables, then the status variables values will only get incremented when the dirty pages are flushed to disk, which does not necessarily happen immediately. For example:

&lt;&lt;sql&gt;&gt;
CREATE TABLE `tab` (
     `id` int(11) NOT NULL,
     `str` varchar(50) DEFAULT NULL,
     PRIMARY KEY (`id`)
   ) ENGINE=InnoDB;
 
INSERT INTO tab VALUES (1, &#39;str1&#39;);

SHOW GLOBAL STATUS LIKE &#39;Innodb_num_pages_page_compressed&#39;;
+----------------------------------+-------+
| Variable_name                    | Value |
+----------------------------------+-------+
| Innodb_num_pages_page_compressed | 0     |
+----------------------------------+-------+
 
SET GLOBAL innodb_file_per_table=ON;

SET GLOBAL innodb_file_format=&#39;Barracuda&#39;;

SET GLOBAL innodb_default_row_format=&#39;dynamic&#39;;

SET GLOBAL innodb_compression_algorithm=&#39;lzma&#39;;
 
ALTER TABLE tab PAGE_COMPRESSED=1;

SHOW GLOBAL STATUS LIKE &#39;Innodb_num_pages_page_compressed&#39;;
+----------------------------------+-------+
| Variable_name                    | Value |
+----------------------------------+-------+
| Innodb_num_pages_page_compressed | 0     |
+----------------------------------+-------+
 
SELECT SLEEP(10);
+-----------+
| SLEEP(10) |
+-----------+
|         0 |
+-----------+
 
SHOW GLOBAL STATUS LIKE &#39;Innodb_num_pages_page_compressed&#39;;
+----------------------------------+-------+
| Variable_name                    | Value |
+----------------------------------+-------+
| Innodb_num_pages_page_compressed | 3     |
+----------------------------------+-------+
&lt;&lt;/sql&gt;&gt;

== Compatibility with Backup Tools

[[mariabackup|Mariabackup]] supports InnoDB page compression.

[[percona-xtrabackup|Percona XtraBackup]] does not support InnoDB page compression.

== Acknowledgements

* InnoDB page compression was developed by collaborating with [[http://fusionio.com|Fusion-io]]. Special thanks especially to Dhananjoy Das and Torben Mathiasen.

== See Also

* [[storage-engine-independent-column-compression|Storage-Engine Independent Column Compression]]
* [[atomic-write-support|Atomic Write Support]]
* [[https://blog.mariadb.org/mariadb-introduces-atomic-writes/|MariaDB Introduces Atomic Writes]]
* [[http://smalldatum.blogspot.com/2015/09/third-day-with-innodb-transparent-page.html|Small Datum: Third day with InnoDB transparent page compression]]
* [[https://blog.mariadb.org/innodb-holepunch-compression-vs-the-filesystem-in-mariadb-10-1/|InnoDB holepunch compression vs the filesystem in MariaDB 10.1]]
* [[https://blog.mariadb.org/significant-performance-boost-with-new-mariadb-page-compression-on-fusionio/|Significant performance boost with new MariaDB page compression on FusionIO]]
* [[https://www.usenix.org/conference/inflow14/workshop-program/presentation/das|INFLOW &#39;14: NVM Compression—Hybrid Flash-Aware Application Level Compression]]</textarea>
    


                    <div id="content_disclaimer" class="graybox">
                        Content reproduced on this site is the property of its respective owners,
                        and this content is not reviewed in advance by MariaDB. The views, information and opinions
                        expressed by this content do not necessarily represent those of MariaDB or any other party.
                    </div>
                </div>
            </section>

            
        </div>
    </div>
</div>

<!-- Footer -->
<footer id="footer">
    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-xs-12">
                    <ul class="list-inline text-center footer-nav">
                        <li>
                            <h5>
                                <a href="https://mariadb.com/products" title="Products">Products</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/services" title="Services">Services</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/pricing" title="Pricing">Pricing</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/resources" title="Resources">Resources</a>
                            </h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/about-us" title="About MariaDB">About Us</a></h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/download" title="Download">Download MariaDB</a></h5>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="row row-10">
                
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div id="block-footerformcontact" class="block block-block-content block-block-contentd754ee1b-3cc9-40e7-9ef4-f504f1197fb1">
                        
                            <h5 style="font-weight: 400;">Subscribe to our newsletter!</h5>
                            <script src="//app-sj15.marketo.com/js/forms2/js/forms2.min.js"></script><form id="mktoForm_1498"></form>
                            <script>
                                <!--//--><![CDATA[// ><!--
                                MktoForms2.loadForm("//app-sj15.marketo.com", "573-PXI-984", 1498);
                                //--><!]]]]><![CDATA[>
                                //--><!]]>
                            </script>
                        
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div class="footer-copyright">
                        <div class="text-center">
                            <ul class="list-inline no-margin">
                                <li>
                                    <a href="/legal" title="Legal">Legal</a>
                                </li>
                                <li>
                                    <a href="/privacy-policy" title="Privacy Policy">Privacy Policy</a>
                                </li>
                                <li>
                                    <a href="/cookie-policy/" title="Cookies">Cookie Policy</a>
                                </li>
                            </ul>
                            <p>Copyright &copy; 2024 MariaDB. All rights reserved.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</footer>
</div>

<div id="ajax_loading">
    <img src="/kb/static/images/ajax-loader.a51c5608d01a.gif" />
</div>

    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MK2847"
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MK2847');</script>
    <!-- End Google Tag Manager -->

</body>

<script type="text/javascript" src="/kb/static/js/main.1587e3a666fc.js" charset="utf-8"></script>

</html>