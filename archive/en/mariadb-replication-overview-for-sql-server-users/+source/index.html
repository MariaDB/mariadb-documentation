<!DOCTYPE html>
<html>
<head data-cookie-domain=""
      data-cookie-path="/">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="apple-touch-icon" sizes="180x180" href="/kb/static/images/favicons/apple-touch-icon.159e713979be.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/kb/static/images/favicons/favicon-32x32.bc0ac1d5d11e.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/kb/static/images/favicons/favicon-16x16.5801f8f0f34e.png">
    <link rel="shortcut icon" href="/kb/static/images/favicons/favicon.d122d305dee4.ico" type="image/x-icon" />

    <title>MariaDB Replication Overview for SQL Server Users - Source - MariaDB Knowledge Base</title>

    <link href="/kb/static/css/main.f7633538c846.css" rel="stylesheet" type="text/css" />

    
        <meta name="robots" content="noindex, nofollow">
    

    

    <!-- FB Open Graph tags -->
    <meta property="og:title" content="MariaDB Replication Overview for SQL Server Users - Source" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://mariadb.com/kb/en/mariadb-replication-overview-for-sql-server-users/+source/" />
    <meta property="og:image" content="http://mariadb.comaskmonty-logo.png" />
    <meta property="og:site_name" content="MariaDB KnowledgeBase" />
    <meta property="fb:admins" content="514852603" />
    <meta property="og:description" content="" />

    <meta name="description" content="" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet"/>
    
</head>
<body class="mpkb nodes autoresize nodes_source jqui" id="nodes_source">





<div id="menu-mobile" class="visible-sm visible-xs">

    <div>
        <div id="mobile-close-menu" class="text-right">
            <a href="javascript:void(0)" title="Close Menu" id="back-main" class="toggle-menu">X<span></span></a>
        </div>
    </div>
    <div class="mainmenu-mobile">
        <ul class="ls-none ul-menu">
            <li data-sub="submenu5"><a class="open-form-search" href="/kb/search/" title="Search">Search </a></li>
            <li data-sub="submenu0"><a href="/products" title="Products">Products</a><span class="arrow-main"></span></li>
            <li data-sub="submenu1"><a href="/services" title="Services">Services</a><span class="arrow-main"></span></li>
            <li data-sub="submenu2"><a href="/resources" title="Resources">Resources</a><span class="arrow-main"></span></li>
            <li data-sub="submenu3"><a href="/about-us" title="About">About</a><span class="arrow-main"></span></li>
            <li data-sub="submenu4"><a href="/contact" title="Contact">Contact</a></li>
        </ul>
    </div>

    <div class="nav-top-mobile">
        <div class="select-box form">

            <ul class="inline-block-md mb-none top-nav">
                <li>

                </li>
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/mariadb-replication-overview-for-sql-server-users/+source/"> Login</a>
                    </li>
                
            </ul>



        </div>
        <p class="text-center copyright">Copyright &copy; 2025 MariaDB. All rights reserved.</p>
    </div>
</div>
<div class="violator-wrap d-none" id="top_violator">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12">
                <div class="violator-outer">
                    <div class="violator-inner">
                        <div class="row">
                            <div class="col-xs-12 col-sm-9 col-lg-7 col-lg-offset-2" id="top_violator_content">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="content-link" target="_blank" rel="nofollow noreferrer">
                                    <span>The Ultimate Guide to High Availability with MariaDB</span>
                                </a>
                            </div>
                            <div class="col-xs-12 col-sm-3" id="top_violator_cta">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="btn btn-mariadb" target="_blank" rel="nofollow noreferrer">Download Now</a>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-link close-btn">
                        <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24" width="15px" height="15px"><path d="M 4.9902344 3.9902344 A 1.0001 1.0001 0 0 0 4.2929688 5.7070312 L 10.585938 12 L 4.2929688 18.292969 A 1.0001 1.0001 0 1 0 5.7070312 19.707031 L 12 13.414062 L 18.292969 19.707031 A 1.0001 1.0001 0 1 0 19.707031 18.292969 L 13.414062 12 L 19.707031 5.7070312 A 1.0001 1.0001 0 0 0 18.980469 3.9902344 A 1.0001 1.0001 0 0 0 18.292969 4.2929688 L 12 10.585938 L 5.7070312 4.2929688 A 1.0001 1.0001 0 0 0 4.9902344 3.9902344 z"/></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="wrapper">
<div id="top-nav">
    <div class="container">
        <ul class="hidden-sm hidden-xs" >
            <li><a href="https://mariadb.com/kb/">Knowledge Base</a></li>
            <li><a href="https://mariadb.com/contact/">Contact</a></li>
            
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/mariadb-replication-overview-for-sql-server-users/+source/" rel="nofollow">Login</a>
                    </li>
                
            
            
            <li id="search-form">
                <form action="/kb/en/+search/" method="get" id="search-block-form" accept-charset="UTF-8">
                    <input id="search" title="Enter the terms you wish to search for."
                           placeholder="Search . . ." type="text"
                           name="q" value="" size="15" maxlength="128" class="form-text"
                           data-autocomplete-url="/kb/en/+search/autocomplete/">
                    <input type="hidden" name="quick" value="1" />
                    <input type="hidden" name="source" value="kb" />
                </form>
            </li>
            <li><a id="search-toggler" href="/kb/search/">Search</a></li>
            
        </ul>
    </div>
</div>
<div id="navbar-bottom" class="navbar">
    <div class="container">
        
        
        
        
        <div class="row">
            <div class="col-md-3 col-sm-9 col-xs-9">
                <a class="brand" href="/" title="MariaDB">
                    <img src="/kb/static/images/logo-2018-black.95f5978ae14d.png">
                </a>
            </div>
            <div class="col-md-9 hidden-sm hidden-xs">
                <div class="main-menu">
                    <ul id="main-menu" class="nav navbar-nav inline-block-sm">
    <li class="has-sub full-menu">
        <a href="/products" title="Products">Products</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/services" title="Services">Services</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/pricing" title="Pricing">Pricing</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/resources" title="Resources">Resources</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/about-us" title="About Us">About Us</a>
    </li>
    <li class="">
        <a class="button electric-eel small top-bar-right-download" href="/downloads/">Download</a>
    </li>
</ul>
                </div>
            </div>
            <div class="col-md-3 visible-sm visible-xs col-sm-3 col-xs-3 ps-rv">
                <div class="navbar-header text-right pull-right">
                    <button type="button" class="menu-control toggle-menu" id="open-menu">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="main">
    <div class="container">
        

        <div id="subheader1" class="clearfix">
            <div class="pull-left">
                
                <div id="breadcrumbs" class="breadcrumb">
                    <a href="/kb/en/">Knowledge Base</a>
                    


    
    » <a class="crumb" href="/kb/en/documentation/">MariaDB Server Documentation</a>
    

    
    » <a class="crumb" href="/kb/en/mariadb-administration/">MariaDB Administration</a>
    

    
    » <a class="crumb" href="/kb/en/getting-installing-and-upgrading-mariadb/">Getting, Installing, and Upgrading MariaDB</a>
    

    
    » <a class="crumb" href="/kb/en/migrating-to-mariadb/">Migrating to MariaDB</a>
    

    
    » <a class="crumb" href="/kb/en/migrating-to-mariadb-from-sql-server/">Migrating to MariaDB from SQL Server</a>
    


    » <a class="node_link crumb" href="/kb/en/mariadb-replication-overview-for-sql-server-users/">MariaDB Replication Overview for SQL Server Users</a>


                </div>
                
            </div>
        </div>
    </div>
    <div class="container" id="container-main">
        <div class="row">
            
            
                
                <aside id="sidebar-first" class="sidebar col-md-2 hidden-xs hidden-sm hidden-print">
                    
                        
                        <ul id="category_menu" class="nav nav-pills nav-stacked">
                            <li><a href="/kb/en/">Home</a></li>
                            
                                
                                    <li><a href="/kb/en/+questions/">Open Questions</a></li>
                                
                                <li><a href="/kb/en/documentation/">MariaDB Server</a></li>
                                <li><a href="/kb/en/maxscale/">MariaDB MaxScale</a></li>
                                <li><a href="/kb/en/mariadb-columnstore/">MariaDB ColumnStore</a></li>
                                <li><a href="/kb/en/connectors/">Connectors</a></li>
                            

                        </ul>
                    

                    
                        <div>
    

<div class="well well-small box actions"><div>

        <a class="btn btn-block btn-small" href="/kb/en/mariadb-replication-overview-for-sql-server-users/">Return to article</a>
    
</div>
</div>

</div>
                    

                    

































                </aside>
            
            
            
                
            
            
            <section id="content" class="limited_width col-md-10 clearfix">
                
                    <h1>MariaDB Replication Overview for SQL Server Users - Source</h1>
                

                



                <div>
                    

    

    
    <div class="revision_info">
        <dl class="table">
            <dt>Revision</dt>
            <dd><a href="/kb/en/mariadb-replication-overview-for-sql-server-users/+r/125976/">125976</a></dd>
            <dt>User</dt>
            <dd>
<span class="user" id="user-125">
<a href="/kb/user/id/125" title="Federico Razzoli">Federico Razzoli</a>
</span></dd>
            <dt>Date</dt>
            <dd>

<span class="datetime" title="2023-05-22 15:49">2023-05-22 15:49</span></dd>
        </dl>
    </div>
    


    

    
        
        <textarea id="answer_source" class="creole_source autogrow">&lt;&lt;toc&gt;&gt;

MariaDB supports the following types of replication:
* Asynchronous replication.
* Semi-synchronous replication.
* Galera Cluster.

&lt;&lt;product mariadb from=10.5.1&gt;&gt;
Note: in the snippets in this page, several SQL statements use the keyword ##SLAVE##. This word is considered inappropriate by some persons or cultures, so from MariaDB 10.5 it is possible to use the ##REPLICA## keyword, as a synonym.

Similar synonyms will be created in the future for status variables and system variables. See MDEV-18777 to track the status of these changes.
&lt;&lt;/product&gt;&gt;

== Asynchronous Replication

The original MariaDB replication system is asynchronous primary-replica replication.

A primary needs to have the [[binary-log|binary log]] enabled. The primary logs all data changes in the binary log. Every //event// (a binary log entry) is sent to all the replicas.

For a high-level description of the binary log for SQL Server users, see [[understanding-mariadb-architecture#the-binary-log|Understanding MariaDB Architecture]].

The events can be written in two formats: as an SQL statement (//statement-based replication//, or SBR), or as a binary representation of the change (//row-based replication//, or RBR). The former is generally slower, because the statement needs to be re-executed by the replicas. It is also less reliable, because some SQL statements are [[unsafe-statements-for-statement-based-replication|not deterministic]], so they could produce different results on the replicas. On the other hand row-based replication could make the binary log much bigger, and require more network traffic. For this reason, DML statements are always logged in statement format.

For more details on replication formats, see [[binary-log-formats|binary log formats]].

The replicas have an [[replication-threads#slave-io-thread|I/O thread]] that receives the binary log events and writes them to the [[relay-log|relay log]]. These events are then read by the [[replication-threads#slave-sql-thread|SQL thread]]. This thread could directly apply the changes to the local databases, and this was the only option before MariaDB 10.0.5. If [[#parallel-replication-and-group-commit|parallel replication]] is enabled, the SQL thread hands the events to the worker thread, that apply them to the databases. The latter method is recommended for performance reasons.

When a replica cannot apply an event to the local data, the SQL thread stops. This happens, for example, if the event is a row deletion but that row doesn&#39;t exist on the replica. There can be several reasons for this, for example non-deterministic statements, or a user deleted the row in the replica. To reduce the risk, it is recommended to set [[server-system-variables#read_only|read_only]] to 1 in the replicas.

[[show-slave-status|SHOW SLAVE STATUS]] has columns named ##Slave_SQL_State## and ##Slave_IO_State## that show, respectively, if the SQL thread and the IO thread are running. If they are not, the column ##Last_IO_Errno## and ##Last_IO_Error## (for the IO thread) or ##Last_SQL_Errno## and ##Last_SQL_Error## (for the SQL thread) show what the problem is.

In a replication chain, every server must have a unique [[replication-and-binary-log-system-variables#server_id|server_id]].

For more information on replication, see [[standard-replication|standard replication]].

=== Binary Log Coordinates, Relay Log Coordinates and GTID

The binary log coordinates provide a way to identify a certain data change made by a server. Coordinates consist of a file name and the position of the latest event, expressed as an integer. The last event coordinates can be seen with the [[show-master-status|SHOW MASTER STATUS]] columns ##File## and ##Position##. [[mariadb-dump]] includes them in a dump if the ##--master-data## option is used.

A replica uses primary binary log coordinates to identify the last event it read. This can be seen with the [[show-slave-status|SHOW SLAVE STATUS]] columns ##Master_Log_File## and ##Read_Master_Log_Pos##.

The columns ##Relay_Master_Log_File## and ##Exec_Master_Log_Pos## identify the primary event that corresponds to the last event applied by the SQL thread.

The replica relay log also has coordinates. The coordinates of the last applied event can be seen with the ##SHOW SLAVE STATUS## columns ##Relay_Log_File## and ##Relay_Log_Pos##.

To easily find out how far the replica is lagging behind the primary, we can look at ##Seconds_Behind_Master##.

Coordinates represented in this way have a problem: they are different on each server. Each server can use files with different (or the same) names, depending on its configuration. And files can be rotated at different times, including when a user runs [[flush|FLUSH LOGS]]. By enabling the GTID (global transaction id) an event will have the same id on the primary and on all the replicas.

When [[GTID]] is enabled, ##SHOW SLAVE STATUS## shows two GTIDs: ##Gtid_IO_Pos## is the last event written into the relay log, and ##Gtid_Slave_Pos## is the last event applied by the SQL thread. There is no need for a column identifying the same event in the primary, because the id is the same.

=== Provisioning a Replica

MariaDB does not have an equivalent to SQL Server&#39;s snapshot replication.

To setup a replica, it is necessary to manually provision it. It can be provisioned from the primary in this way:
* A backup from the primary must be restored on the new replica;
* The binary log coordinates at the moment of the backup should be set as replication coordinates in the replica, via [[change-master-to|CHANGE MASTER TO]].

However, if there is at least one existing replica, it is better to use it to provision the new replica:
* A backup from the existing replica must be restored in the new replica;
* The backup should include the system tables. In this way it will not be necessary to set the correct coordinates manually.

For more information see [[setting-up-replication|Setting Up Replication]] and [[setting-up-a-replica-with-mariabackup|Setting up a Replica with Mariabackup]].

=== Replication and Permissions

A replica connects to a primary using its credentials. See [[change-master-to|CHANGE MASTER TO]].

The appropriate account must be created in the primary, and it needs to have the ##REPLICATION SLAVE## permission.

See [[setting-up-replication|Setting Up Replication]] for more information.

=== Parallel Replication and Group Commit

MariaDB uses [[group-commit-for-the-binary-log|group commit]], which means that a group of events are physically written in the binary log altogether. This reduces the number of IOPS (input/output operations per second). Group commit cannot be disabled, but it can be tuned with variables like [[replication-and-binary-log-system-variables#binlog_commit_wait_count|binlog_commit_wait_count]] and [[replication-and-binary-log-system-variables#binlog_commit_wait_usec|binlog_commit_wait_usec]].

Replicas can apply the changes using multiple threads. This is known as [[parallel-replication|parallel replication]]. Before MariaDB 10.0.5 only one thread was used to apply changes. Since a primary can use many threads to write data, mono-thread replication is a well-known bottleneck. Parallel replication is not enabled by default. To use it, set the [[replication-and-binary-log-system-variables#slave_parallel_threads|slave_parallel_threads]] variable to a number greater than 1. If replication is running, the replica threads must be stopped in order to change this value:

&lt;&lt;sql&gt;&gt;
STOP SLAVE SQL_THREAD;
SET GLOBAL slave_parallel_threads = 4;
START SLAVE SQL_THREAD;
&lt;&lt;/sql&gt;&gt;

There are different parallel replication styles available: in-order and out-of-order. The exact mode in use is determined by the [[replication-and-binary-log-system-variables#slave_parallel_mode|slave_parallel_mode]] system variable. In parallel replication, the events are not replicated exactly in the same order as they occurred in the primary. But with an in-order replication mode the commit phase is always applied simultaneously. In this way data in the replica always reflect data as they have been in the primary at a certain point in time. Out-of-order replication is faster because there is less queuing, but it&#39;s not completely consistent with the primary. If two transactions modified different sets of rows in the primary, they could become visible in the replica in a different order.

##conservative## relies on primary group commit: events in different groups are executed in a parallel way.

##optimistic## does not try to find out which transaction can be executed in a parallel way - except for transactions that conflicted on the primary. Instead, it always tries to apply many events together, and rolls transactions back when there is a conflict.

##aggressive## is similar to optimistic, but it does not take into account which transactions conflicted in the primary.

##minimal## applies commits together, but all other events are applied in order.

Out-of-order replication cannot be enabled automatically by changing a variable in the replica. Instead, it must be enabled by the applications that run transactions in the primary. They can do this if the GTID is enabled. They can set different values for the [[replication-and-binary-log-system-variables#gtid_domain_id|gtid_domain_id]] variable in different transactions. This shifts a lot of responsibility to the application layer; however, if the application is aware of which transactions are not going to conflict and this information allows one to sensibly increase the parallelism, and using out-of-order replication can be a good idea.

Even if out-of-order replication is not normally used, it can be a good idea to use it for long running transactions or [[alter-table|ALTER TABLEs]], so they can be applied at the same time as normal operations that are not conflicting.

The impact of the number of threads and mode on performance can be partly seen with [[show-processlist|SHOW PROCESSLIST]], which shows the state of all threads. This includes the replication worker threads, and shows if they are blocking each other.

=== Differences Between the Primary and the Replicas

As a general rule, we want the primary and the replicas to contain exactly the same data. In this way, no conflicts are possible. Conflicts are the most likely cause of replication outages.

To reduce the possible causes of conflicts, the following best practices are recommended:
* Users must not change data in the replica directly. Set [[server-system-variables#read_only|read_only]] to 1. Note that this won&#39;t prevent root from making changes.
* Use the same table definitions in the primary and in the replica.
* Use ##ROW## binary log format on the primary.

Another cause of inconsistencies include MariaDB bugs and failover in case the primary crashes.

An open source third party tool is available to check if the primary and a replica are consistent. It is called pt-table-checksum. Another tool, pt-table-sync, can be used to eliminate the differences. Both are part of Percona Toolkit. The advice is to run pt-table-checksum periodically, and use pt-table-sync if inconsistencies are found.

If a replication outage occurs because an inconsistency is found, sometimes we want to quickly bring the replica up again as quickly as possible, and solve the core problem later. If GTID is not used, a way to do this is to run [[set-global-sql_slave_skip_counter|SET GLOBAL SQL_SLAVE_SKIP_COUNTER = 1]], which skips the problematic replication event.

If GTID is used, the [[gtid#gtid_slave_pos|gtid_slave_pos]] variable can be used instead. See the link for an explanation of how it works.

There are ways to have different data on the replicas. For example:
* Multi-source replication is possible. In this way, a replica will replicate data from multiple primaries. This feature is described below.
* [[replication-filters|Replication filters]] are supported. This allows one to exclude or include in replication specific tables, entire databases, or tables whose name matches a certain pattern. This allows one to avoid replicating data that is present in the primary but can always be rebuilt.
* [[replication-when-the-master-and-slave-have-different-table-definitions|Differences in table definitions]] are also possible. For example, a replica could have [[replication-when-the-master-and-slave-have-different-table-definitions#different-number-or-order-of-columns|more columns or less columns]] compared to the primary. In this way we can avoid replicating columns whose values can be rebuilt. Or we can add columns for analytics purposes, without having them in the primary. Be sure to understand the limitations and risks of this technique.

=== Delayed Replication

MariaDB supports delayed replication. This is the equivalent of setting a ##pollinginterval## in SQL Server.

To delay replication in a MariaDB replica, use [[change-master-to|CHANGE MASTER TO]] to specify a delay in seconds.

For more information, see [[delayed-replication|Delayed Replication]].

=== Multi-Source Replication

[[multi-source-replication|Multi-source replication]] is an equivalent to peer-to-peer replication, available in SQL Server Enterprise Edition.

A MariaDB replica can replicate from any number of primaries. It is very important that different primaries don&#39;t have the same tables. Otherwise there could be conflicts between data changes made on different primaries, and this will result in a replication outage.

In multi-source replication different channels exist, one for each primary.

This changed the way [[replication-commands|SQL replication statements]] work. [[show-processlist|SHOW PROCESSLIST]] returns a different row for each channel. Several statements, like [[change-master-to|CHANGE MASTER TO]], [[start-slave|START SLAVE]] or [[stop-slave|STOP SLAVE]]. accept a parameter which specifies which replication channel they should affect. For example, to stop a channel called ##wp1##:

&lt;&lt;sql&gt;&gt;
STOP SLAVE &#34;wp1&#34;;
&lt;&lt;/sql&gt;&gt;

Furthermore, variables that affect parallel replication can be prefixed with a channel name. This allow one to only use parallel replication for certain channels, or to tune it differently for each channel. For example, to enable parallel replication on a channel called ##wp1##:

&lt;&lt;sql&gt;&gt;
SET GLOBAL wp1.slave_parallel_threads = 4;
&lt;&lt;/sql&gt;&gt;

=== Dual Primary

It is possible to configure two servers in a way that each of them acts as a primary for the other server.

In this way, data could theoretically be inserted into any of these servers, and will then be replicated to the other server. However, in such a configuration conflicts are very likely. So it is impractical to use this technique to scale writes.

A dual primary (or primary-primary) configuration however can be useful for failover. In this case we talk about an //active primary// that receives reads and writes from the clients, and a //passive primary// that is not used until the active primary crashes.

Several problems should be considered in this scenario:
* If the active primary crashes, it is very possible that the passive primary did not receive all events yet, because replication is asynchronous. If the primary data are lost (for example because the disk is damaged), some data are also lost.
* If data is not lost, when we bring the primary up again, the latest events will be replicated by the other server. There could be conflicts that will break replication.
* When is the active primary considered down? Even if a server cannot reach it, the active primary could be running and it could be able to communicate with the passive primary. Switching the clients to the passive primary could lead to unnecessary problems. It is a good idea to always check ##SHOW SLAVE STATUS## to be sure that the two primary are not communicating.
* If we want to have more replicas, we should attach some of them to the active primary, and some of them to the passive primary. The reason is that when a server crashes, its replicas stop receiving any data. Failover is still possible, but it&#39;s better to have some servers that will not need any failover.

A safe primary-primary configuration where both servers accept writes, however, is possible. This is the case is data never conflicts. For example, the two servers could accept writes on different databases. We will have to decide what should happens in case of a server crash:
* Writes can be stopped until the server is up again. Reads can be sent to the other server, but keep in mind that the most recently written data could be missing.
* Both writes and reads can failover to the other server. All the problems mentioned above may apply to this situation.

See Sveta Smirnova&#39;s slides at MariaDB Day 2020: &#34;[[https://www.slideshare.net/SvetaSmirnova/how-safe-is-asynchronous-mastermaster-setup|How Safe is Asynchronous Master-Master Setup?]]&#34;.

== Semi-Synchronous Replication

Semi-synchronous replication was initially implemented as a plugin, in MySQL. Two different plugins needed to be used, one on the primary and the other on the replicas. Starting from MariaDB 10.3.3 it is built-in, which improved its performance.

The problem with standard replication is that there is no guarantee that it will not lag, even by long amounts of time. [[semisynchronous-replication|Semi-synchronous replication]] reduces this problem, at the cost of reducing the speed of the primary.

In semi-synchronous replication, when a transaction is committed on the primary, the primary does not immediately return control to the client. Instead, it sends the event to the replicas. After one replica reported that the commit was executed with success, the primary reports success to the client.

Semi-synchronous replication is useful for failover, therefore a dual primary setup is not needed in this case. If the primary crashes, the most up-to-date replica can be promoted to primary without losing any data.

=== Enabling Semi-Synchronous Replication

Semi-synchronous replication can be enabled at runtime in this way on the primary:
&lt;&lt;sql&gt;&gt;
SET GLOBAL rpl_semi_sync_master_enabled = ON;
&lt;&lt;/sql&gt;&gt;

Semi-synchronous replication is not used until it has been enabled on the replicas also. If the replicas are already replicating, the io_thread needs to be stopped and restarted. This can be done as follows:

&lt;&lt;sql&gt;&gt;
SET GLOBAL rpl_semi_sync_slave_enabled = ON;
STOP SLAVE IO_THREAD;
START SLAVE IO_THREAD;
&lt;&lt;/sql&gt;&gt;

=== Tuning the Wait Point and the Primary Timeout

The most important aspects to tune are the wait point and the primary timeout.

When the binary log is enabled, transactions must be committed both in the [[understanding-mariadb-architecture#storage-engines|storage engine]] (usually [[InnoDB]]) and in the [[understanding-mariadb-architecture#the-binary-log|binary log]]. Semi-synchronous replication requires that the transaction is also acknowledged by at least one replica before the primary can report success to the client.

The wait point determines at which point the primary must stop and wait for a confirmation from a replica. This is an important decision from disaster recovery standpoint, in case the primary crashes when a transaction is not fully committed. The [[semisynchronous-replication#rpl_semi_sync_master_wait_point|rpl_semi_sync_master_wait_point]] is used to set the wait point, Its allowed values are:
* ##AFTER_SYNC##: After committing the transaction in the binary log, but before committing it to the storage engine. After a crash, a transaction may be present in the binary log even if it was not committed.
* ##AFTER_COMMIT##. After committing a transaction both in the binary log and in the storage engine. In case of a crash, a transaction could possibly be committed in the primary but not replicated in the slaves. This is the default.

Primary timeout is meant to avoid that a primary remains stuck for a long time, or virtually forever, because no replica acknowledges a transaction. If primary timeout is reached, the primary switches to asynchronous replication. Before doing that, the primary writes an error in the [[error-log|error log]] and increments the [[semisynchronous-replication-plugin-status-variables#rpl_semi_sync_master_no_times|Rpl_semi_sync_master_no_times]] status variable.

The timeout is set via the [[semisynchronous-replication#rpl_semi_sync_master_timeout|rpl_semi_sync_master_timeout]] variable.

== Galera Cluster

[[galera-cluster|Galera]] is a technology that implements virtually synchronous, primary-primary replication for a cluster of MariaDB servers.

=== Raft and the Primary Cluster

Nodes of the cluster communicate using the Raft protocol. In case the cluster is partitioned or some nodes crash, a cluster knows that it&#39;s still the //primary cluster// if it has the //quorum//: half of the nodes + 1. Only the primary cluster accepts reads and writes.

For this reason a cluster should consist of an odd number of nodes. Imagine for example that a cluster consists of two nodes: if one of them crashes of the connection between them is interrupted, there will be no primary cluster.

=== Transaction Certification

A transaction can be executed against any node. The node will use a 2-phase commit. After running the transaction locally, the node will ask other nodes to //certify// it. This means that other nodes will receive it, and will try to apply it, and will report success or a failure. The node that received the transaction will not wait for an answer from all the nodes. Once it succeeded on more than half of the nodes (the quorum) the node will run the final commit and data becomes visible.

It is desirable to write data on only one node (unless it fails), or write different databases on different nodes. This will minimize the risk of conflicts.

=== Galera Cache and SST

Data changes applied are recorded for some time in the //Galera cache//. This is an on-disk cache, written in a circularly written file.

The size of Galera cache can be tuned using the [[wsrep_provider_options]] system variable, which contains many flags. We need to tune [[wsrep_provider_options#gcachesize|gcache.size]]. To tune it, add a line similar to the following to a configuration file:

&lt;&lt;code&gt;&gt;
wsrep_provider_options = &#39;gcache.size=2G&#39;;
&lt;&lt;/code&gt;&gt;

If a single transaction is bigger than half of the Galera cache, it needs to be written in a separate file, as //on-demand pages//. On-demand pages are regularly replaced. Whether a new page replaces an old one depends on another wsrep_provider_options flag: ##wsrep_provider_options#gcachekeep_pages_size|gcache.keep_pages_size##, which limits the total size of on-demand pages.

When a node is restarted (after a crash or for maintenance reasons), it will need to receive all the changes that were written by other nodes since the moment it was unreachable. A node is therefore chosen as a donor, possibly using the [[wsrep_provider_options#gcssync_donor|gcssync_donor]] wsrep_provider_options flag.

If possible, the donor will send all the recent changes, reading them from the Galera cache and on-demand pages. However, sometimes the Galera cache is not big enough to contain all the needed changes, or the on-demand pages have been overwritten because ##gcache.keep_pages_size## is not big enough. In these cases, a [[state-snapshot-transfers-ssts-in-galera-cluster|State Snapshot Transfer (SST)]] needs to be sent. This means that the donor will send the whole dataset to the restarted node. Most commonly, this happens using the [[mariabackup-sst-method|mariabackup method]].

=== Flow Control

While transaction certification is synchronous, certified transactions are applied locally in asynchronous fashion. However, a node should never lag too much behind others. To avoid that, a node may occasionally trigger a mechanism called //flow control// to ask other nodes to stop replication until its situation improves. Several [[wsrep_provider_options]] flags affect flow control.

[[wsrep_provider_options#gcsfc_master_slave|gcs.fc_master_slave]] should normally be set to 1 if all writes are sent to a single node.

[[wsrep_provider_options#gcsfc_limit|gcs.fc_limit]] is tuned automatically, unless [[wsrep_provider_options#gcsfc_master_slave|gcs.fc_master_slave]] is set to 0. The //receive queue// (the transactions received and not yet applied) should not exceed this limit. When this happens, flow control is triggered by the node to pause other node&#39;s replication.

Once flow control is activated, [[wsrep_provider_options#gcsfc_factor|gcs.fc_factor]] determines when it is released. It is a number from 0 to 1, and it represents a fraction. When the receive queue is below this fraction, the flow control is released.

Flow control and the receive queue can and should be monitored. The most useful metrics are:
* [[galera-cluster-status-variables/#wsrep_flow_control_paused|wsrep_flow_control_paused]] indicates how many times the replication has been paused as requested by other nodes, since the last ##FLUSH STATUS##.
* [[galera-cluster-status-variables/#wsrep_flow_control_sent|wsrep_flow_control_sent]] indicates how many times this node requested other nodes to pause replication.
* [[galera-cluster-status-variables/#wsrep_local_recv_queue|wsrep_local_recv_queue]] is the size of the receive queue.

=== Configuration

Galera is implemented as a plugin. Starting from version 10.1, MariaDB comes with Galera pre-installed, but not in use by default. To enable it one has to set the [[galera-cluster-system-variables#wsrep_on|wsrep_on]] system variable.

Like asynchronous replication, Galera uses the binary log. It also requires that data changes are logged in the ##ROW## format.

For other required settings, see [[configuring-mariadb-galera-cluster#mandatory-options|Mandatory Options]].

== Galera Limitations

Galera is not suitable for all databases and workloads.

* Galera only replicates [[innodb|InnoDB]] tables. Other storage engines should not be used.
* For performance reasons, it is highly desirable that all tables have a primary key.
* Long transactions will damage performance.
* Some applications use an integer [[auto_increment|AUTO_INCREMENT]] primary key. In case of failover from a crashed node to another, Galera does not guarantee that ##AUTO_INCREMENT## follows a chronological order. Therere, applications should use [[timestamp|TIMESTAMP]] columns for chronological order instead.</textarea>
    


                    <div id="content_disclaimer" class="graybox">
                        Content reproduced on this site is the property of its respective owners,
                        and this content is not reviewed in advance by MariaDB. The views, information and opinions
                        expressed by this content do not necessarily represent those of MariaDB or any other party.
                    </div>
                </div>
            </section>

            
        </div>
    </div>
</div>

<!-- Footer -->
<footer id="footer">
    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-xs-12">
                    <ul class="list-inline text-center footer-nav">
                        <li>
                            <h5>
                                <a href="https://mariadb.com/products" title="Products">Products</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/services" title="Services">Services</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/pricing" title="Pricing">Pricing</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/resources" title="Resources">Resources</a>
                            </h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/about-us" title="About MariaDB">About Us</a></h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/download" title="Download">Download MariaDB</a></h5>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="row row-10">
                
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div id="block-footerformcontact" class="block block-block-content block-block-contentd754ee1b-3cc9-40e7-9ef4-f504f1197fb1">
                        
                            <h5 style="font-weight: 400;">Subscribe to our newsletter!</h5>
                            <script src="//app-sj15.marketo.com/js/forms2/js/forms2.min.js"></script><form id="mktoForm_1498"></form>
                            <script>
                                <!--//--><![CDATA[// ><!--
                                MktoForms2.loadForm("//app-sj15.marketo.com", "573-PXI-984", 1498);
                                //--><!]]]]><![CDATA[>
                                //--><!]]>
                            </script>
                        
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div class="footer-copyright">
                        <div class="text-center">
                            <ul class="list-inline no-margin">
                                <li>
                                    <a href="/legal" title="Legal">Legal</a>
                                </li>
                                <li>
                                    <a href="/privacy-policy" title="Privacy Policy">Privacy Policy</a>
                                </li>
                                <li>
                                    <a href="/cookie-policy/" title="Cookies">Cookie Policy</a>
                                </li>
                            </ul>
                            <p>Copyright &copy; 2025 MariaDB. All rights reserved.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</footer>
</div>

<div id="ajax_loading">
    <img src="/kb/static/images/ajax-loader.a51c5608d01a.gif" />
</div>

    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MK2847"
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MK2847');</script>
    <!-- End Google Tag Manager -->

</body>

<script type="text/javascript" src="/kb/static/js/main.1587e3a666fc.js" charset="utf-8"></script>

</html>