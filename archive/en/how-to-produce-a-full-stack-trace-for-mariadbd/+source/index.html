<!DOCTYPE html>
<html>
<head data-cookie-domain=""
      data-cookie-path="/">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="apple-touch-icon" sizes="180x180" href="/kb/static/images/favicons/apple-touch-icon.159e713979be.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/kb/static/images/favicons/favicon-32x32.bc0ac1d5d11e.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/kb/static/images/favicons/favicon-16x16.5801f8f0f34e.png">
    <link rel="shortcut icon" href="/kb/static/images/favicons/favicon.d122d305dee4.ico" type="image/x-icon" />

    <title>How to Produce a Full Stack Trace for mariadbd - Source - MariaDB Knowledge Base</title>

    <link href="/kb/static/css/main.f7633538c846.css" rel="stylesheet" type="text/css" />

    
        <meta name="robots" content="noindex, nofollow">
    

    

    <!-- FB Open Graph tags -->
    <meta property="og:title" content="How to Produce a Full Stack Trace for mariadbd - Source" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://mariadb.com/kb/en/how-to-produce-a-full-stack-trace-for-mariadbd/+source/" />
    <meta property="og:image" content="http://mariadb.comaskmonty-logo.png" />
    <meta property="og:site_name" content="MariaDB KnowledgeBase" />
    <meta property="fb:admins" content="514852603" />
    <meta property="og:description" content="" />

    <meta name="description" content="" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet"/>
    
</head>
<body class="mpkb nodes autoresize nodes_source jqui" id="nodes_source">





<div id="menu-mobile" class="visible-sm visible-xs">

    <div>
        <div id="mobile-close-menu" class="text-right">
            <a href="javascript:void(0)" title="Close Menu" id="back-main" class="toggle-menu">X<span></span></a>
        </div>
    </div>
    <div class="mainmenu-mobile">
        <ul class="ls-none ul-menu">
            <li data-sub="submenu5"><a class="open-form-search" href="/kb/search/" title="Search">Search </a></li>
            <li data-sub="submenu0"><a href="/products" title="Products">Products</a><span class="arrow-main"></span></li>
            <li data-sub="submenu1"><a href="/services" title="Services">Services</a><span class="arrow-main"></span></li>
            <li data-sub="submenu2"><a href="/resources" title="Resources">Resources</a><span class="arrow-main"></span></li>
            <li data-sub="submenu3"><a href="/about-us" title="About">About</a><span class="arrow-main"></span></li>
            <li data-sub="submenu4"><a href="/contact" title="Contact">Contact</a></li>
        </ul>
    </div>

    <div class="nav-top-mobile">
        <div class="select-box form">

            <ul class="inline-block-md mb-none top-nav">
                <li>

                </li>
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/how-to-produce-a-full-stack-trace-for-mariadbd/+source/"> Login</a>
                    </li>
                
            </ul>



        </div>
        <p class="text-center copyright">Copyright &copy; 2024 MariaDB. All rights reserved.</p>
    </div>
</div>
<div class="violator-wrap d-none" id="top_violator">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12">
                <div class="violator-outer">
                    <div class="violator-inner">
                        <div class="row">
                            <div class="col-xs-12 col-sm-9 col-lg-7 col-lg-offset-2" id="top_violator_content">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="content-link" target="_blank" rel="nofollow noreferrer">
                                    <span>The Ultimate Guide to High Availability with MariaDB</span>
                                </a>
                            </div>
                            <div class="col-xs-12 col-sm-3" id="top_violator_cta">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="btn btn-mariadb" target="_blank" rel="nofollow noreferrer">Download Now</a>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-link close-btn">
                        <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24" width="15px" height="15px"><path d="M 4.9902344 3.9902344 A 1.0001 1.0001 0 0 0 4.2929688 5.7070312 L 10.585938 12 L 4.2929688 18.292969 A 1.0001 1.0001 0 1 0 5.7070312 19.707031 L 12 13.414062 L 18.292969 19.707031 A 1.0001 1.0001 0 1 0 19.707031 18.292969 L 13.414062 12 L 19.707031 5.7070312 A 1.0001 1.0001 0 0 0 18.980469 3.9902344 A 1.0001 1.0001 0 0 0 18.292969 4.2929688 L 12 10.585938 L 5.7070312 4.2929688 A 1.0001 1.0001 0 0 0 4.9902344 3.9902344 z"/></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="wrapper">
<div id="top-nav">
    <div class="container">
        <ul class="hidden-sm hidden-xs" >
            <li><a href="https://mariadb.com/kb/">Knowledge Base</a></li>
            <li><a href="https://mariadb.com/contact/">Contact</a></li>
            
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/how-to-produce-a-full-stack-trace-for-mariadbd/+source/" rel="nofollow">Login</a>
                    </li>
                
            
            
            <li id="search-form">
                <form action="/kb/en/+search/" method="get" id="search-block-form" accept-charset="UTF-8">
                    <input id="search" title="Enter the terms you wish to search for."
                           placeholder="Search . . ." type="text"
                           name="q" value="" size="15" maxlength="128" class="form-text"
                           data-autocomplete-url="/kb/en/+search/autocomplete/">
                    <input type="hidden" name="quick" value="1" />
                    <input type="hidden" name="source" value="kb" />
                </form>
            </li>
            <li><a id="search-toggler" href="/kb/search/">Search</a></li>
            
        </ul>
    </div>
</div>
<div id="navbar-bottom" class="navbar">
    <div class="container">
        
        
        
        
        <div class="row">
            <div class="col-md-3 col-sm-9 col-xs-9">
                <a class="brand" href="/" title="MariaDB">
                    <img src="/kb/static/images/logo-2018-black.95f5978ae14d.png">
                </a>
            </div>
            <div class="col-md-9 hidden-sm hidden-xs">
                <div class="main-menu">
                    <ul id="main-menu" class="nav navbar-nav inline-block-sm">
    <li class="has-sub full-menu">
        <a href="/products" title="Products">Products</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/services" title="Services">Services</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/pricing" title="Pricing">Pricing</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/resources" title="Resources">Resources</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/about-us" title="About Us">About Us</a>
    </li>
    <li class="">
        <a class="button electric-eel small top-bar-right-download" href="/downloads/">Download</a>
    </li>
</ul>
                </div>
            </div>
            <div class="col-md-3 visible-sm visible-xs col-sm-3 col-xs-3 ps-rv">
                <div class="navbar-header text-right pull-right">
                    <button type="button" class="menu-control toggle-menu" id="open-menu">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="main">
    <div class="container">
        

        <div id="subheader1" class="clearfix">
            <div class="pull-left">
                
                <div id="breadcrumbs" class="breadcrumb">
                    <a href="/kb/en/">Knowledge Base</a>
                    


    
    » <a class="crumb" href="/kb/en/training-tutorials/">Training &amp; Tutorials</a>
    

    
    » <a class="crumb" href="/kb/en/advanced-mariadb-articles/">Advanced MariaDB Articles</a>
    

    
    » <a class="crumb" href="/kb/en/development-articles/">Development Articles</a>
    

    
    » <a class="crumb" href="/kb/en/debugging-mariadb/">Debugging MariaDB</a>
    


    » <a class="node_link crumb" href="/kb/en/how-to-produce-a-full-stack-trace-for-mariadbd/">How to Produce a Full Stack Trace for mariadbd</a>


                </div>
                
            </div>
        </div>
    </div>
    <div class="container" id="container-main">
        <div class="row">
            
            
                
                <aside id="sidebar-first" class="sidebar col-md-2 hidden-xs hidden-sm hidden-print">
                    
                        
                        <ul id="category_menu" class="nav nav-pills nav-stacked">
                            <li><a href="/kb/en/">Home</a></li>
                            
                                
                                <li><a href="/kb/en/documentation/">MariaDB Server</a></li>
                                <li><a href="/kb/en/maxscale/">MariaDB MaxScale</a></li>
                                <li><a href="/kb/en/mariadb-columnstore/">MariaDB ColumnStore</a></li>
                                <li><a href="/kb/en/connectors/">Connectors</a></li>
                            

                        </ul>
                    

                    
                        <div>
    

<div class="well well-small box actions"><div>

        <a class="btn btn-block btn-small" href="/kb/en/how-to-produce-a-full-stack-trace-for-mariadbd/">Return to article</a>
    
</div>
</div>

</div>
                    

                    

































                </aside>
            
            
            
                
            
            
            <section id="content" class="limited_width col-md-10 clearfix">
                
                    <h1>How to Produce a Full Stack Trace for mariadbd - Source</h1>
                

                



                <div>
                    

    

    
    <div class="revision_info">
        <dl class="table">
            <dt>Revision</dt>
            <dd><a href="/kb/en/how-to-produce-a-full-stack-trace-for-mariadbd/+r/139030/">139030</a></dd>
            <dt>User</dt>
            <dd>
<span class="user" id="user-7">
<a href="/kb/user/id/7" title="Michael Widenius">Michael Widenius</a>
</span></dd>
            <dt>Date</dt>
            <dd>

<span class="datetime" title="2024-05-15 04:15">2024-05-15 04:15</span></dd>
        </dl>
    </div>
    


    

    
        
        <textarea id="answer_source" class="creole_source autogrow">&lt;&lt;toc layout=standalone depth=3&gt;&gt;

== Partial Stack Traces in the Error Log

When ##mariadbd## crashes, it will write a stack trace in the [[error-log|error log]] by default. This is because the [[mariadbd-options/#-stack-trace|stack_trace]] option defaults to ##ON##. With a normal release build, this stack trace in the [[error-log|error log]] may look something like this:

&lt;&lt;code&gt;&gt;
2019-03-28 23:31:08 0x7ff4dc62d700  InnoDB: Assertion failure in file /home/buildbot/buildbot/build/mariadb-10.2.23/storage/innobase/rem/rem0rec.cc line 574
InnoDB: We intentionally generate a memory trap.
InnoDB: Submit a detailed bug report to https://jira.mariadb.org/
InnoDB: If you get repeated assertion failures or crashes, even
InnoDB: immediately after the mysqld startup, there may be
InnoDB: corruption in the InnoDB tablespace. Please refer to
InnoDB: https://mariadb.com/kb/en/library/innodb-recovery-modes/
InnoDB: about forcing recovery.
190328 23:31:08 [ERROR] mysqld got signal 6 ;
This could be because you hit a bug. It is also possible that this binary
or one of the libraries it was linked against is corrupt, improperly built,
or misconfigured. This error can also be caused by malfunctioning hardware.
 
To report this bug, see https://mariadb.com/kb/en/reporting-bugs
 
We will try our best to scrape up some info that will hopefully help
diagnose the problem, but since we have already crashed, 
something is definitely wrong and this may fail.
 
Server version: 10.2.23-MariaDB-10.2.23+maria~stretch
key_buffer_size=134217728
read_buffer_size=131072
max_used_connections=234
max_threads=752
thread_count=273
It is possible that mysqld could use up to 
key_buffer_size + (read_buffer_size + sort_buffer_size)*max_threads = 1783435 K  bytes of memory
Hope that&#39;s ok; if not, decrease some variables in the equation.
 
Thread pointer: 0x7ff4d8001f28
Attempting backtrace. You can use the following information to find out
where mysqld died. If you see no messages after this, something went
terribly wrong...
stack_bottom = 0x7ff4dc62ccc8 thread_stack 0x49000
*** buffer overflow detected ***: /usr/sbin/mysqld terminated
======= Backtrace: =========
/lib/x86_64-linux-gnu/libc.so.6(+0x70bfb)[0x7ffa09af5bfb]
/lib/x86_64-linux-gnu/libc.so.6(__fortify_fail+0x37)[0x7ffa09b7e437]
/lib/x86_64-linux-gnu/libc.so.6(+0xf7570)[0x7ffa09b7c570]
/lib/x86_64-linux-gnu/libc.so.6(+0xf93aa)[0x7ffa09b7e3aa]
/usr/sbin/mysqld(my_addr_resolve+0xe2)[0x55ca42284922]
/usr/sbin/mysqld(my_print_stacktrace+0x1bb)[0x55ca4226b1eb]
/usr/sbin/mysqld(handle_fatal_signal+0x41d)[0x55ca41d0a01d]
/lib/x86_64-linux-gnu/libpthread.so.0(+0x110e0)[0x7ffa0b4180e0]
/lib/x86_64-linux-gnu/libc.so.6(gsignal+0xcf)[0x7ffa09ab7fff]
/lib/x86_64-linux-gnu/libc.so.6(abort+0x16a)[0x7ffa09ab942a]
/usr/sbin/mysqld(+0x40f971)[0x55ca41ab8971]
/usr/sbin/mysqld(+0x887df6)[0x55ca41f30df6]
/usr/sbin/mysqld(+0x863673)[0x55ca41f0c673]
/usr/sbin/mysqld(+0x96648e)[0x55ca4200f48e]
/usr/sbin/mysqld(+0x89b559)[0x55ca41f44559]
/usr/sbin/mysqld(+0x8a15e4)[0x55ca41f4a5e4]
/usr/sbin/mysqld(+0x8a2187)[0x55ca41f4b187]
/usr/sbin/mysqld(+0x8b1a20)[0x55ca41f5aa20]
/usr/sbin/mysqld(+0x7f5c04)[0x55ca41e9ec04]
/usr/sbin/mysqld(_ZN7handler12ha_write_rowEPh+0x107)[0x55ca41d140d7]
/usr/sbin/mysqld(_Z12write_recordP3THDP5TABLEP12st_copy_info+0x72)[0x55ca41b4b992]
/usr/sbin/mysqld(_Z12mysql_insertP3THDP10TABLE_LISTR4ListI4ItemERS3_IS5_ES6_S6_15enum_duplicatesb+0x1206)[0x55ca41b560f6]
/usr/sbin/mysqld(_Z21mysql_execute_commandP3THD+0x3f68)[0x55ca41b6bee8]
/usr/sbin/mysqld(_Z11mysql_parseP3THDPcjP12Parser_statebb+0x28a)[0x55ca41b70e4a]
/usr/sbin/mysqld(+0x4c864f)[0x55ca41b7164f]
/usr/sbin/mysqld(_Z16dispatch_command19enum_server_commandP3THDPcjbb+0x1a7c)[0x55ca41b737fc]
/usr/sbin/mysqld(_Z10do_commandP3THD+0x176)[0x55ca41b748a6]
/usr/sbin/mysqld(_Z24do_handle_one_connectionP7CONNECT+0x25a)[0x55ca41c3ec0a]
/usr/sbin/mysqld(handle_one_connection+0x3d)[0x55ca41c3ed7d]
/usr/sbin/mysqld(+0xb75791)[0x55ca4221e791]
/lib/x86_64-linux-gnu/libpthread.so.0(+0x74a4)[0x7ffa0b40e4a4]
/lib/x86_64-linux-gnu/libc.so.6(clone+0x3f)[0x7ffa09b6dd0f]
&lt;&lt;/code&gt;&gt;

If you plan to [[mariadb-community-bug-reporting|report a bug]] about the problem, then this information can be very useful for MariaDB&#39;s developers to track down the root cause. However, notice that some of the function names in the call stack are missing. In some cases, this partial stack trace may not be enough to find out exactly where the problem is.

A full stack trace can only be produced if you have debugging symbols for your ##mariadbd## binary. 

== Obtaining Debugging Symbols for Your mariadbd executable

Debug information is used by debugging tools to produce a meaningful stack trace. Importantly these packages do not replace any executables or any existing production executables or in any way interfere with the way the production server ran before these packages where installed.

If you are obtaining a backtrace for a coredump, you can move the core dump to a difference server that has the identical mariadb-server and debug info packages, and perform the backtrace there with no loss of information.

=== Installing Debug Info Packages on Linux

On some Linux distributions, you may be able to install ##debuginfo## packages that contain debugging symbols.

Currently, ##debuginfo## packages may not allow the server to print a nice stack trace in the error log. They also allow users to extract full stack traces from core dumps. See MDEV-20738 for more information.

==== Installing Debug Info Packages with yum/dnf

The MariaDB ##yum## repository contains ##[[https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Developer_Guide/intro.debuginfo.html|debuginfo]]## packages.

On RHEL, CentOS, Fedora, and other similar Linux distributions, it is highly recommended to install the relevant [[rpm|RPM package]] from MariaDB&#39;s repository using ##[[yum|yum]]## or ##[[https://en.wikipedia.org/wiki/DNF_(software)|dnf]]##. Starting with RHEL 8 and Fedora 22, ##yum## has been replaced by ##dnf##, which is the next major version of ##yum##. However, ##yum## commands still work on many systems that use ##dnf##. For example:

&lt;&lt;code&gt;&gt;
sudo yum install MariaDB-server-debuginfo
&lt;&lt;/code&gt;&gt;

See [[yum/#installing-debug-info-packages-with-yum|Installing MariaDB with yum/dnf: Installing Debug Info Packages with YUM]] for more information.

==== Installing Debug Info Packages with zypper

The MariaDB ##zypper## repository contains ##[[https://en.opensuse.org/openSUSE:Packaging_guidelines#Debuginfo|debuginfo]]## packages.

On SLES, OpenSUSE, and other similar Linux distributions, it is highly recommended to install the relevant [[rpm|RPM package]] from MariaDB&#39;s repository using ##[[installing-mariadb-with-zypper|zypper]]##. For example:

&lt;&lt;code&gt;&gt;
sudo zypper install MariaDB-server-debuginfo
&lt;&lt;/code&gt;&gt;

See [[installing-mariadb-with-zypper/#installing-debug-info-packages-with-zypp|Installing MariaDB with zypper: Installing Debug Info Packages with ZYpp]] for more information.

==== Installing Debug Info Packages from MariaDB&#39;s Debian or Ubuntu repository

These are for when you already installed MariaDB from a MariaDB mirror.

For Ubuntu an additional repository step is needed:
&lt;&lt;code&gt;&gt;
sudo add-apt-repository &#39;deb [arch=amd64,arm64,ppc64el,s390x]  https://ftp.osuosl.org/pub/mariadb/repo/10.5/ubuntu focal main/debug&#39;
&lt;&lt;/code&gt;&gt;

Adjust ##10.5## to the major version you are debugging and ##focal## to the required distribution.

&lt;&lt;code&gt;&gt;
apt-get update &amp;&amp; apt-get install -y mariadb-server-core-10.5-dbgsym
&lt;&lt;/code&gt;&gt;

From MariaDB 10.9 the version isn&#39;t included in the package name and ##mariadb-server-core-dbgsym## can be used as the package name.

==== Installing Debug Info Packages packaged by Ubuntu or Debian

If you used the MariaDB versions provided by Debian or Ubuntu see the following links.
 
For Debian see https://wiki.debian.org/AutomaticDebugPackages

For Ubuntu see https://wiki.ubuntu.com/Debug%20Symbol%20Packages

=== Installing Debugging Symbols on Windows

Debugging symbols are available to install on Windows.

==== Installing Debugging Symbols with the MSI Installer on Windows

Debugging symbols can be installed with the [[installing-mariadb-msi-packages-on-windows|MSI]] installer. Debugging symbols are not installed by default. You must perform a custom installation and explicitly choose to install debugging symbols.

The [[installing-mariadb-msi-packages-on-windows|MSI]] installer can be downloaded from the [[https://downloads.mariadb.org|MariaDB downloads page]].

==== Installing Debugging Symbols with the ZIP Package on Windows

MariaDB also provides a [[installing-mariadb-windows-zip-packages|ZIP]] package that contains debugging symbols on Windows.

The [[installing-mariadb-windows-zip-packages|ZIP]] package that contains debugging symbol can be downloaded from the [[https://downloads.mariadb.org|MariaDB downloads page]].

=== Containers with Debug Symbols

==== Prebuilt Debug Containers

These are currently only per major release version and are generated out of CI. They are always the latest version in the main branch on [[https://github.com/MariaDB/server|GitHub]].

There are available on at https://quay.io/repository/mariadb-foundation/mariadb-debug?tab=tags.

Use the container name ##quay.io/mariadb-foundation/mariadb-debug:VERSION##.

Where ##VERSION## corresponds to the major version you wish to test with.

==== Creating a Container with Debugging Symbols

Build using a Containerfile/Dockerfile: 
&lt;&lt;code&gt;&gt;
ARG VERSION=10.11
FROM mariadb:$VERSION

RUN apt-get update \
        &amp;&amp; apt-get install -y gdb mariadb-server-core-dbgsym=$(dpkg -s mariadb-server-core |  awk &#39;/Version/{print $NF}&#39;) ; \
        rm -rf /var/lib/apt/lists/*
&lt;&lt;/code&gt;&gt;

Build with:
&lt;&lt;code&gt;&gt;
buildah bud --tag mariadb_debug --build-arg VERSION=10.11.6 -f Containerfile .
&lt;&lt;/code&gt;&gt;

Then you will have a ##mariadb_debug## container.

Example use:
&lt;&lt;code&gt;&gt;
podman run --entrypoint gdb --user mysql --volume mariadb_data:/var/lib/mysql mariadb_debug -ex r --args /usr/sbin/mariadbd
&lt;&lt;/code&gt;&gt;

== Enabling Core Dumps

To enable core dumps, see [[enabling-core-dumps|Enabling Core Dumps]] for details.

== Where is the Core File on Linux?

At the bottom of the error log there will be some text about the core location including:

&lt;&lt;code&gt;&gt;
Writing a core file...
Working directory at /var/lib/mariadb
Resource Limits:
Limit                     Soft Limit           Hard Limit           Units     
...
Max core file size        unlimited            unlimited            bytes     
...
Core pattern: |/usr/lib/systemd/systemd-coredump %P %u %g %s %t %c %h

Kernel version: Linux version 6.0.0-0.rc2.19.fc38.x86_64 (mockbuild@bkernel01.iad2.fedoraproject.org) (gcc (GCC) 12.2.1 20220819 (Red Hat 12.2.1-1), GNU ld version 2.39-2.fc38) #1 SMP PREEMPT_DYNAMIC Mon Aug 22 12:52:40 UTC 2022
&lt;&lt;/code&gt;&gt;

If the was a core limit in the resource limits there may be limited or no core file information.

If the core pattern begins with a **|**, then the following is the executable that handled the core file during the crash. The following show a few techniques to access the core depending on the pattern. If another program is used, look at its manual page to see how to get access to the core file.

If a plain core filename is in the &#34;Core pattern&#34; there&#39;s a good chance it will be in the Working directory location. It might have a ##.{process number}## suffix on the filename.

=== Extracting a core file from a container

If you are running MariaDB in a container, the locations where the core dump can be generated are limited. Looking at the container log, this will likely be where the error log information is. The &#34;Core pattern&#34; of a Linux system is currently a global fixed value. The consequence is if this core pattern refers to a program, that program isn&#39;t likely to be in the container and won&#39;t be executed on the crash.

The system wide crash handler can be changed with ##sysctl kernel.core_pattern=core## to set this back to a file based crash. With this, the crash should occur in the working directory, normally the ##/var/lib/mysql## data directory of the container volume.

=== Extracting a core file from systemd-coredump

For ##systemd-coredump##, there is a program ##coredumpctl## to manage access.

&lt;&lt;code&gt;&gt;
coredumpctl list
TIME                            PID   UID   GID SIG     COREFILE EXE                                                                                        &gt;
Fri 2022-09-09 14:16:37 AEST 213571  1000  1000 SIGSEGV present  /usr/sbin/mariadbd 
&lt;&lt;/code&gt;&gt;

To access the program using ##gdb##, ##coredumpctl debug## (defaults to last crash), will load the core dump in gdb. The instructions in the [[#getting-backtraces-with-gdb-on-linux|next section]] for extracting information.

See also: [[enabling-core-dumps/#extracting-linux-core-dumps-with-systemd-coredump|extracting core dumps with systemd-coredump]].

=== Extract a core file from abrt

A core pattern of ##|/usr/libexec/abrt-hook-ccpp## indicates ##abrt## system is used.

##[[https://abrt.readthedocs.io/en/latest/usage.html|abrt-cli]]## is a command line user interface for access the core file.

=== Extract a core file from apport

A core pattern of ##[|/usr/share/apport/apport## indicates ##apport##.

For more information see [[https://wiki.ubuntu.com/Apport|Apport Project Wiki]].

##[[https://wiki.ubuntu.com/DebuggingProgramCrash#Using_apport-retrace|apport-retrace]]## allows you to &#34;Examine Locally&#34; and run a ##gdb## session. One you have gdb started instructions in the [[#getting-backtraces-with-gdb-on-linux|next section]] can be used for extracting information.

== Analyzing a Core File with ##gdb## on Linux

To analyze the core file on Linux, you can use ##[[https://www.gnu.org/software/gdb/documentation|gdb]]##.

For example, to open a core file with ##[[https://www.gnu.org/software/gdb/documentation|gdb]]##, you could execute the following:

&lt;&lt;code&gt;&gt;
sudo gdb /usr/sbin/mariadbd  /var/lib/mysql/core.932
&lt;&lt;/code&gt;&gt;

Be sure to replace ##/usr/sbin/mariadbd## with the path to your ##mariadbd## binary (might be ##mysqld## on MariaDB 10.4 and earlier) and to also replace ##/var/lib/mysql/core.932## with the path to your core file.

Once ##[[https://www.gnu.org/software/gdb/documentation|gdb]]## has opened the core file, if you want to [[https://sourceware.org/gdb/current/onlinedocs/gdb/Logging-Output.html#Logging-Output|log all output to a file]], then you could execute the following commands:

&lt;&lt;code&gt;&gt;
set logging file /tmp/gdb_output.log
set logging on
&lt;&lt;/code&gt;&gt;

If you do not execute ##set logging file##, then the ##set logging on## command creates a ##gdb.txt## in your current working directory. Redirecting the output to a file is useful, because it can make it easier to analyze. It also makes it easier to send the information to a MariaDB developer, if that becomes necessary.

Do any commands that you would like to do. For example, you could [[#getting-backtraces-with-gdb-on-linux|get the backtraces]].

Once you are done, you can exit ##[[https://www.gnu.org/software/gdb/documentation|gdb]]## by executing the ##[[https://sourceware.org/gdb/current/onlinedocs/gdb/Quitting-GDB.html#Quitting-GDB|quit]]## command.

== Getting Backtraces with ##gdb## on Linux

On Linux, once you have debugging symbols for your ##mariadbd## binary, you can use the ##[[https://www.gnu.org/software/gdb/documentation|gdb]]## utility to get [[https://sourceware.org/gdb/current/onlinedocs/gdb/Backtrace.html#Backtrace|backtraces]], which are what ##gdb## calls stack traces. Backtraces can be obtained from a core file or from a running ##mariadbd## process.

Full [[https://sourceware.org/gdb/current/onlinedocs/gdb/Backtrace.html#Backtrace|backtraces]] are preferred and will contain function arguments, which can contain useful information such as query strings, so it can make the information easier to analyze.

To get a **full** [[https://sourceware.org/gdb/current/onlinedocs/gdb/Backtrace.html#Backtrace|backtrace]] of the main thread, then you could execute the following:

&lt;&lt;code&gt;&gt;
bt -frame-arguments all full
&lt;&lt;/code&gt;&gt;

If you want to get a **full** [[https://sourceware.org/gdb/current/onlinedocs/gdb/Backtrace.html#Backtrace|backtrace]] of **all** threads, then you could execute the following:

&lt;&lt;code&gt;&gt;
thread apply all bt -frame-arguments all full
&lt;&lt;/code&gt;&gt;

If you want to get a full backtrace to a file to report a bug, the recommended way is to use gdb:

&lt;&lt;code&gt;&gt;
set logging on
set pagination off
set print frame-arguments all
thread apply all bt full
set logging off
&lt;&lt;/code&gt;&gt;

This will write the full backtrace into the file ##gdb.txt##.

=== Getting Full Backtraces For All Threads From a Core File

Sometimes it can be helpful to get **full** [[https://sourceware.org/gdb/current/onlinedocs/gdb/Backtrace.html#Backtrace|backtraces]] for all threads. The full [[https://sourceware.org/gdb/current/onlinedocs/gdb/Backtrace.html#Backtrace|backtraces]] will contain function arguments, which can contain useful information such as query strings, so it can make the information easier to analyze.

To get **full** [[https://sourceware.org/gdb/current/onlinedocs/gdb/Backtrace.html#Backtrace|backtraces]] for all threads from a  ##mariadbd## core file, execute a command like the following:

&lt;&lt;code&gt;&gt;
sudo gdb --batch --eval-command=&#34;set print frame-arguments all&#34; --eval-command=&#34;thread apply all bt full&#34; /usr/sbin/mariadbd /var/lib/mysql/core.932  &gt; mariadbd_full_bt_all_threads.txt
&lt;&lt;/code&gt;&gt;

Be sure to replace ##/usr/sbin/mariadbd## with the path to your ##mariadbd## binary and to also replace ##/var/lib/mysql/core.932## with the path to your core dump.

The [[https://sourceware.org/gdb/current/onlinedocs/gdb/Backtrace.html#Backtrace|backtraces]] will be output to the file ##mariadbd_full_bt_all_threads.txt##.

=== Getting Full Backtraces For All Threads From a Running ##mariadbd## Process

Sometimes it can be helpful to get **full** [[https://sourceware.org/gdb/current/onlinedocs/gdb/Backtrace.html#Backtrace|backtraces]] for all threads. The full backtraces will contain function arguments, which can contain useful information such as query strings, so it can make the information easier to analyze.

To get **full** [[https://sourceware.org/gdb/current/onlinedocs/gdb/Backtrace.html#Backtrace|backtraces]] for all threads from a running ##mariadbd## process, execute a command like the following:

&lt;&lt;code&gt;&gt;
sudo gdb --batch --eval-command=&#34;set print frame-arguments all&#34;  --eval-command=&#34;thread apply all bt full&#34; /usr/sbin/mariadbd $(pgrep -xn mariadbd)  &gt; mariadbd_full_bt_all_threads.txt
&lt;&lt;/code&gt;&gt;

Be sure to replace ##/usr/sbin/mariadbd## with the path to your ##mariadbd## binary.

The [[https://sourceware.org/gdb/current/onlinedocs/gdb/Backtrace.html#Backtrace|backtraces]] will be output to the file ##mariadbd_full_bt_all_threads.txt##.

Sometimes very busy systems are too busy to batch obtain the backtrace. If this is the case, ##gcore $(pidof mariadbd)## can save the core and then obtain the backtrace out of the dumped core.

=== Getting a Full Backtrace out of a Container

If the crash or assertion is repeatable it could be easiest to run ##mariadbd## under #gdb##.

The container image name here can be a prebuilt one from ##quay.io/mariadb-foundation/mariadb-debug## or an explicit version built yourself as above.

&lt;&lt;code&gt;&gt;
docker run -v datavolume:/var/lib/mysql/ --rm --user mysql  quay.io/mariadb-foundation/mariadb-debug:10.11 gdb -ex r  -ex &#39;thread apply all bt -frame-arguments all full&#39;  --args mariadbd
&lt;&lt;/code&gt;&gt;

In docker-compose.yml form this looks like:
&lt;&lt;code&gt;&gt;
services:
  mariadb:
    image: quay.io/mariadb-foundation/mariadb-debug:10.11
    volumes:
      - mariadbdata:/var/lib/mysql
    environment:
      - MARIADB_ROOT_PASSWORD=bob
    command: gdb -ex r  -ex &#39;thread apply all bt -frame-arguments all full&#39;  --args mariadbd
    user: mysql
volumes:
  mariadbdata: {}
&lt;&lt;/code&gt;&gt;

Note, the initialization of data is assumed. Omit ##command## and ##user## if it isn&#39;t.

If you wish to attach to and existing process in a container, the container needs to be started with the SYS_PTRACE capability. The sysctl ##kernel.yama.ptrace_scope## that allows this should also be set to 0.

&lt;&lt;code&gt;&gt;
$ podman run -v data:/var/lib/mysql/ --cap-add SYS_PTRACE --name mtest -d quay.io/mariadb-foundation/mariadb-debug:11.2
$ podman exec --user mysql mtest gdb -p 1 -ex  &#39;thread apply all bt -frame-arguments all full&#39; 
&lt;&lt;/code&gt;&gt;

Note: ##podman## has the same arguments and behaviour as ##docker## if you&#39;d rather use that.

or in compose:
&lt;&lt;code&gt;&gt;
  cap_add:
    - SYS_PTRACE
&lt;&lt;/code&gt;&gt;

The container process is always pid one, and here we use ##c## then ##thread apply all bt -frame-arguments all full## as the pre-loaded ##gdb## commands. When a particular signal like assert or SEGV is triggered, the backtrace will be displayed.

== Letting a Container coredump

First, the ##sysctl kernel.core_pattern## needs to be ##core##. If it starts with a pipe character it try to execute this within the container. This is a kernel wide setting and cannot be applied to a specific container. The bottom of a crash will show you want it is set to.

With this set, just running a container with debug info is sufficient. The core should be dumped on the datadir volume. With the ##core## dump here, analysis can occur like:

&lt;&lt;code&gt;&gt;
podman run --rm --user mysql --volume data:/var/lib/mysql -i mariadb_debug gdb --batch --eval-command=&#34;set print frame-arguments all&#34; --eval-command=&#34;thread apply all bt full&#34; /usr/sbin/mariadbd /var/lib/mysql/core | tee mariadbd_full_bt_all_threads.txt
&lt;&lt;/code&gt;&gt;

== Running a Copy of the Database Directory

If you are concerned with debuggers running on your production database
you can also copy the database to another location.

This is useful when you know which statement crashed the server.

Just start mariadbd with the options
&lt;&lt;fixed&gt;&gt;--datadir=/copy-of-original-data-directory --core-file --stack-trace --socket=/tmp/mariadbd-alone.sock --skip-networking&lt;&lt;/fixed&gt;&gt;

== Disabling Stack Traces in the Error Log

In order to disable stack traces in the [[error-log|error log]], you can configure the ##[[mariadbd-options/#-stack-trace|skip_stack_trace]]## option either on the command-line or in a relevant server [[configuring-mariadb-with-option-files/#option-groups|option group]] in an [[configuring-mariadb-with-option-files|option file]]. For example:

&lt;&lt;code&gt;&gt;
[mariadb]
...
skip_stack_trace
&lt;&lt;/code&gt;&gt;

== Reporting the Problem

If you encounter some problem in MariaDB, then MariaDB&#39;s developers would appreciate if you would [[mariadb-community-bug-reporting|report a bug]] at the [[https://jira.mariadb.org|MariaDB JIRA bug tracker]]. Please include the following information:

* Your full stack trace.
* Your [[error-log|error log]].
* Your [[configuring-mariadb-with-option-files|option files]].
* How to reproduce the problem.
* [[show-engine-innodb-status|SHOW ENGINE INNODB STATUS]]
* [[show-create-table|SHOW CREATE TABLE {table]] (for each table in query) and [[explain|EXPLAIN {query}]] if a query related crash.

A [[mariadb-ftp-server|MariaDB FTP server]] is available for large and/or sensitive information. Please upload in ##.tar.gz## or ##.zip## archive.

For very difficult or critical errors, you should consider uploading the following information to the [[mariadb-ftp-server|MariaDB FTP server]] the following:

* Your build of ##mariadbd## (if you compiled it), otherwise version information on the mariadb-server package.
* Your core file.
* Your contact information. 
* The associated [[https://jira.mariadb.org|JIRA issue identifier]] for the bug, if you [[mariadb-community-bug-reporting|reported a bug]].

This information will allow the MariaDB developers at the MariaDB Corporation to analyze it and try to
create a fix.</textarea>
    


                    <div id="content_disclaimer" class="graybox">
                        Content reproduced on this site is the property of its respective owners,
                        and this content is not reviewed in advance by MariaDB. The views, information and opinions
                        expressed by this content do not necessarily represent those of MariaDB or any other party.
                    </div>
                </div>
            </section>

            
        </div>
    </div>
</div>

<!-- Footer -->
<footer id="footer">
    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-xs-12">
                    <ul class="list-inline text-center footer-nav">
                        <li>
                            <h5>
                                <a href="https://mariadb.com/products" title="Products">Products</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/services" title="Services">Services</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/pricing" title="Pricing">Pricing</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/resources" title="Resources">Resources</a>
                            </h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/about-us" title="About MariaDB">About Us</a></h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/download" title="Download">Download MariaDB</a></h5>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="row row-10">
                
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div id="block-footerformcontact" class="block block-block-content block-block-contentd754ee1b-3cc9-40e7-9ef4-f504f1197fb1">
                        
                            <h5 style="font-weight: 400;">Subscribe to our newsletter!</h5>
                            <script src="//app-sj15.marketo.com/js/forms2/js/forms2.min.js"></script><form id="mktoForm_1498"></form>
                            <script>
                                <!--//--><![CDATA[// ><!--
                                MktoForms2.loadForm("//app-sj15.marketo.com", "573-PXI-984", 1498);
                                //--><!]]]]><![CDATA[>
                                //--><!]]>
                            </script>
                        
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div class="footer-copyright">
                        <div class="text-center">
                            <ul class="list-inline no-margin">
                                <li>
                                    <a href="/legal" title="Legal">Legal</a>
                                </li>
                                <li>
                                    <a href="/privacy-policy" title="Privacy Policy">Privacy Policy</a>
                                </li>
                                <li>
                                    <a href="/cookie-policy/" title="Cookies">Cookie Policy</a>
                                </li>
                            </ul>
                            <p>Copyright &copy; 2024 MariaDB. All rights reserved.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</footer>
</div>

<div id="ajax_loading">
    <img src="/kb/static/images/ajax-loader.a51c5608d01a.gif" />
</div>

    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MK2847"
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MK2847');</script>
    <!-- End Google Tag Manager -->

</body>

<script type="text/javascript" src="/kb/static/js/main.1587e3a666fc.js" charset="utf-8"></script>

</html>