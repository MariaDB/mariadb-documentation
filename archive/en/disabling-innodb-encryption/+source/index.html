<!DOCTYPE html>
<html>
<head data-cookie-domain=""
      data-cookie-path="/">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="apple-touch-icon" sizes="180x180" href="/kb/static/images/favicons/apple-touch-icon.159e713979be.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/kb/static/images/favicons/favicon-32x32.bc0ac1d5d11e.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/kb/static/images/favicons/favicon-16x16.5801f8f0f34e.png">
    <link rel="shortcut icon" href="/kb/static/images/favicons/favicon.d122d305dee4.ico" type="image/x-icon" />

    <title>Disabling InnoDB Encryption - Source - MariaDB Knowledge Base</title>

    <link href="/kb/static/css/main.f7633538c846.css" rel="stylesheet" type="text/css" />

    
        <meta name="robots" content="noindex, nofollow">
    

    

    <!-- FB Open Graph tags -->
    <meta property="og:title" content="Disabling InnoDB Encryption - Source" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://mariadb.com/kb/en/disabling-innodb-encryption/+source/" />
    <meta property="og:image" content="http://mariadb.comaskmonty-logo.png" />
    <meta property="og:site_name" content="MariaDB KnowledgeBase" />
    <meta property="fb:admins" content="514852603" />
    <meta property="og:description" content="" />

    <meta name="description" content="" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet"/>
    
</head>
<body class="mpkb nodes autoresize nodes_source jqui" id="nodes_source">





<div id="menu-mobile" class="visible-sm visible-xs">

    <div>
        <div id="mobile-close-menu" class="text-right">
            <a href="javascript:void(0)" title="Close Menu" id="back-main" class="toggle-menu">X<span></span></a>
        </div>
    </div>
    <div class="mainmenu-mobile">
        <ul class="ls-none ul-menu">
            <li data-sub="submenu5"><a class="open-form-search" href="/kb/search/" title="Search">Search </a></li>
            <li data-sub="submenu0"><a href="/products" title="Products">Products</a><span class="arrow-main"></span></li>
            <li data-sub="submenu1"><a href="/services" title="Services">Services</a><span class="arrow-main"></span></li>
            <li data-sub="submenu2"><a href="/resources" title="Resources">Resources</a><span class="arrow-main"></span></li>
            <li data-sub="submenu3"><a href="/about-us" title="About">About</a><span class="arrow-main"></span></li>
            <li data-sub="submenu4"><a href="/contact" title="Contact">Contact</a></li>
        </ul>
    </div>

    <div class="nav-top-mobile">
        <div class="select-box form">

            <ul class="inline-block-md mb-none top-nav">
                <li>

                </li>
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/disabling-innodb-encryption/+source/"> Login</a>
                    </li>
                
            </ul>



        </div>
        <p class="text-center copyright">Copyright &copy; 2024 MariaDB. All rights reserved.</p>
    </div>
</div>
<div class="violator-wrap d-none" id="top_violator">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12">
                <div class="violator-outer">
                    <div class="violator-inner">
                        <div class="row">
                            <div class="col-xs-12 col-sm-9 col-lg-7 col-lg-offset-2" id="top_violator_content">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="content-link" target="_blank" rel="nofollow noreferrer">
                                    <span>The Ultimate Guide to High Availability with MariaDB</span>
                                </a>
                            </div>
                            <div class="col-xs-12 col-sm-3" id="top_violator_cta">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="btn btn-mariadb" target="_blank" rel="nofollow noreferrer">Download Now</a>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-link close-btn">
                        <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24" width="15px" height="15px"><path d="M 4.9902344 3.9902344 A 1.0001 1.0001 0 0 0 4.2929688 5.7070312 L 10.585938 12 L 4.2929688 18.292969 A 1.0001 1.0001 0 1 0 5.7070312 19.707031 L 12 13.414062 L 18.292969 19.707031 A 1.0001 1.0001 0 1 0 19.707031 18.292969 L 13.414062 12 L 19.707031 5.7070312 A 1.0001 1.0001 0 0 0 18.980469 3.9902344 A 1.0001 1.0001 0 0 0 18.292969 4.2929688 L 12 10.585938 L 5.7070312 4.2929688 A 1.0001 1.0001 0 0 0 4.9902344 3.9902344 z"/></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="wrapper">
<div id="top-nav">
    <div class="container">
        <ul class="hidden-sm hidden-xs" >
            <li><a href="https://mariadb.com/kb/">Knowledge Base</a></li>
            <li><a href="https://mariadb.com/contact/">Contact</a></li>
            
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/disabling-innodb-encryption/+source/" rel="nofollow">Login</a>
                    </li>
                
            
            
            <li id="search-form">
                <form action="/kb/en/+search/" method="get" id="search-block-form" accept-charset="UTF-8">
                    <input id="search" title="Enter the terms you wish to search for."
                           placeholder="Search . . ." type="text"
                           name="q" value="" size="15" maxlength="128" class="form-text"
                           data-autocomplete-url="/kb/en/+search/autocomplete/">
                    <input type="hidden" name="quick" value="1" />
                    <input type="hidden" name="source" value="kb" />
                </form>
            </li>
            <li><a id="search-toggler" href="/kb/search/">Search</a></li>
            
        </ul>
    </div>
</div>
<div id="navbar-bottom" class="navbar">
    <div class="container">
        
        
        
        
        <div class="row">
            <div class="col-md-3 col-sm-9 col-xs-9">
                <a class="brand" href="/" title="MariaDB">
                    <img src="/kb/static/images/logo-2018-black.95f5978ae14d.png">
                </a>
            </div>
            <div class="col-md-9 hidden-sm hidden-xs">
                <div class="main-menu">
                    <ul id="main-menu" class="nav navbar-nav inline-block-sm">
    <li class="has-sub full-menu">
        <a href="/products" title="Products">Products</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/services" title="Services">Services</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/pricing" title="Pricing">Pricing</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/resources" title="Resources">Resources</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/about-us" title="About Us">About Us</a>
    </li>
    <li class="">
        <a class="button electric-eel small top-bar-right-download" href="/downloads/">Download</a>
    </li>
</ul>
                </div>
            </div>
            <div class="col-md-3 visible-sm visible-xs col-sm-3 col-xs-3 ps-rv">
                <div class="navbar-header text-right pull-right">
                    <button type="button" class="menu-control toggle-menu" id="open-menu">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="main">
    <div class="container">
        

        <div id="subheader1" class="clearfix">
            <div class="pull-left">
                
                <div id="breadcrumbs" class="breadcrumb">
                    <a href="/kb/en/">Knowledge Base</a>
                    


    
    » <a class="crumb" href="/kb/en/documentation/">MariaDB Server Documentation</a>
    

    
    » <a class="crumb" href="/kb/en/mariadb-administration/">MariaDB Administration</a>
    

    
    » <a class="crumb" href="/kb/en/user-server-security/">User &amp; Server Security</a>
    

    
    » <a class="crumb" href="/kb/en/securing-mariadb/">Securing MariaDB</a>
    

    
    » <a class="crumb" href="/kb/en/securing-mariadb-encryption/">Encryption</a>
    

    
    » <a class="crumb" href="/kb/en/encryption-data-at-rest-encryption/">Data-at-Rest Encryption</a>
    

    
    » <a class="crumb" href="/kb/en/innodb-encryption/">InnoDB Encryption</a>
    


    » <a class="node_link crumb" href="/kb/en/disabling-innodb-encryption/">Disabling InnoDB Encryption</a>


                </div>
                
            </div>
        </div>
    </div>
    <div class="container" id="container-main">
        <div class="row">
            
            
                
                <aside id="sidebar-first" class="sidebar col-md-2 hidden-xs hidden-sm hidden-print">
                    
                        
                        <ul id="category_menu" class="nav nav-pills nav-stacked">
                            <li><a href="/kb/en/">Home</a></li>
                            
                                
                                    <li><a href="/kb/en/+questions/">Open Questions</a></li>
                                
                                <li><a href="/kb/en/documentation/">MariaDB Server</a></li>
                                <li><a href="/kb/en/maxscale/">MariaDB MaxScale</a></li>
                                <li><a href="/kb/en/mariadb-columnstore/">MariaDB ColumnStore</a></li>
                                <li><a href="/kb/en/connectors/">Connectors</a></li>
                            

                        </ul>
                    

                    
                        <div>
    

<div class="well well-small box actions"><div>

        <a class="btn btn-block btn-small" href="/kb/en/disabling-innodb-encryption/">Return to article</a>
    
</div>
</div>

</div>
                    

                    

































                </aside>
            
            
            
                
            
            
            <section id="content" class="limited_width col-md-10 clearfix">
                
                    <h1>Disabling InnoDB Encryption - Source</h1>
                

                



                <div>
                    

    

    
    <div class="revision_info">
        <dl class="table">
            <dt>Revision</dt>
            <dd><a href="/kb/en/disabling-innodb-encryption/+r/135867/">135867</a></dd>
            <dt>User</dt>
            <dd>
<span class="user" id="user-5454">
<a href="/kb/user/id/5454" title="Kenneth Dyer">Kenneth Dyer</a>
</span></dd>
            <dt>Date</dt>
            <dd>

<span class="datetime" title="2020-11-03 14:25">2020-11-03 14:25</span></dd>
        </dl>
    </div>
    


    

    
        
        <textarea id="answer_source" class="creole_source autogrow">&lt;&lt;toc&gt;&gt;

The process involved in safely disabling encryption for your InnoDB tables is a little more complicated than that of [[enabling-innodb-encryption|enabling encryption]].  Turning off the relevant system variables doesn&#39;t decrypt the tables.  If you turn it off and remove the encryption key management plugin, it&#39;ll render the encrypted data inaccessible. 

In order to safely disable encryption, you first need to decrypt the tablespaces and the Redo Log, then turn off the system variables.  The specifics of this process depends on whether you are using automatic or manual encryption of the InnoDB tablespaces.


=== Disabling Encryption for Automatically Encrypted Tablespaces

When an InnoDB tablespace has the [[create-table#encrypted|ENCRYPTED]] table option set to ##DEFAULT## and the [[innodb-system-variables#innodb_encrypt_tables|innodb_encrypt_tables]] system variable is set to ##ON## or ##FORCE##, the tablespace&#39;s encryption is automatically managed by the background encryption threads. When you want to disable encryption for these tablespaces, you must ensure that the background encryption threads decrypt the tablespaces before removing the encryption keys. Otherwise, the tablespace remains encrypted and becomes inaccessible once you&#39;ve removed the keys.

To safely decrypt the tablespaces, first, set the [[innodb-system-variables#innodb_encrypt_tables|innodb_encrypt_tables]] system variable to ##OFF##:

&lt;&lt;sql&gt;&gt;
SET GLOBAL innodb_encrypt_tables = OFF;
&lt;&lt;/sql&gt;&gt;

Next, set the [[innodb-system-variables#innodb_encryption_threads|innodb_encryption_threads]] system variable to a non-zero value:

&lt;&lt;sql&gt;&gt;
SET GLOBAL innodb_encryption_threads = 4;
&lt;&lt;/sql&gt;&gt;

Then, set the [[innodb-system-variables#innodb_encryption_rotate_key_age|innodb_encryption_rotate_key_age]] system variable to ##1##:

&lt;&lt;sql&gt;&gt;
SET GLOBAL innodb_encryption_rotate_key_age = 1;
&lt;&lt;/sql&gt;&gt;

Once set, any InnoDB tablespaces that have the [[create-table#encrypted|ENCRYPTED]] table option set to ##DEFAULT## will be [[innodb-background-encryption-threads#background-operations|decrypted]] in the background by the InnoDB [[innodb-background-encryption-threads#background-encryption-threads|background encryption threads]].  

==== Decryption Status

You can [[innodb-background-encryption-threads#checking-the-status-of-background-operations|check the status]] of the decryption process using the [[information-schema-innodb_tablespaces_encryption-table|INNODB_TABLESPACES_ENCRYPTION]] table in the [[information-schema|information_schema]] database.  

&lt;&lt;sql&gt;&gt;
SELECT COUNT(*) AS &#34;Number of Encrypted Tablespaces&#34;
FROM information_schema.INNODB_TABLESPACES_ENCRYPTION
WHERE ENCRYPTION_SCHEME != 0
   OR ROTATING_OR_FLUSHING != 0; 
&lt;&lt;/sql&gt;&gt;

This query shows the number of InnoDB tablespaces that currently using background encryption threads.  Once the count reaches 0, then all of your InnoDB tablespaces are unencrypted.  Be sure to also remove encryption on the [[#disabling-encryption-for-the-redo-log|Redo Log]] and the [[aria-encryption|Aria]] storage engine before removing the encryption key management settings from your configuration file.

=== Disabling Encryption for Manually Encrypted Tablespaces

In the case of manually encrypted InnoDB tablespaces, (that is, those where the [[create-table#encrypted|ENCRYPTED]] table option is set to ##YES##), you must issue an [[alter-table|ALTER TABLE]] statement to decrypt each tablespace before removing the encryption keys.  Otherwise, the tablespace remains encrypted and becomes inaccessible without the keys.

First, query the Information Schema [[information-schema-tables-table|TABLES]] table to find the encrypted tables.  This can be done with a ##WHERE## clause filtering the ##CREATE_OPTIONS## column.

&lt;&lt;sql&gt;&gt;
SELECT TABLE_SCHEMA AS &#34;Database&#34;, TABLE_NAME AS &#34;Table&#34;
FROM information_schema.TABLES
WHERE ENGINE=&#39;InnoDB&#39; 
      AND CREATE_OPTIONS LIKE &#39;%`ENCRYPTED`=YES%&#39;;
&lt;&lt;/sql&gt;&gt;

For each table in the result-set, issue an [[alter-table|ALTER TABLE]] statement, setting the [[create-table#encrypted|ENCRYPTED]] table option to ##NO##. 

&lt;&lt;sql&gt;&gt;
SELECT NAME, ENCRYPTION_SCHEME, CURRENT_KEY_ID
FROM information_schema.INNODB_TABLESPACES_ENCRYPTION
WHERE NAME=&#39;db1/tab1&#39;;
+----------+-------------------+----------------+
| NAME     | ENCRYPTION_SCHEME | CURRENT_KEY_ID |
+----------+-------------------+----------------+
| db1/tab1 |                 1 |            100 |
+----------+-------------------+----------------+

ALTER TABLE tab1
   ENCRYPTED=NO;

SELECT NAME, ENCRYPTION_SCHEME, CURRENT_KEY_ID
FROM information_schema.INNODB_TABLESPACES_ENCRYPTION
WHERE NAME=&#39;db1/tab1&#39;;
+----------+-------------------+----------------+
| NAME     | ENCRYPTION_SCHEME | CURRENT_KEY_ID |
+----------+-------------------+----------------+
| db1/tab1 |                 0 |            100 |
+----------+-------------------+----------------+
&lt;&lt;/sql&gt;&gt;

Once you have removed encryption from all the tables, your InnoDB deployment is unencrypted.  Be sure to also remove encryption from the [[#disabling-encryption-for-the-redo-log|Redo Log]] as well as [[aria-encryption|Aria]] and any other storage engines that support encryption before removing the encryption key management settings from your configuration file. 

&lt;&lt;style class=&#34;greenbox&#34;&gt;&gt;
InnoDB does not permit manual encryption changes to tables in the [[innodb-system-tablespaces|system]] tablespace using [[alter-table|ALTER TABLE]]. Encryption of the [[innodb-system-tablespaces|system]] tablespace can only be configured by setting the value of the [[innodb-system-variables#innodb_encrypt_tables|innodb_encrypt_tables]] system variable. This means that when you want to encrypt or decrypt the [[innodb-system-tablespaces|system]] tablespace, you must also set a non-zero value for the [[innodb-system-variables#innodb_encryption_threads|innodb_encryption_threads]] system variable, and you must also set the [[innodb-system-variables#innodb_encryption_rotate_key_age|innodb_system_rotate_key_age]] system variable to ##1## to ensure that the system tablespace is properly encrypted or decrypted by the background threads. See MDEV-14398 for more information.
&lt;&lt;/style&gt;&gt;

=== Disabling Encryption for Temporary Tablespaces

The [[innodb-system-variables#innodb_encrypt_temporary_tables|innodb_encrypt_temporary_tables]] system variable controls the configuration of encryption for the [[innodb-temporary-tablespaces|temporary tablespace]]. To disable it, remove the system variable from your server&#39;s [[configuring-mariadb-with-option-files|option file]], and then restart the server.

=== Disabling Encryption for the Redo Log

InnoDB uses the [[innodb-redo-log|Redo Log]] in crash recovery. By default, these events are written to file in an unencrypted state. In removing data-at-rest encryption for InnoDB, be sure to also disable encryption for the Redo Log before removing encryption key settings.  Otherwise the Redo Log can become inaccessible without the encryption keys.

First, check the value of the [[innodb-system-variables#innodb_fast_shutdown|innodb_fast_shutdown]] system variable with the [[show-variables|SHOW VARIABLES]] statement. For example:

&lt;&lt;sql&gt;&gt;
SHOW VARIABLES LIKE &#39;innodb_fast_shutdown&#39;;
+----------------------+-------+
| Variable_name        | Value |
+----------------------+-------+
| innodb_fast_shutdown |     2 |
+----------------------+-------+
&lt;&lt;/sql&gt;&gt;

When the value is set to ##2##, InnoDB performs an unclean shutdown, so it will need the [[innodb-redo-log|Redo Log]] at the next server startup. Ensure that the variable is set to ##0##, ##1##, or ##3##. For performance reasons, ##1## is usually the best option. It can be changed dynamically with [[set/#global-session|SET GLOBAL]]. For example:

&lt;&lt;sql&gt;&gt;
SET GLOBAL innodb_fast_shutdown = 1;
&lt;&lt;/sql&gt;&gt;

Then, set the [[innodb-system-variables#innodb_encrypt_log|innodb_encrypt_log]] system variable to ##OFF## in a server [[configuring-mariadb-with-option-files/#option-groups|option group]] in an [[configuring-mariadb-with-option-files|option file]]. Once this is done, [[starting-and-stopping-mariadb-starting-and-stopping-mariadb|restart]] the MariaDB Server. When the Server comes back online, it begins writing unencrypted data to the Redo Log.

=== See Also
* [[enabling-innodb-encryption|Enabling InnoDB encryption]]</textarea>
    


                    <div id="content_disclaimer" class="graybox">
                        Content reproduced on this site is the property of its respective owners,
                        and this content is not reviewed in advance by MariaDB. The views, information and opinions
                        expressed by this content do not necessarily represent those of MariaDB or any other party.
                    </div>
                </div>
            </section>

            
        </div>
    </div>
</div>

<!-- Footer -->
<footer id="footer">
    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-xs-12">
                    <ul class="list-inline text-center footer-nav">
                        <li>
                            <h5>
                                <a href="https://mariadb.com/products" title="Products">Products</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/services" title="Services">Services</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/pricing" title="Pricing">Pricing</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/resources" title="Resources">Resources</a>
                            </h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/about-us" title="About MariaDB">About Us</a></h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/download" title="Download">Download MariaDB</a></h5>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="row row-10">
                
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div id="block-footerformcontact" class="block block-block-content block-block-contentd754ee1b-3cc9-40e7-9ef4-f504f1197fb1">
                        
                            <h5 style="font-weight: 400;">Subscribe to our newsletter!</h5>
                            <script src="//app-sj15.marketo.com/js/forms2/js/forms2.min.js"></script><form id="mktoForm_1498"></form>
                            <script>
                                <!--//--><![CDATA[// ><!--
                                MktoForms2.loadForm("//app-sj15.marketo.com", "573-PXI-984", 1498);
                                //--><!]]]]><![CDATA[>
                                //--><!]]>
                            </script>
                        
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div class="footer-copyright">
                        <div class="text-center">
                            <ul class="list-inline no-margin">
                                <li>
                                    <a href="/legal" title="Legal">Legal</a>
                                </li>
                                <li>
                                    <a href="/privacy-policy" title="Privacy Policy">Privacy Policy</a>
                                </li>
                                <li>
                                    <a href="/cookie-policy/" title="Cookies">Cookie Policy</a>
                                </li>
                            </ul>
                            <p>Copyright &copy; 2024 MariaDB. All rights reserved.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</footer>
</div>

<div id="ajax_loading">
    <img src="/kb/static/images/ajax-loader.a51c5608d01a.gif" />
</div>

    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MK2847"
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MK2847');</script>
    <!-- End Google Tag Manager -->

</body>

<script type="text/javascript" src="/kb/static/js/main.1587e3a666fc.js" charset="utf-8"></script>

</html>