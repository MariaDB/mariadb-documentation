<!DOCTYPE html>
<html>
<head data-cookie-domain=""
      data-cookie-path="/">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="apple-touch-icon" sizes="180x180" href="/kb/static/images/favicons/apple-touch-icon.159e713979be.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/kb/static/images/favicons/favicon-32x32.bc0ac1d5d11e.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/kb/static/images/favicons/favicon-16x16.5801f8f0f34e.png">
    <link rel="shortcut icon" href="/kb/static/images/favicons/favicon.d122d305dee4.ico" type="image/x-icon" />

    <title>Compiling MariaDB for Debugging - Source - MariaDB Knowledge Base</title>

    <link href="/kb/static/css/main.f7633538c846.css" rel="stylesheet" type="text/css" />

    
        <meta name="robots" content="noindex, nofollow">
    

    

    <!-- FB Open Graph tags -->
    <meta property="og:title" content="Compiling MariaDB for Debugging - Source" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://mariadb.com/kb/en/compiling-mariadb-for-debugging/+source/" />
    <meta property="og:image" content="http://mariadb.comaskmonty-logo.png" />
    <meta property="og:site_name" content="MariaDB KnowledgeBase" />
    <meta property="fb:admins" content="514852603" />
    <meta property="og:description" content="" />

    <meta name="description" content="" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet"/>
    
</head>
<body class="mpkb nodes autoresize nodes_source jqui" id="nodes_source">





<div id="menu-mobile" class="visible-sm visible-xs">

    <div>
        <div id="mobile-close-menu" class="text-right">
            <a href="javascript:void(0)" title="Close Menu" id="back-main" class="toggle-menu">X<span></span></a>
        </div>
    </div>
    <div class="mainmenu-mobile">
        <ul class="ls-none ul-menu">
            <li data-sub="submenu5"><a class="open-form-search" href="/kb/search/" title="Search">Search </a></li>
            <li data-sub="submenu0"><a href="/products" title="Products">Products</a><span class="arrow-main"></span></li>
            <li data-sub="submenu1"><a href="/services" title="Services">Services</a><span class="arrow-main"></span></li>
            <li data-sub="submenu2"><a href="/resources" title="Resources">Resources</a><span class="arrow-main"></span></li>
            <li data-sub="submenu3"><a href="/about-us" title="About">About</a><span class="arrow-main"></span></li>
            <li data-sub="submenu4"><a href="/contact" title="Contact">Contact</a></li>
        </ul>
    </div>

    <div class="nav-top-mobile">
        <div class="select-box form">

            <ul class="inline-block-md mb-none top-nav">
                <li>

                </li>
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/compiling-mariadb-for-debugging/+source/"> Login</a>
                    </li>
                
            </ul>



        </div>
        <p class="text-center copyright">Copyright &copy; 2024 MariaDB. All rights reserved.</p>
    </div>
</div>
<div class="violator-wrap d-none" id="top_violator">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12">
                <div class="violator-outer">
                    <div class="violator-inner">
                        <div class="row">
                            <div class="col-xs-12 col-sm-9 col-lg-7 col-lg-offset-2" id="top_violator_content">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="content-link" target="_blank" rel="nofollow noreferrer">
                                    <span>The Ultimate Guide to High Availability with MariaDB</span>
                                </a>
                            </div>
                            <div class="col-xs-12 col-sm-3" id="top_violator_cta">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="btn btn-mariadb" target="_blank" rel="nofollow noreferrer">Download Now</a>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-link close-btn">
                        <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24" width="15px" height="15px"><path d="M 4.9902344 3.9902344 A 1.0001 1.0001 0 0 0 4.2929688 5.7070312 L 10.585938 12 L 4.2929688 18.292969 A 1.0001 1.0001 0 1 0 5.7070312 19.707031 L 12 13.414062 L 18.292969 19.707031 A 1.0001 1.0001 0 1 0 19.707031 18.292969 L 13.414062 12 L 19.707031 5.7070312 A 1.0001 1.0001 0 0 0 18.980469 3.9902344 A 1.0001 1.0001 0 0 0 18.292969 4.2929688 L 12 10.585938 L 5.7070312 4.2929688 A 1.0001 1.0001 0 0 0 4.9902344 3.9902344 z"/></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="wrapper">
<div id="top-nav">
    <div class="container">
        <ul class="hidden-sm hidden-xs" >
            <li><a href="https://mariadb.com/kb/">Knowledge Base</a></li>
            <li><a href="https://mariadb.com/contact/">Contact</a></li>
            
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/compiling-mariadb-for-debugging/+source/" rel="nofollow">Login</a>
                    </li>
                
            
            
            <li id="search-form">
                <form action="/kb/en/+search/" method="get" id="search-block-form" accept-charset="UTF-8">
                    <input id="search" title="Enter the terms you wish to search for."
                           placeholder="Search . . ." type="text"
                           name="q" value="" size="15" maxlength="128" class="form-text"
                           data-autocomplete-url="/kb/en/+search/autocomplete/">
                    <input type="hidden" name="quick" value="1" />
                    <input type="hidden" name="source" value="kb" />
                </form>
            </li>
            <li><a id="search-toggler" href="/kb/search/">Search</a></li>
            
        </ul>
    </div>
</div>
<div id="navbar-bottom" class="navbar">
    <div class="container">
        
        
        
        
        <div class="row">
            <div class="col-md-3 col-sm-9 col-xs-9">
                <a class="brand" href="/" title="MariaDB">
                    <img src="/kb/static/images/logo-2018-black.95f5978ae14d.png">
                </a>
            </div>
            <div class="col-md-9 hidden-sm hidden-xs">
                <div class="main-menu">
                    <ul id="main-menu" class="nav navbar-nav inline-block-sm">
    <li class="has-sub full-menu">
        <a href="/products" title="Products">Products</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/services" title="Services">Services</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/pricing" title="Pricing">Pricing</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/resources" title="Resources">Resources</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/about-us" title="About Us">About Us</a>
    </li>
    <li class="">
        <a class="button electric-eel small top-bar-right-download" href="/downloads/">Download</a>
    </li>
</ul>
                </div>
            </div>
            <div class="col-md-3 visible-sm visible-xs col-sm-3 col-xs-3 ps-rv">
                <div class="navbar-header text-right pull-right">
                    <button type="button" class="menu-control toggle-menu" id="open-menu">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="main">
    <div class="container">
        

        <div id="subheader1" class="clearfix">
            <div class="pull-left">
                
                <div id="breadcrumbs" class="breadcrumb">
                    <a href="/kb/en/">Knowledge Base</a>
                    


    
    » <a class="crumb" href="/kb/en/training-tutorials/">Training &amp; Tutorials</a>
    

    
    » <a class="crumb" href="/kb/en/advanced-mariadb-articles/">Advanced MariaDB Articles</a>
    

    
    » <a class="crumb" href="/kb/en/development-articles/">Development Articles</a>
    

    
    » <a class="crumb" href="/kb/en/debugging-mariadb/">Debugging MariaDB</a>
    


    » <a class="node_link crumb" href="/kb/en/compiling-mariadb-for-debugging/">Compiling MariaDB for Debugging</a>


                </div>
                
            </div>
        </div>
    </div>
    <div class="container" id="container-main">
        <div class="row">
            
            
                
                <aside id="sidebar-first" class="sidebar col-md-2 hidden-xs hidden-sm hidden-print">
                    
                        
                        <ul id="category_menu" class="nav nav-pills nav-stacked">
                            <li><a href="/kb/en/">Home</a></li>
                            
                                
                                    <li><a href="/kb/en/+questions/">Open Questions</a></li>
                                
                                <li><a href="/kb/en/documentation/">MariaDB Server</a></li>
                                <li><a href="/kb/en/maxscale/">MariaDB MaxScale</a></li>
                                <li><a href="/kb/en/mariadb-columnstore/">MariaDB ColumnStore</a></li>
                                <li><a href="/kb/en/connectors/">Connectors</a></li>
                            

                        </ul>
                    

                    
                        <div>
    

<div class="well well-small box actions"><div>

        <a class="btn btn-block btn-small" href="/kb/en/compiling-mariadb-for-debugging/">Return to article</a>
    
</div>
</div>

</div>
                    

                    

































                </aside>
            
            
            
                
            
            
            <section id="content" class="limited_width col-md-10 clearfix">
                
                    <h1>Compiling MariaDB for Debugging - Source</h1>
                

                



                <div>
                    

    

    
    <div class="revision_info">
        <dl class="table">
            <dt>Revision</dt>
            <dd><a href="/kb/en/compiling-mariadb-for-debugging/+r/108565/">108565</a></dd>
            <dt>User</dt>
            <dd>
<span class="user" id="user-2">
<a href="/kb/user/id/2" title="Daniel Bartholomew">Daniel Bartholomew</a>
</span></dd>
            <dt>Date</dt>
            <dd>

<span class="datetime" title="2021-07-20 05:57">2021-07-20 05:57</span></dd>
        </dl>
    </div>
    


    

    
        
        <textarea id="answer_source" class="creole_source autogrow">&lt;&lt;toc&gt;&gt;

Compiling MariaDB with full debug information includes all code symbols and also new code to do internal testing of structures and allow one to trace MariaDB execution. A full debug binary will be notably slower than a normal binary (~30%).

== Compiling MariaDB for Debugging Using the ##CMAKE_BUILD_TYPE## Option

On Unix systems, you can build a debug build by executing ##cmake## and by setting the ##CMAKE_BUILD_TYPE## option to ##Debug##. For example:

&lt;&lt;code&gt;&gt;
cmake -DCMAKE_BUILD_TYPE=Debug .
&lt;&lt;/code&gt;&gt;

== Compiling MariaDB for Debugging Using Build Scripts

The other option is to use the scripts in the BUILD directory that will compile MariaDB with most common debug options and plugins:

&lt;&lt;code&gt;&gt;
./BUILD/compile-pentium64-debug-max
&lt;&lt;/code&gt;&gt;

or alternatively if you want to use the [[http://www.valgrind.org|Valgrind]] memory checking tool with the [[mysqltest|MariaDB test system]]:

&lt;&lt;code&gt;&gt;
./BUILD/compile-pentium64-valgrind-max
&lt;&lt;/code&gt;&gt;

There are separate build scripts for different configurations in the BUILD directory.

You can find a list of the needed packages/libraries for building on Linux [[Build_Environment_Setup_for_Linux|here]].

=== Example of Compiling MariaDB for Debugging Using Build Scripts

* Scripts containing &#34;debug&#34; in the name are for developers that want to build, develop and test MariaDB.
* Scripts containing &#34;valgrind&#34; in the name are for running mysqld under [[|http://valgrind.org|valgrind]]. Compiling for valgrind means that we are using another implementation of MEM_ROOT to allow valgrind to better detect memory overruns. In addition, some memory areas are marked as used/not used to remove some false positives.
* Scripts containing &#34;max&#34; in the name include all normal plugins.

Here is an example of how to compile MariaDB for debugging in your home directory with MariaDB 5.2.9 as an example:

&lt;&lt;code&gt;&gt;
cd ~
mkdir mariadb
cd mariadb
tar xvf mariadb-5.2.9.tar.gz
ln -s mariadb-5.2.9 current
cd current
./BUILD/compile-pentium64-debug-max
&lt;&lt;/code&gt;&gt;

The last command will produce a debug version of &lt;&lt;fixed&gt;&gt;sql/mysqld&lt;&lt;/fixed&gt;&gt;.
If you have a system other than 64 bit Intel/AMD on Linux you can use a
different &lt;&lt;fixed&gt;&gt;BUILD/...-debug-max&lt;&lt;/fixed&gt;&gt; file. If this fails, you can
try with:

&lt;&lt;code&gt;&gt;
cmake --build  .  --config Debug
make -j4
&lt;&lt;/code&gt;&gt;

== Building Optimized Build With Debug Symbols

To build MariaDB with symbols, to get better stack traces and to be able to debug the binary with ##gdb##, you need to supply the ##-g3## option to the ##gcc## compiler.

Just compiling with ##-g3## will make the binary much bigger but the slowdown of the server should be negligible.

One way to do this is to edit the script
&lt;&lt;code&gt;&gt;
BUILD/compile-pentium64-max
&lt;&lt;/code&gt;&gt;
and add the -g3 last on the line with ##extra_flags##, like this:
&lt;&lt;code&gt;&gt;
extra_flags=&#34;$pentium64_cflags $fast_cflags -g3&#34;
&lt;&lt;/code&gt;&gt;

After that you can compile MariaDB with debugging symbols by just execution the above script.

== Doing a Debug Build on Debian/Ubuntu

To build a &#34;mysqld&#34; binary with debugging enabled that uses the same parameters as the ones used in Debian/Ubuntu binary packages, you must do as follows (you must have a deb-src line of one of the MariaDB repositories on your /etc/apt/sources.list in order to do that):

&lt;&lt;code&gt;&gt;
apt-get build-dep mariadb-10.2
apt-get install cmake libaio1 libaio-dev
apt-get source mariadb-10.2
cd mariadb-10.2*
./debian/rules configure
./BUILD/compile-pentuim64-debug-all
&lt;&lt;/code&gt;&gt;

Then you will have your &#34;debugging enabled&#34; mysqld binary in the sql/ directory.

This binary can directly replace the one provided by the binary package that is placed on &#34;/usr/bin/mysqld&#34;.

=== Temporarily Installing your Debug Build

The commands shown below replace the release ##mysqld## binary with the debug ##mysqld## binary that you compiled. Most importantly, they replace the binary in a way which makes it trivial to revert back to the
original release ##mysqld## binary.

First, [[starting-and-stopping-mariadb-starting-and-stopping-mariadb|stop MariaDB]].

Then, use the ##mv## utility to rename the release ##mysqld## binary:

&lt;&lt;code&gt;&gt;
sudo mv /usr/sbin/mysqld /usr/sbin/mysqld-orig
&lt;&lt;/code&gt;&gt;

Note: Do not use the ##cp## utility because that will change the file modification timestamp.

Then, install the debug ##mysqld## binary from your source tree:

&lt;&lt;code&gt;&gt;
sudo install ~/mariadb-10.3.14/sql/mysqld /usr/sbin/mysqld-debug
&lt;&lt;/code&gt;&gt;

Then, link the ##mysqld## path to the path of your debug ##mysqld## binary:

&lt;&lt;code&gt;&gt;
sudo ln -s /usr/sbin/mysqld-debug /usr/sbin/mysqld
&lt;&lt;/code&gt;&gt;

Then, [[starting-and-stopping-mariadb-starting-and-stopping-mariadb|start MariaDB]].

Be sure to replace ##/usr/sbin/mysqld## with the path to your ##mysqld## binary and to also replace ##{{{~}}}/mariadb-10.3.14/sql/mysqld## with the path to your debug ##mysqld## binary.

=== Reinstalling your Release Build

If you want to restore your original ##mysqld## binary, you can do it with the following process::

First, [[starting-and-stopping-mariadb-starting-and-stopping-mariadb|stop MariaDB]].

Then, execute the following command to delete the symbolic link:

&lt;&lt;code&gt;&gt;
sudo rm /usr/sbin/mysqld
&lt;&lt;/code&gt;&gt;

Then, execute the following command to move the original ##mysqld## release binary back into place:

&lt;&lt;code&gt;&gt;
sudo mv /usr/sbin/mysqld-orig /usr/sbin/mysqld
&lt;&lt;/code&gt;&gt;

Then, [[starting-and-stopping-mariadb-starting-and-stopping-mariadb|start MariaDB]].

Be sure to replace ##/usr/sbin/mysqld## with the path to your ##mysqld## binary

Notice that the debug ##mysqld## binary located at ##/usr/sbin/mysqld-debug## was not deleted. Only the symbolic link to this file was deleted. The debug ##mysqld## binary is still present if it is needed again in the future.

== Different Compilation Options

=== Changing DBUG_ASSERT to Print to Error Log

A debug binary has lots of code checks and asserts, that are not checked in production. This is done to get more performance when running in production.
In some cases, when one is trying to find a hard-to-repeat bug, it could be beneficial to have these checks in production builds too.

Compiling with ##-DDBUG_ASSERT_AS_PRINTF## will change DBUG_ASSERT() to print any failed check to the [[error-log|error log]].
&lt;&lt;code&gt;&gt;
cmake . -DDBUG_ASSERT_AS_PRINTF
&lt;&lt;/code&gt;&gt;

Enabling the above option should not have any notable impact on performance (probably &lt; 1% slowdown).
This is achieved by grouping asserts in MariaDB server code into two groups:
* Fast checks, using ##DBUG_ASSERT()##:  These are converted to printing to error log.
* Slow checks, using ##DBUG_SLOW_ASSERT()##. These will always be removed in production builds.

== See Also
* [[Build_Environment_Setup_for_Linux|Build environment setup for Linux]]
* [[debugging-mariadb-with-a-debugger|Debugging MariaDB with a debugger]]
*[[creating-a-trace-file|Creating a trace file]]
*[[how-to-compile-and-use-mariadb-with-addresssanitizer-asan|Using ASAN with MariaDB]]</textarea>
    


                    <div id="content_disclaimer" class="graybox">
                        Content reproduced on this site is the property of its respective owners,
                        and this content is not reviewed in advance by MariaDB. The views, information and opinions
                        expressed by this content do not necessarily represent those of MariaDB or any other party.
                    </div>
                </div>
            </section>

            
        </div>
    </div>
</div>

<!-- Footer -->
<footer id="footer">
    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-xs-12">
                    <ul class="list-inline text-center footer-nav">
                        <li>
                            <h5>
                                <a href="https://mariadb.com/products" title="Products">Products</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/services" title="Services">Services</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/pricing" title="Pricing">Pricing</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/resources" title="Resources">Resources</a>
                            </h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/about-us" title="About MariaDB">About Us</a></h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/download" title="Download">Download MariaDB</a></h5>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="row row-10">
                
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div id="block-footerformcontact" class="block block-block-content block-block-contentd754ee1b-3cc9-40e7-9ef4-f504f1197fb1">
                        
                            <h5 style="font-weight: 400;">Subscribe to our newsletter!</h5>
                            <script src="//app-sj15.marketo.com/js/forms2/js/forms2.min.js"></script><form id="mktoForm_1498"></form>
                            <script>
                                <!--//--><![CDATA[// ><!--
                                MktoForms2.loadForm("//app-sj15.marketo.com", "573-PXI-984", 1498);
                                //--><!]]]]><![CDATA[>
                                //--><!]]>
                            </script>
                        
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div class="footer-copyright">
                        <div class="text-center">
                            <ul class="list-inline no-margin">
                                <li>
                                    <a href="/legal" title="Legal">Legal</a>
                                </li>
                                <li>
                                    <a href="/privacy-policy" title="Privacy Policy">Privacy Policy</a>
                                </li>
                                <li>
                                    <a href="/cookie-policy/" title="Cookies">Cookie Policy</a>
                                </li>
                            </ul>
                            <p>Copyright &copy; 2024 MariaDB. All rights reserved.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</footer>
</div>

<div id="ajax_loading">
    <img src="/kb/static/images/ajax-loader.a51c5608d01a.gif" />
</div>

    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MK2847"
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MK2847');</script>
    <!-- End Google Tag Manager -->

</body>

<script type="text/javascript" src="/kb/static/js/main.1587e3a666fc.js" charset="utf-8"></script>

</html>