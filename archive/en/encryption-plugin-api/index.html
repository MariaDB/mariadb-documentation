<!DOCTYPE html>
<html>
<head data-cookie-domain=""
      data-cookie-path="/">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="apple-touch-icon" sizes="180x180" href="/kb/static/images/favicons/apple-touch-icon.159e713979be.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/kb/static/images/favicons/favicon-32x32.bc0ac1d5d11e.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/kb/static/images/favicons/favicon-16x16.5801f8f0f34e.png">
    <link rel="shortcut icon" href="/kb/static/images/favicons/favicon.d122d305dee4.ico" type="image/x-icon" />

    <title>Encryption Plugin API - MariaDB Knowledge Base</title>

    <link href="/kb/static/css/main.9a0d7dcebefd.css" rel="stylesheet" type="text/css" />

    

    <!-- FB Open Graph tags -->
    <meta property="og:title" content="Encryption Plugin API" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://mariadb.com/kb/en/encryption-plugin-api/" />
    <meta property="og:image" content="http://mariadb.comaskmonty-logo.png" />
    <meta property="og:site_name" content="MariaDB KnowledgeBase" />
    <meta property="fb:admins" content="514852603" />
    <meta property="og:description" content="MariaDB uses plugins to handle key management and encryption of data." />

    <meta name="description" content="MariaDB uses plugins to handle key management and encryption of data." />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet"/>
    
</head>
<body class="mpkb nodes products nodes_view jqui" id="nodes_view">





<div id="menu-mobile" class="visible-sm visible-xs">

    <div>
        <div id="mobile-close-menu" class="text-right">
            <a href="javascript:void(0)" title="Close Menu" id="back-main" class="toggle-menu">X<span></span></a>
        </div>
    </div>
    <div class="mainmenu-mobile">
        <ul class="ls-none ul-menu">
            <li data-sub="submenu5"><a class="open-form-search" href="/kb/search/" title="Search">Search </a></li>
            <li data-sub="submenu0"><a href="/products" title="Products">Products</a><span class="arrow-main"></span></li>
            <li data-sub="submenu1"><a href="/services" title="Services">Services</a><span class="arrow-main"></span></li>
            <li data-sub="submenu2"><a href="/resources" title="Resources">Resources</a><span class="arrow-main"></span></li>
            <li data-sub="submenu3"><a href="/about-us" title="About">About</a><span class="arrow-main"></span></li>
            <li data-sub="submenu4"><a href="/contact" title="Contact">Contact</a></li>
        </ul>
    </div>

    <div class="nav-top-mobile">
        <div class="select-box form">

            <ul class="inline-block-md mb-none top-nav">
                <li>

                </li>
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/encryption-plugin-api/"> Login</a>
                    </li>
                
            </ul>



        </div>
        <p class="text-center copyright">Copyright &copy; 2023 MariaDB. All rights reserved.</p>
    </div>
</div>
<div id="wrapper">
<div id="top-nav">
    <div class="container">
        <ul class="hidden-sm hidden-xs" >
            <li><a href="https://mariadb.com/kb/">Knowledge Base</a></li>
            <li><a href="https://mariadb.com/contact/">Contact</a></li>
            
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/encryption-plugin-api/" rel="nofollow">Login</a>
                    </li>
                
            
            
            <li id="search-form">
                <form action="/kb/en/+search/" method="get" id="search-block-form" accept-charset="UTF-8">
                    <input id="search" title="Enter the terms you wish to search for."
                           placeholder="Search . . ." type="text"
                           name="q" value="" size="15" maxlength="128" class="form-text"
                           data-autocomplete-url="/kb/en/+search/autocomplete/">
                    <input type="hidden" name="quick" value="1" />
                    <input type="hidden" name="source" value="kb" />
                </form>
            </li>
            <li><a id="search-toggler" href="/kb/search/">Search</a></li>
            
        </ul>
    </div>
</div>
<div id="navbar-bottom" class="navbar">
    <div class="container">
        
        
        
        
        <div class="row">
            <div class="col-md-3 col-sm-9 col-xs-9">
                <a class="brand" href="/" title="MariaDB">
                    <img src="/kb/static/images/logo-2018-black.95f5978ae14d.png">
                </a>
            </div>
            <div class="col-md-9 hidden-sm hidden-xs">
                <div class="main-menu">
                    <ul id="main-menu" class="nav navbar-nav inline-block-sm">
    <li class="has-sub full-menu">
        <a href="/products" title="Products">Products</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/services" title="Services">Services</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/pricing" title="Pricing">Pricing</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/resources" title="Resources">Resources</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/about-us" title="About Us">About Us</a>
    </li>
    <li class="">
        <a class="button electric-eel small top-bar-right-download" href="/downloads/">Download</a>
    </li>
</ul>
                </div>
            </div>
            <div class="col-md-3 visible-sm visible-xs col-sm-3 col-xs-3 ps-rv">
                <div class="navbar-header text-right pull-right">
                    <button type="button" class="menu-control toggle-menu" id="open-menu">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="main">
    <div class="container">
        

        <div id="subheader1" class="clearfix">
            <div class="pull-left">
                
                <div id="breadcrumbs" class="breadcrumb">
                    <a href="/kb/en/">Knowledge Base</a>
                    


    
    » <a class="crumb" href="/kb/en/training-tutorials/">Training &amp; Tutorials</a>
    

    
    » <a class="crumb" href="/kb/en/advanced-mariadb-articles/">Advanced MariaDB Articles</a>
    

    
    » <a class="crumb" href="/kb/en/development-articles/">Development Articles</a>
    

    
    » <a class="crumb" href="/kb/en/mariadb-internals-documentation/">MariaDB Internals Documentation</a>
    


    » <a class="node_link crumb" href="/kb/en/encryption-plugin-api/">Encryption Plugin API</a>


                </div>
                
            </div>
        </div>
    </div>
    <div class="container" id="container-main">
        <div class="row">
            
            
                
                <aside id="sidebar-first" class="sidebar col-md-2 hidden-xs hidden-sm hidden-print">
                    
                        
                        <ul id="category_menu" class="nav nav-pills nav-stacked">
                            <li><a href="/kb/en/">Home</a></li>
                            
                                
                                    <li><a href="/kb/en/+questions/">Open Questions</a></li>
                                
                                <li><a href="/kb/en/documentation/">MariaDB Server</a></li>
                                <li><a href="/kb/en/maxscale/">MariaDB MaxScale</a></li>
                                <li><a href="/kb/en/mariadb-columnstore/">MariaDB ColumnStore</a></li>
                                <li><a href="/kb/en/connectors/">Connectors</a></li>
                            

                        </ul>
                    

                    
<div>



<div class="well well-small box actions"><div>

        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/encryption-plugin-api/+history" rel="nofollow">History</a>
        
        
        
        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/encryption-plugin-api/+source/">Source</a>
        
        <a class="btn btn-block btn-blue btn-sm flag" href="/kb/en/encryption-plugin-api/+flag"
                data-flag-url="/kb/en/encryption-plugin-api/+flag" rel="nofollow">
                Flag as Spam / Inappropriate</a>
        
        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/encryption-plugin-api/+translate/">
                Translate</a>
        

</div>
</div>





<div class="well well-small box node_info"><div>

    <dl>
        <dt>Created</dt>
        <dd>

<span class="datetime" title="2015-04-10 22:15">8 years, 2 months ago</span></dd>

        <dt>Modified</dt>
        <dd>

<span class="datetime" title="2019-01-16 03:36">4 years, 5 months ago</span></dd>

        <dt>Type</dt>
        <dd>article</dd>

        <dt>Status</dt>
        <dd>active</dd>

        <dt>License</dt>
        <dd>
            
                <a href="/kb/en/encryption-plugin-api/+license/">CC BY-SA / Gnu FDL</a>
            
        </dd>

        
    </dl>

    
    <ul class="rss_feeds">
        <li><a href="/kb/en/encryption-plugin-api/+history/feed/">
            History</a>
        </li>
        <li><a href="/kb/en/encryption-plugin-api/+comments/feed/">
            Comments</a>
        </li>
    </ul>
    

</div>
</div>





    
    
    

<div class="well well-small box attachments"><div><div class="edit_link pull-right"><a href="/kb/en/encryption-plugin-api/+edit/attachments/">Edit</a></div><h5>Attachments</h5></div><div>

        
            <div class="no_data">No attachments exist</div>
        
    
</div>
</div>

    



    
    
        

<div class="well well-small box"><div><h5>Localized Versions</h5></div><div>

        <ul>
            
            <li><a href="/kb/ko/encryption-plugins/">암호화 Plugin</a> [ko]</li>
            
        </ul>
        
</div>
</div>

    





    

<div class="well well-small box"><div><h5>Parents</h5></div><div>

        <ul>
            
                <li><a href="/kb/en/mariadb-internals-documentation/">MariaDB Internals Documentation</a></li>
            
                <li><a href="/kb/en/key-management-and-encryption-plugins/">Key Management and Encryption Plugins</a></li>
            
        </ul>
    
</div>
</div>



</div>


                    

































                </aside>
            
            
            
                
            
            
                
            
            <section id="content" class="limited_width col-md-8 clearfix">
                
                    <h1>Encryption Plugin API</h1>
                

                



                <div>
                    
    

    
    
    

    <div class="node creole">
        
        
        


    
    <div class="answer formatted">
        <div class="table_of_contents well well-small">
<h3>Contents</h3>
 <ol class="toc">

    <li class=""><a href="#encryption-plugin-api" title="Encryption Plugin API">Encryption Plugin API</a></li>

    <li class=""><a href="#current-encryption-plugins" title="Current Encryption Plugins">Current Encryption Plugins</a>    <ol class="toc">

        <li class=""><a href="#file_key_management" title="file_key_management">file_key_management</a>        <ol class="toc">

            <li class=""><a href="#versions" title="Versions">Versions</a>        </ol>
</li>

        <li class=""><a href="#aws_key_management" title="aws_key_management">aws_key_management</a>        <ol class="toc">

            <li class=""><a href="#versions" title="Versions">Versions</a>        </ol>
</li>

        <li class=""><a href="#example_key_management" title="example_key_management">example_key_management</a>        <ol class="toc">

            <li class=""><a href="#versions" title="Versions">Versions</a>        </ol>
</li>

        <li class=""><a href="#debug_key_management" title="debug_key_management">debug_key_management</a>        <ol class="toc">

            <li class=""><a href="#versions" title="Versions">Versions</a>        </ol>
    </ol>
</li>

    <li class=""><a href="#encryption-service" title="Encryption Service">Encryption Service</a> </ol>
</li>
</div>
<p>MariaDB's <a href="/kb/en/data-at-rest-encryption/">data-at-rest encryption</a> requires the use of a <a href="/kb/en/encryption-key-management/">key management and encryption plugin</a>. These plugins are responsible both for the management of encryption keys and for the actual encryption and decryption of data.</p>
<p>MariaDB supports the use of <a href="/kb/en/encryption-key-management/#using-multiple-encryption-keys">multiple encryption keys</a>. Each encryption key uses a 32-bit integer as a key identifier. If the specific plugin supports <a href="/kb/en/encryption-key-management/#rotating-keys">key rotation</a>, then encryption keys can also be rotated, which creates a new version of the encryption key.</p>
<p>See <a href="/kb/en/data-at-rest-encryption/">Data at Rest Encryption</a> and <a href="/kb/en/encryption-key-management/">Encryption Key Management</a> for more information.</p>
<h2 class="anchored_heading" id="encryption-plugin-api">Encryption Plugin API</h2>
<p>The Encryption plugin API was created to allow a plugin to:</p>
<ul start="1"><li>implement key management, provide encryption keys to the server on request and change them according to internal policies.
</li><li>implement actual data encryption and decryption with the algorithm defined by the plugin.
</li></ul>
<p>This is how the API reflects that:</p>
<pre class="fixed"><span class="cm">/* Returned from get_latest_key_version() */</span>
<span class="cp">#define ENCRYPTION_KEY_VERSION_INVALID (~(unsigned int)0)</span>
<span class="cp">#define ENCRYPTION_KEY_NOT_ENCRYPTED (0)</span>

<span class="cp">#define ENCRYPTION_KEY_SYSTEM_DATA 1</span>
<span class="cp">#define ENCRYPTION_KEY_TEMPORARY_DATA 2</span>

<span class="cm">/* Returned from get_key()  */</span>
<span class="cp">#define ENCRYPTION_KEY_BUFFER_TOO_SMALL (100)</span>

<span class="cp">#define ENCRYPTION_FLAG_DECRYPT 0</span>
<span class="cp">#define ENCRYPTION_FLAG_ENCRYPT 1</span>
<span class="cp">#define ENCRYPTION_FLAG_NOPAD 2</span>

<span class="k">struct</span> <span class="n">st_mariadb_encryption</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">interface_version</span><span class="p">;</span> <span class="cm">/**&lt; version plugin uses */</span>

  <span class="cm">/********************* KEY MANAGEMENT ***********************************/</span>

  <span class="cm">/**</span>
<span class="cm">    Function returning latest key version for a given key id.</span>

<span class="cm">    @return A version or ENCRYPTION_KEY_VERSION_INVALID to indicate an error.</span>
<span class="cm">  */</span>
  <span class="kt">unsigned</span> <span class="nf">int</span> <span class="p">(</span><span class="o">*</span><span class="n">get_latest_key_version</span><span class="p">)(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">key_id</span><span class="p">);</span>

  <span class="cm">/**</span>
<span class="cm">    Function returning a key for a key version</span>

<span class="cm">    @param key_id       The requested key id</span>
<span class="cm">    @param version      The requested key version</span>
<span class="cm">    @param key          The key will be stored there. Can be NULL -</span>
<span class="cm">                        in which case no key will be returned</span>
<span class="cm">    @param key_length   in: key buffer size</span>
<span class="cm">                        out: the actual length of the key</span>

<span class="cm">    This method can be used to query the key length - the required</span>
<span class="cm">    buffer size - by passing key==NULL.</span>

<span class="cm">    If the buffer size is less than the key length the content of the</span>
<span class="cm">    key buffer is undefined (the plugin is free to partially fill it with</span>
<span class="cm">    the key data or leave it untouched).</span>

<span class="cm">    @return 0 on success, or</span>
<span class="cm">            ENCRYPTION_KEY_VERSION_INVALID, ENCRYPTION_KEY_BUFFER_TOO_SMALL</span>
<span class="cm">            or any other non-zero number for errors</span>
<span class="cm">  */</span>
  <span class="kt">unsigned</span> <span class="nf">int</span> <span class="p">(</span><span class="o">*</span><span class="n">get_key</span><span class="p">)(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">key_id</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">version</span><span class="p">,</span>
                          <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">key</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">key_length</span><span class="p">);</span>

  <span class="cm">/********************* ENCRYPTION **************************************/</span>
  <span class="cm">/*</span>
<span class="cm">    The caller uses encryption as follows:</span>
<span class="cm">      1. Create the encryption context object of the crypt_ctx_size() bytes.</span>
<span class="cm">      2. Initialize it with crypt_ctx_init().</span>
<span class="cm">      3. Repeat crypt_ctx_update() until there are no more data to encrypt.</span>
<span class="cm">      4. Write the remaining output bytes and destroy the context object</span>
<span class="cm">         with crypt_ctx_finish().</span>
<span class="cm">  */</span>

  <span class="cm">/**</span>
<span class="cm">    Returns the size of the encryption context object in bytes</span>
<span class="cm">  */</span>
  <span class="kt">unsigned</span> <span class="nf">int</span> <span class="p">(</span><span class="o">*</span><span class="n">crypt_ctx_size</span><span class="p">)(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">key_id</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">key_version</span><span class="p">);</span>
  <span class="cm">/**</span>
<span class="cm">    Initializes the encryption context object.</span>
<span class="cm">  */</span>
  <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">crypt_ctx_init</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="n">ctx</span><span class="p">,</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">key</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">klen</span><span class="p">,</span>
                        <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">iv</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ivlen</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="p">,</span>
                        <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">key_id</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">key_version</span><span class="p">);</span>
  <span class="cm">/**</span>
<span class="cm">    Processes (encrypts or decrypts) a chunk of data</span>

<span class="cm">    Writes the output to th dst buffer. note that it might write</span>
<span class="cm">    more bytes that were in the input. or less. or none at all.</span>
<span class="cm">  */</span>
  <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">crypt_ctx_update</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="n">ctx</span><span class="p">,</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">src</span><span class="p">,</span>
                          <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">slen</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">dst</span><span class="p">,</span>
                          <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">dlen</span><span class="p">);</span>
  <span class="cm">/**</span>
<span class="cm">    Writes the remaining output bytes and destroys the encryption context</span>

<span class="cm">    crypt_ctx_update might&#39;ve cached part of the output in the context,</span>
<span class="cm">    this method will flush these data out.</span>
<span class="cm">  */</span>
  <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">crypt_ctx_finish</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="n">ctx</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">dst</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">dlen</span><span class="p">);</span>
  <span class="cm">/**</span>
<span class="cm">    Returns the length of the encrypted data</span>

<span class="cm">    It returns the exact length, given only the source length.</span>
<span class="cm">    Which means, this API only supports encryption algorithms where</span>
<span class="cm">    the length of the encrypted data only depends on the length of the</span>
<span class="cm">    input (a.k.a. compression is not supported).</span>
<span class="cm">  */</span>
  <span class="kt">unsigned</span> <span class="nf">int</span> <span class="p">(</span><span class="o">*</span><span class="n">encrypted_length</span><span class="p">)(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">slen</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">key_id</span><span class="p">,</span>
                                   <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">key_version</span><span class="p">);</span>
<span class="p">};</span>
</pre><p>The first method is used for key rotation. A plugin that doesn't support key rotation — for example, <strong>file_key_management</strong> — can return a fixed version for any valid key id. Note that it still has to return an error for an invalid key id. The version <code>ENCRYPTION_KEY_NOT_ENCRYPTED</code> means that the data should not be encrypted.</p>
<p>The second method is used for key management, the server uses it to retrieve the key corresponding to a specific key identifier and a specific key version.</p>
<p>The last five methods deal with encryption. Note that they take the key to use and key identifier and version. This is needed because the server can derive a session-specific, user-specific, or a tablespace-specific key from the original encryption key as returned by <code>get_key()</code>, so the <code>key</code> argument doesn't have to match the encryption key as the plugin knows it. On the other hand, the encryption algorithm may depend on the key identifier and version (and in the <strong>example_key_management</strong> plugin it does) so the plugin needs to know them to be able to encrypt the data.</p>
<p>Encryption methods are optional — if unset (as in the <strong>debug_key_management</strong> plugin), the server will fall back to AES_CBC.</p>
<h2 class="anchored_heading" id="current-encryption-plugins">Current Encryption Plugins</h2>
<p>The MariaDB source tree has four encryption plugins. All these plugins are fairly simple and can serve as good examples of the Encryption plugin API.</p>
<h3 class="anchored_heading" id="file_key_management">file_key_management</h3>
<p>It reads encryption keys from a plain-text file. It supports two different encryption algorithms. It supports multiple encryption keys. It does not support key rotation.
See the <a href="/kb/en/file-key-management-encryption-plugin/">File Key Management Plugin</a> article for more details.</p>
<h4 class="anchored_heading" id="versions">Versions</h4>
<div class="cstm-style darkheader-nospace-borders"><table><tr><th>Version</th><th>Status</th><th>Introduced</th></tr>
<tr><td>1.0</td><td>Stable</td><td><a href="/kb/en/mariadb-10118-release-notes/">MariaDB 10.1.18</a></td></tr>
<tr><td>1.0</td><td>Gamma</td><td><a href="/kb/en/mariadb-10113-release-notes/">MariaDB 10.1.13</a></td></tr>
<tr><td>1.0</td><td>Alpha</td><td><a href="/kb/en/mariadb-1013-release-notes/">MariaDB 10.1.3</a></td></tr>
</table>
</div><h3 class="anchored_heading" id="aws_key_management">aws_key_management</h3>
<p>The AWS Key Management plugin uses the <a href="https://aws.amazon.com/kms/">Amazon Web Services (AWS) Key Management Service (KMS)</a> to generate and store AES keys on disk, in encrypted form, using the Customer Master Key (CMK) kept in AWS KMS. When MariaDB Server starts, the plugin will decrypt the encrypted keys, using the AWS KMS "Decrypt" API function. MariaDB data will then be encrypted and decrypted using the AES key. It supports multiple encryption keys. It supports key rotation.</p>
<p>See the <a href="/kb/en/aws-key-management-encryption-plugin/">AWS Key Management Plugin</a> article for more details.</p>
<h4 class="anchored_heading" id="versions">Versions</h4>
<div class="cstm-style darkheader-nospace-borders"><table><tr><th>Version</th><th>Status</th><th>Introduced</th></tr>
<tr><td>1.0</td><td>Stable</td><td><a href="/kb/en/mariadb-1026-release-notes/">MariaDB 10.2.6</a>, <a href="/kb/en/mariadb-10124-release-notes/">MariaDB 10.1.24</a></td></tr>
<tr><td>1.0</td><td>Beta</td><td><a href="/kb/en/mariadb-10118-release-notes/">MariaDB 10.1.18</a></td></tr>
<tr><td>1.0</td><td>Experimental</td><td><a href="/kb/en/mariadb-10113-release-notes/">MariaDB 10.1.13</a></td></tr>
</table>
</div><h3 class="anchored_heading" id="example_key_management">example_key_management</h3>
<p>Uses random time-based generated keys, ignores key identifiers, supports key versions and key rotation. Uses AES_ECB and AES_CBC as encryption algorithms and changes them automatically together with key versions.</p>
<h4 class="anchored_heading" id="versions">Versions</h4>
<div class="cstm-style darkheader-nospace-borders"><table><tr><th>Version</th><th>Status</th><th>Introduced</th></tr>
<tr><td>1.0</td><td>Experimental</td><td><a href="/kb/en/mariadb-1013-release-notes/">MariaDB 10.1.3</a></td></tr>
</table>
</div><h3 class="anchored_heading" id="debug_key_management">debug_key_management</h3>
<p>Key is generated from the version, user manually controls key rotation. Only supports key identifier 1, uses only AES_CBC.</p>
<h4 class="anchored_heading" id="versions">Versions</h4>
<div class="cstm-style darkheader-nospace-borders"><table><tr><th>Version</th><th>Status</th><th>Introduced</th></tr>
<tr><td>1.0</td><td>Experimental</td><td><a href="/kb/en/mariadb-1013-release-notes/">MariaDB 10.1.3</a></td></tr>
</table>
</div><h2 class="anchored_heading" id="encryption-service">Encryption Service</h2>
<p>Encryption is generally needed on the very low level <strong>inside the storage engine</strong>. That is, the storage engine needs to support encryption and have access to the encryption and key management functionality. The usual way for a plugin to access some functionality in the server is via a <em>service</em>. In this case the server provides the Encryption Service for storage engines (and other interested plugins) to use. These service functions are directly hooked into encryption plugin methods (described above).</p>
<p>Service functions are declared as follows:</p>
<pre class="fixed"><span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">encryption_key_get_latest_version</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">key_id</span><span class="p">);</span>
<span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">encryption_key_get</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">key_id</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">key_version</span><span class="p">,</span>
                                <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">length</span><span class="p">);</span>
<span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">encryption_ctx_size</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">key_id</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">key_version</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">encryption_ctx_init</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">ctx</span><span class="p">,</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">key</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">klen</span><span class="p">,</span>
                        <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">iv</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ivlen</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="p">,</span>
                        <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">key_id</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">key_version</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">encryption_ctx_update</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">ctx</span><span class="p">,</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">src</span><span class="p">,</span>
                          <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">slen</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">dst</span><span class="p">,</span>
                          <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">dlen</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">encryption_ctx_finish</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">ctx</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">dst</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">dlen</span><span class="p">);</span>
<span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">encryption_encrypted_length</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">slen</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">key_id</span><span class="p">,</span>
                                         <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">key_version</span><span class="p">);</span>
</pre><p>There are also convenience helpers to check for a key or key version existence and to encrypt or decrypt a block of data with one function call.</p>
<pre class="fixed"><span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">encryption_key_id_exists</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">id</span><span class="p">);</span>
<span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">encryption_key_version_exists</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">id</span><span class="p">,</span>
                                           <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">version</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">encryption_crypt</span><span class="p">(</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">src</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">slen</span><span class="p">,</span>
                     <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">dst</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">dlen</span><span class="p">,</span>
                     <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">key</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">klen</span><span class="p">,</span>
                     <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">iv</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ivlen</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="p">,</span>
                     <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">key_id</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">key_version</span><span class="p">);</span>
</pre>
    </div>


        
            <div id="subscribe" class="well well-small hide hidden-print"
                 data-subscribe-url="/kb/en/encryption-plugin-api/+subscriptions/add"
                 data-unsubscribe-url="/kb/en/encryption-plugin-api/+subscriptions/remove">
            </div>
        

        
        
    
        <div class="simple_section_nav">
            <ul class="nav nav-pills">
                
                    <li><a href="/kb/en/mariadb-source-code-internals/">
                        ← MariaDB Source Code Internals
                    </a>
                    </li>
                
                
                    <li><a href="/kb/en/mariadb-internals-documentation/">
                        ↑ MariaDB Internals Documentation ↑
                    </a>
                    </li>
                
                
                    <li class="pull-right"><a href="/kb/en/password-validation/">
                        Password Validation Plugin API →
                    </a>
                    </li>
                
            </ul>
        </div>
    

        

        
        <h2>Comments</h2>
        
    
    <div id="comments" data-node-id="4907" data-comments-url="/kb/en/encryption-plugin-api/+comments"
         data-reply-url="/kb/en/encryption-plugin-api/comments/post/">
        Comments loading...
    </div>

        

    </div>


                    <div id="content_disclaimer" class="graybox">
                        Content reproduced on this site is the property of its respective owners,
                        and this content is not reviewed in advance by MariaDB. The views, information and opinions
                        expressed by this content do not necessarily represent those of MariaDB or any other party.
                    </div>
                </div>
            </section>

            
                <div id="right_bar" class="col-md-2">
                    
    
        
        <ul class="section_navigation well well-small hidden-xs hidden-sm">
            
                <li class="parent"><a href="/kb/en/mariadb-internals-documentation/">
                    ↑ MariaDB Internals Documentation ↑
                </a>
                </li>
            
            
                
                    <li>
                        <a href="/kb/en/contributing-code/">
                            <span class="pull-right not_primary"></span>
                            Contributing Code
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/development-writing-plugins-for-mariadb/">
                            
                            Writing Plugins for MariaDB
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/pluggable-authentication-overview/">
                            <span class="pull-right not_primary"></span>
                            Pluggable Authentication Overview
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/information-schema-plugins-show-and-flush-statements/">
                            
                            Information Schema plugins: SHOW and FLUSH statements
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-internals-documentation-query-optimizer/">
                            
                            Query Optimizer
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/using-mariadb-with-your-programs-api/">
                            
                            Using MariaDB with Your Programs (API)
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/storage-engines-storage-engine-development/">
                            <span class="pull-right not_primary"></span>
                            Storage Engine Development
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-internals-documentation-merging-into-mariadb/">
                            
                            Merging into MariaDB
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-source-code-internals/">
                            
                            MariaDB Source Code Internals
                        </a>
                    </li>
                
            
                
                    <li class="active">
                        <span>Encryption Plugin API</span>
                        
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/password-validation/">
                            
                            Password Validation Plugin API
                        </a>
                    </li>
                
            
        </ul>
    
    

                </div>
            
        </div>
    </div>
</div>

<!-- Footer -->
<footer id="footer">
    <div class="footer">
        <div class="container">
            <div class="row row-10">
                <div class="col-md-2 col-xs-4 item">
                    <h5>
                        <a href="/products" title="Products">Products</a>
                    </h5>
                    <ul>
                        <li id="menu-item-7816" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-7816"><a href="https://mariadb.com/products/mariadb-platform/">MariaDB Platform</a></li>
                        <li id="menu-item-7815" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-7815"><a href="https://mariadb.com/products/skysql/">MariaDB SkySQL</a></li>
                        <li id="menu-item-4172" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4172"><a href="https://mariadb.com/pricing/">Pricing</a></li>
                        <li id="menu-item-4163" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4163"><a href="https://mariadb.com/downloads/">Download MariaDB</a></li>
                    </ul>
                </div>
                <div class="col-md-2 col-xs-4 item">
                    <h5>
                        <a href="/services" title="Services">Services</a>
                    </h5>
                    <ul>
                        <li id="menu-item-4169" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4169"><a href="https://mariadb.com/services/remote-dba/">Remote DBA</a></li>
                        <li id="menu-item-41691" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4169"><a href="https://mariadb.com/services/skydba/">SkyDBA</a></li>
                        <li id="menu-item-4167" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4167"><a href="https://mariadb.com/services/enterprise-architect/">Enterprise Architect</a></li>
                        <li id="menu-item-4170" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4170"><a href="https://mariadb.com/services/technical-support-services/">Technical Support</a></li>
                        <li id="menu-item-4168" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4168"><a href="https://mariadb.com/services/migration-practice/">Migration Practice</a></li>
                        <li id="menu-item-4166" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4166"><a href="https://mariadb.com/services/consulting/">Consulting</a></li>
                        <li id="menu-item-4171" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4171"><a href="https://mariadb.com/services/training/">Training</a></li>
                    </ul>
                </div>
                <div class="col-md-2 col-xs-4 item">
                    <h5>
                        <a href="/resources" title="Resources">Resources</a>
                    </h5>
                    <ul>
                        <li id="menu-item-41751" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4175"><a href="https://mariadb.com/docs/">Documentation</a></li>
                        <li id="menu-item-41752" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4175"><a href="https://mariadb.com/developers/">Developers</a></li>
                        <li id="menu-item-4175" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4175"><a href="https://mariadb.com/resources/blog/">Blog</a></li>
                        <li id="menu-item-5462" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-5462"><a href="https://support.mariadb.com">Support</a></li>
                        <li id="menu-item-6004" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6004"><a href="https://mariadb.com/openworks/">OpenWorks</a></li>
                        <li id="menu-item-60041" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6004"><a href="https://mariadb.com/resources/customer-stories/">Customer Stories</a></li>
                        <li id="menu-item-7817" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7817"><a href="https://mariadb.com/resources/events/">Events</a></li>
                        <li id="menu-item-4177" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4177"><a href="https://mariadb.com/roadshow/">MariaDB Roadshow</a></li>
                    </ul>
                </div>
                <div class="visible-xs visible-sm clear"></div>
                <div class="col-md-2 col-xs-5 item">
                    <h5>
                        <a href="/about-us" title="About MariaDB">About</a>
                    </h5>
                    <ul>
                        <li id="menu-item-4173" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4173"><a href="https://mariadb.com/contact/">Contact</a></li>
                        <li id="menu-item-4161" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4161"><a href="https://mariadb.com/about-us/leadership/">Leadership</a></li>
                        <li id="menu-item-4162" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4162"><a href="https://mariadb.com/about-us/partners/">Partners</a></li>
                        <li id="menu-item-4174" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4174"><a href="https://mariadb.com/newsroom/">Newsroom</a></li>
                        <li id="menu-item-4160" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4160"><a href="https://mariadb.com/about-us/investors/">Investors</a></li>
                        <li id="menu-item-4159" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4159"><a href="https://mariadb.com/about-us/careers/">Careers</a></li>
                        <li id="menu-item-41591" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4159"><a href="https://mariadb.com/trust/">Trust Center</a></li>
                        <li id="menu-item-41592" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4159"><a href="https://mariadb.com/vulnerability-reporting/">Vulnerability Reporting</a></li>
                    </ul>
                </div>
                <div class="col-md-4 col-xs-7 item">
                    <div id="block-footercontact" class="block block-block-content block-block-content22b3af28-0754-44ec-a5c6-4466568f37e3">
                        <h5><a href="/contact" title="Contact">Contact</a></h5>
                    </div>
                    <div class="social">
                        <ul class="list-inline">
                            <li>
                                <a target="_blank" href="https://www.facebook.com/MariaDB.dbms/" title="Facebook">
                                    <i class="fa fa-facebook" aria-hidden="true"></i>
                                </a>
                            </li>
                            <li>
                                <a target="_blank" href="https://twitter.com/mariadb" title="Twitter">
                                    <i class="fa fa-twitter" aria-hidden="true"></i>
                                </a>
                            </li>
                            <li>
                                <a target="_blank" href="https://www.linkedin.com/company/mariadb-corporation?trk=company_logo " title="LinkedIn">
                                    <i class="fa fa-linkedin" aria-hidden="true"></i>
                                </a>
                            </li>
                        </ul>
                    </div>
                    <div id="block-footerformcontact" class="block block-block-content block-block-contentd754ee1b-3cc9-40e7-9ef4-f504f1197fb1">
                        
                            <p>Subscribe to our newsletter!</p>
                            <script src="//app-sj15.marketo.com/js/forms2/js/forms2.min.js"></script><form id="mktoForm_1498"></form>
                            <script>
                                <!--//--><![CDATA[// ><!--
                                MktoForms2.loadForm("//app-sj15.marketo.com", "573-PXI-984", 1498);
                                //--><!]]]]><![CDATA[>
                                //--><!]]>
                            </script>
                        
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="footer-copyright">
        <div class="container text-center">
            <ul class="list-inline no-margin">
                <li>
                    <a href="/legal" title="Legal">Legal</a>
                </li>
                <li>
                    <a href="/privacy-policy" title="Privacy Policy">Privacy Policy</a>
                </li>
                <li>
                    <a href="/cookie-policy/" title="Cookies">Cookie Policy</a>
                </li>
            </ul>
            <p>Copyright &copy; 2023 MariaDB. All rights reserved.</p>
        </div>
    </div>
</footer>
</div>

<div id="ajax_loading">
    <img src="/kb/static/images/ajax-loader.a51c5608d01a.gif" />
</div>

    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MK2847"
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MK2847');</script>
    <!-- End Google Tag Manager -->

</body>

<script type="text/javascript" src="/kb/static/js/main.fed4ec768178.js" charset="utf-8"></script>

</html>