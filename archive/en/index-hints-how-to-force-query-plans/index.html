<!DOCTYPE html>
<html>
<head data-cookie-domain=""
      data-cookie-path="/">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="apple-touch-icon" sizes="180x180" href="/kb/static/images/favicons/apple-touch-icon.159e713979be.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/kb/static/images/favicons/favicon-32x32.bc0ac1d5d11e.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/kb/static/images/favicons/favicon-16x16.5801f8f0f34e.png">
    <link rel="shortcut icon" href="/kb/static/images/favicons/favicon.d122d305dee4.ico" type="image/x-icon" />

    <title>Index Hints: How to Force Query Plans - MariaDB Knowledge Base</title>

    <link href="/kb/static/css/main.f7633538c846.css" rel="stylesheet" type="text/css" />

    

    

    <!-- FB Open Graph tags -->
    <meta property="og:title" content="Index Hints: How to Force Query Plans" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://mariadb.com/kb/en/index-hints-how-to-force-query-plans/" />
    <meta property="og:image" content="http://mariadb.comaskmonty-logo.png" />
    <meta property="og:site_name" content="MariaDB KnowledgeBase" />
    <meta property="fb:admins" content="514852603" />
    <meta property="og:description" content="Using hints to get the optimizer to use another query plan." />

    <meta name="description" content="Using hints to get the optimizer to use another query plan." />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet"/>
    
</head>
<body class="mpkb nodes products nodes_view jqui" id="nodes_view">





<div id="menu-mobile" class="visible-sm visible-xs">

    <div>
        <div id="mobile-close-menu" class="text-right">
            <a href="javascript:void(0)" title="Close Menu" id="back-main" class="toggle-menu">X<span></span></a>
        </div>
    </div>
    <div class="mainmenu-mobile">
        <ul class="ls-none ul-menu">
            <li data-sub="submenu5"><a class="open-form-search" href="/kb/search/" title="Search">Search </a></li>
            <li data-sub="submenu0"><a href="/products" title="Products">Products</a><span class="arrow-main"></span></li>
            <li data-sub="submenu1"><a href="/services" title="Services">Services</a><span class="arrow-main"></span></li>
            <li data-sub="submenu2"><a href="/resources" title="Resources">Resources</a><span class="arrow-main"></span></li>
            <li data-sub="submenu3"><a href="/about-us" title="About">About</a><span class="arrow-main"></span></li>
            <li data-sub="submenu4"><a href="/contact" title="Contact">Contact</a></li>
        </ul>
    </div>

    <div class="nav-top-mobile">
        <div class="select-box form">

            <ul class="inline-block-md mb-none top-nav">
                <li>

                </li>
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/index-hints-how-to-force-query-plans/"> Login</a>
                    </li>
                
            </ul>



        </div>
        <p class="text-center copyright">Copyright &copy; 2024 MariaDB. All rights reserved.</p>
    </div>
</div>
<div class="violator-wrap d-none" id="top_violator">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12">
                <div class="violator-outer">
                    <div class="violator-inner">
                        <div class="row">
                            <div class="col-xs-12 col-sm-9 col-lg-7 col-lg-offset-2" id="top_violator_content">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="content-link" target="_blank" rel="nofollow noreferrer">
                                    <span>The Ultimate Guide to High Availability with MariaDB</span>
                                </a>
                            </div>
                            <div class="col-xs-12 col-sm-3" id="top_violator_cta">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="btn btn-mariadb" target="_blank" rel="nofollow noreferrer">Download Now</a>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-link close-btn">
                        <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24" width="15px" height="15px"><path d="M 4.9902344 3.9902344 A 1.0001 1.0001 0 0 0 4.2929688 5.7070312 L 10.585938 12 L 4.2929688 18.292969 A 1.0001 1.0001 0 1 0 5.7070312 19.707031 L 12 13.414062 L 18.292969 19.707031 A 1.0001 1.0001 0 1 0 19.707031 18.292969 L 13.414062 12 L 19.707031 5.7070312 A 1.0001 1.0001 0 0 0 18.980469 3.9902344 A 1.0001 1.0001 0 0 0 18.292969 4.2929688 L 12 10.585938 L 5.7070312 4.2929688 A 1.0001 1.0001 0 0 0 4.9902344 3.9902344 z"/></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="wrapper">
<div id="top-nav">
    <div class="container">
        <ul class="hidden-sm hidden-xs" >
            <li><a href="https://mariadb.com/kb/">Knowledge Base</a></li>
            <li><a href="https://mariadb.com/contact/">Contact</a></li>
            
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/index-hints-how-to-force-query-plans/" rel="nofollow">Login</a>
                    </li>
                
            
            
            <li id="search-form">
                <form action="/kb/en/+search/" method="get" id="search-block-form" accept-charset="UTF-8">
                    <input id="search" title="Enter the terms you wish to search for."
                           placeholder="Search . . ." type="text"
                           name="q" value="" size="15" maxlength="128" class="form-text"
                           data-autocomplete-url="/kb/en/+search/autocomplete/">
                    <input type="hidden" name="quick" value="1" />
                    <input type="hidden" name="source" value="kb" />
                </form>
            </li>
            <li><a id="search-toggler" href="/kb/search/">Search</a></li>
            
        </ul>
    </div>
</div>
<div id="navbar-bottom" class="navbar">
    <div class="container">
        
        
        
        
        <div class="row">
            <div class="col-md-3 col-sm-9 col-xs-9">
                <a class="brand" href="/" title="MariaDB">
                    <img src="/kb/static/images/logo-2018-black.95f5978ae14d.png">
                </a>
            </div>
            <div class="col-md-9 hidden-sm hidden-xs">
                <div class="main-menu">
                    <ul id="main-menu" class="nav navbar-nav inline-block-sm">
    <li class="has-sub full-menu">
        <a href="/products" title="Products">Products</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/services" title="Services">Services</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/pricing" title="Pricing">Pricing</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/resources" title="Resources">Resources</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/about-us" title="About Us">About Us</a>
    </li>
    <li class="">
        <a class="button electric-eel small top-bar-right-download" href="/downloads/">Download</a>
    </li>
</ul>
                </div>
            </div>
            <div class="col-md-3 visible-sm visible-xs col-sm-3 col-xs-3 ps-rv">
                <div class="navbar-header text-right pull-right">
                    <button type="button" class="menu-control toggle-menu" id="open-menu">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="main">
    <div class="container">
        

        <div id="subheader1" class="clearfix">
            <div class="pull-left">
                
                <div id="breadcrumbs" class="breadcrumb">
                    <a href="/kb/en/">Knowledge Base</a>
                    


    
    » <a class="crumb" href="/kb/en/documentation/">MariaDB Server Documentation</a>
    

    
    » <a class="crumb" href="/kb/en/replication-cluster-multi-master/">High Availability &amp; Performance Tuning</a>
    

    
    » <a class="crumb" href="/kb/en/optimization-and-tuning/">Optimization and Tuning</a>
    

    
    » <a class="crumb" href="/kb/en/query-optimizations/">Query Optimizations</a>
    


    » <a class="node_link crumb" href="/kb/en/index-hints-how-to-force-query-plans/">Index Hints: How to Force Query Plans</a>


                </div>
                
            </div>
        </div>
    </div>
    <div class="container" id="container-main">
        <div class="row">
            
            
                
                <aside id="sidebar-first" class="sidebar col-md-2 hidden-xs hidden-sm hidden-print">
                    
                        
                        <ul id="category_menu" class="nav nav-pills nav-stacked">
                            <li><a href="/kb/en/">Home</a></li>
                            
                                
                                    <li><a href="/kb/en/+questions/">Open Questions</a></li>
                                
                                <li><a href="/kb/en/documentation/">MariaDB Server</a></li>
                                <li><a href="/kb/en/maxscale/">MariaDB MaxScale</a></li>
                                <li><a href="/kb/en/mariadb-columnstore/">MariaDB ColumnStore</a></li>
                                <li><a href="/kb/en/connectors/">Connectors</a></li>
                            

                        </ul>
                    

                    
<div>



<div class="well well-small box actions"><div>

        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/index-hints-how-to-force-query-plans/+history" rel="nofollow">History</a>
        
        
        
        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/index-hints-how-to-force-query-plans/+source/">Source</a>
        
        <a class="btn btn-block btn-blue btn-sm flag" href="/kb/en/index-hints-how-to-force-query-plans/+flag"
                data-flag-url="/kb/en/index-hints-how-to-force-query-plans/+flag" rel="nofollow">
                Flag as Spam / Inappropriate</a>
        
        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/index-hints-how-to-force-query-plans/+translate/">
                Translate</a>
        

</div>
</div>





<div class="well well-small box node_info"><div>

    <dl>
        <dt>Created</dt>
        <dd>

<span class="datetime" title="2011-10-14 00:10">12 years, 11 months ago</span></dd>

        <dt>Modified</dt>
        <dd>

<span class="datetime" title="2023-05-29 20:36">1 year, 3 months ago</span></dd>

        <dt>Type</dt>
        <dd>article</dd>

        <dt>Status</dt>
        <dd>active</dd>

        <dt>License</dt>
        <dd>
            
                <a href="/kb/en/index-hints-how-to-force-query-plans/+license/">CC BY-SA / Gnu FDL</a>
            
        </dd>

        
    </dl>

    
    <ul class="rss_feeds">
        <li><a href="/kb/en/index-hints-how-to-force-query-plans/+history/feed/">
            History</a>
        </li>
        <li><a href="/kb/en/index-hints-how-to-force-query-plans/+comments/feed/">
            Comments</a>
        </li>
    </ul>
    

</div>
</div>





    
    
    

<div class="well well-small box attachments"><div><div class="edit_link pull-right"><a href="/kb/en/index-hints-how-to-force-query-plans/+edit/attachments/">Edit</a></div><h5>Attachments</h5></div><div>

        
            <div class="no_data">No attachments exist</div>
        
    
</div>
</div>

    



    
    
        

<div class="well well-small box"><div><h5>Localized Versions</h5></div><div>

        <ul>
            
            <li><a href="/kb/it/how-to-force-query-plans/">Come forzare i piani delle query</a> [it]</li>
            
        </ul>
        
</div>
</div>

    






</div>


                    

































                </aside>
            
            
            
                
            
            
                
            
            <section id="content" class="limited_width col-md-8 clearfix">
                
                    <h1>Index Hints: How to Force Query Plans</h1>
                

                



                <div>
                    
    

    
    
    

    <div class="node creole">
        
        
        


    
    <div class="answer formatted">
        <div class="table_of_contents well well-small">
<h3>Contents</h3>
 <ol class="toc">

    <li class=""><a href="#setting-up-the-world-example-database" title="Setting up the World Example Database">Setting up the World Example Database</a></li>

    <li class=""><a href="#forcing-join-order" title="Forcing Join Order">Forcing Join Order</a></li>

    <li class=""><a href="#forcing-usage-of-a-specific-index-for-the-where-clause" title="Forcing Usage of a Specific Index for the WHERE Clause">Forcing Usage of a Specific Index for the WHERE Clause</a>    <ol class="toc">

        <li class=""><a href="#use-index-use-a-limited-set-of-indexes" title="USE INDEX: Use a Limited Set of Indexes">USE INDEX: Use a Limited Set of Indexes</a></li>

        <li class=""><a href="#ignore-index-dont-use-a-particular-index" title="IGNORE INDEX: Don&#39;t Use a Particular Index">IGNORE INDEX: Don&#39;t Use a Particular Index</a></li>

        <li class=""><a href="#force-index-forcing-an-index" title="FORCE INDEX: Forcing an Index">FORCE INDEX: Forcing an Index</a></li>

        <li class=""><a href="#index-prefixes" title="Index Prefixes">Index Prefixes</a>    </ol>
</li>

    <li class=""><a href="#forcing-an-index-to-be-used-for-order-by-or-group-by" title="Forcing an Index to be Used for ORDER BY or GROUP BY">Forcing an Index to be Used for ORDER BY or GROUP BY</a>    <ol class="toc">

        <li class=""><a href="#help-the-optimizer-optimize-group-by-and-order-by" title="Help the Optimizer Optimize GROUP BY and ORDER BY">Help the Optimizer Optimize GROUP BY and ORDER BY</a></li>

        <li class=""><a href="#forcingdisallowing-temporarytables-to-be-used-for-group-by" title="Forcing/Disallowing TemporaryTables to be Used for GROUP BY:">Forcing/Disallowing TemporaryTables to be Used for GROUP BY:</a>    </ol>
</li>

    <li class=""><a href="#forcing-usage-of-temporary-tables" title="Forcing Usage of Temporary Tables">Forcing Usage of Temporary Tables</a></li>

    <li class=""><a href="#optimizer-switch" title="Optimizer Switch">Optimizer Switch</a></li>

    <li class=""><a href="#see-also" title="See Also">See Also</a> </ol>
</li>
</div><p>
The optimizer is largely cost-based and will try to choose the optimal plan for
any query. However in some cases it does not have enough information to choose
a perfect plan and in these cases you may have to provide hints to force the
optimizer to use another plan.</p>
<p>You can examine the query plan for a <a href="/kb/en/select/">SELECT</a> by writing
<a href="/kb/en/explain/">EXPLAIN</a> before the statement. <a href="/kb/en/show-explain/">SHOW EXPLAIN</a> shows the output of a running query. In some cases, its output can be closer to reality than <code>EXPLAIN</code>.</p>
<p>For the following queries, we will use the world database for
the examples.</p>
<h2 class="anchored_heading" id="setting-up-the-world-example-database">Setting up the World Example Database</h2>
<p>Download it from <a href="ftp://ftp.askmonty.org/public/world.sql.gz">ftp://ftp.askmonty.org/public/world.sql.gz</a></p>
<p>Install it with:</p>
<pre class="fixed">mariadb-admin create world
zcat world.sql.gz | ../client/mysql world
</pre><p>or</p>
<pre class="fixed">mariadb-admin create world
gunzip world.sql.gz
../client/mysql world &lt; world.sql
</pre><h2 class="anchored_heading" id="forcing-join-order">Forcing Join Order</h2>
<p>You can force the join order by using <a href="/kb/en/join/">STRAIGHT_JOIN</a> either in
the <a href="/kb/en/select/">SELECT</a> or <a href="/kb/en/join/">JOIN</a> part.</p>
<p>The simplest way to force the join order is to put the tables in the correct
order in the <code>FROM</code> clause and use <code>SELECT STRAIGHT_JOIN</code> like so:</p>
<pre class="fixed">SELECT STRAIGHT_JOIN SUM(City.Population) FROM Country,City WHERE
City.CountryCode=Country.Code AND Country.HeadOfState=&#34;Volodymyr Zelenskyy&#34;;
</pre><p>If you only want to force the join order for a few tables, use
<code>STRAIGHT_JOIN</code> in the <code>FROM</code> clause. When this is done, only tables
connected with <code>STRAIGHT_JOIN</code> will have their order forced. For example:</p>
<pre class="fixed">SELECT SUM(City.Population) FROM Country STRAIGHT_JOIN City WHERE
City.CountryCode=Country.Code AND Country.HeadOfState=&#34;Volodymyr Zelenskyy&#34;;
</pre><p>In both of the above cases <code>Country</code> will be scanned first and for each
matching country (one in this case) all rows in <code>City</code> will be checked for a
match. As there is only one matching country this will be faster than the
original query.</p>
<p>The output of <a href="/kb/en/explain/">EXPLAIN</a> for the above cases is:</p>
<div class="cstm-style darkheader-nospace-borders"><table><tr><th>id</th><th>select_type</th><th>table</th><th>type</th><th>possible_keys</th><th>key</th><th>key_len</th><th>ref</th><th>rows</th><th>Extra</th></tr>
<tr><td>1</td><td>SIMPLE</td><td>Country</td><td>ALL</td><td>PRIMARY</td><td>NULL</td><td>NULL</td><td>NULL</td><td>239</td><td>Using where</td></tr>
<tr><td>1</td><td>SIMPLE</td><td>City</td><td>ALL</td><td>NULL</td><td>NULL</td><td>NULL</td><td>NULL</td><td>4079</td><td>Using where; Using join buffer (flat, BNL join)</td></tr>
</table>
</div><p>This is one of the few cases where <code>ALL</code> is ok, as the scan of the
<code>Country</code> table will only find one matching row.</p>
<h2 class="anchored_heading" id="forcing-usage-of-a-specific-index-for-the-where-clause">Forcing Usage of a Specific Index for the WHERE Clause</h2>
<p>In some cases the optimizer may choose a non-optimal index or it may choose to
not use an index at all, even if some index could theoretically be used.</p>
<p>In these cases you have the option to either tell the optimizer to only use a
limited set of indexes, ignore one or more indexes, or force the usage of some
particular index.</p>
<h3 class="anchored_heading" id="use-index-use-a-limited-set-of-indexes">USE INDEX: Use a Limited Set of Indexes</h3>
<p>You can limit which indexes are considered with the <a href="/kb/en/use-index/">USE INDEX</a>
option.</p>
<pre class="fixed">USE INDEX [{FOR {JOIN|ORDER BY|GROUP BY}] ([index_list])
</pre><p>The default is '<code>FOR JOIN</code>', which means that the hint only affects how the
<code>WHERE</code> clause is optimized.</p>
<p><code>USE INDEX</code> is used after the table name in the <code>FROM</code> clause.</p>
<p>Example:</p>
<pre class="fixed">CREATE INDEX Name ON City (Name);
CREATE INDEX CountryCode ON City (Countrycode);
EXPLAIN SELECT Name FROM City USE INDEX (CountryCode)
WHERE name=&#34;Helsingborg&#34; AND countrycode=&#34;SWE&#34;;
</pre><p>This produces:</p>
<div class="cstm-style darkheader-nospace-borders"><table><tr><th>id</th><th>select_type</th><th>table</th><th>type</th><th>possible_keys</th><th>key</th><th>key_len</th><th>ref</th><th>rows</th><th>Extra</th></tr>
<tr><td>1</td><td>SIMPLE</td><td>City</td><td>ref</td><td>CountryCode</td><td>CountryCode</td><td>3</td><td>const</td><td>14</td><td>Using where</td></tr>
</table>
</div><p>If we had not used <a href="/kb/en/use-index/">USE INDEX</a>, the <code>Name</code> index would have been in
<code>possible keys</code>.</p>
<h3 class="anchored_heading" id="ignore-index-dont-use-a-particular-index">IGNORE INDEX: Don't Use a Particular Index</h3>
<p>You can tell the optimizer to not consider some particular index with the
<a href="/kb/en/ignore-index/">IGNORE INDEX</a> option.</p>
<pre class="fixed">IGNORE INDEX [{FOR {JOIN|ORDER BY|GROUP BY}] ([index_list])
</pre><p>This is used after the table name in the <code>FROM</code> clause:</p>
<pre class="fixed">CREATE INDEX Name ON City (Name);
CREATE INDEX CountryCode ON City (Countrycode);
EXPLAIN SELECT Name FROM City IGNORE INDEX (Name)
WHERE name=&#34;Helsingborg&#34; AND countrycode=&#34;SWE&#34;;
</pre><p>This produces:</p>
<div class="cstm-style darkheader-nospace-borders"><table><tr><th>id</th><th>select_type</th><th>table</th><th>type</th><th>possible_keys</th><th>key</th><th>key_len</th><th>ref</th><th>rows</th><th>Extra</th></tr>
<tr><td>1</td><td>SIMPLE</td><td>City</td><td>ref</td><td>CountryCode</td><td>CountryCode</td><td>3</td><td>const</td><td>14</td><td>Using where</td></tr>
</table>
</div><p>The benefit of using <code>IGNORE_INDEX</code> instead of <code>USE_INDEX</code> is that it will
not disable a new index which you may add later.</p>
<p>Also see <a href="/kb/en/ignored-indexes/">Ignored Indexes</a> for an option to specify in the index definition that indexes should be ignored.</p>
<h3 class="anchored_heading" id="force-index-forcing-an-index">FORCE INDEX: Forcing an Index</h3>
<p><a href="/kb/en/force-index/">Forcing an index</a> to be used is mostly useful when the optimizer
decides to do a table scan even if you know that using an index would
be better. (The optimizer could decide to do a table scan even if there is
an available index when it believes that most or all rows will match and
it can avoid the overhead of using the index).</p>
<pre class="fixed">CREATE INDEX Name ON City (Name);
EXPLAIN SELECT Name,CountryCode FROM City FORCE INDEX (Name)
WHERE name&gt;=&#34;A&#34; and CountryCode &gt;=&#34;A&#34;;
</pre><p>This produces:</p>
<div class="cstm-style darkheader-nospace-borders"><table><tr><th>id</th><th>select_type</th><th>table</th><th>type</th><th>possible_keys</th><th>key</th><th>key_len</th><th>ref</th><th>rows</th><th>Extra</th></tr>
<tr><td>1</td><td>SIMPLE</td><td>City</td><td>range</td><td>Name</td><td>Name</td><td>35</td><td>NULL</td><td>4079</td><td>Using where</td></tr>
</table>
</div><p><code>FORCE_INDEX</code> works by only considering the given indexes (like with
<code>USE_INDEX</code>) but in addition it tells the optimizer to regard a table scan as
something very expensive. However if none of the 'forced' indexes can be used,
then a table scan will be used anyway.</p>
<h3 class="anchored_heading" id="index-prefixes">Index Prefixes</h3>
<p>When using index hints (USE, FORCE or <a href="/kb/en/ignore-index/">IGNORE INDEX</a>), the index name value can also be an unambiguous prefix of an index name.</p>
<h2 class="anchored_heading" id="forcing-an-index-to-be-used-for-order-by-or-group-by">Forcing an Index to be Used for ORDER BY or GROUP BY</h2>
<p>The optimizer will try to use indexes to resolve <a href="/kb/en/order-by/">ORDER BY</a> and <a href="/kb/en/group-by/">GROUP BY</a>.</p>
<p>You can use <a href="/kb/en/use-index/">USE INDEX</a>, <a href="/kb/en/ignore-index/">IGNORE INDEX</a> and
<a href="/kb/en/force-index/">FORCE INDEX</a> as in the <code class="highlight fixed" style="white-space:pre-wrap">WHERE</code> clause above
to ensure that some specific index used:</p>
<pre class="fixed">USE INDEX [{FOR {JOIN|ORDER BY|GROUP BY}] ([index_list])
</pre><p>This is used after the table name in the <code class="highlight fixed" style="white-space:pre-wrap">FROM</code> clause.</p>
<p>Example:</p>
<pre class="fixed">CREATE INDEX Name ON City (Name);
EXPLAIN SELECT Name,Count(*) FROM City
FORCE INDEX FOR GROUP BY (Name)
WHERE population &gt;= 10000000 GROUP BY Name;
</pre><p>This produces:</p>
<div class="cstm-style darkheader-nospace-borders"><table><tr><th>id</th><th>select_type</th><th>table</th><th>type</th><th>possible_keys</th><th>key</th><th>key_len</th><th>ref</th><th>rows</th><th>Extra</th></tr>
<tr><td>1</td><td>SIMPLE</td><td>City</td><td>index</td><td>NULL</td><td>Name</td><td>35</td><td>NULL</td><td>4079</td><td>Using where</td></tr>
</table>
</div><p>Without the <a href="/kb/en/force-index/">FORCE INDEX</a> option we would have
'<code class="highlight fixed" style="white-space:pre-wrap">Using where; Using temporary; Using filesort</code>' in the
'Extra' column, which means that the optimizer would created a temporary
table and sort it.</p>
<h3 class="anchored_heading" id="help-the-optimizer-optimize-group-by-and-order-by">Help the Optimizer Optimize GROUP BY and ORDER BY</h3>
<p>The optimizer uses several strategies to optimize <a href="/kb/en/group-by/">GROUP BY</a>
and <a href="/kb/en/order-by/">ORDER BY</a>:</p>
<ul start="1"><li>Resolve with an index:
<ul start="1"><li>Scan the table in index order and output data as we go. (This only works if
   the <a href="/kb/en/order-by/">ORDER BY</a> / <a href="/kb/en/group-by/">GROUP BY</a> can be
   resolved by an index after constant propagation is done).
</li></ul>
</li></ul>
<ul start="1"><li>Filesort:
<ul start="1"><li>Scan the table to be sorted and collect the sort keys in a temporary file.
</li><li>Sort the keys + reference to row (with filesort)
</li><li>Scan the table in sorted order
</li></ul>
</li></ul>
<ul start="1"><li>Use a temporary table for <a href="/kb/en/order-by/">ORDER BY</a>:
<ul start="1"><li>Create a temporary (in memory) table for the 'to-be-sorted' data. (If this
   gets bigger than <code class="highlight fixed" style="white-space:pre-wrap">max_heap_table_size</code> or contains blobs
   then an <a href="/kb/en/aria/">Aria</a> or <a href="/kb/en/myisam/">MyISAM</a> disk based table will be used)
</li><li>Sort the keys + reference to row (with filesort)
</li><li>Scan the table in sorted order
</li></ul>
</li></ul>
<p>A temporary table will always be used if the fields which will be sorted are
not from the first table in the <a href="/kb/en/join/">JOIN</a> order.</p>
<ul start="1"><li>Use a temporary table for <a href="/kb/en/group-by/">GROUP BY</a>:
<ul start="1"><li>Create a temporary table to hold the <a href="/kb/en/group-by/">GROUP BY</a> result with
   an index that matches the <a href="/kb/en/group-by/">GROUP BY</a> fields.
</li><li>Produce a result row
</li><li>If a row with the <a href="/kb/en/group-by/">GROUP BY</a> key exists in the temporary
   table, add the new result row to it. If not, create a new row.
</li><li>Before sending the results to the user, sort the rows with filesort to get
   the results in the <a href="/kb/en/group-by/">GROUP BY</a> order.
</li></ul>
</li></ul>
<h3 class="anchored_heading" id="forcingdisallowing-temporarytables-to-be-used-for-group-by">Forcing/Disallowing TemporaryTables to be Used for GROUP BY:</h3>
<p>Using an in-memory table (as described above) is usually the fastest option for
<a href="/kb/en/group-by/">GROUP BY</a> if the result set is small. It is not optimal if
the result set is very big. You can tell the optimizer this by using
<code class="highlight fixed" style="white-space:pre-wrap">SELECT SQL_SMALL_RESULT</code>
or <code class="highlight fixed" style="white-space:pre-wrap">SELECT SQL_BIG_RESULT</code>.</p>
<p>For example: </p>
<pre class="fixed">EXPLAIN SELECT SQL_SMALL_RESULT Name,Count(*) AS Cities FROM City GROUP BY Name HAVING Cities &gt; 2;
</pre><p>produces:</p>
<div class="cstm-style darkheader-nospace-borders"><table><tr><th>id</th><th>select_type</th><th>table</th><th>type</th><th>possible_keys</th><th>key</th><th>key_len</th><th>ref</th><th>rows</th><th>Extra</th></tr>
<tr><td>1</td><td>SIMPLE</td><td>City</td><td>ALL</td><td>NULL</td><td>NULL</td><td>NULL</td><td>NULL</td><td>4079</td><td>Using temporary; Using filesort</td></tr>
</table>
</div><p>while: </p>
<pre class="fixed">EXPLAIN SELECT SQL_BIG_RESULT Name,Count(*) AS Cities FROM City
GROUP BY Name HAVING Cities &gt; 2;
</pre><p>produces:</p>
<div class="cstm-style darkheader-nospace-borders"><table><tr><th>id</th><th>select_type</th><th>table</th><th>type</th><th>possible_keys</th><th>key</th><th>key_len</th><th>ref</th><th>rows</th><th>Extra</th></tr>
<tr><td>1</td><td>SIMPLE</td><td>City</td><td>ALL</td><td>NULL</td><td>NULL</td><td>NULL</td><td>NULL</td><td>4079</td><td>Using filesort</td></tr>
</table>
</div><p>The difference is that with <code class="highlight fixed" style="white-space:pre-wrap">SQL_SMALL_RESULT</code> a
temporary table is used.</p>
<h2 class="anchored_heading" id="forcing-usage-of-temporary-tables">Forcing Usage of Temporary Tables</h2>
<p>In some cases you may want to force the use of a temporary table for the result
to free up the table/row locks for the used tables as quickly as possible.</p>
<p>You can do this with the <code class="highlight fixed" style="white-space:pre-wrap">SQL_BUFFER_RESULT</code> option:</p>
<pre class="fixed">CREATE INDEX Name ON City (Name);
EXPLAIN SELECT SQL_BUFFER_RESULT Name,Count(*) AS Cities FROM City
GROUP BY Name HAVING Cities &gt; 2;
</pre><p>This produces:</p>
<div class="cstm-style darkheader-nospace-borders"><table><tr><th>id</th><th>select_type</th><th>table</th><th>type</th><th>possible_keys</th><th>key</th><th>key_len</th><th>ref</th><th>rows</th><th>Extra</th></tr>
<tr><td>1</td><td>SIMPLE</td><td>City</td><td>index</td><td>NULL</td><td>Name</td><td>35</td><td>NULL</td><td>4079</td><td>Using index; Using temporary</td></tr>
</table>
</div><p>Without <code class="highlight fixed" style="white-space:pre-wrap">SQL_BUFFER_RESULT</code>, the above query would not use a
temporary table for the result set.</p>
<h2 class="anchored_heading" id="optimizer-switch">Optimizer Switch</h2>
<p>In <a href="/kb/en/what-is-mariadb-53/">MariaDB 5.3</a> we added an <a href="/kb/en/server-system-variables/#optimizer_switch">optimizer switch</a>
which allows you to specify which algorithms will be considered when optimizing
a query.</p>
<p>See the <a href="/kb/en/optimizer/">optimizer</a> section for more information about the different
algorithms which are used.</p>
<h2 class="anchored_heading" id="see-also">See Also</h2>
<ul start="1"><li><a href="/kb/en/force-index/">FORCE INDEX</a>
</li><li><a href="/kb/en/use-index/">USE INDEX</a>
</li><li><a href="/kb/en/ignore-index/">IGNORE INDEX</a>
</li><li><a href="/kb/en/group-by/">GROUP BY</a>
</li><li><a href="/kb/en/ignored-indexes/">Ignored Indexes</a></li></ul>

    </div>


        
            <div id="subscribe" class="well well-small hide hidden-print"
                 data-subscribe-url="/kb/en/index-hints-how-to-force-query-plans/+subscriptions/add"
                 data-unsubscribe-url="/kb/en/index-hints-how-to-force-query-plans/+subscriptions/remove">
            </div>
        

        
        
    
        <div class="simple_section_nav">
            <ul class="nav nav-pills">
                
                
                    <li><a href="/kb/en/query-optimizations/">
                        ↑ Query Optimizations ↑
                    </a>
                    </li>
                
                
                    <li class="pull-right"><a href="/kb/en/subquery-optimizations/">
                        Subquery Optimizations →
                    </a>
                    </li>
                
            </ul>
        </div>
    

        

        
        <h2>Comments</h2>
        
    
    <div id="comments" data-node-id="1822" data-comments-url="/kb/en/index-hints-how-to-force-query-plans/+comments"
         data-reply-url="/kb/en/index-hints-how-to-force-query-plans/comments/post/">
        Comments loading...
    </div>

        

    </div>


                    <div id="content_disclaimer" class="graybox">
                        Content reproduced on this site is the property of its respective owners,
                        and this content is not reviewed in advance by MariaDB. The views, information and opinions
                        expressed by this content do not necessarily represent those of MariaDB or any other party.
                    </div>
                </div>
            </section>

            
                <div id="right_bar" class="col-md-2">
                    
    
        
        <ul class="section_navigation well well-small hidden-xs hidden-sm">
            
                <li class="parent"><a href="/kb/en/query-optimizations/">
                    ↑ Query Optimizations ↑
                </a>
                </li>
            
            
                
                    <li class="active">
                        <span>Index Hints: How to Force Query Plans</span>
                        
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/subquery-optimizations/">
                            
                            Subquery Optimizations
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/optimization-strategies/">
                            
                            Optimization Strategies
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/optimizations-for-derived-tables/">
                            
                            Optimizations for Derived Tables
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/table-elimination/">
                            
                            Table Elimination
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/statistics-for-optimizing-queries/">
                            
                            Statistics for Optimizing Queries
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/filesort-with-small-limit-optimization/">
                            
                            Filesort with Small LIMIT Optimization
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/limit-rows-examined/">
                            
                            LIMIT ROWS EXAMINED
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/index_merge-sort_intersection/">
                            
                            index_merge sort_intersection
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-53-optimizer-debugging/">
                            
                            MariaDB 5.3 Optimizer Debugging
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/optimizer-switch/">
                            
                            optimizer_switch
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/how-to-quickly-insert-data-into-mariadb/">
                            
                            How to Quickly Insert Data Into MariaDB
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/index-condition-pushdown/">
                            
                            Index Condition Pushdown
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/query-limits-and-timeouts/">
                            
                            Query Limits and Timeouts
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/aborting-statements/">
                            
                            Aborting Statements that Exceed a Certain Time to Execute
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/partition-pruning-and-selection/">
                            <span class="pull-right not_primary"></span>
                            Partition Pruning and Selection
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/big-deletes/">
                            
                            Big DELETEs 
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/charset-narrowing-optimization/">
                            
                            Charset Narrowing Optimization
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/data-sampling-techniques-for-efficiently-finding-a-random-row/">
                            
                            Data Sampling: Techniques for Efficiently Finding a Random Row
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/data-warehousing-high-speed-ingestion/">
                            
                            Data Warehousing High Speed Ingestion
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/data-warehousing-summary-tables/">
                            
                            Data Warehousing Summary Tables
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/data-warehousing-techniques/">
                            
                            Data Warehousing Techniques
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/query-optimizations-distinct-removal-in-aggregate-functions/">
                            
                            DISTINCT removal in aggregate functions
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/equality-propagation-optimization/">
                            
                            Equality propagation optimization
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/force-index/">
                            
                            FORCE INDEX
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/groupwise-max-in-mariadb/">
                            
                            Groupwise Max in MariaDB
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/guiduuid-performance/">
                            
                            GUID/UUID Performance
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/hash_join_cardinality-optimizer_switch-flag/">
                            
                            hash_join_cardinality optimizer_switch Flag
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/ignore-index/">
                            
                            IGNORE INDEX
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/not_null_range_scan-optimization/">
                            
                            not_null_range_scan Optimization
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/optimizer_adjust_secondary_key_costs/">
                            
                            optimizer_adjust_secondary_key_costs
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/optimizer_join_limit_pref_ratio-optimization/">
                            
                            optimizer_join_limit_pref_ratio optimization
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/optimizing-for-latest-news-style-queries/">
                            
                            Optimizing for &#34;Latest News&#34;-style Queries
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/pagination-optimization/">
                            
                            Pagination Optimization
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/pivoting-in-mariadb/">
                            
                            Pivoting in MariaDB
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/rollup-unique-user-counts/">
                            
                            Rollup Unique User Counts
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/rowid-filtering-optimization/">
                            
                            Rowid Filtering Optimization
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/sargable-date-and-year/">
                            
                            Sargable DATE and YEAR
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/sargable-upper/">
                            
                            Sargable UPPER
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/use-index/">
                            
                            USE INDEX
                        </a>
                    </li>
                
            
        </ul>
    
    

                </div>
            
        </div>
    </div>
</div>

<!-- Footer -->
<footer id="footer">
    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-xs-12">
                    <ul class="list-inline text-center footer-nav">
                        <li>
                            <h5>
                                <a href="https://mariadb.com/products" title="Products">Products</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/services" title="Services">Services</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/pricing" title="Pricing">Pricing</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/resources" title="Resources">Resources</a>
                            </h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/about-us" title="About MariaDB">About Us</a></h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/download" title="Download">Download MariaDB</a></h5>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="row row-10">
                
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div id="block-footerformcontact" class="block block-block-content block-block-contentd754ee1b-3cc9-40e7-9ef4-f504f1197fb1">
                        
                            <h5 style="font-weight: 400;">Subscribe to our newsletter!</h5>
                            <script src="//app-sj15.marketo.com/js/forms2/js/forms2.min.js"></script><form id="mktoForm_1498"></form>
                            <script>
                                <!--//--><![CDATA[// ><!--
                                MktoForms2.loadForm("//app-sj15.marketo.com", "573-PXI-984", 1498);
                                //--><!]]]]><![CDATA[>
                                //--><!]]>
                            </script>
                        
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div class="footer-copyright">
                        <div class="text-center">
                            <ul class="list-inline no-margin">
                                <li>
                                    <a href="/legal" title="Legal">Legal</a>
                                </li>
                                <li>
                                    <a href="/privacy-policy" title="Privacy Policy">Privacy Policy</a>
                                </li>
                                <li>
                                    <a href="/cookie-policy/" title="Cookies">Cookie Policy</a>
                                </li>
                            </ul>
                            <p>Copyright &copy; 2024 MariaDB. All rights reserved.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</footer>
</div>

<div id="ajax_loading">
    <img src="/kb/static/images/ajax-loader.a51c5608d01a.gif" />
</div>

    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MK2847"
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MK2847');</script>
    <!-- End Google Tag Manager -->

</body>

<script type="text/javascript" src="/kb/static/js/main.1587e3a666fc.js" charset="utf-8"></script>

</html>