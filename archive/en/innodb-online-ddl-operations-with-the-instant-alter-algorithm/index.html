<!DOCTYPE html>
<html>
<head data-cookie-domain=""
      data-cookie-path="/">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="apple-touch-icon" sizes="180x180" href="/kb/static/images/favicons/apple-touch-icon.159e713979be.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/kb/static/images/favicons/favicon-32x32.bc0ac1d5d11e.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/kb/static/images/favicons/favicon-16x16.5801f8f0f34e.png">
    <link rel="shortcut icon" href="/kb/static/images/favicons/favicon.d122d305dee4.ico" type="image/x-icon" />

    <title>InnoDB Online DDL Operations with the INSTANT Alter Algorithm - MariaDB Knowledge Base</title>

    <link href="/kb/static/css/main.b9e1e104f007.css" rel="stylesheet" type="text/css" />

    

    <!-- FB Open Graph tags -->
    <meta property="og:title" content="InnoDB Online DDL Operations with the INSTANT Alter Algorithm" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://mariadb.com/kb/en/innodb-online-ddl-operations-with-the-instant-alter-algorithm/" />
    <meta property="og:image" content="http://mariadb.comaskmonty-logo.png" />
    <meta property="og:site_name" content="MariaDB KnowledgeBase" />
    <meta property="fb:admins" content="514852603" />
    <meta property="og:description" content="These DDL operations can be done instantly with InnoDB." />

    <meta name="description" content="These DDL operations can be done instantly with InnoDB." />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet"/>
    
</head>
<body class="mpkb nodes products nodes_view jqui" id="nodes_view">





<div id="menu-mobile" class="visible-sm visible-xs">

    <div>
        <div id="mobile-close-menu" class="text-right">
            <a href="javascript:void(0)" title="Close Menu" id="back-main" class="toggle-menu">X<span></span></a>
        </div>
    </div>
    <div class="mainmenu-mobile">
        <ul class="ls-none ul-menu">
            <li data-sub="submenu5"><a class="open-form-search" href="/kb/search/" title="Search">Search </a></li>
            <li data-sub="submenu0"><a href="/products" title="Products">Products</a><span class="arrow-main"></span></li>
            <li data-sub="submenu1"><a href="/services" title="Services">Services</a><span class="arrow-main"></span></li>
            <li data-sub="submenu2"><a href="/resources" title="Resources">Resources</a><span class="arrow-main"></span></li>
            <li data-sub="submenu3"><a href="/about-us" title="About">About</a><span class="arrow-main"></span></li>
            <li data-sub="submenu4"><a href="/contact" title="Contact">Contact</a></li>
        </ul>
    </div>

    <div class="nav-top-mobile">
        <div class="select-box form">

            <ul class="inline-block-md mb-none top-nav">
                <li>

                </li>
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/innodb-online-ddl-operations-with-the-instant-alter-algorithm/"> Login</a>
                    </li>
                
            </ul>



        </div>
        <p class="text-center copyright">Copyright &copy; 2024 MariaDB. All rights reserved.</p>
    </div>
</div>
<div id="wrapper">
<div id="top-nav">
    <div class="container">
        <ul class="hidden-sm hidden-xs" >
            <li><a href="https://mariadb.com/kb/">Knowledge Base</a></li>
            <li><a href="https://mariadb.com/contact/">Contact</a></li>
            
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/innodb-online-ddl-operations-with-the-instant-alter-algorithm/" rel="nofollow">Login</a>
                    </li>
                
            
            
            <li id="search-form">
                <form action="/kb/en/+search/" method="get" id="search-block-form" accept-charset="UTF-8">
                    <input id="search" title="Enter the terms you wish to search for."
                           placeholder="Search . . ." type="text"
                           name="q" value="" size="15" maxlength="128" class="form-text"
                           data-autocomplete-url="/kb/en/+search/autocomplete/">
                    <input type="hidden" name="quick" value="1" />
                    <input type="hidden" name="source" value="kb" />
                </form>
            </li>
            <li><a id="search-toggler" href="/kb/search/">Search</a></li>
            
        </ul>
    </div>
</div>
<div id="navbar-bottom" class="navbar">
    <div class="container">
        
        
        
        
        <div class="row">
            <div class="col-md-3 col-sm-9 col-xs-9">
                <a class="brand" href="/" title="MariaDB">
                    <img src="/kb/static/images/logo-2018-black.95f5978ae14d.png">
                </a>
            </div>
            <div class="col-md-9 hidden-sm hidden-xs">
                <div class="main-menu">
                    <ul id="main-menu" class="nav navbar-nav inline-block-sm">
    <li class="has-sub full-menu">
        <a href="/products" title="Products">Products</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/services" title="Services">Services</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/pricing" title="Pricing">Pricing</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/resources" title="Resources">Resources</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/about-us" title="About Us">About Us</a>
    </li>
    <li class="">
        <a class="button electric-eel small top-bar-right-download" href="/downloads/">Download</a>
    </li>
</ul>
                </div>
            </div>
            <div class="col-md-3 visible-sm visible-xs col-sm-3 col-xs-3 ps-rv">
                <div class="navbar-header text-right pull-right">
                    <button type="button" class="menu-control toggle-menu" id="open-menu">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="main">
    <div class="container">
        

        <div id="subheader1" class="clearfix">
            <div class="pull-left">
                
                <div id="breadcrumbs" class="breadcrumb">
                    <a href="/kb/en/">Knowledge Base</a>
                    


    
    » <a class="crumb" href="/kb/en/documentation/">MariaDB Server Documentation</a>
    

    
    » <a class="crumb" href="/kb/en/columns-storage-engines-and-plugins/">Columns, Storage Engines, and Plugins</a>
    

    
    » <a class="crumb" href="/kb/en/storage-engines/">Storage Engines</a>
    

    
    » <a class="crumb" href="/kb/en/innodb/">InnoDB</a>
    

    
    » <a class="crumb" href="/kb/en/innodb-online-ddl/">InnoDB Online DDL</a>
    


    » <a class="node_link crumb" href="/kb/en/innodb-online-ddl-operations-with-the-instant-alter-algorithm/">InnoDB Online DDL Operations with the INSTANT Alter Algorithm</a>


                </div>
                
            </div>
        </div>
    </div>
    <div class="container" id="container-main">
        <div class="row">
            
            
                
                <aside id="sidebar-first" class="sidebar col-md-2 hidden-xs hidden-sm hidden-print">
                    
                        
                        <ul id="category_menu" class="nav nav-pills nav-stacked">
                            <li><a href="/kb/en/">Home</a></li>
                            
                                
                                    <li><a href="/kb/en/+questions/">Open Questions</a></li>
                                
                                <li><a href="/kb/en/documentation/">MariaDB Server</a></li>
                                <li><a href="/kb/en/maxscale/">MariaDB MaxScale</a></li>
                                <li><a href="/kb/en/mariadb-columnstore/">MariaDB ColumnStore</a></li>
                                <li><a href="/kb/en/connectors/">Connectors</a></li>
                            

                        </ul>
                    

                    
<div>



<div class="well well-small box actions"><div>

        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/innodb-online-ddl-operations-with-the-instant-alter-algorithm/+history" rel="nofollow">History</a>
        
        
        
        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/innodb-online-ddl-operations-with-the-instant-alter-algorithm/+source/">Source</a>
        
        <a class="btn btn-block btn-blue btn-sm flag" href="/kb/en/innodb-online-ddl-operations-with-the-instant-alter-algorithm/+flag"
                data-flag-url="/kb/en/innodb-online-ddl-operations-with-the-instant-alter-algorithm/+flag" rel="nofollow">
                Flag as Spam / Inappropriate</a>
        
        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/innodb-online-ddl-operations-with-the-instant-alter-algorithm/+translate/">
                Translate</a>
        

</div>
</div>





<div class="well well-small box node_info"><div>

    <dl>
        <dt>Created</dt>
        <dd>

<span class="datetime" title="2019-04-22 23:05">4 years, 10 months ago</span></dd>

        <dt>Modified</dt>
        <dd>

<span class="datetime" title="2023-07-22 01:12">7 months ago</span></dd>

        <dt>Type</dt>
        <dd>article</dd>

        <dt>Status</dt>
        <dd>active</dd>

        <dt>License</dt>
        <dd>
            
                <a href="/kb/en/innodb-online-ddl-operations-with-the-instant-alter-algorithm/+license/">CC BY-SA / Gnu FDL</a>
            
        </dd>

        
    </dl>

    
    <ul class="rss_feeds">
        <li><a href="/kb/en/innodb-online-ddl-operations-with-the-instant-alter-algorithm/+history/feed/">
            History</a>
        </li>
        <li><a href="/kb/en/innodb-online-ddl-operations-with-the-instant-alter-algorithm/+comments/feed/">
            Comments</a>
        </li>
    </ul>
    

</div>
</div>





    
    
    

<div class="well well-small box attachments"><div><div class="edit_link pull-right"><a href="/kb/en/innodb-online-ddl-operations-with-the-instant-alter-algorithm/+edit/attachments/">Edit</a></div><h5>Attachments</h5></div><div>

        
            <div class="no_data">No attachments exist</div>
        
    
</div>
</div>

    



    
    






</div>


                    

































                </aside>
            
            
            
                
            
            
                
            
            <section id="content" class="limited_width col-md-8 clearfix">
                
                    <h1>InnoDB Online DDL Operations with the INSTANT Alter Algorithm</h1>
                

                



                <div>
                    
    

    
    
    

    <div class="node creole">
        
        
        


    
    <div class="answer formatted">
        <div class="table_of_contents well well-small">
<h3>Contents</h3>
 <ol class="toc">

    <li class=""><a href="#column-operations" title="Column Operations">Column Operations</a>    <ol class="toc">

        <li class=""><a href="#alter-table-add-column" title="ALTER TABLE ... ADD COLUMN">ALTER TABLE ... ADD COLUMN</a></li>

        <li class=""><a href="#alter-table-drop-column" title="ALTER TABLE ... DROP COLUMN">ALTER TABLE ... DROP COLUMN</a></li>

        <li class=""><a href="#alter-table-modify-column" title="ALTER TABLE ... MODIFY COLUMN">ALTER TABLE ... MODIFY COLUMN</a>        <ol class="toc">

            <li class=""><a href="#reordering-columns" title="Reordering Columns">Reordering Columns</a></li>

            <li class=""><a href="#changing-the-data-type-of-a-column" title="Changing the Data Type of a Column">Changing the Data Type of a Column</a></li>

            <li class=""><a href="#changing-a-column-to-null" title="Changing a Column to NULL">Changing a Column to NULL</a></li>

            <li class=""><a href="#changing-a-column-to-not-null" title="Changing a Column to NOT NULL">Changing a Column to NOT NULL</a></li>

            <li class=""><a href="#adding-a-new-enum-option" title="Adding a New ENUM Option">Adding a New ENUM Option</a></li>

            <li class=""><a href="#adding-a-new-set-option" title="Adding a New SET Option">Adding a New SET Option</a></li>

            <li class=""><a href="#removing-system-versioning-from-a-column" title="Removing System Versioning from a Column">Removing System Versioning from a Column</a>        </ol>
</li>

        <li class=""><a href="#alter-table-alter-column" title="ALTER TABLE ... ALTER COLUMN">ALTER TABLE ... ALTER COLUMN</a>        <ol class="toc">

            <li class=""><a href="#setting-a-columns-default-value" title="Setting a Column&#39;s Default Value">Setting a Column&#39;s Default Value</a></li>

            <li class=""><a href="#removing-a-columns-default-value" title="Removing a Column&#39;s Default Value">Removing a Column&#39;s Default Value</a>        </ol>
</li>

        <li class=""><a href="#alter-table-change-column" title="ALTER TABLE ... CHANGE COLUMN">ALTER TABLE ... CHANGE COLUMN</a>    </ol>
</li>

    <li class=""><a href="#index-operations" title="Index Operations">Index Operations</a>    <ol class="toc">

        <li class=""><a href="#alter-table-add-primary-key" title="ALTER TABLE ... ADD PRIMARY KEY">ALTER TABLE ... ADD PRIMARY KEY</a></li>

        <li class=""><a href="#alter-table-drop-primary-key" title="ALTER TABLE ... DROP PRIMARY KEY">ALTER TABLE ... DROP PRIMARY KEY</a></li>

        <li class=""><a href="#alter-table-add-index-and-create-index" title="ALTER TABLE ... ADD INDEX and CREATE INDEX">ALTER TABLE ... ADD INDEX and CREATE INDEX</a>        <ol class="toc">

            <li class=""><a href="#adding-a-plain-index" title="Adding a Plain Index">Adding a Plain Index</a></li>

            <li class=""><a href="#adding-a-fulltext-index" title="Adding a Fulltext Index">Adding a Fulltext Index</a></li>

            <li class=""><a href="#adding-a-spatial-index" title="Adding a Spatial Index">Adding a Spatial Index</a>        </ol>
</li>

        <li class=""><a href="#alter-table-add-foreign-key" title="ALTER TABLE ... ADD FOREIGN KEY">ALTER TABLE ... ADD FOREIGN KEY</a></li>

        <li class=""><a href="#alter-table-drop-foreign-key" title="ALTER TABLE ... DROP FOREIGN KEY">ALTER TABLE ... DROP FOREIGN KEY</a>    </ol>
</li>

    <li class=""><a href="#table-operations" title="Table Operations">Table Operations</a>    <ol class="toc">

        <li class=""><a href="#alter-table-auto_increment" title="ALTER TABLE ... AUTO_INCREMENT=...">ALTER TABLE ... AUTO_INCREMENT=...</a></li>

        <li class=""><a href="#alter-table-row_format" title="ALTER TABLE ... ROW_FORMAT=...">ALTER TABLE ... ROW_FORMAT=...</a></li>

        <li class=""><a href="#alter-table-key_block_size" title="ALTER TABLE ... KEY_BLOCK_SIZE=...">ALTER TABLE ... KEY_BLOCK_SIZE=...</a></li>

        <li class=""><a href="#alter-table-page_compressed1-and-alter-table-page_compression_level" title="ALTER TABLE ... PAGE_COMPRESSED=1 and ALTER TABLE ... PAGE_COMPRESSION_LEVEL=...">ALTER TABLE ... PAGE_COMPRESSED=1 and ALTER TABLE ... PAGE_COMPRESSION_LEVEL=...</a></li>

        <li class=""><a href="#alter-table-drop-system-versioning" title="ALTER TABLE ... DROP SYSTEM VERSIONING">ALTER TABLE ... DROP SYSTEM VERSIONING</a></li>

        <li class=""><a href="#alter-table-drop-constraint" title="ALTER TABLE ... DROP CONSTRAINT">ALTER TABLE ... DROP CONSTRAINT</a></li>

        <li class=""><a href="#alter-table-force" title="ALTER TABLE ... FORCE">ALTER TABLE ... FORCE</a></li>

        <li class=""><a href="#alter-table-engineinnodb" title="ALTER TABLE ... ENGINE=InnoDB">ALTER TABLE ... ENGINE=InnoDB</a></li>

        <li class=""><a href="#optimize-table" title="OPTIMIZE TABLE ...">OPTIMIZE TABLE ...</a></li>

        <li class=""><a href="#alter-table-rename-to-and-rename-table" title="ALTER TABLE ... RENAME TO and RENAME TABLE ...">ALTER TABLE ... RENAME TO and RENAME TABLE ...</a>    </ol>
</li>

    <li class=""><a href="#limitations" title="Limitations">Limitations</a>    <ol class="toc">

        <li class=""><a href="#limitations-related-to-generated-virtual-and-persistentstored-columns" title="Limitations Related to Generated (Virtual and Persistent/Stored) Columns">Limitations Related to Generated (Virtual and Persistent/Stored) Columns</a></li>

        <li class=""><a href="#non-canonical-storage-format-caused-by-some-operations" title="Non-canonical Storage Format Caused by Some Operations">Non-canonical Storage Format Caused by Some Operations</a></li>

        <li class=""><a href="#known-bugs" title="Known Bugs">Known Bugs</a>        <ol class="toc">

            <li class=""><a href="#closed-bugs" title="Closed Bugs">Closed Bugs</a>        </ol>
    </ol>
 </ol>
</li>
</div>
<h2 class="anchored_heading" id="column-operations">Column Operations</h2>
<h3 class="anchored_heading" id="alter-table-add-column"><code>ALTER TABLE ... ADD COLUMN</code></h3>
<p>In <a href="/kb/en/mariadb-1032-release-notes/">MariaDB 10.3.2</a> and later, InnoDB supports adding columns to a table with <a href="/kb/en/alter-table/#algorithm">ALGORITHM</a> set to <code>INSTANT</code> if the new column is the last column in the table. See <a href="https://jira.mariadb.org/browse/MDEV-11369">MDEV-11369</a> for more information. If the table has a hidden <code>FTS_DOC_ID</code> column is present, then this is not supported.</p>
<p>In <a href="/kb/en/what-is-mariadb-104/">MariaDB 10.4</a> and later, InnoDB supports adding columns to a table with <a href="/kb/en/alter-table/#algorithm">ALGORITHM</a> set to <code>INSTANT</code>, regardless of where in the column list the new column is added.</p>
<p>When this operation is performed with <a href="/kb/en/alter-table/#algorithm">ALGORITHM</a> set to <code>INSTANT</code>, the tablespace file will have a non-canonical storage format. See <a href="#non-canonical-storage-format-caused-by-some-operations">Non-canonical Storage Format Caused by Some Operations</a> for more information.</p>
<p>With the exception of adding an <a href="/kb/en/auto_increment/">auto-increment</a> column, this operation supports the non-locking strategy. This strategy can be explicitly chosen by setting the <a href="/kb/en/alter-table/#lock">LOCK</a> clause to <code>NONE</code>. When this strategy is used, all concurrent DML is permitted.</p>
<p>For example, this succeeds:</p>
<pre class="fixed"><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="p">(</span>
   <span class="n">a</span> <span class="nb">int</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
   <span class="n">b</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">SET</span> <span class="k">SESSION</span> <span class="n">alter_algorithm</span><span class="o">=</span><span class="s1">&#39;INSTANT&#39;</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="k">ADD</span> <span class="k">COLUMN</span> <span class="k">c</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">004</span> <span class="n">sec</span><span class="p">)</span>
</pre><p>And this succeeds in <a href="/kb/en/what-is-mariadb-104/">MariaDB 10.4</a> and later:</p>
<pre class="fixed"><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="p">(</span>
   <span class="n">a</span> <span class="nb">int</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
   <span class="n">b</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">SET</span> <span class="k">SESSION</span> <span class="n">alter_algorithm</span><span class="o">=</span><span class="s1">&#39;INSTANT&#39;</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="k">ADD</span> <span class="k">COLUMN</span> <span class="k">c</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">AFTER</span> <span class="n">a</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">004</span> <span class="n">sec</span><span class="p">)</span>
</pre><p>This applies to <a href="/kb/en/alter-table/#add-column">ALTER TABLE ... ADD COLUMN</a> for <a href="/kb/en/innodb/">InnoDB</a> tables.</p>
<p>See <a href="/kb/en/instant-add-column-for-innodb/">Instant ADD COLUMN for InnoDB</a> for more information.</p>
<h3 class="anchored_heading" id="alter-table-drop-column"><code>ALTER TABLE ... DROP COLUMN</code></h3>
<p>In <a href="/kb/en/what-is-mariadb-104/">MariaDB 10.4</a> and later, InnoDB supports dropping columns from a table with <a href="/kb/en/alter-table/#algorithm">ALGORITHM</a> set to <code>INSTANT</code>. See <a href="https://jira.mariadb.org/browse/MDEV-15562">MDEV-15562</a> for more information.</p>
<p>When this operation is performed with <a href="/kb/en/alter-table/#algorithm">ALGORITHM</a> set to <code>INSTANT</code>, the tablespace file will have a non-canonical storage format. See <a href="#non-canonical-storage-format-caused-by-some-operations">Non-canonical Storage Format Caused by Some Operations</a> for more information.</p>
<p>This operation supports the non-locking strategy. This strategy can be explicitly chosen by setting the <a href="/kb/en/alter-table/#lock">LOCK</a> clause to <code>NONE</code>. When this strategy is used, all concurrent DML is permitted.</p>
<p>For example:</p>
<pre class="fixed"><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="p">(</span>
   <span class="n">a</span> <span class="nb">int</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
   <span class="n">b</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
   <span class="k">c</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">SET</span> <span class="k">SESSION</span> <span class="n">alter_algorithm</span><span class="o">=</span><span class="s1">&#39;INSTANT&#39;</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="k">DROP</span> <span class="k">COLUMN</span> <span class="k">c</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">004</span> <span class="n">sec</span><span class="p">)</span>
</pre><p>This applies to <a href="/kb/en/alter-table/#drop-column">ALTER TABLE ... DROP COLUMN</a> for <a href="/kb/en/innodb/">InnoDB</a> tables.</p>
<h3 class="anchored_heading" id="alter-table-modify-column"><code>ALTER TABLE ... MODIFY COLUMN</code></h3>
<p>This applies to <a href="/kb/en/alter-table/#modify-column">ALTER TABLE ... MODIFY COLUMN</a> for <a href="/kb/en/innodb/">InnoDB</a> tables.</p>
<h4 class="anchored_heading" id="reordering-columns">Reordering Columns</h4>
<p>In <a href="/kb/en/what-is-mariadb-104/">MariaDB 10.4</a> and later, InnoDB supports reordering columns within a table with <a href="/kb/en/alter-table/#algorithm">ALGORITHM</a> set to <code>INSTANT</code>. See <a href="https://jira.mariadb.org/browse/MDEV-15562">MDEV-15562</a> for more information.</p>
<p>When this operation is performed with <a href="/kb/en/alter-table/#algorithm">ALGORITHM</a> set to <code>INSTANT</code>, the tablespace file will have a non-canonical storage format. See <a href="#non-canonical-storage-format-caused-by-some-operations">Non-canonical Storage Format Caused by Some Operations</a> for more information.</p>
<p>This operation supports the non-locking strategy. This strategy can be explicitly chosen by setting the <a href="/kb/en/alter-table/#lock">LOCK</a> clause to <code>NONE</code>. When this strategy is used, all concurrent DML is permitted.</p>
<p>For example:</p>
<pre class="fixed"><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="p">(</span>
   <span class="n">a</span> <span class="nb">int</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
   <span class="n">b</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
   <span class="k">c</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">SET</span> <span class="k">SESSION</span> <span class="n">alter_algorithm</span><span class="o">=</span><span class="s1">&#39;INSTANT&#39;</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="k">MODIFY</span> <span class="k">COLUMN</span> <span class="k">c</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">AFTER</span> <span class="n">a</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">004</span> <span class="n">sec</span><span class="p">)</span>
</pre><h4 class="anchored_heading" id="changing-the-data-type-of-a-column">Changing the Data Type of a Column</h4>
<p>InnoDB does <strong>not</strong> support modifying a column's data type with <a href="/kb/en/alter-table/#algorithm">ALGORITHM</a> set to <code>INSTANT</code> in most cases. There are some exceptions:</p>
<ul start="1"><li>InnoDB supports increasing the length of <code>VARCHAR</code> columns with <a href="/kb/en/alter-table/#algorithm">ALGORITHM</a> set to <code>INSTANT</code>, unless it would require changing the number of bytes requires to represent the column's length. A <code>VARCHAR</code> column that is between 0 and 255 bytes in size requires 1 byte to represent its length, while a <code>VARCHAR</code> column that is 256 bytes or longer requires 2 bytes to represent its length. This means that the length of a column cannot be increased with <a href="/kb/en/alter-table/#algorithm">ALGORITHM</a> set to <code>INSTANT</code> if the original length was less than 256 bytes, and the new length is 256 bytes or more.
</li></ul>
<ul start="1"><li>In <a href="/kb/en/mariadb-1043-release-notes/">MariaDB 10.4.3</a> and later, InnoDB supports increasing the length of <code>VARCHAR</code> columns with <a href="/kb/en/alter-table/#algorithm">ALGORITHM</a> set to <code>INSTANT</code> with no restrictions if the <a href="/kb/en/create-table/#row_format">ROW_FORMAT</a> table option is set to <a href="/kb/en/innodb-storage-formats/#redundant">REDUNDANT</a>. See <a href="https://jira.mariadb.org/browse/MDEV-15563">MDEV-15563</a> for more information.
</li></ul>
<ul start="1"><li>In <a href="/kb/en/mariadb-1043-release-notes/">MariaDB 10.4.3</a> and later, InnoDB also supports increasing the length of <code>VARCHAR</code> columns with <a href="/kb/en/alter-table/#algorithm">ALGORITHM</a> set to <code>INSTANT</code> in a more limited manner if the <a href="/kb/en/create-table/#row_format">ROW_FORMAT</a> table option is set to <a href="/kb/en/innodb-storage-formats/#compact">COMPACT</a>, <a href="/kb/en/innodb-storage-formats/#dynamic">DYNAMIC</a>, or <a href="/kb/en/innodb-storage-formats/#compressed">COMPRESSED</a>. In this scenario, the following limitations apply:
<ul start="1"><li>The length can be increased with <a href="/kb/en/alter-table/#algorithm">ALGORITHM</a> set to <code>INSTANT</code> if the original length of the column is 127 bytes or less, and the new length of the column is 256 bytes or more.
</li><li>The length can be increased with <a href="/kb/en/alter-table/#algorithm">ALGORITHM</a> set to <code>INSTANT</code> if the original length of the column is 255 bytes or less, and the new length of the column is still 255 bytes or less.
</li><li>The length can be increased with <a href="/kb/en/alter-table/#algorithm">ALGORITHM</a> set to <code>INSTANT</code> if the original length of the column is 256 bytes or more, and the new length of the column is still 256 bytes or more.
</li><li>The length can <strong>not</strong> be increased with <a href="/kb/en/alter-table/#algorithm">ALGORITHM</a> set to <code>INSTANT</code> if the original length was between 128 bytes and 255 bytes, and the new length is 256 bytes or more.
</li><li>See <a href="https://jira.mariadb.org/browse/MDEV-15563">MDEV-15563</a> for more information.
</li></ul>
</li></ul>
<p>The supported operations in this category support the non-locking strategy. This strategy can be explicitly chosen by setting the <a href="/kb/en/alter-table/#lock">LOCK</a> clause to <code>NONE</code>. When this strategy is used, all concurrent DML is permitted.</p>
<p>For example, this fails:</p>
<pre class="fixed wrap"><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="p">(</span>
   <span class="n">a</span> <span class="nb">int</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
   <span class="n">b</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
   <span class="k">c</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">SET</span> <span class="k">SESSION</span> <span class="n">alter_algorithm</span><span class="o">=</span><span class="s1">&#39;INSTANT&#39;</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="k">MODIFY</span> <span class="k">COLUMN</span> <span class="k">c</span> <span class="nb">int</span><span class="p">;</span>
<span class="n">ERROR</span> <span class="mi">1846</span> <span class="p">(</span><span class="mi">0</span><span class="n">A000</span><span class="p">):</span> <span class="n">ALGORITHM</span><span class="o">=</span><span class="n">INSTANT</span> <span class="k">is</span> <span class="k">not</span> <span class="n">supported</span><span class="p">.</span> <span class="n">Reason</span><span class="p">:</span> <span class="n">Cannot</span> <span class="n">change</span> <span class="k">column</span> <span class="k">type</span> <span class="n">INPLACE</span><span class="p">.</span> <span class="n">Try</span> <span class="n">ALGORITHM</span><span class="o">=</span><span class="k">COPY</span>
</pre><p>But this succeeds because the original length of the column is less than 256 bytes, and the new length is still less than 256 bytes:</p>
<pre class="fixed"><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="p">(</span>
   <span class="n">a</span> <span class="nb">int</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
   <span class="n">b</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
   <span class="k">c</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="p">)</span> <span class="nb">CHARACTER</span> <span class="k">SET</span><span class="o">=</span><span class="n">latin1</span><span class="p">;</span>

<span class="k">SET</span> <span class="k">SESSION</span> <span class="n">alter_algorithm</span><span class="o">=</span><span class="s1">&#39;INSTANT&#39;</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="k">MODIFY</span> <span class="k">COLUMN</span> <span class="k">c</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">005</span> <span class="n">sec</span><span class="p">)</span>
</pre><p>But this fails because the original length of the column is between 128 bytes and 255 bytes, and the new length is greater than 256 bytes:</p>
<pre class="fixed wrap"><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="p">(</span>
   <span class="n">a</span> <span class="nb">int</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
   <span class="n">b</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
   <span class="k">c</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
<span class="p">)</span> <span class="nb">CHARACTER</span> <span class="k">SET</span><span class="o">=</span><span class="n">latin1</span><span class="p">;</span>

<span class="k">SET</span> <span class="k">SESSION</span> <span class="n">alter_algorithm</span><span class="o">=</span><span class="s1">&#39;INSTANT&#39;</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="k">MODIFY</span> <span class="k">COLUMN</span> <span class="k">c</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">256</span><span class="p">);</span>
<span class="n">ERROR</span> <span class="mi">1846</span> <span class="p">(</span><span class="mi">0</span><span class="n">A000</span><span class="p">):</span> <span class="n">ALGORITHM</span><span class="o">=</span><span class="n">INSTANT</span> <span class="k">is</span> <span class="k">not</span> <span class="n">supported</span><span class="p">.</span> <span class="n">Reason</span><span class="p">:</span> <span class="n">Cannot</span> <span class="n">change</span> <span class="k">column</span> <span class="k">type</span> <span class="n">INPLACE</span><span class="p">.</span> <span class="n">Try</span> <span class="n">ALGORITHM</span><span class="o">=</span><span class="k">COPY</span>
</pre><p>But this succeeds in <a href="/kb/en/mariadb-1043-release-notes/">MariaDB 10.4.3</a> and later because the table has <code>ROW_FORMAT=REDUNDANT</code>:</p>
<pre class="fixed"><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="p">(</span>
   <span class="n">a</span> <span class="nb">int</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
   <span class="n">b</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
   <span class="k">c</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ROW_FORMAT</span><span class="o">=</span><span class="n">REDUNDANT</span><span class="p">;</span>

<span class="k">SET</span> <span class="k">SESSION</span> <span class="n">alter_algorithm</span><span class="o">=</span><span class="s1">&#39;INSTANT&#39;</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="k">MODIFY</span> <span class="k">COLUMN</span> <span class="k">c</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">300</span><span class="p">);</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">004</span> <span class="n">sec</span><span class="p">)</span>
</pre><p>And this succeeds in <a href="/kb/en/mariadb-1043-release-notes/">MariaDB 10.4.3</a> and later because the table has <code>ROW_FORMAT=DYNAMIC</code> and the column's original length is 127 bytes or less:</p>
<pre class="fixed"><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="p">(</span>
   <span class="n">a</span> <span class="nb">int</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
   <span class="n">b</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
   <span class="k">c</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">127</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ROW_FORMAT</span><span class="o">=</span><span class="k">DYNAMIC</span>
  <span class="nb">CHARACTER</span> <span class="k">SET</span><span class="o">=</span><span class="n">latin1</span><span class="p">;</span>

<span class="k">SET</span> <span class="k">SESSION</span> <span class="n">alter_algorithm</span><span class="o">=</span><span class="s1">&#39;INSTANT&#39;</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="k">MODIFY</span> <span class="k">COLUMN</span> <span class="k">c</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">300</span><span class="p">);</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">003</span> <span class="n">sec</span><span class="p">)</span>
</pre><p>And this succeeds in <a href="/kb/en/mariadb-1043-release-notes/">MariaDB 10.4.3</a> and later because the table has <code>ROW_FORMAT=COMPRESSED</code> and the column's original length is 127 bytes or less:</p>
<pre class="fixed"><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="p">(</span>
   <span class="n">a</span> <span class="nb">int</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
   <span class="n">b</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
   <span class="k">c</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">127</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ROW_FORMAT</span><span class="o">=</span><span class="n">COMPRESSED</span>
  <span class="nb">CHARACTER</span> <span class="k">SET</span><span class="o">=</span><span class="n">latin1</span><span class="p">;</span>

<span class="k">SET</span> <span class="k">SESSION</span> <span class="n">alter_algorithm</span><span class="o">=</span><span class="s1">&#39;INSTANT&#39;</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="k">MODIFY</span> <span class="k">COLUMN</span> <span class="k">c</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">300</span><span class="p">);</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">003</span> <span class="n">sec</span><span class="p">)</span>
</pre><p>But this fails even in <a href="/kb/en/mariadb-1043-release-notes/">MariaDB 10.4.3</a> and later because the table has <code>ROW_FORMAT=DYNAMIC</code> and the column's original length is between 128 bytes and 255 bytes:</p>
<pre class="fixed wrap"><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="p">(</span>
   <span class="n">a</span> <span class="nb">int</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
   <span class="n">b</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
   <span class="k">c</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ROW_FORMAT</span><span class="o">=</span><span class="k">DYNAMIC</span>
  <span class="nb">CHARACTER</span> <span class="k">SET</span><span class="o">=</span><span class="n">latin1</span><span class="p">;</span>

<span class="k">SET</span> <span class="k">SESSION</span> <span class="n">alter_algorithm</span><span class="o">=</span><span class="s1">&#39;INSTANT&#39;</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="k">MODIFY</span> <span class="k">COLUMN</span> <span class="k">c</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">300</span><span class="p">);</span>
<span class="n">ERROR</span> <span class="mi">1846</span> <span class="p">(</span><span class="mi">0</span><span class="n">A000</span><span class="p">):</span> <span class="n">ALGORITHM</span><span class="o">=</span><span class="n">INSTANT</span> <span class="k">is</span> <span class="k">not</span> <span class="n">supported</span><span class="p">.</span> <span class="n">Reason</span><span class="p">:</span> <span class="n">Cannot</span> <span class="n">change</span> <span class="k">column</span> <span class="k">type</span> <span class="n">INPLACE</span><span class="p">.</span> <span class="n">Try</span> <span class="n">ALGORITHM</span><span class="o">=</span><span class="k">COPY</span>
</pre><h4 class="anchored_heading" id="changing-a-column-to-null">Changing a Column to NULL</h4>
<p>In <a href="/kb/en/mariadb-1043-release-notes/">MariaDB 10.4.3</a> and later, InnoDB supports modifying a column to allow <a href="/kb/en/create-table/#null-and-not-null">NULL</a> values with <a href="/kb/en/alter-table/#algorithm">ALGORITHM</a> set to <code>INSTANT</code> if the <a href="/kb/en/create-table/#row_format">ROW_FORMAT</a> table option is set to <a href="/kb/en/innodb-storage-formats/#redundant">REDUNDANT</a>. See <a href="https://jira.mariadb.org/browse/MDEV-15563">MDEV-15563</a> for more information.</p>
<p>This operation supports the non-locking strategy. This strategy can be explicitly chosen by setting the <a href="/kb/en/alter-table/#lock">LOCK</a> clause to <code>NONE</code>. When this strategy is used, all concurrent DML is permitted.</p>
<p>For example:</p>
<pre class="fixed"><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="p">(</span>
   <span class="n">a</span> <span class="nb">int</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
   <span class="n">b</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
   <span class="k">c</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">)</span> <span class="n">ROW_FORMAT</span><span class="o">=</span><span class="n">REDUNDANT</span><span class="p">;</span>

<span class="k">SET</span> <span class="k">SESSION</span> <span class="n">alter_algorithm</span><span class="o">=</span><span class="s1">&#39;INSTANT&#39;</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="k">MODIFY</span> <span class="k">COLUMN</span> <span class="k">c</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NULL</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">004</span> <span class="n">sec</span><span class="p">)</span>
</pre><h4 class="anchored_heading" id="changing-a-column-to-not-null">Changing a Column to NOT NULL</h4>
<p>InnoDB does <strong>not</strong> support modifying a column to <strong>not</strong> allow <a href="/kb/en/create-table/#null-and-not-null">NULL</a> values with <a href="/kb/en/alter-table/#algorithm">ALGORITHM</a> set to <code>INSTANT</code>.</p>
<p>For example:</p>
<pre class="fixed wrap"><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="p">(</span>
   <span class="n">a</span> <span class="nb">int</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
   <span class="n">b</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
   <span class="k">c</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ROW_FORMAT</span><span class="o">=</span><span class="n">REDUNDANT</span><span class="p">;</span>

<span class="k">SET</span> <span class="k">SESSION</span> <span class="n">alter_algorithm</span><span class="o">=</span><span class="s1">&#39;INSTANT&#39;</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="k">MODIFY</span> <span class="k">COLUMN</span> <span class="k">c</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">;</span>
<span class="n">ERROR</span> <span class="mi">1845</span> <span class="p">(</span><span class="mi">0</span><span class="n">A000</span><span class="p">):</span> <span class="n">ALGORITHM</span><span class="o">=</span><span class="n">INSTANT</span> <span class="k">is</span> <span class="k">not</span> <span class="n">supported</span> <span class="k">for</span> <span class="n">this</span> <span class="k">operation</span><span class="p">.</span> <span class="n">Try</span> <span class="n">ALGORITHM</span><span class="o">=</span><span class="n">INPLACE</span>
</pre><h4 class="anchored_heading" id="adding-a-new-enum-option">Adding a New <code>ENUM</code> Option</h4>
<p>InnoDB supports adding a new <a href="/kb/en/enum/">ENUM</a> option to a column with <a href="/kb/en/alter-table/#algorithm">ALGORITHM</a> set to <code>INSTANT</code>. In order to add a new <a href="/kb/en/enum/">ENUM</a> option with <a href="/kb/en/alter-table/#algorithm">ALGORITHM</a> set to <code>INSTANT</code>, the following requirements must be met:</p>
<ul start="1"><li>It must be added to the end of the list.
</li><li>The storage requirements must not change.
</li></ul>
<p>This operation supports the non-locking strategy. This strategy can be explicitly chosen by setting the <a href="/kb/en/alter-table/#lock">LOCK</a> clause to <code>NONE</code>. When this strategy is used, all concurrent DML is permitted.</p>
<p>For example, this succeeds:</p>
<pre class="fixed"><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="p">(</span>
   <span class="n">a</span> <span class="nb">int</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
   <span class="n">b</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
   <span class="k">c</span> <span class="n">ENUM</span><span class="p">(</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">SET</span> <span class="k">SESSION</span> <span class="n">alter_algorithm</span><span class="o">=</span><span class="s1">&#39;INSTANT&#39;</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="k">MODIFY</span> <span class="k">COLUMN</span> <span class="k">c</span> <span class="n">ENUM</span><span class="p">(</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">);</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">002</span> <span class="n">sec</span><span class="p">)</span>
</pre><p>But this fails:</p>
<pre class="fixed wrap"><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="p">(</span>
   <span class="n">a</span> <span class="nb">int</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
   <span class="n">b</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
   <span class="k">c</span> <span class="n">ENUM</span><span class="p">(</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">SET</span> <span class="k">SESSION</span> <span class="n">alter_algorithm</span><span class="o">=</span><span class="s1">&#39;INSTANT&#39;</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="k">MODIFY</span> <span class="k">COLUMN</span> <span class="k">c</span> <span class="n">ENUM</span><span class="p">(</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">);</span>
<span class="n">ERROR</span> <span class="mi">1846</span> <span class="p">(</span><span class="mi">0</span><span class="n">A000</span><span class="p">):</span> <span class="n">ALGORITHM</span><span class="o">=</span><span class="n">INSTANT</span> <span class="k">is</span> <span class="k">not</span> <span class="n">supported</span><span class="p">.</span> <span class="n">Reason</span><span class="p">:</span> <span class="n">Cannot</span> <span class="n">change</span> <span class="k">column</span> <span class="k">type</span> <span class="n">INPLACE</span><span class="p">.</span> <span class="n">Try</span> <span class="n">ALGORITHM</span><span class="o">=</span><span class="k">COPY</span>
</pre><h4 class="anchored_heading" id="adding-a-new-set-option">Adding a New <code>SET</code> Option</h4>
<p>InnoDB supports adding a new <a href="/kb/en/set-data-type/">SET</a> option to a column with <a href="/kb/en/alter-table/#algorithm">ALGORITHM</a> set to <code>INSTANT</code>. In order to add a new <a href="/kb/en/set-data-type/">SET</a> option with <a href="/kb/en/alter-table/#algorithm">ALGORITHM</a> set to <code>INSTANT</code>, the following requirements must be met:</p>
<ul start="1"><li>It must be added to the end of the list.
</li><li>The storage requirements must not change.
</li></ul>
<p>This operation supports the non-locking strategy. This strategy can be explicitly chosen by setting the <a href="/kb/en/alter-table/#lock">LOCK</a> clause to <code>NONE</code>. When this strategy is used, all concurrent DML is permitted.</p>
<p>For example, this succeeds:</p>
<pre class="fixed"><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="p">(</span>
   <span class="n">a</span> <span class="nb">int</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
   <span class="n">b</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
   <span class="k">c</span> <span class="k">SET</span><span class="p">(</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">SET</span> <span class="k">SESSION</span> <span class="n">alter_algorithm</span><span class="o">=</span><span class="s1">&#39;INSTANT&#39;</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="k">MODIFY</span> <span class="k">COLUMN</span> <span class="k">c</span> <span class="k">SET</span><span class="p">(</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">);</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">002</span> <span class="n">sec</span><span class="p">)</span>
</pre><p>But this fails:</p>
<pre class="fixed wrap"><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="p">(</span>
   <span class="n">a</span> <span class="nb">int</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
   <span class="n">b</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
   <span class="k">c</span> <span class="k">SET</span><span class="p">(</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">SET</span> <span class="k">SESSION</span> <span class="n">alter_algorithm</span><span class="o">=</span><span class="s1">&#39;INSTANT&#39;</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="k">MODIFY</span> <span class="k">COLUMN</span> <span class="k">c</span> <span class="k">SET</span><span class="p">(</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">);</span>
<span class="n">ERROR</span> <span class="mi">1846</span> <span class="p">(</span><span class="mi">0</span><span class="n">A000</span><span class="p">):</span> <span class="n">ALGORITHM</span><span class="o">=</span><span class="n">INSTANT</span> <span class="k">is</span> <span class="k">not</span> <span class="n">supported</span><span class="p">.</span> <span class="n">Reason</span><span class="p">:</span> <span class="n">Cannot</span> <span class="n">change</span> <span class="k">column</span> <span class="k">type</span> <span class="n">INPLACE</span><span class="p">.</span> <span class="n">Try</span> <span class="n">ALGORITHM</span><span class="o">=</span><span class="k">COPY</span>
</pre><h4 class="anchored_heading" id="removing-system-versioning-from-a-column">Removing System Versioning from a Column</h4>
<p>In <a href="/kb/en/mariadb-1038-release-notes/">MariaDB 10.3.8</a> and later, InnoDB supports removing <a href="/kb/en/system-versioned-tables/">system versioning</a> from a column with <a href="/kb/en/alter-table/#algorithm">ALGORITHM</a> set to <code>INSTANT</code>. In order for this to work, the <a href="/kb/en/system-versioned-tables/#system_versioning_alter_history">system_versioning_alter_history</a> system variable must be set to <code>KEEP</code>. See <a href="https://jira.mariadb.org/browse/MDEV-16330">MDEV-16330</a> for more information.</p>
<p>This operation supports the non-locking strategy. This strategy can be explicitly chosen by setting the <a href="/kb/en/alter-table/#lock">LOCK</a> clause to <code>NONE</code>. When this strategy is used, all concurrent DML is permitted.</p>
<p>For example:</p>
<pre class="fixed wrap"><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="p">(</span>
   <span class="n">a</span> <span class="nb">int</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
   <span class="n">b</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
   <span class="k">c</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">WITH</span> <span class="k">SYSTEM</span> <span class="n">VERSIONING</span>
<span class="p">);</span>

<span class="k">SET</span> <span class="k">SESSION</span> <span class="n">system_versioning_alter_history</span><span class="o">=</span><span class="s1">&#39;KEEP&#39;</span><span class="p">;</span>
<span class="k">SET</span> <span class="k">SESSION</span> <span class="n">alter_algorithm</span><span class="o">=</span><span class="s1">&#39;INSTANT&#39;</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="k">MODIFY</span> <span class="k">COLUMN</span> <span class="k">c</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">WITHOUT</span> <span class="k">SYSTEM</span> <span class="n">VERSIONING</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">004</span> <span class="n">sec</span><span class="p">)</span>
</pre><h3 class="anchored_heading" id="alter-table-alter-column"><code>ALTER TABLE ... ALTER COLUMN</code></h3>
<p>This applies to <a href="/kb/en/alter-table/#alter-column">ALTER TABLE ... ALTER COLUMN</a> for <a href="/kb/en/innodb/">InnoDB</a> tables.</p>
<h4 class="anchored_heading" id="setting-a-columns-default-value">Setting a Column's Default Value</h4>
<p>InnoDB supports modifying a column's <a href="/kb/en/create-table/#default-column-option">DEFAULT</a> value with <a href="/kb/en/alter-table/#algorithm">ALGORITHM</a> set to <code>INSTANT</code>.</p>
<p>This operation supports the non-locking strategy. This strategy can be explicitly chosen by setting the <a href="/kb/en/alter-table/#lock">LOCK</a> clause to <code>NONE</code>. When this strategy is used, all concurrent DML is permitted.</p>
<p>For example:</p>
<pre class="fixed"><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="p">(</span>
   <span class="n">a</span> <span class="nb">int</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
   <span class="n">b</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
   <span class="k">c</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">SET</span> <span class="k">SESSION</span> <span class="n">alter_algorithm</span><span class="o">=</span><span class="s1">&#39;INSTANT&#39;</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="k">ALTER</span> <span class="k">COLUMN</span> <span class="k">c</span> <span class="k">SET</span> <span class="k">DEFAULT</span> <span class="s1">&#39;No value explicitly provided.&#39;</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">003</span> <span class="n">sec</span><span class="p">)</span>
</pre><h4 class="anchored_heading" id="removing-a-columns-default-value">Removing a Column's Default Value</h4>
<p>InnoDB supports removing a column's  <a href="/kb/en/create-table/#default-column-option">DEFAULT</a> value with <a href="/kb/en/alter-table/#algorithm">ALGORITHM</a> set to <code>INSTANT</code>.</p>
<p>This operation supports the non-locking strategy. This strategy can be explicitly chosen by setting the <a href="/kb/en/alter-table/#lock">LOCK</a> clause to <code>NONE</code>. When this strategy is used, all concurrent DML is permitted.</p>
<pre class="fixed"><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="p">(</span>
   <span class="n">a</span> <span class="nb">int</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
   <span class="n">b</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
   <span class="k">c</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="s1">&#39;No value explicitly provided.&#39;</span>
<span class="p">);</span>

<span class="k">SET</span> <span class="k">SESSION</span> <span class="n">alter_algorithm</span><span class="o">=</span><span class="s1">&#39;INSTANT&#39;</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="k">ALTER</span> <span class="k">COLUMN</span> <span class="k">c</span> <span class="k">DROP</span> <span class="k">DEFAULT</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">002</span> <span class="n">sec</span><span class="p">)</span>
</pre><h3 class="anchored_heading" id="alter-table-change-column"><code>ALTER TABLE ... CHANGE COLUMN</code></h3>
<p>InnoDB supports renaming a column with <a href="/kb/en/alter-table/#algorithm">ALGORITHM</a> set to <code>INSTANT</code>, unless the column's data type or attributes changed in addition to the name.</p>
<p>This operation supports the non-locking strategy. This strategy can be explicitly chosen by setting the <a href="/kb/en/alter-table/#lock">LOCK</a> clause to <code>NONE</code>. When this strategy is used, all concurrent DML is permitted.</p>
<p>For example, this succeeds:</p>
<pre class="fixed"><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="p">(</span>
   <span class="n">a</span> <span class="nb">int</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
   <span class="n">b</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
   <span class="k">c</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">SET</span> <span class="k">SESSION</span> <span class="n">alter_algorithm</span><span class="o">=</span><span class="s1">&#39;INSTANT&#39;</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="n">CHANGE</span> <span class="k">COLUMN</span> <span class="k">c</span> <span class="n">str</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">004</span> <span class="n">sec</span><span class="p">)</span>
</pre><p>But this fails:</p>
<pre class="fixed wrap"><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="p">(</span>
   <span class="n">a</span> <span class="nb">int</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
   <span class="n">b</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
   <span class="k">c</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">SET</span> <span class="k">SESSION</span> <span class="n">alter_algorithm</span><span class="o">=</span><span class="s1">&#39;INSTANT&#39;</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="n">CHANGE</span> <span class="k">COLUMN</span> <span class="k">c</span> <span class="n">num</span> <span class="nb">int</span><span class="p">;</span>
<span class="n">ERROR</span> <span class="mi">1846</span> <span class="p">(</span><span class="mi">0</span><span class="n">A000</span><span class="p">):</span> <span class="n">ALGORITHM</span><span class="o">=</span><span class="n">INSTANT</span> <span class="k">is</span> <span class="k">not</span> <span class="n">supported</span><span class="p">.</span> <span class="n">Reason</span><span class="p">:</span> <span class="n">Cannot</span> <span class="n">change</span> <span class="k">column</span> <span class="k">type</span> <span class="n">INPLACE</span><span class="p">.</span> <span class="n">Try</span> <span class="n">ALGORITHM</span><span class="o">=</span><span class="k">COPY</span>
</pre><p>This applies to <a href="/kb/en/alter-table/#change-column">ALTER TABLE ... CHANGE COLUMN</a> for <a href="/kb/en/innodb/">InnoDB</a> tables.</p>
<h2 class="anchored_heading" id="index-operations">Index Operations</h2>
<h3 class="anchored_heading" id="alter-table-add-primary-key"><code>ALTER TABLE ... ADD PRIMARY KEY</code></h3>
<p>InnoDB does <strong>not</strong> support adding a primary key to a table with <a href="/kb/en/alter-table/#algorithm">ALGORITHM</a> set to <code>INSTANT</code>.</p>
<p>For example:</p>
<pre class="fixed wrap"><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="p">(</span>
   <span class="n">a</span> <span class="nb">int</span><span class="p">,</span>
   <span class="n">b</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
   <span class="k">c</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">SET</span> <span class="k">SESSION</span> <span class="n">sql_mode</span><span class="o">=</span><span class="s1">&#39;STRICT_TRANS_TABLES&#39;</span><span class="p">;</span>
<span class="k">SET</span> <span class="k">SESSION</span> <span class="n">alter_algorithm</span><span class="o">=</span><span class="s1">&#39;INSTANT&#39;</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="k">ADD</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">a</span><span class="p">);</span>
<span class="n">ERROR</span> <span class="mi">1845</span> <span class="p">(</span><span class="mi">0</span><span class="n">A000</span><span class="p">):</span> <span class="n">ALGORITHM</span><span class="o">=</span><span class="n">INSTANT</span> <span class="k">is</span> <span class="k">not</span> <span class="n">supported</span> <span class="k">for</span> <span class="n">this</span> <span class="k">operation</span><span class="p">.</span> <span class="n">Try</span> <span class="n">ALGORITHM</span><span class="o">=</span><span class="n">INPLACE</span>
</pre><p>This applies to <a href="/kb/en/alter-table/#add-primary-key">ALTER TABLE ... ADD PRIMARY KEY</a> for <a href="/kb/en/innodb/">InnoDB</a> tables.</p>
<h3 class="anchored_heading" id="alter-table-drop-primary-key"><code>ALTER TABLE ... DROP PRIMARY KEY</code></h3>
<p>InnoDB does <strong>not</strong> support dropping a primary key with <a href="/kb/en/alter-table/#algorithm">ALGORITHM</a> set to <code>INSTANT</code>.</p>
<p>For example:</p>
<pre class="fixed wrap"><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="p">(</span>
   <span class="n">a</span> <span class="nb">int</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
   <span class="n">b</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
   <span class="k">c</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">SET</span> <span class="k">SESSION</span> <span class="n">alter_algorithm</span><span class="o">=</span><span class="s1">&#39;INSTANT&#39;</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="k">DROP</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">;</span>
<span class="n">ERROR</span> <span class="mi">1846</span> <span class="p">(</span><span class="mi">0</span><span class="n">A000</span><span class="p">):</span> <span class="n">ALGORITHM</span><span class="o">=</span><span class="n">INSTANT</span> <span class="k">is</span> <span class="k">not</span> <span class="n">supported</span><span class="p">.</span> <span class="n">Reason</span><span class="p">:</span> <span class="n">Dropping</span> <span class="n">a</span> <span class="k">primary</span> <span class="k">key</span> <span class="k">is</span> <span class="k">not</span> <span class="n">allowed</span> <span class="k">without</span> <span class="n">also</span> <span class="n">adding</span> <span class="n">a</span> <span class="k">new</span> <span class="k">primary</span> <span class="k">key</span><span class="p">.</span> <span class="n">Try</span> <span class="n">ALGORITHM</span><span class="o">=</span><span class="k">COPY</span>
</pre><p>This applies to <a href="/kb/en/alter-table/#drop-primary-key">ALTER TABLE ... DROP PRIMARY KEY</a> for <a href="/kb/en/innodb/">InnoDB</a> tables.</p>
<h3 class="anchored_heading" id="alter-table-add-index-and-create-index"><code>ALTER TABLE ... ADD INDEX</code> and <code>CREATE INDEX</code></h3>
<p>This applies to <a href="/kb/en/alter-table/#add-index">ALTER TABLE ... ADD INDEX</a> and <a href="/kb/en/create-index/">CREATE INDEX</a> for <a href="/kb/en/innodb/">InnoDB</a> tables.</p>
<h4 class="anchored_heading" id="adding-a-plain-index">Adding a Plain Index</h4>
<p>InnoDB does <strong>not</strong> support adding a plain index to a table with <a href="/kb/en/alter-table/#algorithm">ALGORITHM</a> set to <code>INSTANT</code>.</p>
<p>For example, this fails:</p>
<pre class="fixed wrap"><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="p">(</span>
   <span class="n">a</span> <span class="nb">int</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
   <span class="n">b</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
   <span class="k">c</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">SET</span> <span class="k">SESSION</span> <span class="n">alter_algorithm</span><span class="o">=</span><span class="s1">&#39;INSTANT&#39;</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="k">ADD</span> <span class="k">INDEX</span> <span class="n">b_index</span> <span class="p">(</span><span class="n">b</span><span class="p">);</span>
<span class="n">ERROR</span> <span class="mi">1846</span> <span class="p">(</span><span class="mi">0</span><span class="n">A000</span><span class="p">):</span> <span class="n">ALGORITHM</span><span class="o">=</span><span class="n">INSTANT</span> <span class="k">is</span> <span class="k">not</span> <span class="n">supported</span><span class="p">.</span> <span class="n">Reason</span><span class="p">:</span> <span class="k">ADD</span> <span class="k">INDEX</span><span class="p">.</span> <span class="n">Try</span> <span class="n">ALGORITHM</span><span class="o">=</span><span class="n">NOCOPY</span>
</pre><p>And this fails:</p>
<pre class="fixed wrap"><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="p">(</span>
   <span class="n">a</span> <span class="nb">int</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
   <span class="n">b</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
   <span class="k">c</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">SET</span> <span class="k">SESSION</span> <span class="n">alter_algorithm</span><span class="o">=</span><span class="s1">&#39;INSTANT&#39;</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">b_index</span> <span class="k">ON</span> <span class="n">tab</span> <span class="p">(</span><span class="n">b</span><span class="p">);</span>
<span class="n">ERROR</span> <span class="mi">1846</span> <span class="p">(</span><span class="mi">0</span><span class="n">A000</span><span class="p">):</span> <span class="n">ALGORITHM</span><span class="o">=</span><span class="n">INSTANT</span> <span class="k">is</span> <span class="k">not</span> <span class="n">supported</span><span class="p">.</span> <span class="n">Reason</span><span class="p">:</span> <span class="k">ADD</span> <span class="k">INDEX</span><span class="p">.</span> <span class="n">Try</span> <span class="n">ALGORITHM</span><span class="o">=</span><span class="n">NOCOPY</span>
</pre><h4 class="anchored_heading" id="adding-a-fulltext-index">Adding a Fulltext Index</h4>
<p>InnoDB does <strong>not</strong> support adding a <a href="/kb/en/full-text-indexes/">FULLTEXT</a> index to a table with <a href="/kb/en/alter-table/#algorithm">ALGORITHM</a> set to <code>INSTANT</code>.</p>
<p>For example, this fails:</p>
<pre class="fixed wrap"><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="p">(</span>
   <span class="n">a</span> <span class="nb">int</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
   <span class="n">b</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
   <span class="k">c</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">SET</span> <span class="k">SESSION</span> <span class="n">alter_algorithm</span><span class="o">=</span><span class="s1">&#39;INPLACE&#39;</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="k">ADD</span> <span class="n">FULLTEXT</span> <span class="k">INDEX</span> <span class="n">b_index</span> <span class="p">(</span><span class="n">b</span><span class="p">);</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">042</span> <span class="n">sec</span><span class="p">)</span>

<span class="k">SET</span> <span class="k">SESSION</span> <span class="n">alter_algorithm</span><span class="o">=</span><span class="s1">&#39;INSTANT&#39;</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="k">ADD</span> <span class="n">FULLTEXT</span> <span class="k">INDEX</span> <span class="n">c_index</span> <span class="p">(</span><span class="k">c</span><span class="p">);</span>
<span class="n">ERROR</span> <span class="mi">1846</span> <span class="p">(</span><span class="mi">0</span><span class="n">A000</span><span class="p">):</span> <span class="n">ALGORITHM</span><span class="o">=</span><span class="n">INSTANT</span> <span class="k">is</span> <span class="k">not</span> <span class="n">supported</span><span class="p">.</span> <span class="n">Reason</span><span class="p">:</span> <span class="k">ADD</span> <span class="k">INDEX</span><span class="p">.</span> <span class="n">Try</span> <span class="n">ALGORITHM</span><span class="o">=</span><span class="n">NOCOPY</span>
</pre><p>And this fails:</p>
<pre class="fixed wrap"><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="p">(</span>
   <span class="n">a</span> <span class="nb">int</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
   <span class="n">b</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
   <span class="k">c</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">SET</span> <span class="k">SESSION</span> <span class="n">alter_algorithm</span><span class="o">=</span><span class="s1">&#39;INPLACE&#39;</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="n">FULLTEXT</span> <span class="k">INDEX</span> <span class="n">b_index</span> <span class="k">ON</span> <span class="n">tab</span> <span class="p">(</span><span class="n">b</span><span class="p">);</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">040</span> <span class="n">sec</span><span class="p">)</span>

<span class="k">SET</span> <span class="k">SESSION</span> <span class="n">alter_algorithm</span><span class="o">=</span><span class="s1">&#39;INSTANT&#39;</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="n">FULLTEXT</span> <span class="k">INDEX</span> <span class="n">c_index</span> <span class="k">ON</span> <span class="n">tab</span> <span class="p">(</span><span class="k">c</span><span class="p">);</span>
<span class="n">ERROR</span> <span class="mi">1846</span> <span class="p">(</span><span class="mi">0</span><span class="n">A000</span><span class="p">):</span> <span class="n">ALGORITHM</span><span class="o">=</span><span class="n">INSTANT</span> <span class="k">is</span> <span class="k">not</span> <span class="n">supported</span><span class="p">.</span> <span class="n">Reason</span><span class="p">:</span> <span class="k">ADD</span> <span class="k">INDEX</span><span class="p">.</span> <span class="n">Try</span> <span class="n">ALGORITHM</span><span class="o">=</span><span class="n">NOCOPY</span>
</pre><h4 class="anchored_heading" id="adding-a-spatial-index">Adding a Spatial Index</h4>
<p>InnoDB does <strong>not</strong> support adding a <a href="/kb/en/spatial-index/">SPATIAL</a> index to a table with <a href="/kb/en/alter-table/#algorithm">ALGORITHM</a> set to <code>INSTANT</code>.</p>
<p>For example, this fails:</p>
<pre class="fixed wrap"><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="p">(</span>
   <span class="n">a</span> <span class="nb">int</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
   <span class="n">b</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
   <span class="k">c</span> <span class="n">GEOMETRY</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">);</span>

<span class="k">SET</span> <span class="k">SESSION</span> <span class="n">alter_algorithm</span><span class="o">=</span><span class="s1">&#39;INSTANT&#39;</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="k">ADD</span> <span class="n">SPATIAL</span> <span class="k">INDEX</span> <span class="n">c_index</span> <span class="p">(</span><span class="k">c</span><span class="p">);</span>
<span class="n">ERROR</span> <span class="mi">1846</span> <span class="p">(</span><span class="mi">0</span><span class="n">A000</span><span class="p">):</span> <span class="n">ALGORITHM</span><span class="o">=</span><span class="n">INSTANT</span> <span class="k">is</span> <span class="k">not</span> <span class="n">supported</span><span class="p">.</span> <span class="n">Reason</span><span class="p">:</span> <span class="k">ADD</span> <span class="k">INDEX</span><span class="p">.</span> <span class="n">Try</span> <span class="n">ALGORITHM</span><span class="o">=</span><span class="n">NOCOPY</span>
</pre><p>And this fails:</p>
<pre class="fixed wrap"><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="p">(</span>
   <span class="n">a</span> <span class="nb">int</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
   <span class="n">b</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
   <span class="k">c</span> <span class="n">GEOMETRY</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">);</span>

<span class="k">SET</span> <span class="k">SESSION</span> <span class="n">alter_algorithm</span><span class="o">=</span><span class="s1">&#39;INSTANT&#39;</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="n">SPATIAL</span> <span class="k">INDEX</span> <span class="n">c_index</span> <span class="k">ON</span> <span class="n">tab</span> <span class="p">(</span><span class="k">c</span><span class="p">);</span>
<span class="n">ERROR</span> <span class="mi">1846</span> <span class="p">(</span><span class="mi">0</span><span class="n">A000</span><span class="p">):</span> <span class="n">ALGORITHM</span><span class="o">=</span><span class="n">INSTANT</span> <span class="k">is</span> <span class="k">not</span> <span class="n">supported</span><span class="p">.</span> <span class="n">Reason</span><span class="p">:</span> <span class="k">ADD</span> <span class="k">INDEX</span><span class="p">.</span> <span class="n">Try</span> <span class="n">ALGORITHM</span><span class="o">=</span><span class="n">NOCOPY</span>
</pre><h3 class="anchored_heading" id="alter-table-add-foreign-key"><code>ALTER TABLE ... ADD FOREIGN KEY</code></h3>
<p>InnoDB does <strong>not</strong> support adding foreign key constraints to a table with <a href="/kb/en/alter-table/#algorithm">ALGORITHM</a> set to <code>INSTANT</code>.</p>
<p>For example:</p>
<pre class="fixed wrap"><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TABLE</span> <span class="n">tab1</span> <span class="p">(</span>
   <span class="n">a</span> <span class="nb">int</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
   <span class="n">b</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
   <span class="k">c</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
   <span class="n">d</span> <span class="nb">int</span>
<span class="p">);</span>

<span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TABLE</span> <span class="n">tab2</span> <span class="p">(</span>
   <span class="n">a</span> <span class="nb">int</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
   <span class="n">b</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">SET</span> <span class="k">SESSION</span> <span class="n">foreign_key_checks</span><span class="o">=</span><span class="k">OFF</span><span class="p">;</span>
<span class="k">SET</span> <span class="k">SESSION</span> <span class="n">alter_algorithm</span><span class="o">=</span><span class="s1">&#39;INSTANT&#39;</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tab1</span> <span class="k">ADD</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="n">tab2_fk</span> <span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">tab2</span> <span class="p">(</span><span class="n">a</span><span class="p">);</span>
<span class="n">ERROR</span> <span class="mi">1846</span> <span class="p">(</span><span class="mi">0</span><span class="n">A000</span><span class="p">):</span> <span class="n">ALGORITHM</span><span class="o">=</span><span class="n">INSTANT</span> <span class="k">is</span> <span class="k">not</span> <span class="n">supported</span><span class="p">.</span> <span class="n">Reason</span><span class="p">:</span> <span class="k">ADD</span> <span class="k">INDEX</span><span class="p">.</span> <span class="n">Try</span> <span class="n">ALGORITHM</span><span class="o">=</span><span class="n">NOCOPY</span>
</pre><p>This applies to <a href="/kb/en/alter-table/#add-foreign-key">ALTER TABLE ... ADD FOREIGN KEY</a> for <a href="/kb/en/innodb/">InnoDB</a> tables.</p>
<h3 class="anchored_heading" id="alter-table-drop-foreign-key"><code>ALTER TABLE ... DROP FOREIGN KEY</code></h3>
<p>InnoDB supports dropping foreign key constraints from a table with <a href="/kb/en/alter-table/#algorithm">ALGORITHM</a> set to <code>INSTANT</code>.</p>
<p>This operation supports the non-locking strategy. This strategy can be explicitly chosen by setting the <a href="/kb/en/alter-table/#lock">LOCK</a> clause to <code>NONE</code>. When this strategy is used, all concurrent DML is permitted.</p>
<p>For example:</p>
<pre class="fixed"><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TABLE</span> <span class="n">tab2</span> <span class="p">(</span>
   <span class="n">a</span> <span class="nb">int</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
   <span class="n">b</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TABLE</span> <span class="n">tab1</span> <span class="p">(</span>
   <span class="n">a</span> <span class="nb">int</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
   <span class="n">b</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
   <span class="k">c</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
   <span class="n">d</span> <span class="nb">int</span><span class="p">,</span>
   <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="n">tab2_fk</span> <span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">tab2</span> <span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">SET</span> <span class="k">SESSION</span> <span class="n">alter_algorithm</span><span class="o">=</span><span class="s1">&#39;INSTANT&#39;</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tab1</span> <span class="k">DROP</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="n">tab2_fk</span><span class="p">;</span> 
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">004</span> <span class="n">sec</span><span class="p">)</span>
</pre><p>This applies to <a href="/kb/en/alter-table/#drop-foreign-key">ALTER TABLE ... DROP FOREIGN KEY</a> for <a href="/kb/en/innodb/">InnoDB</a> tables.</p>
<h2 class="anchored_heading" id="table-operations">Table Operations</h2>
<h3 class="anchored_heading" id="alter-table-auto_increment"><code>ALTER TABLE ... AUTO_INCREMENT=...</code></h3>
<p>InnoDB supports changing a table's <a href="/kb/en/auto_increment/">AUTO_INCREMENT</a> value with <a href="/kb/en/alter-table/#algorithm">ALGORITHM</a> set to <code>INSTANT</code>.</p>
<p>This operation supports the non-locking strategy. This strategy can be explicitly chosen by setting the <a href="/kb/en/alter-table/#lock">LOCK</a> clause to <code>NONE</code>. When this strategy is used, all concurrent DML is permitted.</p>
<p>For example:</p>
<pre class="fixed"><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="p">(</span>
   <span class="n">a</span> <span class="nb">int</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
   <span class="n">b</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
   <span class="k">c</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">SET</span> <span class="k">SESSION</span> <span class="n">alter_algorithm</span><span class="o">=</span><span class="s1">&#39;INSTANT&#39;</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="n">AUTO_INCREMENT</span><span class="o">=</span><span class="mi">100</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">002</span> <span class="n">sec</span><span class="p">)</span>
</pre><p>This applies to <a href="/kb/en/create-table/#auto_increment">ALTER TABLE ... AUTO_INCREMENT=...</a> for <a href="/kb/en/innodb/">InnoDB</a> tables.</p>
<h3 class="anchored_heading" id="alter-table-row_format"><code>ALTER TABLE ... ROW_FORMAT=...</code></h3>
<p>InnoDB does <strong>not</strong> support changing a table's <a href="/kb/en/innodb-storage-formats/">row format</a> with <a href="/kb/en/alter-table/#algorithm">ALGORITHM</a> set to <code>INSTANT</code>.</p>
<p>For example:</p>
<pre class="fixed wrap"><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="p">(</span>
   <span class="n">a</span> <span class="nb">int</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
   <span class="n">b</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
   <span class="k">c</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ROW_FORMAT</span><span class="o">=</span><span class="k">DYNAMIC</span><span class="p">;</span>

<span class="k">SET</span> <span class="k">SESSION</span> <span class="n">alter_algorithm</span><span class="o">=</span><span class="s1">&#39;INSTANT&#39;</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="n">ROW_FORMAT</span><span class="o">=</span><span class="n">COMPRESSED</span><span class="p">;</span>
<span class="n">ERROR</span> <span class="mi">1846</span> <span class="p">(</span><span class="mi">0</span><span class="n">A000</span><span class="p">):</span> <span class="n">ALGORITHM</span><span class="o">=</span><span class="n">INSTANT</span> <span class="k">is</span> <span class="k">not</span> <span class="n">supported</span><span class="p">.</span> <span class="n">Reason</span><span class="p">:</span> <span class="n">Changing</span> <span class="k">table</span> <span class="k">options</span> <span class="n">requires</span> <span class="n">the</span> <span class="k">table</span> <span class="k">to</span> <span class="n">be</span> <span class="n">rebuilt</span><span class="p">.</span> <span class="n">Try</span> <span class="n">ALGORITHM</span><span class="o">=</span><span class="n">INPLACE</span>
</pre><p>This applies to <a href="/kb/en/create-table/#row_format">ALTER TABLE ... ROW_FORMAT=...</a> for <a href="/kb/en/innodb/">InnoDB</a> tables.</p>
<h3 class="anchored_heading" id="alter-table-key_block_size"><code>ALTER TABLE ... KEY_BLOCK_SIZE=...</code></h3>
<p>InnoDB does <strong>not</strong> support changing a table's <a href="/kb/en/innodb-storage-formats/#using-the-compressed-row-format">KEY_BLOCK_SIZE</a> with <a href="/kb/en/alter-table/#algorithm">ALGORITHM</a> set to <code>INSTANT</code>.</p>
<p>For example:</p>
<pre class="fixed wrap"><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="p">(</span>
   <span class="n">a</span> <span class="nb">int</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
   <span class="n">b</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
   <span class="k">c</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ROW_FORMAT</span><span class="o">=</span><span class="n">COMPRESSED</span>
  <span class="n">KEY_BLOCK_SIZE</span><span class="o">=</span><span class="mi">4</span><span class="p">;</span>

<span class="k">SET</span> <span class="k">SESSION</span> <span class="n">alter_algorithm</span><span class="o">=</span><span class="s1">&#39;INSTANT&#39;</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="n">KEY_BLOCK_SIZE</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
<span class="n">ERROR</span> <span class="mi">1846</span> <span class="p">(</span><span class="mi">0</span><span class="n">A000</span><span class="p">):</span> <span class="n">ALGORITHM</span><span class="o">=</span><span class="n">INSTANT</span> <span class="k">is</span> <span class="k">not</span> <span class="n">supported</span><span class="p">.</span> <span class="n">Reason</span><span class="p">:</span> <span class="n">Changing</span> <span class="k">table</span> <span class="k">options</span> <span class="n">requires</span> <span class="n">the</span> <span class="k">table</span> <span class="k">to</span> <span class="n">be</span> <span class="n">rebuilt</span><span class="p">.</span> <span class="n">Try</span> <span class="n">ALGORITHM</span><span class="o">=</span><span class="n">INPLACE</span>
</pre><p>This applies to <a href="/kb/en/create-table/#key_block_size">KEY_BLOCK_SIZE=...</a> for <a href="/kb/en/innodb/">InnoDB</a> tables.</p>
<h3 class="anchored_heading" id="alter-table-page_compressed1-and-alter-table-page_compression_level"><code>ALTER TABLE ... PAGE_COMPRESSED=1</code> and <code>ALTER TABLE ... PAGE_COMPRESSION_LEVEL=...</code></h3>
<p>In <a href="/kb/en/mariadb-10310-release-notes/">MariaDB 10.3.10</a> and later, InnoDB supports setting a table's <a href="/kb/en/create-table/#page_compressed">PAGE_COMPRESSED</a> value to <code>1</code> with <a href="/kb/en/alter-table/#algorithm">ALGORITHM</a> set to <code>INSTANT</code>. InnoDB does <strong>not</strong> support changing a table's <a href="/kb/en/create-table/#page_compressed">PAGE_COMPRESSED</a> value from <code>1</code> to <code>0</code> with <a href="/kb/en/alter-table/#algorithm">ALGORITHM</a> set to <code>INSTANT</code>.</p>
<p>In these versions, InnoDB also supports changing a table's <a href="/kb/en/create-table/#page_compression_level">PAGE_COMPRESSION_LEVEL</a> value with <a href="/kb/en/alter-table/#algorithm">ALGORITHM</a> set to <code>INSTANT</code>.</p>
<p>This operation supports the non-locking strategy. This strategy can be explicitly chosen by setting the <a href="/kb/en/alter-table/#lock">LOCK</a> clause to <code>NONE</code>. When this strategy is used, all concurrent DML is permitted.</p>
<p>See <a href="https://jira.mariadb.org/browse/MDEV-16328">MDEV-16328</a> for more information.</p>
<p>For example, this succeeds:</p>
<pre class="fixed"><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="p">(</span>
   <span class="n">a</span> <span class="nb">int</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
   <span class="n">b</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
   <span class="k">c</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">SET</span> <span class="k">SESSION</span> <span class="n">alter_algorithm</span><span class="o">=</span><span class="s1">&#39;INSTANT&#39;</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="n">PAGE_COMPRESSED</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">004</span> <span class="n">sec</span><span class="p">)</span>
</pre><p>And this succeeds:</p>
<pre class="fixed"><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="p">(</span>
   <span class="n">a</span> <span class="nb">int</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
   <span class="n">b</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
   <span class="k">c</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="p">)</span> <span class="n">PAGE_COMPRESSED</span><span class="o">=</span><span class="mi">1</span>
  <span class="n">PAGE_COMPRESSION_LEVEL</span><span class="o">=</span><span class="mi">5</span><span class="p">;</span>

<span class="k">SET</span> <span class="k">SESSION</span> <span class="n">alter_algorithm</span><span class="o">=</span><span class="s1">&#39;INSTANT&#39;</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="n">PAGE_COMPRESSION_LEVEL</span><span class="o">=</span><span class="mi">4</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">004</span> <span class="n">sec</span><span class="p">)</span>
</pre><p>But this fails:</p>
<pre class="fixed wrap"><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="p">(</span>
   <span class="n">a</span> <span class="nb">int</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
   <span class="n">b</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
   <span class="k">c</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="p">)</span> <span class="n">PAGE_COMPRESSED</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>

<span class="k">SET</span> <span class="k">SESSION</span> <span class="n">alter_algorithm</span><span class="o">=</span><span class="s1">&#39;INSTANT&#39;</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="n">PAGE_COMPRESSED</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="n">ERROR</span> <span class="mi">1846</span> <span class="p">(</span><span class="mi">0</span><span class="n">A000</span><span class="p">):</span> <span class="n">ALGORITHM</span><span class="o">=</span><span class="n">INSTANT</span> <span class="k">is</span> <span class="k">not</span> <span class="n">supported</span><span class="p">.</span> <span class="n">Reason</span><span class="p">:</span> <span class="n">Changing</span> <span class="k">table</span> <span class="k">options</span> <span class="n">requires</span> <span class="n">the</span> <span class="k">table</span> <span class="k">to</span> <span class="n">be</span> <span class="n">rebuilt</span><span class="p">.</span> <span class="n">Try</span> <span class="n">ALGORITHM</span><span class="o">=</span><span class="n">INPLACE</span>
</pre><p>This applies to <a href="/kb/en/create-table/#page_compressed">ALTER TABLE ... PAGE_COMPRESSED=...</a> and <a href="/kb/en/create-table/#page_compression_level">ALTER TABLE ... PAGE_COMPRESSION_LEVEL=...</a> for <a href="/kb/en/innodb/">InnoDB</a> tables.</p>
<h3 class="anchored_heading" id="alter-table-drop-system-versioning"><code>ALTER TABLE ... DROP SYSTEM VERSIONING</code></h3>
<p>InnoDB does <strong>not</strong> support dropping <a href="/kb/en/system-versioned-tables/">system versioning</a> from a table with <a href="/kb/en/alter-table/#algorithm">ALGORITHM</a> set to <code>INSTANT</code>.</p>
<p>For example:</p>
<pre class="fixed wrap"><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="p">(</span>
   <span class="n">a</span> <span class="nb">int</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
   <span class="n">b</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
   <span class="k">c</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="p">)</span> <span class="k">WITH</span> <span class="k">SYSTEM</span> <span class="n">VERSIONING</span><span class="p">;</span>

<span class="k">SET</span> <span class="k">SESSION</span> <span class="n">alter_algorithm</span><span class="o">=</span><span class="s1">&#39;INSTANT&#39;</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="k">DROP</span> <span class="k">SYSTEM</span> <span class="n">VERSIONING</span><span class="p">;</span>
<span class="n">ERROR</span> <span class="mi">1845</span> <span class="p">(</span><span class="mi">0</span><span class="n">A000</span><span class="p">):</span> <span class="n">ALGORITHM</span><span class="o">=</span><span class="n">INSTANT</span> <span class="k">is</span> <span class="k">not</span> <span class="n">supported</span> <span class="k">for</span> <span class="n">this</span> <span class="k">operation</span><span class="p">.</span> <span class="n">Try</span> <span class="n">ALGORITHM</span><span class="o">=</span><span class="n">INPLACE</span>
</pre><p>This applies to <a href="/kb/en/alter-table/#drop-system-versioning">ALTER TABLE ... DROP SYSTEM VERSIONING</a> for <a href="/kb/en/innodb/">InnoDB</a> tables.</p>
<h3 class="anchored_heading" id="alter-table-drop-constraint"><code>ALTER TABLE ... DROP CONSTRAINT</code></h3>
<p>In <a href="/kb/en/mariadb-1036-release-notes/">MariaDB 10.3.6</a> and later, InnoDB supports dropping a <a href="/kb/en/constraint/#check-constraints">CHECK</a> constraint from a table with <a href="/kb/en/alter-table/#algorithm">ALGORITHM</a> set to <code>INSTANT</code>. See <a href="https://jira.mariadb.org/browse/MDEV-16331">MDEV-16331</a> for more information.</p>
<p>This operation supports the non-locking strategy. This strategy can be explicitly chosen by setting the <a href="/kb/en/alter-table/#lock">LOCK</a> clause to <code>NONE</code>. When this strategy is used, all concurrent DML is permitted.</p>
<p>For example:</p>
<pre class="fixed wrap"><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="p">(</span>
   <span class="n">a</span> <span class="nb">int</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
   <span class="n">b</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
   <span class="k">c</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
   <span class="k">CONSTRAINT</span> <span class="n">b_not_empty</span> <span class="k">CHECK</span> <span class="p">(</span><span class="n">b</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">SET</span> <span class="k">SESSION</span> <span class="n">alter_algorithm</span><span class="o">=</span><span class="s1">&#39;INSTANT&#39;</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="k">DROP</span> <span class="k">CONSTRAINT</span> <span class="n">b_not_empty</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">002</span> <span class="n">sec</span><span class="p">)</span>
</pre><p>This applies to <a href="/kb/en/alter-table/#drop-constraint">ALTER TABLE ... DROP CONSTRAINT</a> for <a href="/kb/en/innodb/">InnoDB</a> tables.</p>
<h3 class="anchored_heading" id="alter-table-force"><code>ALTER TABLE ... FORCE</code></h3>
<p>InnoDB does <strong>not</strong> support forcing a table rebuild with <a href="/kb/en/alter-table/#algorithm">ALGORITHM</a> set to <code>INSTANT</code>.</p>
<p>For example:</p>
<pre class="fixed wrap"><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="p">(</span>
   <span class="n">a</span> <span class="nb">int</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
   <span class="n">b</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
   <span class="k">c</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">SET</span> <span class="k">SESSION</span> <span class="n">alter_algorithm</span><span class="o">=</span><span class="s1">&#39;INSTANT&#39;</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="k">FORCE</span><span class="p">;</span>
<span class="n">ERROR</span> <span class="mi">1845</span> <span class="p">(</span><span class="mi">0</span><span class="n">A000</span><span class="p">):</span> <span class="n">ALGORITHM</span><span class="o">=</span><span class="n">INSTANT</span> <span class="k">is</span> <span class="k">not</span> <span class="n">supported</span> <span class="k">for</span> <span class="n">this</span> <span class="k">operation</span><span class="p">.</span> <span class="n">Try</span> <span class="n">ALGORITHM</span><span class="o">=</span><span class="n">INPLACE</span>
</pre><p>This applies to <a href="/kb/en/alter-table/#force">ALTER TABLE ... FORCE</a> for <a href="/kb/en/innodb/">InnoDB</a> tables.</p>
<h3 class="anchored_heading" id="alter-table-engineinnodb"><code>ALTER TABLE ... ENGINE=InnoDB</code></h3>
<p>InnoDB does <strong>not</strong> support forcing a table rebuild with <a href="/kb/en/alter-table/#algorithm">ALGORITHM</a> set to <code>INSTANT</code>.</p>
<p>For example:</p>
<pre class="fixed wrap"><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="p">(</span>
   <span class="n">a</span> <span class="nb">int</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
   <span class="n">b</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
   <span class="k">c</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">SET</span> <span class="k">SESSION</span> <span class="n">alter_algorithm</span><span class="o">=</span><span class="s1">&#39;INSTANT&#39;</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span><span class="p">;</span>
<span class="n">ERROR</span> <span class="mi">1845</span> <span class="p">(</span><span class="mi">0</span><span class="n">A000</span><span class="p">):</span> <span class="n">ALGORITHM</span><span class="o">=</span><span class="n">INSTANT</span> <span class="k">is</span> <span class="k">not</span> <span class="n">supported</span> <span class="k">for</span> <span class="n">this</span> <span class="k">operation</span><span class="p">.</span> <span class="n">Try</span> <span class="n">ALGORITHM</span><span class="o">=</span><span class="n">INPLACE</span>
</pre><p>This applies to <a href="/kb/en/create-table/#storage-engine">ALTER TABLE ... ENGINE=InnoDB</a> for <a href="/kb/en/innodb/">InnoDB</a> tables.</p>
<h3 class="anchored_heading" id="optimize-table"><code>OPTIMIZE TABLE ...</code></h3>
<p>InnoDB does <strong>not</strong> support optimizing a table with with <a href="/kb/en/alter-table/#algorithm">ALGORITHM</a> set to <code>INSTANT</code>.</p>
<p>For example:</p>
<pre class="fixed wrap"><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="p">(</span>
   <span class="n">a</span> <span class="nb">int</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
   <span class="n">b</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
   <span class="k">c</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">SHOW</span> <span class="k">GLOBAL</span> <span class="n">VARIABLES</span> <span class="k">WHERE</span> <span class="n">Variable_name</span> <span class="k">IN</span><span class="p">(</span><span class="s1">&#39;innodb_defragment&#39;</span><span class="p">,</span> <span class="s1">&#39;innodb_optimize_fulltext_only&#39;</span><span class="p">);</span>
<span class="o">+</span><span class="c1">-------------------------------+-------+</span>
<span class="o">|</span> <span class="n">Variable_name</span>                 <span class="o">|</span> <span class="n">Value</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">-------------------------------+-------+</span>
<span class="o">|</span> <span class="n">innodb_defragment</span>             <span class="o">|</span> <span class="k">OFF</span>   <span class="o">|</span>
<span class="o">|</span> <span class="n">innodb_optimize_fulltext_only</span> <span class="o">|</span> <span class="k">OFF</span>   <span class="o">|</span>
<span class="o">+</span><span class="c1">-------------------------------+-------+</span>
<span class="mi">2</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">001</span> <span class="n">sec</span><span class="p">)</span>

<span class="k">SET</span> <span class="k">SESSION</span> <span class="n">alter_algorithm</span><span class="o">=</span><span class="s1">&#39;INSTANT&#39;</span><span class="p">;</span>
<span class="n">OPTIMIZE</span> <span class="k">TABLE</span> <span class="n">tab</span><span class="p">;</span>
<span class="o">+</span><span class="c1">---------+----------+----------+------------------------------------------------------------------------------+</span>
<span class="o">|</span> <span class="k">Table</span>   <span class="o">|</span> <span class="n">Op</span>       <span class="o">|</span> <span class="n">Msg_type</span> <span class="o">|</span> <span class="n">Msg_text</span>                                                                     <span class="o">|</span>
<span class="o">+</span><span class="c1">---------+----------+----------+------------------------------------------------------------------------------+</span>
<span class="o">|</span> <span class="n">db1</span><span class="p">.</span><span class="n">tab</span> <span class="o">|</span> <span class="n">optimize</span> <span class="o">|</span> <span class="n">note</span>     <span class="o">|</span> <span class="k">Table</span> <span class="n">does</span> <span class="k">not</span> <span class="n">support</span> <span class="n">optimize</span><span class="p">,</span> <span class="n">doing</span> <span class="n">recreate</span> <span class="o">+</span> <span class="k">analyze</span> <span class="k">instead</span>            <span class="o">|</span>
<span class="o">|</span> <span class="n">db1</span><span class="p">.</span><span class="n">tab</span> <span class="o">|</span> <span class="n">optimize</span> <span class="o">|</span> <span class="n">error</span>    <span class="o">|</span> <span class="n">ALGORITHM</span><span class="o">=</span><span class="n">INSTANT</span> <span class="k">is</span> <span class="k">not</span> <span class="n">supported</span> <span class="k">for</span> <span class="n">this</span> <span class="k">operation</span><span class="p">.</span> <span class="n">Try</span> <span class="n">ALGORITHM</span><span class="o">=</span><span class="n">INPLACE</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">db1</span><span class="p">.</span><span class="n">tab</span> <span class="o">|</span> <span class="n">optimize</span> <span class="o">|</span> <span class="n">status</span>   <span class="o">|</span> <span class="k">Operation</span> <span class="n">failed</span>                                                             <span class="o">|</span>
<span class="o">+</span><span class="c1">---------+----------+----------+------------------------------------------------------------------------------+</span>
<span class="mi">3</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span><span class="p">,</span> <span class="mi">1</span> <span class="n">warning</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">002</span> <span class="n">sec</span><span class="p">)</span>
</pre><p>This applies to <a href="/kb/en/optimize-table/">OPTIMIZE TABLE</a> for <a href="/kb/en/innodb/">InnoDB</a> tables.</p>
<h3 class="anchored_heading" id="alter-table-rename-to-and-rename-table"><code>ALTER TABLE ... RENAME TO</code> and <code>RENAME TABLE ...</code></h3>
<p>InnoDB supports renaming a table with <a href="/kb/en/alter-table/#algorithm">ALGORITHM</a> set to <code>INSTANT</code>.</p>
<p>This operation supports the exclusive locking strategy. This strategy can be explicitly chosen by setting the <a href="/kb/en/alter-table/#lock">LOCK</a> clause to <code>EXCLUSIVE</code>. When this strategy is used, concurrent DML is <strong>not</strong> permitted.</p>
<p>For example, this succeeds:</p>
<pre class="fixed"><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="p">(</span>
   <span class="n">a</span> <span class="nb">int</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
   <span class="n">b</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
   <span class="k">c</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">SET</span> <span class="k">SESSION</span> <span class="n">alter_algorithm</span><span class="o">=</span><span class="s1">&#39;INSTANT&#39;</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="k">RENAME</span> <span class="k">TO</span> <span class="n">old_tab</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">008</span> <span class="n">sec</span><span class="p">)</span>
</pre><p>And this succeeds:</p>
<pre class="fixed"><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="p">(</span>
   <span class="n">a</span> <span class="nb">int</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
   <span class="n">b</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
   <span class="k">c</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">SET</span> <span class="k">SESSION</span> <span class="n">alter_algorithm</span><span class="o">=</span><span class="s1">&#39;INSTANT&#39;</span><span class="p">;</span>
<span class="k">RENAME</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="k">TO</span> <span class="n">old_tab</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">008</span> <span class="n">sec</span><span class="p">)</span>
</pre><p>This applies to <a href="/kb/en/alter-table/#rename-to">ALTER TABLE ... RENAME TO</a> and <a href="/kb/en/rename-table/">RENAME TABLE</a> for <a href="/kb/en/innodb/">InnoDB</a> tables.</p>
<h2 class="anchored_heading" id="limitations">Limitations</h2>
<h3 class="anchored_heading" id="limitations-related-to-generated-virtual-and-persistentstored-columns">Limitations Related to Generated (Virtual and Persistent/Stored) Columns</h3>
<p><a href="/kb/en/generated-columns/">Generated columns</a> do not currently support online DDL for all of the same operations that are supported for "real" columns.</p>
<p>See <a href="/kb/en/generated-columns/#statement-support">Generated (Virtual and Persistent/Stored) Columns: Statement Support</a> for more information on the limitations.</p>
<h3 class="anchored_heading" id="non-canonical-storage-format-caused-by-some-operations">Non-canonical Storage Format Caused by Some Operations</h3>
<p>Some operations cause a table's tablespace file to use a non-canonical storage format when the <code>INSTANT</code> algorithm is used. The affected operations include:</p>
<ul start="1"><li><a href="#alter-table-add-column">Adding a column.</a>
</li><li><a href="#alter-table-drop-column">Dropping a column.</a>
</li><li><a href="#reordering-columns">Reordering columns.</a>
</li></ul>
<p>These operations require the following non-canonical changes to the storage format:</p>
<ul start="1"><li>A hidden metadata record at the start of the clustered index is used to store each column's <a href="/kb/en/default/">DEFAULT</a> value. This makes it possible to add new columns that have default values without rebuilding the table.
</li><li>A <a href="/kb/en/blob/">BLOB</a> in the hidden metadata record is used to store column mappings. This makes it possible to drop or reorder columns without rebuilding the table. This also makes it possible to add columns to any position or drop columns from any position in the table without rebuilding the table.
</li><li>If a column is dropped, old records will contain garbage in that column's former position, and new records will be written with <a href="/kb/en/null-values/">NULL</a> values, empty strings, or dummy values.
</li></ul>
<p>This non-canonical storage format has the potential to incur some performance or storage overhead for all subsequent DML operations. If you notice some issues like this and you want to normalize a table's storage format to avoid this problem, then you can do so by forcing a table rebuild by executing <a href="/kb/en/alter-table/#force">ALTER TABLE ... FORCE</a> with <a href="/kb/en/alter-table/#algorithm">ALGORITHM</a> set to <code>INPLACE</code>. For example:</p>
<pre class="fixed"><span class="k">SET</span> <span class="k">SESSION</span> <span class="n">alter_algorithm</span><span class="o">=</span><span class="s1">&#39;INPLACE&#39;</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="k">FORCE</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">008</span> <span class="n">sec</span><span class="p">)</span>
</pre><p>However, keep in mind that there are certain scenarios where you may not be able to rebuild the table with <a href="/kb/en/alter-table/#algorithm">ALGORITHM</a> set to <code>INPLACE</code>. See <a href="/kb/en/innodb-online-ddl-operations-with-algorithminplace/#limitations">InnoDB Online DDL Operations with ALGORITHM=INPLACE: Limitations</a> for more information on those cases. If you hit one of those scenarios, but you still want to rebuild the table, then you would have to do so with <a href="/kb/en/alter-table/#algorithm">ALGORITHM</a> set to <code>COPY</code>.</p>
<h3 class="anchored_heading" id="known-bugs">Known Bugs</h3>
<p>There are some known bugs that could lead to issues when an InnoDB DDL operation is performed using the <a href="/kb/en/innodb-online-ddl-overview/#instant-algorithm">INSTANT</a> algorithm. This algorithm will usually be chosen by default if the operation supports the algorithm.</p>
<p>The effect of many of these bugs is that the table seems to <em>forget</em> that its tablespace file is in the <a href="#non-canonical-storage-format-caused-by-some-operations">non-canonical storage format</a>.</p>
<p>If you are concerned that a table may be affected by one of these bugs, then your best option would be to normalize the table structure. This can be done by rebuilding the table. For example:</p>
<pre class="fixed"><span class="k">SET</span> <span class="k">SESSION</span> <span class="n">alter_algorithm</span><span class="o">=</span><span class="s1">&#39;INPLACE&#39;</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="k">FORCE</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">008</span> <span class="n">sec</span><span class="p">)</span>
</pre><p>If you are concerned about these bugs, and you want to perform an operation that supports the <a href="/kb/en/innodb-online-ddl-overview/#algorithminstant">INSTANT</a> algorithm, but you want to avoid using that algorithm, then you can set the algorithm to <a href="/kb/en/innodb-online-ddl-overview/#inplace-algorithm">INPLACE</a> and add the <code>FORCE</code> keyword to the <a href="/kb/en/alter-table/">ALTER TABLE</a> statement:</p>
<pre class="fixed"><span class="k">SET</span> <span class="k">SESSION</span> <span class="n">alter_algorithm</span><span class="o">=</span><span class="s1">&#39;INPLACE&#39;</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">tab</span> <span class="k">ADD</span> <span class="k">COLUMN</span> <span class="k">c</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span> <span class="k">FORCE</span><span class="p">;</span>
</pre><h4 class="anchored_heading" id="closed-bugs">Closed Bugs</h4>
<ul start="1"><li><a href="https://jira.mariadb.org/browse/MDEV-20066">MDEV-20066</a>: This bug could cause a table to become corrupt if a column was added instantly. It is fixed in <a href="/kb/en/mariadb-10318-release-notes/">MariaDB 10.3.18</a> and <a href="/kb/en/mariadb-1048-release-notes/">MariaDB 10.4.8</a>.
</li><li><a href="https://jira.mariadb.org/browse/MDEV-20117">MDEV-20117</a>: This bug could cause a table to become corrupt if a column was dropped instantly. It is fixed in <a href="/kb/en/mariadb-1049-release-notes/">MariaDB 10.4.9</a>.
</li><li><a href="https://jira.mariadb.org/browse/MDEV-19743">MDEV-19743</a>: This bug could cause a table to become corrupt during page reorganization if a column was added instantly. It is fixed in <a href="/kb/en/mariadb-10317-release-notes/">MariaDB 10.3.17</a> and <a href="/kb/en/mariadb-1047-release-notes/">MariaDB 10.4.7</a>.
</li><li><a href="https://jira.mariadb.org/browse/MDEV-19783">MDEV-19783</a>: This bug could cause a table to become corrupt if a column was added instantly. It is fixed in <a href="/kb/en/mariadb-10317-release-notes/">MariaDB 10.3.17</a> and <a href="/kb/en/mariadb-1047-release-notes/">MariaDB 10.4.7</a>
</li><li><a href="https://jira.mariadb.org/browse/MDEV-20090">MDEV-20090</a>: This bug could cause a table to become corrupt if columns were added, dropped, or reordered instantly. It is fixed in <a href="/kb/en/mariadb-1049-release-notes/">MariaDB 10.4.9</a>.
</li><li><a href="https://jira.mariadb.org/browse/MDEV-18519">MDEV-18519</a>: This bug could cause a table to become corrupt if a column was added instantly. It is fixed in <a href="/kb/en/mariadb-1069-release-notes/">MariaDB 10.6.9</a>, <a href="/kb/en/mariadb-1075-release-notes/">MariaDB 10.7.5</a>, <a href="/kb/en/mariadb-1084-release-notes/">MariaDB 10.8.4</a> and <a href="/kb/en/mariadb-1092-release-notes/">MariaDB 10.9.2</a>. 
</li><li><a href="https://jira.mariadb.org/browse/MDEV-18519">MDEV-18519</a>: This bug could cause a table to become corrupt if a column was added instantly. This isn't and won't be fixed in versions less than <a href="/kb/en/what-is-mariadb-106/">MariaDB 10.6</a>.</li></ul>

    </div>


        
            <div id="subscribe" class="well well-small hide hidden-print"
                 data-subscribe-url="/kb/en/innodb-online-ddl-operations-with-the-instant-alter-algorithm/+subscriptions/add"
                 data-unsubscribe-url="/kb/en/innodb-online-ddl-operations-with-the-instant-alter-algorithm/+subscriptions/remove">
            </div>
        

        
        
    
        <div class="simple_section_nav">
            <ul class="nav nav-pills">
                
                    <li><a href="/kb/en/innodb-online-ddl-operations-with-the-nocopy-alter-algorithm/">
                        ← InnoDB Online DDL Operations with the NOCOPY Alter Algorithm
                    </a>
                    </li>
                
                
                    <li><a href="/kb/en/innodb-online-ddl/">
                        ↑ InnoDB Online DDL ↑
                    </a>
                    </li>
                
                
                    <li class="pull-right"><a href="/kb/en/instant-add-column-for-innodb/">
                        Instant ADD COLUMN for InnoDB →
                    </a>
                    </li>
                
            </ul>
        </div>
    

        

        
        <h2>Comments</h2>
        
    
    <div id="comments" data-node-id="8861" data-comments-url="/kb/en/innodb-online-ddl-operations-with-the-instant-alter-algorithm/+comments"
         data-reply-url="/kb/en/innodb-online-ddl-operations-with-the-instant-alter-algorithm/comments/post/">
        Comments loading...
    </div>

        

    </div>


                    <div id="content_disclaimer" class="graybox">
                        Content reproduced on this site is the property of its respective owners,
                        and this content is not reviewed in advance by MariaDB. The views, information and opinions
                        expressed by this content do not necessarily represent those of MariaDB or any other party.
                    </div>
                </div>
            </section>

            
                <div id="right_bar" class="col-md-2">
                    
    
        
        <ul class="section_navigation well well-small hidden-xs hidden-sm">
            
                <li class="parent"><a href="/kb/en/innodb-online-ddl/">
                    ↑ InnoDB Online DDL ↑
                </a>
                </li>
            
            
                
                    <li>
                        <a href="/kb/en/innodb-online-ddl-overview/">
                            
                            InnoDB Online DDL Overview
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/innodb-online-ddl-operations-with-the-inplace-alter-algorithm/">
                            
                            InnoDB Online DDL Operations with the INPLACE Alter Algorithm
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/innodb-online-ddl-operations-with-the-nocopy-alter-algorithm/">
                            
                            InnoDB Online DDL Operations with the NOCOPY Alter Algorithm
                        </a>
                    </li>
                
            
                
                    <li class="active">
                        <span>InnoDB Online DDL Operations with the INSTANT Alter Algorithm</span>
                        
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/instant-add-column-for-innodb/">
                            
                            Instant ADD COLUMN for InnoDB
                        </a>
                    </li>
                
            
        </ul>
    
    

                </div>
            
        </div>
    </div>
</div>

<!-- Footer -->
<footer id="footer">
    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-xs-12">
                    <ul class="list-inline text-center footer-nav">
                        <li>
                            <h5>
                                <a href="https://mariadb.com/products" title="Products">Products</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/services" title="Services">Services</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/pricing" title="Pricing">Pricing</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/resources" title="Resources">Resources</a>
                            </h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/about-us" title="About MariaDB">About Us</a></h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/download" title="Download">Download MariaDB</a></h5>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="row row-10">
                
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div id="block-footerformcontact" class="block block-block-content block-block-contentd754ee1b-3cc9-40e7-9ef4-f504f1197fb1">
                        
                            <h5 style="font-weight: 400;">Subscribe to our newsletter!</h5>
                            <script src="//app-sj15.marketo.com/js/forms2/js/forms2.min.js"></script><form id="mktoForm_1498"></form>
                            <script>
                                <!--//--><![CDATA[// ><!--
                                MktoForms2.loadForm("//app-sj15.marketo.com", "573-PXI-984", 1498);
                                //--><!]]]]><![CDATA[>
                                //--><!]]>
                            </script>
                        
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div class="footer-copyright">
                        <div class="text-center">
                            <ul class="list-inline no-margin">
                                <li>
                                    <a href="/legal" title="Legal">Legal</a>
                                </li>
                                <li>
                                    <a href="/privacy-policy" title="Privacy Policy">Privacy Policy</a>
                                </li>
                                <li>
                                    <a href="/cookie-policy/" title="Cookies">Cookie Policy</a>
                                </li>
                            </ul>
                            <p>Copyright &copy; 2024 MariaDB. All rights reserved.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</footer>
</div>

<div id="ajax_loading">
    <img src="/kb/static/images/ajax-loader.a51c5608d01a.gif" />
</div>

    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MK2847"
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MK2847');</script>
    <!-- End Google Tag Manager -->

</body>

<script type="text/javascript" src="/kb/static/js/main.fed4ec768178.js" charset="utf-8"></script>

</html>