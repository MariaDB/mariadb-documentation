<!DOCTYPE html>
<html>
<head data-cookie-domain=""
      data-cookie-path="/">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="apple-touch-icon" sizes="180x180" href="/kb/static/images/favicons/apple-touch-icon.159e713979be.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/kb/static/images/favicons/favicon-32x32.bc0ac1d5d11e.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/kb/static/images/favicons/favicon-16x16.5801f8f0f34e.png">
    <link rel="shortcut icon" href="/kb/static/images/favicons/favicon.d122d305dee4.ico" type="image/x-icon" />

    <title>Pivoting in MariaDB - MariaDB Knowledge Base</title>

    <link href="/kb/static/css/main.f7633538c846.css" rel="stylesheet" type="text/css" />

    

    

    <!-- FB Open Graph tags -->
    <meta property="og:title" content="Pivoting in MariaDB" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://mariadb.com/kb/en/pivoting-in-mariadb/" />
    <meta property="og:image" content="http://mariadb.comaskmonty-logo.png" />
    <meta property="og:site_name" content="MariaDB KnowledgeBase" />
    <meta property="fb:admins" content="514852603" />
    <meta property="og:description" content="Pivoting data so a linear list of values with two keys becomes a spreadsheet-like array." />

    <meta name="description" content="Pivoting data so a linear list of values with two keys becomes a spreadsheet-like array." />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet"/>
    
</head>
<body class="mpkb nodes products nodes_view jqui" id="nodes_view">





<div id="menu-mobile" class="visible-sm visible-xs">

    <div>
        <div id="mobile-close-menu" class="text-right">
            <a href="javascript:void(0)" title="Close Menu" id="back-main" class="toggle-menu">X<span></span></a>
        </div>
    </div>
    <div class="mainmenu-mobile">
        <ul class="ls-none ul-menu">
            <li data-sub="submenu5"><a class="open-form-search" href="/kb/search/" title="Search">Search </a></li>
            <li data-sub="submenu0"><a href="/products" title="Products">Products</a><span class="arrow-main"></span></li>
            <li data-sub="submenu1"><a href="/services" title="Services">Services</a><span class="arrow-main"></span></li>
            <li data-sub="submenu2"><a href="/resources" title="Resources">Resources</a><span class="arrow-main"></span></li>
            <li data-sub="submenu3"><a href="/about-us" title="About">About</a><span class="arrow-main"></span></li>
            <li data-sub="submenu4"><a href="/contact" title="Contact">Contact</a></li>
        </ul>
    </div>

    <div class="nav-top-mobile">
        <div class="select-box form">

            <ul class="inline-block-md mb-none top-nav">
                <li>

                </li>
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/pivoting-in-mariadb/"> Login</a>
                    </li>
                
            </ul>



        </div>
        <p class="text-center copyright">Copyright &copy; 2025 MariaDB. All rights reserved.</p>
    </div>
</div>
<div class="violator-wrap d-none" id="top_violator">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12">
                <div class="violator-outer">
                    <div class="violator-inner">
                        <div class="row">
                            <div class="col-xs-12 col-sm-9 col-lg-7 col-lg-offset-2" id="top_violator_content">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="content-link" target="_blank" rel="nofollow noreferrer">
                                    <span>The Ultimate Guide to High Availability with MariaDB</span>
                                </a>
                            </div>
                            <div class="col-xs-12 col-sm-3" id="top_violator_cta">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="btn btn-mariadb" target="_blank" rel="nofollow noreferrer">Download Now</a>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-link close-btn">
                        <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24" width="15px" height="15px"><path d="M 4.9902344 3.9902344 A 1.0001 1.0001 0 0 0 4.2929688 5.7070312 L 10.585938 12 L 4.2929688 18.292969 A 1.0001 1.0001 0 1 0 5.7070312 19.707031 L 12 13.414062 L 18.292969 19.707031 A 1.0001 1.0001 0 1 0 19.707031 18.292969 L 13.414062 12 L 19.707031 5.7070312 A 1.0001 1.0001 0 0 0 18.980469 3.9902344 A 1.0001 1.0001 0 0 0 18.292969 4.2929688 L 12 10.585938 L 5.7070312 4.2929688 A 1.0001 1.0001 0 0 0 4.9902344 3.9902344 z"/></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="wrapper">
<div id="top-nav">
    <div class="container">
        <ul class="hidden-sm hidden-xs" >
            <li><a href="https://mariadb.com/kb/">Knowledge Base</a></li>
            <li><a href="https://mariadb.com/contact/">Contact</a></li>
            
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/pivoting-in-mariadb/" rel="nofollow">Login</a>
                    </li>
                
            
            
            <li id="search-form">
                <form action="/kb/en/+search/" method="get" id="search-block-form" accept-charset="UTF-8">
                    <input id="search" title="Enter the terms you wish to search for."
                           placeholder="Search . . ." type="text"
                           name="q" value="" size="15" maxlength="128" class="form-text"
                           data-autocomplete-url="/kb/en/+search/autocomplete/">
                    <input type="hidden" name="quick" value="1" />
                    <input type="hidden" name="source" value="kb" />
                </form>
            </li>
            <li><a id="search-toggler" href="/kb/search/">Search</a></li>
            
        </ul>
    </div>
</div>
<div id="navbar-bottom" class="navbar">
    <div class="container">
        
        
        
        
        <div class="row">
            <div class="col-md-3 col-sm-9 col-xs-9">
                <a class="brand" href="/" title="MariaDB">
                    <img src="/kb/static/images/logo-2018-black.95f5978ae14d.png">
                </a>
            </div>
            <div class="col-md-9 hidden-sm hidden-xs">
                <div class="main-menu">
                    <ul id="main-menu" class="nav navbar-nav inline-block-sm">
    <li class="has-sub full-menu">
        <a href="/products" title="Products">Products</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/services" title="Services">Services</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/pricing" title="Pricing">Pricing</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/resources" title="Resources">Resources</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/about-us" title="About Us">About Us</a>
    </li>
    <li class="">
        <a class="button electric-eel small top-bar-right-download" href="/downloads/">Download</a>
    </li>
</ul>
                </div>
            </div>
            <div class="col-md-3 visible-sm visible-xs col-sm-3 col-xs-3 ps-rv">
                <div class="navbar-header text-right pull-right">
                    <button type="button" class="menu-control toggle-menu" id="open-menu">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="main">
    <div class="container">
        

        <div id="subheader1" class="clearfix">
            <div class="pull-left">
                
                <div id="breadcrumbs" class="breadcrumb">
                    <a href="/kb/en/">Knowledge Base</a>
                    


    
    » <a class="crumb" href="/kb/en/documentation/">MariaDB Server Documentation</a>
    

    
    » <a class="crumb" href="/kb/en/replication-cluster-multi-master/">High Availability &amp; Performance Tuning</a>
    

    
    » <a class="crumb" href="/kb/en/optimization-and-tuning/">Optimization and Tuning</a>
    

    
    » <a class="crumb" href="/kb/en/query-optimizations/">Query Optimizations</a>
    


    » <a class="node_link crumb" href="/kb/en/pivoting-in-mariadb/">Pivoting in MariaDB</a>


                </div>
                
            </div>
        </div>
    </div>
    <div class="container" id="container-main">
        <div class="row">
            
            
                
                <aside id="sidebar-first" class="sidebar col-md-2 hidden-xs hidden-sm hidden-print">
                    
                        
                        <ul id="category_menu" class="nav nav-pills nav-stacked">
                            <li><a href="/kb/en/">Home</a></li>
                            
                                
                                    <li><a href="/kb/en/+questions/">Open Questions</a></li>
                                
                                <li><a href="/kb/en/documentation/">MariaDB Server</a></li>
                                <li><a href="/kb/en/maxscale/">MariaDB MaxScale</a></li>
                                <li><a href="/kb/en/mariadb-columnstore/">MariaDB ColumnStore</a></li>
                                <li><a href="/kb/en/connectors/">Connectors</a></li>
                            

                        </ul>
                    

                    
<div>



<div class="well well-small box actions"><div>

        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/pivoting-in-mariadb/+history" rel="nofollow">History</a>
        
        
        
        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/pivoting-in-mariadb/+source/">Source</a>
        
        <a class="btn btn-block btn-blue btn-sm flag" href="/kb/en/pivoting-in-mariadb/+flag"
                data-flag-url="/kb/en/pivoting-in-mariadb/+flag" rel="nofollow">
                Flag as Spam / Inappropriate</a>
        
        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/pivoting-in-mariadb/+translate/">
                Translate</a>
        

</div>
</div>





<div class="well well-small box node_info"><div>

    <dl>
        <dt>Created</dt>
        <dd>

<span class="datetime" title="2016-06-20 14:54">8 years, 7 months ago</span></dd>

        <dt>Modified</dt>
        <dd>

<span class="datetime" title="2023-02-27 09:41">1 year, 11 months ago</span></dd>

        <dt>Type</dt>
        <dd>article</dd>

        <dt>Status</dt>
        <dd>active</dd>

        <dt>License</dt>
        <dd>
            
                <a href="/kb/en/pivoting-in-mariadb/+license/">CC BY-SA / Gnu FDL</a>
            
        </dd>

        
    </dl>

    
    <ul class="rss_feeds">
        <li><a href="/kb/en/pivoting-in-mariadb/+history/feed/">
            History</a>
        </li>
        <li><a href="/kb/en/pivoting-in-mariadb/+comments/feed/">
            Comments</a>
        </li>
    </ul>
    

</div>
</div>





    
    
    

<div class="well well-small box attachments"><div><div class="edit_link pull-right"><a href="/kb/en/pivoting-in-mariadb/+edit/attachments/">Edit</a></div><h5>Attachments</h5></div><div>

        
            <div class="no_data">No attachments exist</div>
        
    
</div>
</div>

    



    
    






</div>


                    

































                </aside>
            
            
            
                
            
            
                
            
            <section id="content" class="limited_width col-md-8 clearfix">
                
                    <h1>Pivoting in MariaDB</h1>
                

                



                <div>
                    
    

    
    
    

    <div class="node creole">
        
        
        


    
    <div class="answer formatted">
        <div class="table_of_contents well well-small">
<h3>Contents</h3>
 <ol class="toc">

    <li class=""><a href="#the-problem" title="The problem">The problem</a></li>

    <li class=""><a href="#a-solution" title="A solution">A solution</a></li>

    <li class=""><a href="#reference-code-for-solution" title="Reference code for solution">Reference code for solution</a></li>

    <li class=""><a href="#variants" title="Variants">Variants</a></li>

    <li class=""><a href="#postlog" title="Postlog">Postlog</a></li>

    <li class=""><a href="#see-also" title="See Also">See Also</a> </ol>
</li>
</div>
<h2 class="anchored_heading" id="the-problem">The problem</h2>
<p>You want to "pivot" the data so that a linear list of values with two keys becomes a spreadsheet-like array. See examples, below.</p>
<h2 class="anchored_heading" id="a-solution">A solution</h2>
<p>The best solution is probably to do it in some form of client code (PHP, etc). MySQL and MariaDB do not have a syntax for SELECT that will do the work for you. The code provided here uses a <a href="/kb/en/stored-procedures/">stored procedure</a> to generate code to pivot the data, and then runs the code.</p>
<p>You can edit the SQL generated by the stored procedure to tweak the output in a variety of ways. Or you can tweak the stored procedure to generate what you would prefer.</p>
<h2 class="anchored_heading" id="reference-code-for-solution">Reference code for solution</h2>
<p>'Source' this into the mysql commandline tool:</p>
<pre class="fixed">DELIMITER //
DROP   PROCEDURE IF EXISTS Pivot //
CREATE PROCEDURE Pivot(
    IN tbl_name VARCHAR(99),       -- table name (or db.tbl)
    IN base_cols VARCHAR(99),      -- column(s) on the left, separated by commas
    IN pivot_col VARCHAR(64),      -- name of column to put across the top
    IN tally_col VARCHAR(64),      -- name of column to SUM up
    IN where_clause VARCHAR(99),   -- empty string or &#34;WHERE ...&#34;
    IN order_by VARCHAR(99)        -- empty string or &#34;ORDER BY ...&#34;; usually the base_cols
    )
    DETERMINISTIC
    SQL SECURITY INVOKER
BEGIN
    -- Find the distinct values
    -- Build the SUM()s
    SET @subq = CONCAT('SELECT DISTINCT ', pivot_col, ' AS val ',
                    ' FROM ', tbl_name, ' ', where_clause, ' ORDER BY 1');
    -- select @subq;

    SET @cc1 = &#34;CONCAT('SUM(IF(&amp;p = ', &amp;v, ', &amp;t, 0)) AS ', &amp;v)&#34;;
    SET @cc2 = REPLACE(@cc1, '&amp;p', pivot_col);
    SET @cc3 = REPLACE(@cc2, '&amp;t', tally_col);
    -- select @cc2, @cc3;
    SET @qval = CONCAT(&#34;'\&#34;', val, '\&#34;'&#34;);
    -- select @qval;
    SET @cc4 = REPLACE(@cc3, '&amp;v', @qval);
    -- select @cc4;

    SET SESSION group_concat_max_len = 10000;   -- just in case
    SET @stmt = CONCAT(
            'SELECT  GROUP_CONCAT(', @cc4, ' SEPARATOR &#34;,\n&#34;)  INTO @sums',
            ' FROM ( ', @subq, ' ) AS top');
     select @stmt;
    PREPARE _sql FROM @stmt;
    EXECUTE _sql;                      -- Intermediate step: build SQL for columns
    DEALLOCATE PREPARE _sql;
    -- Construct the query and perform it
    SET @stmt2 = CONCAT(
            'SELECT ',
                base_cols, ',\n',
                @sums,
                ',\n SUM(', tally_col, ') AS Total'
            '\n FROM ', tbl_name, ' ',
            where_clause,
            ' GROUP BY ', base_cols,
            '\n WITH ROLLUP',
            '\n', order_by
        );
    select @stmt2;                    -- The statement that generates the result
    PREPARE _sql FROM @stmt2;
    EXECUTE _sql;                     -- The resulting pivot table ouput
    DEALLOCATE PREPARE _sql;
    -- For debugging / tweaking, SELECT the various @variables after CALLing.
END;
//
DELIMITER ;
</pre><p>Then do a CALL, like in the examples, below.</p>
<h2 class="anchored_heading" id="variants">Variants</h2>
<p>I thought about having several extra options for variations, but decided that would be too messy. Instead, here are instructions for implementing the variations, either by capturing the SELECT that was output by the Stored Procedure, or by modifying the SP, itself.</p>
<ul><li>The data is strings (not numeric) -- Remove "SUM" (but keep the expression); remove the SUM...AS TOTAL line.
</li><li>If you want blank output instead of 0 -- Currently the code says "SUM(IF(... 0))"; change the 0 to NULL, then wrap the SUM: IFNULL(SUM(...), ''). Note that this will distinguish between a zero total (showing '0') and no data (blank).
</li><li>Fancier output -- Use PHP/VB/Java/etc.
</li><li>No Totals at the bottom -- Remove the WITH ROLLUP line from the SELECT.
</li><li>No Total for each row -- Remove the SUM...AS Total line from the SELECT.
</li><li>Change the order of the columns -- Modify the ORDER BY 1 ('1' meaning first column) in the SELECT DISTINCT in the SP.
</li><li>Example: ORDER BY FIND_IN_SET(DAYOFWEEK(...), 'Sun,Mon,Tue,Wed,Thu,Fri,Sat')
</li></ul>
<p>Notes about "base_cols":</p>
<ul><li>Multiple columns on the left, such as an ID and its meaning -- This is already handled by allowing base_cols to be a commalist like 'id, meaning'
</li><li>You cannot call the SP with "foo AS 'blah'" in hopes of changing the labels, but you could edit the SELECT to achieve that goal.
</li></ul>
<p>Notes about the "Totals":</p>
<ul><li>If "base_cols" is more than one column, WITH ROLLUP will be subtotals as well as a grand total.
</li><li>NULL shows up in the Totals row in the "base_cols" column; this can be changed via something like IFNULL(..., 'Totals').
</li></ul>
<p>Example 1 - Population vs Latitude in US</p>
<pre class="fixed wrap">-- Sample input:
+-------+----------------------+---------+------------+
| state | city                 | lat     | population |
+-------+----------------------+---------+------------+
| AK    | Anchorage            | 61.2181 |     276263 |
| AK    | Juneau               | 58.3019 |      31796 |
| WA    | Monroe               | 47.8556 |      15554 |
| WA    | Spanaway             | 47.1042 |      25045 |
| PR    | Arecibo              | 18.4744 |      49189 |
| MT    | Kalispell            | 48.1958 |      18018 |
| AL    | Anniston             | 33.6597 |      23423 |
| AL    | Scottsboro           | 34.6722 |      14737 |
| HI    | Kaneohe              | 21.4181 |      35424 |
| PR    | Candelaria           | 18.4061 |      17632 |
...

-- Call the Stored Procedure:
CALL Pivot('World.US', 'state', '5*FLOOR(lat/5)', 'population', '', '');

-- SQL generated by the SP:
SELECT state,
SUM(IF(5*FLOOR(lat/5) = &#34;15&#34;, population, 0)) AS &#34;15&#34;,
SUM(IF(5*FLOOR(lat/5) = &#34;20&#34;, population, 0)) AS &#34;20&#34;,
SUM(IF(5*FLOOR(lat/5) = &#34;25&#34;, population, 0)) AS &#34;25&#34;,
SUM(IF(5*FLOOR(lat/5) = &#34;30&#34;, population, 0)) AS &#34;30&#34;,
SUM(IF(5*FLOOR(lat/5) = &#34;35&#34;, population, 0)) AS &#34;35&#34;,
SUM(IF(5*FLOOR(lat/5) = &#34;40&#34;, population, 0)) AS &#34;40&#34;,
SUM(IF(5*FLOOR(lat/5) = &#34;45&#34;, population, 0)) AS &#34;45&#34;,
SUM(IF(5*FLOOR(lat/5) = &#34;55&#34;, population, 0)) AS &#34;55&#34;,
SUM(IF(5*FLOOR(lat/5) = &#34;60&#34;, population, 0)) AS &#34;60&#34;,
SUM(IF(5*FLOOR(lat/5) = &#34;70&#34;, population, 0)) AS &#34;70&#34;,
 SUM(population) AS Total
 FROM World.US  GROUP BY state
 WITH ROLLUP

-- Output from that SQL (also comes out of the SP):
+-------+---------+--------+----------+----------+----------+----------+---------+-------+--------+------+-----------+
| state | 15      | 20     | 25       | 30       | 35       | 40       | 45      | 55    | 60     | 70   | Total     |
+-------+---------+--------+----------+----------+----------+----------+---------+-------+--------+------+-----------+
| AK    |       0 |      0 |        0 |        0 |        0 |        0 |       0 | 60607 | 360765 | 4336 |    425708 |
| AL    |       0 |      0 |        0 |  1995225 |        0 |        0 |       0 |     0 |      0 |    0 |   1995225 |
| AR    |       0 |      0 |        0 |   595537 |   617361 |        0 |       0 |     0 |      0 |    0 |   1212898 |
| AZ    |       0 |      0 |        0 |  4708346 |   129989 |        0 |       0 |     0 |      0 |    0 |   4838335 |
...
| FL    |       0 |  34706 |  9096223 |  1440916 |        0 |        0 |       0 |     0 |      0 |    0 |  10571845 |
| GA    |       0 |      0 |        0 |  2823939 |        0 |        0 |       0 |     0 |      0 |    0 |   2823939 |
| HI    |   43050 | 752983 |        0 |        0 |        0 |        0 |       0 |     0 |      0 |    0 |    796033 |
...
| WY    |       0 |      0 |        0 |        0 |        0 |   277480 |       0 |     0 |      0 |    0 |    277480 |
| NULL  | 1792991 | 787689 | 16227033 | 44213344 | 47460670 | 61110822 | 7105143 | 60607 | 360765 | 4336 | 179123400 |
+-------+---------+--------+----------+----------+----------+----------+---------+-------+--------+------+-----------+
</pre><p>Notice how Alaska (AK) has populations in high latitudes and Hawaii (HI) in low latitudes.</p>
<p>Example 2 - Home Solar Power Generation</p>
<p>This give the power (KWh) generated by hour and month for 2012.</p>
<pre class="fixed wrap">-- Sample input:
+---------------------+------+
| ts                  | enwh |
+---------------------+------+
| 2012-06-06 11:00:00 |  523 |
| 2012-06-06 11:05:00 |  526 |
| 2012-06-06 11:10:00 |  529 |
| 2012-06-06 11:15:00 |  533 |
| 2012-06-06 11:20:00 |  537 |
| 2012-06-06 11:25:00 |  540 |
| 2012-06-06 11:30:00 |  542 |
| 2012-06-06 11:35:00 |  543 |
Note that it is a reading in watts for each 5 minutes.
So, summing is needed to get the breakdown by month and hour.

-- Invoke the SP:
CALL Pivot('details',    -- Table
           'MONTH(ts)',  -- `base_cols`, to put on left; SUM up over the month
           'HOUR(ts)',   -- `pivot_col` to put across the top; SUM up entries across the hour
           'enwh/1000',  -- The data -- watts converted to KWh
           &#34;WHERE ts &gt;= '2012-01-01' AND ts &lt; '2012-01-01' + INTERVAL 1 year&#34;,  -- Limit to one year
           '');          -- assumes that the months stay in order

-- The SQL generated:
SELECT MONTH(ts),
SUM(IF(HOUR(ts) = &#34;5&#34;, enwh/1000, 0)) AS &#34;5&#34;,
SUM(IF(HOUR(ts) = &#34;6&#34;, enwh/1000, 0)) AS &#34;6&#34;,
SUM(IF(HOUR(ts) = &#34;7&#34;, enwh/1000, 0)) AS &#34;7&#34;,
SUM(IF(HOUR(ts) = &#34;8&#34;, enwh/1000, 0)) AS &#34;8&#34;,
SUM(IF(HOUR(ts) = &#34;9&#34;, enwh/1000, 0)) AS &#34;9&#34;,
SUM(IF(HOUR(ts) = &#34;10&#34;, enwh/1000, 0)) AS &#34;10&#34;,
SUM(IF(HOUR(ts) = &#34;11&#34;, enwh/1000, 0)) AS &#34;11&#34;,
SUM(IF(HOUR(ts) = &#34;12&#34;, enwh/1000, 0)) AS &#34;12&#34;,
SUM(IF(HOUR(ts) = &#34;13&#34;, enwh/1000, 0)) AS &#34;13&#34;,
SUM(IF(HOUR(ts) = &#34;14&#34;, enwh/1000, 0)) AS &#34;14&#34;,
SUM(IF(HOUR(ts) = &#34;15&#34;, enwh/1000, 0)) AS &#34;15&#34;,
SUM(IF(HOUR(ts) = &#34;16&#34;, enwh/1000, 0)) AS &#34;16&#34;,
SUM(IF(HOUR(ts) = &#34;17&#34;, enwh/1000, 0)) AS &#34;17&#34;,
SUM(IF(HOUR(ts) = &#34;18&#34;, enwh/1000, 0)) AS &#34;18&#34;,
SUM(IF(HOUR(ts) = &#34;19&#34;, enwh/1000, 0)) AS &#34;19&#34;,
SUM(IF(HOUR(ts) = &#34;20&#34;, enwh/1000, 0)) AS &#34;20&#34;,
 SUM(enwh/1000) AS Total
 FROM details WHERE ts &gt;= '2012-01-01' AND ts &lt; '2012-01-01' + INTERVAL 1 year GROUP BY MONTH(ts)
 WITH ROLLUP

-- That generated decimal places that I did like:
| MONTH(ts) | 5      | 6       | 7        | 8        | 9         | 10        | 11        | 12        | 13        | 14
     | 15        | 16       | 17       | 18       | 19      | 20     | Total      |
+-----------+--------+---------+----------+----------+-----------+-----------+-----------+-----------+-----------+------
-----+-----------+----------+----------+----------+---------+--------+------------+
|         1 | 0.0000 |  0.0000 |   1.8510 |  21.1620 |   52.3190 |   73.0420 |   89.3220 |   97.0190 |   88.9720 |   75.
4970 |   50.9270 |  12.5130 |   0.5990 |   0.0000 |  0.0000 | 0.0000 |   563.2230 |
|         2 | 0.0000 |  0.0460 |   5.9560 |  35.6330 |   72.4710 |   96.5130 |  112.7770 |  126.0850 |  117.1540 |   96.
7160 |   72.5900 |  33.6230 |   4.7650 |   0.0040 |  0.0000 | 0.0000 |   774.3330 |
</pre><p>Other variations made the math go wrong. (Note that there is no CAST to FLOAT.)</p>
<p>While I was at it, I gave an alias to change "MONTH(ts)" to just "Month".</p>
<p>So, I edited the SQL to this and ran it:</p>
<pre class="fixed"><span class="k">SELECT</span> <span class="k">MONTH</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span> <span class="k">AS</span> <span class="s1">&#39;Month&#39;</span><span class="p">,</span>
<span class="n">ROUND</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">IF</span><span class="p">(</span><span class="n">HOUR</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span> <span class="o">=</span> <span class="ss">&quot;5&quot;</span><span class="p">,</span> <span class="n">enwh</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span><span class="o">/</span><span class="mi">1000</span><span class="p">)</span> <span class="k">AS</span> <span class="ss">&quot;5&quot;</span><span class="p">,</span>
<span class="p">...</span>
<span class="n">ROUND</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="k">IF</span><span class="p">(</span><span class="n">HOUR</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span> <span class="o">=</span> <span class="ss">&quot;20&quot;</span><span class="p">,</span> <span class="n">enwh</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span><span class="o">/</span><span class="mi">1000</span><span class="p">)</span> <span class="k">AS</span> <span class="ss">&quot;20&quot;</span><span class="p">,</span>
 <span class="n">ROUND</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="n">enwh</span><span class="p">)</span><span class="o">/</span><span class="mi">1000</span><span class="p">)</span> <span class="k">AS</span> <span class="n">Total</span>
 <span class="k">FROM</span> <span class="n">details</span> <span class="k">WHERE</span> <span class="n">ts</span> <span class="o">&gt;=</span> <span class="s1">&#39;2012-01-01&#39;</span> <span class="k">AND</span> <span class="n">ts</span> <span class="o">&lt;</span> <span class="s1">&#39;2012-01-01&#39;</span> <span class="o">+</span> <span class="nb">INTERVAL</span> <span class="mi">1</span> <span class="k">year</span>
 <span class="k">GROUP</span> <span class="k">BY</span> <span class="k">MONTH</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>
 <span class="k">WITH</span> <span class="k">ROLLUP</span><span class="p">;</span>
</pre><p>-- Which gave cleaner output:</p>
<pre class="fixed wrap">+-------+------+------+------+------+------+------+------+------+------+------+------+------+------+------+------+------+-------+
| Month | 5    | 6    | 7    | 8    | 9    | 10   | 11   | 12   | 13   | 14   | 15   | 16   | 17   | 18   | 19   | 20   | Total |
+-------+------+------+------+------+------+------+------+------+------+------+------+------+------+------+------+------+-------+
|     1 |    0 |    0 |    2 |   21 |   52 |   73 |   89 |   97 |   89 |   75 |   51 |   13 |    1 |    0 |    0 |    0 |   563 |
|     2 |    0 |    0 |    6 |   36 |   72 |   97 |  113 |  126 |  117 |   97 |   73 |   34 |    5 |    0 |    0 |    0 |   774 |
|     3 |    0 |    0 |    9 |   46 |   75 |  105 |  121 |  122 |  128 |  126 |  105 |   71 |   33 |   10 |    0 |    0 |   952 |
|     4 |    0 |    1 |   14 |   63 |  111 |  146 |  171 |  179 |  177 |  158 |  141 |  105 |   65 |   26 |    3 |    0 |  1360 |
|     5 |    0 |    4 |   21 |   78 |  128 |  162 |  185 |  199 |  196 |  187 |  166 |  130 |   81 |   36 |    8 |    0 |  1581 |
|     6 |    0 |    4 |   17 |   71 |  132 |  163 |  182 |  191 |  193 |  182 |  161 |  132 |   89 |   43 |   10 |    1 |  1572 |
|     7 |    0 |    3 |   17 |   57 |  121 |  160 |  185 |  197 |  199 |  189 |  168 |  137 |   92 |   44 |   11 |    1 |  1581 |
|     8 |    0 |    1 |   11 |   48 |  104 |  149 |  171 |  183 |  187 |  179 |  156 |  121 |   76 |   32 |    5 |    0 |  1421 |
|     9 |    0 |    0 |    6 |   32 |   77 |  127 |  151 |  160 |  159 |  148 |  124 |   93 |   47 |   12 |    1 |    0 |  1137 |
|    10 |    0 |    0 |    1 |   16 |   54 |   85 |  107 |  115 |  119 |  106 |   85 |   56 |   17 |    2 |    0 |    0 |   763 |
|    11 |    0 |    0 |    5 |   30 |   57 |   70 |   84 |   83 |   76 |   64 |   35 |    8 |    1 |    0 |    0 |    0 |   512 |
|    12 |    0 |    0 |    2 |   17 |   39 |   54 |   67 |   75 |   64 |   58 |   31 |    4 |    0 |    0 |    0 |    0 |   411 |
|  NULL |    0 |   13 |  112 |  516 | 1023 | 1392 | 1628 | 1728 | 1703 | 1570 | 1294 |  902 |  506 |  203 |   38 |    2 | 12629 |
+-------+------+------+------+------+------+------+------+------+------+------+------+------+------+------+------+------+-------+
</pre><p>Midday in the summer is the best time for solar panels, as you would expect. 1-2pm in July was the best.</p>
<h2 class="anchored_heading" id="postlog">Postlog</h2>
<p>Posted, Feb. 2015</p>
<h2 class="anchored_heading" id="see-also">See Also</h2>
<ul start="1"><li><a href="http://www.artfulsoftware.com/queries.php">Brawley's notes</a>
<p>Rick James graciously allowed us to use this article in the Knowledge Base.</p>
<p><a href="http://mysql.rjweb.org/">Rick James' site</a> has other useful tips, how-tos,
optimizations, and debugging tips.</p>

Original source: <a href="http://mysql.rjweb.org/doc.php/pivot">http://mysql.rjweb.org/doc.php/pivot</a></li></ul>

    </div>


        
            <div id="subscribe" class="well well-small hide hidden-print"
                 data-subscribe-url="/kb/en/pivoting-in-mariadb/+subscriptions/add"
                 data-unsubscribe-url="/kb/en/pivoting-in-mariadb/+subscriptions/remove">
            </div>
        

        
        
    
        <div class="simple_section_nav">
            <ul class="nav nav-pills">
                
                    <li><a href="/kb/en/pagination-optimization/">
                        ← Pagination Optimization
                    </a>
                    </li>
                
                
                    <li><a href="/kb/en/query-optimizations/">
                        ↑ Query Optimizations ↑
                    </a>
                    </li>
                
                
                    <li class="pull-right"><a href="/kb/en/rollup-unique-user-counts/">
                        Rollup Unique User Counts →
                    </a>
                    </li>
                
            </ul>
        </div>
    

        

        
        <h2>Comments</h2>
        
    
    <div id="comments" data-node-id="5749" data-comments-url="/kb/en/pivoting-in-mariadb/+comments"
         data-reply-url="/kb/en/pivoting-in-mariadb/comments/post/">
        Comments loading...
    </div>

        

    </div>


                    <div id="content_disclaimer" class="graybox">
                        Content reproduced on this site is the property of its respective owners,
                        and this content is not reviewed in advance by MariaDB. The views, information and opinions
                        expressed by this content do not necessarily represent those of MariaDB or any other party.
                    </div>
                </div>
            </section>

            
                <div id="right_bar" class="col-md-2">
                    
    
        
        <ul class="section_navigation well well-small hidden-xs hidden-sm">
            
                <li class="parent"><a href="/kb/en/query-optimizations/">
                    ↑ Query Optimizations ↑
                </a>
                </li>
            
            
                
                    <li>
                        <a href="/kb/en/index-hints-how-to-force-query-plans/">
                            
                            Index Hints: How to Force Query Plans
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/subquery-optimizations/">
                            
                            Subquery Optimizations
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/optimization-strategies/">
                            
                            Optimization Strategies
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/optimizations-for-derived-tables/">
                            
                            Optimizations for Derived Tables
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/table-elimination/">
                            
                            Table Elimination
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/statistics-for-optimizing-queries/">
                            
                            Statistics for Optimizing Queries
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/filesort-with-small-limit-optimization/">
                            
                            Filesort with Small LIMIT Optimization
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/limit-rows-examined/">
                            
                            LIMIT ROWS EXAMINED
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/index_merge-sort_intersection/">
                            
                            index_merge sort_intersection
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-53-optimizer-debugging/">
                            
                            MariaDB 5.3 Optimizer Debugging
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/optimizer-switch/">
                            
                            optimizer_switch
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/how-to-quickly-insert-data-into-mariadb/">
                            
                            How to Quickly Insert Data Into MariaDB
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/index-condition-pushdown/">
                            
                            Index Condition Pushdown
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/query-limits-and-timeouts/">
                            
                            Query Limits and Timeouts
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/aborting-statements/">
                            
                            Aborting Statements that Exceed a Certain Time to Execute
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/partition-pruning-and-selection/">
                            <span class="pull-right not_primary"></span>
                            Partition Pruning and Selection
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/big-deletes/">
                            
                            Big DELETEs 
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/charset-narrowing-optimization/">
                            
                            Charset Narrowing Optimization
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/data-sampling-techniques-for-efficiently-finding-a-random-row/">
                            
                            Data Sampling: Techniques for Efficiently Finding a Random Row
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/data-warehousing-high-speed-ingestion/">
                            
                            Data Warehousing High Speed Ingestion
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/data-warehousing-summary-tables/">
                            
                            Data Warehousing Summary Tables
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/data-warehousing-techniques/">
                            
                            Data Warehousing Techniques
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/query-optimizations-distinct-removal-in-aggregate-functions/">
                            
                            DISTINCT removal in aggregate functions
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/equality-propagation-optimization/">
                            
                            Equality propagation optimization
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/force-index/">
                            
                            FORCE INDEX
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/groupwise-max-in-mariadb/">
                            
                            Groupwise Max in MariaDB
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/guiduuid-performance/">
                            
                            GUID/UUID Performance
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/hash_join_cardinality-optimizer_switch-flag/">
                            
                            hash_join_cardinality optimizer_switch Flag
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/ignore-index/">
                            
                            IGNORE INDEX
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/not_null_range_scan-optimization/">
                            
                            not_null_range_scan Optimization
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/optimizer_adjust_secondary_key_costs/">
                            
                            optimizer_adjust_secondary_key_costs
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/optimizer_join_limit_pref_ratio-optimization/">
                            
                            optimizer_join_limit_pref_ratio optimization
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/optimizing-for-latest-news-style-queries/">
                            
                            Optimizing for &#34;Latest News&#34;-style Queries
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/pagination-optimization/">
                            
                            Pagination Optimization
                        </a>
                    </li>
                
            
                
                    <li class="active">
                        <span>Pivoting in MariaDB</span>
                        
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/rollup-unique-user-counts/">
                            
                            Rollup Unique User Counts
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/rowid-filtering-optimization/">
                            
                            Rowid Filtering Optimization
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/sargable-date-and-year/">
                            
                            Sargable DATE and YEAR
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/sargable-upper/">
                            
                            Sargable UPPER
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/use-index/">
                            
                            USE INDEX
                        </a>
                    </li>
                
            
        </ul>
    
    

                </div>
            
        </div>
    </div>
</div>

<!-- Footer -->
<footer id="footer">
    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-xs-12">
                    <ul class="list-inline text-center footer-nav">
                        <li>
                            <h5>
                                <a href="https://mariadb.com/products" title="Products">Products</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/services" title="Services">Services</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/pricing" title="Pricing">Pricing</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/resources" title="Resources">Resources</a>
                            </h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/about-us" title="About MariaDB">About Us</a></h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/download" title="Download">Download MariaDB</a></h5>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="row row-10">
                
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div id="block-footerformcontact" class="block block-block-content block-block-contentd754ee1b-3cc9-40e7-9ef4-f504f1197fb1">
                        
                            <h5 style="font-weight: 400;">Subscribe to our newsletter!</h5>
                            <script src="//app-sj15.marketo.com/js/forms2/js/forms2.min.js"></script><form id="mktoForm_1498"></form>
                            <script>
                                <!--//--><![CDATA[// ><!--
                                MktoForms2.loadForm("//app-sj15.marketo.com", "573-PXI-984", 1498);
                                //--><!]]]]><![CDATA[>
                                //--><!]]>
                            </script>
                        
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div class="footer-copyright">
                        <div class="text-center">
                            <ul class="list-inline no-margin">
                                <li>
                                    <a href="/legal" title="Legal">Legal</a>
                                </li>
                                <li>
                                    <a href="/privacy-policy" title="Privacy Policy">Privacy Policy</a>
                                </li>
                                <li>
                                    <a href="/cookie-policy/" title="Cookies">Cookie Policy</a>
                                </li>
                            </ul>
                            <p>Copyright &copy; 2025 MariaDB. All rights reserved.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</footer>
</div>

<div id="ajax_loading">
    <img src="/kb/static/images/ajax-loader.a51c5608d01a.gif" />
</div>

    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MK2847"
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MK2847');</script>
    <!-- End Google Tag Manager -->

</body>

<script type="text/javascript" src="/kb/static/js/main.1587e3a666fc.js" charset="utf-8"></script>

</html>