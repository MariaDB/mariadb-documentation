<?xml version="1.0" encoding="utf-8"?>
<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title>MariaDB Knowledge Base Comments for: Do not understand why MariaDB rejected REGEXP with 42000 You have an error in your SQL syntax</title><link>https://mariadb.com/kb/en/the-community-do-not-understand-why-mariadb-rejected-regexp-with-42000-you-/+comments/feed/</link><description></description><atom:link href="https://mariadb.com/kb/en/the-community-do-not-understand-why-mariadb-rejected-regexp-with-42000-you-/+comments/feed/" rel="self"></atom:link><language>en-us</language><lastBuildDate>Tue, 12 Dec 2023 01:05:59 +0000</lastBuildDate><item><title>Re: Do not understand why MariaDB rejected REGEXP with 42000 You have an error in your SQL syntax</title><link>https://mariadb.com/kb/en/the-community-do-not-understand-why-mariadb-rejected-regexp-with-42000-you-/+comments/4393</link><description>&lt;p&gt;Someone will still have to tell me how to perform the trace.  Since the web server and the Sql server are on the same host they communicate using a named pipe, not by IP over the internet, so there is no IP traffic for wireshark to look at.&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">James Cobban</dc:creator><guid>https://mariadb.com/kb/en/the-community-do-not-understand-why-mariadb-rejected-regexp-with-42000-you-/+comments/4393</guid></item><item><title>Re: Do not understand why MariaDB rejected REGEXP with 42000 You have an error in your SQL syntax</title><link>https://mariadb.com/kb/en/the-community-do-not-understand-why-mariadb-rejected-regexp-with-42000-you-/+comments/4388</link><description>&lt;p&gt;I still do not know how to perform the trace.  For example I tried the steps described on &lt;a href="https://dbtut.com/index.php/2018/11/15/how-to-get-the-data-packets-between-mysql-client-and-server/"&gt;https://dbtut.com/index.php/2018/11/15/how-to-get-the-data-packets-between-mysql-client-and-server/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;$ sudo tcpdump -nnei any port 8001 -w tmp.pcap
[sudo] password for jcobban: 
tcpdump: listening on any, link-type LINUX_SLL (Linux cooked v1), capture size 262144 bytes&lt;/p&gt;
&lt;p&gt;At this point I invoked the script &lt;a href="http://localhost/Ontario/WmbResponse.php?district=Oxford+%26+Middlesex&amp;amp;area=Nissouri+Twp.E%26W"&gt;http://localhost/Ontario/WmbResponse.php?district=Oxford+%26+Middlesex&amp;amp;area=Nissouri+Twp.E%26W&lt;/a&gt; which duplicated the error.&lt;/p&gt;
&lt;p&gt;^C0 packets captured
0 packets received by filter
0 packets dropped by kernel&lt;/p&gt;
&lt;p&gt;The error is on requests made from PHP to the MariaDB server, not on requests from the mysql client.&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">James Cobban</dc:creator><guid>https://mariadb.com/kb/en/the-community-do-not-understand-why-mariadb-rejected-regexp-with-42000-you-/+comments/4388</guid></item><item><title>Re: Do not understand why MariaDB rejected REGEXP with 42000 You have an error in your SQL syntax</title><link>https://mariadb.com/kb/en/the-community-do-not-understand-why-mariadb-rejected-regexp-with-42000-you-/+comments/4368</link><description>&lt;p&gt;I do not know how to perform a wireshark trace of the MariaDB client server connection.   As to the PHP level my development system is running PHP Version 7.3.11-0ubuntu0.19.10.2 with mysqlnd 5.0.12-dev - 20150407  and  &lt;a href="/kb/en/mariadb-10320-release-notes/"&gt;MariaDB 10.3.20&lt;/a&gt;-MariaDB-0ubuntu0.19.10.1.  Those are quite current as I am running the latest available release of Ubuntu.  As noted in the original post my production system is currently running PHP Version 7.2.24-0ubuntu0.18.04.2 with MySQL 5.7.28-0ubuntu0.18.04.4 which is still quite current.  So I am experiencing the problem across a broad range of environments.   In both cases PHP and the SQL server are on the same host.&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">James Cobban</dc:creator><guid>https://mariadb.com/kb/en/the-community-do-not-understand-why-mariadb-rejected-regexp-with-42000-you-/+comments/4368</guid></item><item><title>Re: Do not understand why MariaDB rejected REGEXP with 42000 You have an error in your SQL syntax</title><link>https://mariadb.com/kb/en/the-community-do-not-understand-why-mariadb-rejected-regexp-with-42000-you-/+comments/4367</link><description>&lt;p&gt;It would be nice to create an issue &lt;a href="https://jira.mariadb.org/projects/MDEV/issues/"&gt;https://jira.mariadb.org/projects/MDEV/issues/&lt;/a&gt; with trace from wireshark, and php version. &lt;/p&gt;
&lt;p&gt;I failed to reproduce the issue with latest php and according pdo driver, the only way to identify the issue is having wireshark log to identify if this is a server issue, connector issue or otherwise&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Diego Dupin</dc:creator><guid>https://mariadb.com/kb/en/the-community-do-not-understand-why-mariadb-rejected-regexp-with-42000-you-/+comments/4367</guid></item><item><title>Re: Do not understand why MariaDB rejected REGEXP with 42000 You have an error in your SQL syntax</title><link>https://mariadb.com/kb/en/the-community-do-not-understand-why-mariadb-rejected-regexp-with-42000-you-/+comments/4365</link><description>&lt;p&gt;Thank you for your followup. In my implementation all of the SQL is in a small number of classes which provide an object-oriented wrapper that is used by the application code. There is only one piece of code that handles ALL queries that might match multiple records, in a class called RecordSet.  The class is documented at &lt;a href="https://github.com/jcobban/Genealogy/wiki/class-RecordSet"&gt;https://github.com/jcobban/Genealogy/wiki/class-RecordSet&lt;/a&gt; where you can also see the source code.  The point is that same piece of code is executed for many different requests and this particular query is the only one that has failed out of literally millions of different queries in the over 10 years that the code has been in use.  The failure occurs on the request to determine how many records there will be in the response, and again on the query to actually obtain the records:&lt;/p&gt;
&lt;p&gt;$baptisms    = new RecordSet('MethodistBaptisms',array('district' =&amp;gt; 'Oxford &amp;amp; Middlesex', "area" =&amp;gt; 'Nissouri Twp.E&amp;amp;W'));&lt;/p&gt;
&lt;p&gt;Processing the parameters to the constructor of RecordSet sets the following members of the class:
     $this-&amp;gt;sqlParms         = array('district1' =&amp;gt; 'Oxford &amp;amp; Middlesex', "area1" =&amp;gt; 'Nissouri Twp.E&amp;amp;W');
     $this-&amp;gt;where              = ''WHERE LOCATE(:district1, `district`) &amp;gt; 0 AND `area` REGEXP :area1';
     $countQuery		= "SELECT COUNT(*) FROM " . $this-&amp;gt;table .   ' ' . $this-&amp;gt;where;   &lt;em&gt; line 675&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;    $stmt		= $connection-&amp;gt;prepare($countQuery);           &lt;em&gt; line 754 
    $queryText	= debugPrepQuery($countQuery, $this-&amp;gt;sqlParms);
    if ($stmt-&amp;gt;execute($this-&amp;gt;sqlParms))
    {			&lt;/em&gt; success
	if ($debug)
	{
		    $warn	.= "&amp;lt;p&amp;gt;RecordSet.inc: " . &lt;u&gt;LINE&lt;/u&gt; .
								   " query=\"$queryText\"&amp;lt;/p&amp;gt;\n";
	}&lt;/p&gt;
&lt;p&gt;	&lt;em&gt; return count in parameter object
	$row 			                = $stmt-&amp;gt;fetch(PDO::FETCH_NUM);
        $this-&amp;gt;information['count']	= $row[0];
    }			&lt;/em&gt; success
    else
    {			&lt;em&gt; error performing query
	$this-&amp;gt;msg                               .= "RecordSet::&lt;u&gt;construct: \"$queryText\", " .
        print_r($stmt-&amp;gt;errorInfo(),true);
        print '&amp;lt;p&amp;gt;' . $this-&amp;gt;msg . "&amp;lt;/p&amp;gt;\n";
        print "&amp;lt;p&amp;gt;'$countQuery', parms=" . print_r($this-&amp;gt;sqlParms,true) . "&amp;lt;/p&amp;gt;\n";
    }			&lt;/u&gt;&lt;/em&gt; error performing query&lt;/p&gt;
&lt;p&gt;You can invoke this code and trigger the error by using the following URL:&lt;/p&gt;
&lt;p&gt;&lt;a href="https://www.jamescobban.net/Ontario/WmbResponse.php?district=Oxford+%26+Middlesex&amp;amp;area=Nissouri+Twp.E%26W"&gt;https://www.jamescobban.net/Ontario/WmbResponse.php?district=Oxford+%26+Middlesex&amp;amp;area=Nissouri+Twp.E%26W&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;It is critical to note the period "." between "Twp" and "E".  It is the presence of that period that triggers the use of REGEXP because it is a special character in regular expressions.  As a matter of fact the records that I am looking for actually have a period at that position, but the general purpose class cannot know that.  Omit the period or replace that period with a  character that does not have a special significance to regular expressions and the search is done with LOCATE, as is done for District.  You can see that by removing or changing the period in the test URL  The RecordSet class tries to avoid using MySQL/MariaDB specific functionality by emitting standard SQL that emulates the requested pattern whenever possible, but does not implement an emulation for the period character.&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">James Cobban</dc:creator><guid>https://mariadb.com/kb/en/the-community-do-not-understand-why-mariadb-rejected-regexp-with-42000-you-/+comments/4365</guid></item><item><title>Re: Do not understand why MariaDB rejected REGEXP with 42000 You have an error in your SQL syntax</title><link>https://mariadb.com/kb/en/the-community-do-not-understand-why-mariadb-rejected-regexp-with-42000-you-/+comments/4364</link><description>&lt;p&gt;would be nice to have a small snippet. 
I've tryed :
&amp;lt;?php
$dbh = new PDO('mysql:host=localhost;port=3308;dbname=testj', 'root', '');&lt;/p&gt;
&lt;p&gt;$dbh-&amp;gt;query('CREATE TEMPORARY TABLE ttt (t1 VARCHAR(256), t2 VARCHAR(256))');
$dbh-&amp;gt;query("INSERT INTO ttt VALUE ('Oxford &amp;amp; Middlesex', 'Nissouri Twp1E&amp;amp;W')");&lt;/p&gt;
&lt;p&gt;$stmt = $dbh-&amp;gt;prepare("SELECT COUNT(*) FROM ttt WHERE LOCATE(:district1, `t1`) &amp;gt; 0 AND `t2` REGEXP :area1");
if ($stmt-&amp;gt;execute(array ( 'district1' =&amp;gt; 'Oxford &amp;amp; Middlesex', 'area1' =&amp;gt; 'Nissouri Twp.E&amp;amp;W'))) {
  while ($row = $stmt-&amp;gt;fetch()) {
    print_r($row);
  }
}&lt;/p&gt;
&lt;p&gt;$dbh = null;
?&amp;gt;
without issue&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Diego Dupin</dc:creator><guid>https://mariadb.com/kb/en/the-community-do-not-understand-why-mariadb-rejected-regexp-with-42000-you-/+comments/4364</guid></item><item><title>Re: Do not understand why MariaDB rejected REGEXP with 42000 You have an error in your SQL syntax</title><link>https://mariadb.com/kb/en/the-community-do-not-understand-why-mariadb-rejected-regexp-with-42000-you-/+comments/4363</link><description>&lt;p&gt;I am using PHP with PDO to send the prepared statement and its parameters to the server.&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">James Cobban</dc:creator><guid>https://mariadb.com/kb/en/the-community-do-not-understand-why-mariadb-rejected-regexp-with-42000-you-/+comments/4363</guid></item><item><title>Re: Do not understand why MariaDB rejected REGEXP with 42000 You have an error in your SQL syntax</title><link>https://mariadb.com/kb/en/the-community-do-not-understand-why-mariadb-rejected-regexp-with-42000-you-/+comments/4360</link><description>&lt;p&gt;Which language do you use ( and connector) to send those parameters ?&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Diego Dupin</dc:creator><guid>https://mariadb.com/kb/en/the-community-do-not-understand-why-mariadb-rejected-regexp-with-42000-you-/+comments/4360</guid></item></channel></rss>