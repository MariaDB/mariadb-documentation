<?xml version="1.0" encoding="utf-8"?>
<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title>MariaDB Knowledge Base Comments for: Slow insert queries after upgrade</title><link>https://mariadb.com/kb/en/slow-insert-queries-after-upgrade/+comments/feed/</link><description></description><atom:link href="https://mariadb.com/kb/en/slow-insert-queries-after-upgrade/+comments/feed/" rel="self"></atom:link><language>en-us</language><lastBuildDate>Tue, 23 Jan 2024 00:57:57 +0000</lastBuildDate><item><title>Re: Slow insert queries after upgrade</title><link>https://mariadb.com/kb/en/slow-insert-queries-after-upgrade/+comments/5057</link><description>&lt;p&gt;The 10.5.7 release as well as the hot-fix release 10.5.8 introduced some regressions that you may be hitting. &lt;a href="https://jira.mariadb.org/browse/MDEV-24188"&gt;MDEV-24188&lt;/a&gt; (infinite loop, or hang) and &lt;a href="https://jira.mariadb.org/browse/MDEV-24275"&gt;MDEV-24275&lt;/a&gt; (very slow statistics collection) will be fixed in 10.5.9, which I hope will be out within a few days.&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Marko Mäkelä</dc:creator><guid>https://mariadb.com/kb/en/slow-insert-queries-after-upgrade/+comments/5057</guid></item><item><title>Re: Slow insert queries after upgrade</title><link>https://mariadb.com/kb/en/slow-insert-queries-after-upgrade/+comments/5051</link><description>&lt;p&gt;Thanks for your reply.&lt;/p&gt;
&lt;p&gt;It was a rather massive upgrade version wise...
We went from 10.1 to 10.5.8.&lt;/p&gt;
&lt;p&gt;When I run the select on it's own it takes a few seconds to run. Thats why I assumed that it was not the select that was slowing things down.
Please see the explain of the select below:&lt;/p&gt;
&lt;pre class="fixed"&gt; &amp;#34;id&amp;#34;	&amp;#34;select_type&amp;#34;	&amp;#34;table&amp;#34;	&amp;#34;type&amp;#34;	&amp;#34;possible_keys&amp;#34;	&amp;#34;key&amp;#34;	&amp;#34;key_len&amp;#34;	&amp;#34;ref&amp;#34;	&amp;#34;rows&amp;#34;	&amp;#34;Extra&amp;#34;
&amp;#34;1&amp;#34;	&amp;#34;PRIMARY&amp;#34;	&amp;#34;m&amp;#34;	&amp;#34;index&amp;#34;	\N	&amp;#34;PRIMARY&amp;#34;	&amp;#34;3&amp;#34;	\N	&amp;#34;269&amp;#34;	&amp;#34;Using where&amp;#34;
&amp;#34;1&amp;#34;	&amp;#34;PRIMARY&amp;#34;	&amp;#34;md&amp;#34;	&amp;#34;ref&amp;#34;	&amp;#34;id timestamp,meter_id&amp;#34;	&amp;#34;meter_id&amp;#34;	&amp;#34;3&amp;#34;	&amp;#34;stackTest.m.meter_id&amp;#34;	&amp;#34;7854&amp;#34;	&amp;#34;Using index&amp;#34;
&amp;#34;2&amp;#34;	&amp;#34;DEPENDENT SUBQUERY&amp;#34;	&amp;#34;md&amp;#34;	&amp;#34;ref&amp;#34;	&amp;#34;id timestamp,timeStamp,meter_id&amp;#34;	&amp;#34;id timestamp&amp;#34;	&amp;#34;3&amp;#34;	&amp;#34;func&amp;#34;	&amp;#34;7854&amp;#34;	&amp;#34;Using where; Using index&amp;#34;
&lt;/pre&gt;
&lt;p&gt;Both tables have an autoincrement primary key.&lt;/p&gt;
&lt;p&gt;I have tested the query several times and whilst the select improves after the first iteration the insert does not.&lt;/p&gt;
&lt;p&gt;Can you please expand on the "InnoDB locality problem in time series" comment you have mentioned? Just for context I am a developer so I am not well versed in the setup of the database itself.&lt;/p&gt;
&lt;p&gt;Thanks,
S.&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Stavros Antoniou</dc:creator><guid>https://mariadb.com/kb/en/slow-insert-queries-after-upgrade/+comments/5051</guid></item><item><title>Re: Slow insert queries after upgrade</title><link>https://mariadb.com/kb/en/slow-insert-queries-after-upgrade/+comments/5050</link><description>&lt;p&gt;It would be interesting to know from which version you were upgrading to 10.5.8? If you upgrade from 10.5.7 to 10.5.8 I would NOT expect any issues. If you upgrade from 10.3.x to 10.5.8 I am not surprised...&lt;/p&gt;
&lt;p&gt;Why are you sure, that it is NOT the SELECT? Because I would bet on the SELECT... Can you prove this?&lt;/p&gt;
&lt;p&gt;3rd it would be interesting to know what is the PK of both tables? So possibly you are running into the InnoDB locality problem in time series.&lt;/p&gt;
&lt;p&gt;Have you tested the query several times? If it is horribly slow just the first time and if this only/always happens after a MariaDB restart (caching issues) then you run indeed into the InnoDB locality problem in time series.&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Oli Sennhauser</dc:creator><guid>https://mariadb.com/kb/en/slow-insert-queries-after-upgrade/+comments/5050</guid></item></channel></rss>