<!DOCTYPE html>
<html>
<head data-cookie-domain=""
      data-cookie-path="/">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="apple-touch-icon" sizes="180x180" href="/kb/static/images/favicons/apple-touch-icon.159e713979be.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/kb/static/images/favicons/favicon-32x32.bc0ac1d5d11e.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/kb/static/images/favicons/favicon-16x16.5801f8f0f34e.png">
    <link rel="shortcut icon" href="/kb/static/images/favicons/favicon.d122d305dee4.ico" type="image/x-icon" />

    <title>  Binlogrouter - MariaDB Knowledge Base</title>

    <link href="/kb/static/css/main.9a0d7dcebefd.css" rel="stylesheet" type="text/css" />

    

    <!-- FB Open Graph tags -->
    <meta property="og:title" content="  Binlogrouter" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://mariadb.com/kb/en/mariadb-maxscale-6-binlogrouter/" />
    <meta property="og:image" content="http://mariadb.comaskmonty-logo.png" />
    <meta property="og:site_name" content="MariaDB KnowledgeBase" />
    <meta property="fb:admins" content="514852603" />
    <meta property="og:description" content="Binlogrouter
NOTE: The binlog router delivered with 2.5 is completely new and is not
          100% backward compatible with the binlog router delivered with earlier
         ..." />

    <meta name="description" content="Binlogrouter
NOTE: The binlog router delivered with 2.5 is completely new and is not
          100% backward compatible with the binlog router delivered with earlier
         ..." />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet"/>
    
</head>
<body class="mpkb nodes products nodes_view jqui" id="nodes_view">





<div id="menu-mobile" class="visible-sm visible-xs">

    <div>
        <div id="mobile-close-menu" class="text-right">
            <a href="javascript:void(0)" title="Close Menu" id="back-main" class="toggle-menu">X<span></span></a>
        </div>
    </div>
    <div class="mainmenu-mobile">
        <ul class="ls-none ul-menu">
            <li data-sub="submenu5"><a class="open-form-search" href="/kb/search/" title="Search">Search </a></li>
            <li data-sub="submenu0"><a href="/products" title="Products">Products</a><span class="arrow-main"></span></li>
            <li data-sub="submenu1"><a href="/services" title="Services">Services</a><span class="arrow-main"></span></li>
            <li data-sub="submenu2"><a href="/resources" title="Resources">Resources</a><span class="arrow-main"></span></li>
            <li data-sub="submenu3"><a href="/about-us" title="About">About</a><span class="arrow-main"></span></li>
            <li data-sub="submenu4"><a href="/contact" title="Contact">Contact</a></li>
        </ul>
    </div>

    <div class="nav-top-mobile">
        <div class="select-box form">

            <ul class="inline-block-md mb-none top-nav">
                <li>

                </li>
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/mariadb-maxscale-6-binlogrouter/"> Login</a>
                    </li>
                
            </ul>



        </div>
        <p class="text-center copyright">Copyright &copy; 2023 MariaDB. All rights reserved.</p>
    </div>
</div>
<div id="wrapper">
<div id="top-nav">
    <div class="container">
        <ul class="hidden-sm hidden-xs" >
            <li><a href="https://mariadb.com/kb/">Knowledge Base</a></li>
            <li><a href="https://mariadb.com/contact/">Contact</a></li>
            
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/mariadb-maxscale-6-binlogrouter/" rel="nofollow">Login</a>
                    </li>
                
            
            
            <li id="search-form">
                <form action="/kb/en/+search/" method="get" id="search-block-form" accept-charset="UTF-8">
                    <input id="search" title="Enter the terms you wish to search for."
                           placeholder="Search . . ." type="text"
                           name="q" value="" size="15" maxlength="128" class="form-text"
                           data-autocomplete-url="/kb/en/+search/autocomplete/">
                    <input type="hidden" name="quick" value="1" />
                    <input type="hidden" name="source" value="kb" />
                </form>
            </li>
            <li><a id="search-toggler" href="/kb/search/">Search</a></li>
            
        </ul>
    </div>
</div>
<div id="navbar-bottom" class="navbar">
    <div class="container">
        
        
        
        
        <div class="row">
            <div class="col-md-3 col-sm-9 col-xs-9">
                <a class="brand" href="/" title="MariaDB">
                    <img src="/kb/static/images/logo-2018-black.95f5978ae14d.png">
                </a>
            </div>
            <div class="col-md-9 hidden-sm hidden-xs">
                <div class="main-menu">
                    <ul id="main-menu" class="nav navbar-nav inline-block-sm">
    <li class="has-sub full-menu">
        <a href="/products" title="Products">Products</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/services" title="Services">Services</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/pricing" title="Pricing">Pricing</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/resources" title="Resources">Resources</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/about-us" title="About Us">About Us</a>
    </li>
    <li class="">
        <a class="button electric-eel small top-bar-right-download" href="/downloads/">Download</a>
    </li>
</ul>
                </div>
            </div>
            <div class="col-md-3 visible-sm visible-xs col-sm-3 col-xs-3 ps-rv">
                <div class="navbar-header text-right pull-right">
                    <button type="button" class="menu-control toggle-menu" id="open-menu">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="main">
    <div class="container">
        

        <div id="subheader1" class="clearfix">
            <div class="pull-left">
                
                <div id="breadcrumbs" class="breadcrumb">
                    <a href="/kb/en/">Knowledge Base</a>
                    


    
    » <a class="crumb" href="/kb/en/maxscale/">MariaDB MaxScale</a>
    

    
    » <a class="crumb" href="/kb/en/mariadb-maxscale-6/">MariaDB MaxScale 6</a>
    

    
    » <a class="crumb" href="/kb/en/maxscale-6-routers/">MaxScale 6 Routers</a>
    


    » <a class="node_link crumb" href="/kb/en/mariadb-maxscale-6-binlogrouter/">  Binlogrouter</a>


                </div>
                
            </div>
        </div>
    </div>
    <div class="container" id="container-main">
        <div class="row">
            
            
                
                <aside id="sidebar-first" class="sidebar col-md-2 hidden-xs hidden-sm hidden-print">
                    
                        
                        <ul id="category_menu" class="nav nav-pills nav-stacked">
                            <li><a href="/kb/en/">Home</a></li>
                            
                                
                                    <li><a href="/kb/en/+questions/">Open Questions</a></li>
                                
                                <li><a href="/kb/en/documentation/">MariaDB Server</a></li>
                                <li><a href="/kb/en/maxscale/">MariaDB MaxScale</a></li>
                                <li><a href="/kb/en/mariadb-columnstore/">MariaDB ColumnStore</a></li>
                                <li><a href="/kb/en/connectors/">Connectors</a></li>
                            

                        </ul>
                    

                    
<div>



<div class="well well-small box actions"><div>

        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/mariadb-maxscale-6-binlogrouter/+history" rel="nofollow">History</a>
        
        
        
        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/mariadb-maxscale-6-binlogrouter/+source/">Source</a>
        
        <a class="btn btn-block btn-blue btn-sm flag" href="/kb/en/mariadb-maxscale-6-binlogrouter/+flag"
                data-flag-url="/kb/en/mariadb-maxscale-6-binlogrouter/+flag" rel="nofollow">
                Flag as Spam / Inappropriate</a>
        
        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/mariadb-maxscale-6-binlogrouter/+translate/">
                Translate</a>
        

</div>
</div>





<div class="well well-small box node_info"><div>

    <dl>
        <dt>Created</dt>
        <dd>

<span class="datetime" title="2021-06-30 22:55">1 year, 12 months ago</span></dd>

        <dt>Modified</dt>
        <dd>

<span class="datetime" title="2021-06-30 22:55">1 year, 12 months ago</span></dd>

        <dt>Type</dt>
        <dd>article</dd>

        <dt>Status</dt>
        <dd>active</dd>

        <dt>License</dt>
        <dd>
            
                <a href="/kb/en/mariadb-maxscale-6-binlogrouter/+license/">CC BY-SA / Gnu FDL</a>
            
        </dd>

        
        <dt>Source</dt>
        <dd><a href="https://github.com/mariadb-corporation/MaxScale/blob/6.4.7/Documentation/Routers/Binlogrouter.md">GitHub</a></dd>
        
    </dl>

    
    <ul class="rss_feeds">
        <li><a href="/kb/en/mariadb-maxscale-6-binlogrouter/+history/feed/">
            History</a>
        </li>
        <li><a href="/kb/en/mariadb-maxscale-6-binlogrouter/+comments/feed/">
            Comments</a>
        </li>
    </ul>
    

</div>
</div>





    
    
    

<div class="well well-small box attachments"><div><div class="edit_link pull-right"><a href="/kb/en/mariadb-maxscale-6-binlogrouter/+edit/attachments/">Edit</a></div><h5>Attachments</h5></div><div>

        
            <div class="no_data">No attachments exist</div>
        
    
</div>
</div>

    



    
    






</div>


                    

































                </aside>
            
            
            
                
            
            
                
            
            <section id="content" class="limited_width col-md-8 clearfix">
                
                    <h1>  Binlogrouter</h1>
                

                



                <div>
                    
    

    
    
    

    <div class="node creole">
        
        
        


    
    <div class="answer formatted">
        <h1 id="binlogrouter">Binlogrouter</h1>
<p><strong>NOTE:</strong> The binlog router delivered with 2.5 is completely new and is <strong>not</strong>
          100% backward compatible with the binlog router delivered with earlier
          versions of MaxScale.</p>
<p>The binlogrouter is a router that acts as a replication proxy for MariaDB
master-slave replication. The router connects to a master, retrieves the binary
logs and stores them locally. Slave servers can connect to MaxScale like they
would connect to a normal master server. If the master server goes down,
replication between MaxScale and the slaves can still continue up to the latest
point to which the binlogrouter replicated to. The master can be changed without
disconnecting the slaves and without them noticing that the master server has
changed. This allows for a more highly available replication setup.</p>
<p>In addition to the high availability benefits, the binlogrouter creates only one
connection to the master whereas with normal replication each individual slave
will create a separate connection. This reduces the amount of work the master
database has to do which can be significant if there are a large number of
replicating slaves.</p>
<div>
<ul>
<li><a href="#binlogrouter">Binlogrouter</a><ul>
<li><a href="#differences-between-old-and-new-binlogrouter-implementations">Differences Between Old and New Binlogrouter Implementations</a></li>
<li><a href="#supported-sql-commands">Supported SQL Commands</a></li>
<li><a href="#configuration-parameters">Configuration Parameters</a><ul>
<li><a href="#datadir">datadir</a></li>
<li><a href="#server_id">server_id</a></li>
<li><a href="#net_timeout">net_timeout</a></li>
<li><a href="#select_master">select_master</a></li>
<li><a href="#expire_log_duration">expire_log_duration</a></li>
<li><a href="#expire_log_minimum_files">expire_log_minimum_files</a></li>
</ul>
</li>
<li><a href="#new-installation">New installation</a></li>
<li><a href="#upgrading-to-version-25">Upgrading to version 2.5</a><ul>
<li><a href="#before-you-start">Before you start</a></li>
<li><a href="#deployment">Deployment</a></li>
</ul>
</li>
<li><a href="#galera-cluster">Galera cluster</a></li>
<li><a href="#example">Example</a></li>
<li><a href="#limitations">Limitations</a></li>
</ul>
</li>
</ul>
</div>
<h2 id="differences-between-old-and-new-binlogrouter-implementations">Differences Between Old and New Binlogrouter Implementations</h2>
<p>The binlogrouter in MaxScale 2.5.0 is a new and improved version of the original
binlogrouter found in older MaxScale versions. The new implementation contains
most of the features that were in the original binlogrouter but some of them
were removed as they were either redundant or not useful.</p>
<p>The major differences between the new and old binlog router are:</p>
<ul>
<li>
<p>The list of servers where the database users for authentication are loaded
   must be explicitly configured with the <code>cluster</code>, <code>servers</code> or
   <code>targets</code> parameter. Alternatively, the users can be read from a file. See
   <a href="/kb/en/mariadb-maxscale-62-mariadb-maxscale-configuration-guide/#user_accounts_file">user_accounts_file</a>
   for more information.</p>
</li>
<li>
<p>The old binlog router had both <code>server_id</code> and <code>master_id</code>, the new only
   <code>server_id</code>.</p>
</li>
<li>
<p>No need to configure <em>heartbeat</em> and <em>burst interval</em> anymore as they are
   now automatically configured.</p>
</li>
<li>
<p>Traditional replication that uses the binary log name and file offset to
   start the replication process is not supported.</p>
</li>
<li>
<p>Semi-sync support is not implemented.</p>
</li>
<li>
<p>Binlog encryption is not implemented.</p>
</li>
<li>
<p><em>Secondary masters</em> are not supported, but the functionality provided by
   <code>select_master</code> is roughly equivalent.</p>
</li>
<li>
<p>The new binlogrouter will write its own binlog files to prevent problems that
   could happen when the master changes. This causes the binlog names to be
   different in the binlogrouter when compared to the ones on the master.</p>
</li>
</ul>
<p>The documentation for the binlogrouter in MaxScale 2.4 is provided for reference
<a href="/kb/en/mariadb-maxscale-6-binlogrouter-24/">here</a>.</p>
<h2 id="supported-sql-commands">Supported SQL Commands</h2>
<p>The binlogrouter supports a subset of the SQL constructs that the MariaDB server
supports. The following commands are supported:</p>
<ul>
<li>
<p><code>CHANGE MASTER TO</code></p>
</li>
<li>
<p>The binlogrouter supports the same syntax as the MariaDB server but only the
     following values are allowed:</p>
<ul>
<li><code>MASTER_HOST</code></li>
<li><code>MASTER_PORT</code></li>
<li><code>MASTER_USER</code></li>
<li><code>MASTER_PASSWORD</code></li>
<li><code>MASTER_USE_GTID</code></li>
<li><code>MASTER_SSL</code></li>
<li><code>MASTER_SSL_CA</code></li>
<li><code>MASTER_SSL_CAPATH</code></li>
<li><code>MASTER_SSL_CERT</code></li>
<li><code>MASTER_SSL_CRL</code></li>
<li><code>MASTER_SSL_CRLPATH</code></li>
<li><code>MASTER_SSL_KEY</code></li>
<li><code>MASTER_SSL_CIPHER</code></li>
<li><code>MASTER_SSL_VERIFY_SERVER_CERT</code></li>
</ul>
<p><strong>NOTE:</strong> <code>MASTER_LOG_FILE</code> and <code>MASTER_LOG_POS</code> are not supported
 as binlogrouter only supports GTID based replication.</p>
</li>
<li>
<p><code>STOP SLAVE</code></p>
</li>
<li>
<p>Stops replication, same as MariaDB.</p>
</li>
<li>
<p><code>START SLAVE</code></p>
</li>
<li>
<p>Starts replication, same as MariaDB.</p>
</li>
<li>
<p><code>RESET SLAVE</code></p>
</li>
<li>
<p>Resets replication. Note that the <code>RESET SLAVE ALL</code> form that is supported
     by MariaDB isn't supported by the binlogrouter.</p>
</li>
<li>
<p><code>SHOW BINARY LOGS</code></p>
</li>
<li>
<p>Lists the current files and their sizes. These will be different from the
     ones listed by the original master where the binlogrouter is replicating
     from.</p>
</li>
<li>
<p><code>PURGE { BINARY | MASTER } LOGS TO &lt;filename&gt;</code></p>
</li>
<li>
<p>Purges binary logs up to but not including the given file. The file name
     must be one of the names shown in <code>SHOW BINARY LOGS</code>. The version of this
     command which accepts a timestamp is not currently supported.
     Automatic purging is supported using the configuration
     parameter <a href="#expire_log_duration"><code>expire_log_duration</code></a>.</p>
<p>The files are purged in the order they were created. If a file to be purged
 is detected to be in use, the purge stops. This means that the purge will
 stop at the oldest file that a slave is still reading.</p>
<p><strong>NOTE:</strong> You should still take precaution not to purge files that a potential
 slave will need in the future. MaxScale can only detect that a file is
 in active use when a slave is connected, and requesting events from it.</p>
</li>
<li>
<p><code>SHOW MASTER STATUS</code></p>
</li>
<li>
<p>Shows the name and position of the file to which the binlogrouter will write
     the next replicated data. The name and position do not correspond to the
     name and position in the master.</p>
</li>
<li>
<p><code>SHOW SLAVE STATUS</code></p>
</li>
<li>
<p>Shows the slave status information similar to what a normal MariaDB slave
     server shows. Some of the values are replaced with constants values that
     never change. The following values are not constant:</p>
<ul>
<li>
<p><code>Slave_IO_State</code>: Set to <code>Waiting for master to send event</code> when
   replication is ongoing.</p>
</li>
<li>
<p><code>Master_Host</code>: Address of the current master.</p>
</li>
<li>
<p><code>Master_User</code>: The user used to replicate.</p>
</li>
<li>
<p><code>Master_Port</code>: The port the master is listening on.</p>
</li>
<li>
<p><code>Master_Log_File</code>: The name of the latest file that the binlogrouter is
   writing to.</p>
</li>
<li>
<p><code>Read_Master_Log_Pos</code>: The current position where the last event was
   written in the latest binlog.</p>
</li>
<li>
<p><code>Slave_IO_Running</code>: Set to <code>Yes</code> if replication running and <code>No</code> if it's
   not.</p>
</li>
<li>
<p><code>Slave_SQL_Running</code> Set to <code>Yes</code> if replication running and <code>No</code> if it's
   not.</p>
</li>
<li>
<p><code>Exec_Master_Log_Pos</code>: Same as <code>Read_Master_Log_Pos</code>.</p>
</li>
<li>
<p><code>Gtid_IO_Pos</code>: The latest replicated GTID.</p>
</li>
</ul>
</li>
<li>
<p><code>SELECT { Field } ...</code></p>
</li>
<li>
<p>The binlogrouter implements a small subset of the MariaDB SELECT syntax as
     it is mainly used by the replicating slaves to query various parameters. If
     a field queried by a client is not known to the binlogrouter, the value
     will be returned back as-is. The following list of functions and variables
     are understood by the binlogrouter and are replaced with actual values:</p>
<ul>
<li>
<p><code>@@gtid_slave_pos</code>, <code>@@gtid_current_pos</code> or <code>@@gtid_binlog_pos</code>: All of
   these return the latest GTID replicated from the master.</p>
</li>
<li>
<p><code>version()</code> or <code>@@version</code>: The version string returned by MaxScale when
   a client connects to it.</p>
</li>
<li>
<p><code>UNIX_TIMESTAMP()</code>: The current timestamp.</p>
</li>
<li>
<p><code>@@version_comment</code>: Always <code>pinloki</code>.</p>
</li>
<li>
<p><code>@@global.gtid_domain_id</code>: Always <code>0</code>.</p>
</li>
<li>
<p><code>@master_binlog_checksum</code>: Always <code>CRC32</code>.</p>
</li>
<li>
<p><code>@@session.auto_increment_increment</code>: Always <code>1</code></p>
</li>
<li>
<p><code>@@character_set_client</code>: Always <code>utf8</code></p>
</li>
<li>
<p><code>@@character_set_connection</code>: Always <code>utf8</code></p>
</li>
<li>
<p><code>@@character_set_results</code>: Always <code>utf8</code></p>
</li>
<li>
<p><code>@@character_set_server</code>: Always <code>utf8mb4</code></p>
</li>
<li>
<p><code>@@collation_server</code>: Always <code>utf8mb4_general_ci</code></p>
</li>
<li>
<p><code>@@collation_connection</code>: Always <code>utf8_general_ci</code></p>
</li>
<li>
<p><code>@@init_connect</code>: Always an empty string</p>
</li>
<li>
<p><code>@@interactive_timeout</code>: Always <code>28800</code></p>
</li>
<li>
<p><code>@@license</code>: Always <code>BSL</code></p>
</li>
<li>
<p><code>@@lower_case_table_names</code>: Always <code>0</code></p>
</li>
<li>
<p><code>@@max_allowed_packet</code>: Always <code>16777216</code></p>
</li>
<li>
<p><code>@@net_write_timeout</code>: Always <code>60</code></p>
</li>
<li>
<p><code>@@performance_schema</code>: Always <code>0</code></p>
</li>
<li>
<p><code>@@query_cache_size</code>: Always <code>1048576</code></p>
</li>
<li>
<p><code>@@query_cache_type</code>: Always <code>OFF</code></p>
</li>
<li>
<p><code>@@sql_mode</code>: Always an empty string</p>
</li>
<li>
<p><code>@@system_time_zone</code>: Always <code>UTC</code></p>
</li>
<li>
<p><code>@@time_zone</code>: Always <code>SYSTEM</code></p>
</li>
<li>
<p><code>@@tx_isolation</code>: Always <code>REPEATABLE-READ</code></p>
</li>
<li>
<p><code>@@wait_timeout</code>: Always <code>28800</code></p>
</li>
</ul>
</li>
<li>
<p><code>SET</code></p>
</li>
<li>
<p><code>@@global.gtid_slave_pos</code>: Set the position from which binlogrouter should
   start replicating. E.g. <code>SET @@global.gtid_slave_pos="0-1000-1234,1-1001-5678"</code></p>
</li>
<li>
<p><code>SHOW VARIABLES LIKE '...'</code></p>
</li>
<li>
<p>Shows variables matching a string. The <code>LIKE</code> operator in <code>SHOW VARIABLES</code>
     is mandatory for the binlogrouter. This means that a plain <code>SHOW VARIABLES</code>
     is not currently supported. In addition, the <code>LIKE</code> operator in
     binlogrouter only supports exact matches.</p>
<p>Currently the only variables that are returned are <code>gtid_slave_pos</code>,
 <code>gtid_current_pos</code> and <code>gtid_binlog_pos</code> which return the current GTID
 coordinates of the binlogrouter. In addition to these, the <code>server_id</code>
 variable will return the configured server ID of the binlogrouter.</p>
</li>
</ul>
<h2 id="configuration-parameters">Configuration Parameters</h2>
<p>The binlogrouter is configured similarly to how normal routers are configured in
MaxScale. It requires at least one listener where clients can connect to and one
server from which the database user information can be retrieved. An example
configuration can be found in the <a href="#example">example</a> section of this document.</p>
<h3 id="datadir"><code>datadir</code></h3>
<p>Directory where binary log files are stored. By default the files are stored in
<code>/var/lib/maxscale/binlogs</code>. <strong>NOTE:</strong> If you are upgrading from a version prior
to 2.5, make sure this directory is different from what it was before, or
move the old data.</p>
<h3 id="server_id"><code>server_id</code></h3>
<p>The server ID that MaxScale uses when connecting to the master and when serving
binary logs to the slaves. Default value is 1234.</p>
<h3 id="net_timeout"><code>net_timeout</code></h3>
<p>Network connection and read timeout for the connection to the master. The value
is specified as documented
<a href="/kb/en/mariadb-maxscale-62-mariadb-maxscale-configuration-guide/#durations">here</a>. Default value is 10
seconds.</p>
<h3 id="select_master"><code>select_master</code></h3>
<p>Automatically select the master server to replicate from. The default value is
false.</p>
<p>When this feature is enabled, the master which binlogrouter will replicate
from will be selected from the servers defined by a monitor <code>cluster=TheMonitor</code>.
Alternatively servers can be listed in <code>servers</code>. The servers should be monitored
by a monitor. Only servers with the <code>Master</code> status are used. If multiple master
servers are available, the first available master server will be used.</p>
<p>If a <code>CHANGE MASTER TO</code> command is received while <code>select_master</code> is on, the
command will be honored and <code>select_master</code> turned off until the next reboot.
This allows the Monitor to perform failover, and more importantly, switchover.
It also allows the user to manually redirect the Binlogrouter. The current
master is "sticky", meaning that the same master will be chosen on reboot.</p>
<p><strong>NOTE:</strong> Do not use the <code>mariadbmon</code> parameter
<a href="../Monitor/MariaDB-Monitor.md#auto_rejoin"><code>auto_rejoin</code></a> if the monitor is
monitoring a binlogrouter. The binlogrouter does not support all the SQL
commands that the monitor will send and the rejoin will fail. This restriction
will be lifted in a future version.</p>
<p>The GTID the replication will start from, will be based on the latest replicated
GTID. If no GTID has been replicated, the router will start replication from the
start. Manual configuration of the GTID can be done by first configuring the
replication manually with <code>CHANGE MASTER TO</code>.</p>
<h3 id="expire_log_duration"><code>expire_log_duration</code></h3>
<p>Duration after which a binary log file can be automatically removed. The default is 0,
or no automatic removal. This is similar to the server system variable
<a href="https://mariadb.com/kb/en/replication-and-binary-log-system-variables/#expire_logs_days">expire_log_days</a>.</p>
<p>The duration is measured from the last modification of the log file. Files are
purged in the order they were created. The automatic purge works in a similar
manner to <code>PURGE BINARY LOGS TO &lt;filename&gt;</code> in that it will stop the purge if
an eligible file is in active use, i.e. being read by a slave.</p>
<p>The duration can be specified as explained
<a href="/kb/en/mariadb-maxscale-62-mariadb-maxscale-configuration-guide/#durations">here</a>.</p>
<h3 id="expire_log_minimum_files"><code>expire_log_minimum_files</code></h3>
<p>The minimum number of log files the automatic purge keeps. At least one file
is always kept. The default setting is 2.</p>
<h2 id="new-installation">New installation</h2>
<ol>
<li>
<p>Configure and start MaxScale.</p>
</li>
<li>
<p>If you have not configured <code>select_master=true</code> (automatic
    master selection), issue a <code>CHANGE MASTER TO</code> command to binlogrouter.</p>
</li>
</ol>
<div><pre><span></span>mysql -u USER -pPASSWORD -h maxscale-IP -P binlog-PORT
CHANGE MASTER TO master_host="master-IP", master_port=master-PORT, master_user=USER, master_password="PASSWORD", master_use_gtid=slave_pos;
START SLAVE;
</pre></div>


<ol>
<li>Redirect each slave to replicate from Binlogrouter</li>
</ol>
<div><pre><span></span>mysql -u USER -pPASSWORD -h slave-IP -P slave-PORT
STOP SLAVE;
CHANGE MASTER TO master_host="maxscale-IP", master_port=binlog-PORT,
master_user="USER", master_password="PASSWORD", master_use_gtid=slave_pos;
START SLAVE;
SHOW SLAVE STATUS \G
</pre></div>


<h2 id="upgrading-to-version-25">Upgrading to version 2.5</h2>
<p>Binlogrouter does not read any of the data that a version prior to 2.5
has saved. By default binlogrouter will request the replication stream
from the blank state (from the start of time), which is basically meant
for new systems. If a system is live, the entire replication data probably
does not exist, and if it does, it is not necessary for binlogrouter to read
and store all the data.</p>
<h3 id="before-you-start">Before you start</h3>
<ul>
<li>Note that binlogrouter only supports GTID based replication.</li>
<li>Make sure that the configured data directory for the new binlogrouter
   is different from the old one, or move old data away.
   See <a href="#datadir">datadir</a>.</li>
<li>If the master contains binlogs from the blank state, and there
   is a large amount of data, consider purging old binlogs.
   See <a href="https://mariadb.com/kb/en/using-and-maintaining-the-binary-log/">Using and Maintaining the Binary Log</a>.</li>
</ul>
<h3 id="deployment">Deployment</h3>
<p>The method described here inflicts the least downtime. Assuming you have
configured version 2.5, and it is ready to go:</p>
<ol>
<li>Redirect each slave that replicates from Binlogrouter to replicate from the
    master.</li>
</ol>
<div><pre><span></span>mysql -u USER -pPASSWORD -h slave-IP -P slave-PORT
STOP SLAVE;
CHANGE MASTER TO master_host="master-IP", master_port=master-PORT,
master_user="USER", master_password="PASSWORD", master_use_gtid=slave_pos;
START SLAVE;
SHOW SLAVE STATUS \G
</pre></div>


<ol>
<li>
<p>Stop the old version of MaxScale, and start the new one.
    Verify routing functionality.</p>
</li>
<li>
<p>Issue a <code>CHANGE MASTER TO</code> command, or use <a href="#select_master">select_master</a>.</p>
</li>
</ol>
<div><pre><span></span>mysql -u USER -pPASSWORD -h maxscale-IP -P binlog-PORT
CHANGE MASTER TO master_host="master-IP", master_port=master-PORT,
master_user=USER,master_password="PASSWORD", master_use_gtid=slave_pos;
</pre></div>


<ol>
<li>Run <code>maxctrl list servers</code>. Make sure all your servers are accounted for.
    Pick the lowest gtid state (e.g. 0-1000-1234,1-1001-5678) on display and
    issue this command to Binlogrouter:</li>
</ol>
<div><pre><span></span>STOP SLAVE
SET @@global.gtid_slave_pos = "0-1000-1234,1-1001-5678";
START SLAVE
</pre></div>


<p><strong>NOTE:</strong> Even with <code>select_master=true</code> you have to set @@global.gtid_slave_pos
if any binlog files have been purged on the master. The server will only stream
from the start of time if the first binlog file is present.
See <a href="#select_master">select_master</a>.</p>
<ol>
<li>Redirect each slave to replicate from Binlogrouter.</li>
</ol>
<div><pre><span></span>mysql -u USER -pPASSWORD -h slave-IP -P slave-PORT
STOP SLAVE;
CHANGE MASTER TO master_host="maxscale-IP", master_port=binlog-PORT,
master_user="USER", master_password="PASSWORD",
master_use_gtid=slave_pos;
START SLAVE;
SHOW SLAVE STATUS \G
</pre></div>


<h2 id="galera-cluster">Galera cluster</h2>
<p>When replicating from a Galera cluster, <a href="#select_master">select_master</a> must be
set to true, and the servers must be monitored by the
<a href="https://mariadb.com/kb/en/mariadb-maxscale-25-monitor/">Galera Monitor</a>.
Configuring binlogrouter is the same as described above.</p>
<p>The Galera cluster must be configured to use <a href="https://mariadb.com/kb/en/using-mariadb-gtids-with-mariadb-galera-cluster/">Wsrep GTID Mode</a>.</p>
<p>The MariaDB version must be 10.5.1 or higher.
The required GTID related server settings for MariaDB/Galera to work with
Binlogrouter are listed here:</p>
<div><pre><span></span>[mariadb]
log_slave_updates = ON
log_bin = pinloki       # binlog file base name. Must be the same on all servers
gtid_domain_id = 1001   # Must be different for each galera server
binlog_format = ROW

[galera]
wsrep_on = ON
wsrep_gtid_mode = ON
wsrep_gtid_domain_id = 42  # Must be the same for all servers
</pre></div>


<h2 id="example">Example</h2>
<p>The following is a small configuration file with automatic master selection.
With it, the service will accept connections on port 3306.</p>
<div><pre><span></span>[server1]
type=server
address=192.168.0.1
port=3306

[server2]
type=server
address=192.168.0.2
port=3306

[MariaDB-Monitor]
type=monitor
module=mariadbmon
servers=server1, server2
user=maxuser
password=maxpwd
monitor_interval=10s

[Replication-Proxy]
type=service
router=binlogrouter
cluster=MariaDB-Monitor
select_master=true
expire_log_duration=5h
expire_log_minimum_files=3
user=maxuser
password=maxpwd

[Replication-Listener]
type=listener
service=Replication-Proxy
protocol=MariaDBClient
port=3306
</pre></div>


<h2 id="limitations">Limitations</h2>
<ul>
<li>
<p>Old-style replication with binlog name and file offset is not supported
  and the replication must be started by setting up the GTID to replicate
  from.</p>
</li>
<li>
<p>Only replication from MariaDB servers (including Galera) is supported.</p>
</li>
</ul>
    </div>


        
            <div id="subscribe" class="well well-small hide hidden-print"
                 data-subscribe-url="/kb/en/mariadb-maxscale-6-binlogrouter/+subscriptions/add"
                 data-unsubscribe-url="/kb/en/mariadb-maxscale-6-binlogrouter/+subscriptions/remove">
            </div>
        

        
        
    
        <div class="simple_section_nav">
            <ul class="nav nav-pills">
                
                
                    <li><a href="/kb/en/maxscale-6-routers/">
                        ↑ MaxScale 6 Routers ↑
                    </a>
                    </li>
                
                
                    <li class="pull-right"><a href="/kb/en/mariadb-maxscale-6-avrorouter/">
                         Avrorouter →
                    </a>
                    </li>
                
            </ul>
        </div>
    

        

        
        <h2>Comments</h2>
        
    
    <div id="comments" data-node-id="10824" data-comments-url="/kb/en/mariadb-maxscale-6-binlogrouter/+comments"
         data-reply-url="/kb/en/mariadb-maxscale-6-binlogrouter/comments/post/">
        Comments loading...
    </div>

        

    </div>


                    <div id="content_disclaimer" class="graybox">
                        Content reproduced on this site is the property of its respective owners,
                        and this content is not reviewed in advance by MariaDB. The views, information and opinions
                        expressed by this content do not necessarily represent those of MariaDB or any other party.
                    </div>
                </div>
            </section>

            
                <div id="right_bar" class="col-md-2">
                    
    
        
        <ul class="section_navigation well well-small hidden-xs hidden-sm">
            
                <li class="parent"><a href="/kb/en/maxscale-6-routers/">
                    ↑ MaxScale 6 Routers ↑
                </a>
                </li>
            
            
                
                    <li class="active">
                        <span>  Binlogrouter</span>
                        
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-6-avrorouter/">
                            
                             Avrorouter
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-6-binlogrouter-24/">
                            
                             Binlogrouter 2.4
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-6-cat/">
                            
                             Cat
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-6-hintrouter/">
                            
                             HintRouter
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-6-kafkacdc/">
                            
                             KafkaCDC
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-6-kafkaimporter/">
                            
                             KafkaImporter
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-6-mirror/">
                            
                             Mirror
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-6-readconnroute/">
                            
                             Readconnroute
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-6-schemarouter/">
                            
                             SchemaRouter
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-6-smartrouter/">
                            
                             SmartRouter
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-6-readwritesplit/">
                            
                            Readwritesplit
                        </a>
                    </li>
                
            
        </ul>
    
    

                </div>
            
        </div>
    </div>
</div>

<!-- Footer -->
<footer id="footer">
    <div class="footer">
        <div class="container">
            <div class="row row-10">
                <div class="col-md-2 col-xs-4 item">
                    <h5>
                        <a href="/products" title="Products">Products</a>
                    </h5>
                    <ul>
                        <li id="menu-item-7816" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-7816"><a href="https://mariadb.com/products/mariadb-platform/">MariaDB Platform</a></li>
                        <li id="menu-item-7815" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-7815"><a href="https://mariadb.com/products/skysql/">MariaDB SkySQL</a></li>
                        <li id="menu-item-4172" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4172"><a href="https://mariadb.com/pricing/">Pricing</a></li>
                        <li id="menu-item-4163" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4163"><a href="https://mariadb.com/downloads/">Download MariaDB</a></li>
                    </ul>
                </div>
                <div class="col-md-2 col-xs-4 item">
                    <h5>
                        <a href="/services" title="Services">Services</a>
                    </h5>
                    <ul>
                        <li id="menu-item-4169" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4169"><a href="https://mariadb.com/services/remote-dba/">Remote DBA</a></li>
                        <li id="menu-item-41691" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4169"><a href="https://mariadb.com/services/skydba/">SkyDBA</a></li>
                        <li id="menu-item-4167" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4167"><a href="https://mariadb.com/services/enterprise-architect/">Enterprise Architect</a></li>
                        <li id="menu-item-4170" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4170"><a href="https://mariadb.com/services/technical-support-services/">Technical Support</a></li>
                        <li id="menu-item-4168" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4168"><a href="https://mariadb.com/services/migration-practice/">Migration Practice</a></li>
                        <li id="menu-item-4166" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4166"><a href="https://mariadb.com/services/consulting/">Consulting</a></li>
                        <li id="menu-item-4171" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4171"><a href="https://mariadb.com/services/training/">Training</a></li>
                    </ul>
                </div>
                <div class="col-md-2 col-xs-4 item">
                    <h5>
                        <a href="/resources" title="Resources">Resources</a>
                    </h5>
                    <ul>
                        <li id="menu-item-41751" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4175"><a href="https://mariadb.com/docs/">Documentation</a></li>
                        <li id="menu-item-41752" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4175"><a href="https://mariadb.com/developers/">Developers</a></li>
                        <li id="menu-item-4175" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4175"><a href="https://mariadb.com/resources/blog/">Blog</a></li>
                        <li id="menu-item-5462" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-5462"><a href="https://support.mariadb.com">Support</a></li>
                        <li id="menu-item-6004" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6004"><a href="https://mariadb.com/openworks/">OpenWorks</a></li>
                        <li id="menu-item-60041" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6004"><a href="https://mariadb.com/resources/customer-stories/">Customer Stories</a></li>
                        <li id="menu-item-7817" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7817"><a href="https://mariadb.com/resources/events/">Events</a></li>
                        <li id="menu-item-4177" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4177"><a href="https://mariadb.com/roadshow/">MariaDB Roadshow</a></li>
                    </ul>
                </div>
                <div class="visible-xs visible-sm clear"></div>
                <div class="col-md-2 col-xs-5 item">
                    <h5>
                        <a href="/about-us" title="About MariaDB">About</a>
                    </h5>
                    <ul>
                        <li id="menu-item-4173" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4173"><a href="https://mariadb.com/contact/">Contact</a></li>
                        <li id="menu-item-4161" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4161"><a href="https://mariadb.com/about-us/leadership/">Leadership</a></li>
                        <li id="menu-item-4162" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4162"><a href="https://mariadb.com/about-us/partners/">Partners</a></li>
                        <li id="menu-item-4174" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4174"><a href="https://mariadb.com/newsroom/">Newsroom</a></li>
                        <li id="menu-item-4160" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4160"><a href="https://mariadb.com/about-us/investors/">Investors</a></li>
                        <li id="menu-item-4159" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4159"><a href="https://mariadb.com/about-us/careers/">Careers</a></li>
                        <li id="menu-item-41591" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4159"><a href="https://mariadb.com/trust/">Trust Center</a></li>
                        <li id="menu-item-41592" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4159"><a href="https://mariadb.com/vulnerability-reporting/">Vulnerability Reporting</a></li>
                    </ul>
                </div>
                <div class="col-md-4 col-xs-7 item">
                    <div id="block-footercontact" class="block block-block-content block-block-content22b3af28-0754-44ec-a5c6-4466568f37e3">
                        <h5><a href="/contact" title="Contact">Contact</a></h5>
                    </div>
                    <div class="social">
                        <ul class="list-inline">
                            <li>
                                <a target="_blank" href="https://www.facebook.com/MariaDB.dbms/" title="Facebook">
                                    <i class="fa fa-facebook" aria-hidden="true"></i>
                                </a>
                            </li>
                            <li>
                                <a target="_blank" href="https://twitter.com/mariadb" title="Twitter">
                                    <i class="fa fa-twitter" aria-hidden="true"></i>
                                </a>
                            </li>
                            <li>
                                <a target="_blank" href="https://www.linkedin.com/company/mariadb-corporation?trk=company_logo " title="LinkedIn">
                                    <i class="fa fa-linkedin" aria-hidden="true"></i>
                                </a>
                            </li>
                        </ul>
                    </div>
                    <div id="block-footerformcontact" class="block block-block-content block-block-contentd754ee1b-3cc9-40e7-9ef4-f504f1197fb1">
                        
                            <p>Subscribe to our newsletter!</p>
                            <script src="//app-sj15.marketo.com/js/forms2/js/forms2.min.js"></script><form id="mktoForm_1498"></form>
                            <script>
                                <!--//--><![CDATA[// ><!--
                                MktoForms2.loadForm("//app-sj15.marketo.com", "573-PXI-984", 1498);
                                //--><!]]]]><![CDATA[>
                                //--><!]]>
                            </script>
                        
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="footer-copyright">
        <div class="container text-center">
            <ul class="list-inline no-margin">
                <li>
                    <a href="/legal" title="Legal">Legal</a>
                </li>
                <li>
                    <a href="/privacy-policy" title="Privacy Policy">Privacy Policy</a>
                </li>
                <li>
                    <a href="/cookie-policy/" title="Cookies">Cookie Policy</a>
                </li>
            </ul>
            <p>Copyright &copy; 2023 MariaDB. All rights reserved.</p>
        </div>
    </div>
</footer>
</div>

<div id="ajax_loading">
    <img src="/kb/static/images/ajax-loader.a51c5608d01a.gif" />
</div>

    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MK2847"
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MK2847');</script>
    <!-- End Google Tag Manager -->

</body>

<script type="text/javascript" src="/kb/static/js/main.fed4ec768178.js" charset="utf-8"></script>

</html>