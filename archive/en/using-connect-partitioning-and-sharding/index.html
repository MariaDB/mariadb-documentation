<!DOCTYPE html>
<html>
<head data-cookie-domain=""
      data-cookie-path="/">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="apple-touch-icon" sizes="180x180" href="/kb/static/images/favicons/apple-touch-icon.159e713979be.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/kb/static/images/favicons/favicon-32x32.bc0ac1d5d11e.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/kb/static/images/favicons/favicon-16x16.5801f8f0f34e.png">
    <link rel="shortcut icon" href="/kb/static/images/favicons/favicon.d122d305dee4.ico" type="image/x-icon" />

    <title>Using CONNECT - Partitioning and Sharding - MariaDB Knowledge Base</title>

    <link href="/kb/static/css/main.f7633538c846.css" rel="stylesheet" type="text/css" />

    

    

    <!-- FB Open Graph tags -->
    <meta property="og:title" content="Using CONNECT - Partitioning and Sharding" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://mariadb.com/kb/en/using-connect-partitioning-and-sharding/" />
    <meta property="og:image" content="http://mariadb.comaskmonty-logo.png" />
    <meta property="og:site_name" content="MariaDB KnowledgeBase" />
    <meta property="fb:admins" content="514852603" />
    <meta property="og:description" content="Partitioning and Sharding with CONNECT" />

    <meta name="description" content="Partitioning and Sharding with CONNECT" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet"/>
    
</head>
<body class="mpkb nodes products nodes_view jqui" id="nodes_view">





<div id="menu-mobile" class="visible-sm visible-xs">

    <div>
        <div id="mobile-close-menu" class="text-right">
            <a href="javascript:void(0)" title="Close Menu" id="back-main" class="toggle-menu">X<span></span></a>
        </div>
    </div>
    <div class="mainmenu-mobile">
        <ul class="ls-none ul-menu">
            <li data-sub="submenu5"><a class="open-form-search" href="/kb/search/" title="Search">Search </a></li>
            <li data-sub="submenu0"><a href="/products" title="Products">Products</a><span class="arrow-main"></span></li>
            <li data-sub="submenu1"><a href="/services" title="Services">Services</a><span class="arrow-main"></span></li>
            <li data-sub="submenu2"><a href="/resources" title="Resources">Resources</a><span class="arrow-main"></span></li>
            <li data-sub="submenu3"><a href="/about-us" title="About">About</a><span class="arrow-main"></span></li>
            <li data-sub="submenu4"><a href="/contact" title="Contact">Contact</a></li>
        </ul>
    </div>

    <div class="nav-top-mobile">
        <div class="select-box form">

            <ul class="inline-block-md mb-none top-nav">
                <li>

                </li>
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/using-connect-partitioning-and-sharding/"> Login</a>
                    </li>
                
            </ul>



        </div>
        <p class="text-center copyright">Copyright &copy; 2025 MariaDB. All rights reserved.</p>
    </div>
</div>
<div class="violator-wrap d-none" id="top_violator">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12">
                <div class="violator-outer">
                    <div class="violator-inner">
                        <div class="row">
                            <div class="col-xs-12 col-sm-9 col-lg-7 col-lg-offset-2" id="top_violator_content">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="content-link" target="_blank" rel="nofollow noreferrer">
                                    <span>The Ultimate Guide to High Availability with MariaDB</span>
                                </a>
                            </div>
                            <div class="col-xs-12 col-sm-3" id="top_violator_cta">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="btn btn-mariadb" target="_blank" rel="nofollow noreferrer">Download Now</a>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-link close-btn">
                        <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24" width="15px" height="15px"><path d="M 4.9902344 3.9902344 A 1.0001 1.0001 0 0 0 4.2929688 5.7070312 L 10.585938 12 L 4.2929688 18.292969 A 1.0001 1.0001 0 1 0 5.7070312 19.707031 L 12 13.414062 L 18.292969 19.707031 A 1.0001 1.0001 0 1 0 19.707031 18.292969 L 13.414062 12 L 19.707031 5.7070312 A 1.0001 1.0001 0 0 0 18.980469 3.9902344 A 1.0001 1.0001 0 0 0 18.292969 4.2929688 L 12 10.585938 L 5.7070312 4.2929688 A 1.0001 1.0001 0 0 0 4.9902344 3.9902344 z"/></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="wrapper">
<div id="top-nav">
    <div class="container">
        <ul class="hidden-sm hidden-xs" >
            <li><a href="https://mariadb.com/kb/">Knowledge Base</a></li>
            <li><a href="https://mariadb.com/contact/">Contact</a></li>
            
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/using-connect-partitioning-and-sharding/" rel="nofollow">Login</a>
                    </li>
                
            
            
            <li id="search-form">
                <form action="/kb/en/+search/" method="get" id="search-block-form" accept-charset="UTF-8">
                    <input id="search" title="Enter the terms you wish to search for."
                           placeholder="Search . . ." type="text"
                           name="q" value="" size="15" maxlength="128" class="form-text"
                           data-autocomplete-url="/kb/en/+search/autocomplete/">
                    <input type="hidden" name="quick" value="1" />
                    <input type="hidden" name="source" value="kb" />
                </form>
            </li>
            <li><a id="search-toggler" href="/kb/search/">Search</a></li>
            
        </ul>
    </div>
</div>
<div id="navbar-bottom" class="navbar">
    <div class="container">
        
        
        
        
        <div class="row">
            <div class="col-md-3 col-sm-9 col-xs-9">
                <a class="brand" href="/" title="MariaDB">
                    <img src="/kb/static/images/logo-2018-black.95f5978ae14d.png">
                </a>
            </div>
            <div class="col-md-9 hidden-sm hidden-xs">
                <div class="main-menu">
                    <ul id="main-menu" class="nav navbar-nav inline-block-sm">
    <li class="has-sub full-menu">
        <a href="/products" title="Products">Products</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/services" title="Services">Services</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/pricing" title="Pricing">Pricing</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/resources" title="Resources">Resources</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/about-us" title="About Us">About Us</a>
    </li>
    <li class="">
        <a class="button electric-eel small top-bar-right-download" href="/downloads/">Download</a>
    </li>
</ul>
                </div>
            </div>
            <div class="col-md-3 visible-sm visible-xs col-sm-3 col-xs-3 ps-rv">
                <div class="navbar-header text-right pull-right">
                    <button type="button" class="menu-control toggle-menu" id="open-menu">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="main">
    <div class="container">
        

        <div id="subheader1" class="clearfix">
            <div class="pull-left">
                
                <div id="breadcrumbs" class="breadcrumb">
                    <a href="/kb/en/">Knowledge Base</a>
                    


    
    » <a class="crumb" href="/kb/en/documentation/">MariaDB Server Documentation</a>
    

    
    » <a class="crumb" href="/kb/en/columns-storage-engines-and-plugins/">Columns, Storage Engines, and Plugins</a>
    

    
    » <a class="crumb" href="/kb/en/storage-engines/">Storage Engines</a>
    

    
    » <a class="crumb" href="/kb/en/connect/">CONNECT</a>
    

    
    » <a class="crumb" href="/kb/en/using-connect/">Using CONNECT</a>
    


    » <a class="node_link crumb" href="/kb/en/using-connect-partitioning-and-sharding/">Using CONNECT - Partitioning and Sharding</a>


                </div>
                
            </div>
        </div>
    </div>
    <div class="container" id="container-main">
        <div class="row">
            
            
                
                <aside id="sidebar-first" class="sidebar col-md-2 hidden-xs hidden-sm hidden-print">
                    
                        
                        <ul id="category_menu" class="nav nav-pills nav-stacked">
                            <li><a href="/kb/en/">Home</a></li>
                            
                                
                                    <li><a href="/kb/en/+questions/">Open Questions</a></li>
                                
                                <li><a href="/kb/en/documentation/">MariaDB Server</a></li>
                                <li><a href="/kb/en/maxscale/">MariaDB MaxScale</a></li>
                                <li><a href="/kb/en/mariadb-columnstore/">MariaDB ColumnStore</a></li>
                                <li><a href="/kb/en/connectors/">Connectors</a></li>
                            

                        </ul>
                    

                    
<div>



<div class="well well-small box actions"><div>

        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/using-connect-partitioning-and-sharding/+history" rel="nofollow">History</a>
        
        
        
        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/using-connect-partitioning-and-sharding/+source/">Source</a>
        
        <a class="btn btn-block btn-blue btn-sm flag" href="/kb/en/using-connect-partitioning-and-sharding/+flag"
                data-flag-url="/kb/en/using-connect-partitioning-and-sharding/+flag" rel="nofollow">
                Flag as Spam / Inappropriate</a>
        
        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/using-connect-partitioning-and-sharding/+translate/">
                Translate</a>
        

</div>
</div>





<div class="well well-small box node_info"><div>

    <dl>
        <dt>Created</dt>
        <dd>

<span class="datetime" title="2014-09-04 11:29">10 years, 6 months ago</span></dd>

        <dt>Modified</dt>
        <dd>

<span class="datetime" title="2017-06-27 09:33">7 years, 9 months ago</span></dd>

        <dt>Type</dt>
        <dd>article</dd>

        <dt>Status</dt>
        <dd>active</dd>

        <dt>License</dt>
        <dd>
            
                <a href="/kb/en/using-connect-partitioning-and-sharding/+license/">CC BY-SA / Gnu FDL</a>
            
        </dd>

        
    </dl>

    
    <ul class="rss_feeds">
        <li><a href="/kb/en/using-connect-partitioning-and-sharding/+history/feed/">
            History</a>
        </li>
        <li><a href="/kb/en/using-connect-partitioning-and-sharding/+comments/feed/">
            Comments</a>
        </li>
    </ul>
    

</div>
</div>





    
    
    

<div class="well well-small box attachments"><div><div class="edit_link pull-right"><a href="/kb/en/using-connect-partitioning-and-sharding/+edit/attachments/">Edit</a></div><h5>Attachments</h5></div><div>

        
            <div class="no_data">No attachments exist</div>
        
    
</div>
</div>

    



    
    






</div>


                    

































                </aside>
            
            
            
                
            
            
                
            
            <section id="content" class="limited_width col-md-8 clearfix">
                
                    <h1>Using CONNECT - Partitioning and Sharding</h1>
                

                



                <div>
                    
    

    
    
    

    <div class="node creole">
        
        
        


    
    <div class="answer formatted">
        <div class="table_of_contents well well-small">
<h3>Contents</h3>
 <ol class="toc">

    <li class=""><a href="#partition-engine-issues" title="Partition engine issues">Partition engine issues</a></li>

    <li class=""><a href="#file-partitioning" title="File Partitioning">File Partitioning</a>    <ol class="toc">

        <li class=""><a href="#outward-tables" title="Outward Tables">Outward Tables</a>        <ol class="toc">

            <li class=""><a href="#partitioning-on-a-special-column" title="Partitioning on a Special Column">Partitioning on a Special Column</a></li>

            <li class=""><a href="#partitioning-of-zipped-tables" title="Partitioning of zipped tables">Partitioning of zipped tables</a>        </ol>
    </ol>
</li>

    <li class=""><a href="#table-partitioning" title="Table Partitioning">Table Partitioning</a>    <ol class="toc">

        <li class=""><a href="#indexing-with-table-partitioning" title="Indexing with Table Partitioning">Indexing with Table Partitioning</a></li>

        <li class=""><a href="#sharding-with-table-partitioning" title="Sharding with Table Partitioning">Sharding with Table Partitioning</a>        <ol class="toc">

            <li class=""><a href="#sharding-on-a-special-column" title="Sharding on a Special Column">Sharding on a Special Column</a>        </ol>
    </ol>
</li>

    <li class=""><a href="#current-partition-limitations" title="Current Partition Limitations">Current Partition Limitations</a>    <ol class="toc">

        <li class=""><a href="#update-statement" title="Update statement">Update statement</a></li>

        <li class=""><a href="#alter-table-statement" title="Alter Table statement">Alter Table statement</a></li>

        <li class=""><a href="#rowid-special-column" title="Rowid special column">Rowid special column</a>    </ol>
 </ol>
</li>
</div><p>
CONNECT supports the MySQL/MariaDB partition specification. It is done similar to the way
<a href="/kb/en/myisam/">MyISAM</a> or <a href="/kb/en/innodb/">InnoDB</a> do by using the PARTITION engine that must be enabled for this to work. This type of partitioning is sometimes referred as “horizontal partitioning”.</p>
<p>Partitioning enables you to distribute portions of individual tables across a file system according to
rules which you can set largely as needed. In effect, different portions of a table are stored as separate
tables in different locations. The user-selected rule by which the division of data is accomplished is
known as a partitioning function, which in MariaDB can be the modulus, simple matching against a set
of ranges or value lists, an internal hashing function, or a linear hashing function.</p>
<p>CONNECT takes this notion a step further, by providing two types of partitioning:</p>
<ol><li>File partitioning. Each partition is stored in a separate file like in multiple tables.
</li><li>Table partitioning. Each partition is stored in a separate table like in TBL tables.
</li></ol>
<h2 class="anchored_heading" id="partition-engine-issues">Partition engine issues</h2>
<p>Using partitions sometimes requires creating the tables in an unnatural way to avoid some error due to several partition engine bugs:</p>
<ol start="1"><li>Engine specific column and index options are not recognized and cause a syntax error when the table is created. The workaround is to create the table in two steps, a CREATE TABLE statement followed by an ALTER TABLE statement.
</li><li>The connection string, when specified for the table, is lost by the partition engine. The workaround is to specify the connection string in the <em>option_list</em>. 
</li><li><a href="https://bugs.mysql.com/bug.php?id=71095">MySQL upstream bug #71095</a>. In case of list columns partitioning it sometimes causes a false “impossible where” clause to be raised. This makes a wrong void result returned when it should not be void. There is no workaround but this bug should be hopefully fixed.
</li></ol>
<p>The following examples are using the above workaround syntax to address these issues.</p>
<h2 class="anchored_heading" id="file-partitioning">File Partitioning</h2>
<p>File partitioning applies to file-based CONNECT table types. As with multiple tables, physical data is
stored in several files instead of just one. The differences to multiple tables are:</p>
<ol><li>Data is distributed amongst the different files following the partition rule.
</li><li>Unlike multiple tables, partitioned tables are not read only.
</li><li>Unlike multiple tables, partitioned tables can be indexable.
</li><li>The file names are generated from the partition names.
</li><li>Query pruning is automatically made by the partition engine.
</li></ol>
<p>The table file names are generated differently depending on whether the table is an inward or outward
table. For inward tables, for which the file name is not specified, the partition file names are:</p>
<pre class="fixed">Data file name: table_name#P#partition_name.table_file_type
Index file name: table_name#P#partition_name.index_file_type
</pre><p>For instance for the table:</p>
<pre class="fixed"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nf">t1</span> <span class="p">(</span>
<span class="n">id</span> <span class="kt">INT</span> <span class="k">KEY</span> <span class="k">NOT</span> <span class="no">NULL</span><span class="p">,</span>
<span class="n">msg</span> <span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">32</span><span class="p">))</span>
<span class="kp">ENGINE</span><span class="o">=</span><span class="n">CONNECT</span> <span class="n">TABLE_TYPE</span><span class="o">=</span><span class="n">FIX</span>
<span class="n">partition</span> <span class="k">by</span> <span class="nf">range</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="p">(</span>
<span class="n">partition</span> <span class="n">first</span> <span class="k">values</span> <span class="n">less</span> <span class="nf">than</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
<span class="n">partition</span> <span class="n">middle</span> <span class="k">values</span> <span class="n">less</span> <span class="nf">than</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
<span class="n">partition</span> <span class="n">last</span> <span class="k">values</span> <span class="n">less</span> <span class="nf">than</span><span class="p">(</span><span class="n">MAXVALUE</span><span class="p">));</span>
</pre><p>CONNECT will generate in the current data directory the files:</p>
<pre class="fixed">| t1#P#first.fix
| t1#P#first.fnx
| t1#P#middle.fix
| t1#P#middle.fnx
| t1#P#last.fix
| t1#P#last.fnx
</pre><p>This is similar to what the partition engine does for other engines - CONNECT
partitioned inward tables behave like other engines partition tables do. Just the data format is different.</p>
<p>Note: If sub-partitioning is used, inward table files and index files are named:</p>
<pre class="fixed">| table_name#P#partition_name#SP#subpartition_name.type
| table_name#P#partition_name#SP#subpartition_name.index_type
</pre><h3 class="anchored_heading" id="outward-tables">Outward Tables</h3>
<p>The real problems occur with outward tables, in particular when they are created from already existing
files. The first issue is to make the partition table use the correct existing file names. The second one,
only for already existing not void tables, is to be sure the partitioning function match the distribution of
the data already existing in the files.</p>
<p>The first issue is addressed by the way data file names are constructed. For instance let us suppose we
want to make a table from the fixed formatted files:</p>
<pre class="fixed">E:\Data\part1.txt
E:\Data\part2.txt
E:\Data\part3.txt
</pre><p>This can be done by creating a table such as:</p>
<pre class="fixed"><span class="k">create</span> <span class="k">table</span> <span class="nf">t2</span> <span class="p">(</span>
<span class="n">id</span> <span class="kt">int</span> <span class="k">not</span> <span class="no">null</span><span class="p">,</span>
<span class="n">msg</span> <span class="kt">varchar</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span>
<span class="k">index</span> <span class="nf">XID</span><span class="p">(</span><span class="n">id</span><span class="p">))</span>
<span class="kp">engine</span><span class="o">=</span><span class="n">connect</span> <span class="n">table_type</span><span class="o">=</span><span class="n">FIX</span> <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;E:/Data/part%s.txt&#39;</span>
<span class="n">partition</span> <span class="k">by</span> <span class="nf">range</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="p">(</span>
<span class="n">partition</span> <span class="ss">`1`</span> <span class="k">values</span> <span class="n">less</span> <span class="nf">than</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
<span class="n">partition</span> <span class="ss">`2`</span> <span class="k">values</span> <span class="n">less</span> <span class="nf">than</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
<span class="n">partition</span> <span class="ss">`3`</span> <span class="k">values</span> <span class="n">less</span> <span class="nf">than</span><span class="p">(</span><span class="n">MAXVALUE</span><span class="p">));</span>
</pre><p>The rule is that for each partition the matching file name is internally generated by replacing in the
given FILE _ NAME option value the “%s” part by the partition name.</p>
<p>If the table was initially void, further inserts will populate it according to the partition function.
However, if the files did exist and contained data, this is your responsibility to determine what partition function actually matches the data distribution in them. This means in particular that partitioning by key or by hash cannot be used (except in exceptional cases) because you have almost no control over what the used algorithm does.</p>
<p>In the example above, there is no problem if the table is initially void, but if it is not, serious problems can be met if the initial distribution does not match the table distribution. Supposing a row in which “id” as the value 12 was initially contained in the part1.txt file, it will be seen when selecting the whole table but if you ask:</p>
<pre class="fixed"><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">t2</span> <span class="k">where</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>
</pre><p>The result will have 0 rows. This is because according to the partition function query pruning will only look inside the second partition and will miss the row that is in the wrong partition.</p>
<p>One way to check for wrong distribution if for instance to compare the results from queries such as:</p>
<pre class="fixed"><span class="k">SELECT</span> <span class="n">partition_name</span><span class="p">,</span> <span class="n">table_rows</span> <span class="k">FROM</span>
<span class="n">information_schema</span><span class="p">.</span><span class="n">partitions</span> <span class="k">WHERE</span> <span class="n">table_name</span> <span class="o">=</span> <span class="s1">&#39;t2&#39;</span><span class="p">;</span>
</pre><p>And</p>
<pre class="fixed"><span class="k">SELECT</span> <span class="k">CASE</span> <span class="k">WHEN</span> <span class="n">id</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="k">THEN</span> <span class="mi">1</span> <span class="k">WHEN</span> <span class="n">id</span> <span class="o">&lt;</span> <span class="mi">50</span> <span class="k">THEN</span> <span class="mi">2</span> <span class="k">ELSE</span> <span class="mi">3</span> <span class="n">END</span>
<span class="k">AS</span> <span class="n">pn</span><span class="p">,</span> <span class="nf">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">part3</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">pn</span><span class="p">;</span>
</pre><p>If they match, the distribution can be correct although this does not prove it. However, if they do not
match, the distribution is surely wrong.</p>
<h4 class="anchored_heading" id="partitioning-on-a-special-column">Partitioning on a Special Column</h4>
<p>There are some cases where the files of a multiple table do not contain columns that can be used for
range or list partitioning. For instance, let’s suppose we have a multiple table based on the following
files:</p>
<pre class="fixed">tmp/boston.txt
tmp/chicago.txt
tmp/atlanta.txt
</pre><p>Each of them containing the same kind of data:</p>
<pre class="fixed">ID: int
First_name: varchar(16)
Last_name: varchar(30)
Birth: date
Hired: date
Job: char(10)
Salary: double(8,2)
</pre><p>A multiple table can be created on them, for instance by:</p>
<pre class="fixed"><span class="k">create</span> <span class="k">table</span> <span class="nf">mulemp</span> <span class="p">(</span>
<span class="n">id</span> <span class="kt">int</span> <span class="k">NOT</span> <span class="no">NULL</span><span class="p">,</span>
<span class="n">first_name</span> <span class="kt">varchar</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span> <span class="k">NOT</span> <span class="no">NULL</span><span class="p">,</span>
<span class="n">last_name</span> <span class="kt">varchar</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="k">NOT</span> <span class="no">NULL</span><span class="p">,</span>
<span class="n">birth</span> <span class="kt">date</span> <span class="k">NOT</span> <span class="no">NULL</span> <span class="n">date_format</span><span class="o">=</span><span class="s1">&#39;DD/MM/YYYY&#39;</span><span class="p">,</span>
<span class="n">hired</span> <span class="kt">date</span> <span class="k">NOT</span> <span class="no">NULL</span> <span class="n">date_format</span><span class="o">=</span><span class="s1">&#39;DD/MM/YYYY&#39;</span><span class="p">,</span>
<span class="n">job</span> <span class="kt">char</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="k">NOT</span> <span class="no">NULL</span><span class="p">,</span>
<span class="n">salary</span> <span class="kt">double</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="no">NULL</span>
<span class="p">)</span> <span class="kp">engine</span><span class="o">=</span><span class="n">CONNECT</span> <span class="n">table_type</span><span class="o">=</span><span class="n">FIX</span> <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;tmp/*.txt&#39;</span> <span class="n">multiple</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
</pre><p>The issue is that if we want to create a partitioned table on these files, there are no columns to use for
defining a partition function. Each city file can have the same kind of column values and there is no
way to distinguish them.</p>
<p>However, there is a solution. It is to add to the table a special column that will be used by the partition
function. For instance, the new table creation can be done by:</p>
<pre class="fixed"><span class="k">create</span> <span class="k">table</span> <span class="nf">partemp</span> <span class="p">(</span>
<span class="n">id</span> <span class="kt">int</span> <span class="k">NOT</span> <span class="no">NULL</span><span class="p">,</span>
<span class="n">first_name</span> <span class="kt">varchar</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span> <span class="k">NOT</span> <span class="no">NULL</span><span class="p">,</span>
<span class="n">last_name</span> <span class="kt">varchar</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="k">NOT</span> <span class="no">NULL</span><span class="p">,</span>
<span class="n">birth</span> <span class="kt">date</span> <span class="k">NOT</span> <span class="no">NULL</span> <span class="n">date_format</span><span class="o">=</span><span class="s1">&#39;DD/MM/YYYY&#39;</span><span class="p">,</span>
<span class="n">hired</span> <span class="kt">date</span> <span class="k">NOT</span> <span class="no">NULL</span> <span class="n">date_format</span><span class="o">=</span><span class="s1">&#39;DD/MM/YYYY&#39;</span><span class="p">,</span>
<span class="n">job</span> <span class="kt">char</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span> <span class="k">NOT</span> <span class="no">NULL</span><span class="p">,</span>
<span class="n">salary</span> <span class="kt">double</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="no">NULL</span><span class="p">,</span>
<span class="n">city</span> <span class="kt">char</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span> <span class="k">default</span> <span class="s1">&#39;boston&#39;</span> <span class="n">special</span><span class="o">=</span><span class="n">PARTID</span><span class="p">,</span>
<span class="k">index</span> <span class="nf">XID</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span> <span class="kp">engine</span><span class="o">=</span><span class="n">CONNECT</span> <span class="n">table_type</span><span class="o">=</span><span class="n">FIX</span> <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;E:/Data/Test/%s.txt&#39;</span><span class="p">;</span>
<span class="k">alter</span> <span class="k">table</span> <span class="n">partemp</span>
<span class="n">partition</span> <span class="k">by</span> <span class="n">list</span> <span class="nf">columns</span><span class="p">(</span><span class="n">city</span><span class="p">)</span> <span class="p">(</span>
<span class="n">partition</span> <span class="ss">`atlanta`</span> <span class="k">values</span> <span class="k">in</span><span class="p">(</span><span class="s1">&#39;atlanta&#39;</span><span class="p">),</span>
<span class="n">partition</span> <span class="ss">`boston`</span> <span class="k">values</span> <span class="k">in</span><span class="p">(</span><span class="s1">&#39;boston&#39;</span><span class="p">),</span>
<span class="n">partition</span> <span class="ss">`chicago`</span> <span class="k">values</span> <span class="k">in</span><span class="p">(</span><span class="s1">&#39;chicago&#39;</span><span class="p">));</span>
</pre><p>Note 1: we had to do it in two steps because of the column CONNECT options.</p>
<p>Note 2: the special column PARTID returns the name of the partition in which the row is located.</p>
<p>Note 3: here we could have used the FNAME special column instead because the file name is specified
as being the partition name.</p>
<p>This may seem rather stupid because it means for instance that a row will be in partition boston if it
belongs to the partition boston! However, it works because the partition engine doesn’t know about
special columns and behaves as if the city column was a real column.</p>
<p>What happens if we populate it by?</p>
<pre class="fixed"><span class="k">insert</span> <span class="k">into</span> <span class="nf">partemp</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="n">first_name</span><span class="p">,</span><span class="n">last_name</span><span class="p">,</span><span class="n">birth</span><span class="p">,</span><span class="n">hired</span><span class="p">,</span><span class="n">job</span><span class="p">,</span><span class="n">salary</span><span class="p">)</span> <span class="k">values</span>
<span class="p">(</span><span class="mi">1205</span><span class="p">,</span><span class="s1">&#39;Harry&#39;</span><span class="p">,</span><span class="s1">&#39;Cover&#39;</span><span class="p">,</span><span class="s1">&#39;1982-10-07&#39;</span><span class="p">,</span><span class="s1">&#39;2010-09-21&#39;</span><span class="p">,</span><span class="s1">&#39;MANAGEMENT&#39;</span><span class="p">,</span><span class="mi">125000</span><span class="p">.</span><span class="mi">00</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">partemp</span> <span class="k">values</span>
<span class="p">(</span><span class="mi">1524</span><span class="p">,</span><span class="s1">&#39;Jim&#39;</span><span class="p">,</span><span class="s1">&#39;Beams&#39;</span><span class="p">,</span><span class="s1">&#39;1985-06-18&#39;</span><span class="p">,</span><span class="s1">&#39;2012-07-25&#39;</span><span class="p">,</span><span class="s1">&#39;SALES&#39;</span><span class="p">,</span><span class="mi">52000</span><span class="p">.</span><span class="mi">00</span><span class="p">,</span><span class="s1">&#39;chicago&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="mi">1431</span><span class="p">,</span><span class="s1">&#39;Johnny&#39;</span><span class="p">,</span><span class="s1">&#39;Walker&#39;</span><span class="p">,</span><span class="s1">&#39;1988-03-12&#39;</span><span class="p">,</span><span class="s1">&#39;2012-08-09&#39;</span><span class="p">,</span><span class="s1">&#39;RESEARCH&#39;</span><span class="p">,</span><span class="mi">46521</span><span class="p">.</span><span class="mi">87</span><span class="p">,</span><span class="s1">&#39;boston&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="mi">1864</span><span class="p">,</span><span class="s1">&#39;Jack&#39;</span><span class="p">,</span><span class="s1">&#39;Daniels&#39;</span><span class="p">,</span><span class="s1">&#39;1991-12-01&#39;</span><span class="p">,</span><span class="s1">&#39;2013-02-16&#39;</span><span class="p">,</span><span class="s1">&#39;DEVELOPMENT&#39;</span><span class="p">,</span><span class="mi">63540</span><span class="p">.</span><span class="mi">50</span><span class="p">,</span><span class="s1">&#39;atlanta&#39;</span><span class="p">);</span>
</pre><p>The value given for the city column (explicitly or by default) will be used by the partition engine to
decide in which partition to insert the rows. It will be ignored by CONNECT (a special column cannot
be given a value) but later will return the matching value. For instance:</p>
<pre class="fixed"><span class="k">select</span> <span class="n">city</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">job</span> <span class="k">from</span> <span class="n">partemp</span> <span class="k">where</span> <span class="n">id</span> <span class="k">in</span> <span class="p">(</span><span class="mi">1524</span><span class="p">,</span><span class="mi">1431</span><span class="p">);</span>
</pre><p>This query returns:</p>
<div class="cstm-style darkheader-nospace-borders"><table><tr><th>city</th><th>first_name</th><th>job</th></tr>
<tr><td>boston</td><td>Johnny</td><td>RESEARCH</td></tr>
<tr><td>chicago</td><td>Jim</td><td>SALES</td></tr>
</table>
<p><span class="cstm-style"></span>
Everything works as if the city column was a real column contained in the table data files.</p>
<h4 class="anchored_heading" id="partitioning-of-zipped-tables">Partitioning of zipped tables</h4>
<p>Two cases are currently supported:</p>
<p>If a table is based on several zipped files, portioning is done the standard way as above. This is the <em>file_name</em> option specifying the name of the zip files that shall contain the ‘%s’ part used to generate the file names.</p>
<p>If a table is based on only one zip file containing several entries, this will be indicated by placing the ‘%s’ part in the entry option value.</p>
<p>Note: If a table is based on several zipped files each containing several entries, only the first case is possible. Using sub-partitioning to make partitions on each entries is not supported yet. </p>
<h2 class="anchored_heading" id="table-partitioning">Table Partitioning</h2>
<p>With table partitioning, each partition is physically represented by a sub-table. Compared to standard
partitioning, this brings the following features:</p>
<ol><li>The partitions can be tables driven by different engines. This relieves the current existing
limitation of the partition engine.
</li><li>The partitions can be tables driven by engines not currently supporting partitioning.
</li><li>Partition tables can be located on remote servers, enabling table sharding.
</li><li>Like for TBL tables, the columns of the partition table do not necessarily match the columns
of the sub-tables.
</li></ol>
<p>The way it is done is to create the partition table with a table type referring to other tables, <a href="/kb/en/connect-table-types-proxy-table-type/">PROXY</a>,
<a href="/kb/en/connect-table-types-mysql-table-type-accessing-mysqlmariadb-tables/">MYSQL</a> <a href="/kb/en/connect-table-types-odbc-table-type-accessing-tables-from-other-dbms/">ODBC</a> or <a href="/kb/en/connect-jdbc-table-type-accessing-tables-from-other-dbms/">JDBC</a>. Let us see how this is done on a simple example. Supposing we have created the
following tables:</p>
<pre class="fixed"><span class="k">create</span> <span class="k">table</span> <span class="nf">xt1</span> <span class="p">(</span>
<span class="n">id</span> <span class="kt">int</span> <span class="k">not</span> <span class="no">null</span><span class="p">,</span>
<span class="n">msg</span> <span class="kt">varchar</span><span class="p">(</span><span class="mi">32</span><span class="p">))</span>
<span class="kp">engine</span><span class="o">=</span><span class="n">myisam</span><span class="p">;</span>

<span class="k">create</span> <span class="k">table</span> <span class="nf">xt2</span> <span class="p">(</span>
<span class="n">id</span> <span class="kt">int</span> <span class="k">not</span> <span class="no">null</span><span class="p">,</span>
<span class="n">msg</span> <span class="kt">varchar</span><span class="p">(</span><span class="mi">32</span><span class="p">));</span> <span class="cm">/* engine=innoDB */</span>

<span class="k">create</span> <span class="k">table</span> <span class="nf">xt3</span> <span class="p">(</span>
<span class="n">id</span> <span class="kt">int</span> <span class="k">not</span> <span class="no">null</span><span class="p">,</span>
<span class="n">msg</span> <span class="kt">varchar</span><span class="p">(</span><span class="mi">32</span><span class="p">))</span>
<span class="kp">engine</span><span class="o">=</span><span class="n">connect</span> <span class="n">table_type</span><span class="o">=</span><span class="n">CSV</span><span class="p">;</span>
</pre><p>We can for instance create a partition table using these tables as physical partitions by:</p>
<pre class="fixed"><span class="k">create</span> <span class="k">table</span> <span class="nf">t3</span> <span class="p">(</span>
<span class="n">id</span> <span class="kt">int</span> <span class="k">not</span> <span class="no">null</span><span class="p">,</span>
<span class="n">msg</span> <span class="kt">varchar</span><span class="p">(</span><span class="mi">32</span><span class="p">))</span>
<span class="kp">engine</span><span class="o">=</span><span class="n">connect</span> <span class="n">table_type</span><span class="o">=</span><span class="n">PROXY</span> <span class="n">tabname</span><span class="o">=</span><span class="s1">&#39;xt%s&#39;</span>
<span class="n">partition</span> <span class="k">by</span> <span class="n">range</span> <span class="nf">columns</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="p">(</span>
<span class="n">partition</span> <span class="ss">`1`</span> <span class="k">values</span> <span class="n">less</span> <span class="nf">than</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
<span class="n">partition</span> <span class="ss">`2`</span> <span class="k">values</span> <span class="n">less</span> <span class="nf">than</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
<span class="n">partition</span> <span class="ss">`3`</span> <span class="k">values</span> <span class="n">less</span> <span class="nf">than</span><span class="p">(</span><span class="n">MAXVALUE</span><span class="p">));</span>
</pre><p>Here the name of each partition sub-table will be made by replacing the ‘%s’ part of the tabname
option value by the partition name. Now if we do:</p>
<pre class="fixed"><span class="k">insert</span> <span class="k">into</span> <span class="n">t3</span> <span class="k">values</span>
<span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;four&#39;</span><span class="p">),(</span><span class="mi">7</span><span class="p">,</span><span class="s1">&#39;seven&#39;</span><span class="p">),(</span><span class="mi">10</span><span class="p">,</span><span class="s1">&#39;ten&#39;</span><span class="p">),(</span><span class="mi">40</span><span class="p">,</span><span class="s1">&#39;forty&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="mi">60</span><span class="p">,</span><span class="s1">&#39;sixty&#39;</span><span class="p">),(</span><span class="mi">81</span><span class="p">,</span><span class="s1">&#39;eighty one&#39;</span><span class="p">),(</span><span class="mi">72</span><span class="p">,</span><span class="s1">&#39;seventy two&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="s1">&#39;eleven&#39;</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;one&#39;</span><span class="p">),(</span><span class="mi">35</span><span class="p">,</span><span class="s1">&#39;thirty five&#39;</span><span class="p">),(</span><span class="mi">8</span><span class="p">,</span><span class="s1">&#39;eight&#39;</span><span class="p">);</span>
</pre><p>The rows will be distributed in the different sub-tables according to the partition function. This can be
seen by executing the query:</p>
<pre class="fixed"><span class="k">select</span> <span class="n">partition_name</span><span class="p">,</span> <span class="n">table_rows</span> <span class="k">from</span>
<span class="n">information_schema</span><span class="p">.</span><span class="n">partitions</span> <span class="k">where</span> <span class="n">table_name</span> <span class="o">=</span> <span class="s1">&#39;t3&#39;</span><span class="p">;</span>
</pre><p>This query replies:
<span class="cstm-style darkheader-nospace-borders"></span></p>
<table><tr><th>partition_name</th><th>table_rows</th></tr>
<tr><td>1</td><td>4</td></tr>
<tr><td>2</td><td>4</td></tr>
<tr><td>3</td><td>3</td></tr>
</table>
</div><p>Query pruning is of course automatic, for instance:</p>
<pre class="fixed"><span class="k">explain</span> <span class="n">partitions</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">t3</span> <span class="k">where</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">81</span><span class="p">;</span>
</pre><p>This query replies:</p>
<div class="cstm-style darkheader-nospace-borders"><table><tr><th>id</th><th>select_type</th><th>table</th><th>partitions</th><th>type</th><th>possible_keys</th><th>key</th><th>key_len</th><th>ref</th><th>rows</th><th>Extra</th></tr>
<tr><td>1</td><td>SIMPLE</td><td>part5</td><td>3</td><td>ALL</td><td>&lt;null&gt;</td><td>&lt;null&gt;</td><td>&lt;null&gt;</td><td>&lt;null&gt;</td><td>22</td><td>Using where</td></tr>
</table>
</div><p>When executing this select query, only sub-table xt3 will be used.</p>
<h3 class="anchored_heading" id="indexing-with-table-partitioning">Indexing with Table Partitioning</h3>
<p>Using the <a href="/kb/en/connect-table-types-proxy-table-type/">PROXY</a> table type seems natural. However, in this current version, the issue is that PROXY
(and <a href="/kb/en/connect-table-types-odbc-table-type-accessing-tables-from-other-dbms/">ODBC</a>) tables are not indexable. This is why, if you want the table to be indexed, you must use
the <a href="/kb/en/connect-table-types-mysql-table-type-accessing-mysqlmariadb-tables/">MYSQL</a> table type. The CREATE TABLE statement will be almost the same:</p>
<pre class="fixed"><span class="k">create</span> <span class="k">table</span> <span class="nf">t4</span> <span class="p">(</span>
<span class="n">id</span> <span class="kt">int</span> <span class="k">key</span> <span class="k">not</span> <span class="no">null</span><span class="p">,</span>
<span class="n">msg</span> <span class="kt">varchar</span><span class="p">(</span><span class="mi">32</span><span class="p">))</span>
<span class="kp">engine</span><span class="o">=</span><span class="n">connect</span> <span class="n">table_type</span><span class="o">=</span><span class="n">MYSQL</span> <span class="n">tabname</span><span class="o">=</span><span class="s1">&#39;xt%s&#39;</span>
<span class="n">partition</span> <span class="k">by</span> <span class="n">range</span> <span class="nf">columns</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="p">(</span>
<span class="n">partition</span> <span class="ss">`1`</span> <span class="k">values</span> <span class="n">less</span> <span class="nf">than</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
<span class="n">partition</span> <span class="ss">`2`</span> <span class="k">values</span> <span class="n">less</span> <span class="nf">than</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
<span class="n">partition</span> <span class="ss">`3`</span> <span class="k">values</span> <span class="n">less</span> <span class="nf">than</span><span class="p">(</span><span class="n">MAXVALUE</span><span class="p">));</span>
</pre><p>The column <em>id</em> is declared as a key, and the table type is now MYSQL. This makes Sub-tables accessed by calling a MariaDB server as MYSQL tables do. Note that this modifies only the way
CONNECT sub-tables are accessed.</p>
<p>However, indexing just make the partitioned table use “remote indexing” the way FEDERATED
tables do. This means that when sending the query to retrieve the table data, a where clause will be
added to the query. For instance, let’s suppose you ask:</p>
<pre class="fixed"><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">t4</span> <span class="k">where</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
</pre><p>The query sent to the server will be:</p>
<pre class="fixed"><span class="k">SELECT</span> <span class="ss">`id`</span><span class="p">,</span> <span class="ss">`msg`</span> <span class="k">FROM</span> <span class="ss">`xt1`</span> <span class="k">WHERE</span> <span class="ss">`id`</span> <span class="o">=</span> <span class="mi">7</span>
</pre><p>On a query like this one, it does not change much because the where clause could have been added
anyway by the cond_push function, but it does make a difference in case of joins. The main thing to
understand is that real indexing is done by the called table and therefore that it should be indexed.</p>
<p>This also means that the xt1, xt2, and xt3 table indexes should be made separately because creating the
t2 table as indexed does not make the indexes on the sub-tables.</p>
<h3 class="anchored_heading" id="sharding-with-table-partitioning">Sharding with Table Partitioning</h3>
<p>Using table partitioning can have one more advantage. Because the sub-tables can address a table
located on another server, it is possible to shard a table on separate servers and hardware machines.
This may be required to access as one table data already located on several remote machines, such as
servers of a company branches. Or it can be just used to split a huge table for performance reason.
For instance, supposing we have created the following tables:</p>
<pre class="fixed"><span class="k">create</span> <span class="k">table</span> <span class="nf">rt1</span> <span class="p">(</span><span class="n">id</span> <span class="kt">int</span> <span class="k">key</span> <span class="k">not</span> <span class="no">null</span><span class="p">,</span> <span class="n">msg</span> <span class="kt">varchar</span><span class="p">(</span><span class="mi">32</span><span class="p">))</span>
<span class="kp">engine</span><span class="o">=</span><span class="n">federated</span> <span class="n">connection</span><span class="o">=</span><span class="s1">&#39;mysql://root@host1/test/sales&#39;</span><span class="p">;</span>

<span class="k">create</span> <span class="k">table</span> <span class="nf">rt2</span> <span class="p">(</span><span class="n">id</span> <span class="kt">int</span> <span class="k">key</span> <span class="k">not</span> <span class="no">null</span><span class="p">,</span> <span class="n">msg</span> <span class="kt">varchar</span><span class="p">(</span><span class="mi">32</span><span class="p">))</span>
<span class="kp">engine</span><span class="o">=</span><span class="n">federated</span> <span class="n">connection</span><span class="o">=</span><span class="s1">&#39;mysql://root@host2/test/sales&#39;</span><span class="p">;</span>

<span class="k">create</span> <span class="k">table</span> <span class="nf">rt3</span> <span class="p">(</span><span class="n">id</span> <span class="kt">int</span> <span class="k">key</span> <span class="k">not</span> <span class="no">null</span><span class="p">,</span> <span class="n">msg</span> <span class="kt">varchar</span><span class="p">(</span><span class="mi">32</span><span class="p">))</span>
<span class="kp">engine</span><span class="o">=</span><span class="n">federated</span> <span class="n">connection</span><span class="o">=</span><span class="s1">&#39;mysql://root@host3/test/sales&#39;</span><span class="p">;</span>
</pre><p>Creating the partition table accessing all these will be almost like what we did with the t4 table:</p>
<pre class="fixed"><span class="k">create</span> <span class="k">table</span> <span class="nf">t5</span> <span class="p">(</span>
<span class="n">id</span> <span class="kt">int</span> <span class="k">key</span> <span class="k">not</span> <span class="no">null</span><span class="p">,</span>
<span class="n">msg</span> <span class="kt">varchar</span><span class="p">(</span><span class="mi">32</span><span class="p">))</span>
<span class="kp">engine</span><span class="o">=</span><span class="n">connect</span> <span class="n">table_type</span><span class="o">=</span><span class="n">MYSQL</span> <span class="n">tabname</span><span class="o">=</span><span class="s1">&#39;rt%s&#39;</span>
<span class="n">partition</span> <span class="k">by</span> <span class="n">range</span> <span class="nf">columns</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="p">(</span>
<span class="n">partition</span> <span class="ss">`1`</span> <span class="k">values</span> <span class="n">less</span> <span class="nf">than</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
<span class="n">partition</span> <span class="ss">`2`</span> <span class="k">values</span> <span class="n">less</span> <span class="nf">than</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
<span class="n">partition</span> <span class="ss">`3`</span> <span class="k">values</span> <span class="n">less</span> <span class="nf">than</span><span class="p">(</span><span class="n">MAXVALUE</span><span class="p">));</span>
</pre><p>.</p>
<p>The only difference is the tabname option now referring to the rt1, rt2, and rt3 tables. However, even if
it works, this is not the best way to do it. This is because accessing a table via the MySQL API is done
twice per table. Once by CONNECT to access the FEDERATED table on the local server, then a
second time by FEDERATED engine to access the remote table.</p>
<p>The CONNECT MYSQL table type being used anyway, you’d rather use it to directly access the
remote tables. Indeed, the partition names can also be used to modify the connection URL’s. For
instance, in the case shown above, the partition table can be created as:</p>
<pre class="fixed"><span class="k">create</span> <span class="k">table</span> <span class="nf">t6</span> <span class="p">(</span>
<span class="n">id</span> <span class="kt">int</span> <span class="k">key</span> <span class="k">not</span> <span class="no">null</span><span class="p">,</span>
<span class="n">msg</span> <span class="kt">varchar</span><span class="p">(</span><span class="mi">32</span><span class="p">))</span>
<span class="kp">engine</span><span class="o">=</span><span class="n">connect</span> <span class="n">table_type</span><span class="o">=</span><span class="n">MYSQL</span>
<span class="n">option_list</span><span class="o">=</span><span class="s1">&#39;connect=mysql://root@host%s/test/sales&#39;</span>
<span class="n">partition</span> <span class="k">by</span> <span class="n">range</span> <span class="nf">columns</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="p">(</span>
<span class="n">partition</span> <span class="ss">`1`</span> <span class="k">values</span> <span class="n">less</span> <span class="nf">than</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
<span class="n">partition</span> <span class="ss">`2`</span> <span class="k">values</span> <span class="n">less</span> <span class="nf">than</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
<span class="n">partition</span> <span class="ss">`3`</span> <span class="k">values</span> <span class="n">less</span> <span class="nf">than</span><span class="p">(</span><span class="n">MAXVALUE</span><span class="p">));</span>
</pre><p>Several things can be noted here:</p>
<ol><li>As we have seen before, the partition engine currently loses the connection string. This is why
it was specified as “connect” in the option list.
</li><li>For each partition sub-tables, the “%s” part of the connection string has been replaced by the
partition name.
</li><li>It is not needed anymore to define the rt1, rt2, and rt3 tables (even it does not harm) and the
FEDERATED engine is no more used to access the remote tables.
</li></ol>
<p>This is a simple case where the connection string is almost the same for all the sub-tables. But what if
the sub-tables are accessed by very different connection strings? For instance:</p>
<pre class="fixed">For rt1: connection='mysql://root:<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="e99d8087868786a9d8dbdec7d9c7d9c7d8">[email&#160;protected]</a>:3307/test/xt1'
For rt2: connection='mysql://foo:foopass@denver/dbemp/xt2'
For rt3: connection='mysql://root@huston :5505/test/tabx'
</pre><p>There are two solutions. The first one is to use the parts of the connection string to differentiate as
partition names:</p>
<pre class="fixed"><span class="k">create</span> <span class="k">table</span> <span class="nf">t7</span> <span class="p">(</span>
<span class="n">id</span> <span class="kt">int</span> <span class="k">key</span> <span class="k">not</span> <span class="no">null</span><span class="p">,</span>
<span class="n">msg</span> <span class="kt">varchar</span><span class="p">(</span><span class="mi">32</span><span class="p">))</span>
<span class="kp">engine</span><span class="o">=</span><span class="n">connect</span> <span class="n">table_type</span><span class="o">=</span><span class="n">MYSQL</span>
<span class="n">option_list</span><span class="o">=</span><span class="s1">&#39;connect=mysql://%s&#39;</span>
<span class="n">partition</span> <span class="k">by</span> <span class="n">range</span> <span class="nf">columns</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="p">(</span>
<span class="n">partition</span> <span class="ss">`root:<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="681c010607060728595a5f465846584659">[email&#160;protected]</a>:3307/test/xt1`</span> <span class="k">values</span> <span class="n">less</span> <span class="nf">than</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
<span class="n">partition</span> <span class="ss">`foo:foopass@denver/dbemp/xt2`</span> <span class="k">values</span> <span class="n">less</span> <span class="nf">than</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
<span class="n">partition</span> <span class="ss">`root@huston :5505/test/tabx`</span> <span class="k">values</span> <span class="n">less</span> <span class="nf">than</span><span class="p">(</span><span class="n">MAXVALUE</span><span class="p">));</span>
</pre><p>The second one, allowing avoiding too complicated partition names, is to create federated servers to
access the remote tables (if they do not already exist, else just use them). For instance the first one
could be:</p>
<pre class="fixed"><span class="k">create</span> <span class="n">server</span> <span class="ss">`server_one`</span> <span class="k">foreign</span> <span class="n">data</span> <span class="n">wrapper</span> <span class="s1">&#39;mysql&#39;</span>
<span class="nf">options</span>
<span class="p">(</span><span class="n">host</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span>
<span class="k">database</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
<span class="n">user</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span>
<span class="n">password</span> <span class="s1">&#39;tinono&#39;</span><span class="p">,</span>
<span class="n">port</span> <span class="mi">3307</span><span class="p">);</span>
</pre><p>Similarly, “server_two” and “server_three” would be created and the final partition table would be
created as:</p>
<pre class="fixed"><span class="k">create</span> <span class="k">table</span> <span class="nf">t8</span> <span class="p">(</span>
<span class="n">id</span> <span class="kt">int</span> <span class="k">key</span> <span class="k">not</span> <span class="no">null</span><span class="p">,</span>
<span class="n">msg</span> <span class="kt">varchar</span><span class="p">(</span><span class="mi">32</span><span class="p">))</span>
<span class="kp">engine</span><span class="o">=</span><span class="n">connect</span> <span class="n">table_type</span><span class="o">=</span><span class="n">MYSQL</span>
<span class="n">option_list</span><span class="o">=</span><span class="s1">&#39;connect=server_%s&#39;</span>
<span class="n">partition</span> <span class="k">by</span> <span class="n">range</span> <span class="nf">columns</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="p">(</span>
<span class="n">partition</span> <span class="ss">`one/xt1`</span> <span class="k">values</span> <span class="n">less</span> <span class="nf">than</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
<span class="n">partition</span> <span class="ss">`two/xt2`</span> <span class="k">values</span> <span class="n">less</span> <span class="nf">than</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
<span class="n">partition</span> <span class="ss">`three/tabx`</span> <span class="k">values</span> <span class="n">less</span> <span class="nf">than</span><span class="p">(</span><span class="n">MAXVALUE</span><span class="p">));</span>
</pre><p>It would be even simpler if all remote tables had the same name on the remote databases, for instance if
they all were named xt1, the connection string could be set as “server_%s/xt1” and the partition names
would be just “one”, “two”, and “three”.</p>
<h4 class="anchored_heading" id="sharding-on-a-special-column">Sharding on a Special Column</h4>
<p>The technique we have seen above with file partitioning is also available with table partitioning.
Companies willing to use as one table data sharded on the company branch servers can, as we have
seen, add to the table create definition a special column. For instance:</p>
<pre class="fixed"><span class="k">create</span> <span class="k">table</span> <span class="nf">t9</span> <span class="p">(</span>
<span class="n">id</span> <span class="kt">int</span> <span class="k">not</span> <span class="no">null</span><span class="p">,</span>
<span class="n">msg</span> <span class="kt">varchar</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span>
<span class="n">branch</span> <span class="kt">char</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span> <span class="k">default</span> <span class="s1">&#39;main&#39;</span> <span class="n">special</span><span class="o">=</span><span class="n">PARTID</span><span class="p">,</span>
<span class="k">index</span> <span class="nf">XID</span><span class="p">(</span><span class="n">id</span><span class="p">))</span>
<span class="kp">engine</span><span class="o">=</span><span class="n">connect</span> <span class="n">table_type</span><span class="o">=</span><span class="n">MYSQL</span>
<span class="n">option_list</span><span class="o">=</span><span class="s1">&#39;connect=server_%s/sales&#39;</span>
<span class="n">partition</span> <span class="k">by</span> <span class="n">range</span> <span class="nf">columns</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="p">(</span>
<span class="n">partition</span> <span class="ss">`main`</span> <span class="k">values</span> <span class="k">in</span><span class="p">(</span><span class="s1">&#39;main&#39;</span><span class="p">),</span>
<span class="n">partition</span> <span class="ss">`east`</span> <span class="k">values</span> <span class="k">in</span><span class="p">(</span><span class="s1">&#39;east&#39;</span><span class="p">),</span>
<span class="n">partition</span> <span class="ss">`west`</span> <span class="k">values</span> <span class="k">in</span><span class="p">(</span><span class="s1">&#39;west&#39;</span><span class="p">));</span>
</pre><p>This example assumes that federated servers had been created named “server_main”, “server_east” and
“server_west” and that all remote tables are named “sales”. Note also that in this example, the column
id is no more a key.</p>
<h2 class="anchored_heading" id="current-partition-limitations">Current Partition Limitations</h2>
<p>Because the partition engine was written before some other engines were added to MariaDB, the way it
works is sometime incompatible with these engines, in particular with CONNECT.</p>
<h3 class="anchored_heading" id="update-statement">Update statement</h3>
<p>With the sample tables above, you can do update statements such as:</p>
<pre class="fixed"><span class="k">update</span> <span class="n">t2</span> <span class="kt">set</span> <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;quatre&#39;</span> <span class="k">where</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
</pre><p>It works perfectly and is accepted by CONNECT. However, let us consider the statement:</p>
<pre class="fixed"><span class="k">update</span> <span class="n">t2</span> <span class="kt">set</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">41</span> <span class="k">where</span> <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;four&#39;</span><span class="p">;</span>
</pre><p>This statement is not accepted by CONNECT. The reason is that the column id being part of the
partition function, changing its value may require the modified row to be moved to another partition.
The way it is done by the partition engine is to delete the old row and to re-insert the new modified
one. However, this is done in a way that is not currently compatible with CONNECT (remember that
CONNECT supports UPDATE in a specific way, in particular for the table type MYSQL)
This limitation could be temporary. Meanwhile the workaround is to manually do what is done above,</p>
<p>Deleting the row to modify and inserting the modified row:</p>
<pre class="fixed"><span class="k">delete</span> <span class="k">from</span> <span class="n">t2</span> <span class="k">where</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">t2</span> <span class="k">values</span><span class="p">(</span><span class="mi">41</span><span class="p">,</span> <span class="s1">&#39;four&#39;</span><span class="p">);</span>
</pre><h3 class="anchored_heading" id="alter-table-statement">Alter Table statement</h3>
<p>For all CONNECT outward tables, the ALTER TABLE statement does not make any change in the table
data. This is why ALTER TABLE should not be used; in particular to modify the partition definition,
except of course to correct a wrong definition. Note that using ALTER TABLE to create a partition table
in two steps because column options would be lost is valid as it applies to a table that is not yet
partitioned.</p>
<p>As we have seen, it is also safe to use it to create or drop indexes. Otherwise, a simple rule of thumb is
to avoid altering a table definition and better drop and re-create a table whose definition must be
modified. Just remember that for outward CONNECT tables, dropping a table does not erase the data
and that creating it does not modify existing data.</p>
<h3 class="anchored_heading" id="rowid-special-column">Rowid special column</h3>
<p>Each partition being handled separately as one table, the ROWID special column returns the rank of the
row in its partition, not in the whole table. This means that for partition tables ROWID and ROWNUM are
equivalent.</p>

    </div>


        
            <div id="subscribe" class="well well-small hide hidden-print"
                 data-subscribe-url="/kb/en/using-connect-partitioning-and-sharding/+subscriptions/add"
                 data-unsubscribe-url="/kb/en/using-connect-partitioning-and-sharding/+subscriptions/remove">
            </div>
        

        
        
    
        <div class="simple_section_nav">
            <ul class="nav nav-pills">
                
                    <li><a href="/kb/en/using-connect-offline-documentation/">
                        ← USING CONNECT - Offline Documentation
                    </a>
                    </li>
                
                
                    <li><a href="/kb/en/using-connect/">
                        ↑ Using CONNECT ↑
                    </a>
                    </li>
                
                
            </ul>
        </div>
    

        

        
        <h2>Comments</h2>
        
    
    <div id="comments" data-node-id="4610" data-comments-url="/kb/en/using-connect-partitioning-and-sharding/+comments"
         data-reply-url="/kb/en/using-connect-partitioning-and-sharding/comments/post/">
        Comments loading...
    </div>

        

    </div>


                    <div id="content_disclaimer" class="graybox">
                        Content reproduced on this site is the property of its respective owners,
                        and this content is not reviewed in advance by MariaDB. The views, information and opinions
                        expressed by this content do not necessarily represent those of MariaDB or any other party.
                    </div>
                </div>
            </section>

            
                <div id="right_bar" class="col-md-2">
                    
    
        
        <ul class="section_navigation well well-small hidden-xs hidden-sm">
            
                <li class="parent"><a href="/kb/en/using-connect/">
                    ↑ Using CONNECT ↑
                </a>
                </li>
            
            
                
                    <li>
                        <a href="/kb/en/using-connect-general-information/">
                            
                            Using CONNECT - General Information
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/using-connect-virtual-and-special-columns/">
                            
                            Using CONNECT - Virtual and Special Columns
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/using-connect-importing-file-data-into-mariadb-tables/">
                            
                            Using CONNECT - Importing File Data Into MariaDB Tables
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/using-connect-exporting-data-from-mariadb/">
                            
                            Using CONNECT - Exporting Data From MariaDB
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/using-connect-indexing/">
                            
                            Using CONNECT - Indexing
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/using-connect-condition-pushdown/">
                            
                            Using CONNECT - Condition Pushdown
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/using-connect-offline-documentation/">
                            
                            USING CONNECT - Offline Documentation
                        </a>
                    </li>
                
            
                
                    <li class="active">
                        <span>Using CONNECT - Partitioning and Sharding</span>
                        
                    </li>
                
            
        </ul>
    
    

                </div>
            
        </div>
    </div>
</div>

<!-- Footer -->
<footer id="footer">
    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-xs-12">
                    <ul class="list-inline text-center footer-nav">
                        <li>
                            <h5>
                                <a href="https://mariadb.com/products" title="Products">Products</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/services" title="Services">Services</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/pricing" title="Pricing">Pricing</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/resources" title="Resources">Resources</a>
                            </h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/about-us" title="About MariaDB">About Us</a></h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/download" title="Download">Download MariaDB</a></h5>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="row row-10">
                
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div id="block-footerformcontact" class="block block-block-content block-block-contentd754ee1b-3cc9-40e7-9ef4-f504f1197fb1">
                        
                            <h5 style="font-weight: 400;">Subscribe to our newsletter!</h5>
                            <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script src="//app-sj15.marketo.com/js/forms2/js/forms2.min.js"></script><form id="mktoForm_1498"></form>
                            <script>
                                <!--//--><![CDATA[// ><!--
                                MktoForms2.loadForm("//app-sj15.marketo.com", "573-PXI-984", 1498);
                                //--><!]]]]><![CDATA[>
                                //--><!]]>
                            </script>
                        
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div class="footer-copyright">
                        <div class="text-center">
                            <ul class="list-inline no-margin">
                                <li>
                                    <a href="/legal" title="Legal">Legal</a>
                                </li>
                                <li>
                                    <a href="/privacy-policy" title="Privacy Policy">Privacy Policy</a>
                                </li>
                                <li>
                                    <a href="/cookie-policy/" title="Cookies">Cookie Policy</a>
                                </li>
                            </ul>
                            <p>Copyright &copy; 2025 MariaDB. All rights reserved.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</footer>
</div>

<div id="ajax_loading">
    <img src="/kb/static/images/ajax-loader.a51c5608d01a.gif" />
</div>

    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MK2847"
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MK2847');</script>
    <!-- End Google Tag Manager -->

</body>

<script type="text/javascript" src="/kb/static/js/main.1587e3a666fc.js" charset="utf-8"></script>

</html>