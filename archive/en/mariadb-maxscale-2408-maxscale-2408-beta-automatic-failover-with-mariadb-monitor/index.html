<!DOCTYPE html>
<html>
<head data-cookie-domain=""
      data-cookie-path="/">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="apple-touch-icon" sizes="180x180" href="/kb/static/images/favicons/apple-touch-icon.159e713979be.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/kb/static/images/favicons/favicon-32x32.bc0ac1d5d11e.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/kb/static/images/favicons/favicon-16x16.5801f8f0f34e.png">
    <link rel="shortcut icon" href="/kb/static/images/favicons/favicon.d122d305dee4.ico" type="image/x-icon" />

    <title>MaxScale 24.08 Beta  Automatic Failover With MariaDB Monitor - MariaDB Knowledge Base</title>

    <link href="/kb/static/css/main.f7633538c846.css" rel="stylesheet" type="text/css" />

    

    

    <!-- FB Open Graph tags -->
    <meta property="og:title" content="MaxScale 24.08 Beta  Automatic Failover With MariaDB Monitor" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://mariadb.com/kb/en/mariadb-maxscale-2408-maxscale-2408-beta-automatic-failover-with-mariadb-monitor/" />
    <meta property="og:image" content="http://mariadb.comaskmonty-logo.png" />
    <meta property="og:site_name" content="MariaDB KnowledgeBase" />
    <meta property="fb:admins" content="514852603" />
    <meta property="og:description" content="Automatic Failover With MariaDB Monitor
The MariaDB Monitor is not only capable
of monitoring the state of a MariaDB primary-replica cluster but is also
capable of performing ..." />

    <meta name="description" content="Automatic Failover With MariaDB Monitor
The MariaDB Monitor is not only capable
of monitoring the state of a MariaDB primary-replica cluster but is also
capable of performing ..." />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet"/>
    
</head>
<body class="mpkb nodes products nodes_view jqui" id="nodes_view">





<div id="menu-mobile" class="visible-sm visible-xs">

    <div>
        <div id="mobile-close-menu" class="text-right">
            <a href="javascript:void(0)" title="Close Menu" id="back-main" class="toggle-menu">X<span></span></a>
        </div>
    </div>
    <div class="mainmenu-mobile">
        <ul class="ls-none ul-menu">
            <li data-sub="submenu5"><a class="open-form-search" href="/kb/search/" title="Search">Search </a></li>
            <li data-sub="submenu0"><a href="/products" title="Products">Products</a><span class="arrow-main"></span></li>
            <li data-sub="submenu1"><a href="/services" title="Services">Services</a><span class="arrow-main"></span></li>
            <li data-sub="submenu2"><a href="/resources" title="Resources">Resources</a><span class="arrow-main"></span></li>
            <li data-sub="submenu3"><a href="/about-us" title="About">About</a><span class="arrow-main"></span></li>
            <li data-sub="submenu4"><a href="/contact" title="Contact">Contact</a></li>
        </ul>
    </div>

    <div class="nav-top-mobile">
        <div class="select-box form">

            <ul class="inline-block-md mb-none top-nav">
                <li>

                </li>
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/mariadb-maxscale-2408-maxscale-2408-beta-automatic-failover-with-mariadb-monitor/"> Login</a>
                    </li>
                
            </ul>



        </div>
        <p class="text-center copyright">Copyright &copy; 2024 MariaDB. All rights reserved.</p>
    </div>
</div>
<div class="violator-wrap d-none" id="top_violator">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12">
                <div class="violator-outer">
                    <div class="violator-inner">
                        <div class="row">
                            <div class="col-xs-12 col-sm-9 col-lg-7 col-lg-offset-2" id="top_violator_content">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="content-link" target="_blank" rel="nofollow noreferrer">
                                    <span>The Ultimate Guide to High Availability with MariaDB</span>
                                </a>
                            </div>
                            <div class="col-xs-12 col-sm-3" id="top_violator_cta">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="btn btn-mariadb" target="_blank" rel="nofollow noreferrer">Download Now</a>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-link close-btn">
                        <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24" width="15px" height="15px"><path d="M 4.9902344 3.9902344 A 1.0001 1.0001 0 0 0 4.2929688 5.7070312 L 10.585938 12 L 4.2929688 18.292969 A 1.0001 1.0001 0 1 0 5.7070312 19.707031 L 12 13.414062 L 18.292969 19.707031 A 1.0001 1.0001 0 1 0 19.707031 18.292969 L 13.414062 12 L 19.707031 5.7070312 A 1.0001 1.0001 0 0 0 18.980469 3.9902344 A 1.0001 1.0001 0 0 0 18.292969 4.2929688 L 12 10.585938 L 5.7070312 4.2929688 A 1.0001 1.0001 0 0 0 4.9902344 3.9902344 z"/></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="wrapper">
<div id="top-nav">
    <div class="container">
        <ul class="hidden-sm hidden-xs" >
            <li><a href="https://mariadb.com/kb/">Knowledge Base</a></li>
            <li><a href="https://mariadb.com/contact/">Contact</a></li>
            
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/mariadb-maxscale-2408-maxscale-2408-beta-automatic-failover-with-mariadb-monitor/" rel="nofollow">Login</a>
                    </li>
                
            
            
            <li id="search-form">
                <form action="/kb/en/+search/" method="get" id="search-block-form" accept-charset="UTF-8">
                    <input id="search" title="Enter the terms you wish to search for."
                           placeholder="Search . . ." type="text"
                           name="q" value="" size="15" maxlength="128" class="form-text"
                           data-autocomplete-url="/kb/en/+search/autocomplete/">
                    <input type="hidden" name="quick" value="1" />
                    <input type="hidden" name="source" value="kb" />
                </form>
            </li>
            <li><a id="search-toggler" href="/kb/search/">Search</a></li>
            
        </ul>
    </div>
</div>
<div id="navbar-bottom" class="navbar">
    <div class="container">
        
        
        
        
        <div class="row">
            <div class="col-md-3 col-sm-9 col-xs-9">
                <a class="brand" href="/" title="MariaDB">
                    <img src="/kb/static/images/logo-2018-black.95f5978ae14d.png">
                </a>
            </div>
            <div class="col-md-9 hidden-sm hidden-xs">
                <div class="main-menu">
                    <ul id="main-menu" class="nav navbar-nav inline-block-sm">
    <li class="has-sub full-menu">
        <a href="/products" title="Products">Products</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/services" title="Services">Services</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/pricing" title="Pricing">Pricing</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/resources" title="Resources">Resources</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/about-us" title="About Us">About Us</a>
    </li>
    <li class="">
        <a class="button electric-eel small top-bar-right-download" href="/downloads/">Download</a>
    </li>
</ul>
                </div>
            </div>
            <div class="col-md-3 visible-sm visible-xs col-sm-3 col-xs-3 ps-rv">
                <div class="navbar-header text-right pull-right">
                    <button type="button" class="menu-control toggle-menu" id="open-menu">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="main">
    <div class="container">
        

        <div id="subheader1" class="clearfix">
            <div class="pull-left">
                
                <div id="breadcrumbs" class="breadcrumb">
                    <a href="/kb/en/">Knowledge Base</a>
                    


    
    » <a class="crumb" href="/kb/en/maxscale/">MariaDB MaxScale</a>
    

    
    » <a class="crumb" href="/kb/en/mariadb-maxscale-24-08-beta/">MariaDB MaxScale 24.08 Beta</a>
    

    
    » <a class="crumb" href="/kb/en/mariadb-maxscale-24-08-beta-tutorials/">MaxScale 24.08 Beta Tutorials</a>
    


    » <a class="node_link crumb" href="/kb/en/mariadb-maxscale-2408-maxscale-2408-beta-automatic-failover-with-mariadb-monitor/">MaxScale 24.08 Beta  Automatic Failover With MariaDB Monitor</a>


                </div>
                
            </div>
        </div>
    </div>
    <div class="container" id="container-main">
        <div class="row">
            
            
                
                <aside id="sidebar-first" class="sidebar col-md-2 hidden-xs hidden-sm hidden-print">
                    
                        
                        <ul id="category_menu" class="nav nav-pills nav-stacked">
                            <li><a href="/kb/en/">Home</a></li>
                            
                                
                                    <li><a href="/kb/en/+questions/">Open Questions</a></li>
                                
                                <li><a href="/kb/en/documentation/">MariaDB Server</a></li>
                                <li><a href="/kb/en/maxscale/">MariaDB MaxScale</a></li>
                                <li><a href="/kb/en/mariadb-columnstore/">MariaDB ColumnStore</a></li>
                                <li><a href="/kb/en/connectors/">Connectors</a></li>
                            

                        </ul>
                    

                    
<div>



<div class="well well-small box actions"><div>

        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/mariadb-maxscale-2408-maxscale-2408-beta-automatic-failover-with-mariadb-monitor/+history" rel="nofollow">History</a>
        
        
        
        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/mariadb-maxscale-2408-maxscale-2408-beta-automatic-failover-with-mariadb-monitor/+source/">Source</a>
        
        <a class="btn btn-block btn-blue btn-sm flag" href="/kb/en/mariadb-maxscale-2408-maxscale-2408-beta-automatic-failover-with-mariadb-monitor/+flag"
                data-flag-url="/kb/en/mariadb-maxscale-2408-maxscale-2408-beta-automatic-failover-with-mariadb-monitor/+flag" rel="nofollow">
                Flag as Spam / Inappropriate</a>
        
        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/mariadb-maxscale-2408-maxscale-2408-beta-automatic-failover-with-mariadb-monitor/+translate/">
                Translate</a>
        

</div>
</div>





<div class="well well-small box node_info"><div>

    <dl>
        <dt>Created</dt>
        <dd>

<span class="datetime" title="2024-08-29 22:08">3 months, 3 weeks ago</span></dd>

        <dt>Modified</dt>
        <dd>

<span class="datetime" title="2024-08-29 22:08">3 months, 3 weeks ago</span></dd>

        <dt>Type</dt>
        <dd>article</dd>

        <dt>Status</dt>
        <dd>active</dd>

        <dt>License</dt>
        <dd>
            
                <a href="/kb/en/mariadb-maxscale-2408-maxscale-2408-beta-automatic-failover-with-mariadb-monitor/+license/">CC BY-SA / Gnu FDL</a>
            
        </dd>

        
        <dt>Source</dt>
        <dd><a href="https://github.com/mariadb-corporation/MaxScale/blob/24.08.0/Documentation/Tutorials/MariaDB-Monitor-Failover.md">GitHub</a></dd>
        
    </dl>

    
    <ul class="rss_feeds">
        <li><a href="/kb/en/mariadb-maxscale-2408-maxscale-2408-beta-automatic-failover-with-mariadb-monitor/+history/feed/">
            History</a>
        </li>
        <li><a href="/kb/en/mariadb-maxscale-2408-maxscale-2408-beta-automatic-failover-with-mariadb-monitor/+comments/feed/">
            Comments</a>
        </li>
    </ul>
    

</div>
</div>





    
    
    

<div class="well well-small box attachments"><div><div class="edit_link pull-right"><a href="/kb/en/mariadb-maxscale-2408-maxscale-2408-beta-automatic-failover-with-mariadb-monitor/+edit/attachments/">Edit</a></div><h5>Attachments</h5></div><div>

        
            <div class="no_data">No attachments exist</div>
        
    
</div>
</div>

    



    
    






</div>


                    

































                </aside>
            
            
            
                
            
            
                
            
            <section id="content" class="limited_width col-md-8 clearfix">
                
                    <h1>MaxScale 24.08 Beta  Automatic Failover With MariaDB Monitor</h1>
                

                



                <div>
                    
    

    
    
    

    <div class="node creole">
        
        
        


    
    <div class="answer formatted">
        <h1 id="automatic-failover-with-mariadb-monitor">Automatic Failover With MariaDB Monitor</h1>
<p>The <a href="/kb/en/maxscale-24-08-beta-mariadb-monitor/">MariaDB Monitor</a> is not only capable
of monitoring the state of a MariaDB primary-replica cluster but is also
capable of performing <em>failover</em> and <em>switchover</em>. In addition, in some
circumstances it is capable of <em>rejoining</em> a primary that has gone down and
later reappears.</p>
<p>Note that the failover (and switchover and rejoin) functionality is only
supported in conjunction with GTID-based replication and initially only
for simple topologies, that is, 1 primary and several replicas.</p>
<p>The failover, switchover and rejoin functionality are inherent parts of
the <em>MariaDB Monitor</em>, but neither automatic failover nor automatic rejoin
are enabled by default.</p>
<p>The following examples have been written with the assumption that there
are four servers - <code>server1</code>, <code>server2</code>, <code>server3</code> and <code>server4</code> - of
which <code>server1</code> is the initial primary and the other servers are replicas.
In addition there is a monitor called <em>TheMonitor</em> that monitors those
servers.</p>
<p>Somewhat simplified, the MaxScale configuration file would look like:</p>
<div><pre><span></span>[server1]
type=server
address=192.168.121.51
port=3306
protocol=MariaDBBackend

[server2]
...

[server3]
...

[server4]
...

[TheMonitor]
type=monitor
module=mariadbmon
servers=server1,server2,server3,server4
...
</pre></div>


<h1 id="manual-failover">Manual Failover</h1>
<p>If everything is in order, the state of the cluster will look something
like this:</p>
<div><pre><span></span>$ maxctrl list servers
┌─────────┬─────────────────┬──────┬─────────────┬─────────────────┐
│ Server  │ Address         │ Port │ Connections │ State           │
├─────────┼─────────────────┼──────┼─────────────┼─────────────────┤
│ server1 │ 192.168.121.51  │ 3306 │ 0           │ Master, Running │
├─────────┼─────────────────┼──────┼─────────────┼─────────────────┤
│ server2 │ 192.168.121.190 │ 3306 │ 0           │ Slave, Running  │
├─────────┼─────────────────┼──────┼─────────────┼─────────────────┤
│ server3 │ 192.168.121.112 │ 3306 │ 0           │ Slave, Running  │
├─────────┼─────────────────┼──────┼─────────────┼─────────────────┤
│ server4 │ 192.168.121.201 │ 3306 │ 0           │ Slave, Running  │
└─────────┴─────────────────┴──────┴─────────────┴─────────────────┘
</pre></div>


<p>If the primary now for any reason goes down, then the cluster state will
look like this:</p>
<div><pre><span></span>$ maxctrl list servers
┌─────────┬─────────────────┬──────┬─────────────┬────────────────┐
│ Server  │ Address         │ Port │ Connections │ State          │
├─────────┼─────────────────┼──────┼─────────────┼────────────────┤
│ server1 │ 192.168.121.51  │ 3306 │ 0           │ Down           │
├─────────┼─────────────────┼──────┼─────────────┼────────────────┤
│ server2 │ 192.168.121.190 │ 3306 │ 0           │ Slave, Running │
├─────────┼─────────────────┼──────┼─────────────┼────────────────┤
│ server3 │ 192.168.121.112 │ 3306 │ 0           │ Slave, Running │
├─────────┼─────────────────┼──────┼─────────────┼────────────────┤
│ server4 │ 192.168.121.201 │ 3306 │ 0           │ Slave, Running │
└─────────┴─────────────────┴──────┴─────────────┴────────────────┘
</pre></div>


<p>Note that the status for <code>server1</code> is <em>Down</em>.</p>
<p>Since failover is by default <em>not</em> enabled, the failover mechanism must be
invoked manually:</p>
<div><pre><span></span>$ maxctrl call command mariadbmon failover TheMonitor
OK
</pre></div>


<p>There are quite a few arguments, so let's look at each one separately
<em> <code>call command</code> indicates that it is a module command that is to be
   invoked,
</em> <code>mariadbmon</code> indicates the module whose command we want to invoke (that
is the MariaDB Monitor),
<em> <code>failover</code> is the command we want to invoke, and
</em> <code>TheMonitor</code> is the first and only argument to that command, the name of
the monitor as specified in the configuration file.</p>
<p>The MariaDB Monitor will now autonomously deduce which replica is the most
appropriate one to be promoted to primary, promote it to primary and modify
the other replicas accordingly.</p>
<p>If we now check the cluster state we will see that one of the remaining
replicas has been made into primary.</p>
<div><pre><span></span>$ maxctrl list servers
┌─────────┬─────────────────┬──────┬─────────────┬─────────────────┐
│ Server  │ Address         │ Port │ Connections │ State           │
├─────────┼─────────────────┼──────┼─────────────┼─────────────────┤
│ server1 │ 192.168.121.51  │ 3306 │ 0           │ Down            │
├─────────┼─────────────────┼──────┼─────────────┼─────────────────┤
│ server2 │ 192.168.121.190 │ 3306 │ 0           │ Master, Running │
├─────────┼─────────────────┼──────┼─────────────┼─────────────────┤
│ server3 │ 192.168.121.112 │ 3306 │ 0           │ Slave, Running  │
├─────────┼─────────────────┼──────┼─────────────┼─────────────────┤
│ server4 │ 192.168.121.201 │ 3306 │ 0           │ Slave, Running  │
└─────────┴─────────────────┴──────┴─────────────┴─────────────────┘
</pre></div>


<p>If <code>server1</code> now reappears, it will not be rejoined to the cluster, as
shown by the following output:</p>
<div><pre><span></span>$ maxctrl list servers
┌─────────┬─────────────────┬──────┬─────────────┬─────────────────┐
│ Server  │ Address         │ Port │ Connections │ State           │
├─────────┼─────────────────┼──────┼─────────────┼─────────────────┤
│ server1 │ 192.168.121.51  │ 3306 │ 0           │ Running         │
├─────────┼─────────────────┼──────┼─────────────┼─────────────────┤
│ server2 │ 192.168.121.190 │ 3306 │ 0           │ Master, Running │
├─────────┼─────────────────┼──────┼─────────────┼─────────────────┤
│ server3 │ 192.168.121.112 │ 3306 │ 0           │ Slave, Running  │
├─────────┼─────────────────┼──────┼─────────────┼─────────────────┤
│ server4 │ 192.168.121.201 │ 3306 │ 0           │ Slave, Running  │
└─────────┴─────────────────┴──────┴─────────────┴─────────────────┘
</pre></div>


<p>Had <code>auto_rejoin=true</code> been specified in the monitor section, then an
attempt to rejoin <code>server1</code> would have been made.</p>
<p>In MaxScale 2.2.1, rejoining cannot be initiated manually, but in a
subsequent version a command to that effect will be provided.</p>
<h1 id="automatic-failover">Automatic Failover</h1>
<p>To enable automatic failover, simply add <code>auto_failover=true</code> to the
monitor section in the configuration file.</p>
<div><pre><span></span>[TheMonitor]
type=monitor
module=mariadbmon
servers=server1,server2,server3,server4
auto_failover=true
...
</pre></div>


<p>When everything is running fine, the cluster state looks like follows:</p>
<div><pre><span></span>$ maxctrl list servers
┌─────────┬─────────────────┬──────┬─────────────┬─────────────────┐
│ Server  │ Address         │ Port │ Connections │ State           │
├─────────┼─────────────────┼──────┼─────────────┼─────────────────┤
│ server1 │ 192.168.121.51  │ 3306 │ 0           │ Master, Running │
├─────────┼─────────────────┼──────┼─────────────┼─────────────────┤
│ server2 │ 192.168.121.190 │ 3306 │ 0           │ Slave, Running  │
├─────────┼─────────────────┼──────┼─────────────┼─────────────────┤
│ server3 │ 192.168.121.112 │ 3306 │ 0           │ Slave, Running  │
├─────────┼─────────────────┼──────┼─────────────┼─────────────────┤
│ server4 │ 192.168.121.201 │ 3306 │ 0           │ Slave, Running  │
└─────────┴─────────────────┴──────┴─────────────┴─────────────────┘
</pre></div>


<p>If <code>server1</code> now goes down, failover will automatically be performed and
an existing replica promoted to new primary.</p>
<div><pre><span></span>$ maxctrl list servers
┌─────────┬─────────────────┬──────┬─────────────┬────────────────────────┐
│ Server  │ Address         │ Port │ Connections │ State                  │
├─────────┼─────────────────┼──────┼─────────────┼────────────────────────┤
│ server1 │ 192.168.121.51  │ 3306 │ 0           │ Down                   │
├─────────┼─────────────────┼──────┼─────────────┼────────────────────────┤
│ server2 │ 192.168.121.190 │ 3306 │ 0           │ Master, Slave, Running │
├─────────┼─────────────────┼──────┼─────────────┼────────────────────────┤
│ server3 │ 192.168.121.112 │ 3306 │ 0           │ Slave, Running         │
├─────────┼─────────────────┼──────┼─────────────┼────────────────────────┤
│ server4 │ 192.168.121.201 │ 3306 │ 0           │ Slave, Running         │
└─────────┴─────────────────┴──────┴─────────────┴────────────────────────┘
</pre></div>


<p>If you are continuously monitoring the server states, you may notice for a
brief period that the state of <code>server1</code> is <em>Down</em> and the state of
<code>server2</code> is still <em>Slave, Running</em>.</p>
<h1 id="rejoin">Rejoin</h1>
<p>To enable automatic rejoin, simply add <code>auto_rejoin=true</code> to the
monitor section in the configuration file.</p>
<div><pre><span></span>[TheMonitor]
type=monitor
module=mariadbmon
servers=server1,server2,server3,server4
auto_rejoin=true
...
</pre></div>


<p>When automatic rejoin is enabled, the MariaDB Monitor will attempt to
rejoin a failed primary as a replica, if it reappears.</p>
<p>When everything is running fine, the cluster state looks like follows:</p>
<div><pre><span></span>$ maxctrl list servers
┌─────────┬─────────────────┬──────┬─────────────┬─────────────────┐
│ Server  │ Address         │ Port │ Connections │ State           │
├─────────┼─────────────────┼──────┼─────────────┼─────────────────┤
│ server1 │ 192.168.121.51  │ 3306 │ 0           │ Master, Running │
├─────────┼─────────────────┼──────┼─────────────┼─────────────────┤
│ server2 │ 192.168.121.190 │ 3306 │ 0           │ Slave, Running  │
├─────────┼─────────────────┼──────┼─────────────┼─────────────────┤
│ server3 │ 192.168.121.112 │ 3306 │ 0           │ Slave, Running  │
├─────────┼─────────────────┼──────┼─────────────┼─────────────────┤
│ server4 │ 192.168.121.201 │ 3306 │ 0           │ Slave, Running  │
└─────────┴─────────────────┴──────┴─────────────┴─────────────────┘
</pre></div>


<p>Assuming <code>auto_failover=true</code> has been specified in the configuration
file, when <code>server1</code> goes down for some reason, failover will be performed
and we end up with the following cluster state:</p>
<div><pre><span></span>$ maxctrl list servers
┌─────────┬─────────────────┬──────┬─────────────┬─────────────────┐
│ Server  │ Address         │ Port │ Connections │ State           │
├─────────┼─────────────────┼──────┼─────────────┼─────────────────┤
│ server1 │ 192.168.121.51  │ 3306 │ 0           │ Down            │
├─────────┼─────────────────┼──────┼─────────────┼─────────────────┤
│ server2 │ 192.168.121.190 │ 3306 │ 0           │ Master, Running │
├─────────┼─────────────────┼──────┼─────────────┼─────────────────┤
│ server3 │ 192.168.121.112 │ 3306 │ 0           │ Slave, Running  │
├─────────┼─────────────────┼──────┼─────────────┼─────────────────┤
│ server4 │ 192.168.121.201 │ 3306 │ 0           │ Slave, Running  │
└─────────┴─────────────────┴──────┴─────────────┴─────────────────┘
</pre></div>


<p>If <code>server1</code> now reappears, the MariaDB Monitor will detect that and
attempt to rejoin the old primary as a replica.</p>
<p>Whether rejoining will succeed depends upon the actual state of the old
primary. For instance, if the old primary was modified and the changes had
not been replicated to the new primary, before the old primary went down,
then automatic rejoin will not be possible.</p>
<p>If rejoining can be performed, then the cluster state will end up looking
like:</p>
<div><pre><span></span>$ maxctrl list servers
┌─────────┬─────────────────┬──────┬─────────────┬─────────────────┐
│ Server  │ Address         │ Port │ Connections │ State           │
├─────────┼─────────────────┼──────┼─────────────┼─────────────────┤
│ server1 │ 192.168.121.51  │ 3306 │ 0           │ Slave, Running  │
├─────────┼─────────────────┼──────┼─────────────┼─────────────────┤
│ server2 │ 192.168.121.190 │ 3306 │ 0           │ Master, Running │
├─────────┼─────────────────┼──────┼─────────────┼─────────────────┤
│ server3 │ 192.168.121.112 │ 3306 │ 0           │ Slave, Running  │
├─────────┼─────────────────┼──────┼─────────────┼─────────────────┤
│ server4 │ 192.168.121.201 │ 3306 │ 0           │ Slave, Running  │
└─────────┴─────────────────┴──────┴─────────────┴─────────────────┘
</pre></div>


<h1 id="switchover">Switchover</h1>
<p>Switchover is for cases when you explicitly want to move the primary
role from one server to another.</p>
<p>If we continue from the cluster state at the end of the previous example
and want to make <code>server1</code> primary again, then we must issue the following
command:</p>
<div><pre><span></span>$ maxctrl call command mariadbmon switchover TheMonitor server1 server2
OK
</pre></div>


<p>There are quite a few arguments, so let's look at each one separately
<em> <code>call command</code> indicates that it is a module command that is to be
   invoked,
</em> <code>mariadbmon</code> indicates the module whose command we want to invoke,
<em> <code>switchover</code> is the command we want to invoke, and
</em> <code>TheMonitor</code> is the first argument to the command, the name of the monitor
as specified in the configuration file,
<em> <code>server1</code> is the second argument to the command, the name of the server we
want to make into <em>primary</em>, and
</em> <code>server2</code> is the third argument to the command, the name of the <em>current</em>
<em>primary</em>.</p>
<p>If the command executes successfully, we will end up with the following
cluster state:</p>
<div><pre><span></span>$ maxctrl list servers
┌─────────┬─────────────────┬──────┬─────────────┬─────────────────┐
│ Server  │ Address         │ Port │ Connections │ State           │
├─────────┼─────────────────┼──────┼─────────────┼─────────────────┤
│ server1 │ 192.168.121.51  │ 3306 │ 0           │ Master, Running │
├─────────┼─────────────────┼──────┼─────────────┼─────────────────┤
│ server2 │ 192.168.121.190 │ 3306 │ 0           │ Slave, Running  │
├─────────┼─────────────────┼──────┼─────────────┼─────────────────┤
│ server3 │ 192.168.121.112 │ 3306 │ 0           │ Slave, Running  │
├─────────┼─────────────────┼──────┼─────────────┼─────────────────┤
│ server4 │ 192.168.121.201 │ 3306 │ 0           │ Slave, Running  │
└─────────┴─────────────────┴──────┴─────────────┴─────────────────┘
</pre></div>
    </div>


        
            <div id="subscribe" class="well well-small hide hidden-print"
                 data-subscribe-url="/kb/en/mariadb-maxscale-2408-maxscale-2408-beta-automatic-failover-with-mariadb-monitor/+subscriptions/add"
                 data-unsubscribe-url="/kb/en/mariadb-maxscale-2408-maxscale-2408-beta-automatic-failover-with-mariadb-monitor/+subscriptions/remove">
            </div>
        

        
        
    
        <div class="simple_section_nav">
            <ul class="nav nav-pills">
                
                
                    <li><a href="/kb/en/maxscale-24-08-beta-tutorials/">
                        ↑ MaxScale 24.08 Beta Tutorials ↑
                    </a>
                    </li>
                
                
                    <li class="pull-right"><a href="/kb/en/mariadb-maxscale-2408-maxscale-2408-beta-avrorouter-tutorial/">
                        MaxScale 24.08 Beta  Avrorouter Tutorial →
                    </a>
                    </li>
                
            </ul>
        </div>
    

        

        
        <h2>Comments</h2>
        
    
    <div id="comments" data-node-id="15068" data-comments-url="/kb/en/mariadb-maxscale-2408-maxscale-2408-beta-automatic-failover-with-mariadb-monitor/+comments"
         data-reply-url="/kb/en/mariadb-maxscale-2408-maxscale-2408-beta-automatic-failover-with-mariadb-monitor/comments/post/">
        Comments loading...
    </div>

        

    </div>


                    <div id="content_disclaimer" class="graybox">
                        Content reproduced on this site is the property of its respective owners,
                        and this content is not reviewed in advance by MariaDB. The views, information and opinions
                        expressed by this content do not necessarily represent those of MariaDB or any other party.
                    </div>
                </div>
            </section>

            
                <div id="right_bar" class="col-md-2">
                    
    
        
        <ul class="section_navigation well well-small hidden-xs hidden-sm">
            
                <li class="parent"><a href="/kb/en/maxscale-24-08-beta-tutorials/">
                    ↑ MaxScale 24.08 Beta Tutorials ↑
                </a>
                </li>
            
            
                
                    <li class="active">
                        <span>MaxScale 24.08 Beta  Automatic Failover With MariaDB Monitor</span>
                        
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-2408-maxscale-2408-beta-avrorouter-tutorial/">
                            
                            MaxScale 24.08 Beta  Avrorouter Tutorial
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-2408-maxscale-2408-beta-configuring-servers/">
                            
                            MaxScale 24.08 Beta  Configuring Servers
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-2408-maxscale-2408-beta-configuring-the-galera-monitor/">
                            
                            MaxScale 24.08 Beta  Configuring the Galera Monitor
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-2408-maxscale-2408-beta-configuring-the-mariadb-monitor/">
                            
                            MaxScale 24.08 Beta  Configuring the MariaDB Monitor
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-2408-maxscale-2408-beta-connection-routing-with-mariadb-maxscale/">
                            
                            MaxScale 24.08 Beta  Connection Routing with MariaDB MaxScale
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-2408-maxscale-2408-beta-encrypting-passwords/">
                            
                            MaxScale 24.08 Beta  Encrypting Passwords
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-2408-maxscale-2408-beta-filters/">
                            
                            MaxScale 24.08 Beta  Filters
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-2408-maxscale-2408-beta-mariadb-maxscale-administration-tutorial/">
                            
                            MaxScale 24.08 Beta  MariaDB MaxScale Administration Tutorial
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-2408-maxscale-2408-beta-read-write-splitting-with-mariadb-maxscale/">
                            
                            MaxScale 24.08 Beta  Read-Write Splitting with MariaDB MaxScale
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-2408-maxscale-2408-beta-rest-api-tutorial/">
                            
                            MaxScale 24.08 Beta  REST API Tutorial
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-2408-maxscale-2408-beta-schemarouter-simple-sharding-with-two-servers/">
                            
                            MaxScale 24.08 Beta  Schemarouter: Simple Sharding With Two Servers
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-2408-maxscale-2408-beta-setting-up-mariadb-maxscale/">
                            
                            MaxScale 24.08 Beta  Setting up MariaDB MaxScale
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-2408-maxscale-2408-beta-using-maxgui-tutorial/">
                            
                            MaxScale 24.08 Beta  Using MaxGUI Tutorial
                        </a>
                    </li>
                
            
        </ul>
    
    

                </div>
            
        </div>
    </div>
</div>

<!-- Footer -->
<footer id="footer">
    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-xs-12">
                    <ul class="list-inline text-center footer-nav">
                        <li>
                            <h5>
                                <a href="https://mariadb.com/products" title="Products">Products</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/services" title="Services">Services</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/pricing" title="Pricing">Pricing</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/resources" title="Resources">Resources</a>
                            </h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/about-us" title="About MariaDB">About Us</a></h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/download" title="Download">Download MariaDB</a></h5>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="row row-10">
                
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div id="block-footerformcontact" class="block block-block-content block-block-contentd754ee1b-3cc9-40e7-9ef4-f504f1197fb1">
                        
                            <h5 style="font-weight: 400;">Subscribe to our newsletter!</h5>
                            <script src="//app-sj15.marketo.com/js/forms2/js/forms2.min.js"></script><form id="mktoForm_1498"></form>
                            <script>
                                <!--//--><![CDATA[// ><!--
                                MktoForms2.loadForm("//app-sj15.marketo.com", "573-PXI-984", 1498);
                                //--><!]]]]><![CDATA[>
                                //--><!]]>
                            </script>
                        
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div class="footer-copyright">
                        <div class="text-center">
                            <ul class="list-inline no-margin">
                                <li>
                                    <a href="/legal" title="Legal">Legal</a>
                                </li>
                                <li>
                                    <a href="/privacy-policy" title="Privacy Policy">Privacy Policy</a>
                                </li>
                                <li>
                                    <a href="/cookie-policy/" title="Cookies">Cookie Policy</a>
                                </li>
                            </ul>
                            <p>Copyright &copy; 2024 MariaDB. All rights reserved.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</footer>
</div>

<div id="ajax_loading">
    <img src="/kb/static/images/ajax-loader.a51c5608d01a.gif" />
</div>

    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MK2847"
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MK2847');</script>
    <!-- End Google Tag Manager -->

</body>

<script type="text/javascript" src="/kb/static/js/main.1587e3a666fc.js" charset="utf-8"></script>

</html>