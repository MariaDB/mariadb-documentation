<!DOCTYPE html>
<html>
<head data-cookie-domain=""
      data-cookie-path="/">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="apple-touch-icon" sizes="180x180" href="/kb/static/images/favicons/apple-touch-icon.159e713979be.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/kb/static/images/favicons/favicon-32x32.bc0ac1d5d11e.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/kb/static/images/favicons/favicon-16x16.5801f8f0f34e.png">
    <link rel="shortcut icon" href="/kb/static/images/favicons/favicon.d122d305dee4.ico" type="image/x-icon" />

    <title> MaxScale Configuration &amp; Usage Scenarios - MariaDB Knowledge Base</title>

    <link href="/kb/static/css/main.9a0d7dcebefd.css" rel="stylesheet" type="text/css" />

    

    <!-- FB Open Graph tags -->
    <meta property="og:title" content=" MaxScale Configuration &amp; Usage Scenarios" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://mariadb.com/kb/en/maxscale-configuration-usage-scenarios/" />
    <meta property="og:image" content="http://mariadb.comaskmonty-logo.png" />
    <meta property="og:site_name" content="MariaDB KnowledgeBase" />
    <meta property="fb:admins" content="514852603" />
    <meta property="og:description" content="MaxScale Configuration &amp; Usage Scenarios
Introduction
The purpose of this document is to describe how to configure MaxScale and to discuss some possible usage scenarios for Ma..." />

    <meta name="description" content="MaxScale Configuration &amp; Usage Scenarios
Introduction
The purpose of this document is to describe how to configure MaxScale and to discuss some possible usage scenarios for Ma..." />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet"/>
    
</head>
<body class="mpkb nodes products nodes_view jqui" id="nodes_view">





<div id="menu-mobile" class="visible-sm visible-xs">

    <div>
        <div id="mobile-close-menu" class="text-right">
            <a href="javascript:void(0)" title="Close Menu" id="back-main" class="toggle-menu">X<span></span></a>
        </div>
    </div>
    <div class="mainmenu-mobile">
        <ul class="ls-none ul-menu">
            <li data-sub="submenu5"><a class="open-form-search" href="/kb/search/" title="Search">Search </a></li>
            <li data-sub="submenu0"><a href="/products" title="Products">Products</a><span class="arrow-main"></span></li>
            <li data-sub="submenu1"><a href="/services" title="Services">Services</a><span class="arrow-main"></span></li>
            <li data-sub="submenu2"><a href="/resources" title="Resources">Resources</a><span class="arrow-main"></span></li>
            <li data-sub="submenu3"><a href="/about-us" title="About">About</a><span class="arrow-main"></span></li>
            <li data-sub="submenu4"><a href="/contact" title="Contact">Contact</a></li>
        </ul>
    </div>

    <div class="nav-top-mobile">
        <div class="select-box form">

            <ul class="inline-block-md mb-none top-nav">
                <li>

                </li>
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/maxscale-configuration-usage-scenarios/"> Login</a>
                    </li>
                
            </ul>



        </div>
        <p class="text-center copyright">Copyright &copy; 2023 MariaDB. All rights reserved.</p>
    </div>
</div>
<div id="wrapper">
<div id="top-nav">
    <div class="container">
        <ul class="hidden-sm hidden-xs" >
            <li><a href="https://mariadb.com/kb/">Knowledge Base</a></li>
            <li><a href="https://mariadb.com/contact/">Contact</a></li>
            
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/maxscale-configuration-usage-scenarios/" rel="nofollow">Login</a>
                    </li>
                
            
            
            <li id="search-form">
                <form action="/kb/en/+search/" method="get" id="search-block-form" accept-charset="UTF-8">
                    <input id="search" title="Enter the terms you wish to search for."
                           placeholder="Search . . ." type="text"
                           name="q" value="" size="15" maxlength="128" class="form-text"
                           data-autocomplete-url="/kb/en/+search/autocomplete/">
                    <input type="hidden" name="quick" value="1" />
                    <input type="hidden" name="source" value="kb" />
                </form>
            </li>
            <li><a id="search-toggler" href="/kb/search/">Search</a></li>
            
        </ul>
    </div>
</div>
<div id="navbar-bottom" class="navbar">
    <div class="container">
        
        
        
        
        <div class="row">
            <div class="col-md-3 col-sm-9 col-xs-9">
                <a class="brand" href="/" title="MariaDB">
                    <img src="/kb/static/images/logo-2018-black.95f5978ae14d.png">
                </a>
            </div>
            <div class="col-md-9 hidden-sm hidden-xs">
                <div class="main-menu">
                    <ul id="main-menu" class="nav navbar-nav inline-block-sm">
    <li class="has-sub full-menu">
        <a href="/products" title="Products">Products</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/services" title="Services">Services</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/pricing" title="Pricing">Pricing</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/resources" title="Resources">Resources</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/about-us" title="About Us">About Us</a>
    </li>
    <li class="">
        <a class="button electric-eel small top-bar-right-download" href="/downloads/">Download</a>
    </li>
</ul>
                </div>
            </div>
            <div class="col-md-3 visible-sm visible-xs col-sm-3 col-xs-3 ps-rv">
                <div class="navbar-header text-right pull-right">
                    <button type="button" class="menu-control toggle-menu" id="open-menu">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="main">
    <div class="container">
        

        <div id="subheader1" class="clearfix">
            <div class="pull-left">
                
                <div id="breadcrumbs" class="breadcrumb">
                    <a href="/kb/en/">Knowledge Base</a>
                    


    
    » <a class="crumb" href="/kb/en/maxscale/">MariaDB MaxScale</a>
    

    
    » <a class="crumb" href="/kb/en/mariadb-maxscale-14/">MariaDB MaxScale 1.4</a>
    

    
    » <a class="crumb" href="/kb/en/maxscale-14-getting-started/">MaxScale 1.4 Getting Started</a>
    


    » <a class="node_link crumb" href="/kb/en/maxscale-configuration-usage-scenarios/"> MaxScale Configuration &amp; Usage Scenarios</a>


                </div>
                
            </div>
        </div>
    </div>
    <div class="container" id="container-main">
        <div class="row">
            
            
                
                <aside id="sidebar-first" class="sidebar col-md-2 hidden-xs hidden-sm hidden-print">
                    
                        
                        <ul id="category_menu" class="nav nav-pills nav-stacked">
                            <li><a href="/kb/en/">Home</a></li>
                            
                                
                                    <li><a href="/kb/en/+questions/">Open Questions</a></li>
                                
                                <li><a href="/kb/en/documentation/">MariaDB Server</a></li>
                                <li><a href="/kb/en/maxscale/">MariaDB MaxScale</a></li>
                                <li><a href="/kb/en/mariadb-columnstore/">MariaDB ColumnStore</a></li>
                                <li><a href="/kb/en/connectors/">Connectors</a></li>
                            

                        </ul>
                    

                    
<div>



<div class="well well-small box actions"><div>

        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/maxscale-configuration-usage-scenarios/+history" rel="nofollow">History</a>
        
        
        
        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/maxscale-configuration-usage-scenarios/+source/">Source</a>
        
        <a class="btn btn-block btn-blue btn-sm flag" href="/kb/en/maxscale-configuration-usage-scenarios/+flag"
                data-flag-url="/kb/en/maxscale-configuration-usage-scenarios/+flag" rel="nofollow">
                Flag as Spam / Inappropriate</a>
        
        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/maxscale-configuration-usage-scenarios/+translate/">
                Translate</a>
        

</div>
</div>





<div class="well well-small box node_info"><div>

    <dl>
        <dt>Created</dt>
        <dd>

<span class="datetime" title="2015-05-06 21:17">8 years, 1 month ago</span></dd>

        <dt>Modified</dt>
        <dd>

<span class="datetime" title="2016-03-22 13:23">7 years, 3 months ago</span></dd>

        <dt>Type</dt>
        <dd>article</dd>

        <dt>Status</dt>
        <dd>active</dd>

        <dt>License</dt>
        <dd>
            
                <a href="/kb/en/maxscale-configuration-usage-scenarios/+license/">CC BY-SA / Gnu FDL</a>
            
        </dd>

        
        <dt>Source</dt>
        <dd><a href="https://github.com/mariadb-corporation/MaxScale/blob/1.4.5/Documentation/Getting-Started/Configuration-Guide.md">GitHub</a></dd>
        
    </dl>

    
    <ul class="rss_feeds">
        <li><a href="/kb/en/maxscale-configuration-usage-scenarios/+history/feed/">
            History</a>
        </li>
        <li><a href="/kb/en/maxscale-configuration-usage-scenarios/+comments/feed/">
            Comments</a>
        </li>
    </ul>
    

</div>
</div>





    
    
    

<div class="well well-small box attachments"><div><div class="edit_link pull-right"><a href="/kb/en/maxscale-configuration-usage-scenarios/+edit/attachments/">Edit</a></div><h5>Attachments</h5></div><div>

        
            <div class="no_data">No attachments exist</div>
        
    
</div>
</div>

    



    
    






</div>


                    

































                </aside>
            
            
            
                
            
            
                
            
            <section id="content" class="limited_width col-md-8 clearfix">
                
                    <h1> MaxScale Configuration &amp; Usage Scenarios</h1>
                

                



                <div>
                    
    

    
    
    

    <div class="node creole">
        
        
        


    
    <div class="answer formatted">
        <h1 id="maxscale-configuration-usage-scenarios">MaxScale Configuration &amp; Usage Scenarios</h1>
<h2 id="introduction">Introduction</h2>
<p>The purpose of this document is to describe how to configure MaxScale and to discuss some possible usage scenarios for MaxScale. MaxScale is designed with flexibility in mind, and consists of an event processing core with various support functions and plugin modules that tailor the behavior of the MaxScale itself.</p>
<h1 id="table-of-contents">Table of Contents</h1>
<ul>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#global-settings">Global Settings</a></li>
<li><a href="#service">Service</a></li>
<li><a href="#server">Server</a></li>
<li><a href="#listener">Listener</a></li>
<li><a href="#listener-and-ssl">Listener and SSL</a> </li>
<li><a href="#routing-modules">Router Modules</a></li>
<li><a href="#diagnostic-modules">Diagnostic Modules</a></li>
<li><a href="#monitor-modules">Monitor Modules</a></li>
<li><a href="#filter-modules">Filter Modules</a></li>
<li><a href="#reloading-configuration">Reloading Configuration</a></li>
<li><a href="#authentication">Authentication</a></li>
<li><a href="#error-reporting">Error Reporting</a></li>
</ul>
<h3 id="terms">Terms</h3>
<table>
<thead>
<tr>
<th>Term</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>service</td>
<td>A service represents a set of databases with a specific access mechanism that is offered to clients of MaxScale. The access mechanism defines the algorithm that MaxScale will use to direct particular requests to the individual databases.</td>
</tr>
<tr>
<td>server</td>
<td>A server represents an individual database server to which a client can be connected via MaxScale.</td>
</tr>
<tr>
<td>router</td>
<td>A router is a module within MaxScale that will route client requests to the various database servers which MaxScale provides a service interface to.</td>
</tr>
<tr>
<td>connection routing</td>
<td>Connection routing is a method of handling requests in which MaxScale will accept connections from a client and route data on that connection to a single database using a single connection. Connection based routing will not examine individual requests on a connection and it will not move that connection once it is established.</td>
</tr>
<tr>
<td>statement routing</td>
<td>Statement routing is a method of handling requests in which each request within a connection will be handled individually. Requests may be sent to one or more servers and connections may be dynamically added or removed from the session.</td>
</tr>
<tr>
<td>protocol</td>
<td>A protocol is a module of software that is used to communicate with another software entity within the system. MaxScale supports the dynamic loading of protocol modules to allow for increased flexibility.</td>
</tr>
<tr>
<td>module</td>
<td>A module is a separate code entity that may be loaded dynamically into MaxScale to increase the available functionality. Modules are implemented as run-time loadable shared objects.</td>
</tr>
<tr>
<td>monitor</td>
<td>A monitor is a module that can be executed within MaxScale to monitor the state of a set of database. The use of an internal monitor is optional, monitoring may be performed externally to MaxScale.</td>
</tr>
<tr>
<td>listener</td>
<td>A listener is the network endpoint that is used to listen for connections to MaxScale from the client applications. A listener is associated to a single service, however, a service may have many listeners.</td>
</tr>
<tr>
<td>connection failover</td>
<td>When a connection currently being used between MaxScale and the database server fails a replacement will be automatically created to another server by MaxScale without client intervention</td>
</tr>
<tr>
<td>backend database</td>
<td>A term used to refer to a database that sits behind MaxScale and is accessed by applications via MaxScale.</td>
</tr>
<tr>
<td>filter</td>
<td>A module that can be placed between the client and the MaxScale router module. All client data passes through the filter module and may be examined or modified by the filter modules.  Filters may be chained together to form processing pipelines.</td>
</tr>
</tbody>
</table>
<h2 id="configuration">Configuration</h2>
<p>The MaxScale configuration is read from a file that MaxScale will look for
in a number of places.</p>
<ol>
<li>
<p>Location given with the --configdir=&lt;path&gt; command line argument</p>
</li>
<li>
<p>MaxScale will look for a configuration file called <code>maxscale.cnf</code> in the directory <code>/etc/maxscale.cnf</code></p>
</li>
</ol>
<p>An explicit path to a configuration file can be passed by using the <code>-f</code> option to MaxScale.</p>
<p>The configuration file itself is based on the ".ini" file format and consists of various sections that are used to build the configuration; these sections define services, servers, listeners, monitors and global settings. Parameters, which expect a comma-separated list of values can be defined on multiple lines. The following is an example of a multi-line definition.</p>
<div><pre><span></span>[MyService]
type=service
router=readconnroute
servers=server1,
        server2,
        server3
</pre></div>


<p>The values of the parameter that are not on the first line need to have at least one whitespace character before them in order for them to be recognized as a part of the multi-line parameter.</p>
<h3 id="global-settings">Global Settings</h3>
<p>The global settings, in a section named <code>[MaxScale]</code>, allow various parameters that affect MaxScale as a whole to be tuned.</p>
<h4 id="threads"><code>threads</code></h4>
<p>This parameter controls the number of worker threads that are handling the
events coming from the kernel. The default is 1 thread. It is recommended that
you start with one thread and increase the number if you require greater
performance. Increasing the amount of worker threads beyond the number of
processor cores does not improve the performance, rather is likely to degrade
it, and can consume resources needlessly.</p>
<p>You can enable automatic configuration of this value by setting the value to
<code>auto</code>. This way MaxScale will detect the number of available processors and
set the amount of threads to be equal to that number. This should only be used
for systems dedicated for running MaxScale.</p>
<div><pre><span></span># Valid options are:
#       threads=[&lt;number of threads&gt; | auto ]

[MaxScale]
threads=1
</pre></div>


<p>It should be noted that additional threads will be created to execute other internal services within MaxScale. This setting is used to configure the number of threads that will be used to manage the user connections.</p>
<h4 id="auth_connect_timeout"><code>auth_connect_timeout</code></h4>
<p>The connection timeout in seconds for the MySQL connections to the backend server when user authentication data is fetched. Increasing the value of this parameter will cause MaxScale to wait longer for a response from the backend server before aborting the authentication process. The default is 3 seconds.</p>
<h4 id="auth_read_timeout"><code>auth_read_timeout</code></h4>
<p>The read timeout in seconds for the MySQL connection to the backend database when user authentication data is fetched. Increasing the value of this parameter will cause MaxScale to wait longer for a response from the backend server when user data is being actively fetched. If the authentication is failing and you either have a large number of database users and grants or the connection to the backend servers is slow, it is a good idea to increase this value. The default is 1 second.</p>
<h4 id="auth_write_timeout"><code>auth_write_timeout</code></h4>
<p>The write timeout in seconds for the MySQL connection to the backend database when user authentication data is fetched. Currently MaxScale does not write or modify the data in the backend server. The default is 2 seconds.</p>
<h4 id="ms_timestamp"><code>ms_timestamp</code></h4>
<p>Enable or disable the high precision timestamps in logfiles. Enabling this adds millisecond precision to all logfile timestamps.</p>
<div><pre><span></span># Valid options are:
#       ms_timestamp=&lt;0|1&gt;
ms_timestamp=1
</pre></div>


<h4 id="syslog"><code>syslog</code></h4>
<p>Enable to disable to logging of messages to <em>syslog</em>.</p>
<p>By default logging to <em>syslog</em> is enabled.</p>
<div><pre><span></span># Valid options are:
#       syslog=&lt;0|1&gt;
syslog=1
</pre></div>


<p>To enable logging to syslog use the value 1 and to disable use
the value 0.</p>
<h4 id="maxlog"><code>maxlog</code></h4>
<p>Enable to disable to logging of messages to MaxScale's log file.</p>
<p>By default logging to <em>maxlog</em> is enabled.</p>
<div><pre><span></span># Valid options are:
#       syslog=&lt;0|1&gt;
maxlog=1
</pre></div>


<p>To enable logging to the MaxScale log file use the value 1 and to
disable use the value 0.</p>
<h4 id="log_to_shm"><code>log_to_shm</code></h4>
<p>Enable or disable the writing of the <em>maxscale.log</em> file to shared memory.
If enabled, then the actual log file will be created under <code>/dev/shm</code> and
a symbolic link to that file will be created in the <em>MaxScale</em> log directory.</p>
<p>Logging to shared memory may be appropriate if <em>log_info</em> and/or <em>log_debug</em>
are enabled, as logging to a regular file may in that case cause performance
degradation, due to the amount of data logged. However, as shared memory is
a scarce resource, logging to shared memory should be used only temporarily
and not regularly.</p>
<p>Since <em>MaxScale</em> can log to both file and <em>syslog</em> an approach that provides
maximum flexibility is to enable <em>syslog</em> and <em>log_to_shm</em>, and to disable
<em>maxlog</em>. That way messages will normally be logged to <em>syslog</em>, but if
there is something to investigate, <em>log_info</em> and <em>maxlog</em> can be enabled
from <em>maxadmin</em>, in which case informational messages will be logged to
the <em>maxscale.log</em> file that resides in shared memory.</p>
<p>By default, logging to shared memory is disabled.</p>
<div><pre><span></span># Valid options are:
#       log_to_shm=&lt;0|1&gt;
log_to_shm=1
</pre></div>


<p>To enable logging to shared memory use the value 1 and to disable use
the value 0.</p>
<h4 id="log_warning"><code>log_warning</code></h4>
<p>Enable or disable the logging of messages whose syslog priority is <em>warning</em>.
Messages of this priority are enabled by default.</p>
<div><pre><span></span># Valid options are:
#       log_warning=&lt;0|1&gt;
log_warning=0
</pre></div>


<p>To disable these messages use the value 0 and to enable them use the value 1.</p>
<h4 id="log_notice"><code>log_notice</code></h4>
<p>Enable or disable the logging of messages whose syslog priority is <em>notice</em>.
Messages of this priority provide information about the functioning of
MaxScale and are enabled by default.</p>
<div><pre><span></span># Valid options are:
#       log_notice=&lt;0|1&gt;
log_notice=0
</pre></div>


<p>To disable these messages use the value 0 and to enable them use the value 1.</p>
<h4 id="log_info"><code>log_info</code></h4>
<p>Enable or disable the logging of messages whose syslog priority is <em>info</em>.
These messages provide detailed information about the internal workings of
MaxScale and should not, due to their frequency, be enabled, unless there
is a specific reason for that. For instance, from these messages it will be
evident, e.g., why a particular query was routed to the master instead of
to a slave. These informational messages are disabled by default.</p>
<div><pre><span></span># Valid options are:
#       log_info=&lt;0|1&gt;
log_info=1
</pre></div>


<p>To disable these messages use the value 0 and to enable them use the value 1.</p>
<h4 id="log_debug"><code>log_debug</code></h4>
<p>Enable or disable the logging of messages whose syslog priority is <em>debug</em>. This kind of messages are intended for development purposes and are disabled by default.</p>
<div><pre><span></span># Valid options are:
#       log_debug=&lt;0|1&gt;
log_debug=1
</pre></div>


<p>To disable these messages use the value 0 and to enable them use the value 1.</p>
<h4 id="log_messages"><code>log_messages</code></h4>
<p><strong>Deprecated</strong> Use <em>log_notice</em> instead.</p>
<h4 id="log_trace"><code>log_trace</code></h4>
<p><strong>Deprecated</strong> Use <em>log_info</em> instead.</p>
<h4 id="log_augmentation"><code>log_augmentation</code></h4>
<p>Enable or disable the augmentation of messages. If this is enabled, then each logged message is appended with the name of the function where the message was logged. This is primarily for development purposes and hence is disabled by default.</p>
<div><pre><span></span># Valid options are:
#       log_augmentation=&lt;0|1&gt;
log_augmentation=1
</pre></div>


<p>To disable the augmentation use the value 0 and to enable it use the value 1.</p>
<h4 id="logdir"><code>logdir</code></h4>
<p>Set the directory where the logfiles are stored. The folder needs to be both readable and writable by the user running MaxScale.</p>
<div><pre><span></span>logdir=/tmp/
</pre></div>


<h4 id="datadir"><code>datadir</code></h4>
<p>Set the directory where the data files used by MaxScale are stored. Modules can write to this directory and for example the binlogrouter uses this folder as the default location for storing binary logs.</p>
<div><pre><span></span>datadir=/home/user/maxscale_data/
</pre></div>


<h4 id="libdir"><code>libdir</code></h4>
<p>Set the directory where MaxScale looks for modules. The library directory is the only directory that MaxScale uses when it searches for modules. If you have custom modules for MaxScale, make sure you have them in this folder.</p>
<div><pre><span></span>libdir=/home/user/lib64/
</pre></div>


<h4 id="cachedir"><code>cachedir</code></h4>
<p>Configure the directory MaxScale uses to store cached data. An example of cached data is the authentication data fetched from the backend servers. MaxScale stores this in case a connection to the backend server is not possible.</p>
<div><pre><span></span>cachedir=/tmp/maxscale_cache/
</pre></div>


<h4 id="piddir"><code>piddir</code></h4>
<p>Configure the directory for the PID file for MaxScale. This file contains the Process ID for the running MaxScale process.</p>
<div><pre><span></span>piddir=/tmp/maxscale_cache/
</pre></div>


<h4 id="execdir"><code>execdir</code></h4>
<p>Configure the directory where the executable files reside. All internal processes which are launched will use this directory to look for executable files.</p>
<div><pre><span></span>execdir=/usr/local/bin/
</pre></div>


<h4 id="language"><code>language</code></h4>
<p>Set the folder where the errmsg.sys file is located in. MaxScale will look for the errmsg.sys file installed with MaxScale from this folder.</p>
<div><pre><span></span>language=/home/user/lang/
</pre></div>


<h3 id="service">Service</h3>
<p>A service represents the database service that MaxScale offers to the clients. In general a service consists of a set of backend database servers and a routing algorithm that determines how MaxScale decides to send statements or route connections to those backend servers.</p>
<p>A service may be considered as a virtual database server that MaxScale makes available to its clients.</p>
<p>Several different services may be defined using the same set of backend servers. For example a connection based routing service might be used by clients that already performed internal read/write splitting, whilst a different statement based router may be used by clients that are not written with this functionality in place. Both sets of applications could access the same data in the same databases.</p>
<p>A service is identified by a service name, which is the name of the configuration file section and a type parameter of service</p>
<div><pre><span></span>[Test Service]
type=service
</pre></div>


<p>In order for MaxScale to forward any requests it must have at least one service defined within the configuration file. The definition of a service alone is not enough to allow MaxScale to forward requests however, the service is merely present to link together the other configuration elements.</p>
<h4 id="router"><code>router</code></h4>
<p>The router parameter of a service defines the name of the router module that will be used to implement the routing algorithm between the client of MaxScale and the backend databases. Additionally routers may also be passed a comma separated list of options that are used to control the behavior of the routing algorithm. The two parameters that control the routing choice are router and router_options. The router options are specific to a particular router and are used to modify the behavior of the router. The read connection router can be passed options of master, slave or synced, an example of configuring a service to use this router and limiting the choice of servers to those in slave state would be as follows.</p>
<div><pre><span></span>router=readconnroute
router_options=slave
</pre></div>


<p>To change the router to connect on to servers in the  master state as well as slave servers, the router options can be modified to include the master state.</p>
<div><pre><span></span>router=readconnroute
router_options=master,slave
</pre></div>


<p>A more complete description of router options and what is available for a given router is included with the documentation of the router itself.</p>
<h4 id="filters"><code>filters</code></h4>
<p>The filters option allow a set of filters to be defined for a service; requests from the client are passed through these filters before being sent to the router for dispatch to the backend server.  The filters parameter takes one or more filter names, as defined within the filter definition section of the configuration file. Multiple filters are separated using the | character.</p>
<div><pre><span></span>filters=counter | QLA
</pre></div>


<p>The requests pass through the filters from left to right in the order defined in the configuration parameter.</p>
<h4 id="servers"><code>servers</code></h4>
<p>The servers parameter in a service definition provides a comma separated list of the backend servers that comprise the service. The server names are those used in the name section of a block with a type parameter of server (see below).</p>
<div><pre><span></span>servers=server1,server2,server3
</pre></div>


<h4 id="user"><code>user</code></h4>
<p>The user parameter, along with the passwd parameter are used to define the credentials used to connect to the backend servers to extract the list of database users from the backend database that is used for the client authentication.</p>
<div><pre><span></span>user=maxscale
passwd=Mhu87p2D
</pre></div>


<p>Authentication of incoming connections is performed by MaxScale itself rather than by the database server to which the client is connected. The client will authenticate itself with MaxScale, using the username, hostname and password information that MaxScale has extracted from the backend database servers. For a detailed discussion of how this impacts the authentication process please see the "Authentication" section below.</p>
<p>The host matching criteria is restricted to IPv4, IPv6 will be added in a future release.</p>
<p>Existing user configuration in the backend databases must be checked and may be updated before successful MaxScale authentication:</p>
<p>In order for MaxScale to obtain all the data it must be given a username it can use to connect to the database and retrieve that data. This is the parameter that gives MaxScale the username to use for this purpose.</p>
<p>The account used must be able to select from the mysql.user table, the following is an example showing how to create this user.</p>
<div><pre><span></span>MariaDB [mysql]&gt; CREATE USER 'maxscale'@'maxscalehost' IDENTIFIED BY 'Mhu87p2D';
Query OK, 0 rows affected (0.01 sec)

MariaDB [mysql]&gt; GRANT SELECT ON mysql.user TO 'maxscale'@'maxscalehost';
Query OK, 0 rows affected (0.00 sec)
</pre></div>


<p>Additionally, <code>SELECT</code> privileges on the <code>mysql.db</code> and <code>mysql.tables_priv</code> tables and <code>SHOW DATABASES</code> privileges are required in order to load databases name and grants suitable for database name authorization.</p>
<div><pre><span></span>MariaDB [(none)]&gt; GRANT SELECT ON mysql.db TO 'maxscale'@'maxscalehost';
Query OK, 0 rows affected (0.00 sec)

MariaDB [(none)]&gt; GRANT SELECT ON mysql.tables_priv TO 'maxscale'@'maxscalehost';
Query OK, 0 rows affected (0.00 sec)

MariaDB [(none)]&gt; GRANT SHOW DATABASES ON *.* TO 'maxscale'@'maxscalehost';
Query OK, 0 rows affected (0.00 sec)
</pre></div>


<p>MaxScale will execute the following query to retrieve the users. If you suspect that you might have problems with grants, it is recommended to run this query and see the results it returns.</p>
<div><pre><span></span>SELECT DISTINCT
    user.user AS user,
    user.host AS host,
    user.%s AS password,
    concat(user.user,user.host,user.%s,
      IF((user.Select_priv+0)||find_in_set('Select',Coalesce(tp.Table_priv,0)),'Y','N') ,
      COALESCE( db.db,tp.db, '')) AS userdata,
    user.Select_priv AS anydb,
    COALESCE( db.db,tp.db, NULL) AS db
    FROM
    mysql.user LEFT JOIN
    mysql.db ON user.user=db.user AND user.host=db.host LEFT JOIN
    mysql.tables_priv tp ON user.user=tp.user AND user.host=tp.host
    WHERE user.user IS NOT NULL AND user.user &lt;&gt; ''"
</pre></div>


<h4 id="passwd"><code>passwd</code></h4>
<p>The passwd parameter provides the password information for the above user and may be either a plain text password or it may be an encrypted password.  See the section on encrypting passwords for use in the maxscale.cnf file. This user must be capable of connecting to the backend database and executing these SQL statements to load database names and grants from the backends:</p>
<ul>
<li><code>SELECT user, host, password,Select_priv FROM mysql.user</code>.</li>
<li><code>SELECT user, host, db FROM mysql.db</code></li>
<li><code>SELECT * FROM INFORMATION_SCHEMA.SCHEMATA</code></li>
<li><code>SELECT GRANTEE,PRIVILEGE_TYPE FROM INFORMATION_SCHEMA.USER_PRIVILEGES</code></li>
</ul>
<h4 id="enable_root_user"><code>enable_root_user</code></h4>
<p>This parameter controls the ability of the root user to connect to MaxScale and hence onwards to the backend servers via MaxScale.</p>
<p>The default value is <code>0</code>, disabling the ability of the root user to connect to MaxScale.</p>
<p>Example for enabling root user:</p>
<div><pre><span></span>enable_root_user=1
</pre></div>


<p>Values of <code>on</code> or <code>true</code> may also be given to enable the root user and <code>off</code> or <code>false</code> may be given to disable the use of the root user.</p>
<div><pre><span></span>enable_root_user=true
</pre></div>


<h4 id="localhost_match_wildcard_host"><code>localhost_match_wildcard_host</code></h4>
<p>This parameter enables matching of "127.0.0.1" (localhost) against "%" wildcard host for MySQL protocol authentication. The default value is <code>0</code>, so in order to authenticate a connection from the same machine as the one on which MaxScale is running, an explicit user@localhost entry will be required in the MySQL user table.</p>
<h4 id="version_string"><code>version_string</code></h4>
<p>This parameter sets a custom version string that is sent in the MySQL Handshake from MaxScale to clients.</p>
<p>Example:</p>
<div><pre><span></span>version_string=5.5.37-MariaDB-RWsplit
</pre></div>


<p>If not set, the default value is the server version of the embedded MySQL/MariaDB library. Example: 5.5.35-MariaDB</p>
<h4 id="weightby"><code>weightby</code></h4>
<p>The weightby parameter is used in conjunction with server parameters in order to
control the load balancing applied in the router in use by the service. This
allows varying weights to be applied to each server to create a non-uniform
distribution of the load amongst the servers.</p>
<p>An example of this might be to define a parameter for each server that represents
the amount of resource available on the server, we could call this serversize.
Every server should then have a serversize parameter set for the server.</p>
<div><pre><span></span>serversize=10
</pre></div>


<p>The service would then have the parameter <code>weightby=serversize</code>. If there are 4
servers defined in the service (serverA, serverB, serverC and serverD) with the
serversize set as shown in the table below, the connections would balanced
using the percentages in this table.</p>
<table>
<thead>
<tr>
<th>Server</th>
<th>serversize</th>
<th>% connections</th>
</tr>
</thead>
<tbody>
<tr>
<td>serverA</td>
<td>10</td>
<td>18%</td>
</tr>
<tr>
<td>serverB</td>
<td>15</td>
<td>27%</td>
</tr>
<tr>
<td>serverC</td>
<td>10</td>
<td>18%</td>
</tr>
<tr>
<td>serverD</td>
<td>20</td>
<td>36%</td>
</tr>
</tbody>
</table>
<p>Here is an excerpt from an example configuration with the <code>serv_weight</code> parameter
used as the weighting parameter.</p>
<div><pre><span></span>[server1]
type=server
address=127.0.0.1
port=3000
protocol=MySQLBackend
serv_weight=3

[server2]
type=server
address=127.0.0.1
port=3001
protocol=MySQLBackend
serv_weight=1

[Read Service]
type=service
router=readconnroute
servers=server1,server2
weightby=serv_weight
</pre></div>


<p>With this configuration and a heavy query load, the server <em>server1</em> will get
most of the connections and about a third of the remaining queries are routed
to the second server. With server weights, you can assign secondary servers
that are only used when the primary server is under heavy load.</p>
<p>Without the weightby parameter, each connection counts as a single connection.
With a weighting parameter, a single connection received its weight from
the server's own weighting parameter divided by the sum of all weighting
parameters in all the configured servers.</p>
<p>If we use the previous configuration as an example, the sum of the <code>serv_weight</code>
parameter is 4. <em>Server1</em> would receive a weight of <code>3/4=75%</code> and <em>server2</em> would get
<code>1/4=25%</code>. This means that <em>server1</em> would get 75% of the connections and <em>server2</em>
would get 25% of the connections.</p>
<h4 id="auth_all_servers"><code>auth_all_servers</code></h4>
<p>This parameter controls whether only a single server or all of the servers are used when loading the users from the backend servers. This takes a boolean value and when enabled, creates a union of all the users and grants on all the servers.</p>
<h4 id="strip_db_esc"><code>strip_db_esc</code></h4>
<p>The strip_db_esc parameter strips escape characters from database names of grants when loading the users from the backend server. Some visual database management tools automatically escape some characters and this might cause conflicts when MaxScale tries to authenticate users.</p>
<p>This parameter takes a boolean value and when enabled, will strip all <code>\</code> characters from the database names.</p>
<h4 id="optimize_wildcard"><code>optimize_wildcard</code></h4>
<p>Enabling this feature will transform wildcard grants to individual database grants. This will consume more memory but authentication in MaxScale will be done faster. The parameter takes a boolean value.</p>
<h4 id="retry_on_failure"><code>retry_on_failure</code></h4>
<p>The retry_on_failure parameter controls whether MaxScale will try to restart failed services and accepts a boolean value. This functionality is enabled by default to prevent services being permanently disabled if the starting of the service failed due to a network outage. Disabling the restarting of the failed services will cause them to be permanently disabled if the services can't be started when MaxScale is started.</p>
<h4 id="log_auth_warnings"><code>log_auth_warnings</code></h4>
<p>Enable or disable the logging of authentication failures and warnings. This parameter takes a boolean value.</p>
<p>MaxScale normally suppresses warning messages about failed authentication. Enabling this option will log those messages into the message log with details about who tried to connect to MaxScale and from where.</p>
<h4 id="connection_timeout"><code>connection_timeout</code></h4>
<p>The connection_timeout parameter is used to disconnect sessions to MaxScale that have been idle for too long. The session timeouts are disabled by default. To enable them, define the timeout in seconds in the service's configuration section.</p>
<p>Example:</p>
<div><pre><span></span>[Test Service]
connection_timeout=300
</pre></div>


<h3 id="server">Server</h3>
<p>Server sections are used to define the backend database servers that can be formed into a service. A server may be a member of one or more services within MaxScale. Servers are identified by a server name which is the section name in the configuration file. Servers have a type parameter of server, plus address port and protocol parameters.</p>
<div><pre><span></span>[server1]
type=server
address=127.0.0.1
port=3000
protocol=MySQLBackend
</pre></div>


<h4 id="address"><code>address</code></h4>
<p>The IP address or hostname of the machine running the database server that is being defined. MaxScale will use this address to connect to the backend database server.</p>
<h4 id="port"><code>port</code></h4>
<p>The port on which the database listens for incoming connections. MaxScale will use this port to connect to the database server.</p>
<h4 id="protocol"><code>protocol</code></h4>
<p>The name for the protocol module to use to connect MaxScale to the database. Currently only one backend protocol is supported, the MySQLBackend module.</p>
<h4 id="monitoruser"><code>monitoruser</code></h4>
<p>The monitor has a username and password that is used to connect to all servers for monitoring purposes, this may be overridden by supplying a monitoruser statement for each individual server</p>
<div><pre><span></span>monitoruser=mymonitoruser
</pre></div>


<h4 id="monitorpw"><code>monitorpw</code></h4>
<p>The monitor has a username and password that is used to connect to all servers for monitoring purposes, this may be overridden by supplying a monpasswd statement for the individual servers</p>
<div><pre><span></span>monitorpw=mymonitorpasswd
</pre></div>


<p>The monpasswd parameter may be either a plain text password or it may be an encrypted password.  See the section on encrypting passwords for use in the maxscale.cnf file.</p>
<h4 id="persistpoolmax"><code>persistpoolmax</code></h4>
<p>The <code>persistpoolmax</code> parameter defaults to zero but can be set to an integer value for a back end server.
If it is non zero, then when a DCB connected to a back end server is discarded by the
system, it will be held in a pool for reuse, remaining connected to the back end server.
If the number of DCBs in the pool has reached the value given by <code>persistpoolmax</code> then
any further DCB that is discarded will not be retained, but disconnected and discarded.</p>
<h4 id="persistmaxtime"><code>persistmaxtime</code></h4>
<p>The <code>persistmaxtime</code> parameter defaults to zero but can be set to an integer value
indicating a number of seconds. A DCB placed in the persistent pool for a server will
only be reused if the elapsed time since it joined the pool is less than the given
value. Otherwise, the DCB will be discarded and the connection closed.</p>
<p>For more information about persistent connections, please read the <a href="/kb/en/maxscale-administration-tutorial/">Administration Tutorial</a>.</p>
<h3 id="listener">Listener</h3>
<p>The listener defines a port and protocol pair that is used to listen for connections to a service. A service may have multiple listeners associated with it, either to support multiple protocols or multiple ports. As with other elements of the configuration the section name is the listener name and it can be selected freely. A type parameter is used to identify the section as a listener definition. Address is optional and it allows the user to limit connections to certain interface only. Socket is also optional and used for Unix socket connections.</p>
<div><pre><span></span>[&lt;Listener name&gt;]
type=listener
service=&lt;Service name&gt;]
protocol=[MySQLClient|HTTPD]
address=[IP|hostname]
port=&lt;Listen port number&gt;
socket=&lt;Socket path&gt;
</pre></div>


<h4 id="service_1"><code>service</code></h4>
<p>The service to which the listener is associated. This is the name of a service that is defined elsewhere in the configuration file.</p>
<h4 id="protocol_1"><code>protocol</code></h4>
<p>The name of the protocol module that is used for the communication between the client and MaxScale itself.</p>
<h4 id="address_1"><code>address</code></h4>
<p>The address option sets the address that will be used to bind the listening socket. The address may be specified as an IP address in 'dot notation' or as a hostname. If the address option is not included in the listener definition the listener will bind to all network interfaces.</p>
<h4 id="port_1"><code>port</code></h4>
<p>The port to use to listen for incoming connections to MaxScale from the clients. If the port is omitted from the configuration a default port for the protocol will be used.</p>
<h4 id="socket"><code>socket</code></h4>
<p>The <code>socket</code> option may be included in a listener definition, this configures the listener to use Unix domain sockets to listen for incoming connections. The parameter value given is the name of the socket to use.</p>
<p>If a socket option and an address option is given then the listener will listen on both the specific IP address and the Unix socket.</p>
<h4 id="available-protocols">Available Protocols</h4>
<p>The protocols supported by MaxScale are implemented as external modules that are loaded dynamically into the MaxScale core. They allow MaxScale to communicate in various protocols both on the client side and the backend side. Each of the protocols can be either a client protocol or a backend protocol. Client protocols are used for client-MaxScale communication and backend protocols are for MaxScale-database communication.</p>
<h5 id="mysqlclient"><code>MySQLClient</code></h5>
<p>This is the implementation of the MySQL protocol that is used by clients of MaxScale to connect to MaxScale.</p>
<h5 id="mysqlbackend"><code>MySQLBackend</code></h5>
<p>The MySQLBackend protocol module is the implementation of the protocol that MaxScale uses to connect to the backend MySQL, MariaDB and Percona Server databases. This implementation is tailored for the MaxScale to MySQL Database traffic and is not a general purpose implementation of the MySQL protocol.</p>
<h5 id="telnetd"><code>telnetd</code></h5>
<p>The telnetd protocol module is used for connections to MaxScale itself for the purposes of creating interactive user sessions with the MaxScale instance itself. Currently this is used in conjunction with a special router implementation, the debugcli.</p>
<h5 id="maxscaled"><code>maxscaled</code></h5>
<p>The protocol used used by the maxadmin client application in order to connect to MaxScale and access the command line interface.</p>
<h5 id="httpd"><code>HTTPD</code></h5>
<p>This protocol module is currently still under development, it provides a means to create HTTP connections to MaxScale for use by web browsers or RESTful API clients.</p>
<h3 id="listener-and-ssl">Listener and SSL</h3>
<p>This section describes configuration parameters for listeners that control the SSL/TLS encryption method and the various certificate files involved in it. To enable SSL, you must configure the <code>ssl</code> parameter to the value <code>required</code> and provide the three files for <code>ssl_cert</code>, <code>ssl_key</code> and <code>ssl_ca_cert</code>. After this, MySQL connections to this listener will be encrypted with SSL. Attempts to connect to the listener with a non-SSL client will fail. Note that the same service can have an SSL listener and a non-SSL listener if you wish, although they must be on different ports.</p>
<h4 id="ssl"><code>ssl</code></h4>
<p>This enables SSL connections to the listener, when set to <code>required</code>. If that is done, the three certificate files mentioned below must also be supplied. Client connections to this listener will then be encrypted with SSL. Non-SSL connections will get an error when they try to connect to the listener.</p>
<h4 id="ssl_key"><code>ssl_key</code></h4>
<p>A string giving a file path that identifies an existing readable file. The file must be the SSL private key the listener should use. This will be the private key that is used as the server side private key during a client-server SSL handshake. This is a required parameter for SSL enabled listeners.</p>
<h4 id="ssl_cert"><code>ssl_cert</code></h4>
<p>A string giving a file path that identifies an existing readable file. The file must be the SSL certificate the listener should use. This will be the public certificate that is used as the server side certificate during a client-server SSL handshake. This is a required parameter for SSL enabled listeners. The certificate must be compatible with the key defined above.</p>
<h4 id="ssl_ca_cert"><code>ssl_ca_cert</code></h4>
<p>A string giving a file path that identifies an existing readable file. The file must be the SSL Certificate Authority (CA) certificate for the CA that signed the server certificate referred to in the previous parameter. It will be used to verify that the server certificate is valid. This is a required parameter for SSL enabled listeners.</p>
<h4 id="ssl_version"><code>ssl_version</code></h4>
<p>This parameter controls the level of encryption used. Accepted values are:
 * TLSv10
 * TLSv11
 * TLSv12
 * MAX   </p>
<p><code>MAX</code> is the maximum available TLS version which at the time of writing is TLSv1.2.</p>
<h4 id="ssl_cert_verification_depth"><code>ssl_cert_verification_depth</code></h4>
<p>The maximum length of the certificate authority chain that will be accepted. Legal values are positive integers. Note that if the client is to submit an SSL certificate, the <code>ssl_cert_verification_depth</code> parameter must not be 0. If no value is specified, the default is 9.</p>
<div><pre><span></span># Example
ssl_cert_verification_depth=5
</pre></div>


<p><strong>Example SSL enabled listener configuration:</strong></p>
<div><pre><span></span>[RW Split Listener]
type=listener
service=RW Split Router
protocol=MySQLClient
address=10.131.218.83
port=3306
authenticator=MySQL
ssl=required
ssl_cert=/usr/local/mariadb/maxscale/ssl/crt.maxscale.pem
ssl_key=/usr/local/mariadb/maxscale/ssl/key.csr.maxscale.pem
ssl_ca_cert=/usr/local/mariadb/maxscale/ssl/crt.ca.maxscale.pem
ssl_version=TLSv12
ssl_cert_verify_depth=9
</pre></div>


<p>This example configuration requires all connections to be encrypted with SSL. It also specifies that TLSv1.2 should be used as the encryption method. The paths to the server certificate files and the Certificate Authority file are also provided.</p>
<h2 id="routing-modules">Routing Modules</h2>
<p>The main task of MaxScale is to accept database connections from client applications and route the connections or the statements sent over those connections to the various services supported by MaxScale.</p>
<p>Currently a number of routing modules are available, these are designed for a range of different needs.</p>
<p>Connection based load balancing:
* <a href="/kb/en/maxscale-readconnroute/">ReadConnRoute</a></p>
<p>Read/Write aware statement based router:
* <a href="/kb/en/readwritesplit/">ReadWriteSplit</a></p>
<p>Simple sharding on database level:
* <a href="/kb/en/maxscale-routers-schemarouter-router/">SchemaRouter</a></p>
<p>Binary log server:
* <a href="/kb/en/binlogrouter/">Binlogrouter</a></p>
<h2 id="diagnostic-modules">Diagnostic modules</h2>
<p>These modules are used for diagnostic purposes and can tell about the status of MaxScale and the cluster it is monitoring.</p>
<ul>
<li><a href="/kb/en/cli/">MaxAdmin Module</a></li>
<li><a href="/kb/en/debug-cli/">Telnet Module</a></li>
</ul>
<h2 id="monitor-modules">Monitor Modules</h2>
<p>Monitor modules are used by MaxScale to internally monitor the state of the backend databases in order to set the server flags for each of those servers. The router modules then use these flags to determine if the particular server is a suitable destination for routing connections for particular query classifications. The monitors are run within separate threads of MaxScale and do not affect MaxScale's routing performance.</p>
<p>The use of monitors is highly recommended but it is also possible to run MaxScale without a monitor module. In this case an external monitoring system which sets the status of each server via MaxAdmin is needed.</p>
<ul>
<li><a href="/kb/en/mysql-monitor/">Mysql Monitor</a></li>
<li><a href="/kb/en/maxscale-galera-monitor/">Galera Monitor</a></li>
<li><a href="/kb/en/ndb-cluster-monitor/">NDBCluster Monitor</a></li>
<li><a href="/kb/en/multi-master-monitor/">Multi-Master Monitor</a></li>
</ul>
<h2 id="filter-modules">Filter Modules</h2>
<p><img src="https://raw.githubusercontent.com/mariadb-corporation/MaxScale/1.4.5/Documentation/Getting-Started/images/image_10.png"></p>
<p>Filters provide a means to manipulate or process requests as they pass through MaxScale between the client side protocol and the query router. A full explanation of each filter's functionality can be found in its documentation.</p>
<p>The <a href="/kb/en/tutorials-maxscale-filters/">Filter Tutorial</a> document shows how you can add a filter to a service and combine multiple filters in one service.</p>
<ul>
<li><a href="/kb/en/maxscale-query-log-all-filter/">Query Log All (QLA) Filter</a></li>
<li><a href="/kb/en/maxscale-regex-filter-overview/">Regular Expression Filter</a></li>
<li><a href="/kb/en/maxscale-tee-filter-overview/">Tee Filter</a></li>
<li><a href="/kb/en/maxscale-top-filter-overview/">Top Filter</a></li>
<li><a href="/kb/en/maxscale-database-firewall-filter/">Database Firewall Filter</a></li>
<li><a href="/kb/en/maxscale-named-server-filter-overview/">Query Redirection Filter</a></li>
<li><a href="/kb/en/maxscale-rabbitmq-filter/">RabbitMQ Filter</a></li>
</ul>
<h2 id="reloading-configuration">Reloading Configuration</h2>
<p>The current MaxScale configuration may be updated by editing the configuration file and then forcing MaxScale to reread the configuration file. To force MaxScale to reread the configuration file, send a SIGHUP signal to the MaxScale process or execute <code>reload config</code> in the <code>maxadmin</code> client.</p>
<p>Some changes in configuration can not be dynamically applied and require a complete restart of MaxScale, whilst others will take some time to be applied.</p>
<h3 id="limitations">Limitations</h3>
<p>Services that are removed via the configuration update mechanism can not be physically removed from MaxScale until there are no longer any connections using the service.</p>
<p>When the number of threads is decreased the threads will not actually be terminated until such time as they complete the current operation of that thread.</p>
<p>Monitors can not be completely removed from the running MaxScale.</p>
<h2 id="authentication">Authentication</h2>
<p>MySQL uses username, passwords and the client host in order to authenticate a user, so a typical user would be defined as user X at host Y and would be given a password to connect. MaxScale uses exactly the same rules as MySQL when users connect to the MaxScale instance, i.e. it will check the address from which the client is connecting and treat this in exactly the same way that MySQL would. MaxScale will pull the authentication data from one of the backend servers and use this to match the incoming connections, the assumption being that all the backend servers for a particular service will share the same set of user credentials.</p>
<p>It is important to understand, however, that when MaxScale itself makes connections to the backend servers the backend server will see all connections as originating from the host that runs MaxScale and not the original host from which the client connected to MaxScale. Therefore the backend servers should be configured to allow connections from the MaxScale host for every user that can connect from any host. Since there is only a single password within the database server for a given host, this limits the configuration such that a given user name must have the same password for every host from which they can connect.</p>
<p>To clarify, if a user <em>X</em> is defined as using password <em>pass1</em> from host <em>a</em> and <em>pass2</em> from host <em>b</em> then there must be an entry in the <code>user</code> table for user <em>X</em> from the MaxScale host, say <em>pass1</em>.</p>
<p>This would result in rows in the user table as follows</p>
<table>
<thead>
<tr>
<th>Username</th>
<th>Password</th>
<th>Client Host</th>
</tr>
</thead>
<tbody>
<tr>
<td>X</td>
<td>pass1</td>
<td>a</td>
</tr>
<tr>
<td>X</td>
<td>pass2</td>
<td>b</td>
</tr>
<tr>
<td>X</td>
<td>pass1</td>
<td>MaxScale</td>
</tr>
</tbody>
</table>
<p>In this case the user <em>X</em> would be able to connect to MaxScale from host a giving the password of <em>pass1</em>. In addition MaxScale would be able to create connections for this user to the backend servers using the username <em>X</em> and password <em>pass1</em>, since the MaxScale host is also defined to have password <em>pass1</em>. User <em>X</em> would not however be able to connect from host <em>b</em> since they would need to provide the password <em>pass2</em> in order to connect to MaxScale, but then MaxScale would not be able to connect to the backends as it would also use the password <em>pass2</em> for these connections.</p>
<h3 id="wildcard-hosts">Wildcard Hosts</h3>
<p>Hostname mapping in MaxScale works in exactly the same way as for MySQL, if the wildcard is used for the host then any host other than the localhost (127.0.0.1) will match. It is important to consider that the localhost check will be performed at the MaxScale level and at the MySQL server level.</p>
<p>If MaxScale and the databases are on separate hosts there are two important changes in behavior to consider:</p>
<ol>
<li>
<p>Clients running on the same machine as the backend database now may access the database using the wildcard entry. The localhost check between the client and MaxScale will allow the use of the wildcard, since the client is not running on the MaxScale host. Also the wildcard entry can be used on the database host as MaxScale is making that connection and it is not running on the same host as the database.</p>
</li>
<li>
<p>Clients running on the same host as MaxScale can not access the database via MaxScale using the wildcard entry since the connection to MaxScale will be from the localhost. These clients are able to access the database directly, as they will use the wildcard entry.</p>
</li>
</ol>
<p>If MaxScale is running on the same host as one or more of the database nodes to which it is acting as a proxy then the wildcard host entries can be used to connect to MaxScale but not to connect onwards to the database running on the same node.</p>
<p>In all these cases the issue may be solved by adding an explicit entry for the localhost address that has the same password as the wildcard entry. This may be done using a statement as below for each of the databases that are required:</p>
<div><pre><span></span>MariaDB [mysql]&gt; GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, DROP ON employee.* 'user1'@'localhost' IDENTIFIED BY 'xxx';
Query OK, 0 rows affected (0.00 sec)
</pre></div>


<h3 id="limitations_1">Limitations</h3>
<p>At the time of writing the authentication mechanism within MaxScale does not support IPV6 address matching in connections rules. This is also in line with the current protocol modules that do not support IPV6.</p>
<p>Wildcard address supported in the current version of MaxScale are:</p>
<p>192.168.3.%
192.168.%.%
192.%.%.%</p>
<p>and short notations</p>
<p>192.%
192.%.%
192.168.%</p>
<p>Note that currently wildcards are only supported in conjunction with IP-addresses, not with domain names.</p>
<h2 id="error-reporting">Error Reporting</h2>
<p>MaxScale is designed to be executed as a service, therefore all error reports, including configuration errors, are written to the MaxScale error log file. By default, MaxScale will log to a file in <code>/var/log/maxscale</code>, the only exception to this is if the log directory is not writable, in which case a message is sent to the standard error descriptor.</p>
<h3 id="troubleshooting">Troubleshooting</h3>
<p>MaxScale binds on TCP ports and UNIX sockets as well.</p>
<p>If there is a local firewall in the server where MaxScale is installed, the IP and port must be configured in order to receive connections from outside.</p>
<p>If the firewall is a network facility among all the involved servers, a configuration update is required as well.</p>
<p>Example:</p>
<div><pre><span></span>[Galera Listener]
type=listener
address=192.168.3.33
port=4408
socket=/servers/maxscale/galera.sock
</pre></div>


<p>TCP/IP Traffic must be permitted to 192.168.3.33 port 4408</p>
<p>For Unix socket, the socket file path (example: <code>/servers/maxscale/galera.sock</code>) must be writable by the Unix user MaxScale runs as.</p>
    </div>


        
            <div id="subscribe" class="well well-small hide hidden-print"
                 data-subscribe-url="/kb/en/maxscale-configuration-usage-scenarios/+subscriptions/add"
                 data-unsubscribe-url="/kb/en/maxscale-configuration-usage-scenarios/+subscriptions/remove">
            </div>
        

        
        
    
        <div class="simple_section_nav">
            <ul class="nav nav-pills">
                
                    <li><a href="/kb/en/mariadb-maxscale-installation-guide/">
                        ←  MariaDB MaxScale Installation Guide
                    </a>
                    </li>
                
                
                    <li><a href="/kb/en/maxscale-14-getting-started/">
                        ↑ MaxScale 1.4 Getting Started ↑
                    </a>
                    </li>
                
                
            </ul>
        </div>
    

        

        
        <h2>Comments</h2>
        
    
    <div id="comments" data-node-id="4939" data-comments-url="/kb/en/maxscale-configuration-usage-scenarios/+comments"
         data-reply-url="/kb/en/maxscale-configuration-usage-scenarios/comments/post/">
        Comments loading...
    </div>

        

    </div>


                    <div id="content_disclaimer" class="graybox">
                        Content reproduced on this site is the property of its respective owners,
                        and this content is not reviewed in advance by MariaDB. The views, information and opinions
                        expressed by this content do not necessarily represent those of MariaDB or any other party.
                    </div>
                </div>
            </section>

            
                <div id="right_bar" class="col-md-2">
                    
    
        
        <ul class="section_navigation well well-small hidden-xs hidden-sm">
            
                <li class="parent"><a href="/kb/en/maxscale-14-getting-started/">
                    ↑ MaxScale 1.4 Getting Started ↑
                </a>
                </li>
            
            
                
                    <li>
                        <a href="/kb/en/building-maxscale-from-source-code/">
                            
                             Building MaxScale from Source Code
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/installing-mariadb-maxscale-using-a-tarball/">
                            
                             Installing MariaDB MaxScale using a tarball
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-installation-guide/">
                            
                             MariaDB MaxScale Installation Guide
                        </a>
                    </li>
                
            
                
                    <li class="active">
                        <span> MaxScale Configuration &amp; Usage Scenarios</span>
                        
                    </li>
                
            
        </ul>
    
    

                </div>
            
        </div>
    </div>
</div>

<!-- Footer -->
<footer id="footer">
    <div class="footer">
        <div class="container">
            <div class="row row-10">
                <div class="col-md-2 col-xs-4 item">
                    <h5>
                        <a href="/products" title="Products">Products</a>
                    </h5>
                    <ul>
                        <li id="menu-item-7816" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-7816"><a href="https://mariadb.com/products/mariadb-platform/">MariaDB Platform</a></li>
                        <li id="menu-item-7815" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-7815"><a href="https://mariadb.com/products/skysql/">MariaDB SkySQL</a></li>
                        <li id="menu-item-4172" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4172"><a href="https://mariadb.com/pricing/">Pricing</a></li>
                        <li id="menu-item-4163" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4163"><a href="https://mariadb.com/downloads/">Download MariaDB</a></li>
                    </ul>
                </div>
                <div class="col-md-2 col-xs-4 item">
                    <h5>
                        <a href="/services" title="Services">Services</a>
                    </h5>
                    <ul>
                        <li id="menu-item-4169" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4169"><a href="https://mariadb.com/services/remote-dba/">Remote DBA</a></li>
                        <li id="menu-item-41691" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4169"><a href="https://mariadb.com/services/skydba/">SkyDBA</a></li>
                        <li id="menu-item-4167" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4167"><a href="https://mariadb.com/services/enterprise-architect/">Enterprise Architect</a></li>
                        <li id="menu-item-4170" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4170"><a href="https://mariadb.com/services/technical-support-services/">Technical Support</a></li>
                        <li id="menu-item-4168" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4168"><a href="https://mariadb.com/services/migration-practice/">Migration Practice</a></li>
                        <li id="menu-item-4166" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4166"><a href="https://mariadb.com/services/consulting/">Consulting</a></li>
                        <li id="menu-item-4171" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4171"><a href="https://mariadb.com/services/training/">Training</a></li>
                    </ul>
                </div>
                <div class="col-md-2 col-xs-4 item">
                    <h5>
                        <a href="/resources" title="Resources">Resources</a>
                    </h5>
                    <ul>
                        <li id="menu-item-41751" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4175"><a href="https://mariadb.com/docs/">Documentation</a></li>
                        <li id="menu-item-41752" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4175"><a href="https://mariadb.com/developers/">Developers</a></li>
                        <li id="menu-item-4175" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4175"><a href="https://mariadb.com/resources/blog/">Blog</a></li>
                        <li id="menu-item-5462" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-5462"><a href="https://support.mariadb.com">Support</a></li>
                        <li id="menu-item-6004" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6004"><a href="https://mariadb.com/openworks/">OpenWorks</a></li>
                        <li id="menu-item-60041" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-6004"><a href="https://mariadb.com/resources/customer-stories/">Customer Stories</a></li>
                        <li id="menu-item-7817" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7817"><a href="https://mariadb.com/resources/events/">Events</a></li>
                        <li id="menu-item-4177" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4177"><a href="https://mariadb.com/roadshow/">MariaDB Roadshow</a></li>
                    </ul>
                </div>
                <div class="visible-xs visible-sm clear"></div>
                <div class="col-md-2 col-xs-5 item">
                    <h5>
                        <a href="/about-us" title="About MariaDB">About</a>
                    </h5>
                    <ul>
                        <li id="menu-item-4173" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4173"><a href="https://mariadb.com/contact/">Contact</a></li>
                        <li id="menu-item-4161" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4161"><a href="https://mariadb.com/about-us/leadership/">Leadership</a></li>
                        <li id="menu-item-4162" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4162"><a href="https://mariadb.com/about-us/partners/">Partners</a></li>
                        <li id="menu-item-4174" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4174"><a href="https://mariadb.com/newsroom/">Newsroom</a></li>
                        <li id="menu-item-4160" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4160"><a href="https://mariadb.com/about-us/investors/">Investors</a></li>
                        <li id="menu-item-4159" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4159"><a href="https://mariadb.com/about-us/careers/">Careers</a></li>
                        <li id="menu-item-41591" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4159"><a href="https://mariadb.com/trust/">Trust Center</a></li>
                        <li id="menu-item-41592" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4159"><a href="https://mariadb.com/vulnerability-reporting/">Vulnerability Reporting</a></li>
                    </ul>
                </div>
                <div class="col-md-4 col-xs-7 item">
                    <div id="block-footercontact" class="block block-block-content block-block-content22b3af28-0754-44ec-a5c6-4466568f37e3">
                        <h5><a href="/contact" title="Contact">Contact</a></h5>
                    </div>
                    <div class="social">
                        <ul class="list-inline">
                            <li>
                                <a target="_blank" href="https://www.facebook.com/MariaDB.dbms/" title="Facebook">
                                    <i class="fa fa-facebook" aria-hidden="true"></i>
                                </a>
                            </li>
                            <li>
                                <a target="_blank" href="https://twitter.com/mariadb" title="Twitter">
                                    <i class="fa fa-twitter" aria-hidden="true"></i>
                                </a>
                            </li>
                            <li>
                                <a target="_blank" href="https://www.linkedin.com/company/mariadb-corporation?trk=company_logo " title="LinkedIn">
                                    <i class="fa fa-linkedin" aria-hidden="true"></i>
                                </a>
                            </li>
                        </ul>
                    </div>
                    <div id="block-footerformcontact" class="block block-block-content block-block-contentd754ee1b-3cc9-40e7-9ef4-f504f1197fb1">
                        
                            <p>Subscribe to our newsletter!</p>
                            <script src="//app-sj15.marketo.com/js/forms2/js/forms2.min.js"></script><form id="mktoForm_1498"></form>
                            <script>
                                <!--//--><![CDATA[// ><!--
                                MktoForms2.loadForm("//app-sj15.marketo.com", "573-PXI-984", 1498);
                                //--><!]]]]><![CDATA[>
                                //--><!]]>
                            </script>
                        
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="footer-copyright">
        <div class="container text-center">
            <ul class="list-inline no-margin">
                <li>
                    <a href="/legal" title="Legal">Legal</a>
                </li>
                <li>
                    <a href="/privacy-policy" title="Privacy Policy">Privacy Policy</a>
                </li>
                <li>
                    <a href="/cookie-policy/" title="Cookies">Cookie Policy</a>
                </li>
            </ul>
            <p>Copyright &copy; 2023 MariaDB. All rights reserved.</p>
        </div>
    </div>
</footer>
</div>

<div id="ajax_loading">
    <img src="/kb/static/images/ajax-loader.a51c5608d01a.gif" />
</div>

    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MK2847"
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MK2847');</script>
    <!-- End Google Tag Manager -->

</body>

<script type="text/javascript" src="/kb/static/js/main.fed4ec768178.js" charset="utf-8"></script>

</html>