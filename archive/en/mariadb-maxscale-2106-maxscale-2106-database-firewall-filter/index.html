<!DOCTYPE html>
<html>
<head data-cookie-domain=""
      data-cookie-path="/">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="apple-touch-icon" sizes="180x180" href="/kb/static/images/favicons/apple-touch-icon.159e713979be.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/kb/static/images/favicons/favicon-32x32.bc0ac1d5d11e.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/kb/static/images/favicons/favicon-16x16.5801f8f0f34e.png">
    <link rel="shortcut icon" href="/kb/static/images/favicons/favicon.d122d305dee4.ico" type="image/x-icon" />

    <title>MaxScale 21.06  Database Firewall filter - MariaDB Knowledge Base</title>

    <link href="/kb/static/css/main.f7633538c846.css" rel="stylesheet" type="text/css" />

    

    

    <!-- FB Open Graph tags -->
    <meta property="og:title" content="MaxScale 21.06  Database Firewall filter" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://mariadb.com/kb/en/mariadb-maxscale-2106-maxscale-2106-database-firewall-filter/" />
    <meta property="og:image" content="http://mariadb.comaskmonty-logo.png" />
    <meta property="og:site_name" content="MariaDB KnowledgeBase" />
    <meta property="fb:admins" content="514852603" />
    <meta property="og:description" content="Database Firewall filter
This filter is deprecated in MariaDB MaxScale 6 and will be removed in MaxScale 22.08.


Database Firewall filter
Overview
Configuration
Filter Parame..." />

    <meta name="description" content="Database Firewall filter
This filter is deprecated in MariaDB MaxScale 6 and will be removed in MaxScale 22.08.


Database Firewall filter
Overview
Configuration
Filter Parame..." />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet"/>
    
</head>
<body class="mpkb nodes products nodes_view jqui" id="nodes_view">





<div id="menu-mobile" class="visible-sm visible-xs">

    <div>
        <div id="mobile-close-menu" class="text-right">
            <a href="javascript:void(0)" title="Close Menu" id="back-main" class="toggle-menu">X<span></span></a>
        </div>
    </div>
    <div class="mainmenu-mobile">
        <ul class="ls-none ul-menu">
            <li data-sub="submenu5"><a class="open-form-search" href="/kb/search/" title="Search">Search </a></li>
            <li data-sub="submenu0"><a href="/products" title="Products">Products</a><span class="arrow-main"></span></li>
            <li data-sub="submenu1"><a href="/services" title="Services">Services</a><span class="arrow-main"></span></li>
            <li data-sub="submenu2"><a href="/resources" title="Resources">Resources</a><span class="arrow-main"></span></li>
            <li data-sub="submenu3"><a href="/about-us" title="About">About</a><span class="arrow-main"></span></li>
            <li data-sub="submenu4"><a href="/contact" title="Contact">Contact</a></li>
        </ul>
    </div>

    <div class="nav-top-mobile">
        <div class="select-box form">

            <ul class="inline-block-md mb-none top-nav">
                <li>

                </li>
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/mariadb-maxscale-2106-maxscale-2106-database-firewall-filter/"> Login</a>
                    </li>
                
            </ul>



        </div>
        <p class="text-center copyright">Copyright &copy; 2025 MariaDB. All rights reserved.</p>
    </div>
</div>
<div class="violator-wrap d-none" id="top_violator">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12">
                <div class="violator-outer">
                    <div class="violator-inner">
                        <div class="row">
                            <div class="col-xs-12 col-sm-9 col-lg-7 col-lg-offset-2" id="top_violator_content">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="content-link" target="_blank" rel="nofollow noreferrer">
                                    <span>The Ultimate Guide to High Availability with MariaDB</span>
                                </a>
                            </div>
                            <div class="col-xs-12 col-sm-3" id="top_violator_cta">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="btn btn-mariadb" target="_blank" rel="nofollow noreferrer">Download Now</a>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-link close-btn">
                        <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24" width="15px" height="15px"><path d="M 4.9902344 3.9902344 A 1.0001 1.0001 0 0 0 4.2929688 5.7070312 L 10.585938 12 L 4.2929688 18.292969 A 1.0001 1.0001 0 1 0 5.7070312 19.707031 L 12 13.414062 L 18.292969 19.707031 A 1.0001 1.0001 0 1 0 19.707031 18.292969 L 13.414062 12 L 19.707031 5.7070312 A 1.0001 1.0001 0 0 0 18.980469 3.9902344 A 1.0001 1.0001 0 0 0 18.292969 4.2929688 L 12 10.585938 L 5.7070312 4.2929688 A 1.0001 1.0001 0 0 0 4.9902344 3.9902344 z"/></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="wrapper">
<div id="top-nav">
    <div class="container">
        <ul class="hidden-sm hidden-xs" >
            <li><a href="https://mariadb.com/kb/">Knowledge Base</a></li>
            <li><a href="https://mariadb.com/contact/">Contact</a></li>
            
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/mariadb-maxscale-2106-maxscale-2106-database-firewall-filter/" rel="nofollow">Login</a>
                    </li>
                
            
            
            <li id="search-form">
                <form action="/kb/en/+search/" method="get" id="search-block-form" accept-charset="UTF-8">
                    <input id="search" title="Enter the terms you wish to search for."
                           placeholder="Search . . ." type="text"
                           name="q" value="" size="15" maxlength="128" class="form-text"
                           data-autocomplete-url="/kb/en/+search/autocomplete/">
                    <input type="hidden" name="quick" value="1" />
                    <input type="hidden" name="source" value="kb" />
                </form>
            </li>
            <li><a id="search-toggler" href="/kb/search/">Search</a></li>
            
        </ul>
    </div>
</div>
<div id="navbar-bottom" class="navbar">
    <div class="container">
        
        
        
        
        <div class="row">
            <div class="col-md-3 col-sm-9 col-xs-9">
                <a class="brand" href="/" title="MariaDB">
                    <img src="/kb/static/images/logo-2018-black.95f5978ae14d.png">
                </a>
            </div>
            <div class="col-md-9 hidden-sm hidden-xs">
                <div class="main-menu">
                    <ul id="main-menu" class="nav navbar-nav inline-block-sm">
    <li class="has-sub full-menu">
        <a href="/products" title="Products">Products</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/services" title="Services">Services</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/pricing" title="Pricing">Pricing</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/resources" title="Resources">Resources</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/about-us" title="About Us">About Us</a>
    </li>
    <li class="">
        <a class="button electric-eel small top-bar-right-download" href="/downloads/">Download</a>
    </li>
</ul>
                </div>
            </div>
            <div class="col-md-3 visible-sm visible-xs col-sm-3 col-xs-3 ps-rv">
                <div class="navbar-header text-right pull-right">
                    <button type="button" class="menu-control toggle-menu" id="open-menu">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="main">
    <div class="container">
        

        <div id="subheader1" class="clearfix">
            <div class="pull-left">
                
                <div id="breadcrumbs" class="breadcrumb">
                    <a href="/kb/en/">Knowledge Base</a>
                    


    
    » <a class="crumb" href="/kb/en/maxscale/">MariaDB MaxScale</a>
    

    
    » <a class="crumb" href="/kb/en/mariadb-maxscale-21-06/">MariaDB MaxScale 21.06</a>
    

    
    » <a class="crumb" href="/kb/en/mariadb-maxscale-21-06-filters/">MaxScale 21.06 Filters</a>
    


    » <a class="node_link crumb" href="/kb/en/mariadb-maxscale-2106-maxscale-2106-database-firewall-filter/">MaxScale 21.06  Database Firewall filter</a>


                </div>
                
            </div>
        </div>
    </div>
    <div class="container" id="container-main">
        <div class="row">
            
            
                
                <aside id="sidebar-first" class="sidebar col-md-2 hidden-xs hidden-sm hidden-print">
                    
                        
                        <ul id="category_menu" class="nav nav-pills nav-stacked">
                            <li><a href="/kb/en/">Home</a></li>
                            
                                
                                    <li><a href="/kb/en/+questions/">Open Questions</a></li>
                                
                                <li><a href="/kb/en/documentation/">MariaDB Server</a></li>
                                <li><a href="/kb/en/maxscale/">MariaDB MaxScale</a></li>
                                <li><a href="/kb/en/mariadb-columnstore/">MariaDB ColumnStore</a></li>
                                <li><a href="/kb/en/connectors/">Connectors</a></li>
                            

                        </ul>
                    

                    
<div>



<div class="well well-small box actions"><div>

        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/mariadb-maxscale-2106-maxscale-2106-database-firewall-filter/+history" rel="nofollow">History</a>
        
        
        
        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/mariadb-maxscale-2106-maxscale-2106-database-firewall-filter/+source/">Source</a>
        
        <a class="btn btn-block btn-blue btn-sm flag" href="/kb/en/mariadb-maxscale-2106-maxscale-2106-database-firewall-filter/+flag"
                data-flag-url="/kb/en/mariadb-maxscale-2106-maxscale-2106-database-firewall-filter/+flag" rel="nofollow">
                Flag as Spam / Inappropriate</a>
        
        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/mariadb-maxscale-2106-maxscale-2106-database-firewall-filter/+translate/">
                Translate</a>
        

</div>
</div>





<div class="well well-small box node_info"><div>

    <dl>
        <dt>Created</dt>
        <dd>

<span class="datetime" title="2024-06-03 02:20">7 months, 1 week ago</span></dd>

        <dt>Modified</dt>
        <dd>

<span class="datetime" title="2024-06-03 02:20">7 months, 1 week ago</span></dd>

        <dt>Type</dt>
        <dd>article</dd>

        <dt>Status</dt>
        <dd>active</dd>

        <dt>License</dt>
        <dd>
            
                <a href="/kb/en/mariadb-maxscale-2106-maxscale-2106-database-firewall-filter/+license/">CC BY-SA / Gnu FDL</a>
            
        </dd>

        
        <dt>Source</dt>
        <dd><a href="https://github.com/mariadb-corporation/MaxScale/blob/21.06.18/Documentation/Filters/Database-Firewall-Filter.md">GitHub</a></dd>
        
    </dl>

    
    <ul class="rss_feeds">
        <li><a href="/kb/en/mariadb-maxscale-2106-maxscale-2106-database-firewall-filter/+history/feed/">
            History</a>
        </li>
        <li><a href="/kb/en/mariadb-maxscale-2106-maxscale-2106-database-firewall-filter/+comments/feed/">
            Comments</a>
        </li>
    </ul>
    

</div>
</div>





    
    
    

<div class="well well-small box attachments"><div><div class="edit_link pull-right"><a href="/kb/en/mariadb-maxscale-2106-maxscale-2106-database-firewall-filter/+edit/attachments/">Edit</a></div><h5>Attachments</h5></div><div>

        
            <div class="no_data">No attachments exist</div>
        
    
</div>
</div>

    



    
    






</div>


                    

































                </aside>
            
            
            
                
            
            
                
            
            <section id="content" class="limited_width col-md-8 clearfix">
                
                    <h1>MaxScale 21.06  Database Firewall filter</h1>
                

                



                <div>
                    
    

    
    
    

    <div class="node creole">
        
        
        


    
    <div class="answer formatted">
        <h1 id="database-firewall-filter">Database Firewall filter</h1>
<p>This filter is deprecated in MariaDB MaxScale 6 and will be removed in MaxScale 22.08.</p>
<div>
<ul>
<li><a href="#database-firewall-filter">Database Firewall filter</a><ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#configuration">Configuration</a><ul>
<li><a href="#filter-parameters">Filter Parameters</a><ul>
<li><a href="#rules">rules</a></li>
<li><a href="#action">action</a></li>
<li><a href="#log_match">log_match</a></li>
<li><a href="#log_no_match">log_no_match</a></li>
<li><a href="#treat_string_as_field">treat_string_as_field</a></li>
<li><a href="#treat_string_arg_as_field">treat_string_arg_as_field</a></li>
<li><a href="#strict">strict</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#rule-syntax">Rule syntax</a><ul>
<li><a href="#mandatory-rule-parameters">Mandatory rule parameters</a><ul>
<li><a href="#wildcard">wildcard</a><ul>
<li><a href="#example">Example</a></li>
</ul>
</li>
<li><a href="#columns">columns</a><ul>
<li><a href="#example_1">Example</a></li>
</ul>
</li>
<li><a href="#function">function</a><ul>
<li><a href="#example_2">Example</a></li>
</ul>
</li>
<li><a href="#not_function">not_function</a></li>
<li><a href="#example_3">Example</a></li>
<li><a href="#uses_function">uses_function</a><ul>
<li><a href="#example_4">Example</a></li>
</ul>
</li>
<li><a href="#function-and-columns">function and columns</a><ul>
<li><a href="#example_5">Example</a></li>
</ul>
</li>
<li><a href="#not_function-and-columns">not_function and columns</a><ul>
<li><a href="#example_6">Example</a></li>
</ul>
</li>
<li><a href="#regex">regex</a><ul>
<li><a href="#example_7">Example</a></li>
</ul>
</li>
<li><a href="#limit_queries">limit_queries</a><ul>
<li><a href="#example_8">Example</a></li>
</ul>
</li>
<li><a href="#no_where_clause">no_where_clause</a><ul>
<li><a href="#example_9">Example</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#optional-rule-parameters">Optional rule parameters</a><ul>
<li><a href="#at_times">at_times</a></li>
<li><a href="#on_queries">on_queries</a></li>
</ul>
</li>
<li><a href="#applying-rules-to-users">Applying rules to users</a></li>
</ul>
</li>
<li><a href="#module-commands">Module commands</a><ul>
<li><a href="#rulesreload-filter-file">rules/reload FILTER [FILE]</a></li>
<li><a href="#rules-filter">rules FILTER</a></li>
</ul>
</li>
<li><a href="#use-cases">Use Cases</a><ul>
<li><a href="#use-case-1-prevent-rapid-execution-of-specific-queries">Use Case 1 - Prevent rapid execution of specific queries</a></li>
<li><a href="#use-case-2-only-allow-deletes-with-a-where-clause">Use Case 2 - Only allow deletes with a where clause</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<h2 id="overview">Overview</h2>
<p>The Database Firewall filter is used to block queries that match a set of
rules. It can be used to prevent harmful queries from reaching the backend
database instances or to limit access to the database based on a more flexible
set of rules compared to the traditional GRANT-based privilege system. Currently
the filter does not support multi-statements.</p>
<p>Note that the firewall filter should be viewed as a best-effort solution
intended for protecting against accidental misuse rather than malicious
attacks.</p>
<h2 id="configuration">Configuration</h2>
<p>The Database Firewall filter only requires minimal configuration in the
maxscale.cnf file. The actual rules of the Database Firewall filter are located
in a separate text file. The following is an example of a Database Firewall
filter configuration in maxscale.cnf.</p>
<div><pre><span></span>[DatabaseFirewall]
type=filter
module=dbfwfilter
rules=/home/user/rules.txt

[Firewalled-Routing-Service]
type=service
router=readconnroute
servers=server1
user=myuser
password=mypasswd
filters=DatabaseFirewall
</pre></div>


<h3 id="filter-parameters">Filter Parameters</h3>
<p>The Database Firewall filter has one mandatory parameter, <code>rules</code>.</p>
<h4 id="rules"><code>rules</code></h4>
<p>A path to a file with the rule definitions in it. The file should be readable by
the user MariaDB MaxScale is run with. If a relative path is given, the path is
interpreted relative to the module configuration directory. The default module
configuration directory is <em>/etc/maxscale.modules.d</em>.</p>
<h4 id="action"><code>action</code></h4>
<p>This parameter is optional and determines what action is taken when a query
matches a rule. The value can be either <code>allow</code>, which allows all matching
queries to proceed but blocks those that don't match, or <code>block</code>, which blocks
all matching queries, or <code>ignore</code> which allows all queries to proceed.</p>
<p>The following statement types will always be allowed through when <code>action</code> is
set to <code>allow</code>:</p>
<ul>
<li>COM_CHANGE_USER: The user is changed for an active connection</li>
<li>COM_FIELD_LIST: Alias for the <code>SHOW TABLES;</code> query</li>
<li>COM_INIT_DB: Alias for <code>USE &lt;db&gt;;</code></li>
<li>COM_PING: Server is pinged</li>
<li>COM_PROCESS_INFO: Alias for <code>SHOW PROCESSLIST;</code></li>
<li>COM_PROCESS_KILL: Alias for <code>KILL &lt;id&gt;;</code> query</li>
<li>COM_QUIT: Client closes connection</li>
<li>COM_SET_OPTION: Client multi-statements are being configured</li>
</ul>
<p>You can have both blacklist and whitelist functionality by configuring one
filter with <code>action=allow</code> and another one with <code>action=block</code>. You can then use
different rule files with each filter, one for blacklisting and another one for
whitelisting. After this you only have to add both of these filters to a service
in the following way.</p>
<div><pre><span></span>[my-firewall-service]
type=service
servers=server1
router=readconnroute
user=maxuser
password=maxpwd
filters=dbfw-whitelist|dbfw-blacklist

[dbfw-whitelist]
type=filter
module=dbfwfilter
action=allow
rules=/home/user/whitelist-rules.txt

[dbfw-blacklist]
type=filter
module=dbfwfilter
action=block
rules=/home/user/blacklist-rules.txt
</pre></div>


<p>If a query is blocked, the filter will return an error to the client with the
error number 1141 and an SQL state of HY000.</p>
<h4 id="log_match"><code>log_match</code></h4>
<p>Log all queries that match a rule. For the <code>any</code> matching mode, the name of the
rule that matched is logged and for other matching modes, the name of the last
matching rule is logged. In addition to the rule name the matched user and the
query itself is logged. The log messages are logged at the notice level.</p>
<h4 id="log_no_match"><code>log_no_match</code></h4>
<p>Log all queries that do not match a rule. The matched user and the query is
logged. The log messages are logged at the notice level.</p>
<h4 id="treat_string_as_field"><code>treat_string_as_field</code></h4>
<p>This optional parameter specifies how the database firewall should treat
strings. If true, they will be handled as fields, which will cause column
blocking rules to match even if <code>ANSI_QUOTES</code> has been enabled and <code>"</code> is
used instead of backtick.</p>
<div><pre><span></span>treat_string_as_field=false
</pre></div>


<p>The default value is <code>true</code>.</p>
<p>Note that this may cause a false positive, if a "true" string contains the
name of a column to be blocked.</p>
<h4 id="treat_string_arg_as_field"><code>treat_string_arg_as_field</code></h4>
<p>This optional parameter specifies how the database firewall should treat
strings used as arguments to functions. If true, they will be handled
as fields, which will cause function column blocking rules to match even
even if <code>ANSI_QUOTES</code> has been enabled and <code>"</code> is used instead of backtick.</p>
<div><pre><span></span>treat_string_arg_as_field=false
</pre></div>


<p>The default value is <code>true</code>.</p>
<p>Note that this may cause a false positive, if a "true" string contains the
name of a column to be blocked.</p>
<h4 id="strict"><code>strict</code></h4>
<p>Whether to treat unsupported SQL or multi-statement SQL as an error. This is a
boolean parameter and the default value is <code>true</code>.</p>
<p>When disabled, SQL that cannot be fully parsed is allowed to pass if the rules
do not cause it to be blocked. This can be used to provide a best-effort mode
where uncertainly about the SQL is allowed.</p>
<h2 id="rule-syntax">Rule syntax</h2>
<p>The rules are defined by using the following syntax:</p>
<div><pre><span></span>rule NAME match RULE [at_times VALUE...] [on_queries {select|update|insert|delete|grant|revoke|drop|create|alter|use|load}]
</pre></div>


<p>Where <em>NAME</em> is the identifier for this rule and <em>RULE</em> is the mandatory rule definition.</p>
<p>Rules are identified by their name and have mandatory parts and optional parts.
You can add comments to the rule files by adding the <code>#</code> character at
the beginning of the line. Trailing comments are not supported.</p>
<p>The first step of defining a rule is to start with the keyword <code>rule</code> which
identifies this line of text as a rule. The second token is identified as
the name of the rule. After that the mandatory token <code>match</code> is required
to mark the start of the actual rule definition.</p>
<p>The rule definition must contain exactly one mandatory rule parameter. It can
also contain one of each type of optional rule parameter.</p>
<h3 id="mandatory-rule-parameters">Mandatory rule parameters</h3>
<p>The Database Firewall filter's rules expect a single mandatory parameter for a
rule. You can define multiple rules to cover situations where you would like to
apply multiple mandatory rules to a query.</p>
<h4 id="wildcard"><code>wildcard</code></h4>
<p>This rule blocks all queries that use the wildcard character <code>*</code>.</p>
<h5 id="example">Example</h5>
<p>Use of the wildcard is not allowed:</p>
<div><pre><span></span>rule examplerule match wildcard
</pre></div>


<h4 id="columns"><code>columns</code></h4>
<p>This rule expects a list of values after the <code>columns</code> keyword. These values are
interpreted as column names and if a query targets any of these, it is matched.</p>
<h5 id="example_1">Example</h5>
<p>Deny name and salary columns:</p>
<div><pre><span></span>rule examplerule match columns name salary
</pre></div>


<h4 id="function"><code>function</code></h4>
<p>This rule expects a list of values after the <code>function</code> keyword. These values
are interpreted as function names and if a query uses any of these, it is
matched. The symbolic comparison operators (<code>&lt;</code>, <code>&gt;</code>, <code>&gt;=</code> etc.) are also
considered functions whereas the text versions (<code>NOT</code>, <code>IS</code>, <code>IS NOT</code> etc.) are
not considered functions.</p>
<h5 id="example_2">Example</h5>
<p>Match queries using the <em>sum</em> and <em>count</em> functions:</p>
<div><pre><span></span>rule examplerule match function sum count
</pre></div>


<h4 id="not_function"><code>not_function</code></h4>
<p>This rule expects a list of values after the <code>not_function</code> keyword. These values
are interpreted as function names and if a query uses any function other than these,
it is matched. The symbolic comparison operators (<code>&lt;</code>, <code>&gt;</code>, <code>&gt;=</code> etc.) are also
considered functions whereas the text versions (<code>NOT</code>, <code>IS</code>, <code>IS NOT</code> etc.) are
not considered functions.</p>
<p>If the rule is given no values, then the rule will match a query using any function.</p>
<h4 id="example_3">Example</h4>
<p>Match queries using other functions but the <em>length</em> function:</p>
<div><pre><span></span>rule examplerule match not_function length
</pre></div>


<p>Match queries using functions:</p>
<div><pre><span></span>rule examplerule match not_function
</pre></div>


<h4 id="uses_function"><code>uses_function</code></h4>
<p>This rule expects a list of column names after the keyword. If any of the
columns are used with a function, the rule will match. This rule can be
used to prevent the use of a column with a function.</p>
<h5 id="example_4">Example</h5>
<p>Deny function usage with <em>name</em> and <em>address</em> columns:</p>
<div><pre><span></span>rule examplerule match uses_function name address
</pre></div>


<h4 id="function-and-columns"><code>function</code> and <code>columns</code></h4>
<p>This rule combines the <code>function</code> and <code>columns</code> type rules to match if one
of the listed columns uses one of the listed functions. The rule expects
the <code>function</code> and <code>columns</code> keywords both followed by a list of values.</p>
<h5 id="example_5">Example</h5>
<p>Deny use of the <em>sum</em> function with <em>name</em> or <em>address</em> columns:</p>
<div><pre><span></span>rule examplerule match function sum columns name address
</pre></div>


<h4 id="not_function-and-columns"><code>not_function</code> and <code>columns</code></h4>
<p>This rule combines the <code>not_function</code> and <code>columns</code> type rules to match if
one of the listed columns is used in conjunction with functions other than
the listed ones. The rule expects the <code>not_function</code> and <code>columns</code> keywords
both followed by a list of values.</p>
<p>If <code>not_function</code> is not provided with a list of values, then the rule
matches if any of the columns is used with any function.</p>
<h5 id="example_6">Example</h5>
<p>Match if any other function but <em>length</em> is used with the <em>name</em> or <em>address</em>
columns:</p>
<div><pre><span></span>rule examplerule match not_function length columns name address
</pre></div>


<p>Match if any function is used with the _ssn_column:</p>
<div><pre><span></span>rule examplerule match not_function columns ssn
</pre></div>


<h4 id="regex"><code>regex</code></h4>
<p>This rule blocks all queries matching the regular expression. The regex string expects a
PCRE2 syntax regular expression. For more information about PCRE2 syntax, read the
<a href="http://www.pcre.org/current/doc/html/pcre2syntax.html">PCRE2 documentation</a>. Unlike
typical MaxScale regex parameters, the value should be enclosed in single or double
quotes, not in <code>/.../</code>. Any compilation options must be included in the pattern itself.</p>
<h5 id="example_7">Example</h5>
<p>Block selects to accounts:</p>
<div><pre><span></span>rule examplerule match regex '.*select.*from.*accounts.*'
</pre></div>


<h4 id="limit_queries"><code>limit_queries</code></h4>
<p>This rule has been DEPRECATED. Please use the Throttle Filter instead.</p>
<p>The limit_queries rule expects three parameters. The first parameter is the
number of allowed queries during the time period. The second is the time period
in seconds and the third is the amount of time in seconds for which the rule is
considered active and blocking.</p>
<p><strong>WARNING:</strong> Using <code>limit_queries</code> in <code>action=allow</code> is not supported.</p>
<h5 id="example_8">Example</h5>
<p>Over 50 queries within a window of 5 seconds will block for 100 seconds:</p>
<div><pre><span></span>rule examplerule match limit_queries 50 5 100
</pre></div>


<h4 id="no_where_clause"><code>no_where_clause</code></h4>
<p>This rule inspects the query and blocks it if it has no WHERE clause. For
example, this would disallow a <code>DELETE FROM ...</code> query without a <code>WHERE</code>
clause. This does not prevent wrongful usage of the <code>WHERE</code> clause e.g. <code>DELETE
FROM ... WHERE 1=1</code>.</p>
<h5 id="example_9">Example</h5>
<p>Queries must have a where clause:</p>
<div><pre><span></span>rule examplerule match no_where_clause
</pre></div>


<h3 id="optional-rule-parameters">Optional rule parameters</h3>
<p>Each mandatory rule accepts one or more optional parameters. These are to be
defined after the mandatory part of the rule.</p>
<h4 id="at_times"><code>at_times</code></h4>
<p>This rule expects a list of time ranges that define the times when the rule in
question is active. The time formats are expected to be ISO-8601 compliant and
to be separated by a single dash (the - character). For example, to define the
active period of a rule to be 5pm to 7pm, you would include <code>at times
17:00:00-19:00:00</code> in the rule definition. The rule uses local time to check if
the rule is active and has a precision of one second.</p>
<h4 id="on_queries"><code>on_queries</code></h4>
<p>This limits the rule to be active only on certain types of queries. The possible
values are:</p>
<table>
<thead>
<tr>
<th>Keyword</th>
<th>Matching operations</th>
</tr>
</thead>
<tbody>
<tr>
<td>select</td>
<td>SELECT statements</td>
</tr>
<tr>
<td>insert</td>
<td>INSERT statements</td>
</tr>
<tr>
<td>update</td>
<td>UPDATE statements</td>
</tr>
<tr>
<td>delete</td>
<td>DELETE statements</td>
</tr>
<tr>
<td>grant</td>
<td>All grant operations</td>
</tr>
<tr>
<td>revoke</td>
<td>All revoke operations</td>
</tr>
<tr>
<td>create</td>
<td>All create operations</td>
</tr>
<tr>
<td>alter</td>
<td>All alter operations</td>
</tr>
<tr>
<td>drop</td>
<td>All drop operations</td>
</tr>
<tr>
<td>use</td>
<td>USE operations</td>
</tr>
<tr>
<td>load</td>
<td>LOAD DATA operations</td>
</tr>
</tbody>
</table>
<p>Multiple values can be combined using the pipe character <code>|</code> e.g.
<code>on_queries select|insert|update</code>.</p>
<h3 id="applying-rules-to-users">Applying rules to users</h3>
<p>The <code>users</code> directive defines the users to which the rule should be applied.</p>
<p><code>users NAME... match { any | all | strict_all } rules RULE...</code></p>
<p>The first keyword is <code>users</code>, which identifies this line as a user definition
line.</p>
<p>The second component is a list of user names and network addresses in the format
<em><code>user</code></em><code>@</code><em><code>0.0.0.0</code></em>. The first part is the user name and the second part is
the network address. You can use the <code>%</code> character as the wildcard to enable
user name matching from any address or network matching for all users. After the
list of users and networks the keyword match is expected. This means that the
following user definitions are supported:</p>
<ul>
<li><code>user@host</code></li>
<li><code>user@%</code></li>
<li><code>%@host</code></li>
</ul>
<p>Partial wildcards, e.g. <code>user@192.%</code> are not supported.</p>
<p>As MaxScale listens to the IPv6 all address by default, IPv4 addresses will be
mapped into the IPv6 space. This means that the IPv4 address <code>192.168.0.1</code> will
show up in MaxScale as <code>::ffff:192.168.0.1</code>. Take this into account when
defining the <code>users</code> directives.</p>
<p>After this either the keyword <code>any</code>, <code>all</code> or <code>strict_all</code> is expected. This
defined how the rules are matched. If <code>any</code> is used when the first rule is
matched the query is considered as matched and the rest of the rules are
skipped. If instead the <code>all</code> keyword is used all rules must match for the query
to be considered as matched. The <code>strict_all</code> is the same as <code>all</code> but it checks the rules
from left to right in the order they were listed. If one of these does not
match, the rest of the rules are not checked. This could be useful in situations
where you would for example combine <code>limit_queries</code> and <code>regex</code> rules. By using
<code>strict_all</code> you can have the <code>regex</code> rule first and the <code>limit_queries</code> rule
second. This way the rule only matches if the <code>regex</code> rule matches enough times
for the <code>limit_queries</code> rule to match.</p>
<p>After the matching part comes the rules keyword after which a list of rule names
is expected. This allows reusing of the rules and enables varying levels of
query restriction.</p>
<p>If a particular <em>NAME</em> appears on several <code>users</code> lines, then when an
actual user matches that name, the rules of each line are checked
independently until there is a match for the statement in question. That
is, the rules of each <code>users</code> line are treated in an <em>OR</em> fashion with
respect to each other.</p>
<h2 id="module-commands">Module commands</h2>
<p>Read <a href="/kb/en/maxscale-21-06-module-commands/">Module Commands</a> documentation for
details about module commands.</p>
<p>The dbfwfilter supports the following module commands.</p>
<h3 id="rulesreload-filter-file"><code>rules/reload FILTER [FILE]</code></h3>
<p>Load a new rule file or reload the current rules. New rules are only taken into
use if they are successfully loaded and in cases where loading of the rules
fail, the old rules remain in use. The <em>FILTER</em> parameter is the filter instance
whose rules are reloaded. The <em>FILE</em> argument is an optional path to a rule file
and if it is not defined, the current rule file is used.</p>
<h3 id="rules-filter"><code>rules FILTER</code></h3>
<p>Shows the current statistics of the rules. The <em>FILTER</em> parameter is the filter
instance to inspect.</p>
<h2 id="use-cases">Use Cases</h2>
<h3 id="use-case-1-prevent-rapid-execution-of-specific-queries">Use Case 1 - Prevent rapid execution of specific queries</h3>
<p>To prevent the excessive use of a database we want to set a limit on the rate of
queries. We only want to apply this limit to certain queries that cause unwanted
behaviour. To achieve this we can use a regular expression.</p>
<p>First we define the limit on the rate of queries. The first parameter for the
rule sets the number of allowed queries to 10 queries and the second parameter
sets the rate of sampling to 5 seconds. If a user executes queries faster than
this, any further queries that match the regular expression are blocked for 60
seconds.</p>
<div><pre><span></span>rule limit_rate_of_queries match limit_queries 10 5 60
rule query_regex match regex '.*select.*from.*user_data.*'
</pre></div>


<p>To apply these rules we combine them into a single rule by adding a <code>users</code> line
to the rule file.</p>
<div><pre><span></span>users %@% match all rules limit_rate_of_queries query_regex
</pre></div>


<h3 id="use-case-2-only-allow-deletes-with-a-where-clause">Use Case 2 - Only allow deletes with a where clause</h3>
<p>We have a table which contains all the managers of a company. We want to prevent
accidental deletes into this table where the where clause is missing. This poses
a problem, we don't want to require all the delete queries to have a where
clause. We only want to prevent the data in the managers table from being
deleted without a where clause.</p>
<p>To achieve this, we need two rules. The first rule defines that all delete
operations must have a where clause. This rule alone does us no good so we need
a second one. The second rule blocks all queries that match a regular
expression.</p>
<div><pre><span></span>rule safe_delete match no_where_clause on_queries delete
rule managers_table match regex '.*from.*managers.*'
</pre></div>


<p>When we combine these two rules we get the result we want. To combine these two
rules add the following line to the rule file.</p>
<div><pre><span></span>users %@% match all rules safe_delete managers_table
</pre></div>
    </div>


        
            <div id="subscribe" class="well well-small hide hidden-print"
                 data-subscribe-url="/kb/en/mariadb-maxscale-2106-maxscale-2106-database-firewall-filter/+subscriptions/add"
                 data-unsubscribe-url="/kb/en/mariadb-maxscale-2106-maxscale-2106-database-firewall-filter/+subscriptions/remove">
            </div>
        

        
        
    
        <div class="simple_section_nav">
            <ul class="nav nav-pills">
                
                    <li><a href="/kb/en/mariadb-maxscale-2106-maxscale-2106-consistent-critical-read-filter/">
                        ← MaxScale 21.06  Consistent Critical Read Filter
                    </a>
                    </li>
                
                
                    <li><a href="/kb/en/maxscale-21-06-filters/">
                        ↑ MaxScale 21.06 Filters ↑
                    </a>
                    </li>
                
                
                    <li class="pull-right"><a href="/kb/en/mariadb-maxscale-2106-maxscale-2106-hintfilter/">
                        MaxScale 21.06  Hintfilter →
                    </a>
                    </li>
                
            </ul>
        </div>
    

        

        
        <h2>Comments</h2>
        
    
    <div id="comments" data-node-id="14708" data-comments-url="/kb/en/mariadb-maxscale-2106-maxscale-2106-database-firewall-filter/+comments"
         data-reply-url="/kb/en/mariadb-maxscale-2106-maxscale-2106-database-firewall-filter/comments/post/">
        Comments loading...
    </div>

        

    </div>


                    <div id="content_disclaimer" class="graybox">
                        Content reproduced on this site is the property of its respective owners,
                        and this content is not reviewed in advance by MariaDB. The views, information and opinions
                        expressed by this content do not necessarily represent those of MariaDB or any other party.
                    </div>
                </div>
            </section>

            
                <div id="right_bar" class="col-md-2">
                    
    
        
        <ul class="section_navigation well well-small hidden-xs hidden-sm">
            
                <li class="parent"><a href="/kb/en/maxscale-21-06-filters/">
                    ↑ MaxScale 21.06 Filters ↑
                </a>
                </li>
            
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-2106-maxscale-2106-binlog-filter/">
                            
                            MaxScale 21.06  Binlog Filter
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-2106-cache/">
                            
                            MaxScale 21.06  Cache
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-2106-maxscale-2106-consistent-critical-read-filter/">
                            
                            MaxScale 21.06  Consistent Critical Read Filter
                        </a>
                    </li>
                
            
                
                    <li class="active">
                        <span>MaxScale 21.06  Database Firewall filter</span>
                        
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-2106-maxscale-2106-hintfilter/">
                            
                            MaxScale 21.06  Hintfilter
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-2106-maxscale-2106-insert-stream-filter/">
                            
                            MaxScale 21.06  Insert Stream Filter
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-2106-maxscale-2106-lua-filter/">
                            
                            MaxScale 21.06  Lua Filter
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-2106-maxscale-2106-masking/">
                            
                            MaxScale 21.06  Masking
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-2106-maxscale-2106-maxrows/">
                            
                            MaxScale 21.06  Maxrows
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-2106-maxscale-2106-named-server-filter/">
                            
                            MaxScale 21.06  Named Server Filter
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-2106-maxscale-2106-query-log-all-filter/">
                            
                            MaxScale 21.06  Query Log All Filter
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-2106-maxscale-2106-regex-filter/">
                            
                            MaxScale 21.06  Regex Filter
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-2106-maxscale-2106-tee-filter/">
                            
                            MaxScale 21.06  Tee Filter
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-2106-maxscale-2106-throttle/">
                            
                            MaxScale 21.06  Throttle
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-2106-maxscale-2106-top-filter/">
                            
                            MaxScale 21.06  Top Filter
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-2106-maxscale-2106-transaction-performance-monitoring-filter/">
                            
                            MaxScale 21.06  Transaction Performance Monitoring Filter
                        </a>
                    </li>
                
            
        </ul>
    
    

                </div>
            
        </div>
    </div>
</div>

<!-- Footer -->
<footer id="footer">
    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-xs-12">
                    <ul class="list-inline text-center footer-nav">
                        <li>
                            <h5>
                                <a href="https://mariadb.com/products" title="Products">Products</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/services" title="Services">Services</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/pricing" title="Pricing">Pricing</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/resources" title="Resources">Resources</a>
                            </h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/about-us" title="About MariaDB">About Us</a></h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/download" title="Download">Download MariaDB</a></h5>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="row row-10">
                
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div id="block-footerformcontact" class="block block-block-content block-block-contentd754ee1b-3cc9-40e7-9ef4-f504f1197fb1">
                        
                            <h5 style="font-weight: 400;">Subscribe to our newsletter!</h5>
                            <script src="//app-sj15.marketo.com/js/forms2/js/forms2.min.js"></script><form id="mktoForm_1498"></form>
                            <script>
                                <!--//--><![CDATA[// ><!--
                                MktoForms2.loadForm("//app-sj15.marketo.com", "573-PXI-984", 1498);
                                //--><!]]]]><![CDATA[>
                                //--><!]]>
                            </script>
                        
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div class="footer-copyright">
                        <div class="text-center">
                            <ul class="list-inline no-margin">
                                <li>
                                    <a href="/legal" title="Legal">Legal</a>
                                </li>
                                <li>
                                    <a href="/privacy-policy" title="Privacy Policy">Privacy Policy</a>
                                </li>
                                <li>
                                    <a href="/cookie-policy/" title="Cookies">Cookie Policy</a>
                                </li>
                            </ul>
                            <p>Copyright &copy; 2025 MariaDB. All rights reserved.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</footer>
</div>

<div id="ajax_loading">
    <img src="/kb/static/images/ajax-loader.a51c5608d01a.gif" />
</div>

    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MK2847"
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MK2847');</script>
    <!-- End Google Tag Manager -->

</body>

<script type="text/javascript" src="/kb/static/js/main.1587e3a666fc.js" charset="utf-8"></script>

</html>