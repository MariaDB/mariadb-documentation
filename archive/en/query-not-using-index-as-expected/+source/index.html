<!DOCTYPE html>
<html>
<head data-cookie-domain=""
      data-cookie-path="/">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="apple-touch-icon" sizes="180x180" href="/kb/static/images/favicons/apple-touch-icon.159e713979be.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/kb/static/images/favicons/favicon-32x32.bc0ac1d5d11e.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/kb/static/images/favicons/favicon-16x16.5801f8f0f34e.png">
    <link rel="shortcut icon" href="/kb/static/images/favicons/favicon.d122d305dee4.ico" type="image/x-icon" />

    <title>Query Not Using Index as Expected - Source - MariaDB Knowledge Base</title>

    <link href="/kb/static/css/main.b9e1e104f007.css" rel="stylesheet" type="text/css" />

    
        <meta name="robots" content="noindex, nofollow">
    

    <!-- FB Open Graph tags -->
    <meta property="og:title" content="Query Not Using Index as Expected - Source" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://mariadb.com/kb/en/query-not-using-index-as-expected/+source/" />
    <meta property="og:image" content="http://mariadb.comaskmonty-logo.png" />
    <meta property="og:site_name" content="MariaDB KnowledgeBase" />
    <meta property="fb:admins" content="514852603" />
    <meta property="og:description" content="" />

    <meta name="description" content="" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet"/>
    
</head>
<body class="mpkb nodes autoresize nodes_source jqui" id="nodes_source">





<div id="menu-mobile" class="visible-sm visible-xs">

    <div>
        <div id="mobile-close-menu" class="text-right">
            <a href="javascript:void(0)" title="Close Menu" id="back-main" class="toggle-menu">X<span></span></a>
        </div>
    </div>
    <div class="mainmenu-mobile">
        <ul class="ls-none ul-menu">
            <li data-sub="submenu5"><a class="open-form-search" href="/kb/search/" title="Search">Search </a></li>
            <li data-sub="submenu0"><a href="/products" title="Products">Products</a><span class="arrow-main"></span></li>
            <li data-sub="submenu1"><a href="/services" title="Services">Services</a><span class="arrow-main"></span></li>
            <li data-sub="submenu2"><a href="/resources" title="Resources">Resources</a><span class="arrow-main"></span></li>
            <li data-sub="submenu3"><a href="/about-us" title="About">About</a><span class="arrow-main"></span></li>
            <li data-sub="submenu4"><a href="/contact" title="Contact">Contact</a></li>
        </ul>
    </div>

    <div class="nav-top-mobile">
        <div class="select-box form">

            <ul class="inline-block-md mb-none top-nav">
                <li>

                </li>
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/query-not-using-index-as-expected/+source/"> Login</a>
                    </li>
                
            </ul>



        </div>
        <p class="text-center copyright">Copyright &copy; 2024 MariaDB. All rights reserved.</p>
    </div>
</div>
<div id="wrapper">
<div id="top-nav">
    <div class="container">
        <ul class="hidden-sm hidden-xs" >
            <li><a href="https://mariadb.com/kb/">Knowledge Base</a></li>
            <li><a href="https://mariadb.com/contact/">Contact</a></li>
            
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/query-not-using-index-as-expected/+source/" rel="nofollow">Login</a>
                    </li>
                
            
            
            <li id="search-form">
                <form action="/kb/en/+search/" method="get" id="search-block-form" accept-charset="UTF-8">
                    <input id="search" title="Enter the terms you wish to search for."
                           placeholder="Search . . ." type="text"
                           name="q" value="" size="15" maxlength="128" class="form-text"
                           data-autocomplete-url="/kb/en/+search/autocomplete/">
                    <input type="hidden" name="quick" value="1" />
                    <input type="hidden" name="source" value="kb" />
                </form>
            </li>
            <li><a id="search-toggler" href="/kb/search/">Search</a></li>
            
        </ul>
    </div>
</div>
<div id="navbar-bottom" class="navbar">
    <div class="container">
        
        
        
        
        <div class="row">
            <div class="col-md-3 col-sm-9 col-xs-9">
                <a class="brand" href="/" title="MariaDB">
                    <img src="/kb/static/images/logo-2018-black.95f5978ae14d.png">
                </a>
            </div>
            <div class="col-md-9 hidden-sm hidden-xs">
                <div class="main-menu">
                    <ul id="main-menu" class="nav navbar-nav inline-block-sm">
    <li class="has-sub full-menu">
        <a href="/products" title="Products">Products</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/services" title="Services">Services</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/pricing" title="Pricing">Pricing</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/resources" title="Resources">Resources</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/about-us" title="About Us">About Us</a>
    </li>
    <li class="">
        <a class="button electric-eel small top-bar-right-download" href="/downloads/">Download</a>
    </li>
</ul>
                </div>
            </div>
            <div class="col-md-3 visible-sm visible-xs col-sm-3 col-xs-3 ps-rv">
                <div class="navbar-header text-right pull-right">
                    <button type="button" class="menu-control toggle-menu" id="open-menu">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="main">
    <div class="container">
        

        <div id="subheader1" class="clearfix">
            <div class="pull-left">
                
                <div id="breadcrumbs" class="breadcrumb">
                    <a href="/kb/en/">Knowledge Base</a>
                    


    
    » <a class="crumb" href="/kb/en/community/">The Community</a>
    


    » <a class="node_link crumb" href="/kb/en/query-not-using-index-as-expected/">Query Not Using Index as Expected</a>


                </div>
                
            </div>
        </div>
    </div>
    <div class="container" id="container-main">
        <div class="row">
            
            
                
                <aside id="sidebar-first" class="sidebar col-md-2 hidden-xs hidden-sm hidden-print">
                    
                        
                        <ul id="category_menu" class="nav nav-pills nav-stacked">
                            <li><a href="/kb/en/">Home</a></li>
                            
                                
                                    <li><a href="/kb/en/+questions/">Open Questions</a></li>
                                
                                <li><a href="/kb/en/documentation/">MariaDB Server</a></li>
                                <li><a href="/kb/en/maxscale/">MariaDB MaxScale</a></li>
                                <li><a href="/kb/en/mariadb-columnstore/">MariaDB ColumnStore</a></li>
                                <li><a href="/kb/en/connectors/">Connectors</a></li>
                            

                        </ul>
                    

                    
                        <div>
    

<div class="well well-small box actions"><div>

        <a class="btn btn-block btn-small" href="/kb/en/query-not-using-index-as-expected/">Return to question</a>
    
</div>
</div>

</div>
                    

                    

































                </aside>
            
            
            
                
            
            
            <section id="content" class="limited_width col-md-10 clearfix">
                
                    <h1>Query Not Using Index as Expected - Source</h1>
                

                



                <div>
                    

    

    
    <div class="revision_info">
        <dl class="table">
            <dt>Revision</dt>
            <dd><a href="/kb/en/query-not-using-index-as-expected/+r/109685/">109685</a></dd>
            <dt>User</dt>
            <dd>
<span class="user" id="user-11043">
<a href="/kb/user/id/11043" title="Stephen Rynas">Stephen Rynas</a>
</span></dd>
            <dt>Date</dt>
            <dd>

<span class="datetime" title="2021-08-30 19:55">2021-08-30 19:55</span></dd>
        </dl>
    </div>
    


    
        <textarea id="question_source" class="creole_source autogrow">I an using phpMyAdmin with MariaDB Server version: 10.3.31-MariaDB-0ubuntu0.20.04.1-log - Ubuntu 20.04. My Linux version is actually Mint 20.2. I decided to look &#34;under the hood&#34; with phpAdmin&#39;s &#34;Advisor&#34; to check things out. I have what should be considered a small home database. I have not observed any performance concerns, but based on what the &#34;Advisor&#34; is reporting in phpMyAdmin, I have significant &#34;tuning&#34; concerns. I believe that I may have narrowed one issue down to the variable &lt;&lt;code inline=true&gt;&gt;&#34;handler_read_rnd&#34;&lt;&lt;/code&gt;&gt;. The following query serves as an example:

&lt;&lt;sql inline=false&gt;&gt;
Select IssueIDNUM, IssueDate, MagazineName 
    FROM tblMagazineIssueList
	JOIN tblMagazineList
        ON MagazineIDNUM = MagazineNUM 
	ORDER BY  IssueDate DESC, MagazineNUM,IssueIDNUM;
&lt;&lt;/sql&gt;&gt;

MagazineIDNUM is the primary key in tblMagazineIssueList.\\
MagazineNUM is a foreign key in tblMagazineIssueList which derives from the primary key in tblMagazineList 

The slow query log did not show anything after the query was run. However, the query immediately prior to the query above did show-up in the slow query log.

slow query log reports:\\
--------------------------------------------------------------------------\\
&lt;&lt;style style=&#34; font-style: italic;&#34;&gt;&gt;
use sfmedia;\\
SET timestamp=1629911455;\\
Select IssueIDNUM,MagazineNUM FROM tblMagazineIssueList ORDER by IssueDate DESC, IssueIDNUM;\\
Time: 210825 13:11:38\\
User@Host: steve[steve] @ localhost []\\
Thread_id: 1726  Schema: sfmedia  QC_hit: No\\
Query_time: 0.001013  Lock_time: 0.000038  Rows_sent: 2221  Rows_examined: 4442\\
Rows_affected: 0  Bytes_sent: 23537\\
SET timestamp=1629911498;\\
Select IssueIDNUM,MagazineNUM FROM tblMagazineIssueList ORDER by IssueDate DESC, IssueIDNUM;\\
User@Host: steve[steve] @ localhost []\\
Thread_id: 1726  Schema: sfmedia  QC_hit: No\\
Query_time: 0.002545  Lock_time: 0.000024  Rows_sent: 2221  Rows_examined: 6669\\
Rows_affected: 0  Bytes_sent: 85787\\
SET timestamp=1629911498;\\
Select IssueIDNUM, IssueDate, MagazineName \\
    FROM tblMagazineIssueList\\
	JOIN tblMagazineList\\
           ON MagazineIDNUM = MagazineNUM \\
	ORDER BY  IssueDate DESC, MagazineNUM,IssueIDNUM;\\
&lt;&lt;/style&gt;&gt;
---------------------------------------------------------------\\
Slow query log ends here. Nothing below the &#34;ORDER BY&#34;.  As such the slow query log does not identify any problem with the query.\\

After refreshing the tab &#34;status&#34;, the following red items increased in value:\\
--------------------------------------------------------------\\
&lt;&lt;code inline=true&gt;&gt;&#34;handler_read_rnd&#34;&lt;&lt;/code&gt;&gt; went from  80.4 k to 82.6K\\
&lt;&lt;code inline=true&gt;&gt;&#34;handler_read_rnd&#34;&lt;&lt;/code&gt;&gt; went from 27 to 29

All other &#34;notifications&#34; in red, remained the same.\\
---------------------------------------------------------------\\

The message associate with the variable &lt;&lt;code inline=true&gt;&gt;&#34;handler_read_rnd&#34;&lt;&lt;/code&gt;&gt; reads:
&lt;&lt;style style=&#34; font-style: italic;&#34;&gt;&gt;&#34;The number of requests to read a row based on a fixed position. This is high if you are doing a lot of queries that require sorting of the result. You probably have a lot of queries that require MySQL to scan whole tables or you have joins that don&#39;t use keys properly.&#34; &lt;&lt;/style&gt;&gt;

I suspect the message above means that something, but what, is wrong?\\

-----------------------------------------------------------------------------------------\\
Increased the values of some variables by x100 (added two 00) as an attempt to eliminate the variables below  as a potential issue.  These changes are probably unnecessary as this is a small database for home use and not an enterprise sized database. Included for reference purposes.

tmp_table_size=1677721600             #Default=16777216\\
max_heap_table_size=1677721600  #Default=16777216\\
table_open_cache=20000                 #Default=2000\\     
key_buffer_size=1342177280           #Default=134217728\\
sort_buffer_size=209715200            #Default=2097152\\</textarea>
    

    
        
            <h2>Answer</h2>
        
        <textarea id="answer_source" class="creole_source autogrow">sort_buffer_size may have an effect, but looking at you slow query log for  Rows_examined it doesn&#39;t seem likely.

Please include [[show-create-table|SHOW CREATE TABLE]] information for both tables.  If you want to cut this down to just the fields and indexes of the table that&#39;s ok.

Use [[analyze-formatjson-examples|ANALYZE FORMAT=JSON]] to show how the query is being executed. [[slow-query-log-extended-statistics/#log_slow_verbosity|log_slow_verbosity]] can help get some extended information in the slow query log.

Contrary to the implication of phpmyadmin advice, you can&#39;t tune yourself out of every problem. You query returns the entire data from two entire tables. The recommendation on handler_read_rnd is based on the assumption you don&#39;t read entire tables often and that when MariaDB does read the entire tables, its because it isn&#39;t index right.

Is this query really a problem? The table sizes seem quite small and I suspect you are getting less than a 10ms response time.</textarea>
    


                    <div id="content_disclaimer" class="graybox">
                        Content reproduced on this site is the property of its respective owners,
                        and this content is not reviewed in advance by MariaDB. The views, information and opinions
                        expressed by this content do not necessarily represent those of MariaDB or any other party.
                    </div>
                </div>
            </section>

            
        </div>
    </div>
</div>

<!-- Footer -->
<footer id="footer">
    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-xs-12">
                    <ul class="list-inline text-center footer-nav">
                        <li>
                            <h5>
                                <a href="https://mariadb.com/products" title="Products">Products</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/services" title="Services">Services</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/pricing" title="Pricing">Pricing</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/resources" title="Resources">Resources</a>
                            </h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/about-us" title="About MariaDB">About Us</a></h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/download" title="Download">Download MariaDB</a></h5>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="row row-10">
                
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div id="block-footerformcontact" class="block block-block-content block-block-contentd754ee1b-3cc9-40e7-9ef4-f504f1197fb1">
                        
                            <h5 style="font-weight: 400;">Subscribe to our newsletter!</h5>
                            <script src="//app-sj15.marketo.com/js/forms2/js/forms2.min.js"></script><form id="mktoForm_1498"></form>
                            <script>
                                <!--//--><![CDATA[// ><!--
                                MktoForms2.loadForm("//app-sj15.marketo.com", "573-PXI-984", 1498);
                                //--><!]]]]><![CDATA[>
                                //--><!]]>
                            </script>
                        
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div class="footer-copyright">
                        <div class="text-center">
                            <ul class="list-inline no-margin">
                                <li>
                                    <a href="/legal" title="Legal">Legal</a>
                                </li>
                                <li>
                                    <a href="/privacy-policy" title="Privacy Policy">Privacy Policy</a>
                                </li>
                                <li>
                                    <a href="/cookie-policy/" title="Cookies">Cookie Policy</a>
                                </li>
                            </ul>
                            <p>Copyright &copy; 2024 MariaDB. All rights reserved.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</footer>
</div>

<div id="ajax_loading">
    <img src="/kb/static/images/ajax-loader.a51c5608d01a.gif" />
</div>

    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MK2847"
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MK2847');</script>
    <!-- End Google Tag Manager -->

</body>

<script type="text/javascript" src="/kb/static/js/main.fed4ec768178.js" charset="utf-8"></script>

</html>