<!DOCTYPE html>
<html>
<head data-cookie-domain=""
      data-cookie-path="/">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="apple-touch-icon" sizes="180x180" href="/kb/static/images/favicons/apple-touch-icon.159e713979be.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/kb/static/images/favicons/favicon-32x32.bc0ac1d5d11e.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/kb/static/images/favicons/favicon-16x16.5801f8f0f34e.png">
    <link rel="shortcut icon" href="/kb/static/images/favicons/favicon.d122d305dee4.ico" type="image/x-icon" />

    <title>ColumnStore Window Functions - MariaDB Knowledge Base</title>

    <link href="/kb/static/css/main.f7633538c846.css" rel="stylesheet" type="text/css" />

    

    

    <!-- FB Open Graph tags -->
    <meta property="og:title" content="ColumnStore Window Functions" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://mariadb.com/kb/en/columnstore-window-functions/" />
    <meta property="og:image" content="http://mariadb.comaskmonty-logo.png" />
    <meta property="og:site_name" content="MariaDB KnowledgeBase" />
    <meta property="fb:admins" content="514852603" />
    <meta property="og:description" content="
Introduction
MariaDB ColumnStore provides support for window functions broadly following the SQL 2003 specification. A window function allows for calculations relating to a w..." />

    <meta name="description" content="
Introduction
MariaDB ColumnStore provides support for window functions broadly following the SQL 2003 specification. A window function allows for calculations relating to a w..." />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet"/>
    
</head>
<body class="mpkb nodes products nodes_view jqui" id="nodes_view">





<div id="menu-mobile" class="visible-sm visible-xs">

    <div>
        <div id="mobile-close-menu" class="text-right">
            <a href="javascript:void(0)" title="Close Menu" id="back-main" class="toggle-menu">X<span></span></a>
        </div>
    </div>
    <div class="mainmenu-mobile">
        <ul class="ls-none ul-menu">
            <li data-sub="submenu5"><a class="open-form-search" href="/kb/search/" title="Search">Search </a></li>
            <li data-sub="submenu0"><a href="/products" title="Products">Products</a><span class="arrow-main"></span></li>
            <li data-sub="submenu1"><a href="/services" title="Services">Services</a><span class="arrow-main"></span></li>
            <li data-sub="submenu2"><a href="/resources" title="Resources">Resources</a><span class="arrow-main"></span></li>
            <li data-sub="submenu3"><a href="/about-us" title="About">About</a><span class="arrow-main"></span></li>
            <li data-sub="submenu4"><a href="/contact" title="Contact">Contact</a></li>
        </ul>
    </div>

    <div class="nav-top-mobile">
        <div class="select-box form">

            <ul class="inline-block-md mb-none top-nav">
                <li>

                </li>
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/columnstore-window-functions/"> Login</a>
                    </li>
                
            </ul>



        </div>
        <p class="text-center copyright">Copyright &copy; 2024 MariaDB. All rights reserved.</p>
    </div>
</div>
<div class="violator-wrap d-none" id="top_violator">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12">
                <div class="violator-outer">
                    <div class="violator-inner">
                        <div class="row">
                            <div class="col-xs-12 col-sm-9 col-lg-7 col-lg-offset-2" id="top_violator_content">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="content-link" target="_blank" rel="nofollow noreferrer">
                                    <span>The Ultimate Guide to High Availability with MariaDB</span>
                                </a>
                            </div>
                            <div class="col-xs-12 col-sm-3" id="top_violator_cta">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="btn btn-mariadb" target="_blank" rel="nofollow noreferrer">Download Now</a>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-link close-btn">
                        <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24" width="15px" height="15px"><path d="M 4.9902344 3.9902344 A 1.0001 1.0001 0 0 0 4.2929688 5.7070312 L 10.585938 12 L 4.2929688 18.292969 A 1.0001 1.0001 0 1 0 5.7070312 19.707031 L 12 13.414062 L 18.292969 19.707031 A 1.0001 1.0001 0 1 0 19.707031 18.292969 L 13.414062 12 L 19.707031 5.7070312 A 1.0001 1.0001 0 0 0 18.980469 3.9902344 A 1.0001 1.0001 0 0 0 18.292969 4.2929688 L 12 10.585938 L 5.7070312 4.2929688 A 1.0001 1.0001 0 0 0 4.9902344 3.9902344 z"/></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="wrapper">
<div id="top-nav">
    <div class="container">
        <ul class="hidden-sm hidden-xs" >
            <li><a href="https://mariadb.com/kb/">Knowledge Base</a></li>
            <li><a href="https://mariadb.com/contact/">Contact</a></li>
            
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/columnstore-window-functions/" rel="nofollow">Login</a>
                    </li>
                
            
            
            <li id="search-form">
                <form action="/kb/en/+search/" method="get" id="search-block-form" accept-charset="UTF-8">
                    <input id="search" title="Enter the terms you wish to search for."
                           placeholder="Search . . ." type="text"
                           name="q" value="" size="15" maxlength="128" class="form-text"
                           data-autocomplete-url="/kb/en/+search/autocomplete/">
                    <input type="hidden" name="quick" value="1" />
                    <input type="hidden" name="source" value="kb" />
                </form>
            </li>
            <li><a id="search-toggler" href="/kb/search/">Search</a></li>
            
        </ul>
    </div>
</div>
<div id="navbar-bottom" class="navbar">
    <div class="container">
        
        
        
        
        <div class="row">
            <div class="col-md-3 col-sm-9 col-xs-9">
                <a class="brand" href="/" title="MariaDB">
                    <img src="/kb/static/images/logo-2018-black.95f5978ae14d.png">
                </a>
            </div>
            <div class="col-md-9 hidden-sm hidden-xs">
                <div class="main-menu">
                    <ul id="main-menu" class="nav navbar-nav inline-block-sm">
    <li class="has-sub full-menu">
        <a href="/products" title="Products">Products</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/services" title="Services">Services</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/pricing" title="Pricing">Pricing</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/resources" title="Resources">Resources</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/about-us" title="About Us">About Us</a>
    </li>
    <li class="">
        <a class="button electric-eel small top-bar-right-download" href="/downloads/">Download</a>
    </li>
</ul>
                </div>
            </div>
            <div class="col-md-3 visible-sm visible-xs col-sm-3 col-xs-3 ps-rv">
                <div class="navbar-header text-right pull-right">
                    <button type="button" class="menu-control toggle-menu" id="open-menu">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="main">
    <div class="container">
        

        <div id="subheader1" class="clearfix">
            <div class="pull-left">
                
                <div id="breadcrumbs" class="breadcrumb">
                    <a href="/kb/en/">Knowledge Base</a>
                    


    
    » <a class="crumb" href="/kb/en/documentation/">MariaDB Server Documentation</a>
    

    
    » <a class="crumb" href="/kb/en/columns-storage-engines-and-plugins/">Columns, Storage Engines, and Plugins</a>
    

    
    » <a class="crumb" href="/kb/en/storage-engines/">Storage Engines</a>
    

    
    » <a class="crumb" href="/kb/en/mariadb-columnstore/">MariaDB ColumnStore</a>
    

    
    » <a class="crumb" href="/kb/en/columnstore-sql-structure-and-commands/">ColumnStore SQL Structure and Commands</a>
    


    » <a class="node_link crumb" href="/kb/en/columnstore-window-functions/">ColumnStore Window Functions</a>


                </div>
                
            </div>
        </div>
    </div>
    <div class="container" id="container-main">
        <div class="row">
            
            
                
                <aside id="sidebar-first" class="sidebar col-md-2 hidden-xs hidden-sm hidden-print">
                    
                        
                        <ul id="category_menu" class="nav nav-pills nav-stacked">
                            <li><a href="/kb/en/">Home</a></li>
                            
                                
                                    <li><a href="/kb/en/+questions/">Open Questions</a></li>
                                
                                <li><a href="/kb/en/documentation/">MariaDB Server</a></li>
                                <li><a href="/kb/en/maxscale/">MariaDB MaxScale</a></li>
                                <li><a href="/kb/en/mariadb-columnstore/">MariaDB ColumnStore</a></li>
                                <li><a href="/kb/en/connectors/">Connectors</a></li>
                            

                        </ul>
                    

                    
<div>



<div class="well well-small box actions"><div>

        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/columnstore-window-functions/+history" rel="nofollow">History</a>
        
        
        
        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/columnstore-window-functions/+source/">Source</a>
        
        <a class="btn btn-block btn-blue btn-sm flag" href="/kb/en/columnstore-window-functions/+flag"
                data-flag-url="/kb/en/columnstore-window-functions/+flag" rel="nofollow">
                Flag as Spam / Inappropriate</a>
        
        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/columnstore-window-functions/+translate/">
                Translate</a>
        

</div>
</div>





<div class="well well-small box node_info"><div>

    <dl>
        <dt>Created</dt>
        <dd>

<span class="datetime" title="2016-11-08 00:44">8 years, 1 month ago</span></dd>

        <dt>Modified</dt>
        <dd>

<span class="datetime" title="2020-02-02 10:01">4 years, 11 months ago</span></dd>

        <dt>Type</dt>
        <dd>article</dd>

        <dt>Status</dt>
        <dd>active</dd>

        <dt>License</dt>
        <dd>
            
                <a href="/kb/en/columnstore-window-functions/+license/">CC BY-SA / Gnu FDL</a>
            
        </dd>

        
    </dl>

    
    <ul class="rss_feeds">
        <li><a href="/kb/en/columnstore-window-functions/+history/feed/">
            History</a>
        </li>
        <li><a href="/kb/en/columnstore-window-functions/+comments/feed/">
            Comments</a>
        </li>
    </ul>
    

</div>
</div>





    
    
    

<div class="well well-small box attachments"><div><div class="edit_link pull-right"><a href="/kb/en/columnstore-window-functions/+edit/attachments/">Edit</a></div><h5>Attachments</h5></div><div>

        
            <ul>
                
                    <li><a href="/kb/en/columnstore-window-functions/+attachment/opp_window_example">opp_window_example</a><br />example schema, data, and queries for window functions.
                    </li>
                
            </ul>
        
    
</div>
</div>

    



    
    






</div>


                    

































                </aside>
            
            
            
                
            
            
                
            
            <section id="content" class="limited_width col-md-8 clearfix">
                
                    <h1>ColumnStore Window Functions</h1>
                

                



                <div>
                    
    

    
    
    

    <div class="node creole">
        
        
        


    
    <div class="answer formatted">
        <div class="table_of_contents standalone"> <ol class="toc">

 <li class=""><a href="#introduction" title="Introduction">Introduction</a></li>

 <li class=""><a href="#syntax" title="Syntax">Syntax</a></li>

 <li class=""><a href="#supported-functions" title="Supported Functions">Supported Functions</a> <ol class="toc">

    <li class=""><a href="#note" title="Note">Note</a> </ol>
</li>

 <li class=""><a href="#examples" title="Examples">Examples</a> <ol class="toc">

    <li class=""><a href="#example-schema" title="Example Schema">Example Schema</a></li>

    <li class=""><a href="#cumulative-sum-and-running-max-example" title="Cumulative Sum and Running Max Example">Cumulative Sum and Running Max Example</a></li>

    <li class=""><a href="#partitioned-cumulative-sum-and-running-max-example" title="Partitioned Cumulative Sum and Running Max Example">Partitioned Cumulative Sum and Running Max Example</a></li>

    <li class=""><a href="#ranking-top-results" title="Ranking / Top Results">Ranking / Top Results</a></li>

    <li class=""><a href="#first-and-last-values" title="First and Last Values">First and Last Values</a></li>

    <li class=""><a href="#prior-and-next-example" title="Prior and Next Example">Prior and Next Example</a></li>

    <li class=""><a href="#quartiles-example" title="Quartiles Example">Quartiles Example</a></li>

    <li class=""><a href="#percentile-example" title="Percentile Example">Percentile Example</a> </ol>
</li>
</div>
<h1 class="anchored_heading" id="introduction">Introduction</h1>
<p>MariaDB ColumnStore provides support for window functions broadly following the SQL 2003 specification. A window function allows for calculations relating to a window of data surrounding the current row in a result set. This capability provides for simplified queries in support of common business questions such as cumulative totals, rolling averages, and top 10 lists.</p>
<p>Aggregate functions are utilized for window functions however differ in behavior from a group by query because the rows remain ungrouped. This provides support for cumulative  sums and rolling averages, for example.</p>
<p>Two key concepts for window functions are Partition and Frame:</p>
<ul start="1"><li>A Partition is a group of rows, or window, that have the same value for a specific column, for example a Partition can be created over a time period such as a quarter or lookup values.
</li><li>The Frame for each row  is a subset of the row's Partition. The frame typically is dynamic allowing for a sliding frame of rows within the Partition. The Frame determines the range of rows for the windowing function. A Frame could be defined as the last X rows and next Y rows all the way up to the entire Partition.
</li></ul>
<p>Window functions are applied after joins, group by, and having clauses are calculated.</p>
<h1 class="anchored_heading" id="syntax">Syntax</h1>
<p>A window function is applied in the select clause using the following syntax:</p>
<pre>
function_name ([expression [, expression ... ]]) OVER ( window_definition )
</pre>
<p>where <em>window_definition</em> is defined as:</p>
<pre>
[ PARTITION BY expression [, ...] ]
[ ORDER BY expression [ ASC | DESC ] [ NULLS { FIRST | LAST } ] [, ...] ]
[ frame_clause ]
</pre>
<p>PARTITION BY:</p>
<ul start="1"><li>Divides the window result set into groups based on one or more <em>expressions</em>.
</li><li>An expression may be a constant, column, and non window function expressions.
</li><li>A query is not limited to a single partition by clause. Different partition clauses can be used across different window function applications.
</li><li>The partition by columns do not need to be in the select list but do need to be available from the query result set.
</li><li>If there is no PARTITION BY clause, all rows of the result set define the group.
</li></ul>
<p>ORDER BY</p>
<ul start="1"><li>Defines the ordering of values within the partition.
</li><li>Can be ordered by multiple keys which may be a constant, column or non window function expression.
</li><li>The order by columns do not need to be in the select list but need to be available from the query result set.
</li><li>Use of a select column alias from the query is not supported.
</li><li>ASC (default) and DESC options allow for ordering ascending or descending.
</li><li>NULLS FIRST and NULL_LAST options specify whether null values come first or last in the ordering sequence. NULLS_FIRST is the default for ASC order, and NULLS_LAST is the default for DESC order.
</li></ul>
<p>and the optional <em>frame_clause</em> is defined as:</p>
<pre>
{ RANGE | ROWS } frame_start
{ RANGE | ROWS } BETWEEN frame_start AND frame_end
</pre>
<p>and the optional <em>frame_start</em> and <em>frame_end</em> are defined as (value being a numeric expression):</p>
<pre>
UNBOUNDED PRECEDING
value PRECEDING
CURRENT ROW
value FOLLOWING
UNBOUNDED FOLLOWING
</pre>
<p>RANGE/ROWS:</p>
<ul start="1"><li>Defines the windowing clause for calculating the set of rows that the function applies to for calculating a given rows window function result.
</li><li>Requires an ORDER BY clause to define the row order for the window.
</li><li>ROWS specify the window in physical units, i.e. result set rows and must be a constant or expression evaluating to a positive numeric value.
</li><li>RANGE specifies the window as a logical offset. If the the expression evaluates to a numeric value then the ORDER BY expression must be a numeric or DATE type. If the expression evaluates to an interval value then the ORDER BY expression must be a DATE data type.
</li><li>UNBOUNDED PRECEDING indicates the window starts at the first row of the partition.
</li><li>UNBOUNDED FOLLOWING indicates the window ends at the last row of the partition.
</li><li>CURRENT ROW specifies the window start or ends at the current row or value.
</li><li>If omitted, the default is ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW.
</li></ul>
<h1 class="anchored_heading" id="supported-functions">Supported Functions</h1>
<table><tr><th>Function</th><th>Description</th></tr>
<tr><td>AVG()</td><td>The average of all input values.</td></tr>
<tr><td>CORR(ColumnY, ColumnX)</td><td>The correlation coefficient for non-null pairs in a group.</td></tr>
<tr><td>COUNT()</td><td>Number of input rows.</td></tr>
<tr><td>COVAR_POP(ColumnY, ColumnX)</td><td>The population covariance for non-null pairs in a group.</td></tr>
<tr><td>COVAR_SAMP(ColumnY, ColumnX)</td><td>The sample covariance for non-null pairs in a group.</td></tr>
<tr><td>CUME_DIST()</td><td>Calculates the cumulative distribution, or relative rank, of the current row to other rows in the same partition. Number of peer or preceding rows / number of rows in partition.</td></tr>
<tr><td>DENSE_RANK()</td><td>Ranks items in a group leaving no gaps in ranking sequence when there are ties.</td></tr>
<tr><td>FIRST_VALUE()</td><td>The value evaluated at the row that is the first row of the window frame (counting from 1); null if no such row.</td></tr>
<tr><td>LAG()</td><td>The value evaluated at the row that is offset rows before the current row within the partition; if there is no such row, instead return default. Both offset and default are evaluated with respect to the current row. If omitted, offset defaults to 1 and default to null. LAG provides access to more than one row of a table at the same time without a self-join. Given a series of rows returned from a query and a position of the cursor, LAG provides access to a row at a given physical offset prior to that position.</td></tr>
<tr><td>LAST_VALUE()</td><td>The value evaluated at the row that is the last row of the window frame (counting from 1); null if no such row.</td></tr>
<tr><td>LEAD()</td><td>Provides access to a row at a given physical offset beyond that position. Returns value evaluated at the row that is offset rows after the current row within the partition; if there is no such row, instead return default. Both offset and default are evaluated with respect to the current row. If omitted, offset defaults to 1 and default to null.</td></tr>
<tr><td>MAX()</td><td>Maximum value of expression across all input values.</td></tr>
<tr><td>MEDIAN()</td><td>An inverse distribution function that assumes a continuous distribution model. It takes a numeric or datetime value and returns the middle value or an interpolated value that would be the middle value once the values are sorted. Nulls are ignored in the calculation.<strong> Not available in MariaDB Columnstore 1.1 </strong></td></tr>
<tr><td>MIN()</td><td>Minimum value of expression across all input values.</td></tr>
<tr><td>NTH_VALUE()</td><td>The value evaluated at the row that is the nth row of the window frame (counting from 1); null if no such row.</td></tr>
<tr><td>NTILE()</td><td>Divides an ordered data set into a number of buckets indicated by expr and assigns the appropriate bucket number to each row. The buckets are numbered 1 through expr. The expr value must resolve to a positive constant for each partition. Integer ranging from 1 to the argument value, dividing the partition as equally as possible.</td></tr>
<tr><td>PERCENT_RANK()</td><td>Relative rank of the current row: (rank - 1) / (total rows - 1).</td></tr>
<tr><td>PERCENTILE_CONT()</td><td>An inverse distribution function that assumes a continuous distribution model. It takes a percentile value and a sort specification, and returns an interpolated value that would fall into that percentile value with respect to the sort specification. Nulls are ignored in the calculation. <strong> Not available in MariaDB Columnstore 1.1 </strong></td></tr>
<tr><td>PERCENTILE_DISC()</td><td>An inverse distribution function that assumes a discrete distribution model. It takes a percentile value and a sort specification and returns an element from the set. Nulls are ignored in the calculation. <strong> Not available in MariaDB Columnstore 1.1 </strong></td></tr>
<tr><td>RANK()</td><td>Rank of the current row with gaps; same as row_number of its first peer.</td></tr>
<tr><td>REGR_AVGX(ColumnY, ColumnX)</td><td>Average of the independent variable (sum(ColumnX)/N), where N is number of rows processed by the query</td></tr>
<tr><td>REGR_AVGY(ColumnY, ColumnX)</td><td>Average of the dependent variable (sum(ColumnY)/N), where N is number of rows processed by the query</td></tr>
<tr><td>REGR_COUNT(ColumnY, ColumnX)</td><td>The total number of input rows in which both column Y and column X are nonnull</td></tr>
<tr><td>REGR_SLOPE(ColumnY, ColumnX)</td><td>The slope of the least-squares-fit linear equation determined by the (ColumnX, ColumnY) pairs</td></tr>
<tr><td>REGR_INTERCEPT(ColumnY, ColumnX)</td><td>The y-intercept of the least-squares-fit linear equation determined by the (ColumnX, ColumnY) pairs</td></tr>
<tr><td>REGR_R2(ColumnY, ColumnX)</td><td>Square of the correlation coefficient. correlation coefficient is the regr_intercept(ColumnY, ColumnX) for linear model</td></tr>
<tr><td>REGR_SXX(ColumnY, ColumnX)</td><td>REGR_COUNT(y, x) * VAR_POP(x) for non-null pairs.</td></tr>
<tr><td>REGR_SXY(ColumnY, ColumnX)</td><td>REGR_COUNT(y, x) * COVAR_POP(y, x) for non-null pairs.</td></tr>
<tr><td>REGR_SYY(ColumnY, ColumnX)</td><td>REGR_COUNT(y, x) * VAR_POP(y) for non-null pairs.</td></tr>
<tr><td>ROW_NUMBER()</td><td>Number of the current row within its partition, counting from 1</td></tr>
<tr><td>STDDEV() STDDEV_POP()</td><td>Computes the population standard deviation and returns the square root of the population variance.</td></tr>
<tr><td>STDDEV_SAMP()</td><td>Computes the cumulative sample standard deviation and returns the square root of the sample variance.</td></tr>
<tr><td>SUM()</td><td>Sum of expression across all input values.</td></tr>
<tr><td>VARIANCE() VAR_POP()</td><td>Population variance of the input values (square of the population standard deviation).</td></tr>
<tr><td>VAR_SAMP()</td><td>Sample variance of the input values (square of the sample standard deviation).</td></tr>
</table>
<h3 class="anchored_heading" id="note">Note</h3>
<ul start="1"><li>Regression functions (REGR_AVGX to REGR_YY), CORR, COVAR_POP and COVAR_SAMP are supported for version 1.2.0 and higher
</li></ul>
<h1 class="anchored_heading" id="examples">Examples</h1>
<h2 class="anchored_heading" id="example-schema">Example Schema</h2>
<p>The examples are all based on the following simplified sales opportunity table:</p>
<pre>
create table opportunities (
id int,
accountName varchar(20),
name varchar(128),
owner varchar(7),
amount decimal(10,2),
closeDate date,
stageName varchar(11)
) engine=columnstore;
</pre>
<p>Some example values are (thanks to <a href="https://www.mockaroo.com">https://www.mockaroo.com</a> for sample data generation):</p>
<table><tr><th>id</th><th>accountName</th><th>name</th><th>owner</th><th>amount</th><th>closeDate</th><th>stageName</th></tr>
<tr><td>1</td><td>Browseblab</td><td>Multi-lateral executive function</td><td>Bob</td><td>26444.86</td><td>2016-10-20</td><td>Negotiating</td></tr>
<tr><td>2</td><td>Mita</td><td>Organic demand-driven benchmark</td><td>Maria</td><td>477878.41</td><td>2016-11-28</td><td>ClosedWon</td></tr>
<tr><td>3</td><td>Miboo</td><td>De-engineered hybrid groupware</td><td>Olivier</td><td>80181.78</td><td>2017-01-05</td><td>ClosedWon</td></tr>
<tr><td>4</td><td>Youbridge</td><td>Enterprise-wide bottom-line Graphic Interface</td><td>Chris</td><td>946245.29</td><td>2016-07-02</td><td>ClosedWon</td></tr>
<tr><td>5</td><td>Skyba</td><td>Reverse-engineered fresh-thinking standardization</td><td>Maria</td><td>696241.82</td><td>2017-02-17</td><td>Negotiating</td></tr>
<tr><td>6</td><td>Eayo</td><td>Fundamental well-modulated artificial intelligence</td><td>Bob</td><td>765605.52</td><td>2016-08-27</td><td>Prospecting</td></tr>
<tr><td>7</td><td>Yotz</td><td>Extended secondary infrastructure</td><td>Chris</td><td>319624.20</td><td>2017-01-06</td><td>ClosedLost</td></tr>
<tr><td>8</td><td>Oloo</td><td>Configurable web-enabled data-warehouse</td><td>Chris</td><td>321016.26</td><td>2017-03-08</td><td>ClosedLost</td></tr>
<tr><td>9</td><td>Kaymbo</td><td>Multi-lateral web-enabled definition</td><td>Bob</td><td>690881.01</td><td>2017-01-02</td><td>Developing</td></tr>
<tr><td>10</td><td>Rhyloo</td><td>Public-key coherent infrastructure</td><td>Chris</td><td>965477.74</td><td>2016-11-07</td><td>Prospecting</td></tr>
</table>
<p>The schema, sample data, and queries are available as an attachment to this article.</p>
<h2 class="anchored_heading" id="cumulative-sum-and-running-max-example">Cumulative Sum and Running Max Example</h2>
<p>Window functions can be used to achieve cumulative / running calculations on a detail report. In this case a won opportunity report for a 7 day period adds columns to show the accumulated won amount as well as the current highest opportunity amount in preceding rows. </p>
<pre>
select owner, 
accountName, 
CloseDate, 
amount, 
sum(amount) over (order by CloseDate rows between unbounded preceding and current row) cumeWon, 
max(amount) over (order by CloseDate rows between unbounded preceding and current row) runningMax
from opportunities 
where stageName='ClosedWon' 
and closeDate &gt;= '2016-10-02' and closeDate &lt;= '2016-10-09' 
order by CloseDate;
</pre>
<p>with example results:</p>
<table><tr><th>owner</th><th>accountName</th><th>CloseDate</th><th>amount</th><th>cumeWon</th><th>runningMax</th></tr>
<tr><td>Bill</td><td>Babbleopia</td><td>2016-10-02</td><td>437636.47</td><td>437636.47</td><td>437636.47</td></tr>
<tr><td>Bill</td><td>Thoughtworks</td><td>2016-10-04</td><td>146086.51</td><td>583722.98</td><td>437636.47</td></tr>
<tr><td>Olivier</td><td>Devpulse</td><td>2016-10-05</td><td>834235.93</td><td>1417958.91</td><td>834235.93</td></tr>
<tr><td>Chris</td><td>Linkbridge</td><td>2016-10-07</td><td>539977.45</td><td>2458738.65</td><td>834235.93</td></tr>
<tr><td>Olivier</td><td>Trupe</td><td>2016-10-07</td><td>500802.29</td><td>1918761.20</td><td>834235.93</td></tr>
<tr><td>Bill</td><td>Latz</td><td>2016-10-08</td><td>857254.87</td><td>3315993.52</td><td>857254.87</td></tr>
<tr><td>Chris</td><td>Avamm</td><td>2016-10-09</td><td>699566.86</td><td>4015560.38</td><td>857254.87</td></tr>
</table>
<h2 class="anchored_heading" id="partitioned-cumulative-sum-and-running-max-example">Partitioned Cumulative Sum and Running Max Example</h2>
<p>The above example can be partitioned, so that the window functions are over a particular field grouping such as owner and accumulate within that grouping. This is achieved by adding the syntax "partition by &lt;columns&gt;" in the window function clause. </p>
<pre>
select owner,  
accountName,  
CloseDate,  
amount,  
sum(amount) over (partition by owner order by CloseDate rows between unbounded preceding and current row) cumeWon,  
max(amount) over (partition by owner order by CloseDate rows between unbounded preceding and current row) runningMax 
from opportunities  
where stageName='ClosedWon' 
and closeDate &gt;= '2016-10-02' and closeDate &lt;= '2016-10-09'  
order by owner, CloseDate;
</pre>
<p>with example results:</p>
<table><tr><th>owner</th><th>accountName</th><th>CloseDate</th><th>amount</th><th>cumeWon</th><th>runningMax</th></tr>
<tr><td>Bill</td><td>Babbleopia</td><td>2016-10-02</td><td>437636.47</td><td>437636.47</td><td>437636.47</td></tr>
<tr><td>Bill</td><td>Thoughtworks</td><td>2016-10-04</td><td>146086.51</td><td>583722.98</td><td>437636.47</td></tr>
<tr><td>Bill</td><td>Latz</td><td>2016-10-08</td><td>857254.87</td><td>1440977.85</td><td>857254.87</td></tr>
<tr><td>Chris</td><td>Linkbridge</td><td>2016-10-07</td><td>539977.45</td><td>539977.45</td><td>539977.45</td></tr>
<tr><td>Chris</td><td>Avamm</td><td>2016-10-09</td><td>699566.86</td><td>1239544.31</td><td>699566.86</td></tr>
<tr><td>Olivier</td><td>Devpulse</td><td>2016-10-05</td><td>834235.93</td><td>834235.93</td><td>834235.93</td></tr>
<tr><td>Olivier</td><td>Trupe</td><td>2016-10-07</td><td>500802.29</td><td>1335038.22</td><td>834235.93</td></tr>
</table>
<h2 class="anchored_heading" id="ranking-top-results">Ranking / Top Results</h2>
<p>The rank window function allows for ranking or assigning a numeric order value based on the window function definition.  Using  the Rank() function will result in the same value for ties / equal values and the next rank value skipped. The Dense_Rank() function behaves similarly except the next consecutive number is used after a tie rather than skipped. The Row_Number() function will provide a unique ordering value. The example query shows the Rank() function being applied to rank sales reps by the number of opportunities for Q4 2016.</p>
<pre>
select owner, 
wonCount, 
rank() over (order by wonCount desc) rank 
from (
  select owner, 
  count(*) wonCount 
  from opportunities 
  where stageName='ClosedWon' 
  and closeDate &gt;= '2016-10-01' and closeDate &lt; '2016-12-31'  
  group by owner
) t
order by rank;
</pre>
<p>with example results (note the query is technically incorrect by using closeDate &lt; '2016-12-31' however this creates a tie scenario for illustrative purposes):</p>
<table><tr><th>owner</th><th>wonCount</th><th>rank</th></tr>
<tr><td>Bill</td><td>19</td><td>1</td></tr>
<tr><td>Chris</td><td>15</td><td>2</td></tr>
<tr><td>Maria</td><td>14</td><td>3</td></tr>
<tr><td>Bob</td><td>14</td><td>3</td></tr>
<tr><td>Olivier</td><td>10</td><td>5</td></tr>
</table>
<p>If the dense_rank function is used the rank values would be 1,2,3,3,4 and for the row_number function the values would be 1,2,3,4,5.</p>
<h2 class="anchored_heading" id="first-and-last-values">First and Last Values</h2>
<p>The first_value and last_value functions allow determining the first and last values of a given range. Combined with a group by this allows summarizing opening and closing values. The example shows a more complex case where detailed information is presented for first and last opportunity by quarter.</p>
<pre>
select a.year, 
a.quarter, 
f.accountName firstAccountName, 
f.owner firstOwner, 
f.amount firstAmount, 
l.accountName lastAccountName, 
l.owner lastOwner, 
l.amount lastAmount 
from (
  select year, 
  quarter, 
  min(firstId) firstId, 
  min(lastId) lastId 
  from (
    select year(closeDate) year, 
    quarter(closeDate) quarter, 
    first_value(id) over (partition by year(closeDate), quarter(closeDate) order by closeDate rows between unbounded preceding and current row) firstId, 
    last_value(id) over (partition by year(closeDate), quarter(closeDate) order by closeDate rows between current row and unbounded following) lastId 
    from opportunities  where stageName='ClosedWon'
  ) t 
  group by year, quarter order by year,quarter
) a 
join opportunities f on a.firstId = f.id 
join opportunities l on a.lastId = l.id 
order by year, quarter;
</pre>
<p>with example results:</p>
<table><tr><th>year</th><th>quarter</th><th>firstAccountName</th><th>firstOwner</th><th>firstAmount</th><th>lastAccountName</th><th>lastOwner</th><th>lastAmount</th></tr>
<tr><td>2016</td><td>3</td><td>Skidoo</td><td>Bill</td><td>523295.07</td><td>Skipstorm</td><td>Bill</td><td>151420.86</td></tr>
<tr><td>2016</td><td>4</td><td>Skimia</td><td>Chris</td><td>961513.59</td><td>Avamm</td><td>Maria</td><td>112493.65</td></tr>
<tr><td>2017</td><td>1</td><td>Yombu</td><td>Bob</td><td>536875.51</td><td>Skaboo</td><td>Chris</td><td>270273.08</td></tr>
</table>
<h2 class="anchored_heading" id="prior-and-next-example">Prior and Next Example</h2>
<p>Sometimes it useful to understand the previous and next values in the context of a given row. The lag and lead window functions provide this capability. By default the offset is one providing the prior or next value but can also be provided to get a larger offset. The example query is a report of opportunities by account name showing the opportunity amount, and the prior and next opportunity amount for that account by close date.</p>
<pre>
select accountName, 
closeDate,  
amount currentOppAmount, 
lag(amount) over (partition by accountName order by closeDate) priorAmount, lead(amount) over (partition by accountName order by closeDate) nextAmount 
from opportunities 
order by accountName, closeDate 
limit 9;
</pre>
<p>with example results:</p>
<table><tr><th>accountName</th><th>closeDate</th><th>currentOppAmount</th><th>priorAmount</th><th>nextAmount</th></tr>
<tr><td>Abata</td><td>2016-09-10</td><td>645098.45</td><td>NULL</td><td>161086.82</td></tr>
<tr><td>Abata</td><td>2016-10-14</td><td>161086.82</td><td>645098.45</td><td>350235.75</td></tr>
<tr><td>Abata</td><td>2016-12-18</td><td>350235.75</td><td>161086.82</td><td>878595.89</td></tr>
<tr><td>Abata</td><td>2016-12-31</td><td>878595.89</td><td>350235.75</td><td>922322.39</td></tr>
<tr><td>Abata</td><td>2017-01-21</td><td>922322.39</td><td>878595.89</td><td>NULL</td></tr>
<tr><td>Abatz</td><td>2016-10-19</td><td>795424.15</td><td>NULL</td><td>NULL</td></tr>
<tr><td>Agimba</td><td>2016-07-09</td><td>288974.84</td><td>NULL</td><td>914461.49</td></tr>
<tr><td>Agimba</td><td>2016-09-07</td><td>914461.49</td><td>288974.84</td><td>176645.52</td></tr>
<tr><td>Agimba</td><td>2016-09-20</td><td>176645.52</td><td>914461.49</td><td>NULL</td></tr>
</table>
<h2 class="anchored_heading" id="quartiles-example">Quartiles Example</h2>
<p>The NTile window function allows for breaking up a data set into portions assigned a numeric value to each portion of the range. NTile(4) breaks the data up into quartiles (4 sets). The example query produces a report of all opportunities summarizing the quartile boundaries of amount values.</p>
<pre>
select t.quartile, 
min(t.amount) min, 
max(t.amount) max 
from (
  select amount, 
  ntile(4) over (order by amount asc) quartile 
  from opportunities 
  where closeDate &gt;= '2016-10-01' and closeDate &lt;= '2016-12-31'
  ) t 
group by quartile 
order by quartile;
</pre>
<p>With example results:</p>
<table><tr><th>quartile</th><th>min</th><th>max</th></tr>
<tr><td>1</td><td>6337.15</td><td>287634.01</td></tr>
<tr><td>2</td><td>288796.14</td><td>539977.45</td></tr>
<tr><td>3</td><td>540070.04</td><td>748727.51</td></tr>
<tr><td>4</td><td>753670.77</td><td>998864.47</td></tr>
</table>
<h2 class="anchored_heading" id="percentile-example">Percentile Example</h2>
<p>The percentile functions have a slightly different syntax from other window functions as can be seen in the example below. These functions can be only applied against numeric values.  The argument to the function is the percentile to evaluate. Following 'within group' is the sort expression which indicates the sort column and optionally order. Finally after 'over' is an optional partition by clause, for no partition clause use 'over ()'. The example below utilizes the value 0.5 to calculate the median opportunity amount in the rows. The values differ sometimes because percentile_cont will return the average of the 2 middle rows for an even data set while percentile_desc returns the first encountered in the sort.</p>
<p><strong> Note that the percentile syntax is supported in MariaDB ColumnStore 1.0 but not 1.1. It is anticipated that this will be restored in MariaDB ColumnStore 1.2 after this is implemented in MariaDB server 10.3.</strong></p>
<pre>
select owner,  
accountName,  
CloseDate,  
amount,
percentile_cont(0.5) within group (order by amount) over (partition by owner) pct_cont,
percentile_disc(0.5) within group (order by amount) over (partition by owner) pct_disc
from opportunities  
where stageName='ClosedWon' 
and closeDate &gt;= '2016-10-02' and closeDate &lt;= '2016-10-09'  
order by owner, CloseDate;
</pre>
<p>With example results:</p>
<table><tr><th>owner</th><th>accountName</th><th>CloseDate</th><th>amount</th><th>pct_cont</th><th>pct_disc</th></tr>
<tr><td>Bill</td><td>Babbleopia</td><td>2016-10-02</td><td>437636.47</td><td>437636.4700000000</td><td>437636.47</td></tr>
<tr><td>Bill</td><td>Thoughtworks</td><td>2016-10-04</td><td>146086.51</td><td>437636.4700000000</td><td>437636.47</td></tr>
<tr><td>Bill</td><td>Latz</td><td>2016-10-08</td><td>857254.87</td><td>437636.4700000000</td><td>437636.47</td></tr>
<tr><td>Chris</td><td>Linkbridge</td><td>2016-10-07</td><td>539977.45</td><td>619772.1550000000</td><td>539977.45</td></tr>
<tr><td>Chris</td><td>Avamm</td><td>2016-10-09</td><td>699566.86</td><td>619772.1550000000</td><td>539977.45</td></tr>
<tr><td>Olivier</td><td>Devpulse</td><td>2016-10-05</td><td>834235.93</td><td>667519.1100000000</td><td>500802.29</td></tr>
<tr><td>Olivier</td><td>Trupe</td><td>2016-10-07</td><td>500802.29</td><td>667519.1100000000</td><td>500802.29</td></tr>
</table>

    </div>


        
            <div id="subscribe" class="well well-small hide hidden-print"
                 data-subscribe-url="/kb/en/columnstore-window-functions/+subscriptions/add"
                 data-unsubscribe-url="/kb/en/columnstore-window-functions/+subscriptions/remove">
            </div>
        

        
        
    
        <div class="simple_section_nav">
            <ul class="nav nav-pills">
                
                    <li><a href="/kb/en/columnstore-data-manipulation-statements/">
                        ← ColumnStore Data Manipulation Statements
                    </a>
                    </li>
                
                
                    <li><a href="/kb/en/columnstore-sql-structure-and-commands/">
                        ↑ ColumnStore SQL Structure and Commands ↑
                    </a>
                    </li>
                
                
                    <li class="pull-right"><a href="/kb/en/columnstore-operating-mode/">
                        ColumnStore Operating Mode →
                    </a>
                    </li>
                
            </ul>
        </div>
    

        

        
        <h2>Comments</h2>
        
    
    <div id="comments" data-node-id="6052" data-comments-url="/kb/en/columnstore-window-functions/+comments"
         data-reply-url="/kb/en/columnstore-window-functions/comments/post/">
        Comments loading...
    </div>

        

    </div>


                    <div id="content_disclaimer" class="graybox">
                        Content reproduced on this site is the property of its respective owners,
                        and this content is not reviewed in advance by MariaDB. The views, information and opinions
                        expressed by this content do not necessarily represent those of MariaDB or any other party.
                    </div>
                </div>
            </section>

            
                <div id="right_bar" class="col-md-2">
                    
    
        
        <ul class="section_navigation well well-small hidden-xs hidden-sm">
            
                <li class="parent"><a href="/kb/en/columnstore-sql-structure-and-commands/">
                    ↑ ColumnStore SQL Structure and Commands ↑
                </a>
                </li>
            
            
                
                    <li>
                        <a href="/kb/en/columnstore-naming-conventions/">
                            
                            ColumnStore Naming Conventions
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/columnstore-data-types/">
                            
                            ColumnStore Data Types
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/columnstore-distributed-aggregate-functions/">
                            
                            ColumnStore Distributed Aggregate Functions
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/columnstore-distributed-functions/">
                            
                            ColumnStore Distributed Functions
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/columnstore-non-distributed-post-processed-functions/">
                            
                            ColumnStore Non-Distributed Post-Processed Functions
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/columnstore-information-functions/">
                            
                            ColumnStore Information Functions
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/columnstore-conditions/">
                            
                            ColumnStore Conditions
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/columnstore-data-definition-statements/">
                            
                            ColumnStore Data Definition Statements
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/columnstore-data-manipulation-statements/">
                            
                            ColumnStore Data Manipulation Statements
                        </a>
                    </li>
                
            
                
                    <li class="active">
                        <span>ColumnStore Window Functions</span>
                        
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/columnstore-operating-mode/">
                            
                            ColumnStore Operating Mode
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/columnstore-decimal-math-and-scale/">
                            
                            ColumnStore Decimal Math and Scale
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/columnstore-compression-mode/">
                            
                            ColumnStore Compression Mode
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/columnstore-partition-management/">
                            <span class="pull-right not_primary"></span>
                            ColumnStore Partition Management
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/columnstore-information-schema-tables/">
                            
                            ColumnStore Information Schema Tables
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/columnstore-user-defined-functions/">
                            
                            ColumnStore User Defined Functions
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/columnstore-user-defined-aggregate-and-window-functions/">
                            
                            ColumnStore User Defined Aggregate and Window Functions
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/5568/">
                            
                            ColumnStore Commit
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/5571/">
                            
                            ColumnStore Drop Procedure
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/5573/">
                            
                            ColumnStore Rename Table
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/5574/">
                            
                            ColumnStore Rollback
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/columnstore-utility-functions/">
                            
                            ColumnStore Utility Functions
                        </a>
                    </li>
                
            
        </ul>
    
    

                </div>
            
        </div>
    </div>
</div>

<!-- Footer -->
<footer id="footer">
    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-xs-12">
                    <ul class="list-inline text-center footer-nav">
                        <li>
                            <h5>
                                <a href="https://mariadb.com/products" title="Products">Products</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/services" title="Services">Services</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/pricing" title="Pricing">Pricing</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/resources" title="Resources">Resources</a>
                            </h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/about-us" title="About MariaDB">About Us</a></h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/download" title="Download">Download MariaDB</a></h5>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="row row-10">
                
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div id="block-footerformcontact" class="block block-block-content block-block-contentd754ee1b-3cc9-40e7-9ef4-f504f1197fb1">
                        
                            <h5 style="font-weight: 400;">Subscribe to our newsletter!</h5>
                            <script src="//app-sj15.marketo.com/js/forms2/js/forms2.min.js"></script><form id="mktoForm_1498"></form>
                            <script>
                                <!--//--><![CDATA[// ><!--
                                MktoForms2.loadForm("//app-sj15.marketo.com", "573-PXI-984", 1498);
                                //--><!]]]]><![CDATA[>
                                //--><!]]>
                            </script>
                        
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div class="footer-copyright">
                        <div class="text-center">
                            <ul class="list-inline no-margin">
                                <li>
                                    <a href="/legal" title="Legal">Legal</a>
                                </li>
                                <li>
                                    <a href="/privacy-policy" title="Privacy Policy">Privacy Policy</a>
                                </li>
                                <li>
                                    <a href="/cookie-policy/" title="Cookies">Cookie Policy</a>
                                </li>
                            </ul>
                            <p>Copyright &copy; 2024 MariaDB. All rights reserved.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</footer>
</div>

<div id="ajax_loading">
    <img src="/kb/static/images/ajax-loader.a51c5608d01a.gif" />
</div>

    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MK2847"
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MK2847');</script>
    <!-- End Google Tag Manager -->

</body>

<script type="text/javascript" src="/kb/static/js/main.1587e3a666fc.js" charset="utf-8"></script>

</html>