<!DOCTYPE html>
<html>
<head data-cookie-domain=""
      data-cookie-path="/">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="apple-touch-icon" sizes="180x180" href="/kb/static/images/favicons/apple-touch-icon.159e713979be.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/kb/static/images/favicons/favicon-32x32.bc0ac1d5d11e.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/kb/static/images/favicons/favicon-16x16.5801f8f0f34e.png">
    <link rel="shortcut icon" href="/kb/static/images/favicons/favicon.d122d305dee4.ico" type="image/x-icon" />

    <title>InnoDB Online DDL Operations with the NOCOPY Alter Algorithm - Source - MariaDB Knowledge Base</title>

    <link href="/kb/static/css/main.f7633538c846.css" rel="stylesheet" type="text/css" />

    
        <meta name="robots" content="noindex, nofollow">
    

    

    <!-- FB Open Graph tags -->
    <meta property="og:title" content="InnoDB Online DDL Operations with the NOCOPY Alter Algorithm - Source" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://mariadb.com/kb/en/innodb-online-ddl-operations-with-the-nocopy-alter-algorithm/+source/" />
    <meta property="og:image" content="http://mariadb.comaskmonty-logo.png" />
    <meta property="og:site_name" content="MariaDB KnowledgeBase" />
    <meta property="fb:admins" content="514852603" />
    <meta property="og:description" content="" />

    <meta name="description" content="" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet"/>
    
</head>
<body class="mpkb nodes autoresize nodes_source jqui" id="nodes_source">





<div id="menu-mobile" class="visible-sm visible-xs">

    <div>
        <div id="mobile-close-menu" class="text-right">
            <a href="javascript:void(0)" title="Close Menu" id="back-main" class="toggle-menu">X<span></span></a>
        </div>
    </div>
    <div class="mainmenu-mobile">
        <ul class="ls-none ul-menu">
            <li data-sub="submenu5"><a class="open-form-search" href="/kb/search/" title="Search">Search </a></li>
            <li data-sub="submenu0"><a href="/products" title="Products">Products</a><span class="arrow-main"></span></li>
            <li data-sub="submenu1"><a href="/services" title="Services">Services</a><span class="arrow-main"></span></li>
            <li data-sub="submenu2"><a href="/resources" title="Resources">Resources</a><span class="arrow-main"></span></li>
            <li data-sub="submenu3"><a href="/about-us" title="About">About</a><span class="arrow-main"></span></li>
            <li data-sub="submenu4"><a href="/contact" title="Contact">Contact</a></li>
        </ul>
    </div>

    <div class="nav-top-mobile">
        <div class="select-box form">

            <ul class="inline-block-md mb-none top-nav">
                <li>

                </li>
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/innodb-online-ddl-operations-with-the-nocopy-alter-algorithm/+source/"> Login</a>
                    </li>
                
            </ul>



        </div>
        <p class="text-center copyright">Copyright &copy; 2024 MariaDB. All rights reserved.</p>
    </div>
</div>
<div class="violator-wrap d-none" id="top_violator">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12">
                <div class="violator-outer">
                    <div class="violator-inner">
                        <div class="row">
                            <div class="col-xs-12 col-sm-9 col-lg-7 col-lg-offset-2" id="top_violator_content">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="content-link" target="_blank" rel="nofollow noreferrer">
                                    <span>The Ultimate Guide to High Availability with MariaDB</span>
                                </a>
                            </div>
                            <div class="col-xs-12 col-sm-3" id="top_violator_cta">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="btn btn-mariadb" target="_blank" rel="nofollow noreferrer">Download Now</a>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-link close-btn">
                        <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24" width="15px" height="15px"><path d="M 4.9902344 3.9902344 A 1.0001 1.0001 0 0 0 4.2929688 5.7070312 L 10.585938 12 L 4.2929688 18.292969 A 1.0001 1.0001 0 1 0 5.7070312 19.707031 L 12 13.414062 L 18.292969 19.707031 A 1.0001 1.0001 0 1 0 19.707031 18.292969 L 13.414062 12 L 19.707031 5.7070312 A 1.0001 1.0001 0 0 0 18.980469 3.9902344 A 1.0001 1.0001 0 0 0 18.292969 4.2929688 L 12 10.585938 L 5.7070312 4.2929688 A 1.0001 1.0001 0 0 0 4.9902344 3.9902344 z"/></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="wrapper">
<div id="top-nav">
    <div class="container">
        <ul class="hidden-sm hidden-xs" >
            <li><a href="https://mariadb.com/kb/">Knowledge Base</a></li>
            <li><a href="https://mariadb.com/contact/">Contact</a></li>
            
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/innodb-online-ddl-operations-with-the-nocopy-alter-algorithm/+source/" rel="nofollow">Login</a>
                    </li>
                
            
            
            <li id="search-form">
                <form action="/kb/en/+search/" method="get" id="search-block-form" accept-charset="UTF-8">
                    <input id="search" title="Enter the terms you wish to search for."
                           placeholder="Search . . ." type="text"
                           name="q" value="" size="15" maxlength="128" class="form-text"
                           data-autocomplete-url="/kb/en/+search/autocomplete/">
                    <input type="hidden" name="quick" value="1" />
                    <input type="hidden" name="source" value="kb" />
                </form>
            </li>
            <li><a id="search-toggler" href="/kb/search/">Search</a></li>
            
        </ul>
    </div>
</div>
<div id="navbar-bottom" class="navbar">
    <div class="container">
        
        
        
        
        <div class="row">
            <div class="col-md-3 col-sm-9 col-xs-9">
                <a class="brand" href="/" title="MariaDB">
                    <img src="/kb/static/images/logo-2018-black.95f5978ae14d.png">
                </a>
            </div>
            <div class="col-md-9 hidden-sm hidden-xs">
                <div class="main-menu">
                    <ul id="main-menu" class="nav navbar-nav inline-block-sm">
    <li class="has-sub full-menu">
        <a href="/products" title="Products">Products</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/services" title="Services">Services</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/pricing" title="Pricing">Pricing</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/resources" title="Resources">Resources</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/about-us" title="About Us">About Us</a>
    </li>
    <li class="">
        <a class="button electric-eel small top-bar-right-download" href="/downloads/">Download</a>
    </li>
</ul>
                </div>
            </div>
            <div class="col-md-3 visible-sm visible-xs col-sm-3 col-xs-3 ps-rv">
                <div class="navbar-header text-right pull-right">
                    <button type="button" class="menu-control toggle-menu" id="open-menu">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="main">
    <div class="container">
        

        <div id="subheader1" class="clearfix">
            <div class="pull-left">
                
                <div id="breadcrumbs" class="breadcrumb">
                    <a href="/kb/en/">Knowledge Base</a>
                    


    
    » <a class="crumb" href="/kb/en/documentation/">MariaDB Server Documentation</a>
    

    
    » <a class="crumb" href="/kb/en/columns-storage-engines-and-plugins/">Columns, Storage Engines, and Plugins</a>
    

    
    » <a class="crumb" href="/kb/en/storage-engines/">Storage Engines</a>
    

    
    » <a class="crumb" href="/kb/en/innodb/">InnoDB</a>
    

    
    » <a class="crumb" href="/kb/en/innodb-online-ddl/">InnoDB Online DDL</a>
    


    » <a class="node_link crumb" href="/kb/en/innodb-online-ddl-operations-with-the-nocopy-alter-algorithm/">InnoDB Online DDL Operations with the NOCOPY Alter Algorithm</a>


                </div>
                
            </div>
        </div>
    </div>
    <div class="container" id="container-main">
        <div class="row">
            
            
                
                <aside id="sidebar-first" class="sidebar col-md-2 hidden-xs hidden-sm hidden-print">
                    
                        
                        <ul id="category_menu" class="nav nav-pills nav-stacked">
                            <li><a href="/kb/en/">Home</a></li>
                            
                                
                                    <li><a href="/kb/en/+questions/">Open Questions</a></li>
                                
                                <li><a href="/kb/en/documentation/">MariaDB Server</a></li>
                                <li><a href="/kb/en/maxscale/">MariaDB MaxScale</a></li>
                                <li><a href="/kb/en/mariadb-columnstore/">MariaDB ColumnStore</a></li>
                                <li><a href="/kb/en/connectors/">Connectors</a></li>
                            

                        </ul>
                    

                    
                        <div>
    

<div class="well well-small box actions"><div>

        <a class="btn btn-block btn-small" href="/kb/en/innodb-online-ddl-operations-with-the-nocopy-alter-algorithm/">Return to article</a>
    
</div>
</div>

</div>
                    

                    

































                </aside>
            
            
            
                
            
            
            <section id="content" class="limited_width col-md-10 clearfix">
                
                    <h1>InnoDB Online DDL Operations with the NOCOPY Alter Algorithm - Source</h1>
                

                



                <div>
                    

    

    
    <div class="revision_info">
        <dl class="table">
            <dt>Revision</dt>
            <dd><a href="/kb/en/innodb-online-ddl-operations-with-the-nocopy-alter-algorithm/+r/115652/">115652</a></dd>
            <dt>User</dt>
            <dd>
<span class="user" id="user-3487">
<a href="/kb/user/id/3487" title="Geoff Montee">Geoff Montee</a>
</span></dd>
            <dt>Date</dt>
            <dd>

<span class="datetime" title="2022-04-27 18:15">2022-04-27 18:15</span></dd>
        </dl>
    </div>
    


    

    
        
        <textarea id="answer_source" class="creole_source autogrow">&lt;&lt;toc&gt;&gt;

== Supported Operations by Inheritance

When the [[alter-table/#algorithm|ALGORITHM]] clause is set to ##NOCOPY##, the supported operations are a superset of the operations that are supported when the [[alter-table/#algorithm|ALGORITHM]] clause is set to ##INSTANT##.

Therefore, when the [[alter-table/#algorithm|ALGORITHM]] clause is set to ##NOCOPY##, some operations are supported by inheritance. See the following additional pages for more information about these supported operations:

* [[innodb-online-ddl-operations-with-algorithminstant|InnoDB Online DDL Operations with ALGORITHM=INSTANT]] 

== Column Operations

=== ##ALTER TABLE ... ADD COLUMN##

In MariaDB 10.3.2 and later, InnoDB supports adding columns to a table with [[alter-table/#algorithm|ALGORITHM]] set to ##NOCOPY## in the cases where the operation supports having the [[alter-table/#algorithm|ALGORITHM]] clause set to ##INSTANT##.

See [[innodb-online-ddl-operations-with-algorithminstant/#alter-table-add-column|InnoDB Online DDL Operations with ALGORITHM=INSTANT: ALTER TABLE ... ADD COLUMN]] for more information.

This applies to [[alter-table/#add-column|ALTER TABLE ... ADD COLUMN]] for [[innodb|InnoDB]] tables.

=== ##ALTER TABLE ... DROP COLUMN##

In MariaDB 10.4 and later, InnoDB supports dropping columns from a table with [[alter-table/#algorithm|ALGORITHM]] set to ##NOCOPY## in the cases where the operation supports having the [[alter-table/#algorithm|ALGORITHM]] clause set to ##INSTANT##.

See [[innodb-online-ddl-operations-with-algorithminstant/#alter-table-drop-column|InnoDB Online DDL Operations with ALGORITHM=INSTANT: ALTER TABLE ... DROP COLUMN]] for more information.

This applies to [[alter-table/#drop-column|ALTER TABLE ... DROP COLUMN]] for [[innodb|InnoDB]] tables.

=== ##ALTER TABLE ... MODIFY COLUMN##

This applies to [[alter-table/#modify-column|ALTER TABLE ... MODIFY COLUMN]] for [[innodb|InnoDB]] tables.

==== Reordering Columns

In MariaDB 10.4 and later, InnoDB supports reordering columns within a table with [[alter-table/#algorithm|ALGORITHM]] set to ##NOCOPY## in the cases where the operation supports having the [[alter-table/#algorithm|ALGORITHM]] clause set to ##INSTANT##.

See [[innodb-online-ddl-operations-with-algorithminstant/#reordering-columns|InnoDB Online DDL Operations with ALGORITHM=INSTANT: Reordering Columns]] for more information.

==== Changing the Data Type of a Column

InnoDB does **not** support modifying a column&#39;s data type with [[alter-table/#algorithm|ALGORITHM]] set to ##NOCOPY## in most cases. There are a few exceptions in the cases where the operation supports having the [[alter-table/#algorithm|ALGORITHM]] clause set to ##INSTANT##.

See [[innodb-online-ddl-operations-with-algorithminstant/#changing-the-data-type-of-a-column|InnoDB Online DDL Operations with ALGORITHM=INSTANT: Changing the Data Type of a Column]] for more information.

==== Changing a Column to NULL

In MariaDB 10.4.3 and later, InnoDB supports modifying a column to allow [[create-table/#null-and-not-null|NULL]] values with [[alter-table/#algorithm|ALGORITHM]] set to ##NOCOPY## in the cases where the operation supports having the [[alter-table/#algorithm|ALGORITHM]] clause set to ##INSTANT##.

See [[innodb-online-ddl-operations-with-algorithminstant/#changing-a-column-to-null|InnoDB Online DDL Operations with ALGORITHM=INSTANT: Changing a Column to NULL]] for more information.

==== Changing a Column to NOT NULL

InnoDB does **not** support modifying a column to **not** allow [[create-table/#null-and-not-null|NULL]] values with [[alter-table/#algorithm|ALGORITHM]] set to ##NOCOPY##.

For example:

&lt;&lt;code wrap=true lang=sql&gt;&gt;
CREATE OR REPLACE TABLE tab (
   a int PRIMARY KEY,
   b varchar(50),
   c varchar(50)
) ROW_FORMAT=REDUNDANT;

SET SESSION alter_algorithm=&#39;NOCOPY&#39;;
ALTER TABLE tab MODIFY COLUMN c varchar(50) NOT NULL;
ERROR 1845 (0A000): ALGORITHM=NOCOPY is not supported for this operation. Try ALGORITHM=INPLACE
&lt;&lt;/code&gt;&gt;

==== Adding a New ##ENUM## Option

InnoDB supports adding a new [[enum|ENUM]] option to a column with [[alter-table/#algorithm|ALGORITHM]] set to ##NOCOPY## in the cases where the operation supports having the [[alter-table/#algorithm|ALGORITHM]] clause set to ##INSTANT##.

See [[innodb-online-ddl-operations-with-algorithminstant/#adding-a-new-enum-option|InnoDB Online DDL Operations with ALGORITHM=INSTANT: Adding a New ENUM Option]] for more information.

==== Adding a New ##SET## Option

InnoDB supports adding a new [[set-data-type|SET]] option to a column with [[alter-table/#algorithm|ALGORITHM]] set to ##NOCOPY## in the cases where the operation supports having the [[alter-table/#algorithm|ALGORITHM]] clause set to ##INSTANT##.

See [[innodb-online-ddl-operations-with-algorithminstant/#adding-a-new-set-option|InnoDB Online DDL Operations with ALGORITHM=INSTANT: Adding a New SET Option]] for more information.

==== Removing System Versioning from a Column

In MariaDB 10.3.8 and later, InnoDB supports removing [[system-versioned-tables|system versioning]] from a column with [[alter-table/#algorithm|ALGORITHM]] set to ##NOCOPY## in the cases where the operation supports having the [[alter-table/#algorithm|ALGORITHM]] clause set to ##INSTANT##.

See [[innodb-online-ddl-operations-with-algorithminstant/#removing-system-versioning-from-a-column|InnoDB Online DDL Operations with ALGORITHM=INSTANT: Removing System Versioning from a Column]] for more information.

=== ##ALTER TABLE ... ALTER COLUMN##

This applies to [[alter-table/#alter-column|ALTER TABLE ... ALTER COLUMN]] for [[innodb|InnoDB]] tables.

==== Setting a Column&#39;s Default Value

InnoDB supports modifying a column&#39;s [[create-table/#default-column-option|DEFAULT]] value with [[alter-table/#algorithm|ALGORITHM]] set to ##NOCOPY## in the cases where the operation supports having the [[alter-table/#algorithm|ALGORITHM]] clause set to ##INSTANT##.

See [[innodb-online-ddl-operations-with-algorithminstant/#setting-a-columns-default-value|InnoDB Online DDL Operations with ALGORITHM=INSTANT: Setting a Column&#39;s Default Value]] for more information.

==== Removing a Column&#39;s Default Value

InnoDB supports removing a column&#39;s  [[create-table/#default-column-option|DEFAULT]] value with [[alter-table/#algorithm|ALGORITHM]] set to ##NOCOPY## in the cases where the operation supports having the [[alter-table/#algorithm|ALGORITHM]] clause set to ##INSTANT##.

See [[innodb-online-ddl-operations-with-algorithminstant/#removing-a-columns-default-value|InnoDB Online DDL Operations with ALGORITHM=INSTANT: Removing a Column&#39;s Default Value]] for more information.

=== ##ALTER TABLE ... CHANGE COLUMN##

InnoDB supports renaming a column with [[alter-table/#algorithm|ALGORITHM]] set to ##NOCOPY## in the cases where the operation supports having the [[alter-table/#algorithm|ALGORITHM]] clause set to ##INSTANT##.

See [[innodb-online-ddl-operations-with-algorithminstant/#alter-table-change-column|InnoDB Online DDL Operations with ALGORITHM=INSTANT: ALTER TABLE ... CHANGE COLUMN]] for more information.

This applies to [[alter-table/#change-column|ALTER TABLE ... CHANGE COLUMN]] for [[innodb|InnoDB]] tables.

== Index Operations

=== ##ALTER TABLE ... ADD PRIMARY KEY##

InnoDB does **not** support adding a primary key to a table with [[alter-table/#algorithm|ALGORITHM]] set to ##NOCOPY##.

For example:

&lt;&lt;code wrap=true lang=sql&gt;&gt;
CREATE OR REPLACE TABLE tab (
   a int,
   b varchar(50),
   c varchar(50)
);

SET SESSION sql_mode=&#39;STRICT_TRANS_TABLES&#39;;
SET SESSION alter_algorithm=&#39;NOCOPY&#39;;
ALTER TABLE tab ADD PRIMARY KEY (a);
ERROR 1845 (0A000): ALGORITHM=NOCOPY is not supported for this operation. Try ALGORITHM=INPLACE
&lt;&lt;/code&gt;&gt;

This applies to [[alter-table/#add-primary-key|ALTER TABLE ... ADD PRIMARY KEY]] for [[innodb|InnoDB]] tables.

=== ##ALTER TABLE ... DROP PRIMARY KEY##

InnoDB does **not** support dropping a primary key with [[alter-table/#algorithm|ALGORITHM]] set to ##NOCOPY##.

For example:

&lt;&lt;code lang=sql wrap=true&gt;&gt;
CREATE OR REPLACE TABLE tab (
   a int PRIMARY KEY,
   b varchar(50),
   c varchar(50)
);

SET SESSION alter_algorithm=&#39;NOCOPY&#39;;
ALTER TABLE tab DROP PRIMARY KEY;
ERROR 1846 (0A000): ALGORITHM=NOCOPY is not supported. Reason: Dropping a primary key is not allowed without also adding a new primary key. Try ALGORITHM=COPY
&lt;&lt;/code&gt;&gt;

This applies to [[alter-table/#drop-primary-key|ALTER TABLE ... DROP PRIMARY KEY]] for [[innodb|InnoDB]] tables.

=== ##ALTER TABLE ... ADD INDEX## and ##CREATE INDEX##

This applies to [[alter-table/#add-index|ALTER TABLE ... ADD INDEX]] and [[create-index|CREATE INDEX]] for [[innodb|InnoDB]] tables.

==== Adding a Plain Index

InnoDB supports adding a plain index to a table with [[alter-table/#algorithm|ALGORITHM]] set to ##NOCOPY##.

This operation supports the non-locking strategy. This strategy can be explicitly chosen by setting the [[alter-table/#lock|LOCK]] clause to ##NONE##. When this strategy is used, all concurrent DML is permitted.

For example, this succeeds:

&lt;&lt;sql&gt;&gt;
CREATE OR REPLACE TABLE tab (
   a int PRIMARY KEY,
   b varchar(50),
   c varchar(50)
);

SET SESSION alter_algorithm=&#39;NOCOPY&#39;;
ALTER TABLE tab ADD INDEX b_index (b);
Query OK, 0 rows affected (0.009 sec)
&lt;&lt;/sql&gt;&gt;

And this succeeds:

&lt;&lt;sql&gt;&gt;
CREATE OR REPLACE TABLE tab (
   a int PRIMARY KEY,
   b varchar(50),
   c varchar(50)
);

SET SESSION alter_algorithm=&#39;NOCOPY&#39;;
CREATE INDEX b_index ON tab (b);
Query OK, 0 rows affected (0.009 sec)
&lt;&lt;/sql&gt;&gt;

==== Adding a Fulltext Index

InnoDB supports adding a [[full-text-indexes|FULLTEXT]] index to a table with [[alter-table/#algorithm|ALGORITHM]] set to ##NOCOPY##.

However, there are some limitations, such as:

* Adding a [[full-text-indexes|FULLTEXT]] index to a table that does not have a user-defined ##FTS_DOC_ID## column will require the table to be rebuilt once. When the table is rebuilt, the system adds a hidden ##FTS_DOC_ID## column. This initial operation will have to be performed with [[alter-table/#algorithm|ALGORITHM]] set to ##INPLACE##.From that point forward, adding additional [[full-text-indexes|FULLTEXT]] indexes to the same table will not require the table to be rebuilt, and [[alter-table/#algorithm|ALGORITHM]] can be set to ##NOCOPY##.

* Only one [[full-text-indexes|FULLTEXT]] index may be added at a time when [[alter-table/#algorithm|ALGORITHM]] is set to ##NOCOPY##.

This operation supports a read-only locking strategy. This strategy can be explicitly chosen by setting the [[alter-table/#lock|LOCK]] clause to ##SHARED##. When this strategy is used, read-only concurrent DML is permitted. 

For example, this succeeds, but the first operation requires the table to be rebuilt [[alter-table/#algorithm|ALGORITHM]] set to ##INPLACE##, so that the hidden ##FTS_DOC_ID## column can be added:

&lt;&lt;sql&gt;&gt;
CREATE OR REPLACE TABLE tab (
   a int PRIMARY KEY,
   b varchar(50),
   c varchar(50)
);

SET SESSION alter_algorithm=&#39;INPLACE&#39;;
ALTER TABLE tab ADD FULLTEXT INDEX b_index (b);
Query OK, 0 rows affected (0.043 sec)

SET SESSION alter_algorithm=&#39;NOCOPY&#39;;
ALTER TABLE tab ADD FULLTEXT INDEX c_index (c);
Query OK, 0 rows affected (0.017 sec)
&lt;&lt;/sql&gt;&gt;

And this succeeds in the same way as above:

&lt;&lt;sql&gt;&gt;
CREATE OR REPLACE TABLE tab (
   a int PRIMARY KEY,
   b varchar(50),
   c varchar(50)
);

SET SESSION alter_algorithm=&#39;INPLACE&#39;;
CREATE FULLTEXT INDEX b_index ON tab (b);
Query OK, 0 rows affected (0.048 sec)

SET SESSION alter_algorithm=&#39;NOCOPY&#39;;
CREATE FULLTEXT INDEX c_index ON tab (c);
Query OK, 0 rows affected (0.016 sec)
&lt;&lt;/sql&gt;&gt;

But this second command fails, because only one [[full-text-indexes|FULLTEXT]] index can be added at a time:

&lt;&lt;code wrap=true lang=sql&gt;&gt;
CREATE OR REPLACE TABLE tab (
   a int PRIMARY KEY,
   b varchar(50),
   c varchar(50),
   d varchar(50)
);

SET SESSION alter_algorithm=&#39;INPLACE&#39;;
ALTER TABLE tab ADD FULLTEXT INDEX b_index (b);
Query OK, 0 rows affected (0.041 sec)

SET SESSION alter_algorithm=&#39;NOCOPY&#39;;
ALTER TABLE tab ADD FULLTEXT INDEX c_index (c), ADD FULLTEXT INDEX d_index (d);
ERROR 1846 (0A000): ALGORITHM=NOCOPY is not supported. Reason: InnoDB presently supports one FULLTEXT index creation at a time. Try ALGORITHM=COPY
&lt;&lt;/code&gt;&gt;

==== Adding a Spatial Index

InnoDB supports adding a [[spatial-index|SPATIAL]] index to a table with [[alter-table/#algorithm|ALGORITHM]] set to ##NOCOPY##.

This operation supports a read-only locking strategy. This strategy can be explicitly chosen by setting the [[alter-table/#lock|LOCK]] clause to ##SHARED##. When this strategy is used, read-only concurrent DML is permitted. 

For example, this succeeds:

&lt;&lt;sql&gt;&gt;
CREATE OR REPLACE TABLE tab (
   a int PRIMARY KEY,
   b varchar(50),
   c GEOMETRY NOT NULL
);

SET SESSION alter_algorithm=&#39;NOCOPY&#39;;
ALTER TABLE tab ADD SPATIAL INDEX c_index (c);
Query OK, 0 rows affected (0.005 sec)
&lt;&lt;/sql&gt;&gt;

And this succeeds in the same way as above:

&lt;&lt;sql&gt;&gt;
CREATE OR REPLACE TABLE tab (
   a int PRIMARY KEY,
   b varchar(50),
   c GEOMETRY NOT NULL
);

SET SESSION alter_algorithm=&#39;NOCOPY&#39;;
CREATE SPATIAL INDEX c_index ON tab (c);
Query OK, 0 rows affected (0.005 sec)
&lt;&lt;/sql&gt;&gt;

=== ##ALTER TABLE ... DROP INDEX## and ##DROP INDEX##

InnoDB supports dropping indexes from a table with [[alter-table/#algorithm|ALGORITHM]] set to ##NOCOPY## in the cases where the operation supports having the [[alter-table/#algorithm|ALGORITHM]] clause set to ##INSTANT##.

See [[innodb-online-ddl-operations-with-algorithminstant/#alter-table-drop-index-and-drop-index|InnoDB Online DDL Operations with ALGORITHM=INSTANT: ALTER TABLE ... DROP INDEX and DROP INDEX]] for more information.

This applies to [[alter-table/#drop-index|ALTER TABLE ... DROP INDEX]] and [[drop-index|DROP INDEX]] for [[innodb|InnoDB]] tables.

=== ##ALTER TABLE ... ADD FOREIGN KEY##

InnoDB does supports adding foreign key constraints to a table with [[alter-table/#algorithm|ALGORITHM]] set to ##NOCOPY##. In order to add a new foreign key constraint to a table with [[alter-table/#algorithm|ALGORITHM]] set to ##NOCOPY##, the [[server-system-variables/#foreign_key_checks|foreign_key_checks]] system variable needs to be set to ##OFF##. If it is set to ##ON##, then ##ALGORITHM=COPY## is required.

This operation supports the non-locking strategy. This strategy can be explicitly chosen by setting the [[alter-table/#lock|LOCK]] clause to ##NONE##. When this strategy is used, all concurrent DML is permitted.

For example, this fails:

&lt;&lt;code wrap=true lang=sql&gt;&gt;
CREATE OR REPLACE TABLE tab1 (
   a int PRIMARY KEY,
   b varchar(50),
   c varchar(50),
   d int
);

CREATE OR REPLACE TABLE tab2 (
   a int PRIMARY KEY,
   b varchar(50)
);

SET SESSION alter_algorithm=&#39;NOCOPY&#39;;
ALTER TABLE tab1 ADD FOREIGN KEY tab2_fk (d) REFERENCES tab2 (a);
ERROR 1846 (0A000): ALGORITHM=NOCOPY is not supported. Reason: Adding foreign keys needs foreign_key_checks=OFF. Try ALGORITHM=COPY
&lt;&lt;/code&gt;&gt;

But this succeeds:

&lt;&lt;sql&gt;&gt;
CREATE OR REPLACE TABLE tab1 (
   a int PRIMARY KEY,
   b varchar(50),
   c varchar(50),
   d int
);

CREATE OR REPLACE TABLE tab2 (
   a int PRIMARY KEY,
   b varchar(50)
);

SET SESSION foreign_key_checks=OFF;
SET SESSION alter_algorithm=&#39;NOCOPY&#39;;
ALTER TABLE tab1 ADD FOREIGN KEY tab2_fk (d) REFERENCES tab2 (a);
Query OK, 0 rows affected (0.011 sec)
&lt;&lt;/sql&gt;&gt;

This applies to [[alter-table/#add-foreign-key|ALTER TABLE ... ADD FOREIGN KEY]] for [[innodb|InnoDB]] tables.

=== ##ALTER TABLE ... DROP FOREIGN KEY##

InnoDB supports dropping foreign key constraints from a table with [[alter-table/#algorithm|ALGORITHM]] set to ##NOCOPY## in the cases where the operation supports having the [[alter-table/#algorithm|ALGORITHM]] clause set to ##INSTANT##.

See [[innodb-online-ddl-operations-with-algorithminstant/#alter-table-drop-foreign-key|InnoDB Online DDL Operations with ALGORITHM=INSTANT: ALTER TABLE ... DROP FOREIGN KEY]] for more information.

This applies to [[alter-table/#drop-foreign-key|ALTER TABLE ... DROP FOREIGN KEY]] for [[innodb|InnoDB]] tables.

== Table Operations

=== ##ALTER TABLE ... AUTO_INCREMENT=...##

InnoDB supports changing a table&#39;s [[auto_increment|AUTO_INCREMENT]] value with [[alter-table/#algorithm|ALGORITHM]] set to ##NOCOPY## in the cases where the operation supports having the [[alter-table/#algorithm|ALGORITHM]] clause set to ##INSTANT##.

See [[innodb-online-ddl-operations-with-algorithminstant/#alter-table-auto_increment|InnoDB Online DDL Operations with ALGORITHM=INSTANT: ALTER TABLE ... AUTO_INCREMENT=...]] for more information.

This applies to [[create-table/#auto_increment|ALTER TABLE ... AUTO_INCREMENT=...]] for [[innodb|InnoDB]] tables.

=== ##ALTER TABLE ... ROW_FORMAT=...##

InnoDB does **not** support changing a table&#39;s [[innodb-storage-formats|row format]] with [[alter-table/#algorithm|ALGORITHM]] set to ##NOCOPY##.

For example:

&lt;&lt;code wrap=true lang=sql&gt;&gt;
CREATE OR REPLACE TABLE tab (
   a int PRIMARY KEY,
   b varchar(50),
   c varchar(50)
) ROW_FORMAT=DYNAMIC;

SET SESSION alter_algorithm=&#39;NOCOPY&#39;;
ALTER TABLE tab ROW_FORMAT=COMPRESSED;
ERROR 1846 (0A000): ALGORITHM=NOCOPY is not supported. Reason: Changing table options requires the table to be rebuilt. Try ALGORITHM=INPLACE
&lt;&lt;/code&gt;&gt;

This applies to [[create-table/#row_format|ALTER TABLE ... ROW_FORMAT=...]] for [[innodb|InnoDB]] tables.

=== ##ALTER TABLE ... KEY_BLOCK_SIZE=...##

InnoDB does **not** support changing a table&#39;s [[innodb-storage-formats/#using-the-compressed-row-format|KEY_BLOCK_SIZE]] with [[alter-table/#algorithm|ALGORITHM]] set to ##NOCOPY##.

For example:

&lt;&lt;code wrap=true lang=sql&gt;&gt;
CREATE OR REPLACE TABLE tab (
   a int PRIMARY KEY,
   b varchar(50),
   c varchar(50)
) ROW_FORMAT=COMPRESSED
  KEY_BLOCK_SIZE=4;

SET SESSION alter_algorithm=&#39;NOCOPY&#39;;
ALTER TABLE tab KEY_BLOCK_SIZE=2;
ERROR 1846 (0A000): ALGORITHM=NOCOPY is not supported. Reason: Changing table options requires the table to be rebuilt. Try ALGORITHM=INPLACE
&lt;&lt;/code&gt;&gt;

This applies to [[create-table/#key_block_size|KEY_BLOCK_SIZE=...]] for [[innodb|InnoDB]] tables.

=== ##ALTER TABLE ... PAGE_COMPRESSED=1## and ##ALTER TABLE ... PAGE_COMPRESSION_LEVEL=...##

In MariaDB 10.3.10 and later, InnoDB supports setting a table&#39;s [[create-table/#page_compressed|PAGE_COMPRESSED]] value to ##1## with [[alter-table/#algorithm|ALGORITHM]] set to ##NOCOPY## in the cases where the operation supports having the [[alter-table/#algorithm|ALGORITHM]] clause set to ##INSTANT##.

InnoDB does **not** support changing a table&#39;s [[create-table/#page_compressed|PAGE_COMPRESSED]] value from ##1## to ##0## with [[alter-table/#algorithm|ALGORITHM]] set to ##NOCOPY##.

In these versions, InnoDB also supports changing a table&#39;s [[create-table/#page_compression_level|PAGE_COMPRESSION_LEVEL]] value with [[alter-table/#algorithm|ALGORITHM]] set to ##NOCOPY## in the cases where the operation supports having the [[alter-table/#algorithm|ALGORITHM]] clause is set to ##INSTANT##.

See [[innodb-online-ddl-operations-with-algorithminstant/#alter-table-page_compressed1-and-alter-table-page_compression_level|InnoDB Online DDL Operations with ALGORITHM=INSTANT: ALTER TABLE ... PAGE_COMPRESSED=1 and ALTER TABLE ... PAGE_COMPRESSION_LEVEL=...]] for more information.

This applies to [[create-table/#page_compressed|ALTER TABLE ... PAGE_COMPRESSED=...]] and [[create-table/#page_compression_level|ALTER TABLE ... PAGE_COMPRESSION_LEVEL=...]] for [[innodb|InnoDB]] tables.

=== ##ALTER TABLE ... DROP SYSTEM VERSIONING##

InnoDB does **not** support dropping [[system-versioned-tables|system versioning]] from a table with [[alter-table/#algorithm|ALGORITHM]] set to ##NOCOPY##.

For example:

&lt;&lt;code lang=sql wrap=sql&gt;&gt;
CREATE OR REPLACE TABLE tab (
   a int PRIMARY KEY,
   b varchar(50),
   c varchar(50)
) WITH SYSTEM VERSIONING;

SET SESSION alter_algorithm=&#39;NOCOPY&#39;;
ALTER TABLE tab DROP SYSTEM VERSIONING;
ERROR 1845 (0A000): ALGORITHM=NOCOPY is not supported for this operation. Try ALGORITHM=INPLACE
&lt;&lt;/code&gt;&gt;

This applies to [[alter-table/#drop-system-versioning|ALTER TABLE ... DROP SYSTEM VERSIONING]] for [[innodb|InnoDB]] tables.

=== ##ALTER TABLE ... DROP CONSTRAINT##

In MariaDB 10.3.6 and later, InnoDB supports dropping a [[constraint/#check-constraints|CHECK]] constraint from a table with [[alter-table/#algorithm|ALGORITHM]] set to ##NOCOPY## in the cases where the operation supports having the [[alter-table/#algorithm|ALGORITHM]] clause set to ##INSTANT##.

See [[innodb-online-ddl-operations-with-algorithminstant/#alter-table-drop-constraint|InnoDB Online DDL Operations with ALGORITHM=INSTANT: ALTER TABLE ... DROP CONSTRAINT]] for more information.

This applies to [[alter-table/#drop-constraint|ALTER TABLE ... DROP CONSTRAINT]] for [[innodb|InnoDB]] tables.

=== ##ALTER TABLE ... FORCE##

InnoDB does **not** support forcing a table rebuild with [[alter-table/#algorithm|ALGORITHM]] set to ##NOCOPY##.

For example:

&lt;&lt;code wrap=true lang=sql&gt;&gt;
CREATE OR REPLACE TABLE tab (
   a int PRIMARY KEY,
   b varchar(50),
   c varchar(50)
);

SET SESSION alter_algorithm=&#39;NOCOPY&#39;;
ALTER TABLE tab FORCE;
ERROR 1845 (0A000): ALGORITHM=NOCOPY is not supported for this operation. Try ALGORITHM=INPLACE
&lt;&lt;/code&gt;&gt;

This applies to [[alter-table/#force|ALTER TABLE ... FORCE]] for [[innodb|InnoDB]] tables.

=== ##ALTER TABLE ... ENGINE=InnoDB##

InnoDB does **not** support forcing a table rebuild with [[alter-table/#algorithm|ALGORITHM]] set to ##NOCOPY##.

For example:

&lt;&lt;sql&gt;&gt;
CREATE OR REPLACE TABLE tab (
   a int PRIMARY KEY,
   b varchar(50),
   c varchar(50)
);

SET SESSION alter_algorithm=&#39;NOCOPY&#39;;
ALTER TABLE tab ENGINE=InnoDB;
ERROR 1845 (0A000): ALGORITHM=NOCOPY is not supported for this operation. Try ALGORITHM=INPLACE
&lt;&lt;/sql&gt;&gt;

This applies to [[create-table/#storage-engine|ALTER TABLE ... ENGINE=InnoDB]] for [[innodb|InnoDB]] tables.

=== ##OPTIMIZE TABLE ...##

InnoDB does **not** support optimizing a table with with [[alter-table/#algorithm|ALGORITHM]] set to ##NOCOPY##.

For example:

&lt;&lt;code wrap=true lang=sql&gt;&gt;
CREATE OR REPLACE TABLE tab (
   a int PRIMARY KEY,
   b varchar(50),
   c varchar(50)
);

SHOW GLOBAL VARIABLES WHERE Variable_name IN(&#39;innodb_defragment&#39;, &#39;innodb_optimize_fulltext_only&#39;);
+-------------------------------+-------+
| Variable_name                 | Value |
+-------------------------------+-------+
| innodb_defragment             | OFF   |
| innodb_optimize_fulltext_only | OFF   |
+-------------------------------+-------+
2 rows in set (0.001 sec)

SET SESSION alter_algorithm=&#39;NOCOPY&#39;;
OPTIMIZE TABLE tab;
+---------+----------+----------+-----------------------------------------------------------------------------+
| Table   | Op       | Msg_type | Msg_text                                                                    |
+---------+----------+----------+-----------------------------------------------------------------------------+
| db1.tab | optimize | note     | Table does not support optimize, doing recreate + analyze instead           |
| db1.tab | optimize | error    | ALGORITHM=NOCOPY is not supported for this operation. Try ALGORITHM=INPLACE |
| db1.tab | optimize | status   | Operation failed                                                            |
+---------+----------+----------+-----------------------------------------------------------------------------+
3 rows in set, 1 warning (0.002 sec)
&lt;&lt;/code&gt;&gt;

This applies to [[optimize-table|OPTIMIZE TABLE]] for [[innodb|InnoDB]] tables.

=== ##ALTER TABLE ... RENAME TO## and ##RENAME TABLE ...##

InnoDB supports renaming a table with [[alter-table/#algorithm|ALGORITHM]] set to ##NOCOPY## in the cases where the operation supports having the [[alter-table/#algorithm|ALGORITHM]] clause set to ##INSTANT##.

See [[innodb-online-ddl-operations-with-algorithminstant/#alter-table-rename-to-and-rename-table|InnoDB Online DDL Operations with ALGORITHM=INSTANT: ALTER TABLE ... RENAME TO and RENAME TABLE ...]] for more information.

This applies to [[alter-table/#rename-to|ALTER TABLE ... RENAME TO]] and [[rename-table|RENAME TABLE]] for [[innodb|InnoDB]] tables.

== Limitations

=== Limitations Related to Generated (Virtual and Persistent/Stored) Columns

[[generated-columns|Generated columns]] do not currently support online DDL for all of the same operations that are supported for &#34;real&#34; columns.

See [[generated-columns/#statement-support|Generated (Virtual and Persistent/Stored) Columns: Statement Support]] for more information on the limitations.</textarea>
    


                    <div id="content_disclaimer" class="graybox">
                        Content reproduced on this site is the property of its respective owners,
                        and this content is not reviewed in advance by MariaDB. The views, information and opinions
                        expressed by this content do not necessarily represent those of MariaDB or any other party.
                    </div>
                </div>
            </section>

            
        </div>
    </div>
</div>

<!-- Footer -->
<footer id="footer">
    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-xs-12">
                    <ul class="list-inline text-center footer-nav">
                        <li>
                            <h5>
                                <a href="https://mariadb.com/products" title="Products">Products</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/services" title="Services">Services</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/pricing" title="Pricing">Pricing</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/resources" title="Resources">Resources</a>
                            </h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/about-us" title="About MariaDB">About Us</a></h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/download" title="Download">Download MariaDB</a></h5>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="row row-10">
                
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div id="block-footerformcontact" class="block block-block-content block-block-contentd754ee1b-3cc9-40e7-9ef4-f504f1197fb1">
                        
                            <h5 style="font-weight: 400;">Subscribe to our newsletter!</h5>
                            <script src="//app-sj15.marketo.com/js/forms2/js/forms2.min.js"></script><form id="mktoForm_1498"></form>
                            <script>
                                <!--//--><![CDATA[// ><!--
                                MktoForms2.loadForm("//app-sj15.marketo.com", "573-PXI-984", 1498);
                                //--><!]]]]><![CDATA[>
                                //--><!]]>
                            </script>
                        
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div class="footer-copyright">
                        <div class="text-center">
                            <ul class="list-inline no-margin">
                                <li>
                                    <a href="/legal" title="Legal">Legal</a>
                                </li>
                                <li>
                                    <a href="/privacy-policy" title="Privacy Policy">Privacy Policy</a>
                                </li>
                                <li>
                                    <a href="/cookie-policy/" title="Cookies">Cookie Policy</a>
                                </li>
                            </ul>
                            <p>Copyright &copy; 2024 MariaDB. All rights reserved.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</footer>
</div>

<div id="ajax_loading">
    <img src="/kb/static/images/ajax-loader.a51c5608d01a.gif" />
</div>

    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MK2847"
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MK2847');</script>
    <!-- End Google Tag Manager -->

</body>

<script type="text/javascript" src="/kb/static/js/main.1587e3a666fc.js" charset="utf-8"></script>

</html>