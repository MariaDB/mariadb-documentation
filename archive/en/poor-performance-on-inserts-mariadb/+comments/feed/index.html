<?xml version="1.0" encoding="utf-8"?>
<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title>MariaDB Knowledge Base Comments for: Poor performance on inserts MariaDB  </title><link>https://mariadb.com/kb/en/poor-performance-on-inserts-mariadb/+comments/feed/</link><description></description><atom:link href="https://mariadb.com/kb/en/poor-performance-on-inserts-mariadb/+comments/feed/" rel="self"></atom:link><language>en-us</language><lastBuildDate>Tue, 17 Oct 2023 01:03:40 +0000</lastBuildDate><item><title>Re: Poor performance on inserts MariaDB  </title><link>https://mariadb.com/kb/en/poor-performance-on-inserts-mariadb/+comments/2255</link><description>&lt;p&gt;I enabled the performance schema and ran queries to find where the bottleneck it. See below. It appears to be System lock, Table lock, and update.  I'll focus on these issues.  Any comments on why we might reduce locking will be appreciated.&lt;/p&gt;
&lt;p&gt;+------------+-----------------------------------------------------+-----------+---------------+-------------+-------------------+&lt;/p&gt;
&lt;table&gt;&lt;tr&gt;&lt;td&gt;user&lt;/td&gt;&lt;td&gt;event_name&lt;/td&gt;&lt;td&gt;total&lt;/td&gt;&lt;td&gt;total_latency&lt;/td&gt;&lt;td&gt;avg_latency&lt;/td&gt;&lt;td&gt;total_latency&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;
&lt;p&gt;+------------+-----------------------------------------------------+-----------+---------------+-------------+-------------------+&lt;/p&gt;
&lt;table&gt;&lt;tr&gt;&lt;td&gt;pedadba&lt;/td&gt;&lt;td&gt;stage/sql/System lock&lt;/td&gt;&lt;td&gt;12755390&lt;/td&gt;&lt;td&gt;5.45 h&lt;/td&gt;&lt;td&gt;1.54 ms&lt;/td&gt;&lt;td&gt;19626537585557000&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;pedadba&lt;/td&gt;&lt;td&gt;stage/sql/Table lock&lt;/td&gt;&lt;td&gt;12755397&lt;/td&gt;&lt;td&gt;4.74 h&lt;/td&gt;&lt;td&gt;1.34 ms&lt;/td&gt;&lt;td&gt;17069504681410000&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;pedadba&lt;/td&gt;&lt;td&gt;stage/sql/update&lt;/td&gt;&lt;td&gt;12754124&lt;/td&gt;&lt;td&gt;4.39 h&lt;/td&gt;&lt;td&gt;1.24 ms&lt;/td&gt;&lt;td&gt;15808410965848000&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;pedadba&lt;/td&gt;&lt;td&gt;stage/sql/Unlocking tables&lt;/td&gt;&lt;td&gt;12755386&lt;/td&gt;&lt;td&gt;3.54 h&lt;/td&gt;&lt;td&gt;999.80 us&lt;/td&gt;&lt;td&gt;12752902800174000&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;background&lt;/td&gt;&lt;td&gt;stage/sql/Waiting for background binlog tasks&lt;/td&gt;&lt;td&gt;9&lt;/td&gt;&lt;td&gt;56.19 m&lt;/td&gt;&lt;td&gt;6.24 m&lt;/td&gt;&lt;td&gt;3371540382932000&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;pedadba&lt;/td&gt;&lt;td&gt;stage/sql/init&lt;/td&gt;&lt;td&gt;38261083&lt;/td&gt;&lt;td&gt;26.29 m&lt;/td&gt;&lt;td&gt;41.23 us&lt;/td&gt;&lt;td&gt;1577505387502000&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;
&lt;p&gt;+------------------------------------+--------------------------------------------------------+------------+---------------+-------------+-------------+-------------------+&lt;/p&gt;
&lt;table&gt;&lt;tr&gt;&lt;td&gt;host&lt;/td&gt;&lt;td&gt;event&lt;/td&gt;&lt;td&gt;total&lt;/td&gt;&lt;td&gt;total_latency&lt;/td&gt;&lt;td&gt;avg_latency&lt;/td&gt;&lt;td&gt;max_latency&lt;/td&gt;&lt;td&gt;total_latency&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;
&lt;p&gt;+------------------------------------+--------------------------------------------------------+------------+---------------+-------------+-------------+-------------------+&lt;/p&gt;
&lt;table&gt;&lt;tr&gt;&lt;td&gt;zlx70603.vci.att.com&lt;/td&gt;&lt;td&gt;wait/lock/table/sql/handler&lt;/td&gt;&lt;td&gt;5968125450&lt;/td&gt;&lt;td&gt;7.39 h&lt;/td&gt;&lt;td&gt;4.46 us&lt;/td&gt;&lt;td&gt;70.14 ms&lt;/td&gt;&lt;td&gt;26590505970155343&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;zlx70603.vci.att.com&lt;/td&gt;&lt;td&gt;wait/io/table/sql/handler&lt;/td&gt;&lt;td&gt;21366774&lt;/td&gt;&lt;td&gt;3.08 h&lt;/td&gt;&lt;td&gt;519.51 us&lt;/td&gt;&lt;td&gt;762.54 ms&lt;/td&gt;&lt;td&gt;11100210290586231&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;background&lt;/td&gt;&lt;td&gt;wait/io/file/innodb/innodb_data_file&lt;/td&gt;&lt;td&gt;1526689&lt;/td&gt;&lt;td&gt;11.14 m&lt;/td&gt;&lt;td&gt;437.99 us&lt;/td&gt;&lt;td&gt;245.95 ms&lt;/td&gt;&lt;td&gt;668673251037036&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;zlx70603.vci.att.com&lt;/td&gt;&lt;td&gt;wait/io/file/innodb/innodb_data_file&lt;/td&gt;&lt;td&gt;384703&lt;/td&gt;&lt;td&gt;5.80 m&lt;/td&gt;&lt;td&gt;904.07 us&lt;/td&gt;&lt;td&gt;237.48 ms&lt;/td&gt;&lt;td&gt;347796883650678&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;background&lt;/td&gt;&lt;td&gt;wait/io/file/innodb/innodb_log_file&lt;/td&gt;&lt;td&gt;52359&lt;/td&gt;&lt;td&gt;2.70 m&lt;/td&gt;&lt;td&gt;3.10 ms&lt;/td&gt;&lt;td&gt;130.79 ms&lt;/td&gt;&lt;td&gt;162268658433654&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;zlx70603.vci.att.com&lt;/td&gt;&lt;td&gt;wait/io/file/innodb/innodb_log_file&lt;/td&gt;&lt;td&gt;12533&lt;/td&gt;&lt;td&gt;41.46 s&lt;/td&gt;&lt;td&gt;3.31 ms&lt;/td&gt;&lt;td&gt;138.57 ms&lt;/td&gt;&lt;td&gt;41463102266223&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;zlx70603.vci.att.com&lt;/td&gt;&lt;td&gt;wait/io/file/sql/binlog&lt;/td&gt;&lt;td&gt;1488498&lt;/td&gt;&lt;td&gt;36.00 s&lt;/td&gt;&lt;td&gt;24.18 us&lt;/td&gt;&lt;td&gt;218.11 ms&lt;/td&gt;&lt;td&gt;35997948198705&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Andy Ferretti</dc:creator><guid>https://mariadb.com/kb/en/poor-performance-on-inserts-mariadb/+comments/2255</guid></item><item><title>Re: Poor performance on inserts MariaDB  </title><link>https://mariadb.com/kb/en/poor-performance-on-inserts-mariadb/+comments/2254</link><description>&lt;p&gt;Thanks for the suggestion.  I can look into it, but I'd like to see what the MariaDB people have to say.  From this link, it appears that I would be moving away from the engine that MariaDB believe is best:
&lt;a href="https://mariadb.com/kb/en/mariadb/xtradb-and-innodb/"&gt;https://mariadb.com/kb/en/mariadb/xtradb-and-innodb/&lt;/a&gt;  
I've been trying to find the root cause of the performance difference. I'll put some notes into an additional entry.&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Andy Ferretti</dc:creator><guid>https://mariadb.com/kb/en/poor-performance-on-inserts-mariadb/+comments/2254</guid></item><item><title>Re: Poor performance on inserts MariaDB  </title><link>https://mariadb.com/kb/en/poor-performance-on-inserts-mariadb/+comments/2240</link><description>&lt;p&gt;Did you use xtradb (default) or innodb_plugin (needs to be configured) ? At least on my performance testing in many cases innodb_plugin offers better performance.&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Jan Lindstr√∂m</dc:creator><guid>https://mariadb.com/kb/en/poor-performance-on-inserts-mariadb/+comments/2240</guid></item><item><title>Re: Poor performance on inserts MariaDB  </title><link>https://mariadb.com/kb/en/poor-performance-on-inserts-mariadb/+comments/2236</link><description>&lt;p&gt;We have learned something. The entries in the log with WRITE are from the stored procedure, that is owned by account isaac_all.
20160509 09:16:29,zlx70756,isaac_all,%,32,11812791,WRITE,ped,ped_location_load,
When we added server_audit_excl_users=isaac_all, performance went from 476 rows/ second to 1,250 rows / second.  We still have a ways to go to match Oracle at 2,500 rows/ second.   We also still see a few "System locks" and "Table locks"  in the "SHOW ENGINE INNODB STATUS" output.   Any other suggestions would be appreciated.&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Andy Ferretti</dc:creator><guid>https://mariadb.com/kb/en/poor-performance-on-inserts-mariadb/+comments/2236</guid></item></channel></rss>