<!DOCTYPE html>
<html>
<head data-cookie-domain=""
      data-cookie-path="/">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="apple-touch-icon" sizes="180x180" href="/kb/static/images/favicons/apple-touch-icon.159e713979be.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/kb/static/images/favicons/favicon-32x32.bc0ac1d5d11e.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/kb/static/images/favicons/favicon-16x16.5801f8f0f34e.png">
    <link rel="shortcut icon" href="/kb/static/images/favicons/favicon.d122d305dee4.ico" type="image/x-icon" />

    <title>Spider Storage Engine Overview - Source - MariaDB Knowledge Base</title>

    <link href="/kb/static/css/main.f7633538c846.css" rel="stylesheet" type="text/css" />

    
        <meta name="robots" content="noindex, nofollow">
    

    

    <!-- FB Open Graph tags -->
    <meta property="og:title" content="Spider Storage Engine Overview - Source" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://mariadb.com/kb/en/spider-storage-engine-overview/+source/" />
    <meta property="og:image" content="http://mariadb.comaskmonty-logo.png" />
    <meta property="og:site_name" content="MariaDB KnowledgeBase" />
    <meta property="fb:admins" content="514852603" />
    <meta property="og:description" content="" />

    <meta name="description" content="" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet"/>
    
</head>
<body class="mpkb nodes autoresize nodes_source jqui" id="nodes_source">





<div id="menu-mobile" class="visible-sm visible-xs">

    <div>
        <div id="mobile-close-menu" class="text-right">
            <a href="javascript:void(0)" title="Close Menu" id="back-main" class="toggle-menu">X<span></span></a>
        </div>
    </div>
    <div class="mainmenu-mobile">
        <ul class="ls-none ul-menu">
            <li data-sub="submenu5"><a class="open-form-search" href="/kb/search/" title="Search">Search </a></li>
            <li data-sub="submenu0"><a href="/products" title="Products">Products</a><span class="arrow-main"></span></li>
            <li data-sub="submenu1"><a href="/services" title="Services">Services</a><span class="arrow-main"></span></li>
            <li data-sub="submenu2"><a href="/resources" title="Resources">Resources</a><span class="arrow-main"></span></li>
            <li data-sub="submenu3"><a href="/about-us" title="About">About</a><span class="arrow-main"></span></li>
            <li data-sub="submenu4"><a href="/contact" title="Contact">Contact</a></li>
        </ul>
    </div>

    <div class="nav-top-mobile">
        <div class="select-box form">

            <ul class="inline-block-md mb-none top-nav">
                <li>

                </li>
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/spider-storage-engine-overview/+source/"> Login</a>
                    </li>
                
            </ul>



        </div>
        <p class="text-center copyright">Copyright &copy; 2025 MariaDB. All rights reserved.</p>
    </div>
</div>
<div class="violator-wrap d-none" id="top_violator">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12">
                <div class="violator-outer">
                    <div class="violator-inner">
                        <div class="row">
                            <div class="col-xs-12 col-sm-9 col-lg-7 col-lg-offset-2" id="top_violator_content">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="content-link" target="_blank" rel="nofollow noreferrer">
                                    <span>The Ultimate Guide to High Availability with MariaDB</span>
                                </a>
                            </div>
                            <div class="col-xs-12 col-sm-3" id="top_violator_cta">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="btn btn-mariadb" target="_blank" rel="nofollow noreferrer">Download Now</a>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-link close-btn">
                        <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24" width="15px" height="15px"><path d="M 4.9902344 3.9902344 A 1.0001 1.0001 0 0 0 4.2929688 5.7070312 L 10.585938 12 L 4.2929688 18.292969 A 1.0001 1.0001 0 1 0 5.7070312 19.707031 L 12 13.414062 L 18.292969 19.707031 A 1.0001 1.0001 0 1 0 19.707031 18.292969 L 13.414062 12 L 19.707031 5.7070312 A 1.0001 1.0001 0 0 0 18.980469 3.9902344 A 1.0001 1.0001 0 0 0 18.292969 4.2929688 L 12 10.585938 L 5.7070312 4.2929688 A 1.0001 1.0001 0 0 0 4.9902344 3.9902344 z"/></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="wrapper">
<div id="top-nav">
    <div class="container">
        <ul class="hidden-sm hidden-xs" >
            <li><a href="https://mariadb.com/kb/">Knowledge Base</a></li>
            <li><a href="https://mariadb.com/contact/">Contact</a></li>
            
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/spider-storage-engine-overview/+source/" rel="nofollow">Login</a>
                    </li>
                
            
            
            <li id="search-form">
                <form action="/kb/en/+search/" method="get" id="search-block-form" accept-charset="UTF-8">
                    <input id="search" title="Enter the terms you wish to search for."
                           placeholder="Search . . ." type="text"
                           name="q" value="" size="15" maxlength="128" class="form-text"
                           data-autocomplete-url="/kb/en/+search/autocomplete/">
                    <input type="hidden" name="quick" value="1" />
                    <input type="hidden" name="source" value="kb" />
                </form>
            </li>
            <li><a id="search-toggler" href="/kb/search/">Search</a></li>
            
        </ul>
    </div>
</div>
<div id="navbar-bottom" class="navbar">
    <div class="container">
        
        
        
        
        <div class="row">
            <div class="col-md-3 col-sm-9 col-xs-9">
                <a class="brand" href="/" title="MariaDB">
                    <img src="/kb/static/images/logo-2018-black.95f5978ae14d.png">
                </a>
            </div>
            <div class="col-md-9 hidden-sm hidden-xs">
                <div class="main-menu">
                    <ul id="main-menu" class="nav navbar-nav inline-block-sm">
    <li class="has-sub full-menu">
        <a href="/products" title="Products">Products</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/services" title="Services">Services</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/pricing" title="Pricing">Pricing</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/resources" title="Resources">Resources</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/about-us" title="About Us">About Us</a>
    </li>
    <li class="">
        <a class="button electric-eel small top-bar-right-download" href="/downloads/">Download</a>
    </li>
</ul>
                </div>
            </div>
            <div class="col-md-3 visible-sm visible-xs col-sm-3 col-xs-3 ps-rv">
                <div class="navbar-header text-right pull-right">
                    <button type="button" class="menu-control toggle-menu" id="open-menu">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="main">
    <div class="container">
        

        <div id="subheader1" class="clearfix">
            <div class="pull-left">
                
                <div id="breadcrumbs" class="breadcrumb">
                    <a href="/kb/en/">Knowledge Base</a>
                    


    
    » <a class="crumb" href="/kb/en/documentation/">MariaDB Server Documentation</a>
    

    
    » <a class="crumb" href="/kb/en/columns-storage-engines-and-plugins/">Columns, Storage Engines, and Plugins</a>
    

    
    » <a class="crumb" href="/kb/en/storage-engines/">Storage Engines</a>
    

    
    » <a class="crumb" href="/kb/en/spider/">Spider</a>
    


    » <a class="node_link crumb" href="/kb/en/spider-storage-engine-overview/">Spider Storage Engine Overview</a>


                </div>
                
            </div>
        </div>
    </div>
    <div class="container" id="container-main">
        <div class="row">
            
            
                
                <aside id="sidebar-first" class="sidebar col-md-2 hidden-xs hidden-sm hidden-print">
                    
                        
                        <ul id="category_menu" class="nav nav-pills nav-stacked">
                            <li><a href="/kb/en/">Home</a></li>
                            
                                
                                    <li><a href="/kb/en/+questions/">Open Questions</a></li>
                                
                                <li><a href="/kb/en/documentation/">MariaDB Server</a></li>
                                <li><a href="/kb/en/maxscale/">MariaDB MaxScale</a></li>
                                <li><a href="/kb/en/mariadb-columnstore/">MariaDB ColumnStore</a></li>
                                <li><a href="/kb/en/connectors/">Connectors</a></li>
                            

                        </ul>
                    

                    
                        <div>
    

<div class="well well-small box actions"><div>

        <a class="btn btn-block btn-small" href="/kb/en/spider-storage-engine-overview/">Return to article</a>
    
</div>
</div>

</div>
                    

                    

































                </aside>
            
            
            
                
            
            
            <section id="content" class="limited_width col-md-10 clearfix">
                
                    <h1>Spider Storage Engine Overview - Source</h1>
                

                



                <div>
                    

    

    
    <div class="revision_info">
        <dl class="table">
            <dt>Revision</dt>
            <dd><a href="/kb/en/spider-storage-engine-overview/+r/148522/">148522</a></dd>
            <dt>User</dt>
            <dd>
<span class="user" id="user-1368">
<a href="/kb/user/id/1368" title="Ian Gilfillan">Ian Gilfillan</a>
</span></dd>
            <dt>Date</dt>
            <dd>

<span class="datetime" title="2025-03-10 10:18">2025-03-10 10:18</span></dd>
        </dl>
    </div>
    


    

    
        
        <textarea id="answer_source" class="creole_source autogrow">&lt;&lt;toc&gt;&gt;

== About

{{spider_overview}}

The Spider storage engine is a [[storage-engines|storage engine]] with built-in sharding features. It supports partitioning and [[xa-transactions|xa transactions]], and allows tables of different MariaDB instances to be handled as if they were on the same instance. It refers to one possible implementation of ISO/IEC 9075-9:2008 SQL/MED.

When a table is created with the Spider storage engine, the table links to the table on a remote server. The remote table can be of any storage engine. The table link is concretely achieved by the establishment of the connection from a local MariaDB server to a remote MariaDB server. The link is shared for all tables that are part of a the same transaction.

&lt;&lt;style class=&#34;hidden&#34;&gt;&gt;
The Spider documentation on the MariaDB Knowledge Base is currently incomplete. See the Spider website for more: [[http://spiderformysql.com/]], as well as the [[http://bazaar.launchpad.net/~kentokushiba/spiderformysql/spider-1.0-doc/files|spider-1.0-doc]] and [[http://bazaar.launchpad.net/~kentokushiba/spiderformysql/spider-2.0-doc/files|spider-2.0-doc]] repositories.
&lt;&lt;/style&gt;&gt;

== Spider Versions in MariaDB
&lt;&lt;include slug=&#34;spider-versions&#34;&gt;&gt;

== Usage

=== Basic Usage
To create a table in the Spider storage engine format, the COMMENT and/or CONNECTION clauses of the [[create-table|CREATE TABLE]] statement are used to pass connection information about the remote server.

For example, the following table exists on a remote server (in this example, the remote node was created with the [[mysql-sandbox|MySQL Sandbox]] tool, an easy way to test with multiple installations)::
&lt;&lt;code&gt;&gt;
node1 &gt;CREATE TABLE s(
  id INT NOT NULL AUTO_INCREMENT,
  code VARCHAR(10),
  PRIMARY KEY(id));
&lt;&lt;/code&gt;&gt;

On the local server, a Spider table can be created as follows:
&lt;&lt;code&gt;&gt;
CREATE TABLE s(
  id INT NOT NULL AUTO_INCREMENT,
  code VARCHAR(10),
  PRIMARY KEY(id)
)
ENGINE=SPIDER 
COMMENT=&#39;host &#34;127.0.0.1&#34;, user &#34;msandbox&#34;, password &#34;msandbox&#34;, port &#34;8607&#34;&#39;;
&lt;&lt;/code&gt;&gt;

Records can now be inserted on the local server, and they will be stored on the remote server:
&lt;&lt;code&gt;&gt;
INSERT INTO s(code) VALUES (&#39;a&#39;);

node1 &gt; SELECT * FROM s;
+----+------+
| id | code |
+----+------+
|  1 | a    |
+----+------+
&lt;&lt;/code&gt;&gt;

&lt;&lt;product mariadb from=10.8.1&gt;&gt;
Alternative to specifying the data node information in the COMMENT, certain information (server, database, table) can also be specified using Table Options, like so:

&lt;&lt;code&gt;&gt;
CREATE SERVER srv FOREIGN DATA WRAPPER mysql OPTIONS(
  HOST &#39;127.0.0.1&#39;,
  USER &#39;msandbox&#39;,
  PASSWORD &#39;msandbox&#39;,
  PORT 8607);

CREATE TABLE s(
  id INT NOT NULL AUTO_INCREMENT,
  code VARCHAR(10),
  PRIMARY KEY(id)
)
ENGINE=SPIDER REMOTE_SERVER=&#34;srv&#34; REMOTE_DATABASE=&#34;db&#34; REMOTE_TABLE=&#34;s&#34;;
&lt;&lt;/code&gt;&gt;
&lt;&lt;/product&gt;&gt;

=== Further Examples

Preparing 10M record table using the [[https://github.com/akopytov/sysbench|sysbench]] utility 
 
&lt;&lt;code wrap=true&gt;&gt;
/usr/local/skysql/sysbench/bin/sysbench --test=oltp  --db-driver=mysql  --mysql-table-engine=innodb --mysql-user=skysql --mysql-password=skyvodka --mysql-host=192.168.0.202 --mysql-port=5054 --oltp-table-size=10000000  --mysql-db=test  prepare
&lt;&lt;/code&gt;&gt;

Make a first read only benchmark to check the initial single node performance.

&lt;&lt;code wrap=true&gt;&gt;
/usr/local/skysql/sysbench/bin/sysbench --test=oltp  --db-driver=mysql  --mysql-table-engine=innodb --mysql-user=skysql --mysql-password=skyvodka --mysql-host=192.168.0.202 --mysql-port=5054 --mysql-db=test --oltp-table-size=10000000 --num-threads=4 --max-requests=100000 --oltp-read-only=on run
&lt;&lt;/code&gt;&gt;

&lt;&lt;code&gt;&gt;
sysbench 0.4.12:  multi-threaded system evaluation benchmark

Running the test with following options:
Number of threads: 4

Doing OLTP test.
Running mixed OLTP test
Doing read-only test
Using Special distribution (12 iterations,  1 pct of values are returned in 75 pct cases)
Using &#34;BEGIN&#34; for starting transactions
Using auto_inc on the id column
Maximum number of requests for OLTP test is limited to 100000
Threads started!
Done.

OLTP test statistics:
    queries performed:
        read:                            1400196
        write:                           0
        other:                           200028
        total:                           1600224
    transactions:                        100014 (1095.83 per sec.)
    deadlocks:                           0      (0.00 per sec.)
    read/write requests:                 1400196 (15341.58 per sec.)
    other operations:                    200028 (2191.65 per sec.)

Test execution summary:
    total time:                          91.2681s
    total number of events:              100014
    total time taken by event execution: 364.3693
    per-request statistics:
         min:                                  1.85ms
         avg:                                  3.64ms
         max:                                 30.70ms
         approx.  95 percentile:               4.66ms

Threads fairness:
    events (avg/stddev):           25003.5000/84.78
    execution time (avg/stddev):   91.0923/0.00
&lt;&lt;/code&gt;&gt;

Define an easy way to access the nodes from the MariaDB or MySQL client.
&lt;&lt;code wrap=true&gt;&gt;
alias backend1=&#39;/usr/local/skysql/mysql-client/bin/mysql  --user=skysql --password=skyvodka --host=192.168.0.202 --port=5054&#39;
alias backend2=&#39;/usr/local/skysql/mysql-client/bin/mysql  --user=skysql --password=skyvodka --host=192.168.0.203 --port=5054&#39; 
alias spider1=&#39;/usr/local/skysql/mysql-client/bin/mysql  --user=skysql --password=skyvodka --host=192.168.0.201 --port=5054&#39; 
&lt;&lt;/code&gt;&gt;

Create the empty tables to hold the data and repeat for all available backend nodes.

&lt;&lt;code&gt;&gt;
backend1 &lt;&lt; EOF 
CREATE DATABASE backend;
CREATE TABLE backend.sbtest (
  id int(10) unsigned NOT NULL AUTO_INCREMENT,
  k int(10) unsigned NOT NULL DEFAULT &#39;0&#39;,
  c char(120) NOT NULL DEFAULT &#39;&#39;,
  pad char(60) NOT NULL DEFAULT &#39;&#39;,
  PRIMARY KEY (id),
  KEY k (k)
) ENGINE=InnoDB;
EOF

backend2 &lt;&lt; EOF 
CREATE DATABASE backend;
CREATE TABLE backend.sbtest (
  id int(10) unsigned NOT NULL AUTO_INCREMENT,
  k int(10) unsigned NOT NULL DEFAULT &#39;0&#39;,
  c char(120) NOT NULL DEFAULT &#39;&#39;,
  pad char(60) NOT NULL DEFAULT &#39;&#39;,
  PRIMARY KEY (id),
  KEY k (k)
) ENGINE=InnoDB;
EOF
&lt;&lt;/code&gt;&gt;

==== Federation Setup

{{Spider7}}

&lt;&lt;code&gt;&gt;
spider1 &lt;&lt; EOF
CREATE SERVER backend 
  FOREIGN DATA WRAPPER mysql 
OPTIONS( 
  HOST &#39;192.168.0.202&#39;, 
  DATABASE &#39;test&#39;,
  USER &#39;skysql&#39;,
  PASSWORD &#39;skyvodka&#39;,
  PORT 5054
);

CREATE  TABLE test.sbtest
(
  id int(10) unsigned NOT NULL AUTO_INCREMENT,
  k int(10) unsigned NOT NULL DEFAULT &#39;0&#39;,
  c char(120) NOT NULL DEFAULT &#39;&#39;,
  pad char(60) NOT NULL DEFAULT &#39;&#39;,
  PRIMARY KEY (id),
  KEY k (k)
) ENGINE=spider COMMENT=&#39;wrapper &#34;mysql&#34;,srv &#34;backend&#34;&#39;;
SELECT * FROM test.sbtest LIMIT 10;
EOF
&lt;&lt;/code&gt;&gt;

{{spbench10}}

Without connection pool or MariaDB thread pool, HaProxy and Spider have been protecting the tcp socket overflow without specific TCP tuning. In reality with a well tuned TCP stack or thread pool the curve should not decrease so abruptly to 0. Refer to the [[threadpool-in-55|MariaDB Thread Pool]] to explore this feature.    
  
==== Sharding Setup

{{spider8}}

Create the spider table on the Spider Node  

&lt;&lt;code&gt;&gt;
#spider1 &lt;&lt; EOF
CREATE SERVER backend1 
  FOREIGN DATA WRAPPER mysql 
OPTIONS( 
  HOST &#39;192.168.0.202&#39;, 
  DATABASE &#39;backend&#39;,
  USER &#39;skysql&#39;,
  PASSWORD &#39;skyvodka&#39;,
  PORT 5054
);
CREATE SERVER backend2 
  FOREIGN DATA WRAPPER mysql 
OPTIONS( 
  HOST &#39;192.168.0.203&#39;, 
  DATABASE &#39;backend&#39;,
  USER &#39;skysql&#39;,
  PASSWORD &#39;skyvodka&#39;,
  PORT 5054
);
CREATE DATABASE IF NOT EXISTS backend;
CREATE  TABLE backend.sbtest
(
  id int(10) unsigned NOT NULL AUTO_INCREMENT,
  k int(10) unsigned NOT NULL DEFAULT &#39;0&#39;,
  c char(120) NOT NULL DEFAULT &#39;&#39;,
  pad char(60) NOT NULL DEFAULT &#39;&#39;,
  PRIMARY KEY (id),
  KEY k (k)
) ENGINE=spider COMMENT=&#39;wrapper &#34;mysql&#34;, table &#34;sbtest&#34;&#39;
 PARTITION BY KEY (id) 
(
 PARTITION pt1 COMMENT = &#39;srv &#34;backend1&#34;&#39;,
 PARTITION pt2 COMMENT = &#39;srv &#34;backend2&#34;&#39; 
) ;
EOF
&lt;&lt;/code&gt;&gt;

Copy the data from the original sysbench table to the spider table

&lt;&lt;code wrap=true&gt;&gt;
#/usr/local/skysql/mariadb/bin/mysqldump  --user=skysql --password=skyvodka --host=192.168.0.202 --port=5054 --no-create-info test sbtest | spider1 backend 

#backend2 -e&#34;select count(*) from backend.sbtest;&#34;
+----------+
| count(*) |
+----------+
|  3793316 |
+----------+
#backend1 -e&#34;select count(*) from backend.sbtest;&#34;
+----------+
| count(*) |
+----------+
|  6206684 |
+----------+
&lt;&lt;/code&gt;&gt;

We observe a common issue with partitioning is a non uniform distribution of data between the backends. based on the partition key hashing algorithm.

Rerun the Benchmark with less queries 

&lt;&lt;code wrap=true&gt;&gt;
#/usr/local/skysql/sysbench/bin/sysbench --test=oltp  --db-driver=mysql  --mysql-table-engine=innodb --mysql-user=skysql --mysql-password=skyvodka --mysql-host=192.168.0.201 --mysql-port=5054 --mysql-db=backend --mysql-engine-trx=yes --oltp-table-size=10000000 --num-threads=4 --max-requests=100 --oltp-read-only=on run
&lt;&lt;/code&gt;&gt;

&lt;&lt;code&gt;&gt;
OLTP test statistics:
    queries performed:
        read:                            1414
        write:                           0
        other:                           202
        total:                           1616
    transactions:                        101    (22.95 per sec.)
    deadlocks:                           0      (0.00 per sec.)
    read/write requests:                 1414   (321.30 per sec.)
    other operations:                    202    (45.90 per sec.)

Test execution summary:
    total time:                          4.4009s
    total number of events:              101
    total time taken by event execution: 17.2960
    per-request statistics:
         min:                                114.48ms
         avg:                                171.25ms
         max:                                200.98ms
         approx.  95 percentile:             195.12ms

Threads fairness:
    events (avg/stddev):           25.2500/0.43
    execution time (avg/stddev):   4.3240/0.04
&lt;&lt;/code&gt;&gt;

The response time decreases to 0.04.
This is expected because the query latency is increased from multiple network round trips and condition push down is not implemented yet. Sysbench doing a lot of range queries. Just consider for now that this range query can be a badly optimized query. 

We need to increase the concurrency to get better throughput. 

{{spbench11}}

==== Background Setup
We have no background search available in MariaDB. It won&#39;t be available before MariaDB 10.2, but the next table definition mainly enables improving the performance of a single complex query plan with background search that can be found via the upstream spiral binaries MariaDB branch. 

We have 4 cores per backend and 2 backends . 

On ##backend1## 
&lt;&lt;code&gt;&gt;
#backend1 &lt;&lt; EOF 
CREATE DATABASE bsbackend1;
CREATE DATABASE bsbackend2;
CREATE DATABASE bsbackend3;
CREATE DATABASE bsbackend4;
CREATE TABLE bsbackend1.sbtest (
  id int(10) unsigned NOT NULL AUTO_INCREMENT,
  k int(10) unsigned NOT NULL DEFAULT &#39;0&#39;,
  c char(120) NOT NULL DEFAULT &#39;&#39;,
  pad char(60) NOT NULL DEFAULT &#39;&#39;,
  PRIMARY KEY (id),
  KEY k (k)
) ENGINE=InnoDB;
CREATE TABLE bsbackend2.sbtest (
  id int(10) unsigned NOT NULL AUTO_INCREMENT,
  k int(10) unsigned NOT NULL DEFAULT &#39;0&#39;,
  c char(120) NOT NULL DEFAULT &#39;&#39;,
  pad char(60) NOT NULL DEFAULT &#39;&#39;,
  PRIMARY KEY (id),
  KEY k (k)
) ENGINE=InnoDB;
CREATE TABLE bsbackend3.sbtest (
  id int(10) unsigned NOT NULL AUTO_INCREMENT,
  k int(10) unsigned NOT NULL DEFAULT &#39;0&#39;,
  c char(120) NOT NULL DEFAULT &#39;&#39;,
  pad char(60) NOT NULL DEFAULT &#39;&#39;,
  PRIMARY KEY (id),
  KEY k (k)
) ENGINE=InnoDB;
CREATE TABLE bsbackend4.sbtest (
  id int(10) unsigned NOT NULL AUTO_INCREMENT,
  k int(10) unsigned NOT NULL DEFAULT &#39;0&#39;,
  c char(120) NOT NULL DEFAULT &#39;&#39;,
  pad char(60) NOT NULL DEFAULT &#39;&#39;,
  PRIMARY KEY (id),
  KEY k (k)
) ENGINE=InnoDB;
EOF
&lt;&lt;/code&gt;&gt;

On ##backend2## 
&lt;&lt;code&gt;&gt;
#backend2 &lt;&lt; EOF 
CREATE DATABASE bsbackend5;
CREATE DATABASE bsbackend6;
CREATE DATABASE bsbackend7;
CREATE DATABASE bsbackend8;
CREATE TABLE bsbackend5.sbtest (
  id int(10) unsigned NOT NULL AUTO_INCREMENT,
  k int(10) unsigned NOT NULL DEFAULT &#39;0&#39;,
  c char(120) NOT NULL DEFAULT &#39;&#39;,
  pad char(60) NOT NULL DEFAULT &#39;&#39;,
  PRIMARY KEY (id),
  KEY k (k)
) ENGINE=InnoDB;
CREATE TABLE bsbackend6.sbtest (
  id int(10) unsigned NOT NULL AUTO_INCREMENT,
  k int(10) unsigned NOT NULL DEFAULT &#39;0&#39;,
  c char(120) NOT NULL DEFAULT &#39;&#39;,
  pad char(60) NOT NULL DEFAULT &#39;&#39;,
  PRIMARY KEY (id),
  KEY k (k)
) ENGINE=InnoDB;
CREATE TABLE bsbackend7.sbtest (
  id int(10) unsigned NOT NULL AUTO_INCREMENT,
  k int(10) unsigned NOT NULL DEFAULT &#39;0&#39;,
  c char(120) NOT NULL DEFAULT &#39;&#39;,
  pad char(60) NOT NULL DEFAULT &#39;&#39;,
  PRIMARY KEY (id),
  KEY k (k)
) ENGINE=InnoDB;
CREATE TABLE bsbackend8.sbtest (
  id int(10) unsigned NOT NULL AUTO_INCREMENT,
  k int(10) unsigned NOT NULL DEFAULT &#39;0&#39;,
  c char(120) NOT NULL DEFAULT &#39;&#39;,
  pad char(60) NOT NULL DEFAULT &#39;&#39;,
  PRIMARY KEY (id),
  KEY k (k)
) ENGINE=InnoDB;
EOF
&lt;&lt;/code&gt;&gt;

On ##Spider Node##

&lt;&lt;code wrap=true&gt;&gt;
#spider2 &lt;&lt; EOF
CREATE SERVER bsbackend1 FOREIGN DATA WRAPPER mysql OPTIONS( HOST &#39;192.168.0.202&#39;, DATABASE &#39;bsbackend1&#39;,USER &#39;skysql&#39;, PASSWORD &#39;skyvodka&#39;,PORT 5054);
CREATE SERVER bsbackend2 FOREIGN DATA WRAPPER mysql OPTIONS( HOST &#39;192.168.0.202&#39;, DATABASE &#39;bsbackend2&#39;,USER &#39;skysql&#39;, PASSWORD &#39;skyvodka&#39;,PORT 5054);
CREATE SERVER bsbackend3 FOREIGN DATA WRAPPER mysql OPTIONS( HOST &#39;192.168.0.202&#39;, DATABASE &#39;bsbackend3&#39;,USER &#39;skysql&#39;, PASSWORD &#39;skyvodka&#39;,PORT 5054);
CREATE SERVER bsbackend4 FOREIGN DATA WRAPPER mysql OPTIONS( HOST &#39;192.168.0.202&#39;, DATABASE &#39;bsbackend4&#39;,USER &#39;skysql&#39;, PASSWORD &#39;skyvodka&#39;,PORT 5054);
CREATE SERVER bsbackend5 FOREIGN DATA WRAPPER mysql OPTIONS( HOST &#39;192.168.0.203&#39;, DATABASE &#39;bsbackend5&#39;,USER &#39;skysql&#39;, PASSWORD &#39;skyvodka&#39;,PORT 5054);
CREATE SERVER bsbackend6 FOREIGN DATA WRAPPER mysql OPTIONS( HOST &#39;192.168.0.203&#39;, DATABASE &#39;bsbackend6&#39;,USER &#39;skysql&#39;, PASSWORD &#39;skyvodka&#39;,PORT 5054);
CREATE SERVER bsbackend7 FOREIGN DATA WRAPPER mysql OPTIONS( HOST &#39;192.168.0.203&#39;, DATABASE &#39;bsbackend7&#39;,USER &#39;skysql&#39;, PASSWORD &#39;skyvodka&#39;,PORT 5054);
CREATE SERVER bsbackend8 FOREIGN DATA WRAPPER mysql OPTIONS( HOST &#39;192.168.0.203&#39;, DATABASE &#39;bsbackend8&#39;,USER &#39;skysql&#39;, PASSWORD &#39;skyvodka&#39;,PORT 5054);

CREATE DATABASE IF NOT EXISTS bsbackend;
CREATE  TABLE bsbackend.sbtest
(
  id int(10) unsigned NOT NULL AUTO_INCREMENT,
  k int(10) unsigned NOT NULL DEFAULT &#39;0&#39;,
  c char(120) NOT NULL DEFAULT &#39;&#39;,
  pad char(60) NOT NULL DEFAULT &#39;&#39;,
  PRIMARY KEY (id),
  KEY k (k)
) ENGINE=spider COMMENT=&#39;wrapper &#34;mysql&#34;, table &#34;sbtest&#34;&#39;
 PARTITION BY KEY (id) 
(
 PARTITION pt1 COMMENT = &#39;srv &#34;bsbackend1&#34;&#39;,
 PARTITION pt2 COMMENT = &#39;srv &#34;bsbackend2&#34;&#39;, 
 PARTITION pt3 COMMENT = &#39;srv &#34;bsbackend3&#34;&#39;,
 PARTITION pt4 COMMENT = &#39;srv &#34;bsbackend4&#34;&#39;, 
 PARTITION pt5 COMMENT = &#39;srv &#34;bsbackend5&#34;&#39;,
 PARTITION pt6 COMMENT = &#39;srv &#34;bsbackend6&#34;&#39;,
 PARTITION pt7 COMMENT = &#39;srv &#34;bsbackend7&#34;&#39;,
 PARTITION pt8 COMMENT = &#39;srv &#34;bsbackend8&#34;&#39;
) ;
EOF
INSERT INTO  bsbackend.sbtest SELECT * FROM backend.sbtest;
&lt;&lt;/code&gt;&gt;

Now test the following query :

&lt;&lt;code&gt;&gt;
select count(*) from sbtest;
+----------+
| count(*) |
+----------+
| 10000001 |
+----------+
1 row in set (8,38 sec)

set spider_casual_read=1;
set spider_bgs_mode=2;

select count(*) from sbtest;
+----------+
| count(*) |
+----------+
| 10000001 |
+----------+
1 row in set (4,25 sec)

mysql&gt; select sum(k) from sbtest;
+--------+
| sum(k) |
+--------+
|      0 |
+--------+
1 row in set (5,67 sec)

mysql&gt; set spider_casual_read=0;
mysql&gt; select sum(k) from sbtest;
+--------+
| sum(k) |
+--------+
|      0 |
+--------+
1 row in set (12,56 sec)
&lt;&lt;/code&gt;&gt;


{{spbench8}}

==== High Availability Setup

&lt;&lt;product mariadb from=10.7.5&gt;&gt;
Spider&#39;s high availability feature has been deprecated (MDEV-28479), and will be deleted. Please use other high availability solutions like [[replication]] or [[galera-cluster]].
&lt;&lt;/product&gt;&gt;

{{spider9}}

&lt;&lt;code wrap=true&gt;&gt;
#backend1 -e &#34;CREATE DATABASE backend_rpl&#34;
#backend2 -e &#34;CREATE DATABASE backend_rpl&#34;

#/usr/local/skysql/mariadb/bin/mysqldump  --user=skysql --password=skyvodka --host=192.168.0.202 --port=5054  backend sbtest | backend1 backend_rpl
#/usr/local/skysql/mariadb/bin/mysqldump  --user=skysql --password=skyvodka --host=192.168.0.203 --port=5054  backend sbtest | backend2 backend_rpl

#spider1 &lt;&lt; EOF
DROP TABLE backend.sbtest;
CREATE SERVER backend1_rpl 
  FOREIGN DATA WRAPPER mysql 
OPTIONS( 
  HOST &#39;192.168.0.202&#39;, 
  DATABASE &#39;backend_rpl&#39;,
  USER &#39;skysql&#39;,
  PASSWORD &#39;skyvodka&#39;,
  PORT 5054
);
CREATE SERVER backend2_rpl 
  FOREIGN DATA WRAPPER mysql 
OPTIONS( 
  HOST &#39;192.168.0.203&#39;, 
  DATABASE &#39;backend_rpl&#39;,
  USER &#39;skysql&#39;,
  PASSWORD &#39;skyvodka&#39;,
  PORT 5054
);
CREATE  TABLE backend.sbtest
(
  id int(10) unsigned NOT NULL AUTO_INCREMENT,
  k int(10) unsigned NOT NULL DEFAULT &#39;0&#39;,
  c char(120) NOT NULL DEFAULT &#39;&#39;,
  pad char(60) NOT NULL DEFAULT &#39;&#39;,
  PRIMARY KEY (id),
  KEY k (k)
) ENGINE=spider COMMENT=&#39;wrapper &#34;mysql&#34;, table &#34;sbtest&#34;&#39;
 PARTITION BY KEY (id) 
(
 PARTITION pt1 COMMENT = &#39;srv &#34;backend1 backend2_rpl&#34;&#39;,
 PARTITION pt2 COMMENT = &#39;srv &#34;backend2 backend1_rpl&#34;&#39; 
) ;
INSERT INTO backend.sbtest select 10000001, 0, &#39;&#39; ,&#39;replicas test&#39;;
EOF
#backend1 -e &#34;SELECT * FROM backend.sbtest WHERE id=10000001&#34;;
+----------+---+---+---------------+
| id       | k | c | pad           |
+----------+---+---+---------------+
| 10000001 | 0 |   | replicas test |
+----------+---+---+---------------+
# backend2 -e &#34;SELECT * FROM backend.sbtest where id=10000001&#34;;
# backend2 -e &#34;SELECT * FROM backend_rpl.sbtest where id=10000001&#34;;
+----------+---+---+---------------+
| id       | k | c | pad           |
+----------+---+---+---------------+
| 10000001 | 0 |   | replicas test |
+----------+---+---+---------------+
&lt;&lt;/code&gt;&gt;

What is happening if we stop one backend?

&lt;&lt;code&gt;&gt;
#spider1 -e &#34;SELECT * FROM backend.sbtest where id=10000001&#34;;
ERROR 1429 (HY000) at line 1: Unable to connect to foreign data source: backend1
&lt;&lt;/code&gt;&gt; 

Let&#39;s fix this with spider monitoring. Note that msi is the list of spider nodes @@server_id variable participating in the quorum.  

&lt;&lt;code wrap=true&gt;&gt;
#spider1 &lt;&lt; EOF
DROP  TABLE backend.sbtest;
CREATE  TABLE backend.sbtest
(
  id int(10) unsigned NOT NULL AUTO_INCREMENT,
  k int(10) unsigned NOT NULL DEFAULT &#39;0&#39;,
  c char(120) NOT NULL DEFAULT &#39;&#39;,
  pad char(60) NOT NULL DEFAULT &#39;&#39;,
  PRIMARY KEY (id),
  KEY k (k)
) ENGINE=spider COMMENT=&#39;wrapper &#34;mysql&#34;, table &#34;sbtest&#34;&#39;
 PARTITION BY KEY (id) 
(
 PARTITION pt1 COMMENT = &#39;srv &#34;backend1 backend2_rpl&#34;,  mbk &#34;2&#34;, mkd &#34;2&#34;, msi &#34;5054&#34;, link_status &#34;0 0&#34;&#39;,
 PARTITION pt2 COMMENT = &#39;srv &#34;backend2 backend1_rpl&#34;,  mbk &#34;2&#34;, mkd &#34;2&#34;, msi &#34;5054&#34;, link_status &#34;0 0&#34; &#39; 
) ;

CREATE SERVER mon
  FOREIGN DATA WRAPPER mysql 
OPTIONS( 
  HOST &#39;192.168.0.201’, 
  DATABASE &#39;backend&#39;,
  USER &#39;skysql&#39;,
  PASSWORD &#39;skyvodka&#39;,
  PORT 5054
);
INSERT INTO `mysql`.`spider_link_mon_servers` VALUES
(&#39;%&#39;,&#39;%&#39;,&#39;%&#39;,5054,&#39;mon&#39;,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,0,NULL,NULL);
SELECT spider_flush_table_mon_cache();
EOF
&lt;&lt;/code&gt;&gt;

Monitoring should be setup between Spider nodes participating in the cluster. We only have one ##Spider Node## and spider_link_mon_servers represent the inter-connection of all Spider nodes in our setup. 

This simple setup does not bring HA in case the ##Spider Node## is not available. In a production setup the number of ##Spider Nodes##  in the spider_link_mon_servers table should be at least 3 to get a majority consensus.
 
&lt;&lt;code&gt;&gt;
#spider1 -e &#34;SELECT * FROM backend.sbtest WHERE id=10000001&#34;
+----------+---+---+---------------+
| id       | k | c | pad           |
+----------+---+---+---------------+
| 10000001 | 0 |   | replicas test |
+----------+---+---+---------------+
&lt;&lt;/code&gt;&gt;

Checking the state of the nodes:

&lt;&lt;code&gt;&gt;
#spider1 -e &#34;SELECT db_name, table_name,server  FROM mysql.spider_tables WHERE link_status=3&#34;
+---------+--------------+----------+
| db_name | table_name   | server   |
+---------+--------------+----------+
| backend | sbtest#P#pt1 | backend1 |
+---------+--------------+----------+
&lt;&lt;/code&gt;&gt;

{{spiderha}}

No change has been made to cluster, so let&#39;s create a divergence:

&lt;&lt;code&gt;&gt;
# spider1 -e &#34;INSERT INTO backend.sbtest select 10000003, 0, &#39;&#39; ,&#39;replicas test&#39;;&#34;
# backend1 -e &#34;SELECT * FROM backend.sbtest WHERE id=10000003&#34;
# backend2 -e &#34;SELECT * FROM backend_rpl.sbtest WHERE id=10000003&#34;
+----------+---+---+---------------+
| id       | k | c | pad           |
+----------+---+---+---------------+
| 10000003 | 0 |   | replicas test |
+----------+---+---+---------------+
&lt;&lt;/code&gt;&gt;

Reintroducing the failed backend1 in the cluster:

&lt;&lt;code wrap=true&gt;&gt;
#spider1 &lt;&lt; EOF
ALTER TABLE backend.sbtest 
ENGINE=spider COMMENT=&#39;wrapper &#34;mysql&#34;, table &#34;sbtest&#34;&#39;
 PARTITION BY KEY (id) 
(
 PARTITION pt1 COMMENT = &#39;srv &#34;backend1 backend2_rpl&#34;  mbk &#34;2&#34;, mkd &#34;2&#34;, msi &#34;5054&#34;, link_status &#34;2 0&#34;&#39;,
 PARTITION pt2 COMMENT = &#39;srv &#34;backend2 backend1_rpl&#34;  mbk &#34;2&#34;, mkd &#34;2&#34;, msi &#34;5054&#34;, link_status &#34;0 2&#34; &#39; 
) ;
select spider_copy_tables(&#39;backend.sbtest#P#pt1&#39;,&#39;0&#39;,&#39;1&#39;);
select spider_copy_tables(&#39;backend.sbtest#P#pt2&#39;,&#39;1&#39;,&#39;0&#39;);
ALTER TABLE backend.sbtest 
ENGINE=spider COMMENT=&#39;wrapper &#34;mysql&#34;, table &#34;sbtest&#34;&#39;
 PARTITION BY KEY (id) 
(
 PARTITION pt1 COMMENT = &#39;srv &#34;backend1 backend2_rpl&#34;  mbk &#34;2&#34;, mkd &#34;2&#34;, msi &#34;5054&#34;, link_status &#34;1 0&#34;&#39;,
 PARTITION pt2 COMMENT = &#39;srv &#34;backend2 backend1_rpl&#34;  mbk &#34;2&#34;, mkd &#34;2&#34;, msi &#34;5054&#34;, link_status &#34;0 1&#34; &#39; 
) ;
EOF
&lt;&lt;/code&gt;&gt;</textarea>
    


                    <div id="content_disclaimer" class="graybox">
                        Content reproduced on this site is the property of its respective owners,
                        and this content is not reviewed in advance by MariaDB. The views, information and opinions
                        expressed by this content do not necessarily represent those of MariaDB or any other party.
                    </div>
                </div>
            </section>

            
        </div>
    </div>
</div>

<!-- Footer -->
<footer id="footer">
    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-xs-12">
                    <ul class="list-inline text-center footer-nav">
                        <li>
                            <h5>
                                <a href="https://mariadb.com/products" title="Products">Products</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/services" title="Services">Services</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/pricing" title="Pricing">Pricing</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/resources" title="Resources">Resources</a>
                            </h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/about-us" title="About MariaDB">About Us</a></h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/download" title="Download">Download MariaDB</a></h5>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="row row-10">
                
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div id="block-footerformcontact" class="block block-block-content block-block-contentd754ee1b-3cc9-40e7-9ef4-f504f1197fb1">
                        
                            <h5 style="font-weight: 400;">Subscribe to our newsletter!</h5>
                            <script src="//app-sj15.marketo.com/js/forms2/js/forms2.min.js"></script><form id="mktoForm_1498"></form>
                            <script>
                                <!--//--><![CDATA[// ><!--
                                MktoForms2.loadForm("//app-sj15.marketo.com", "573-PXI-984", 1498);
                                //--><!]]]]><![CDATA[>
                                //--><!]]>
                            </script>
                        
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div class="footer-copyright">
                        <div class="text-center">
                            <ul class="list-inline no-margin">
                                <li>
                                    <a href="/legal" title="Legal">Legal</a>
                                </li>
                                <li>
                                    <a href="/privacy-policy" title="Privacy Policy">Privacy Policy</a>
                                </li>
                                <li>
                                    <a href="/cookie-policy/" title="Cookies">Cookie Policy</a>
                                </li>
                            </ul>
                            <p>Copyright &copy; 2025 MariaDB. All rights reserved.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</footer>
</div>

<div id="ajax_loading">
    <img src="/kb/static/images/ajax-loader.a51c5608d01a.gif" />
</div>

    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MK2847"
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MK2847');</script>
    <!-- End Google Tag Manager -->

</body>

<script type="text/javascript" src="/kb/static/js/main.1587e3a666fc.js" charset="utf-8"></script>

</html>