<!DOCTYPE html>
<html>
<head data-cookie-domain=""
      data-cookie-path="/">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="apple-touch-icon" sizes="180x180" href="/kb/static/images/favicons/apple-touch-icon.159e713979be.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/kb/static/images/favicons/favicon-32x32.bc0ac1d5d11e.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/kb/static/images/favicons/favicon-16x16.5801f8f0f34e.png">
    <link rel="shortcut icon" href="/kb/static/images/favicons/favicon.d122d305dee4.ico" type="image/x-icon" />

    <title>MariaDB Enterprise Audit - Source - MariaDB Knowledge Base</title>

    <link href="/kb/static/css/main.f7633538c846.css" rel="stylesheet" type="text/css" />

    
        <meta name="robots" content="noindex, nofollow">
    

    

    <!-- FB Open Graph tags -->
    <meta property="og:title" content="MariaDB Enterprise Audit - Source" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://mariadb.com/kb/en/mariadb-enterprise-audit/+source/" />
    <meta property="og:image" content="http://mariadb.comaskmonty-logo.png" />
    <meta property="og:site_name" content="MariaDB KnowledgeBase" />
    <meta property="fb:admins" content="514852603" />
    <meta property="og:description" content="" />

    <meta name="description" content="" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet"/>
    
</head>
<body class="mpkb nodes autoresize nodes_source jqui" id="nodes_source">





<div id="menu-mobile" class="visible-sm visible-xs">

    <div>
        <div id="mobile-close-menu" class="text-right">
            <a href="javascript:void(0)" title="Close Menu" id="back-main" class="toggle-menu">X<span></span></a>
        </div>
    </div>
    <div class="mainmenu-mobile">
        <ul class="ls-none ul-menu">
            <li data-sub="submenu5"><a class="open-form-search" href="/kb/search/" title="Search">Search </a></li>
            <li data-sub="submenu0"><a href="/products" title="Products">Products</a><span class="arrow-main"></span></li>
            <li data-sub="submenu1"><a href="/services" title="Services">Services</a><span class="arrow-main"></span></li>
            <li data-sub="submenu2"><a href="/resources" title="Resources">Resources</a><span class="arrow-main"></span></li>
            <li data-sub="submenu3"><a href="/about-us" title="About">About</a><span class="arrow-main"></span></li>
            <li data-sub="submenu4"><a href="/contact" title="Contact">Contact</a></li>
        </ul>
    </div>

    <div class="nav-top-mobile">
        <div class="select-box form">

            <ul class="inline-block-md mb-none top-nav">
                <li>

                </li>
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/mariadb-enterprise-audit/+source/"> Login</a>
                    </li>
                
            </ul>



        </div>
        <p class="text-center copyright">Copyright &copy; 2025 MariaDB. All rights reserved.</p>
    </div>
</div>
<div class="violator-wrap d-none" id="top_violator">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12">
                <div class="violator-outer">
                    <div class="violator-inner">
                        <div class="row">
                            <div class="col-xs-12 col-sm-9 col-lg-7 col-lg-offset-2" id="top_violator_content">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="content-link" target="_blank" rel="nofollow noreferrer">
                                    <span>The Ultimate Guide to High Availability with MariaDB</span>
                                </a>
                            </div>
                            <div class="col-xs-12 col-sm-3" id="top_violator_cta">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="btn btn-mariadb" target="_blank" rel="nofollow noreferrer">Download Now</a>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-link close-btn">
                        <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24" width="15px" height="15px"><path d="M 4.9902344 3.9902344 A 1.0001 1.0001 0 0 0 4.2929688 5.7070312 L 10.585938 12 L 4.2929688 18.292969 A 1.0001 1.0001 0 1 0 5.7070312 19.707031 L 12 13.414062 L 18.292969 19.707031 A 1.0001 1.0001 0 1 0 19.707031 18.292969 L 13.414062 12 L 19.707031 5.7070312 A 1.0001 1.0001 0 0 0 18.980469 3.9902344 A 1.0001 1.0001 0 0 0 18.292969 4.2929688 L 12 10.585938 L 5.7070312 4.2929688 A 1.0001 1.0001 0 0 0 4.9902344 3.9902344 z"/></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="wrapper">
<div id="top-nav">
    <div class="container">
        <ul class="hidden-sm hidden-xs" >
            <li><a href="https://mariadb.com/kb/">Knowledge Base</a></li>
            <li><a href="https://mariadb.com/contact/">Contact</a></li>
            
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/mariadb-enterprise-audit/+source/" rel="nofollow">Login</a>
                    </li>
                
            
            
            <li id="search-form">
                <form action="/kb/en/+search/" method="get" id="search-block-form" accept-charset="UTF-8">
                    <input id="search" title="Enter the terms you wish to search for."
                           placeholder="Search . . ." type="text"
                           name="q" value="" size="15" maxlength="128" class="form-text"
                           data-autocomplete-url="/kb/en/+search/autocomplete/">
                    <input type="hidden" name="quick" value="1" />
                    <input type="hidden" name="source" value="kb" />
                </form>
            </li>
            <li><a id="search-toggler" href="/kb/search/">Search</a></li>
            
        </ul>
    </div>
</div>
<div id="navbar-bottom" class="navbar">
    <div class="container">
        
        
        
        
        <div class="row">
            <div class="col-md-3 col-sm-9 col-xs-9">
                <a class="brand" href="/" title="MariaDB">
                    <img src="/kb/static/images/logo-2018-black.95f5978ae14d.png">
                </a>
            </div>
            <div class="col-md-9 hidden-sm hidden-xs">
                <div class="main-menu">
                    <ul id="main-menu" class="nav navbar-nav inline-block-sm">
    <li class="has-sub full-menu">
        <a href="/products" title="Products">Products</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/solutions" title="Solutions">Solutions</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/resources" title="Resources">Resources</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/about-us" title="Company">Company</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/pricing" title="Pricing">Pricing</a>
    </li>
    
    <li class="">
        <a class="button electric-eel small top-bar-right-download" href="/downloads/">Download</a>
    </li>
</ul>
                </div>
            </div>
            <div class="col-md-3 visible-sm visible-xs col-sm-3 col-xs-3 ps-rv">
                <div class="navbar-header text-right pull-right">
                    <button type="button" class="menu-control toggle-menu" id="open-menu">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="main">
    <div class="container">
        

        <div id="subheader1" class="clearfix">
            <div class="pull-left">
                
                <div id="breadcrumbs" class="breadcrumb">
                    <a href="/kb/en/">Knowledge Base</a>
                    


    
    » <a class="crumb" href="/kb/en/documentation/">MariaDB Server Documentation</a>
    

    
    » <a class="crumb" href="/kb/en/columns-storage-engines-and-plugins/">Columns, Storage Engines, and Plugins</a>
    

    
    » <a class="crumb" href="/kb/en/plugins/">Plugins</a>
    


    » <a class="node_link crumb" href="/kb/en/mariadb-enterprise-audit/">MariaDB Enterprise Audit</a>


                </div>
                
            </div>
        </div>
    </div>
    <div class="container" id="container-main">
        <div class="row">
            
            
                
                <aside id="sidebar-first" class="sidebar col-md-2 hidden-xs hidden-sm hidden-print">
                    
                        
                        <ul id="category_menu" class="nav nav-pills nav-stacked">
                            <li><a href="/kb/en/">Home</a></li>
                            
                                
                                    <li><a href="/kb/en/+questions/">Open Questions</a></li>
                                
                                <li><a href="/kb/en/documentation/">MariaDB Server</a></li>
                                <li><a href="/kb/en/maxscale/">MariaDB MaxScale</a></li>
                                <li><a href="/kb/en/mariadb-columnstore/">MariaDB ColumnStore</a></li>
                                <li><a href="/kb/en/connectors/">Connectors</a></li>
                            

                        </ul>
                    

                    
                        <div>
    

<div class="well well-small box actions"><div>

        <a class="btn btn-block btn-small" href="/kb/en/mariadb-enterprise-audit/">Return to article</a>
    
</div>
</div>

</div>
                    

                    

































                </aside>
            
            
            
                
            
            
            <section id="content" class="limited_width col-md-10 clearfix">
                
                    <h1>MariaDB Enterprise Audit - Source</h1>
                

                



                <div>
                    

    

    
    <div class="revision_info">
        <dl class="table">
            <dt>Revision</dt>
            <dd><a href="/kb/en/mariadb-enterprise-audit/+r/151070/">151070</a></dd>
            <dt>User</dt>
            <dd>
<span class="user" id="user-16293">
<a href="/kb/user/id/16293" title="Shwetha CM">Shwetha CM</a>
</span></dd>
            <dt>Date</dt>
            <dd>

<span class="datetime" title="2025-05-05 23:29">2025-05-05 23:29</span></dd>
        </dl>
    </div>
    


    

    
        
        <textarea id="answer_source" class="creole_source autogrow">&lt;&lt;toc&gt;&gt;

= Overview
While application design specifications and database configurations may intend specific limitations to be placed around access to data, audit mechanisms help confirm the effectiveness of these controls.

MariaDB Enterprise Audit is a plugin that logs data access and database operations.



Audit mechanisms are most effective when they produce a manageable quantity of output. MariaDB Enterprise Audit includes advanced filtering features to enable narrowly defining which information is logged.

Where audit mechanisms may only be effective when control parameters can also be audited, MariaDB Enterprise Audit implements logging of configuration changes.

= Installation and Configuration Overview

MariaDB Enterprise Audit is installed and loaded by default. If you are unsure whether it is loaded on your system, you can [[mariadb-enterprise-audit/#confirm-the-audit-plugin-is-loaded|confirm that the plugin is loaded]].

To use MariaDB Enterprise Audit, the plugin must be configured:

* Administrators must define [[mariadb-enterprise-audit/#audit-filters|Audit Filters]] to configure what MariaDB Enterprise Audit writes to the audit log.
MariaDB Enterprise Audit supports two types of Audit Filters:
&lt;&lt;style class=&#34;darkheader-nospace-borders left&#34;&gt;&gt;
|= Audit Filter Type |= Used For |
| [[mariadb-enterprise-audit/#default-audit-filter|Default Audit Filter]]  |The Default Audit Filter is used for any user account that is not assigned a Named Audit Filter. |
| [[mariadb-enterprise-audit/#named-audit-filters|Named Audit Filters]]  | Named Audit Filters are assigned to specific user accounts. |
&lt;&lt;/style&gt;&gt;
Administrators can define Audit Filters to audit log activity using multiple types of filters:
&lt;&lt;style class=&#34;darkheader-nospace-borders left&#34;&gt;&gt;
|= Filter Type |= Used For |
| [[mariadb-enterprise-audit/#event-filters|Event Filters]]  |Event Filters are used to enable or disable audit logging for specific types of operations performed by the user accounts assigned to the Audit Filter.|
| [[mariadb-enterprise-audit/#logging-filter|Logging Filters]]  | Logging Filters are used to enable or disable audit logging for the user accounts assigned to the Audit Filter. |
| [[mariadb-enterprise-audit/#object-filters|Object Filters]] | Object Filters are used to enable or disable audit logging for specific databases or tables accessed by the user accounts assigned to the Audit Filter. Support for Object Filters was added in MariaDB Enterprise Server 10.6. Support for Object Filters was backported to ES 10.4.21-13 and ES 10.5.12-8.|
&lt;&lt;/style&gt;&gt;
Administrators must [[mariadb-enterprise-audit/#start-audit-logging|start audit logging]].

= General Operation

MariaDB Enterprise Audit performs audit logging during typical operations of MariaDB Enterprise Server:

* When a user connects, fails to connect, or disconnects, MariaDB Enterprise Audit will write a message to the audit log if the Audit Filter specifies the specific type of [[mariadb-enterprise-audit/#connection-events|Connect Event]].
* When a user executes a query, MariaDB Enterprise Audit will write a message to the audit log if the Audit Filter specifies the specific type of [[mariadb-enterprise-audit/#query-events|Query Event]] and if the queried objects are not excluded by [[mariadb-enterprise-audit/#object-filters|Object Filters]].
* When a query accesses a table, MariaDB Enterprise Audit will write a message to the audit log if the Audit Filter specifies the specific type of Table Event and if the table is not excluded by [[mariadb-enterprise-audit/#object-filters|Object Filters]].
* When a query modifies the MariaDB Enterprise Audit configuration, MariaDB Enterprise Audit will write a message to the audit log if the Audit Filter specifies the [[mariadb-enterprise-audit/#audit-config-events|Audit Config Event]].
* When a user&#39;s [[mariadb-enterprise-audit/#logging-filter|Audit Filter]] contains a Logging Filter that disables audit logging, all audit logging for the user&#39;s activity will be skipped.

MariaDB Enterprise Audit writes audit log messages either to a dedicated [[mariadb-enterprise-audit/#audit-log-destinations|audit log file or to the system log (syslog)]], depending on configuration.

Audit log messages that correspond to a query are logged when the query completes. If a query is executed in a transaction, the audit log messages that correspond to the query are logged when the individual query completes, not when the transaction completes. If the query fails, the audit log message is logged at time of failure.

= Audit Log Considerations

Care must be taken when logging data for audit to maintain alignment to business requirements. Concerns include:

* Queries should not be logged for tables containing Personally Identifiable Information (PII) or Sensitive PII (SPII) such as passwords, since audit log data is written unencrypted. Consider using [[mariadb-enterprise-audit/#object-filters|Object Filters]] to exclude sensitive information from the audit log.
* Backup of audit data should be performed at least as frequently as database backups.
* Audit log data on database servers could be tampered with if the database server is compromised. Consider secure transmission of log data to a hardened and remote logging server.
* Where audit data is mission-critical, it should be subject to controls, data protection, data retention, and highly-available storage as are used for other mission-critical data.

== Confirm the MariaDB Audit Plugin is Loaded

To confirm that the MariaDB Audit plugin is loaded, query the [[mariadb-enterprise-audit/#confirm-the-audit-plugin-is-loaded|information_schema.PLUGINS]] table:

&lt;&lt;code&gt;&gt;
SELECT PLUGIN_STATUS, PLUGIN_LIBRARY, PLUGIN_DESCRIPTION
FROM information_schema.PLUGINS
WHERE PLUGIN_NAME=&#39;SERVER_AUDIT&#39;\G
&lt;&lt;/code&gt;&gt;

&lt;&lt;code&gt;&gt;
*************************** 1. row ***************************
     PLUGIN_STATUS: ACTIVE
    PLUGIN_LIBRARY: server_audit.so
PLUGIN_DESCRIPTION: Audit the server activity
&lt;&lt;/code&gt;&gt;

If you see the output shown above, then the MariaDB Audit plugin is installed, and it must be uninstalled prior to performing the upgrade or migration. Follow the instructions in the section below.

If you do not see any rows in the output, then the MariaDB Audit plugin is not installed.

== Determine Uninstallation Method

The MariaDB Audit plugin has multiple uninstallation methods. You must choose the uninstallation method that corresponds to how the plugin was installed on your system.

To determine the uninstallation method, query the [[mysql-plugin-table|mysql.plugin]] system table:

&lt;&lt;code&gt;&gt;
SELECT *
FROM mysql.plugin
WHERE name = &#39;SERVER_AUDIT&#39;\G
&lt;&lt;/code&gt;&gt;

&lt;&lt;code&gt;&gt;
*************************** 1. row ***************************
name: SERVER_AUDIT
  dl: server_audit.so
&lt;&lt;/code&gt;&gt;

If you see the output shown above, then the MariaDB Audit plugin can be uninstalled with [[mariadb-enterprise-audit/#uninstall-with-uninstall-soname|UNINSTALL SONAME]].

If you do not see any rows in the output, then the MariaDB Audit plugin call be uninstalled by [[mariadb-enterprise-audit/#uninstall-with-configuration-file|editing the configuration file]].

== Uninstall with UNINSTALL SONAME
To uninstall the MariaDB Audit Plugin with [[mariadb-enterprise-audit/#uninstall-with-uninstall-soname|UNINSTALL SONAME]]:

1. Check the plugin load option by querying the [[plugins-table-information-schema|information_schema.PLUGINS]] table:

&lt;&lt;code&gt;&gt;
SELECT PLUGIN_STATUS, PLUGIN_LIBRARY, PLUGIN_DESCRIPTION, LOAD_OPTION
FROM information_schema.PLUGINS
WHERE PLUGIN_NAME=&#39;SERVER_AUDIT&#39;\G
&lt;&lt;/code&gt;&gt;

&lt;&lt;code&gt;&gt;
*************************** 1. row ***************************
     PLUGIN_STATUS: ACTIVE
    PLUGIN_LIBRARY: server_audit.so
PLUGIN_DESCRIPTION: Audit the server activity
       LOAD_OPTION: FORCE_PLUS_PERMANENT
&lt;&lt;/code&gt;&gt;

If the LOAD_OPTION column does not contain the value FORCE_PLUS_PERMANENT, then you can skip to step 5, which executes the [[mariadb-enterprise-audit/#uninstall-with-uninstall-soname|UNINSTALL SONAME]] statement.

2. If the LOAD_OPTION column contains the value FORCE_PLUS_PERMANENT, then check your configuration files for the server-audit option:

&lt;&lt;code&gt;&gt;
$ grep --extended-regexp --with-filename \
   &#39;server[-_]audit[[:blank:]]*=&#39; \
   /etc/mysql/my.cnf \
   /etc/mysql/mariadb.conf.d/*
&lt;&lt;/code&gt;&gt;

&lt;&lt;code&gt;&gt;
/etc/mysql/mariadb.conf.d/enable-audit.cnf:server_audit=FORCE_PLUS_PERMANENT
&lt;&lt;/code&gt;&gt;

3. If the server-audit option was found in a configuration file, then remove or comment the option out:

&lt;&lt;code&gt;&gt;
[mariadb]
# server_audit=FORCE_PLUS_PERMANENT
&lt;&lt;/code&gt;&gt;

4. If the configuration file was changed, then restart the server:

&lt;&lt;code&gt;&gt;
$ sudo systemctl restart mariadb
&lt;&lt;/code&gt;&gt;


5. Uninstall the plugin by executing the [[mariadb-enterprise-audit/#uninstall-with-uninstall-soname|UNINSTALL SONAME]] statement:

&lt;&lt;code&gt;&gt;
UNINSTALL SONAME &#39;server_audit&#39;;
&lt;&lt;/code&gt;&gt;

6. Confirm the plugin is uninstalled by querying the [[mysql-plugin-table|mysql.plugin]] system table:

&lt;&lt;code&gt;&gt;
SELECT *
FROM mysql.plugin
WHERE name = &#39;SERVER_AUDIT&#39;\G
&lt;&lt;/code&gt;&gt;

If the query returns no results, then the plugin has been uninstalled.

== Uninstall with Configuration File

To uninstall the MariaDB Audit plugin with a configuration file:

1. Check your configuration files for the plugin_load_add option:
&lt;&lt;code&gt;&gt;

$ grep --extended-regexp --with-filename \
   &#39;plugin[-_]load[-_]add[[:blank:]]*=[[:blank:]]*server_audit&#39; \
   /etc/mysql/my.cnf \
   /etc/mysql/mariadb.conf.d/*
&lt;&lt;/code&gt;&gt;

&lt;&lt;code&gt;&gt;
/etc/mysql/mariadb.conf.d/enable-audit.cnf:plugin_load_add=server_audit
&lt;&lt;/code&gt;&gt;

2. Remove or comment out the plugin_load_add option from the configuration file:

&lt;&lt;code&gt;&gt;
[mariadb]
# plugin_load_add=server_audit
&lt;&lt;/code&gt;&gt;

= Install the Audit Plugin

MariaDB Enterprise Audit is installed by default in MariaDB Enterprise Server. It does not need to be manually installed.

To confirm that MariaDB Enterprise Audit is installed:

1. Determine the path to your server&#39;s plugin directory. When MariaDB Enterprise Server is running, the plugin directory can be determined by querying the [[server-system-variables/#plugin_dir|plugin_dir]] system variable:

&lt;&lt;code&gt;&gt;
SHOW GLOBAL VARIABLES
   LIKE &#39;plugin_dir&#39;;
&lt;&lt;/code&gt;&gt;

&lt;&lt;code&gt;&gt;
+---------------+--------------------------+
| Variable_name | Value                    |
+---------------+--------------------------+
| plugin_dir    | /usr/lib64/mysql/plugin/ |
+---------------+--------------------------+

&lt;&lt;/code&gt;&gt;

2. Confirm that your server&#39;s plugin directory contains server_audit2.so, which is the shared library for MariaDB Enterprise Audit:

&lt;&lt;code&gt;&gt;
$ ls -l /usr/lib64/mysql/plugin/server_audit2.so
&lt;&lt;/code&gt;&gt;

&lt;&lt;code&gt;&gt;
-rwxr-xr-x. 1 root root 70432 Jul 15 19:03 /usr/lib64/mysql/plugin/server_audit2.so
&lt;&lt;/code&gt;&gt;

MariaDB Enterprise Audit is included in all distributions (binary tarball, DEB/RPM package tarball, DEB/RPM packages) for MariaDB Enterprise Server. If the server_audit2.so file is not present, confirm that MariaDB Enterprise Server is properly installed. For additional information, see &#34;Deploy&#34;.

= Load the Audit Plugin
MariaDB Enterprise Audit is loaded by the mariadb-enterprise.cnf configuration file included by default in MariaDB Enterprise Server and later, so it does not generally need to be manually loaded.

The mariadb-enterprise.cnf configuration file loads MariaDB Enterprise Audit by setting the plugin-load-add and server-audit options:
&lt;&lt;code&gt;&gt;

# -- Auditing - pre-load Plugin
plugin-load-add=server_audit2
server_audit=FORCE_PLUS_PERMANENT
&lt;&lt;/code&gt;&gt;

If you do not use mariadb-enterprise.cnf in your environment, you can load MariaDB Enterprise Audit by setting the same options in your configuration file.

== Confirm the Audit Plugin is Loaded
To confirm that MariaDB Enterprise Audit is installed, query the plugins-table-information-schema|information_schema.PLUGINS]] table:
&lt;&lt;code&gt;&gt;

SELECT PLUGIN_STATUS, PLUGIN_LIBRARY, PLUGIN_DESCRIPTION, LOAD_OPTION
FROM information_schema.PLUGINS
WHERE PLUGIN_NAME=&#39;SERVER_AUDIT&#39;\G
&lt;&lt;/code&gt;&gt;

&lt;&lt;code&gt;&gt;

   *************************** 1. row ***************************
     PLUGIN_STATUS: ACTIVE
    PLUGIN_LIBRARY: server_audit2.so
PLUGIN_DESCRIPTION: MariaDB Enterprise Audit
       LOAD_OPTION: FORCE_PLUS_PERMANENT
&lt;&lt;/code&gt;&gt;

MariaDB Enterprise Audit is loaded by the mariadb-enterprise.cnf configuration file included by default in MariaDB Enterprise Server. If your output does not match the example output shown above, confirm that the mariadb-enterprise.cnf configuration file sets the plugin-load-add and server-audit options.

= Start Audit Logging
When MariaDB Enterprise Audit is installed and loaded, audit logging must be explicitly started.


Audit logging can be started using the shell or SQL:

&lt;&lt;style class=&#34;darkheader-nospace-borders left&#34;&gt;&gt;
|= Interface |= Method |= Benefits|
| Shell  | 	[[mariadb-enterprise-audit/#start-audit-logging-in-configuration-file|Configuration File]]|  \\ SQL access is not required \\ SUPER privilege is not required  \\ Configuration file can be version controlled
| SQL  | [[mariadb-enterprise-audit/#start-audit-logging-with-set-global|SET GLOBAL Statement]] | Server restart is not required|
&lt;&lt;/style&gt;&gt;

== Start Audit Logging in Configuration File
Audit logging with MariaDB Enterprise Audit can be started by setting the [[mariadb-audit-plugin-options-and-system-variables/#server_audit_logging|server_audit_logging]] system variable in a configuration file. Alternatively, audit logging can be started using [[mariadb-enterprise-audit/#start-audit-logging-with-set-global|SET GLOBAL]] , which does not require the server to be restarted.

1. Set the [[mariadb-audit-plugin-options-and-system-variables/#server_audit_logging|server_audit_logging]] system variable in a configuration file:

&lt;&lt;code&gt;&gt;

[mariadb]
server_audit_logging = ON
&lt;&lt;/code&gt;&gt;

2. Restart MariaDB Enterprise Server:

&lt;&lt;code&gt;&gt;
$ sudo systemctl restart mariadb
&lt;&lt;/code&gt;&gt;
If the server fails to start, check the [[mariadb-enterprise-audit/#messages-in-mariadb-error-log|messages in the error log]].

3. Confirm that audit logging is started by querying the [[mariadb-audit-plugin-status-variables/#server_audit_active|Server_audit_active]] status variable with the [[show-status|SHOW GLOBAL STATUS]] statement:

&lt;&lt;code&gt;&gt;
SHOW GLOBAL STATUS
   LIKE &#39;Server_audit_active&#39;;
&lt;&lt;/code&gt;&gt;

&lt;&lt;code&gt;&gt;
+---------------------+-------+
| Variable_name       | Value |
+---------------------+-------+
| Server_audit_active | ON    |
+---------------------+-------+
&lt;&lt;/code&gt;&gt;

== Start Audit Logging with SET GLOBAL

Audit logging with MariaDB Enterprise Audit can be started by setting the [[mariadb-audit-plugin-options-and-system-variables/#server_audit_logging|server_audit_logging]] system variable with the [[set|SET GLOBAL]] statement, which requires the SUPER privilege.

1. Set the [[mariadb-audit-plugin-options-and-system-variables/#server_audit_logging|server_audit_logging]] system variable with the [[set|SET GLOBAL]] statement:

&lt;&lt;code&gt;&gt;
SET GLOBAL server_audit_logging=ON;
&lt;&lt;/code&gt;&gt;

2. Confirm that audit logging is started by querying the [[mariadb-audit-plugin-status-variables/#server_audit_active|Server_audit_active]] status variable with the [[show-status|SHOW GLOBAL STATUS]] statement:

&lt;&lt;code&gt;&gt;
SHOW GLOBAL STATUS
   LIKE &#39;Server_audit_active&#39;;
&lt;&lt;/code&gt;&gt;

&lt;&lt;code&gt;&gt;
+---------------------+-------+
| Variable_name       | Value |
+---------------------+-------+
| Server_audit_active | ON    |
+---------------------+-------+

&lt;&lt;/code&gt;&gt;

When a system variable is dynamically changed with the [[set|SET GLOBAL]] statement, the change does not survive server restarts. To ensure that audit logging is started when the server restarts, set the[[mariadb-audit-plugin-options-and-system-variables/#server_audit_logging|server_audit_logging]] system variable in a configuration file too:

&lt;&lt;code&gt;&gt;
[mariadb]
server_audit_logging = ON
&lt;&lt;/code&gt;&gt;


== Confirm Audit Logging is Started
Confirm that audit logging is started by querying the [[mariadb-audit-plugin-status-variables/#server_audit_active|Server_audit_active]] status variable with the [[show-status|SHOW GLOBAL STATUS]] statement:

&lt;&lt;code&gt;&gt;
SHOW GLOBAL STATUS
   LIKE &#39;Server_audit_active&#39;;
&lt;&lt;/code&gt;&gt;

&lt;&lt;code&gt;&gt;
+---------------------+-------+
| Variable_name       | Value |
+---------------------+-------+
| Server_audit_active | ON    |
+---------------------+-------+
&lt;&lt;/code&gt;&gt;

= Forbid Uninstallation
In a secure environment, MariaDB Enterprise Audit provides administrators with an audit trail of actions performed by users on the MariaDB Enterprise Server node. To protect the integrity of the audit trail, users should not be able to uninstall MariaDB Enterprise Audit. If the server-audit option is set to FORCE_PLUS_PERMANENT, MariaDB Enterprise Server will prevent MariaDB Enterprise Audit from being uninstalled:
&lt;&lt;code&gt;&gt;

server_audit=FORCE_PLUS_PERMANENT
&lt;&lt;/code&gt;&gt;

When a user tries to uninstall MariaDB Enterprise Audit with the server-audit option set to FORCE_PLUS_PERMANENT, the operation fails with the ER_PLUGIN_IS_PERMANENT error code:

&lt;&lt;code&gt;&gt;
UNINSTALL SONAME &#39;server_audit2&#39;;
&lt;&lt;/code&gt;&gt;

&lt;&lt;code&gt;&gt;
ERROR 1702 (HY000): Plugin &#39;SERVER_AUDIT&#39; is force_plus_permanent and can not be unloaded
&lt;&lt;/code&gt;&gt;

The mariadb-enterprise.cnf configuration file included by default in MariaDB Enterprise Server sets the server-audit option to FORCE_PLUS_PERMANENT. As a consequence, MariaDB Enterprise Server forbids MariaDB Enterprise Audit from being uninstalled by default.

If you do not use mariadb-enterprise.cnf in your environment, you can configure MariaDB Enterprise Audit to forbid uninstallation by setting the server-audit option in your configuration file.

== Confirm that Uninstallation is Forbidden
To confirm that MariaDB Enterprise Audit is configured to forbid uninstallation, query the [[plugins-table-information-schema|information_schema.PLUGINS]] table:
&lt;&lt;code&gt;&gt;

SELECT PLUGIN_STATUS, PLUGIN_LIBRARY, PLUGIN_DESCRIPTION, LOAD_OPTION
FROM information_schema.PLUGINS
WHERE PLUGIN_NAME=&#39;SERVER_AUDIT&#39;\G
&lt;&lt;/code&gt;&gt;

&lt;&lt;code&gt;&gt;

   *************************** 1. row ***************************
     PLUGIN_STATUS: ACTIVE
    PLUGIN_LIBRARY: server_audit2.so
PLUGIN_DESCRIPTION: MariaDB Enterprise Audit
       LOAD_OPTION: FORCE_PLUS_PERMANENT
&lt;&lt;/code&gt;&gt;

If your output does not match the example output shown above, confirm that the mariadb-enterprise.cnf configuration file sets the server-audit option to FORCE_PLUS_PERMANENT.

= Server Startup Behavior
Some specific server startup behavior is described in the sections below.

For examples of error messages that can appear in the MariaDB error log during server startup, see [[mariadb-enterprise-audit/#messages-in-mariadb-error-log|Messages in MariaDB Error Log]].

== Enterprise Audit Not Loaded
MariaDB Enterprise Server can startup and handle traffic even if MariaDB Enterprise Audit is not installed or loaded. However, the specific behavior can be configured.

When the server-audit option is set to FORCE or FORCE_PLUS_PERMANENT, MariaDB Enterprise Server will fail to start if MariaDB Enterprise Audit can&#39;t be loaded.

The mariadb-enterprise.cnf configuration file included by default in MariaDB Enterprise Server sets the server-audit option to FORCE_PLUS_PERMANENT. As a consequence, MariaDB Enterprise Server forbids MariaDB Enterprise Audit from being uninstalled by default.

== Invalid Filter Definitions
MariaDB Enterprise Audit attempts to load the [[mariadb-enterprise-audit/#audit-filters|Audit Filters]] during startup.

When MariaDB Enterprise Audit encounters errors in the Audit Filter definitions, MariaDB Enterprise Server will still start and load MariaDB Enterprise Audit. In this situation, an error will be written to the MariaDB error log and all Events for all objects will be audit logged.

= Additional Points of Control
When enabled, MariaDB Enterprise Audit logs designated Events that occur on a running instance of MariaDB Enterprise Server.

Additional audit practices should be established to cover:

* Data backup controls.
* System-level controls, including authentication, file system, and process execution.
* Network-level controls.
* Monitoring systems, including [[mariadb-enterprise-audit/#confirm-audit-logging-is-started|monitoring for audit logging]].
* Changes to user accounts (and the [[mysql-global_priv-table|mysql.global_priv]] system table), which can necessitate changes to Audit Filters.

= Audit Filters
Filters are JSON objects that specify what you want MariaDB Enterprise Audit to monitor.

There are two types of filters:

&lt;&lt;style class=&#34;darkheader-nospace-borders left&#34;&gt;&gt;
|= Audit Filter Type |= Description |
| [[mariadb-enterprise-audit/#default-audit-filter|Default Audit Filter]]  | \\The Default Audit Filter is used for all user accounts that are not assigned a Named Audit Filter. \\ Only a single Default Audit Filter can be defined in the mysql.server_audit_filters system table, and it must be defined with the name default. |
| [[mariadb-enterprise-audit/#named-audit-filters|Named Audit Filters]]  | \\Named Audit Filters must be assigned to specific user accounts. \\ Many Named Audit Filters can be defined in the mysql.server_audit_filters system table, and they must be defined with unique names. \\ A Named Audit Filter can be assigned to a user account by inserting the user account details and the filter name into the mysql.server_audit_users system table. |
&lt;&lt;/style&gt;&gt;

= Default Audit Filter
The Default Audit Filter is used for all user accounts that are not assigned a Named Audit Filter.

Only a single Default Audit Filter can be defined in the mysql.server_audit_filters system table, and it must be defined with the name default.

== Create a Default Audit Filter
If you want to create a Default Audit Filter, you need to insert the details into the mysql.server_audit_filters system table. The name for the Default Audit Filter must be default and the rule should be designed to meet your audit logging requirements.

To create a Default Audit Filter:

1. Confirm that a Default Audit Filter does not already exist:

&lt;&lt;code&gt;&gt;
SELECT * FROM mysql.server_audit_filters
    WHERE filtername = &#39;default&#39;;
&lt;&lt;/code&gt;&gt;

2. If a Default Audit Filter already exists, remove it:

&lt;&lt;code&gt;&gt;
DELETE FROM mysql.server_audit_filters
    WHERE filtername = &#39;default&#39;;
&lt;&lt;/code&gt;&gt;


3. Insert the details for the new Default Audit Filter into the mysql.server_audit_filters system table:

&lt;&lt;code&gt;&gt;
INSERT INTO mysql.server_audit_filters (filtername, rule)
   VALUES (&#39;default&#39;,
      JSON_COMPACT(
         &#39;{
            &#34;connect_event&#34;:&#34;ALL&#34;,
            &#34;table_event&#34;:&#34;WRITE&#34;
         }&#39;
      ));
&lt;&lt;/code&gt;&gt;
This example Audit Filter configures audit logging for all Connection Events and Write Table Events.

The example passes the JSON object to the [[json_compact|JSON_COMPACT()]] function, so that the JSON object is compacted prior to being inserted into the system table. This step is recommended, but not required.

4. Reload the Audit Filters by setting the server_audit_reload_filters system variable to ON:

&lt;&lt;code&gt;&gt;
SET GLOBAL server_audit_reload_filters=ON;
&lt;&lt;/code&gt;&gt;

= Named Audit Filters

Named Audit Filters must be assigned to specific user accounts.

Multiple Named Audit Filters can be defined in the mysql.server_audit_filters system table, and they must be defined with unique names. A Named Audit Filter can be assigned to a user account by inserting the user account details and the filter name into the mysql.server_audit_users system table.

== Create a Named Audit Filter

To create a Named Audit Filter, insert a row with the Audit Filter&#39;s name and the rule into the mysql.server_audit_filters system table:

&lt;&lt;code&gt;&gt;
INSERT INTO mysql.server_audit_filters (filtername, rule)
   VALUES (&#39;reporting&#39;,
      JSON_COMPACT(
         &#39;{
            &#34;connect_event&#34;: [
               &#34;CONNECT&#34;,
               &#34;DISCONNECT&#34;
            ],
            &#34;table_event&#34;:[
               &#34;WRITE&#34;,
               &#34;CREATE&#34;,
               &#34;DROP&#34;,
               &#34;RENAME&#34;,
               &#34;ALTER&#34;
            ]
         }&#39;
      ));
&lt;&lt;/code&gt;&gt;

This example Audit Filter is defined with the name reporting, and it configures audit logging for Connection Events and Disconnection Events and for several types of Table Events. This example Audit Filter can be useful for read-only users since it does not log table reads, but it does log table writes and schema changes which are illegitimate activities for a read-only user.

The example passes the JSON object to the JSON_COMPACT() function, so that the JSON object is compacted prior to being inserted into the system table. This step is recommended, but not required.

For additional information on how to assign the Audit Filter to a user account, see &#34;[[mariadb-enterprise-audit/#assign-a-named-audit-filter|Assign a Named Audit Filter]]&#34;.

== Assign a Named Audit Filter

Named Audit Filters are only active when they are assigned to a specific user account.

To assign a Named Audit Filter to a user account:

1. Insert a row with the user account details and the Audit Filter&#39;s name into the mysql.server_audit_users system table:

&lt;&lt;code&gt;&gt;
INSERT INTO mysql.server_audit_users (host, user, filtername)
   VALUES (&#34;%&#34;, &#34;reader&#34;, &#34;reporting&#34;);
&lt;&lt;/code&gt;&gt;
This example statement assigns the reporting Audit Filter created in &#34;[[mariadb-enterprise-audit/#create-a-named-audit-filter|Create a Named Audit Filter]]&#34; to the reader@% user account.

2. Reload the Audit Filters by setting the server_audit_reload_filters system variable to ON:

&lt;&lt;code&gt;&gt;
SET GLOBAL server_audit_reload_filters=ON;
&lt;&lt;/code&gt;&gt;

MariaDB Enterprise Audit does not track changes to user accounts. If you delete or rename a user account, the change doesn&#39;t cascade to the Audit Filter. The Audit Filters must be updated manually.

== Using the DML_NO_SELECT Filter

You can use the DML_NO_SELECT filter for the query_event. It allows excluding SELECT statements, providing more granular control over audited events. When the filter is applied, only DML statements that change data, like INSERT, UPDATE, and DELETE are included. Note that this includes SELECT statements that change data, like SELECT INTO or SELECT FOR UPDATE.
 
To use the DML_NO_SELECT filter, add it to the query_event configuration option in the [audit] section of the MariaDB configuration file. For example:

[audit] query_event = DML, DDL, DCL, DML_NO_SELECT 
To verify that the DML_NO_SELECT filter is working correctly, run a SELECT statement, then check the audit log. The event should not be categorized as DML.

Note that excluding SELECT statements from the DML category may reduce the amount of audit data generated, but it may also miss important events.

= System Tables for Audit Filters
There are two system tables for Audit Filters:

&lt;&lt;style class=&#34;darkheader-nospace-borders left&#34;&gt;&gt;
|= System Table |= Description |
| mysql.server_audit_filters  | Audit Filter definitions with MariaDB Enterprise Audit|
| mysql.server_audit_users  | Audit Filter assignments for user accounts with MariaDB Enterprise Audit. |
&lt;&lt;/style&gt;&gt;

== Query Audit Filters
You can query Audit Filters by querying the mysql.server_audit_filters system table.

The JSON objects can be made more human-readable by passing them to the [[json_detailed|JSON_DETAILED()]] or [[json_loose|JSON_LOOSE()]] functions:

&lt;&lt;code&gt;&gt;
SELECT filtername,
   JSON_DETAILED(rule)
FROM mysql.server_audit_filters\G
&lt;&lt;/code&gt;&gt;
&lt;&lt;code&gt;&gt;
*************************** 1. row ***************************
         filtername: reporting
JSON_DETAILED(rule): {
    &#34;table_event&#34;:
    [
        &#34;WRITE&#34;,
        &#34;CREATE&#34;,
        &#34;DROP&#34;,
        &#34;RENAME&#34;,
        &#34;ALTER&#34;,

        {
            &#34;log_databases&#34;:
            [
                &#34;production&#34;,
                &#34;reporting&#34;
            ]
        }
    ]
}
&lt;&lt;/code&gt;&gt;

== Query User Assignments for Named Audit Filters
You can query user assignments for Named Audit Filters by joining the mysql.server_audit_filters and mysql.server_audit_users system tables.

The JSON objects can be made more human-readable by passing them to the [[json_detailed|JSON_DETAILED()]] or [[json_loose|JSON_LOOSE()]] functions:

&lt;&lt;code&gt;&gt;
SELECT sau.host, sau.user, saf.filtername,
   JSON_DETAILED(saf.rule)
FROM mysql.server_audit_filters saf
JOIN mysql.server_audit_users sau
   ON saf.filtername = sau.filtername
WHERE saf.filtername != &#39;default&#39;\G
&lt;&lt;/code&gt;&gt;

&lt;&lt;code&gt;&gt;
*************************** 1. row ***************************
                   host: %
                   user: reader
             filtername: reporting
JSON_DETAILED(saf.rule): {
    &#34;table_event&#34;:
    [
        &#34;WRITE&#34;,
        &#34;CREATE&#34;,
        &#34;DROP&#34;,
        &#34;RENAME&#34;,
        &#34;ALTER&#34;,

        {
            &#34;log_databases&#34;:
            [
                &#34;production&#34;,
                &#34;reporting&#34;
            ]
        }
    ]
}
*************************** 2. row ***************************
                   host: %
                   user: writer
             filtername: reporting
JSON_DETAILED(saf.rule): {
    &#34;table_event&#34;:
    [
        &#34;WRITE&#34;,
        &#34;CREATE&#34;,
        &#34;DROP&#34;,
        &#34;RENAME&#34;,
        &#34;ALTER&#34;,

        {
            &#34;log_databases&#34;:
            [
                &#34;production&#34;,
                &#34;reporting&#34;
            ]
        }
    ]
}
&lt;&lt;/code&gt;&gt;


== Reload Audit Filters and Assignments
MariaDB Enterprise Audit caches its Audit Filters to improve performance. When you change an Audit Filter or an Audit Filter assignment in the system tables, you need to reload the Audit Filters for the changes to take effect.

To reload Audit Filters, set the server_audit_reload_filters system variable to ON with the [[set|SET GLOBAL]] statement, which requires the SUPER privilege:

&lt;&lt;code&gt;&gt;
SET GLOBAL server_audit_reload_filters=ON;
&lt;&lt;/code&gt;&gt;

When you set the server_audit_reload_filters system variable to ON, MariaDB Enterprise Audit reloads all Audit Filters and assignments to ensure that it is using the latest definitions. Afterward, it sets server_audit_reload_filters back to OFF.

For additional information on how to use the server_audit_reload_filters system variable, see &#34;[[mariadb-enterprise-audit/#default-audit-filter|Default Audit Filter]]&#34; and &#34;[[mariadb-enterprise-audit/#named-audit-filters|Named Audit Filters]]&#34;.

&lt;&lt;style class=&#34;darkheader-nospace centered&#34;&gt;&gt;
|= Note | When an error occurs while reloading an Audit Filter, MariaDB Enterprise Audit will write an error to the MariaDB Error Log, and it will continue to use the cached definition of the Audit Filter. If the invalid Audit Filter is not fixed, MariaDB Enterprise Audit will not be able to load the invalid Audit Filter when the server is restarted.
&lt;&lt;/style&gt;&gt;


= Event Filters

MariaDB Enterprise Audit supports Event Filters in Audit Filters. Event Filters can be used to configure which Events you want to audit. Each Event refers to a different class of operation.

MariaDB Enterprise Audit defines multiple Event classes that can be used in Event Filters:

* [[mariadb-enterprise-audit/#audit-config-events|Audit Config Events]]
* [[mariadb-enterprise-audit/#connection-events|Connect Events]]
* [[mariadb-enterprise-audit/#query-events|Query Events]]
* [[mariadb-enterprise-audit/#table-events|Table Events]]

The Event classes are described in the sections below. Example audit logs for each Event class are shown in the sections below. For details about the audit log format, see [[mariadb-enterprise-audit/#audit-log-format|Audit Log Format]].

== Audit Config Events
MariaDB Enterprise Audit implements Audit Config Events to help keep track of changes to the audit log configuration.

MariaDB Enterprise Audit logs Audit Config (AUDIT_CONFIG) Events in the following situations:

* When one of MariaDB Enterprise Audit&#39;s system variables is changed with the [[set|SET GLOBAL]] statement, the change is logged.
* When the audit log file is rotated, it is logged.

In the following example output, 3 Audit Config Events and 1 Query Event are shown:

&lt;&lt;code&gt;&gt;
20190622 02:10:21,localhost.localdomain,,,0,0,AUDIT_CONFIG,,file_path=server_audit.log,0
20190622 02:10:21,localhost.localdomain,,,0,0,AUDIT_CONFIG,,rotate_size=1000000,0
20190622 02:10:21,localhost.localdomain,,,0,0,AUDIT_CONFIG,,file_rotations=9,0
20190622 02:10:21,localhost.localdomain,root,localhost,8,7,QUERY,mysql,&#39;set global server_audit_logging = on&#39;,0
&lt;&lt;/code&gt;&gt;
Audit Config Events are always logged, so no configuration is required when [[mariadb-enterprise-audit/#start-audit-logging|audit logging]] is started.

== Connection Events
MariaDB Enterprise Audit implements Connection Events to audit connection attempts, authentication failures, and user account changes that occur due to certain authentication plugins, such as pam.

MariaDB Enterprise Audit logs Connection Events in the following situations:

* When a user successfully connects, it is logged with the CONNECT Event sub-class.
* When a user disconnects, it is logged with the DISCONNECT Event sub-class.
* When a user fails to connect, it is logged with the FAILED_CONNECT Event sub-class.
* When an existing connection authenticates as a different user, it is logged with the CHANGE_USER Event sub-class.
* When an authentication plugin changes to a proxy user, it is logged with the PROXY_CONNECT Event sub-class.

In the following example output, multiple sub-classes of Connection Events are shown:

&lt;&lt;code&gt;&gt;
20190710 00:05:30,localhost.localdomain,root, localhost,2,0,CONNECT,,,0
20190710 00:05:53,localhost.localdomain,root, localhost,2,0,DISCONNECT,,,0
20190710 00:06:28,localhost.localdomain,unknownuser,localhost,3,0,FAILED_CONNECT,,,1045
20190710 00:06:28,localhost.localdomain,unknownuser, localhost,3,0,DISCONNECT,,,0
&lt;&lt;/code&gt;&gt;

An Event Filter for Connection Events can be added to an Audit Filter with the connect_event key, which supports the following values:

&lt;&lt;style class=&#34;darkheader-nospace-borders left&#34;&gt;&gt;
|= Value |= Description |
| CONNECT  | Records when the user connects to MariaDB Enterprise Server |
| DISCONNECT  | Records when the user disconnects from MariaDB Enterprise Server |
|FAILED_CONNECT |Records when a user attempts to connect to MariaDB Enterprise Server, but the connection attempt fails due to authentication or similar issues |
| CHANGE_USER| Records when a user switches to a different user account|
|PROXY_CONNECT | Records proxy user connections. This Connection Event sub-class was added in ES10.4.17-10 and ES10.5.8-5.|
|ALL |Records all connection Events |
&lt;&lt;/style&gt;&gt;

For example, the following query defines a [[mariadb-enterprise-audit/#named-audit-filters|Named Audit Filter]] that specifies Connection Events:

&lt;&lt;code&gt;&gt;
INSERT INTO mysql.server_audit_filters (filtername, rule)
   VALUES (&#39;connections&#39;,
      JSON_COMPACT(
         &#39;{
            &#34;connect_event&#34;: [
               &#34;CONNECT&#34;,
               &#34;DISCONNECT&#34;
            ]
         }&#39;
      ));
&lt;&lt;/code&gt;&gt;

The example passes the JSON object to the [[json_compact|JSON_COMPACT()]] function, so that the JSON object is compacted prior to being inserted into the system table. This step is recommended, but not required.

== Query Events
MariaDB Enterprise Audit implements Query Events to audit the execution of a specific subset of SQL statements.

MariaDB Enterprise Audit logs Query Events in the following situations:

* When a SQL statement is directly executed, it is logged with the QUERY Event.

MariaDB Enterprise Audit does not log Query Events for SQL statements that are indirectly executed. For example, if an SQL statement is executed as part of a view, stored procedure, stored function, or trigger, the query will not be logged. If you want to audit all table accesses, including indirect table accesses, it is recommended to enable audit logging for [[mariadb-enterprise-audit/#table-events|Table Events]] in addition to Query Events.

In the following example output, 1 Query Event is shown:
&lt;&lt;code&gt;&gt;

20190710 02:21:07,localhost.localdomain,John,localhost,3,30,QUERY,db1,&#39;SELECT * FROM services WHERE typeid IN (SELECT id FROM services_types WHERE name=&#34;consulting&#34;)&#39;,0
&lt;&lt;/code&gt;&gt;
An Event Filter for Query Events can be added to an Audit Filter with the ##query_event## key, which supports the following values:
&lt;&lt;style class=&#34;darkheader-nospace-borders left&#34;&gt;&gt;
|= Value |= Description |
| DML  | Records any SQL statements in the Data Manipulation Language subset, including SELECT, INSERT, UPDATE, and DELETE statements. |
| DDL  | Records any SQL statements in the Data Definition Language subset, including CREATE TABLE and ALTER TABLE, as well as DROP TABLE and TRUNCATE operations. |
|DCL |Records any SQL statements in the Data Control Language subset, including GRANT and REVOKE. |
| DML_READ |Records SELECT statements in the Data Manipulation Language subset. |
|DML_WRITE | Records any SQL statements for writes in the Data Manipulation Language subset, including INSERT, UPDATE, and DELETE statements.|
|DML_NO_SELECT |Alias for DML_WRITE |
|ALL |Records any SQL statements run by the user.|
&lt;&lt;/style&gt;&gt;

For example, the following query defines a [[mariadb-enterprise-audit/#named-audit-filters|Named Audit Filter]] that specifies Query Events:

&lt;&lt;code&gt;&gt;
INSERT INTO mysql.server_audit_filters (filtername, rule)
   VALUES (
       &#39;queries&#39;,
       JSON_COMPACT(
          &#39;{
              &#34;query_event&#34;: [
                  &#34;DML&#34;,
                  &#34;DDL&#34;,
		  &#34;DCL&#34;,
		  &#34;DML_NO_SELECT&#34;,
		  &#34;DML_WRITE&#34;,
		  &#34;DML_READ&#34;,
		  &#34;ALL&#34;
              ]
          }&#39;
       )
    );
&lt;&lt;/code&gt;&gt;

The example passes the JSON object to the [[json_compact|JSON_COMPACT()]] function, so that the JSON object is compacted prior to being inserted into the system table. This step is recommended, but not required.

MariaDB Enterprise Audit also supports [[mariadb-enterprise-audit/#object-filters|Object Filters]] for Query Events. Support for Object Filters was added in MariaDB Enterprise Server 10.6. Support for Object Filters was backported to ES 10.4.21-13 and ES 10.5.12-8.

== Table Events
MariaDB Enterprise Audit implements Table Events to audit when a table is accessed or modified.

MariaDB Enterprise Audit logs Table Events in the following situations:

* When an operation reads from a table, it is logged with the READ Event sub-class.
* When an operation writes to a table, it is logged with the WRITE Event sub-class.
* When an operation creates a table, it is logged with the CREATE Event sub-class.
* When an operation drops a table, it is logged with the DROP Event sub-class.
* When an operation alters a table, it is logged with the ALTER Event sub-class.
* When an operation renames a table, it is logged with the RENAME Event sub-class.

Table Events are logged when a table is accessed or modified directly or indirectly by a query. They complement Query Events very well, because the [[mariadb-enterprise-audit/#query-events|Query Event]] causes the raw query to be audit logged, and the Table Event causes all table operations to be audit logged. Both Query Events and Table Events are logged with the query ID, so each Table Event can easily be mapped to its corresponding Query Event. The combination of Query Events and Table Events can be useful when table operations can be hidden by views or triggers.

In the following example output, 6 sub-classes of Table Events are shown:

&lt;&lt;code&gt;&gt;
20190710 02:21:06,localhost.localdomain,John,localhost,3,25,CREATE,db1,services,
20190710 02:21:06,localhost.localdomain,John,localhost,3,27,READ,db1,services,
20190710 02:21:07,localhost.localdomain,John,localhost,3,29,WRITE,db1,services,
20190710 02:21:27,localhost.localdomain,John,localhost,3,35,ALTER,db1,services,
20190710 02:21:27,localhost.localdomain,John,localhost,3,36,RENAME,db1,services,db1,services_new
20190710 02:21:45,localhost.localdomain,John,localhost,3,38,DROP,db1,services_new,
&lt;&lt;/code&gt;&gt;
When a query uses the DELAYED keyword, it is executed by a system user. In this case, any Table Event associated with the query is written to the audit log with the user set to DELAYED. However, the Query Event associated with the query is written to the audit log with the original user:

&lt;&lt;code&gt;&gt;
20190622 02:10:21,localhost.localdomain,root,localhost,8,5,QUERY,test,&#39;INSERT DELAYED INTO t1 VALUES(1),(2),(3);&#39;,0
20190622 02:10:25,localhost.localdomain,root,localhost,2,2,WRITE,test,t1,
20190622 02:10:25,localhost,DELAYED,localhost,2,2,WRITE,test,t1,
&lt;&lt;/code&gt;&gt;
When your application executes queries with the DELAYED keyword, it is recommended to enable audit logging for Query Events in addition to Table Events to ensure that the full details are logged.

If the query cache is enabled, READ Table Events may not be audit logged. If MariaDB Enterprise Audit detects that the query cache is enabled during startup, MariaDB Enterprise Audit writes the following message to the MariaDB error log:

&lt;&lt;code&gt;&gt;
2021-07-23  0:11:26 server_audit: Query cache is enabled with the TABLE events. Some table reads can be veiled.
&lt;&lt;/code&gt;&gt;

An Event Filter for Table Events can be added to an Audit Filter with the table_event key, which supports the following values:

&lt;&lt;style class=&#34;darkheader-nospace-borders left&#34;&gt;&gt;
|= Value |= Description |
| READ  | Records read operations run on table objects, such as from a SELECT statement or an INSERT SELECT|
| WRITE  | Records write operations run on table objects, such as INSERT or UPDATE statements |
|CREATE |Records any creation operations run on table objects, such as from a CREATE TABLE or CREATE SERVER. |
|DROP |Records any deletion operations run on table objects, such as DELETE or DROP TABLE.|
|ALTER |Records any modifications made on table objects, such as ALTER TABLE or ALTER USER. |
| RENAME|Records any renaming operations run on table objects, such as RENAME TABLE |
|ALL | Records all operations run on table objects|
&lt;&lt;/style&gt;&gt;

For example, the following query defines a [[mariadb-enterprise-audit/#named-audit-filters|Named Audit Filter]] that specifies Table Events:
&lt;&lt;code&gt;&gt;

INSERT INTO mysql.server_audit_filters (filtername, rule)
   VALUES (
       &#39;tables&#39;,
       JSON_COMPACT(
           &#39;{
              &#34;table_event&#34;: [
                  &#34;WRITE&#34;,
                  &#34;CREATE&#34;,
                  &#34;DROP&#34;,
                  &#34;RENAME&#34;,
                  &#34;ALTER&#34;
              ]
           }&#39;
       )
    );
&lt;&lt;/code&gt;&gt;

The example passes the JSON object to the [[json_compact|JSON_COMPACT()]] function, so that the JSON object is compacted prior to being inserted into the system table. This step is recommended, but not required.

MariaDB Enterprise Audit also supports [[mariadb-enterprise-audit/#object-filters|Object Filters]] for Table Events. Support for Object Filters was added in MariaDB Enterprise Server 10.6. Support for Object Filters was backported to ES 10.4.21-13 and ES 10.5.12-8.

= Logging Filter
MariaDB Enterprise Audit supports a special Logging Filter that can be used in Audit Filters to enable or disable audit logging for any users that are assigned the Audit Filter.

The Logging Filter can be added to an Audit Filter with the logging key, which supports the following values:

&lt;&lt;style class=&#34;darkheader-nospace-borders left&#34;&gt;&gt;
|= Value |= Description |
| ON  | Enables audit logging for this Audit Filter|
| OFF  | Disables audit logging for this Audit Filter |
&lt;&lt;/style&gt;&gt;


For example, the following query defines a [[mariadb-enterprise-audit/#default-audit-filter|Default Audit Filter]] that enables logging for all Events for any user account without a [[mariadb-enterprise-audit/#named-audit-filters|Named Audit Filter]]:

&lt;&lt;code&gt;&gt;
INSERT INTO mysql.server_audit_filters (filtername, rule)
   VALUES (
       &#39;default&#39;,
       JSON_COMPACT(
           &#39;{
              &#34;logging&#34;: &#34;ON&#34;
           }&#39;
       )
    );
&lt;&lt;/code&gt;&gt;
The example passes the JSON object to the [[json_compact|JSON_COMPACT()]] function, so that the JSON object is compacted prior to being inserted into the system table. This step is recommended, but not required.

= Object Filters
Object Filters allow Audit Filters to be limited to specific databases and/or tables. Object Filters can be specified at different scopes:

* An Object Filter can be specified for an entire Audit Filter
* An Object Filter can be specified for a single Event for the Audit Filter

Support for Object Filters was added in MariaDB Enterprise Server 10.6. Support for Object Filters was backported to ES 10.4.21-13 and ES 10.5.12-8.

== Object Filter Format

Object Filters are formatted as JSON objects, which are key-value pairs.

For Object Filters, the key in the key-value pair refers to the specific type of Object Filter. The following types of Object Filters are supported:

&lt;&lt;style class=&#34;darkheader-nospace-borders left&#34;&gt;&gt;
|= Audit Log? |= Object Filter Key |= Description|
| No  | ignore_databases | When one or more databases are specified with the ignore_databases Object Filter key, the specified databases will not be audit logged. The ignore_databases Object Filter key is an alias for the ignore_tables Object Filter key, with the table identifier set to the wildcard character (*). The ignore_databases Object Filter key cannot be specified in the same Object Filter as the log_databases and log_tables Object Filter keys. | 
| No  | ignore_tables | When one or more tables are specified with the ignore_tables Object Filter key, the specified tables will not be audit logged. Table names must be provided in the form database.table. Wildcard characters (*) are allowed. The ignore_tables Object Filter key cannot be specified in the same Object Filter as the log_databases and log_tables Object Filter keys.|
|Yes |log_databases | When one or more databases are specified with the log_databases Object Filter key, the specified databases will be audit logged, and all other databases will not be audit logged. The log_databases Object Filter key is an alias for the log_tables Object Filter key, with the table identifier set to the wildcard character (*).|
| Yes| log_tables | When one or more databases are specified with the log_tables Object Filter key, the specified tables will be audit logged, and all other tables will not be audit logged. Table names must be provided in the form database.table. Wildcard characters (*) are allowed.|
&lt;&lt;/style&gt;&gt;

The values in the key-value pair refer to one or more object names.

When the Object Filter only applies to one object, the object name can be specified as a string scalar value in the JSON object:

&lt;&lt;code&gt;&gt;
{&#34;object_filter_key&#34;: &#34;object&#34;}
&lt;&lt;/code&gt;&gt;

When the Object Filter applies to multiple objects, the object names can be specified in a JSON array in the JSON object:

&lt;&lt;code&gt;&gt;
{&#34;object_filter_key&#34;: [ &#34;object&#34;, &#34;object&#34; ]}
&lt;&lt;/code&gt;&gt;

In the following example, the Object Filter is designed to audit log the production and reporting databases and to skip audit logging for all other databases and tables:

&lt;&lt;code&gt;&gt;
{&#34;log_tables&#34;: [&#34;production.*&#34;, &#34;reporting.*&#34;]}
&lt;&lt;/code&gt;&gt;

And in the following example, the Object Filter is designed to skip audit logging for the production.app_log table:

&lt;&lt;code&gt;&gt;
{&#34;ignore_tables&#34;: &#34;production.app_log&#34;}
&lt;&lt;/code&gt;&gt;

The Object Filter keys must be specified in different locations in the Audit Filter&#39;s JSON object, depending on the desired scope of the Object Filter. The following sections describe how to set Object Filters in more detail.

== Set Object Filters at Event Scope

An Object Filter can be specified for a single Event Filter within an Audit Filter.

Object Filters are supported by the following Events:

* [[mariadb-enterprise-audit/#query-events|Query Events]]
* [[mariadb-enterprise-audit/#table-events|Table Events]]

To create an Object Filter for a single Event Filter, specify the Object Filter&#39;s JSON object as part of the JSON object for the Event Filter.

The examples below pass the JSON object to the [[json_compact|JSON_COMPACT()]] function, so that the JSON object is compacted prior to being inserted into the system table. This step is recommended, but not required.

In the following example, the reporting Audit Filter specifies an Event Filter for Table Events with an embedded Object Filter that includes all tables in the production and reporting databases:

&lt;&lt;code&gt;&gt;
INSERT INTO mysql.server_audit_filters (filtername, rule)
   VALUES (
       &#39;reporting&#39;,
       JSON_COMPACT(
           &#39;{
              &#34;table_event&#34;: [
                  &#34;WRITE&#34;,
                  &#34;CREATE&#34;,
                  &#34;DROP&#34;,
                  &#34;RENAME&#34;,
                  &#34;ALTER&#34;,
                  {
                     &#34;log_tables&#34;: [
                        &#34;production.*&#34;,
                        &#34;reporting.*&#34;
                     ]
                  }
              ]
           }&#39;
       )
    );
&lt;&lt;/code&gt;&gt;

== Set Object Filters at Audit Filter Scope
An Object Filter can be specified for an entire Audit Filter.

To create an Object Filter at Audit Filter scope, specify the Object Filter&#39;s JSON object as part of the root JSON object for the Audit Filter.

The examples below pass the JSON object to the [[json_compact|JSON_COMPACT()]] function, so that the JSON object is compacted prior to being inserted into the system table. This step is recommended, but not required.

In the following example, the reporting Audit Filter specifies an Object Filter that includes all tables in the production and reporting databases:

&lt;&lt;code&gt;&gt;
INSERT INTO mysql.server_audit_filters (filtername, rule)
   VALUES (
       &#39;reporting&#39;,
       JSON_COMPACT(
          &#39;{
              &#34;log_tables&#34;: [
                  &#34;production.*&#34;,
                  &#34;reporting.*&#34;
              ]
          }&#39;
       )
    );
&lt;&lt;/code&gt;&gt;

When an Object Filter is specified at Audit Filter scope, it can contain embedded Event Filters. The following Event types support Object Filters:

* [[mariadb-enterprise-audit/#query-events|Query Events]]
* [[mariadb-enterprise-audit/#table-events|Table Events]]

In the following example, the reporting Audit Filter has been modified to include Event Filters on specific Query Event sub-classes and Table Event sub-classes:

&lt;&lt;code&gt;&gt;
INSERT INTO mysql.server_audit_filters (filtername, rule)
   VALUES (
       &#39;reporting&#39;,
       JSON_COMPACT(
          &#39;{
              &#34;log_tables&#34;: [
                  &#34;production.*&#34;,
                  &#34;reporting.*&#34;,
                  {
                     &#34;query_event&#34;: [
                         &#34;DML&#34;,
                         &#34;DDL&#34;
                     ],
                     &#34;table_event&#34;: [
                         &#34;WRITE&#34;,
                         &#34;CREATE&#34;,
                         &#34;DROP&#34;,
                         &#34;RENAME&#34;,
                         &#34;ALTER&#34;
                     ]
                  }
              ]
          }&#39;
       )
    );
&lt;&lt;/code&gt;&gt;

== Combine Object Filters at Audit Filter and Event Scope

When an Object Filter is specified at Audit Filter scope with embedded Event Filters, the embedded Event Filters can contain additional Object Filters. When you combine Object Filters at different levels, it is possible to combine Object Filters that are normally incompatible, like tables and ignore_tables.

To create Object Filters at Audit Filter and Event Type scope, specify the JSON object for the Object Filter at Audit Filter scope as part of the root JSON object for the Audit Filter and specify the JSON object for the Object Filter at Event Type scope as part of the JSON object for the Event Filter.

The examples below pass the JSON object to the [[json_compact|JSON_COMPACT()]] function, so that the JSON object is compacted prior to being inserted into the system table. This step is recommended, but not required.

In the following example, the reporting Audit Filter specifies an Event Filter for Table Events with an embedded Object Filter that includes all tables in the production and reporting databases, but it excludes Query Events that target specific tables that store Personally Identifiable Information (PII), so that the sensitive information does not appear in the audit log:

&lt;&lt;code&gt;&gt;
INSERT INTO mysql.server_audit_filters (filtername, rule)
   VALUES (
       &#39;reporting&#39;,
       JSON_COMPACT(
          &#39;{
              &#34;log_tables&#34;: [
                  &#34;production.*&#34;,
                  &#34;reporting.*&#34;,
                  {
                     &#34;table_event&#34;: [
                         &#34;WRITE&#34;,
                         &#34;CREATE&#34;,
                         &#34;DROP&#34;,
                         &#34;RENAME&#34;,
                         &#34;ALTER&#34;
                     ],
                     &#34;query_event&#34;: [
                         &#34;DML&#34;,
                         &#34;DDL&#34;,
                         {
                             &#34;ignore_tables&#34;: [
                                 &#34;production.customer_profiles&#34;,
                                 &#34;production.customer_addresses&#34;
                             ]
                         }
                     ]
                  }
              ]
          }&#39;
       )
    );
&lt;&lt;/code&gt;&gt;

= Audit Log Destinations

MariaDB Enterprise Audit writes audit log messages either to a dedicated audit log file or to the system log (syslog), depending on configuration.

The audit log destination is configured with the [[mariadb-audit-plugin-options-and-system-variables/#server_au|dit_output_type|server_audit_output_type]] system variable:

&lt;&lt;style class=&#34;darkheader-nospace-borders left&#34;&gt;&gt;
|= Value |= Description |
| [[mariadb-enterprise-audit/#audit-logging-to-file|FILE]]  | Audit log messages are written to a dedicated file. |
| [[mariadb-enterprise-audit/#audit-logging-to-system-log|SYSLOG]]  | Audit log messages are written to the system log (syslog). |
&lt;&lt;/style&gt;&gt;

= Audit Logging to File
MariaDB Enterprise Audit writes audit log messages to a dedicated audit log file when the  [[mariadb-audit-plugin-options-and-system-variables/#server_au|dit_output_type|server_audit_output_type]] system variable is set to FILE.

== Audit Log Path
The path to the dedicated audit log file is configured with the [[mariadb-audit-plugin-options-and-system-variables/#server_audit_file_path|server_audit_file_path]] system variable. The path can be a relative or absolute path. If it is a relative path, then it will be relative to the [[server-system-variables/#datadir|datadir]]. For example, to set the path to mariadb-enterprise-audit.log with the [[set|SET GLOBAL]] statement:

&lt;&lt;code&gt;&gt;
SET GLOBAL server_audit_file_path = &#39;mariadb-enterprise-audit.log&#39;
&lt;&lt;/code&gt;&gt;
When a system variable is dynamically changed with the [[set|SET GLOBAL]] statement, the change does not survive server restarts. To ensure that the new path is used when the server restarts, set the [[mariadb-audit-plugin-options-and-system-variables/#server_audit_file_path|server_audit_file_path]] system variable in a configuration file:

&lt;&lt;code&gt;&gt;
[mariadb]
server_audit_file_path=mariadb-enterprise-audit.log
&lt;&lt;/code&gt;&gt;

== Audit Log Rotation
When MariaDB Enterprise Audit is configured to use the dedicated audit log file, it can rotate the file.

The file is rotated when its size exceeds the size specified by the [[mariadb-audit-plugin-options-and-system-variables/#server_audit_file_rotate_size|server_audit_file_rotate_size]] system variable. For example, to set the maximum log size to 2 GB with the [[set|SET GLOBAL]] statement:

&lt;&lt;code&gt;&gt;
SET GLOBAL server_audit_file_rotate_size = 2 * (1024 * 1024 * 1024);
&lt;&lt;/code&gt;&gt;

When a system variable is dynamically changed with the [[set|SET GLOBAL]] statement, the change does not survive server restarts. To ensure that the new file rotation size is used when the server restarts, set the [[mariadb-audit-plugin-options-and-system-variables/#server_audit_file_rotate_size|server_audit_file_rotate_size]] system variable in a configuration file:

&lt;&lt;code&gt;&gt;
[mariadb]
...
server_audit_file_rotate_size=2147483648
&lt;&lt;/code&gt;&gt;

The file can also be rotated manually by setting the [[mariadb-audit-plugin-options-and-system-variables/#server_audit_file_rotate_now|server_audit_file_rotate_now]] system variable to ON. For example, to rotate the log with the [[set|SET GLOBAL]] statement:

&lt;&lt;code&gt;&gt;
SET GLOBAL server_audit_file_rotate_now = ON;
&lt;&lt;/code&gt;&gt;

= Audit Logging to System Log
MariaDB Enterprise Audit writes audit log messages to the system log (syslog) when the [[mariadb-audit-plugin-options-and-system-variables/#server_audit_output_type|server_audit_output_type]] system variable is set to SYSLOG.

It can be very useful to configure audit logging to the syslog when your system&#39;s syslog is configured to securely transmit logs to a remote syslog server.

== System Log Parameters
Several syslog parameters can be changed for MariaDB Enterprise Audit by setting the following system variables:

* [[mariadb-audit-plugin-options-and-system-variables/#server_audit_syslog_facility|server_audit_syslog_facility]]
* [[mariadb-audit-plugin-options-and-system-variables/#server_audit_syslog_ident|server_audit_syslog_ident]]
* [[mariadb-audit-plugin-options-and-system-variables/#server_audit_syslog_info|server_audit_syslog_info]]
* [[mariadb-audit-plugin-options-and-system-variables/#server_audit_syslog_priority|server_audit_syslog_priority]]

= Audit Log Format
The audit log format for MariaDB Enterprise Audit depends on the [[mariadb-enterprise-audit/#audit-log-destinations|audit log destination]].

== Audit Log Format with File
When MariaDB Enterprise Audit is configured to use a dedicated audit log file, it uses the following format for each line:

&lt;&lt;code&gt;&gt;
&lt;timestamp&gt;,&lt;serverhost&gt;,&lt;username&gt;,&lt;host&gt;,&lt;connectionid&gt;,&lt;queryid&gt;,&lt;operation&gt;,&lt;database&gt;,&lt;object&gt;,&lt;retcode&gt;
&lt;&lt;/code&gt;&gt;

== Audit Log Format with Syslog
When MariaDB Enterprise Audit is configured to use the syslog, it uses the following format for each line:

&lt;&lt;code&gt;&gt;
&lt;timestamp&gt; &lt;syslog_host&gt; &lt;syslog_ident&gt;: &lt;syslog_info&gt; &lt;serverhost&gt;,&lt;username&gt;,&lt;host&gt;,&lt;connectionid&gt;,&lt;queryid&gt;,&lt;operation&gt;,&lt;database&gt;,&lt;object&gt;,&lt;retcode&gt;
&lt;&lt;/code&gt;&gt;

= Messages in MariaDB Error Log
MariaDB Enterprise Audit writes messages to the MariaDB Error Log in various scenarios. Some of the scenarios and log messages are described below.

== Load Plugin
When MariaDB Enterprise Server loads the plugin for MariaDB Enterprise Audit, MariaDB Enterprise Audit writes the following message in the MariaDB error log:

&lt;&lt;code&gt;&gt;
2021-08-03 21:07:03 server_audit: MariaDB Audit Plugin version 2.0.3 STARTED.
&lt;&lt;/code&gt;&gt;
For additional information, see &#34;[[mariadb-enterprise-audit/#load-the-audit-plugin|Load the Audit Plugin]]&#34;.

== Unload Plugin
When MariaDB Enterprise Server unloads the plugin for MariaDB Enterprise Audit, MariaDB Enterprise Audit writes the following message in the MariaDB error log:

&lt;&lt;code&gt;&gt;
2021-08-02 23:54:59 server_audit: STOPPED
&lt;&lt;/code&gt;&gt;

The plugin is unloaded when MariaDB Enterprise Server is shutdown, so this message is most commonly written to the MariaDB error log during the shutdown process.

== Start Audit Logging to File
When audit logging is started and it is directed to a file, MariaDB Enterprise Audit writes the following message in the MariaDB error log:

&lt;&lt;code&gt;&gt;
2021-08-03 21:39:42 server_audit: logging started to the file server_audit.log.
&lt;&lt;\code&gt;&gt;

If a custom [[mariadb-enterprise-audit/#audit-log-path|audit log path]] is configured, then the message will refer to the custom path.

For additional information, see &#34;[[mariadb-enterprise-audit/#start-audit-logging|Start Audit Logging]]&#34; and &#34;[[mariadb-enterprise-audit/#audit-logging-to-file|Audit Logging to File]]&#34;.

== Start Audit Logging to Syslog
When audit logging is started and it is directed to syslog, MariaDB Enterprise Audit writes the following message in the MariaDB error log:
&lt;&lt;code&gt;&gt;

2021-08-03 22:02:45 server_audit: logging started to the syslog.
&lt;&lt;/code&gt;&gt;
For additional information, see &#34;[[mariadb-enterprise-audit/#start-audit-logging|Start Audit Logging]]&#34; and &#34;[[mariadb-enterprise-audit/#audit-logging-to-system-log|Audit Logging to Syslog]]&#34;.

== Stop Audit Logging
When audit logging is stopped, MariaDB Enterprise Audit writes the following message in the MariaDB error log:

&lt;&lt;code&gt;&gt;
2021-08-03 21:39:50 server_audit: logging was stopped.
&lt;&lt;/code&gt;&gt;

== Change Audit Logging to File
When audit logging is changed to a file, MariaDB Enterprise Audit writes the following message in the MariaDB error log:

&lt;&lt;code&gt;&gt;
2021-08-03 22:03:31 server_audit: Output was redirected to &#39;file&#39;
&lt;&lt;/code&gt;&gt;
For additional information, see &#34;[[mariadb-enterprise-audit/#audit-logging-to-file|Audit Logging to File]]&#34;.

== Change Audit Logging to Syslog
When audit logging is changed to syslog, MariaDB Enterprise Audit writes the following message in the MariaDB error log:

&lt;&lt;code&gt;&gt;
2021-08-03 22:01:22 server_audit: Output was redirected to &#39;syslog&#39;
&lt;&lt;/code&gt;&gt;
For additional information, see &#34;|[[mariadb-enterprise-audit/#audit-logging-to-system-logAudit Logging to Syslog]]&#34;.

== Change File Name for Audit Logging
When the file name for audit logging is changed, MariaDB Enterprise Audit writes the following message in the MariaDB error log:

&lt;&lt;code&gt;&gt;
2021-08-03 22:05:17 server_audit: Log file name was changed to &#39;mariadb-enterprise-audit.log&#39;.
&lt;&lt;/code&gt;&gt;

For additional information, see &#34;[[mariadb-enterprise-audit/#audit-log-path|Audit Log Path]]&#34;.

== Reload Invalid Audit Filters
When the Audit Filters are reloaded and one or more of the Audit Filters are invalid, MariaDB Enterprise Audit writes the following message in the MariaDB error log:

&lt;&lt;code&gt;&gt;
2021-08-03 21:51:55 server_audit: Unknown filter function tabels.
2021-08-03 21:51:55 server_audit: Can&#39;t parse filter&#39;s &#39;production&#39; definition { &#34;tabels&#34;: &#34;production.*&#34; }.
2021-08-03 21:51:55 server_audit: can&#39;t load filters - old filters are saved.
&lt;&lt;/code&gt;&gt;
For additional information, see &#34;[[mariadb-enterprise-audit/#reload-audit-filters-and-assignments|Reload Audit Filters and Assignments]]&#34;.

== Conflict with the Query Cache
If the query cache is enabled, READ Table Events may not be audit logged. If MariaDB Enterprise Audit detects during startup that the query cache is enabled, MariaDB Enterprise Audit writes the following message to the MariaDB error log:

&lt;&lt;code&gt;&gt;
2021-08-03 21:07:03 server_audit: Query cache is enabled with the TABLE events. Some table reads can be veiled.
&lt;&lt;/code&gt;&gt;

= Upgrades

MariaDB Enterprise Audit is included with MariaDB Enterprise Server. Special consideration is needed when upgrading from MariaDB releases that include the MariaDB Audit Plugin, including MariaDB Community Server (Any Version)

For details on how to upgrade from the MariaDB Audit Plugin to MariaDB Enterprise Audit, see the sections below.

== Update System Tables
After upgrading to MariaDB Enterprise Server, execute mariadb-upgrade to create the [[mariadb-enterprise-audit/#system-tables-for-audit-filters|System Tables for Audit Filters]].

== Migrate Audit Filters
The MariaDB Audit Plugin defines Audit Filters using the [[mariadb-audit-plugin-options-and-system-variables/#server_audit_events|server_audit_events system]] system variable, but MariaDB Enterprise Audit defines Audit Filters using the mysql.server_audit_filters system table.

If you are upgrading from the MariaDB Audit Plugin to MariaDB Enterprise Audit, perform the following procedure:

1. Remove or comment out lines involving the [[mariadb-audit-plugin-options-and-system-variables/#server_audit_events|server_audit_events system]] variable from the configuration file:

&lt;&lt;code&gt;&gt;
[mariadb]
...
# server_audit_events=CONNECT,QUERY
&lt;&lt;/code&gt;&gt;


2. Insert a replacement Audit Filter into the mysql.server_audit_filters system table:

&lt;&lt;code&gt;&gt;
INSERT INTO mysql.server_audit_filters
   VALUES (&#39;default&#39;,
      JSON_COMPACT(
         &#39;{
            &#34;connect_event&#34;: &#34;ALL&#34;,
            &#34;query_event&#34;: &#34;ALL&#34;
         }&#39;
      ));
&lt;&lt;/code&gt;&gt;
The example passes the JSON object to the [[json_compact|JSON_COMPACT()]] function, so that the JSON object is compacted prior to being inserted into the system table. This step is recommended, but not required.

== Migrate Users
The MariaDB Audit Plugin enables or disable audit logging for specific user accounts using the [[mariadb-audit-plugin-options-and-system-variables/#server_audit_incl_users|server_audit_incl_users]] and [[mariadb-audit-plugin-options-and-system-variables/#server_audit_excl_users|server_audit_excl_users]] system variables, but MariaDB Enterprise Audit uses the mysql.server_audit_users system table.

If you are upgrading from the MariaDB Audit Plugin to MariaDB Enterprise Audit, perform the following procedure:

1. Remove or comment out lines involving the [[mariadb-audit-plugin-options-and-system-variables/#server_audit_incl_users|server_audit_incl_users]] and [[mariadb-audit-plugin-options-and-system-variables/#server_audit_excl_users|server_audit_excl_users]]  system variables from the configuration file:

&lt;&lt;code&gt;&gt;
[mariadb]
...
# server_audit_incl_users = root,app
# server_audit_excl_users = backup_user,monitor_user
&lt;&lt;/code&gt;&gt;

2. For any user account previously mentioned in the  [[mariadb-audit-plugin-options-and-system-variables/#server_audit_incl_users|server_audit_incl_users]] system variable, determine if the user account can use the [[mariadb-enterprise-audit/#default-audit-filter|Default Audit Filter]] or if the user account requires a [[mariadb-enterprise-audit/#named-audit-filters|Named Audit Filter]].

Insert the relevant Audit Filters into the the mysql.server_audit_filters system table, and insert the user assignments into the mysql.server_audit_users system table:

&lt;&lt;code&gt;&gt;
INSERT INTO mysql.server_audit_filters
   VALUES
   (&#39;default&#39;,
      JSON_COMPACT(
         &#39;{
            &#34;connect_event&#34;: [
               &#34;CONNECT&#34;,
               &#34;DISCONNECT&#34;
            ],
            &#34;query_event&#34;: [
               &#34;DML&#34;,
               &#34;DDL&#34;
            ]
         }&#39;
   )),
   (&#39;root_filter&#39;,
      JSON_COMPACT(
         &#39;{
            &#34;logging&#34;: &#34;ON&#34;
         }&#39;
   ));
INSERT INTO mysql.server_audit_users (host, user, filtername)
   VALUES (&#39;%&#39;, &#39;root&#39;, &#39;root_filter&#39;);
&lt;&lt;/code&gt;&gt;

The example passes the JSON object to the [[json_compact|JSON_COMPACT()]] function, so that the JSON object is compacted prior to being inserted into the system table. This step is recommended, but not required.

3. For any user account previously mentioned in the [[mariadb-audit-plugin-options-and-system-variables/#server_audit_excl_users|server_audit_excl_users]] system variable, create a [[mariadb-enterprise-audit/#named-audit-filters|Named Audit Filter]] that acts as an exclusion filter.

Insert the relevant Audit Filters into the the mysql.server_audit_filters system table, and insert the user assignments into the mysql.server_audit_users system table:

&lt;&lt;code&gt;&gt;
INSERT INTO mysql.server_audit_filters
   VALUES (&#39;exclusion_filter&#39;,
      JSON_COMPACT(
         &#39;{
            &#34;logging&#34;: &#34;OFF&#34;
         }&#39;
      ));

INSERT INTO mysql.server_audit_users (host, user, filtername)
   VALUES
   (&#39;%&#39;, &#39;backup_user&#39;, &#39;exclusion_filter&#39;),
   (&#39;%&#39;, &#39;monitor_user&#39;, &#39;exclusion_filter&#39;);

&lt;&lt;/code&gt;&gt;</textarea>
    


                    <div id="content_disclaimer" class="graybox">
                        Content reproduced on this site is the property of its respective owners,
                        and this content is not reviewed in advance by MariaDB. The views, information and opinions
                        expressed by this content do not necessarily represent those of MariaDB or any other party.
                    </div>
                </div>
            </section>

            
        </div>
    </div>
</div>

<!-- Footer -->
<footer id="footer">
    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-xs-12">
                    <ul class="list-inline text-center footer-nav">
                        <li>
                            <h5>
                                <a href="https://mariadb.com/products" title="Products">Products</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/solutions" title="Solutions">Solutions</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/resources" title="Resources">Resources</a>
                            </h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/about-us" title="About MariaDB">Company</a></h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/pricing" title="Pricing">Pricing</a>
                            </h5>
                        </li>
                        
                        
                        <li>
                            <h5><a href="https://mariadb.com/downloads" title="Download">Download MariaDB</a></h5>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="row row-10">
                
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div id="block-footerformcontact" class="block block-block-content block-block-contentd754ee1b-3cc9-40e7-9ef4-f504f1197fb1">
                        
                            <h5 style="font-weight: 400;">Subscribe to our newsletter!</h5>
                            <script src="//app-sj15.marketo.com/js/forms2/js/forms2.min.js"></script><form id="mktoForm_1498"></form>
                            <script>
                                <!--//--><![CDATA[// ><!--
                                MktoForms2.loadForm("//app-sj15.marketo.com", "573-PXI-984", 1498);
                                //--><!]]]]><![CDATA[>
                                //--><!]]>
                            </script>
                        
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div class="footer-copyright">
                        <div class="text-center">
                            <ul class="list-inline no-margin">
                                <li>
                                    <a href="/legal" title="Legal">Legal</a>
                                </li>
                                <li>
                                    <a href="/privacy-policy" title="Privacy Policy">Privacy Policy</a>
                                </li>
                                <li>
                                    <a href="/cookie-policy/" title="Cookies">Cookie Policy</a>
                                </li>
                            </ul>
                            <p>Copyright &copy; 2025 MariaDB. All rights reserved.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</footer>
</div>

<div id="ajax_loading">
    <img src="/kb/static/images/ajax-loader.a51c5608d01a.gif" />
</div>

    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MK2847"
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MK2847');</script>
    <!-- End Google Tag Manager -->

</body>

<script type="text/javascript" src="/kb/static/js/main.1587e3a666fc.js" charset="utf-8"></script>

</html>