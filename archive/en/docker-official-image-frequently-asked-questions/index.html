<!DOCTYPE html>
<html>
<head data-cookie-domain=""
      data-cookie-path="/">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="apple-touch-icon" sizes="180x180" href="/kb/static/images/favicons/apple-touch-icon.159e713979be.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/kb/static/images/favicons/favicon-32x32.bc0ac1d5d11e.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/kb/static/images/favicons/favicon-16x16.5801f8f0f34e.png">
    <link rel="shortcut icon" href="/kb/static/images/favicons/favicon.d122d305dee4.ico" type="image/x-icon" />

    <title>Docker Official Image Frequently Asked Questions - MariaDB Knowledge Base</title>

    <link href="/kb/static/css/main.f7633538c846.css" rel="stylesheet" type="text/css" />

    

    

    <!-- FB Open Graph tags -->
    <meta property="og:title" content="Docker Official Image Frequently Asked Questions" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://mariadb.com/kb/en/docker-official-image-frequently-asked-questions/" />
    <meta property="og:image" content="http://mariadb.comaskmonty-logo.png" />
    <meta property="og:site_name" content="MariaDB KnowledgeBase" />
    <meta property="fb:admins" content="514852603" />
    <meta property="og:description" content="Frequently asked questions about the Docker Official Image." />

    <meta name="description" content="Frequently asked questions about the Docker Official Image." />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet"/>
    
</head>
<body class="mpkb nodes products nodes_view jqui" id="nodes_view">





<div id="menu-mobile" class="visible-sm visible-xs">

    <div>
        <div id="mobile-close-menu" class="text-right">
            <a href="javascript:void(0)" title="Close Menu" id="back-main" class="toggle-menu">X<span></span></a>
        </div>
    </div>
    <div class="mainmenu-mobile">
        <ul class="ls-none ul-menu">
            <li data-sub="submenu5"><a class="open-form-search" href="/kb/search/" title="Search">Search </a></li>
            <li data-sub="submenu0"><a href="/products" title="Products">Products</a><span class="arrow-main"></span></li>
            <li data-sub="submenu1"><a href="/services" title="Services">Services</a><span class="arrow-main"></span></li>
            <li data-sub="submenu2"><a href="/resources" title="Resources">Resources</a><span class="arrow-main"></span></li>
            <li data-sub="submenu3"><a href="/about-us" title="About">About</a><span class="arrow-main"></span></li>
            <li data-sub="submenu4"><a href="/contact" title="Contact">Contact</a></li>
        </ul>
    </div>

    <div class="nav-top-mobile">
        <div class="select-box form">

            <ul class="inline-block-md mb-none top-nav">
                <li>

                </li>
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/docker-official-image-frequently-asked-questions/"> Login</a>
                    </li>
                
            </ul>



        </div>
        <p class="text-center copyright">Copyright &copy; 2025 MariaDB. All rights reserved.</p>
    </div>
</div>
<div class="violator-wrap d-none" id="top_violator">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12">
                <div class="violator-outer">
                    <div class="violator-inner">
                        <div class="row">
                            <div class="col-xs-12 col-sm-9 col-lg-7 col-lg-offset-2" id="top_violator_content">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="content-link" target="_blank" rel="nofollow noreferrer">
                                    <span>The Ultimate Guide to High Availability with MariaDB</span>
                                </a>
                            </div>
                            <div class="col-xs-12 col-sm-3" id="top_violator_cta">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="btn btn-mariadb" target="_blank" rel="nofollow noreferrer">Download Now</a>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-link close-btn">
                        <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24" width="15px" height="15px"><path d="M 4.9902344 3.9902344 A 1.0001 1.0001 0 0 0 4.2929688 5.7070312 L 10.585938 12 L 4.2929688 18.292969 A 1.0001 1.0001 0 1 0 5.7070312 19.707031 L 12 13.414062 L 18.292969 19.707031 A 1.0001 1.0001 0 1 0 19.707031 18.292969 L 13.414062 12 L 19.707031 5.7070312 A 1.0001 1.0001 0 0 0 18.980469 3.9902344 A 1.0001 1.0001 0 0 0 18.292969 4.2929688 L 12 10.585938 L 5.7070312 4.2929688 A 1.0001 1.0001 0 0 0 4.9902344 3.9902344 z"/></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="wrapper">
<div id="top-nav">
    <div class="container">
        <ul class="hidden-sm hidden-xs" >
            <li><a href="https://mariadb.com/kb/">Knowledge Base</a></li>
            <li><a href="https://mariadb.com/contact/">Contact</a></li>
            
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/docker-official-image-frequently-asked-questions/" rel="nofollow">Login</a>
                    </li>
                
            
            
            <li id="search-form">
                <form action="/kb/en/+search/" method="get" id="search-block-form" accept-charset="UTF-8">
                    <input id="search" title="Enter the terms you wish to search for."
                           placeholder="Search . . ." type="text"
                           name="q" value="" size="15" maxlength="128" class="form-text"
                           data-autocomplete-url="/kb/en/+search/autocomplete/">
                    <input type="hidden" name="quick" value="1" />
                    <input type="hidden" name="source" value="kb" />
                </form>
            </li>
            <li><a id="search-toggler" href="/kb/search/">Search</a></li>
            
        </ul>
    </div>
</div>
<div id="navbar-bottom" class="navbar">
    <div class="container">
        
        
        
        
        <div class="row">
            <div class="col-md-3 col-sm-9 col-xs-9">
                <a class="brand" href="/" title="MariaDB">
                    <img src="/kb/static/images/logo-2018-black.95f5978ae14d.png">
                </a>
            </div>
            <div class="col-md-9 hidden-sm hidden-xs">
                <div class="main-menu">
                    <ul id="main-menu" class="nav navbar-nav inline-block-sm">
    <li class="has-sub full-menu">
        <a href="/products" title="Products">Products</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/services" title="Services">Services</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/pricing" title="Pricing">Pricing</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/resources" title="Resources">Resources</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/about-us" title="About Us">About Us</a>
    </li>
    <li class="">
        <a class="button electric-eel small top-bar-right-download" href="/downloads/">Download</a>
    </li>
</ul>
                </div>
            </div>
            <div class="col-md-3 visible-sm visible-xs col-sm-3 col-xs-3 ps-rv">
                <div class="navbar-header text-right pull-right">
                    <button type="button" class="menu-control toggle-menu" id="open-menu">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="main">
    <div class="container">
        

        <div id="subheader1" class="clearfix">
            <div class="pull-left">
                
                <div id="breadcrumbs" class="breadcrumb">
                    <a href="/kb/en/">Knowledge Base</a>
                    


    
    » <a class="crumb" href="/kb/en/documentation/">MariaDB Server Documentation</a>
    

    
    » <a class="crumb" href="/kb/en/mariadb-administration/">MariaDB Administration</a>
    

    
    » <a class="crumb" href="/kb/en/getting-installing-and-upgrading-mariadb/">Getting, Installing, and Upgrading MariaDB</a>
    

    
    » <a class="crumb" href="/kb/en/binary-packages/">MariaDB Binary Packages</a>
    

    
    » <a class="crumb" href="/kb/en/automated-mariadb-deployment-and-administration/">Automated MariaDB Deployment and Administration</a>
    

    
    » <a class="crumb" href="/kb/en/docker-and-mariadb/">MariaDB Containers</a>
    


    » <a class="node_link crumb" href="/kb/en/docker-official-image-frequently-asked-questions/">Docker Official Image Frequently Asked Questions</a>


                </div>
                
            </div>
        </div>
    </div>
    <div class="container" id="container-main">
        <div class="row">
            
            
                
                <aside id="sidebar-first" class="sidebar col-md-2 hidden-xs hidden-sm hidden-print">
                    
                        
                        <ul id="category_menu" class="nav nav-pills nav-stacked">
                            <li><a href="/kb/en/">Home</a></li>
                            
                                
                                    <li><a href="/kb/en/+questions/">Open Questions</a></li>
                                
                                <li><a href="/kb/en/documentation/">MariaDB Server</a></li>
                                <li><a href="/kb/en/maxscale/">MariaDB MaxScale</a></li>
                                <li><a href="/kb/en/mariadb-columnstore/">MariaDB ColumnStore</a></li>
                                <li><a href="/kb/en/connectors/">Connectors</a></li>
                            

                        </ul>
                    

                    
<div>



<div class="well well-small box actions"><div>

        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/docker-official-image-frequently-asked-questions/+history" rel="nofollow">History</a>
        
        
        
        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/docker-official-image-frequently-asked-questions/+source/">Source</a>
        
        <a class="btn btn-block btn-blue btn-sm flag" href="/kb/en/docker-official-image-frequently-asked-questions/+flag"
                data-flag-url="/kb/en/docker-official-image-frequently-asked-questions/+flag" rel="nofollow">
                Flag as Spam / Inappropriate</a>
        
        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/docker-official-image-frequently-asked-questions/+translate/">
                Translate</a>
        

</div>
</div>





<div class="well well-small box node_info"><div>

    <dl>
        <dt>Created</dt>
        <dd>

<span class="datetime" title="2023-09-21 23:24">1 year, 3 months ago</span></dd>

        <dt>Modified</dt>
        <dd>

<span class="datetime" title="2024-08-19 03:27">4 months, 2 weeks ago</span></dd>

        <dt>Type</dt>
        <dd>article</dd>

        <dt>Status</dt>
        <dd>active</dd>

        <dt>License</dt>
        <dd>
            
                <a href="/kb/en/docker-official-image-frequently-asked-questions/+license/">CC BY-SA / Gnu FDL</a>
            
        </dd>

        
    </dl>

    
    <ul class="rss_feeds">
        <li><a href="/kb/en/docker-official-image-frequently-asked-questions/+history/feed/">
            History</a>
        </li>
        <li><a href="/kb/en/docker-official-image-frequently-asked-questions/+comments/feed/">
            Comments</a>
        </li>
    </ul>
    

</div>
</div>





    
    
    

<div class="well well-small box attachments"><div><div class="edit_link pull-right"><a href="/kb/en/docker-official-image-frequently-asked-questions/+edit/attachments/">Edit</a></div><h5>Attachments</h5></div><div>

        
            <div class="no_data">No attachments exist</div>
        
    
</div>
</div>

    



    
    






</div>


                    

































                </aside>
            
            
            
                
            
            
                
            
            <section id="content" class="limited_width col-md-8 clearfix">
                
                    <h1>Docker Official Image Frequently Asked Questions</h1>
                

                



                <div>
                    
    

    
    
    

    <div class="node creole">
        
            <div class="cta">
                <div style="background: #C0E1E3;padding: 15px 25px;margin-bottom: 20px;border-radius:30px;">
        
    <div class="row">
        <div class="col-md-12 text-center">
            <h2 class="h3" style="font-size: 18px;">See MariaDB and Docker in action!</h2>
            
            <ul style="list-style: none;">
                
                <li>Set up web-based developer environments locally, and connect MariaDB to VS Code Server, CloudBeaver, PHP/Laravel and phpMyAdmin, using a single docker-compose command and configuration file.</li>
            </ul>
    <a class="btn btn-primary btn-lg" href="https://go.mariadb.com/24Q2-WBN-GLBL-2024-02-22-Develop-via-Docker_Registration-LP.html?utm_source=onpagepromo&utm_medium=kb&utm_campaign=webinar-develop-via-docker" style="padding: 12px 50px;margin-top: 15px;margin-bottom: 10px;" target="_blank">Watch the Webinar</a>
        </div>
        
    </div>
    </div>
            </div>
        
        
        


    
    <div class="answer formatted">
        <div class="table_of_contents well well-small">
<h3>Contents</h3>
 <ol class="toc">

    <li class=""><a href="#how-to-reset-passwords" title="How to Reset Passwords">How to Reset Passwords</a></li>

    <li class=""><a href="#temp-server-start-timeout" title="Temp Server Start Timeout">Temp Server Start Timeout</a></li>

    <li class=""><a href="#creating-a-replication-pair" title="Creating a replication pair">Creating a replication pair</a></li>

    <li class=""><a href="#event-scheduler-an-error-occurred-when-initializing-system-tables-disabling-the-event-scheduler" title="Event Scheduler: An error occurred when initializing system tables. Disabling the Event Scheduler.">Event Scheduler: An error occurred when initializing system tables. Disabling the Event Scheduler.</a></li>

    <li class=""><a href="#innodb-upgrade-after-a-crash-is-not-supported-the-redo-log-was-created-with-mariadb-xyz" title="InnoDB: Upgrade after a crash is not supported. The redo log was created with MariaDB X.Y.Z">InnoDB: Upgrade after a crash is not supported. The redo log was created with MariaDB X.Y.Z</a></li>

    <li class=""><a href="#every-mariadb-start-gives-permission-denied-messages" title="Every MariaDB start gives permission denied messages">Every MariaDB start gives permission denied messages</a></li>

    <li class=""><a href="#bad-magic-header-in-tc-log" title="Bad magic header in tc log">Bad magic header in tc log</a></li>

    <li class=""><a href="#every-mariadb-start-is-a-crash-recovery" title="Every MariaDB start is a crash recovery">Every MariaDB start is a crash recovery</a></li>

    <li class=""><a href="#how-do-i-create-a-mariadb-backup-of-the-data" title="How do I create a MariaDB-backup of the data?">How do I create a MariaDB-backup of the data?</a></li>

    <li class=""><a href="#how-do-i-restore-from-a-mariadb-backup" title="How do I restore from a MariaDB-backup">How do I restore from a MariaDB-backup</a></li>

    <li class=""><a href="#how-to-start-mariadb-with-apptainer" title="How to start MariaDB with Apptainer">How to start MariaDB with Apptainer</a></li>

    <li class=""><a href="#why-does-the-mariadb-container-start-as-root" title="Why does the MariaDB container start as root?">Why does the MariaDB container start as root?</a></li>

    <li class=""><a href="#can-i-run-the-mariadb-container-as-an-arbitrary-user" title="Can I run the MariaDB container as an arbitrary user?">Can I run the MariaDB container as an arbitrary user?</a> </ol>
</li>
</div><p>
Frequently asked questions about the Docker Official Image</p>
<h2 class="anchored_heading" id="how-to-reset-passwords">How to Reset Passwords</h2>
<p>If you have an existing data directory and wish to reset the root and user passwords, and to create a database which the user can fully modify, perform the following steps.</p>
<p>First create a `passwordreset.sql` file:</p>
<pre class="fixed">CREATE USER IF NOT EXISTS root@localhost IDENTIFIED BY 'thisismyrootpassword';
SET PASSWORD FOR root@localhost = PASSWORD('thisismyrootpassword');
GRANT ALL ON *.* TO root@localhost WITH GRANT OPTION;
GRANT PROXY ON ''@'%' ON root@localhost WITH GRANT OPTION;
CREATE USER IF NOT EXISTS root@'%' IDENTIFIED BY 'thisismyrootpassword';
SET PASSWORD FOR root@'%' = PASSWORD('thisismyrootpassword');
GRANT ALL ON *.* TO root@'%' WITH GRANT OPTION;
GRANT PROXY ON ''@'%' ON root@'%' WITH GRANT OPTION;
CREATE USER IF NOT EXISTS myuser@'%' IDENTIFIED BY 'thisismyuserpassword';
SET PASSWORD FOR myuser@'%' = PASSWORD('thisismyuserpassword');
CREATE DATABASE IF NOT EXISTS databasename;
GRANT ALL ON databasename.* TO myuser@'%';
</pre><p>Adjust `myuser`, `databasename` and passwords as needed.</p>
<p>Then:</p>
<pre class="fixed">$ docker run --rm -v /my/own/datadir:/var/lib/mysql -v /my/own/passwordreset.sql:/passwordreset.sql:z %%IMAGE%%:latest --init-file=/passwordreset.sql
</pre><p>On restarting the MariaDB container in this `/my/own/datadir`, the `root` and `myuser` passwords will be reset.</p>
<h2 class="anchored_heading" id="temp-server-start-timeout">Temp Server Start Timeout</h2>
<p>Question, are you getting errors like the following where a temporary server start fails to succeed in 30 seconds?</p>
<p>Example of log:</p>
<pre class="fixed">2023-01-28 12:53:42+00:00 [Note] [Entrypoint]: Starting temporary server
2023-01-28 12:53:42+00:00 [Note] [Entrypoint]: Waiting for server startup
2023-01-28 12:53:42 0 [Note] mariadbd (server 10.10.2-MariaDB-1:10.10.2+maria~ubu2204) starting as process 72 ...
....
2023-01-28 12:53:42 0 [Note] InnoDB: Setting file './ibtmp1' size to 12.000MiB. Physically writing the file full; Please wait ...
2023-01-28 12:54:13 0 [Note] mariadbd: ready for connections.
Version: '10.10.2-MariaDB-1:10.10.2+maria~ubu2204'  socket: '/run/mysqld/mysqld.sock'  port: 0  mariadb.org binary distribution
2023-01-28 12:54:13+00:00 [ERROR] [Entrypoint]: Unable to start server.
</pre><p>The timeout on a temporary server start is a quite generous 30 seconds.</p>
<p>The lack of a message like the following indicates it failed to complete writing a temporary file of 12MiB in 30 seconds. </p>
<pre class="fixed">2023-01-28 12:53:46 0 [Note] InnoDB: File './ibtmp1' size is now 12.000MiB.
</pre><p>If the datadir where this is stored is remote storage maybe it's a bit slow. It's ideal to have an InnoDB temporary path local so this can be configured using the command or configuration setting:</p>
<pre class="fixed">innodb_temp_data_file_path=/dev/shm/ibtmp1:12M:autoextend
</pre><p>Note: depending on container runtime this space may be limited.</p>
<h2 class="anchored_heading" id="creating-a-replication-pair">Creating a replication pair</h2>
<p>`MARIADB_REPLICATION_USER` / `MARIADB_REPLICATION_PASSWORD` specify the authentication for the connection. The `MARIADB_MASTER_HOST` is the indicator that it is a replica and specifies the container aka hostname, of the master.</p>
<p>A `docker-compose.yml` example:</p>
<pre class="fixed">version: &#34;3&#34;
services:
  master:
    image: mariadb:latest
    command: --log-bin --log-basename=mariadb
    environment:
      - MARIADB_ROOT_PASSWORD=password
      - MARIADB_USER=testuser
      - MARIADB_PASSWORD=password
      - MARIADB_DATABASE=testdb
      - MARIADB_REPLICATION_USER=repl
      - MARIADB_REPLICATION_PASSWORD=replicationpass
    healthcheck:
      test: [&#34;CMD&#34;, &#34;healthcheck.sh&#34;, &#34;--connect&#34;, &#34;--innodb_initialized&#34;]
      interval: 10s
      timeout: 5s
      retries: 3
  replica:
    image: mariadb:latest
    command: --server-id=2 --log-basename=mariadb
    environment:
      - MARIADB_ROOT_PASSWORD=password
      - MARIADB_MASTER_HOST=master
      - MARIADB_REPLICATION_USER=repl
      - MARIADB_REPLICATION_PASSWORD=replicationpass
      - MARIADB_HEALTHCHECK_GRANTS=REPLICA MONITOR
    healthcheck:
      test: [&#34;CMD&#34;, &#34;healthcheck.sh&#34;, &#34;--connect&#34;, &#34;--replication_io&#34;, &#34;--replication_sql&#34;, &#34;--replication_seconds_behind_master=1&#34;, &#34;--replication&#34;]
      interval: 10s
      timeout: 5s
      retries: 3
    depends_on:
      master:
        condition: service_healthy
</pre><h2 class="anchored_heading" id="event-scheduler-an-error-occurred-when-initializing-system-tables-disabling-the-event-scheduler">Event Scheduler: An error occurred when initializing system tables. Disabling the Event Scheduler.</h2>
<p>This will show up in the container log as:</p>
<pre class="fixed">2024-01-29 17:38:13 0 [ERROR] Incorrect definition of table mysql.event: expected column 'definer' at position 3 to have type varchar(, found type char(141).
2024-01-29 17:38:13 0 [ERROR] mariadbd: Event Scheduler: An error occurred when initializing system tables. Disabling the Event Scheduler.
</pre><p>The cause is the underlying table has change structure from the last MariaDB version.  The easiest solution to this is to start the container with the environment variable <a href="/kb/en/mariadb-server-docker-official-image-environment-variables/#mariadb_auto_upgrade-mariadb_disable_upgrade_backup">MARIADB_AUTO_UPGRADE=1</a> and system tables will be updated. This is safe to keep on as it detects the version installed. The next start should not show this error.</p>
<h2 class="anchored_heading" id="innodb-upgrade-after-a-crash-is-not-supported-the-redo-log-was-created-with-mariadb-xyz">InnoDB: Upgrade after a crash is not supported. The redo log was created with MariaDB X.Y.Z</h2>
<p>This will show up in the error log as:</p>
<pre class="fixed">2022-05-23 12:29:20 0 [ERROR] InnoDB: Upgrade after a crash is not supported. The redo log was created with MariaDB 10.5.4.
2022-05-23 12:29:20 0 [ERROR] InnoDB: Plugin initialization aborted with error Generic error
</pre><p>This is attempting to start on a higher MariaDB version when the shutdown of the previous version crashed.</p>
<p>By crashed, it means the MariaDB was force killed or had a hard power failure. MariaDB, being a durable database, can recover from these, if started with the same version. The redo log however is a less stable format, so the recovery has to be on the same Major.Minor version, in this case 10.5. This error message is saying that you when from force killed MariaDB to a later version.</p>
<p>So whenever you encounter this message. Start with the again with the tag set to the version in the error message, like 10.5.4, or as the redo long format is consistent in the Major.Minor version 10.5 is sufficient. After this has been started correctly, cleanly shut the service down and it will be recovered.</p>
<p>The logs on shutdown should have a message like:</p>
<pre class="fixed">2023-11-06 10:49:23 0 [Note] InnoDB: Shutdown completed; log sequence number 84360; transaction id 49
2023-11-06 10:49:23 0 [Note] mariadbd: Shutdown complete
</pre><p>After you see this, you can update your MariaDB tag to a later version.</p>
<h2 class="anchored_heading" id="every-mariadb-start-gives-permission-denied-messages">Every MariaDB start gives permission denied messages</h2>
<pre class="fixed">2024-02-06 03:03:18+00:00 [Note] [Entrypoint]: Entrypoint script for MariaDB Server 1:10.11.6+maria~ubu2204 started.
/usr/local/bin/docker-entrypoint.sh: line 600: /var/lib/mysql//mysql_upgrade_info: Permission denied
2024-02-06 03:03:18+00:00 [Note] [Entrypoint]: MariaDB upgrade (mariadb-upgrade) required, but skipped due to $MARIADB_AUTO_UPGRADE setting
2024-02-06  3:03:18 0 [Warning] Can't create test file '/var/lib/mysql/80a2bb81d698.lower-test' (Errcode: 13 &#34;Permission denied&#34;)
2024-02-06  3:03:18 0 [Note] Starting MariaDB 10.11.6-MariaDB-1:10.11.6+maria~ubu2204 source revision fecd78b83785d5ae96f2c6ff340375be803cd299 as process 1
2024-02-06  3:03:18 0 [ERROR] mariadbd: Can't create/write to file './ddl_recovery.log' (Errcode: 13 &#34;Permission denied&#34;)
2024-02-06  3:03:18 0 [ERROR] DDL_LOG: Failed to create ddl log file: ./ddl_recovery.log
2024-02-06  3:03:18 0 [ERROR] Aborting
</pre><p>Or:</p>
<pre class="fixed">2024-08-16  4:54:05 0 [ERROR] InnoDB: Operating system error number 13 in a file operation.
2024-08-16  4:54:05 0 [ERROR] InnoDB: The error means mariadbd does not have the access rights to the directory.
</pre><p>In this case, the container is running as a user that, inside the container, does not have write permissions on the datadir <code>/var<em>lib/mysql</em></code>.</p>
<h2 class="anchored_heading" id="bad-magic-header-in-tc-log">Bad magic header in tc log</h2>
<p>From the <a href="/kb/en/transaction-coordinator-log-overview/#bad-magic-header-in-tc-log">transaction coordinator log</a> this is a corrupted file. This will have a log message like the following:</p>
<pre class="fixed">2024-05-21  8:55:58 0 [Note] Recovering after a crash using tc.log
2024-05-21  8:55:58 0 [ERROR] Bad magic header in tc log
2024-05-21  8:55:58 0 [ERROR] Crash recovery failed. Either correct the problem (if it's, for example, out of memory error) and restart, or delete tc log and start server with --tc-heuristic-recover={commit|rollback}
2024-05-21  8:55:58 0 [ERROR] Can't init tc log
2024-05-21  8:55:58 0 [ERROR] Aborting
</pre><p>The cause of this is headed by the first not, its a crash recovery. Like the <a href="#every-mariadb-start-is-a-crash-recovery">Every MariaDB start is a crash recovery</a> answer below, this is an indication that MariaDB wasn't given enough time by the container runtime to shutdown cleanly. While MariaDB was shutdown, the new version that was started is a newer MariaDB and doesn't recognise the updated magic information in the header.</p>
<p>MariaDB should always perform crash recovery with the same version that actually crashed, the same major/minor number at least.</p>
<p>As such the solution is to restart the container with the previous MariaDB version that was running, and configure the container runtime to allow a longer stop time. See the  <a href="#every-mariadb-start-is-a-crash-recovery">Every MariaDB start is a crash recovery</a> answer below to see if the timeout is sufficiently extended.</p>
<h2 class="anchored_heading" id="every-mariadb-start-is-a-crash-recovery">Every MariaDB start is a crash recovery</h2>
<p>Do you get on every start:</p>
<pre class="fixed">db-1  | 2023-02-25 19:10:02 0 [Note] Starting MariaDB 10.11.2-MariaDB-1:10.11.2+maria~ubu2204-log source revision cafba8761af55ae16cc69c9b53a341340a845b36 as process 1                                                                                                         
db-1  | 2023-02-25 19:10:02 0 [Note] mariadbd: Aria engine: starting recovery                                                                                                                                                                                                   
db-1  | tables to flush: 3 2 1 0                                                                                                                                                                                                                                                
db-1  |  (0.0 seconds);                                                                                                                                                                                                                                                         
db-1  | 2023-02-25 19:10:02 0 [Note] mariadbd: Aria engine: recovery done  
...
db-1  | 2023-02-26 13:03:29 0 [Note] InnoDB: Initializing buffer pool, total size = 32.000GiB, chunk size = 512.000MiB
db-1  | 2023-02-26 13:03:29 0 [Note] InnoDB: Completed initialization of buffer pool
db-1  | 2023-02-26 13:03:29 0 [Note] InnoDB: File system buffers for log disabled (block size=512 bytes)
db-1  | 2023-02-26 13:03:29 0 [Note] InnoDB: Starting crash recovery from checkpoint LSN=193796878816
</pre><p>Container runtimes are assume to start and stop very quickly. Check the the shutdown logs. They may be a log like:</p>
<pre class="fixed">db-1  | 2023-02-26 13:03:17 0 [Note] InnoDB: Starting shutdown...                                                                                                                                                                                                               
db-1  | 2023-02-26 13:03:17 0 [Note] InnoDB: Dumping buffer pool(s) to /var/lib/mysql/ib_buffer_pool                                                                                                                                                                            
db-1  | 2023-02-26 13:03:17 0 [Note] InnoDB: Restricted to 519200 pages due to innodb_buf_pool_dump_pct=25                                                                                                                                                                      
db-1  | 2023-02-26 13:03:17 0 [Note] InnoDB: Buffer pool(s) dump completed at 230226 13:03:17                                                                                                                                                                                   
db-1 exited with code 0
</pre><p>Note that the logs didn't include the following messages:</p>
<pre class="fixed">db-1  | 2023-02-26 13:03:43 0 [Note] InnoDB: Shutdown completed; log sequence number 46590; transaction id 15
db-1  | 2023-02-26 13:03:43 0 [Note] mariadbd: Shutdown complete
</pre><p>As these messages aren't here, the container was killed off before it could just down cleanly. When this happens, the startup will be a crash recovery and you won't be able to upgrade your MariaDB instance (previous FAQ) to the next Major.Minor version.</p>
<p>Solution is to extend the timeout in the container runtime to allow MariaDB to complete its shutdown.</p>
<h2 class="anchored_heading" id="how-do-i-create-a-mariadb-backup-of-the-data">How do I create a MariaDB-backup of the data?</h2>
<pre class="fixed">docker volume create backup
docker run --name mdb -v backup:/backup -v datavolume:/var/lib/mysql mariadb
docker exec mdb mariadb-backup --backup --target-dir=/backup/d --user root --password soverysecret
docker exec mdb mariadb-backup --prepare --target-dir=/backup/d
docker exec mdb sh -c '[ ! -f /backup/d/.my-healthcheck.cnf ] &amp;&amp; cp /var/lib/mysql/.my-healthcheck.cnf /backup/d'
docker exec --workdir /backup/d mdb tar -Jcf ../backup.tar.xz .
docker exec mdb  rm -rf /backup/d
</pre><h2 class="anchored_heading" id="how-do-i-restore-from-a-mariadb-backup">How do I restore from a MariaDB-backup</h2>
<p>With the backup prepared like previously:</p>
<pre class="fixed">docker run -v backup:/docker-entrypoint-initdb.d -v newdatavolume:/var/lib/mysql mariadb
</pre><h2 class="anchored_heading" id="how-to-start-mariadb-with-apptainer">How to start MariaDB with Apptainer</h2>
<p>Because Apptainer has all the filesystems readonly except or the volume, the /run/mysqld directory is used as a pidfile and socket directory. An easy way is to mark this as a scratch directory.</p>
<pre class="fixed">mkdir mydatadir
apptainer run --no-home --bind $PWD/mydatadir:/var/lib/mysql --env MARIADB_RANDOM_ROOT_PASSWORD=1 --net --network-args &#34;portmap=3308:3306/tcp&#34; --fakeroot --scratch=/run/mysqld  docker://mariadb:10.5
</pre><p>Alternately:</p>
<pre class="fixed">apptainer run --no-home --bind $PWD/mydatadir:/var/lib/mysql --env MARIADB_RANDOM_ROOT_PASSWORD=1 --net --network-args &#34;portmap=3308:3306/tcp&#34; --fakeroot   docker://mariadb:10.5 --socket=/var/lib/mysql/mariadb.sock --pid-file=/var/lib/mysql/mariadb.pid
</pre><h2 class="anchored_heading" id="why-does-the-mariadb-container-start-as-root">Why does the MariaDB container start as root?</h2>
<p>The MariaDB entrypoint briefly starts as root, and if a explicit volume is there, the owner of this volume will be root. To allow MariaDB to use the CHOWN capability to change to the volume owner to a user that can write to this volume, it needs to be briefly root. After this one action is taken, the entrypoint uses <strong>gosu</strong> to drop to a non-root user and continues execution. There is no accessible exploit vector to remotely affect the container startup when it is briefly running as the root user.</p>
<h2 class="anchored_heading" id="can-i-run-the-mariadb-container-as-an-arbitrary-user">Can I run the MariaDB container as an arbitrary user?</h2>
<p>Yes. using the <em>user: 2022</em> in a compose file, or <em>--user 2022</em> as a command will run the entrypoint as the user id 2022. When this occurs, it is assumed that the volume of the datadir has the right permissions for MariaDB to access the datadir. This can be useful if your local user is user id 2022 and your datadir is owned locally by this user. Note inside the container there isn't the same user names outside the container defined, so working with numbers is more portable.</p>

    </div>


        
            <div id="subscribe" class="well well-small hide hidden-print"
                 data-subscribe-url="/kb/en/docker-official-image-frequently-asked-questions/+subscriptions/add"
                 data-unsubscribe-url="/kb/en/docker-official-image-frequently-asked-questions/+subscriptions/remove">
            </div>
        

        
        
    
        <div class="simple_section_nav">
            <ul class="nav nav-pills">
                
                    <li><a href="/kb/en/running-mariadb-columnstore-containers-on-linux-windows-and-macos/">
                        ← Running MariaDB ColumnStore containers on Linux, Windows and MacOS
                    </a>
                    </li>
                
                
                    <li><a href="/kb/en/mariadb-containers/">
                        ↑ MariaDB Containers ↑
                    </a>
                    </li>
                
                
                    <li class="pull-right"><a href="/kb/en/mariadb-container-cheat-sheet/">
                        MariaDB Container Cheat Sheet →
                    </a>
                    </li>
                
            </ul>
        </div>
    

        

        
        <h2>Comments</h2>
        
    
    <div id="comments" data-node-id="12729" data-comments-url="/kb/en/docker-official-image-frequently-asked-questions/+comments"
         data-reply-url="/kb/en/docker-official-image-frequently-asked-questions/comments/post/">
        Comments loading...
    </div>

        

    </div>


                    <div id="content_disclaimer" class="graybox">
                        Content reproduced on this site is the property of its respective owners,
                        and this content is not reviewed in advance by MariaDB. The views, information and opinions
                        expressed by this content do not necessarily represent those of MariaDB or any other party.
                    </div>
                </div>
            </section>

            
                <div id="right_bar" class="col-md-2">
                    
    
        
        <ul class="section_navigation well well-small hidden-xs hidden-sm">
            
                <li class="parent"><a href="/kb/en/mariadb-containers/">
                    ↑ MariaDB Containers ↑
                </a>
                </li>
            
            
                
                    <li>
                        <a href="/kb/en/benefits-of-managing-mariadb-containers-with-orchestration-software/">
                            
                            Benefits of Managing MariaDB Containers with Orchestration Software
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/installing-and-using-mariadb-via-docker/">
                            
                            Installing and Using MariaDB via Docker
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/container-backup-and-restoration/">
                            
                            Container Backup and Restoration
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/container-security-concerns/">
                            
                            Container Security Concerns
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/adding-plugins-to-the-mariadb-docker-official-image/">
                            
                            Adding Plugins to the MariaDB Docker Official Image
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/setting-up-a-lamp-stack-with-docker-compose/">
                            
                            Setting Up a LAMP Stack with Docker Compose
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/creating-a-custom-container-image/">
                            
                            Creating a Custom Container Image
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-server-docker-official-image-environment-variables/">
                            
                            MariaDB Server Docker Official Image Environment Variables
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/running-mariadb-columnstore-containers-on-linux-windows-and-macos/">
                            <span class="pull-right not_primary"></span>
                            Running MariaDB ColumnStore containers on Linux, Windows and MacOS
                        </a>
                    </li>
                
            
                
                    <li class="active">
                        <span>Docker Official Image Frequently Asked Questions</span>
                        
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-container-cheat-sheet/">
                            
                            MariaDB Container Cheat Sheet
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/using-healthcheck-sh/">
                            
                            Using Healthcheck.sh
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/docker-and-aws-ec2/">
                            
                            Docker and AWS EC2
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/docker-and-google-cloud/">
                            
                            Docker and Google Cloud
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/docker-and-microsoft-azure/">
                            
                            Docker and Microsoft Azure
                        </a>
                    </li>
                
            
        </ul>
    
    

                </div>
            
        </div>
    </div>
</div>

<!-- Footer -->
<footer id="footer">
    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-xs-12">
                    <ul class="list-inline text-center footer-nav">
                        <li>
                            <h5>
                                <a href="https://mariadb.com/products" title="Products">Products</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/services" title="Services">Services</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/pricing" title="Pricing">Pricing</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/resources" title="Resources">Resources</a>
                            </h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/about-us" title="About MariaDB">About Us</a></h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/download" title="Download">Download MariaDB</a></h5>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="row row-10">
                
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div id="block-footerformcontact" class="block block-block-content block-block-contentd754ee1b-3cc9-40e7-9ef4-f504f1197fb1">
                        
                            <h5 style="font-weight: 400;">Subscribe to our newsletter!</h5>
                            <script src="//app-sj15.marketo.com/js/forms2/js/forms2.min.js"></script><form id="mktoForm_1498"></form>
                            <script>
                                <!--//--><![CDATA[// ><!--
                                MktoForms2.loadForm("//app-sj15.marketo.com", "573-PXI-984", 1498);
                                //--><!]]]]><![CDATA[>
                                //--><!]]>
                            </script>
                        
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div class="footer-copyright">
                        <div class="text-center">
                            <ul class="list-inline no-margin">
                                <li>
                                    <a href="/legal" title="Legal">Legal</a>
                                </li>
                                <li>
                                    <a href="/privacy-policy" title="Privacy Policy">Privacy Policy</a>
                                </li>
                                <li>
                                    <a href="/cookie-policy/" title="Cookies">Cookie Policy</a>
                                </li>
                            </ul>
                            <p>Copyright &copy; 2025 MariaDB. All rights reserved.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</footer>
</div>

<div id="ajax_loading">
    <img src="/kb/static/images/ajax-loader.a51c5608d01a.gif" />
</div>

    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MK2847"
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MK2847');</script>
    <!-- End Google Tag Manager -->

</body>

<script type="text/javascript" src="/kb/static/js/main.1587e3a666fc.js" charset="utf-8"></script>

</html>