<?xml version="1.0" encoding="utf-8"?>
<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title>MariaDB Knowledge Base Comments for: Connecting</title><link>https://mariadb.com/kb/en/connection/+comments/feed/</link><description></description><atom:link href="https://mariadb.com/kb/en/connection/+comments/feed/" rel="self"></atom:link><language>en-us</language><lastBuildDate>Mon, 05 Aug 2024 09:05:10 +0000</lastBuildDate><item><title>Re: Connecting</title><link>https://mariadb.com/kb/en/connection/+comments/6708</link><description>&lt;p&gt;I think that an extension like you describe might make sense, but there needs to be a consensus, and server should signal the client that it understands whatever client sends, once it understands it. Usually, capability bits are used for this kind of signal, but MySQL is running out of these bits, and needs some extension. &lt;/p&gt;
&lt;p&gt;Otherwise, I believe any form of utf8mb4 is good enough for majority of clients and their use cases, e.g utf8mb4_bin. The connection's collation  only affects comparison of literal strings, which is not what everyone would need from database, and for rare cases, SET NAMES could be appropriate.&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Vladislav Vaintroub</dc:creator><guid>https://mariadb.com/kb/en/connection/+comments/6708</guid></item><item><title>Re: Connecting</title><link>https://mariadb.com/kb/en/connection/+comments/6706</link><description>&lt;p&gt;Thanks for looking into this. It indeed looks like you are right and the server only reads one byte. The problem with this is that with collations &amp;gt;255 this means the server can't pick the correct collation. This might be solved by clients by sending SET NAMES (which Connector/Python at least in some cases seems to do twice...). However that means this field becomes useless and at least one extra roundtrip is needed. This would mean the protocol needs to be updated to avoid the roundtrip. And while I agree that this should be done in a official way, the thing that Connector/Python does would be an obvious solution. Other options are to put the second byte elsewhere in the protocol.&lt;/p&gt;
&lt;p&gt;I think this issue isn't affecting many people as collations &amp;gt;255 aren't very common and SET NAMES also hides this issue.&lt;/p&gt;
&lt;p&gt;I've updated the bugreport with MySQL. Let's see what they have to say about this.&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Daniël van Eeden</dc:creator><guid>https://mariadb.com/kb/en/connection/+comments/6706</guid></item><item><title>Re: Connecting</title><link>https://mariadb.com/kb/en/connection/+comments/6705</link><description>&lt;p&gt;Actually, my reading of MySQL (8.0.37) code is that neither the client nor the server use 2 byte charsets, they both use 1 byte. &lt;/p&gt;
&lt;p&gt;I did not debug, but I doubt debugging will change what's in there&lt;/p&gt;
&lt;p&gt;&lt;a href="https://github.com/mysql/mysql-server/blob/mysql-8.4.0/sql/auth/sql_authentication.cc#L2975"&gt;https://github.com/mysql/mysql-server/blob/mysql-8.4.0/sql/auth/sql_authentication.cc#L2975&lt;/a&gt; &lt;/p&gt;
&lt;p&gt;  charset_code = (uint)(uchar) * (end + 8);&lt;/p&gt;
&lt;p&gt;&lt;a href="https://github.com/mysql/mysql-server/blob/mysql-8.4.0/sql/auth/sql_authentication.cc#L3051"&gt;https://github.com/mysql/mysql-server/blob/mysql-8.4.0/sql/auth/sql_authentication.cc#L3051&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;    ssl_charset_code =
          (uint)(uchar) * ((char *)protocol-&amp;gt;get_net()-&amp;gt;read_pos + 8);&lt;/p&gt;
&lt;p&gt;Both SSL and non-SSL case are 1 byte, initialized from unsigned char, read from position 8.&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Vladislav Vaintroub</dc:creator><guid>https://mariadb.com/kb/en/connection/+comments/6705</guid></item><item><title>Re: Connecting</title><link>https://mariadb.com/kb/en/connection/+comments/6704</link><description>&lt;p&gt;I do not know which connectors started to use 2 bytes.&lt;/p&gt;
&lt;p&gt;So far, all documentation so far said 1 byte, and wireshark in your PR also says "1 byte". Apparently, they would not work with MariaDB server correctly, that does not read 2 bytes from that packet.&lt;/p&gt;
&lt;p&gt;Usually, protocol changes are not done this quietly, and need to be announced, and documented before release. Otherwise, none of 3rd party connectors or protocol-compatible servers would be prepared to handle that.&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Vladislav Vaintroub</dc:creator><guid>https://mariadb.com/kb/en/connection/+comments/6704</guid></item><item><title>Re: Connecting</title><link>https://mariadb.com/kb/en/connection/+comments/6703</link><description>&lt;p&gt;That info is not correct. I've created this PR for that: &lt;a href="https://github.com/mysql/mysql-server/pull/541"&gt;https://github.com/mysql/mysql-server/pull/541&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;I think this originally (way back when) might have been 1 byte with the byte before it being reserved and always 0x0. But that never changed while connectors etc. started to use 2 bytes.&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Daniël van Eeden</dc:creator><guid>https://mariadb.com/kb/en/connection/+comments/6703</guid></item><item><title>Re: Connecting</title><link>https://mariadb.com/kb/en/connection/+comments/6702</link><description>&lt;p&gt;I think it is one byte, MySQL calls it "int&amp;lt;1&amp;gt;	character_set	client charset a_protocol_character_set, only the lower 8-bits" in 
its documentation&lt;/p&gt;
&lt;p&gt;&lt;a href="https://dev.mysql.com/doc/dev/mysql-server/latest/page_protocol_connection_phase_packets_protocol_handshake_response.html#sect_protocol_connection_phase_packets_protocol_handshake_response41"&gt;https://dev.mysql.com/doc/dev/mysql-server/latest/page_protocol_connection_phase_packets_protocol_handshake_response.html#sect_protocol_connection_phase_packets_protocol_handshake_response41&lt;/a&gt;&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Vladislav Vaintroub</dc:creator><guid>https://mariadb.com/kb/en/connection/+comments/6702</guid></item><item><title>Re: Connecting</title><link>https://mariadb.com/kb/en/connection/+comments/6701</link><description>&lt;p&gt;I believe the "client's default character set and collation" in the "Handshake Response Packet" is an "int&amp;lt;2&amp;gt;" instead of an "int&amp;lt;1&amp;gt;". So 2 bytes instead of one.&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Daniël van Eeden</dc:creator><guid>https://mariadb.com/kb/en/connection/+comments/6701</guid></item><item><title>Re: Connecting</title><link>https://mariadb.com/kb/en/connection/+comments/2804</link><description>&lt;p&gt;Btw, i just correct "Handshake response packet" protocol when PLUGIN_AUTH_LENENC_CLIENT_DATA wasn't set. that make it more clear that maximum length was set on one byte (so, with max size 255)&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Diego Dupin</dc:creator><guid>https://mariadb.com/kb/en/connection/+comments/2804</guid></item><item><title>Re: Connecting</title><link>https://mariadb.com/kb/en/connection/+comments/2803</link><description>&lt;p&gt;right, description is not accurate. better to indicate "Enable authentication response packet to be larger than 255 bytes"&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Diego Dupin</dc:creator><guid>https://mariadb.com/kb/en/connection/+comments/2803</guid></item><item><title>Re: Connecting</title><link>https://mariadb.com/kb/en/connection/+comments/2801</link><description>&lt;p&gt;PLUGIN_AUTH_LENENC_CLIENT_DATA has a description of "authentication data length is a length auth integer" - what does this mean?&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Rui Pacheco</dc:creator><guid>https://mariadb.com/kb/en/connection/+comments/2801</guid></item></channel></rss>