<?xml version="1.0" encoding="utf-8"?>
<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title>MariaDB Knowledge Base Comments for: Replication slave loses connection and does not recover</title><link>https://mariadb.com/kb/en/replication-slave-loses-connection-and-does-not-recover/+comments/feed/</link><description></description><atom:link href="https://mariadb.com/kb/en/replication-slave-loses-connection-and-does-not-recover/+comments/feed/" rel="self"></atom:link><language>en-us</language><lastBuildDate>Mon, 09 Sep 2024 14:13:46 +0000</lastBuildDate><item><title>Re: Replication slave loses connection and does not recover</title><link>https://mariadb.com/kb/en/replication-slave-loses-connection-and-does-not-recover/+comments/3554</link><description>&lt;p&gt;&lt;strong&gt;Symptom: Starting the Slave manually causes replication to initially succeed (for a minute or two), but the Slave subsequently stops after reporting a failure to connect to the Master, similar to the error below:&lt;/strong&gt;&lt;br&gt;
&lt;br&gt;
2018-09-17 16:03:12 13 [Warning] Slave I/O: Notifying master by SET @master_binlog_checksum= @@global.binlog_checksum failed with error: Unknown system variable 'binlog_checksum', Internal MariaDB error code: 1193&lt;br&gt;
2018-09-17 16:04:12 13 [ERROR] Error reading packet from server: Lost connection to MySQL server during query (server_errno=2013)&lt;br&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Double Checks&lt;/strong&gt;: Confirm that both Master and Slave are using the same character sets. This may not be obvious if you are replicating between a much older version of MySql (let's say 5.1) and a current &lt;a href="/kb/en/what-is-mariadb-103/"&gt;MariaDB 10.3&lt;/a&gt;.X instance. The older instance of MySql may not be aware of the utf8mb4 versus utf8 issue. utf8mb4 may be the default in newer MySql and MariaDB instances, whereas utf8 may be the default in older versions.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Remediation Example&lt;/strong&gt;: If replicating between a Master with a much older version of MySql, and a Slave using a newer MariaDB (or MySql) instance, in your &lt;strong&gt;my.ini&lt;/strong&gt; (or equivalent), make sure that you comment out the utf8mb4, and explicitly set the utf8 options on the Slave.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;i.e.comment out the use of utf8mb4 on the slave IF the server is using utf8&lt;/strong&gt;&lt;br&gt;
&lt;code&gt;# character-set-server=utf8mb4&lt;br&gt;
&lt;/code&gt;# collation-server=utf8mb4_general_ci&lt;br&gt;
&lt;strong&gt;character-set-server=utf8&lt;/strong&gt;&lt;br&gt;
&lt;strong&gt;collation-server=utf8_general_ci&lt;/strong&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;If replicating between newer servers, please just confirm that the character sets in use are the same on Master and Slave (in this instance, it's preferable for both servers to use utf8mb4.&lt;br&gt;
&lt;br&gt;
&lt;strong&gt;The key is to make sure that the Slave is configured to use the same character set that the Master is using.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Post-Mortem Considerations:Consider using utf8mb4 on both Master and Slave.&lt;br&gt;&lt;/strong&gt; If this is not possible due to version constraints, then start the process of designing and scheduling a testing program to facilitate an upgrade of the Master to a newer version (preferably MariaDB).&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Ian Light</dc:creator><guid>https://mariadb.com/kb/en/replication-slave-loses-connection-and-does-not-recover/+comments/3554</guid></item></channel></rss>