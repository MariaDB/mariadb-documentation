<!DOCTYPE html>
<html>
<head data-cookie-domain=""
      data-cookie-path="/">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="apple-touch-icon" sizes="180x180" href="/kb/static/images/favicons/apple-touch-icon.159e713979be.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/kb/static/images/favicons/favicon-32x32.bc0ac1d5d11e.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/kb/static/images/favicons/favicon-16x16.5801f8f0f34e.png">
    <link rel="shortcut icon" href="/kb/static/images/favicons/favicon.d122d305dee4.ico" type="image/x-icon" />

    <title>Parallel Replication - MariaDB Knowledge Base</title>

    <link href="/kb/static/css/main.f7633538c846.css" rel="stylesheet" type="text/css" />

    

    

    <!-- FB Open Graph tags -->
    <meta property="og:title" content="Parallel Replication" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://mariadb.com/kb/en/parallel-replication/" />
    <meta property="og:image" content="http://mariadb.comaskmonty-logo.png" />
    <meta property="og:site_name" content="MariaDB KnowledgeBase" />
    <meta property="fb:admins" content="514852603" />
    <meta property="og:description" content="Executing queries replicated from the primary in parallel on the replica." />

    <meta name="description" content="Executing queries replicated from the primary in parallel on the replica." />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet"/>
    
</head>
<body class="mpkb nodes products nodes_view jqui" id="nodes_view">





<div id="menu-mobile" class="visible-sm visible-xs">

    <div>
        <div id="mobile-close-menu" class="text-right">
            <a href="javascript:void(0)" title="Close Menu" id="back-main" class="toggle-menu">X<span></span></a>
        </div>
    </div>
    <div class="mainmenu-mobile">
        <ul class="ls-none ul-menu">
            <li data-sub="submenu5"><a class="open-form-search" href="/kb/search/" title="Search">Search </a></li>
            <li data-sub="submenu0"><a href="/products" title="Products">Products</a><span class="arrow-main"></span></li>
            <li data-sub="submenu1"><a href="/services" title="Services">Services</a><span class="arrow-main"></span></li>
            <li data-sub="submenu2"><a href="/resources" title="Resources">Resources</a><span class="arrow-main"></span></li>
            <li data-sub="submenu3"><a href="/about-us" title="About">About</a><span class="arrow-main"></span></li>
            <li data-sub="submenu4"><a href="/contact" title="Contact">Contact</a></li>
        </ul>
    </div>

    <div class="nav-top-mobile">
        <div class="select-box form">

            <ul class="inline-block-md mb-none top-nav">
                <li>

                </li>
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/parallel-replication/"> Login</a>
                    </li>
                
            </ul>



        </div>
        <p class="text-center copyright">Copyright &copy; 2025 MariaDB. All rights reserved.</p>
    </div>
</div>
<div class="violator-wrap d-none" id="top_violator">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12">
                <div class="violator-outer">
                    <div class="violator-inner">
                        <div class="row">
                            <div class="col-xs-12 col-sm-9 col-lg-7 col-lg-offset-2" id="top_violator_content">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="content-link" target="_blank" rel="nofollow noreferrer">
                                    <span>The Ultimate Guide to High Availability with MariaDB</span>
                                </a>
                            </div>
                            <div class="col-xs-12 col-sm-3" id="top_violator_cta">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="btn btn-mariadb" target="_blank" rel="nofollow noreferrer">Download Now</a>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-link close-btn">
                        <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24" width="15px" height="15px"><path d="M 4.9902344 3.9902344 A 1.0001 1.0001 0 0 0 4.2929688 5.7070312 L 10.585938 12 L 4.2929688 18.292969 A 1.0001 1.0001 0 1 0 5.7070312 19.707031 L 12 13.414062 L 18.292969 19.707031 A 1.0001 1.0001 0 1 0 19.707031 18.292969 L 13.414062 12 L 19.707031 5.7070312 A 1.0001 1.0001 0 0 0 18.980469 3.9902344 A 1.0001 1.0001 0 0 0 18.292969 4.2929688 L 12 10.585938 L 5.7070312 4.2929688 A 1.0001 1.0001 0 0 0 4.9902344 3.9902344 z"/></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="wrapper">
<div id="top-nav">
    <div class="container">
        <ul class="hidden-sm hidden-xs" >
            <li><a href="https://mariadb.com/kb/">Knowledge Base</a></li>
            <li><a href="https://mariadb.com/contact/">Contact</a></li>
            
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/parallel-replication/" rel="nofollow">Login</a>
                    </li>
                
            
            
            <li id="search-form">
                <form action="/kb/en/+search/" method="get" id="search-block-form" accept-charset="UTF-8">
                    <input id="search" title="Enter the terms you wish to search for."
                           placeholder="Search . . ." type="text"
                           name="q" value="" size="15" maxlength="128" class="form-text"
                           data-autocomplete-url="/kb/en/+search/autocomplete/">
                    <input type="hidden" name="quick" value="1" />
                    <input type="hidden" name="source" value="kb" />
                </form>
            </li>
            <li><a id="search-toggler" href="/kb/search/">Search</a></li>
            
        </ul>
    </div>
</div>
<div id="navbar-bottom" class="navbar">
    <div class="container">
        
        
        
        
        <div class="row">
            <div class="col-md-3 col-sm-9 col-xs-9">
                <a class="brand" href="/" title="MariaDB">
                    <img src="/kb/static/images/logo-2018-black.95f5978ae14d.png">
                </a>
            </div>
            <div class="col-md-9 hidden-sm hidden-xs">
                <div class="main-menu">
                    <ul id="main-menu" class="nav navbar-nav inline-block-sm">
    <li class="has-sub full-menu">
        <a href="/products" title="Products">Products</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/solutions" title="Solutions">Solutions</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/resources" title="Resources">Resources</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/about-us" title="Company">Company</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/pricing" title="Pricing">Pricing</a>
    </li>
    
    <li class="">
        <a class="button electric-eel small top-bar-right-download" href="/downloads/">Download</a>
    </li>
</ul>
                </div>
            </div>
            <div class="col-md-3 visible-sm visible-xs col-sm-3 col-xs-3 ps-rv">
                <div class="navbar-header text-right pull-right">
                    <button type="button" class="menu-control toggle-menu" id="open-menu">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="main">
    <div class="container">
        

        <div id="subheader1" class="clearfix">
            <div class="pull-left">
                
                <div id="breadcrumbs" class="breadcrumb">
                    <a href="/kb/en/">Knowledge Base</a>
                    


    
    » <a class="crumb" href="/kb/en/documentation/">MariaDB Server Documentation</a>
    

    
    » <a class="crumb" href="/kb/en/replication-cluster-multi-master/">High Availability &amp; Performance Tuning</a>
    

    
    » <a class="crumb" href="/kb/en/standard-replication/">MariaDB Replication</a>
    


    » <a class="node_link crumb" href="/kb/en/parallel-replication/">Parallel Replication</a>


                </div>
                
            </div>
        </div>
    </div>
    <div class="container" id="container-main">
        <div class="row">
            
            
                
                <aside id="sidebar-first" class="sidebar col-md-2 hidden-xs hidden-sm hidden-print">
                    
                        
                        <ul id="category_menu" class="nav nav-pills nav-stacked">
                            <li><a href="/kb/en/">Home</a></li>
                            
                                
                                    <li><a href="/kb/en/+questions/">Open Questions</a></li>
                                
                                <li><a href="/kb/en/documentation/">MariaDB Server</a></li>
                                <li><a href="/kb/en/maxscale/">MariaDB MaxScale</a></li>
                                <li><a href="/kb/en/mariadb-columnstore/">MariaDB ColumnStore</a></li>
                                <li><a href="/kb/en/connectors/">Connectors</a></li>
                            

                        </ul>
                    

                    
<div>



<div class="well well-small box actions"><div>

        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/parallel-replication/+history" rel="nofollow">History</a>
        
        
        
        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/parallel-replication/+source/">Source</a>
        
        <a class="btn btn-block btn-blue btn-sm flag" href="/kb/en/parallel-replication/+flag"
                data-flag-url="/kb/en/parallel-replication/+flag" rel="nofollow">
                Flag as Spam / Inappropriate</a>
        
        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/parallel-replication/+translate/">
                Translate</a>
        

</div>
</div>





<div class="well well-small box node_info"><div>

    <dl>
        <dt>Created</dt>
        <dd>

<span class="datetime" title="2013-10-14 17:45">11 years, 7 months ago</span></dd>

        <dt>Modified</dt>
        <dd>

<span class="datetime" title="2023-05-30 21:36">1 year, 11 months ago</span></dd>

        <dt>Type</dt>
        <dd>article</dd>

        <dt>Status</dt>
        <dd>active</dd>

        <dt>License</dt>
        <dd>
            
                <a href="/kb/en/parallel-replication/+license/">CC BY-SA / Gnu FDL</a>
            
        </dd>

        
    </dl>

    
    <ul class="rss_feeds">
        <li><a href="/kb/en/parallel-replication/+history/feed/">
            History</a>
        </li>
        <li><a href="/kb/en/parallel-replication/+comments/feed/">
            Comments</a>
        </li>
    </ul>
    

</div>
</div>





    
    
    

<div class="well well-small box attachments"><div><div class="edit_link pull-right"><a href="/kb/en/parallel-replication/+edit/attachments/">Edit</a></div><h5>Attachments</h5></div><div>

        
            <div class="no_data">No attachments exist</div>
        
    
</div>
</div>

    



    
    






</div>


                    

































                </aside>
            
            
            
                
            
            
                
            
            <section id="content" class="limited_width col-md-8 clearfix">
                
                    <h1>Parallel Replication</h1>
                

                



                <div>
                    
    

    
    
    

    <div class="node creole">
        
        
        


    
    <div class="answer formatted">
        <div class="cstm-style bluebox text"><p>The terms <em>master</em> and <em>slave</em> have historically been used in replication, and MariaDB has begun the process of adding <em>primary</em> and <em>replica</em> synonyms. The old terms will continue to be used to maintain backward compatibility - see <a href="https://jira.mariadb.org/browse/MDEV-18777">MDEV-18777</a> to follow progress on this effort.</p>
</div>
<div class="table_of_contents well well-small">
<h3>Contents</h3>
 <ol class="toc">

    <li class=""><a href="#parallel-replication-overview" title="Parallel Replication Overview">Parallel Replication Overview</a></li>

    <li class=""><a href="#how-to-enable-parallel-replica" title="How to Enable Parallel Replica">How to Enable Parallel Replica</a></li>

    <li class=""><a href="#configuring-the-replica-parallel-mode" title="Configuring the Replica Parallel Mode">Configuring the Replica Parallel Mode</a>    <ol class="toc">

        <li class=""><a href="#in-order-parallel-replication" title="In-Order Parallel Replication">In-Order Parallel Replication</a>        <ol class="toc">

            <li class=""><a href="#optimistic-mode-of-in-order-parallel-replication" title="Optimistic Mode of In-Order Parallel Replication">Optimistic Mode of In-Order Parallel Replication</a></li>

            <li class=""><a href="#aggressive-mode-of-in-order-parallel-replication" title="Aggressive Mode of In-Order Parallel Replication">Aggressive Mode of In-Order Parallel Replication</a></li>

            <li class=""><a href="#conservative-mode-of-in-order-parallel-replication" title="Conservative Mode of In-Order Parallel Replication">Conservative Mode of In-Order Parallel Replication</a></li>

            <li class=""><a href="#minimal-mode-of-in-order-parallel-replication" title="Minimal Mode of In-Order Parallel Replication">Minimal Mode of In-Order Parallel Replication</a>        </ol>
</li>

        <li class=""><a href="#out-of-order-parallel-replication" title="Out-of-Order Parallel Replication">Out-of-Order Parallel Replication</a>    </ol>
</li>

    <li class=""><a href="#checking-worker-thread-status-in-show-processlist" title="Checking Worker Thread Status in SHOW PROCESSLIST">Checking Worker Thread Status in SHOW PROCESSLIST</a></li>

    <li class=""><a href="#expected-performance-gain" title="Expected Performance Gain">Expected Performance Gain</a></li>

    <li class=""><a href="#configuring-the-maximum-size-of-the-parallel-replica-queue" title="Configuring the Maximum Size of the Parallel Replica Queue">Configuring the Maximum Size of the Parallel Replica Queue</a></li>

    <li class=""><a href="#configuration-variable-slave_domain_parallel_threads" title="Configuration Variable slave_domain_parallel_threads">Configuration Variable slave_domain_parallel_threads</a></li>

    <li class=""><a href="#implementation-details" title="Implementation Details">Implementation Details</a></li>

    <li class=""><a href="#see-also" title="See Also">See Also</a> </ol>
</li>
</div>
<p>Some writes, <a href="/kb/en/standard-replication/">replicated</a> from the primary can be executed in parallel (simultaneously) on the replica. Note that for parallel replication to work, both the primary and replica need to be <a href="/kb/en/mariadb-1005-release-notes/">MariaDB 10.0.5</a> or later. </p>
<h2 class="anchored_heading" id="parallel-replication-overview">Parallel Replication Overview</h2>
<p>MariaDB replication in general takes place in three parts:</p>
<ul start="1"><li>Replication events are read from the primary by the IO thread and queued in
the <a href="/kb/en/relay-log/">relay log</a>.
</li><li>Replication events are fetched one at a time by the SQL thread from the relay log
</li><li>Each event is applied on the replica to replicate all changes done on the
primary.
</li></ul>
<p>Before MariaDB 10, the third step was also performed by the SQL thread; this
meant that only one event could execute at a time, and replication was
essentially single-threaded. Since MariaDB 10, the third step can optionally be
performed by a pool of separate replication worker threads, and thereby
potentially increase replication performance by applying multiple events in parallel.</p>
<h2 class="anchored_heading" id="how-to-enable-parallel-replica">How to Enable Parallel Replica</h2>
<p>To enable, specify <a href="/kb/en/replication-and-binary-log-server-system-variables/#slave_parallel_threads">slave-parallel-threads=#</a> in your <a href="/kb/en/mysqld-startup-options/">my.cnf</a> file as an argument to mysql.
Parallel replication can in addition be disabled on a per-multi-source
connection by setting <a href="/kb/en/replication-and-binary-log-server-system-variables/#slave_parallel_mode">@@connection_name.slave-parallel-mode</a> to "none".</p>
<p>The value (#) of slave_parallel_threads specifies how many threads will be created in a pool of worker
threads used to apply events in parallel for *all* your replicas (this includes
<a href="/kb/en/multi-source-replication/">multi-source replication</a>). If the value is zero,
then no worker threads are created, and old-style replication is used where
events are applied inside the SQL thread. Usually the value, if non-zero,
should be at least two times the number of multi-source primary connections
used. It makes little sense to use only a single worker thread for one
connection; this will incur some overhead in inter-thread communication
between the SQL thread and the worker thread, but with just a single worker
thread events can not be applied in parallel anyway.</p>
<p><code class="highlight fixed" style="white-space:pre-wrap">slave-parallel-threads=#</code> is a dynamic variable that can be changed without restarting mysqld. All replicas connections must however be stopped when changing the value.</p>
<h2 class="anchored_heading" id="configuring-the-replica-parallel-mode">Configuring the Replica Parallel Mode</h2>
<p>Parallel replication can be in-order or out-of-order:</p>
<ul start="1"><li>In-order executes transactions in parallel, but orders the
commit step of the transactions to happen in the exact same order as on the
primary. Transactions are only executed in parallel to the extent that this can
be automatically verified to be possible without any conflicts. This means
that the use of parallelism is completely transparent to the application.
</li><li>Out-of-order can execute and commit transactions in different order on the
replica than originally on the primary. This means that the application must be
tolerant to seeing updates occur in different order. The application is also
responsible for ensuring that there are no conflicts between transactions that
are replicated out-of-order. Out-of-order is only used in GTID mode and only
when explicitly enabled by the application, using the replication domain that
is part of the GTID.
</li></ul>
<h3 class="anchored_heading" id="in-order-parallel-replication">In-Order Parallel Replication</h3>
<h4 class="anchored_heading" id="optimistic-mode-of-in-order-parallel-replication">Optimistic Mode of In-Order Parallel Replication</h4>
<p>Optimistic mode of in-order parallel replication provides a lot of opportunities for parallel apply on the replica while still preserving exact transaction semantics from the point of view of applications. It is the default mode from <a href="/kb/en/mariadb-1051-release-notes/">MariaDB 10.5.1</a>.</p>
<p>Optimistic mode of in-order parallel replication can be configured by setting the <a href="/kb/en/replication-and-binary-log-server-system-variables/#slave_parallel_mode">slave_parallel_mode</a> system variable to <code>optimistic</code> on the replica.</p>
<p>Any transactional DML (INSERT/UPDATE/DELETE) is allowed to run in parallel, up
to the limit of <a href="/kb/en/replication-and-binary-log-server-system-variables/#slave_domain_parallel_threads">@@slave_domain_parallel_threads</a>. This may cause conflicts on
the replica, eg. if two transactions try to modify the same row. Any such
conflict is detected, and the latter of the two transactions is rolled back,
allowing the former to proceed. The latter transaction is then re-tried once
the former has completed.</p>
<p>The term "optimistic" is used for this mode, because the server optimistically
assumes that few conflicts will occur, and that the extra work spent rolling
back and retrying conflicting transactions is justified from the gain from
running most transactions in parallel.</p>
<p>There are a few heuristics to try to avoid needless conflicts. If a
transaction executed a row lock wait on the primary, it will not be run in parallel
on the replica. Transactions can also be marked explicitly as potentially
conflicting on the primary, by setting the variable
<a href="/kb/en/replication-and-binary-log-server-system-variables/#skip_parallel_replication">@@skip_parallel_replication</a>. More such heuristics may be added in later
MariaDB versions. There is a further <a href="/kb/en/replication-and-binary-log-server-system-variables/#slave_parallel_mode">--slave-parallel-mode</a> called
"aggressive", where these heuristics are disabled, allowing even more
transactions to be applied in parallel.</p>
<p>Non-transactional DML and DDL is not safe to optimistically apply in parallel,
as it cannot be rolled back in case of conflicts. Thus, in optimistic mode,
non-transactional (such as MyISAM) updates are not applied in parallel with
earlier events (it is however possible to apply a MyISAM update in parallel
with a later InnoDB update). DDL statements are not applied in parallel with
any other transactions, earlier or later.</p>
<p>The different kind of transactions can be identified in the output of
<a href="/kb/en/mariadb-binlog/">mariadb-binlog</a>. For example:</p>
<pre class="fixed wrap">#150324 13:06:26 server id 1  end_log_pos 6881 	GTID 0-1-42 ddl
...
#150324 13:06:26 server id 1  end_log_pos 7816 	GTID 0-1-47
...
#150324 13:06:26 server id 1  end_log_pos 8177  GTID 0-1-49 trans
/*!100101 SET @@session.skip_parallel_replication=1*//*!*/;
...
#150324 13:06:26 server id 1  end_log_pos 9836 	GTID 0-1-59 trans waited
</pre><p>GTID 0-1-42 is marked as being DDL. GTID 0-1-47 is marked as being
non-transactional DML, while GTID 0-1-49 is transactional DML (seen on the
"trans" keyword). GTID 0-1-49 was additionally run with
<a href="/kb/en/replication-and-binary-log-server-system-variables/#skip_parallel_replication">@@skip_parallel_replication</a>
set on the primary. GTID 0-1-59 is transactional DML that had a row lock wait when run on the
primary (the "waited" keyword).</p>
<h4 class="anchored_heading" id="aggressive-mode-of-in-order-parallel-replication">Aggressive Mode of In-Order Parallel Replication</h4>
<p>Aggressive mode of in-order parallel replication is very similar to optimistic mode. The main difference is that the replica does not consider whether transactions conflicted on the primary when deciding whether to apply the transactions in parallel.</p>
<p>Aggressive mode of in-order parallel replication can be configured by setting the <a href="/kb/en/replication-and-binary-log-server-system-variables/#slave_parallel_mode">slave_parallel_mode</a> system variable to <code>aggressive</code> on the replica.</p>
<h4 class="anchored_heading" id="conservative-mode-of-in-order-parallel-replication">Conservative Mode of In-Order Parallel Replication</h4>
<p>Conservative mode of in-order parallel replication uses the <a href="/kb/en/group-commit-for-the-binary-log/">group commit</a> on the primary to discover potential for parallel apply of events on the replica. If two transactions commit together in a <a href="/kb/en/group-commit-for-the-binary-log/">group commit</a> on the primary, they are written into the binlog with the same commit id. Such events are certain to not conflict with each other, and they can be scheduled by the parallel replication to run in different worker threads.</p>
<p>Conservative mode of in-order parallel replication is the default mode until <a href="/kb/en/mariadb-1050-release-notes/">MariaDB 10.5.0</a>, but it can also be configured by setting the <a href="/kb/en/replication-and-binary-log-server-system-variables/#slave_parallel_mode">slave_parallel_mode</a> system variable to <code>conservative</code> on the replica.</p>
<p>Two transactions that were committed separately on the primary can potentially
conflict (eg. modify the same row of a table). Thus, the worker that applies
the second transaction will not start immediately, but wait until the first
transaction begins the commit step; at this point it is safe to start the
second transaction, as it can no longer disrupt the execution of the first
one.</p>
<p>Here is example output from <a href="/kb/en/mariadb-binlog/">mariadb-binlog</a> that shows how GTID events are marked
with commit id. The GTID 0-1-47 has no commit id, and can not run in
parallel. The GTIDs 0-1-48 and 0-1-49 have the same commit id 630, and can
thus replicate in parallel with one another on a replica:</p>
<pre class="fixed">#150324 12:54:24 server id 1  end_log_pos 20052 	GTID 0-1-47 trans
...
#150324 12:54:24 server id 1  end_log_pos 20212 	GTID 0-1-48 cid=630 trans
...
#150324 12:54:24 server id 1  end_log_pos 20372 	GTID 0-1-49 cid=630 trans
</pre><p>In either case, when the two transactions reach the point where the low-level
commit happens and commit order is determined, the two commits are sequenced to
happen in the same order as on the primary, so that operation is transparent to
applications.</p>
<p>The opportunities for parallel replication on replicas can be highly increased
if more transactions are committed in a <a href="/kb/en/group-commit-for-the-binary-log/">group commit</a> on the primary. This can be tuned
using the <a href="/kb/en/replication-and-binary-log-server-system-variables/#binlog_commit_wait_count">binlog_commit_wait_count</a> and
<a href="/kb/en/replication-and-binary-log-server-system-variables/#binlog_commit_wait_usec">binlog_commit_wait_usec</a> variables. If for example the
application can tolerate up to 50 milliseconds extra delay for transactions on
the primary, one can set <code class="highlight fixed" style="white-space:pre-wrap">binlog_commit_wait_usec=50000</code> and
<code class="highlight fixed" style="white-space:pre-wrap">binlog_commit_wait_count=20</code> to get up to 20 transactions at
a time available for replication in parallel. Care must however be taken to
not set <code class="highlight fixed" style="white-space:pre-wrap">binlog_commit_wait_usec</code> too high, as this could
cause significant slowdown for applications that run a lot of small
transactions serially one after the other.</p>
<p>Note that even if there is no parallelism available from the primary <a href="/kb/en/group-commit-for-the-binary-log/">group commit</a>, there is still an opportunity for speedup from in-order parallel
replication, since the actual commit steps of different transactions can run
in parallel. This can be particularly effective on a replica with binlog enabled
(<a href="/kb/en/replication-and-binary-log-server-system-variables/#log_slave_updates">log_slave_updates=1</a>), and more so if replica is configured
to be crash-safe (<a href="/kb/en/replication-and-binary-log-server-system-variables/#sync_binlog">sync_binlog=1</a> and
<a href="/kb/en/xtradbinnodb-server-system-variables/#innodb_flush_log_at_trx_commit">innodb_flush_log_at_trx_commit=1</a>), as this makes <a href="/kb/en/group-commit-for-the-binary-log/">group commit</a> possible on the replica.</p>
<h4 class="anchored_heading" id="minimal-mode-of-in-order-parallel-replication">Minimal Mode of In-Order Parallel Replication</h4>
<p>Minimal mode of in-order parallel replication <em>only</em>allows the commit step of
transactions to be applied in parallel; all other steps are applied serially.</p>
<p>Minimal mode of in-order parallel replication can be configured by setting the <a href="/kb/en/replication-and-binary-log-server-system-variables/#slave_parallel_mode">slave_parallel_mode</a> system variable to <code>minimal</code> on the replica.</p>
<h3 class="anchored_heading" id="out-of-order-parallel-replication">Out-of-Order Parallel Replication</h3>
<p>Out-of-order parallel replication happens (only) when using GTID mode, when
GTIDs with different replication domains are used. The replication domain is
set by the DBA/application using the variable <code class="highlight fixed" style="white-space:pre-wrap">gtid_domain_id</code>.</p>
<p>Two transactions having GTIDs with different domain_id are scheduled to
different worker threads by parallel replication, and are allowed to execute
completely independently from each other. It is the responsibility of the
application to only set different domain_ids for transactions that are truly
independent, and are guaranteed to not conflict with each other. The
application must also be able to work correctly even though the transactions
with different domain_id are seen as committing in different order between the
replica and the primary, and between different replicas.</p>
<p>Out-of-order parallel replication can potentially give more performance gain
than in-order parallel replication, since the application can explicitly
give more opportunities for running transactions in parallel than what the
server can determine on its own automatically.</p>
<p>One simple but effective usage is to run long-running statements, such as
ALTER TABLE, in a separate replication domain. This allows replication of
other transactions to proceed uninterrupted:</p>
<pre class="highlight fixed"><p>SET SESSION gtid_domain_id=1
ALTER TABLE t ADD INDEX myidx(b)
SET SESSION gtid_domain_id=0</p></pre><p>Normally, a long-running ALTER TABLE or other query will stall all following
transactions, causing the replica to become behind the primary as least as long
time as it takes to run the long-running query. By using out-of-order parallel
replication by setting the replication domain id, this can be avoided. The
DBA/application must ensure that no conflicting transactions will be
replicated while the ALTER TABLE runs.</p>
<p>Another common opportunity for out-of-order parallel replication comes in
connection with multi-source replication. Suppose we have two different
primaries M1 and M2, and we are using multi-source replication to have S1 as a
replica of both M1 and M2. S1 will apply events received from M1 in parallel
with events received from M2. If we now have a third-level replica S2 that
replicates from S1 as primary, we want S2 to also be able to apply events that
originated on M1 in parallel with events that originated on M2. This can be
achieved with out-of-order parallel replication, by setting
<code class="highlight fixed" style="white-space:pre-wrap">gtid_domain_id</code> different on M1 and M2.</p>
<p>Note that there are no special restrictions on what operations can be
replicated in parallel using out-of-order; such operations can be on the same
database/schema or even on the same table. The only restriction is that the
operations must not conflict, that is they must be able to be applied in any
order and still end up with the same result.</p>
<p>When using out-of-order parallel replication, the current replica position in
the primary's binlog becomes multi-dimensional - each replication domain can
have reached a different point in the primary binlog at any one time. The
current position can be seen from the variable
<code class="highlight fixed" style="white-space:pre-wrap">gtid_slave_pos</code>. When the replica is stopped, restarted, or
switched to replicate from a different primary using CHANGE MASTER, MariaDB
automatically handles restarting each replication domain at the appropriate
point in the binlog.</p>
<p>Out-of-order parallel replication is disabled when
<a href="/kb/en/replication-and-binary-log-server-system-variables/#slave_parallel_mode">--slave-parallel-mode=minimal</a> (or none).</p>
<h2 class="anchored_heading" id="checking-worker-thread-status-in-show-processlist">Checking Worker Thread Status in SHOW PROCESSLIST</h2>
<p>The worker threads will be listed as "system user" in <a href="/kb/en/show-processlist/">SHOW PROCESSLIST</a>. Their
state will show the query they are currently working on, or it can show one of
these:</p>
<ul start="1"><li>"Waiting for work from main SQL threads". This means that the worker thread
is idle, no work is available for it at the moment.
</li><li>"Waiting for prior transaction to start commit before starting next
transaction". This means that the previous batch of transactions that
committed together on the primary primary has to complete first. This worker
thread is waiting for that to happen before it can start working on the
following batch.
</li><li>"Waiting for prior transaction to commit". This means that the transaction
has been executed by the worker thread. In order to ensure in-order commit,
the worker thread is waiting to commit until the previous transaction is ready
to commit before it.
</li></ul>
<h2 class="anchored_heading" id="expected-performance-gain">Expected Performance Gain</h2>
<p>Here is an article showing up to ten times improvement when using parallel
replication: <a href="http://kristiannielsen.livejournal.com/18435.html">http://kristiannielsen.livejournal.com/18435.html</a>.</p>
<h2 class="anchored_heading" id="configuring-the-maximum-size-of-the-parallel-replica-queue">Configuring the Maximum Size of the Parallel Replica Queue</h2>
<p>The <a href="/kb/en/replication-and-binary-log-server-system-variables/#slave_parallel_max_queued">slave_parallel_max_queued</a> system variable can be used to configure the maximum size of the parallel replica queue. This system variable is only meaningful when parallel
replication is configured (i.e. when <a href="/kb/en/replication-and-binary-log-server-system-variables/#slave_parallel_threads">slave_parallel_threads</a> &gt; <code>0</code>).</p>
<p>When parallel replication is used, the <a href="/kb/en/replication-threads/#slave-sql-thread">SQL thread</a> will read ahead in the relay logs, queueing events in memory while looking for opportunities for executing events in parallel. The <a href="/kb/en/replication-and-binary-log-server-system-variables/#slave_parallel_max_queued">slave_parallel_max_queued</a> system variable sets a
limit for how much memory it will use for this.</p>
<p>The configured value of the <a href="/kb/en/replication-and-binary-log-server-system-variables/#slave_parallel_max_queued">slave_parallel_max_queued</a> system variable is actually allocated for each <a href="/kb/en/replication-threads/#worker-threads">worker thread</a>, so the total allocation is actually equivalent to the following:</p>
<p><a href="/kb/en/replication-and-binary-log-server-system-variables/#slave_parallel_max_queued">slave_parallel_max_queued</a> * <a href="/kb/en/replication-and-binary-log-server-system-variables/#slave_parallel_threads">slave_parallel_threads</a></p>
<p>If this value is set too high, and the replica is far (eg. gigabytes of binlog)
behind the primary, then the <a href="/kb/en/replication-threads/#slave-sql-thread">SQL thread</a> can quickly read all of that and fill up memory with huge amounts of binlog events faster than the <a href="/kb/en/replication-threads/#worker-threads">worker threads</a> can consume them.</p>
<p>On the other hand, if set too low, the <a href="/kb/en/replication-threads/#slave-sql-thread">SQL thread</a> might not have sufficient space for queuing enough events to keep the worker threads busy, which could reduce performance. In this case, the <a href="/kb/en/replication-threads/#slave-sql-thread">SQL thread</a> will have the <a href="/kb/en/thread-states/">thread state</a> that states <code>Waiting for room in worker thread event queue</code>. For example:</p>
<pre class="fixed wrap">+----+-------------+-----------+------+---------+--------+-----------------------------------------------+------------------+----------+
| Id | User        | Host      | db   | Command | Time   | State                                         | Info             | Progress |
+----+-------------+-----------+------+---------+--------+-----------------------------------------------+------------------+----------+
|  3 | system user |           | NULL | Connect |    139 | closing tables                                | NULL             |    0.000 |
|  4 | system user |           | NULL | Connect |    139 | Waiting for work from SQL thread              | NULL             |    0.000 |
|  6 | system user |           | NULL | Connect | 264274 | Waiting for master to send event              | NULL             |    0.000 |
| 10 | root        | localhost | NULL | Sleep   |     43 |                                               | NULL             |    0.000 |
| 21 | system user |           | NULL | Connect |     45 | Waiting for room in worker thread event queue | NULL             |    0.000 |
| 54 | root        | localhost | NULL | Query   |      0 | init                                          | SHOW PROCESSLIST |    0.000 |
+----+-------------+-----------+------+---------+--------+-----------------------------------------------+------------------+----------+
</pre><p>The <a href="/kb/en/replication-and-binary-log-server-system-variables/#slave_parallel_max_queued">slave_parallel_max_queued</a> system variable does not define a hard limit, since the <a href="/kb/en/binary-log/">binary log</a> events that are currently executing always need to be held in-memory. This means that at least two events per <a href="/kb/en/replication-threads/#worker-threads">worker thread</a> can always be queued in-memory, regardless of the value of <a href="/kb/en/replication-and-binary-log-server-system-variables/#slave_parallel_threads">slave_parallel_threads</a>.</p>
<p>Usually, the <a href="/kb/en/replication-and-binary-log-server-system-variables/#slave_parallel_threads">slave_parallel_threads</a> system variable should be set large enough that the <a href="/kb/en/replication-threads/#slave-sql-thread">SQL thread</a> is able to read far enough ahead in the <a href="/kb/en/binary-log/">binary log</a> to exploit all possible parallelism. In normal operation, the replica will hopefully not be too far
behind, so there will not be a need to queue much data in-memory. The <a href="/kb/en/replication-and-binary-log-server-system-variables/#slave_parallel_max_queued">slave_parallel_max_queued</a> system variable could be set fairly high (eg. a few hundred kilobytes) to not limit throughtput. It should just be set low enough that total allocation of the parallel replica queue will not cause the server to run out of memory.</p>
<h2 class="anchored_heading" id="configuration-variable-slave_domain_parallel_threads">Configuration Variable slave_domain_parallel_threads</h2>
<p>The pool of replication worker threads is shared among all multi-source primary
connections, and among all replication domains that can replicate in parallel
using out-of-order.</p>
<p>If one primary connection or replication domain is currently processing a
long-running query, it is possible that it will allocate all the worker
threads in the pool, only to have them wait for the long-running query to
complete, stalling any other primary connection or replication domain, which
will have to wait for a worker thread to become free.</p>
<p>This can be avoided by setting
<a href="/kb/en/replication-and-binary-log-server-system-variables/#slave_domain_parallel_threads">slave_domain_parallel_threads</a> to a number that is lower
than <code class="highlight fixed" style="white-space:pre-wrap">slave_parallel_threads</code>. When set different from zero,
each replication domain in one primary connection can reserve at most that many
worker threads at any one time, leaving the rest (up to the value of
<a href="/kb/en/replication-and-binary-log-server-system-variables/#slave_parallel_threads">slave_parallel_threads</a>) free for other primary connections or replication domains to use in parallel.</p>
<p>The <code class="highlight fixed" style="white-space:pre-wrap">slave_domain_parallel_threads</code> variable is dynamic and
can be changed without restarting the server; all replicas must be stopped while
changing it, though.</p>
<h2 class="anchored_heading" id="implementation-details">Implementation Details</h2>
<p>The implementation is described in <a href="https://jira.mariadb.org/browse/MDEV-4506">MDEV-4506</a>.</p>
<h2 class="anchored_heading" id="see-also">See Also</h2>
<ul start="1"><li><a href="https://mariadb.com/blog/better-parallel-replication-mariadb-and-mysql">Better Parallel Replication for MariaDB and MySQL</a> (MariaDB.com blog)
</li><li><a href="https://mariadb.com/blog/evaluating-mariadb-mysql-parallel-replication-part-2-slave-group-commit">Evaluating MariaDB &amp; MySQL Parallel Replication Part 2: Slave Group Commit</a> (MariaDB.com blog)</li></ul>

    </div>


        
            <div id="subscribe" class="well well-small hide hidden-print"
                 data-subscribe-url="/kb/en/parallel-replication/+subscriptions/add"
                 data-unsubscribe-url="/kb/en/parallel-replication/+subscriptions/remove">
            </div>
        

        
        
    
        <div class="simple_section_nav">
            <ul class="nav nav-pills">
                
                    <li><a href="/kb/en/delayed-replication/">
                        ← Delayed Replication
                    </a>
                    </li>
                
                
                    <li><a href="/kb/en/high-availability-performance-tuning-mariadb-replication/">
                        ↑ MariaDB Replication ↑
                    </a>
                    </li>
                
                
                    <li class="pull-right"><a href="/kb/en/semisynchronous-replication/">
                        Semisynchronous Replication →
                    </a>
                    </li>
                
            </ul>
        </div>
    

        

        
        <h2>Comments</h2>
        
    
    <div id="comments" data-node-id="3930" data-comments-url="/kb/en/parallel-replication/+comments"
         data-reply-url="/kb/en/parallel-replication/comments/post/">
        Comments loading...
    </div>

        

    </div>


                    <div id="content_disclaimer" class="graybox">
                        Content reproduced on this site is the property of its respective owners,
                        and this content is not reviewed in advance by MariaDB. The views, information and opinions
                        expressed by this content do not necessarily represent those of MariaDB or any other party.
                    </div>
                </div>
            </section>

            
                <div id="right_bar" class="col-md-2">
                    
    
        
        <ul class="section_navigation well well-small hidden-xs hidden-sm">
            
                <li class="parent"><a href="/kb/en/high-availability-performance-tuning-mariadb-replication/">
                    ↑ MariaDB Replication ↑
                </a>
                </li>
            
            
                
                    <li>
                        <a href="/kb/en/replication-overview/">
                            
                            Replication Overview
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/replication-statements/">
                            <span class="pull-right not_primary"></span>
                            Replication Statements
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/setting-up-replication/">
                            
                            Setting Up Replication
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/setting-up-a-replica-with-mariabackup/">
                            <span class="pull-right not_primary"></span>
                            Setting up a Replica with Mariabackup
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/read-only-replicas/">
                            
                            Read-Only Replicas
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/replication-as-a-backup-solution/">
                            <span class="pull-right not_primary"></span>
                            Replication as a Backup Solution
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/multi-source-replication/">
                            
                            Multi-Source Replication
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/multi-master-ring-replication/">
                            
                            Multi-Master Ring Replication
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/using-mariadb-replication-with-mariadb-galera-cluster/">
                            <span class="pull-right not_primary"></span>
                            Using MariaDB Replication with MariaDB Galera Cluster
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/delayed-replication/">
                            
                            Delayed Replication
                        </a>
                    </li>
                
            
                
                    <li class="active">
                        <span>Parallel Replication</span>
                        
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/semisynchronous-replication/">
                            
                            Semisynchronous Replication
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/replication-threads/">
                            
                            Replication Threads
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/binary-log/">
                            <span class="pull-right not_primary"></span>
                            Binary Log
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/relay-log/">
                            <span class="pull-right not_primary"></span>
                            Relay Log
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/gtid/">
                            
                            Global Transaction ID
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/replication-and-binary-log-system-variables/">
                            
                            Replication and Binary Log System Variables
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/replication-and-binary-log-status-variables/">
                            
                            Replication and Binary Log Status Variables
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/unsafe-statements-for-statement-based-replication/">
                            
                            Unsafe Statements for Statement-based Replication
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/replication-and-foreign-keys/">
                            
                            Replication and Foreign Keys
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/enhancements-for-start-transaction-with-consistent-snapshot/">
                            
                            Enhancements for START TRANSACTION WITH CONSISTENT SNAPSHOT
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/group-commit-for-the-binary-log/">
                            <span class="pull-right not_primary"></span>
                            Group Commit for the Binary Log
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/selectively-skipping-replication-of-binlog-events/">
                            
                            Selectively Skipping Replication of Binlog Events
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/binlog-event-checksums/">
                            
                            Binlog Event Checksums
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/binlog-event-checksum-interoperability/">
                            
                            Binlog Event Checksum Interoperability
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/annotate_rows_log_event/">
                            <span class="pull-right not_primary"></span>
                            Annotate_rows_log_event
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/row-based-replication-with-no-primary-key/">
                            
                            Row-based Replication With No Primary Key
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/replication-filters/">
                            
                            Replication Filters
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/running-triggers-on-the-replica-for-row-based-events/">
                            
                            Running Triggers on the Replica for Row-based Events
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/replication-when-the-primary-and-replica-have-different-table-definitions/">
                            
                            Replication When the Primary and Replica Have Different Table Definitions
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/restricting-speed-of-reading-binlog-from-primary-by-a-replica/">
                            
                            Restricting Speed of Reading Binlog from Primary by a Replica
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/changing-a-replica-to-become-the-primary/">
                            
                            Changing a Replica to Become the Primary
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/replication-with-secure-connections/">
                            <span class="pull-right not_primary"></span>
                            Replication with Secure Connections
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/obsolete-replication-information/">
                            
                            Obsolete Replication Information
                        </a>
                    </li>
                
            
        </ul>
    
    

                </div>
            
        </div>
    </div>
</div>

<!-- Footer -->
<footer id="footer">
    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-xs-12">
                    <ul class="list-inline text-center footer-nav">
                        <li>
                            <h5>
                                <a href="https://mariadb.com/products" title="Products">Products</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/solutions" title="Solutions">Solutions</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/resources" title="Resources">Resources</a>
                            </h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/about-us" title="About MariaDB">Company</a></h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/pricing" title="Pricing">Pricing</a>
                            </h5>
                        </li>
                        
                        
                        <li>
                            <h5><a href="https://mariadb.com/downloads" title="Download">Download MariaDB</a></h5>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="row row-10">
                
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div id="block-footerformcontact" class="block block-block-content block-block-contentd754ee1b-3cc9-40e7-9ef4-f504f1197fb1">
                        
                            <h5 style="font-weight: 400;">Subscribe to our newsletter!</h5>
                            <script src="//app-sj15.marketo.com/js/forms2/js/forms2.min.js"></script><form id="mktoForm_1498"></form>
                            <script>
                                <!--//--><![CDATA[// ><!--
                                MktoForms2.loadForm("//app-sj15.marketo.com", "573-PXI-984", 1498);
                                //--><!]]]]><![CDATA[>
                                //--><!]]>
                            </script>
                        
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div class="footer-copyright">
                        <div class="text-center">
                            <ul class="list-inline no-margin">
                                <li>
                                    <a href="/legal" title="Legal">Legal</a>
                                </li>
                                <li>
                                    <a href="/privacy-policy" title="Privacy Policy">Privacy Policy</a>
                                </li>
                                <li>
                                    <a href="/cookie-policy/" title="Cookies">Cookie Policy</a>
                                </li>
                            </ul>
                            <p>Copyright &copy; 2025 MariaDB. All rights reserved.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</footer>
</div>

<div id="ajax_loading">
    <img src="/kb/static/images/ajax-loader.a51c5608d01a.gif" />
</div>

    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MK2847"
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MK2847');</script>
    <!-- End Google Tag Manager -->

</body>

<script type="text/javascript" src="/kb/static/js/main.1587e3a666fc.js" charset="utf-8"></script>

</html>