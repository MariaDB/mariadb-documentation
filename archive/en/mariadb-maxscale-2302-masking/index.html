<!DOCTYPE html>
<html>
<head data-cookie-domain=""
      data-cookie-path="/">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="apple-touch-icon" sizes="180x180" href="/kb/static/images/favicons/apple-touch-icon.159e713979be.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/kb/static/images/favicons/favicon-32x32.bc0ac1d5d11e.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/kb/static/images/favicons/favicon-16x16.5801f8f0f34e.png">
    <link rel="shortcut icon" href="/kb/static/images/favicons/favicon.d122d305dee4.ico" type="image/x-icon" />

    <title> Masking - MariaDB Knowledge Base</title>

    <link href="/kb/static/css/main.f7633538c846.css" rel="stylesheet" type="text/css" />

    

    

    <!-- FB Open Graph tags -->
    <meta property="og:title" content=" Masking" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://mariadb.com/kb/en/mariadb-maxscale-2302-masking/" />
    <meta property="og:image" content="http://mariadb.comaskmonty-logo.png" />
    <meta property="og:site_name" content="MariaDB KnowledgeBase" />
    <meta property="fb:admins" content="514852603" />
    <meta property="og:description" content="Masking
This filter was introduced in MariaDB MaxScale 2.1.


Masking
Overview
Security
Limitations
Configuration
Filter Parameters
rules
warn_type_mismatch
large_payload
prev..." />

    <meta name="description" content="Masking
This filter was introduced in MariaDB MaxScale 2.1.


Masking
Overview
Security
Limitations
Configuration
Filter Parameters
rules
warn_type_mismatch
large_payload
prev..." />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet"/>
    
</head>
<body class="mpkb nodes products nodes_view jqui" id="nodes_view">





<div id="menu-mobile" class="visible-sm visible-xs">

    <div>
        <div id="mobile-close-menu" class="text-right">
            <a href="javascript:void(0)" title="Close Menu" id="back-main" class="toggle-menu">X<span></span></a>
        </div>
    </div>
    <div class="mainmenu-mobile">
        <ul class="ls-none ul-menu">
            <li data-sub="submenu5"><a class="open-form-search" href="/kb/search/" title="Search">Search </a></li>
            <li data-sub="submenu0"><a href="/products" title="Products">Products</a><span class="arrow-main"></span></li>
            <li data-sub="submenu1"><a href="/services" title="Services">Services</a><span class="arrow-main"></span></li>
            <li data-sub="submenu2"><a href="/resources" title="Resources">Resources</a><span class="arrow-main"></span></li>
            <li data-sub="submenu3"><a href="/about-us" title="About">About</a><span class="arrow-main"></span></li>
            <li data-sub="submenu4"><a href="/contact" title="Contact">Contact</a></li>
        </ul>
    </div>

    <div class="nav-top-mobile">
        <div class="select-box form">

            <ul class="inline-block-md mb-none top-nav">
                <li>

                </li>
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/mariadb-maxscale-2302-masking/"> Login</a>
                    </li>
                
            </ul>



        </div>
        <p class="text-center copyright">Copyright &copy; 2024 MariaDB. All rights reserved.</p>
    </div>
</div>
<div class="violator-wrap d-none" id="top_violator">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12">
                <div class="violator-outer">
                    <div class="violator-inner">
                        <div class="row">
                            <div class="col-xs-12 col-sm-9 col-lg-7 col-lg-offset-2" id="top_violator_content">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="content-link" target="_blank" rel="nofollow noreferrer">
                                    <span>The Ultimate Guide to High Availability with MariaDB</span>
                                </a>
                            </div>
                            <div class="col-xs-12 col-sm-3" id="top_violator_cta">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="btn btn-mariadb" target="_blank" rel="nofollow noreferrer">Download Now</a>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-link close-btn">
                        <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24" width="15px" height="15px"><path d="M 4.9902344 3.9902344 A 1.0001 1.0001 0 0 0 4.2929688 5.7070312 L 10.585938 12 L 4.2929688 18.292969 A 1.0001 1.0001 0 1 0 5.7070312 19.707031 L 12 13.414062 L 18.292969 19.707031 A 1.0001 1.0001 0 1 0 19.707031 18.292969 L 13.414062 12 L 19.707031 5.7070312 A 1.0001 1.0001 0 0 0 18.980469 3.9902344 A 1.0001 1.0001 0 0 0 18.292969 4.2929688 L 12 10.585938 L 5.7070312 4.2929688 A 1.0001 1.0001 0 0 0 4.9902344 3.9902344 z"/></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="wrapper">
<div id="top-nav">
    <div class="container">
        <ul class="hidden-sm hidden-xs" >
            <li><a href="https://mariadb.com/kb/">Knowledge Base</a></li>
            <li><a href="https://mariadb.com/contact/">Contact</a></li>
            
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/mariadb-maxscale-2302-masking/" rel="nofollow">Login</a>
                    </li>
                
            
            
            <li id="search-form">
                <form action="/kb/en/+search/" method="get" id="search-block-form" accept-charset="UTF-8">
                    <input id="search" title="Enter the terms you wish to search for."
                           placeholder="Search . . ." type="text"
                           name="q" value="" size="15" maxlength="128" class="form-text"
                           data-autocomplete-url="/kb/en/+search/autocomplete/">
                    <input type="hidden" name="quick" value="1" />
                    <input type="hidden" name="source" value="kb" />
                </form>
            </li>
            <li><a id="search-toggler" href="/kb/search/">Search</a></li>
            
        </ul>
    </div>
</div>
<div id="navbar-bottom" class="navbar">
    <div class="container">
        
        
        
        
        <div class="row">
            <div class="col-md-3 col-sm-9 col-xs-9">
                <a class="brand" href="/" title="MariaDB">
                    <img src="/kb/static/images/logo-2018-black.95f5978ae14d.png">
                </a>
            </div>
            <div class="col-md-9 hidden-sm hidden-xs">
                <div class="main-menu">
                    <ul id="main-menu" class="nav navbar-nav inline-block-sm">
    <li class="has-sub full-menu">
        <a href="/products" title="Products">Products</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/services" title="Services">Services</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/pricing" title="Pricing">Pricing</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/resources" title="Resources">Resources</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/about-us" title="About Us">About Us</a>
    </li>
    <li class="">
        <a class="button electric-eel small top-bar-right-download" href="/downloads/">Download</a>
    </li>
</ul>
                </div>
            </div>
            <div class="col-md-3 visible-sm visible-xs col-sm-3 col-xs-3 ps-rv">
                <div class="navbar-header text-right pull-right">
                    <button type="button" class="menu-control toggle-menu" id="open-menu">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="main">
    <div class="container">
        

        <div id="subheader1" class="clearfix">
            <div class="pull-left">
                
                <div id="breadcrumbs" class="breadcrumb">
                    <a href="/kb/en/">Knowledge Base</a>
                    


    
    » <a class="crumb" href="/kb/en/maxscale/">MariaDB MaxScale</a>
    

    
    » <a class="crumb" href="/kb/en/mariadb-maxscale-23-02/">MariaDB MaxScale 23.02</a>
    

    
    » <a class="crumb" href="/kb/en/mariadb-maxscale-23-02-filters/">MaxScale 23.02 Filters</a>
    


    » <a class="node_link crumb" href="/kb/en/mariadb-maxscale-2302-masking/"> Masking</a>


                </div>
                
            </div>
        </div>
    </div>
    <div class="container" id="container-main">
        <div class="row">
            
            
                
                <aside id="sidebar-first" class="sidebar col-md-2 hidden-xs hidden-sm hidden-print">
                    
                        
                        <ul id="category_menu" class="nav nav-pills nav-stacked">
                            <li><a href="/kb/en/">Home</a></li>
                            
                                
                                    <li><a href="/kb/en/+questions/">Open Questions</a></li>
                                
                                <li><a href="/kb/en/documentation/">MariaDB Server</a></li>
                                <li><a href="/kb/en/maxscale/">MariaDB MaxScale</a></li>
                                <li><a href="/kb/en/mariadb-columnstore/">MariaDB ColumnStore</a></li>
                                <li><a href="/kb/en/connectors/">Connectors</a></li>
                            

                        </ul>
                    

                    
<div>



<div class="well well-small box actions"><div>

        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/mariadb-maxscale-2302-masking/+history" rel="nofollow">History</a>
        
        
        
        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/mariadb-maxscale-2302-masking/+source/">Source</a>
        
        <a class="btn btn-block btn-blue btn-sm flag" href="/kb/en/mariadb-maxscale-2302-masking/+flag"
                data-flag-url="/kb/en/mariadb-maxscale-2302-masking/+flag" rel="nofollow">
                Flag as Spam / Inappropriate</a>
        
        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/mariadb-maxscale-2302-masking/+translate/">
                Translate</a>
        

</div>
</div>





<div class="well well-small box node_info"><div>

    <dl>
        <dt>Created</dt>
        <dd>

<span class="datetime" title="2023-02-27 21:22">1 year, 6 months ago</span></dd>

        <dt>Modified</dt>
        <dd>

<span class="datetime" title="2023-02-27 21:22">1 year, 6 months ago</span></dd>

        <dt>Type</dt>
        <dd>article</dd>

        <dt>Status</dt>
        <dd>active</dd>

        <dt>License</dt>
        <dd>
            
                <a href="/kb/en/mariadb-maxscale-2302-masking/+license/">CC BY-SA / Gnu FDL</a>
            
        </dd>

        
        <dt>Source</dt>
        <dd><a href="https://github.com/mariadb-corporation/MaxScale/blob/23.02.10/Documentation/Filters/Masking.md">GitHub</a></dd>
        
    </dl>

    
    <ul class="rss_feeds">
        <li><a href="/kb/en/mariadb-maxscale-2302-masking/+history/feed/">
            History</a>
        </li>
        <li><a href="/kb/en/mariadb-maxscale-2302-masking/+comments/feed/">
            Comments</a>
        </li>
    </ul>
    

</div>
</div>





    
    
    

<div class="well well-small box attachments"><div><div class="edit_link pull-right"><a href="/kb/en/mariadb-maxscale-2302-masking/+edit/attachments/">Edit</a></div><h5>Attachments</h5></div><div>

        
            <div class="no_data">No attachments exist</div>
        
    
</div>
</div>

    



    
    






</div>


                    

































                </aside>
            
            
            
                
            
            
                
            
            <section id="content" class="limited_width col-md-8 clearfix">
                
                    <h1> Masking</h1>
                

                



                <div>
                    
    

    
    
    

    <div class="node creole">
        
        
        


    
    <div class="answer formatted">
        <h1 id="masking">Masking</h1>
<p>This filter was introduced in MariaDB MaxScale 2.1.</p>
<div>
<ul>
<li><a href="#masking">Masking</a><ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#security">Security</a></li>
<li><a href="#limitations">Limitations</a></li>
<li><a href="#configuration">Configuration</a><ul>
<li><a href="#filter-parameters">Filter Parameters</a><ul>
<li><a href="#rules">rules</a></li>
<li><a href="#warn_type_mismatch">warn_type_mismatch</a></li>
<li><a href="#large_payload">large_payload</a></li>
<li><a href="#prevent_function_usage">prevent_function_usage</a></li>
<li><a href="#require_fully_parsed">require_fully_parsed</a></li>
<li><a href="#treat_string_arg_as_field">treat_string_arg_as_field</a></li>
<li><a href="#check_user_variables">check_user_variables</a></li>
<li><a href="#check_unions">check_unions</a></li>
<li><a href="#check_subqueries">check_subqueries</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#rules_1">Rules</a><ul>
<li><a href="#replace">replace</a></li>
<li><a href="#obfuscate">obfuscate</a></li>
<li><a href="#with">with</a></li>
<li><a href="#applies_to">applies_to</a></li>
<li><a href="#exempted">exempted</a></li>
</ul>
</li>
<li><a href="#module-commands">Module commands</a><ul>
<li><a href="#reload">reload</a></li>
</ul>
</li>
<li><a href="#example">Example</a><ul>
<li><a href="#configuration_1">Configuration</a></li>
<li><a href="#masking_rulesjson">masking_rules.json</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<h2 id="overview">Overview</h2>
<p>With the <em>masking</em> filter it is possible to obfuscate the returned
value of a particular column.</p>
<p>For instance, suppose there is a table <em>person</em> that, among other
columns, contains the column <em>ssn</em> where the social security number
of a person is stored.</p>
<p>With the masking filter it is possible to specify that when the <em>ssn</em>
field is queried, a masked value is returned unless the user making
the query is a specific one. That is, when making the query</p>
<div><pre><span></span>&gt; SELECT name, ssn FROM person;
</pre></div>


<p>instead of getting the real result, as in</p>
<div><pre><span></span>+-------+-------------+
+ name  | ssn         |
+-------+-------------+
| Alice | 721-07-4426 |
| Bob   | 435-22-3267 |
...
</pre></div>


<p>the <em>ssn</em> would be masked, as in</p>
<div><pre><span></span>+-------+-------------+
+ name  | ssn         |
+-------+-------------+
| Alice | XXX-XX-XXXX |
| Bob   | XXX-XX-XXXX |
...
</pre></div>


<p>Note that the masking filter should be viewed as a best-effort solution
intended for protecting against accidental misuse rather than malicious
attacks.</p>
<h2 id="security">Security</h2>
<p>From MaxScale 2.3 onwards, the masking filter will reject statements
that use functions in conjunction with columns that should be masked.
Allowing function usage provides a way for circumventing the masking,
unless a firewall filter is separately configured and installed.</p>
<p>Please see the configuration parameter
<a href="#prevent_function_usage">prevent_function_usage</a>
for how to change the default behaviour.</p>
<p>From MaxScale 2.3.5 onwards, the masking filter will check the
definition of user variables and reject statements that define a user
variable using a statement that refers to columns that should be masked.</p>
<p>Please see the configuration parameter
<a href="#check_user_variables">check_user_variables</a>
for how to change the default behaviour.</p>
<p>From MaxScale 2.3.5 onwards, the masking filter will examine unions
and if the second or subsequent SELECT refer to columns that should
be masked, the statement will be rejected.</p>
<p>Please see the configuration parameter
<a href="#check_unions">check_unions</a>
for how to change the default behaviour.</p>
<p>From MaxScale 2.3.5 onwards, the masking filter will examine subqueries
and if a subquery refers to columns that should be masked, the statement
will be rejected.</p>
<p>Please see the configuration parameter
<a href="#check_subqueries">check_subqueries</a>
for how to change the default behaviour.</p>
<p>Note that in order to ensure that it is not possible to get access to
masked data, the privileges of the users should be minimized. For instance,
if a user can create tables and perform inserts, he or she can execute
something like</p>
<div><pre><span></span>CREATE TABLE cheat (revealed_ssn TEXT);
INSERT INTO cheat SELECT ssn FROM users;
SELECT revealed_ssn FROM cheat;
</pre></div>


<p>to get access to the cleartext version of a masked field <code>ssn</code>.</p>
<p>From MaxScale 2.3.5 onwards, the masking filter will, if any of the
<code>prevent_function_usage</code>, <code>check_user_variables</code>, <code>check_unions</code> or
<code>check_subqueries</code> parameters is set to true, block statements that
cannot be fully parsed.</p>
<p>Please see the configuration parameter
<a href="#require_fully_parsed">require_fully_parsed</a>
for how to change the default behaviour.</p>
<p>From MaxScale 2.3.7 onwards, the masking filter will treat any strings
passed to functions as if they were fields. The reason is that as the
MaxScale query classifier is not aware of whether <code>ANSI_QUOTES</code> is
enabled or not, it is possible to bypass the masking by turning that
option on.</p>
<div><pre><span></span>mysql&gt; set @@sql_mode = 'ANSI_QUOTES';
mysql&gt; select concat("ssn") from managers;
</pre></div>


<p>Before this change, the content of the field <code>ssn</code> would have been
returned in clear text even if the column should have been masked.</p>
<p>Note that this change will mean that there may be false positives
if <code>ANSI_QUOTES</code> is not enabled and a string argument happens to
be the same as the name of a field to be masked.</p>
<p>Please see the configuration parameter
[treat_string_arg_as_field(#treat_string_arg_as_field)
for how to change the default behaviour.</p>
<h2 id="limitations">Limitations</h2>
<p>The masking filter can <em>only</em> be used for masking columns of the following
types: <code>BINARY</code>, <code>VARBINARY</code>, <code>CHAR</code>, <code>VARCHAR</code>, <code>BLOB</code>, <code>TINYBLOB</code>,
<code>MEDIUMBLOB</code>, <code>LONGBLOB</code>, <code>TEXT</code>, <code>TINYTEXT</code>, <code>MEDIUMTEXT</code>, <code>LONGTEXT</code>,
<code>ENUM</code> and <code>SET</code>. If the type of the column is something else, then no
masking will be performed.</p>
<p>Currently, the masking filter can only work on packets whose payload is less
than 16MB. If the masking filter encounters a packet whose payload is exactly
that, thus indicating a situation where the payload is delivered in multiple
packets, the value of the parameter <code>large_payloads</code> specifies how the masking
filter should handle the situation.</p>
<h2 id="configuration">Configuration</h2>
<p>The masking filter is taken into use with the following kind of
configuration setup.</p>
<div><pre><span></span>[Mask-SSN]
type=filter
module=masking
rules=...

[SomeService]
type=service
...
filters=Mask-SSN
</pre></div>


<h3 id="filter-parameters">Filter Parameters</h3>
<p>The masking filter has one mandatory parameter - <code>rules</code>.</p>
<h4 id="rules"><code>rules</code></h4>
<p>Specifies the path of the file where the masking rules are stored.
A relative path is interpreted relative to the <em>module configuration directory</em>
of MariaDB MaxScale. The default module configuration directory is
<em>/etc/maxscale.modules.d</em>.</p>
<div><pre><span></span>rules=/path/to/rules-file
</pre></div>


<h4 id="warn_type_mismatch"><code>warn_type_mismatch</code></h4>
<p>With this optional parameter the masking filter can be instructed to log
a warning if a masking rule matches a column that is not of one of the
allowed types.</p>
<p>The values that can be used are <code>never</code> and <code>always</code>, with <code>never</code> being
the default.</p>
<div><pre><span></span>warn_type_mismatch=always
</pre></div>


<h4 id="large_payload"><code>large_payload</code></h4>
<p>This optional parameter specifies how the masking filter should treat
payloads larger than <code>16MB</code>, that is, payloads that are delivered in
multiple MySQL protocol packets.</p>
<p>The values that can be used are <code>ignore</code>, which means that columns in
such payloads are not masked, and <code>abort</code>, which means that if such
payloads are encountered, the client connection is closed. The default
is <code>abort</code>.</p>
<p>Note that the aborting behaviour is applied only to resultsets that
contain columns that should be masked. There are <em>no</em> limitations on
resultsets that do not contain such columns.</p>
<div><pre><span></span>large_payload=ignore
</pre></div>


<h4 id="prevent_function_usage"><code>prevent_function_usage</code></h4>
<p>This optional parameter specifies how the masking filter should behave
if a column that should be masked, is used in conjunction with some
function. As the masking filter works <em>only</em> on the basis of the
information in the returned result-set, if the name of a column is
not present in the result-set, then the masking filter cannot mask a
value. This means that the masking filter basically can be bypassed
with a query like:</p>
<div><pre><span></span>SELECT CONCAT(masked_column) FROM tbl;
</pre></div>


<p>If the value of <code>prevent_function_usage</code> is <code>true</code>, then all
statements that contain functions referring to masked columns will
be rejected. As that means that also queries using potentially
harmless functions, such as <code>LENGTH(masked_column)</code>, are rejected
as well, this feature can be turned off. In that case, the firewall
filter should be setup to allow or reject the use of certain functions.</p>
<div><pre><span></span>prevent_function_usage=false
</pre></div>


<p>The default value is <code>true</code>.</p>
<h4 id="require_fully_parsed"><code>require_fully_parsed</code></h4>
<p>This optional parameter specifies how the masking filter should
behave in case any of <code>prevent_function_usage</code>, <code>check_user_variables</code>,
<code>check_unions</code> or <code>check_subqueries</code> is true and it encounters a
statement that cannot be fully parsed,</p>
<p>If true, then statements that cannot be fully parsed (due to a
parser limitation) will be blocked.</p>
<div><pre><span></span>require_fully_parsed=false
</pre></div>


<p>The default value is <code>true</code>.</p>
<p>Note that if this parameter is set to false, then <code>prevent_function_usage</code>,
<code>check_user_variables</code>, <code>check_unions</code> and <code>check_subqueries</code> are rendered
less effective, as it with a statement that can not be fully parsed may be
possible to bypass the protection that they are intended to provide.</p>
<h4 id="treat_string_arg_as_field"><code>treat_string_arg_as_field</code></h4>
<p>This optional parameter specifies how the masking filter should treat
strings used as arguments to functions. If true, they will be handled
as fields, which will cause fields to be masked even if <code>ANSI_QUOTES</code> has
been enabled and <code>"</code> is used instead of backtick.</p>
<div><pre><span></span>treat_string_arg_as_field=false
</pre></div>


<p>The default value is <code>true</code>.</p>
<h4 id="check_user_variables"><code>check_user_variables</code></h4>
<p>This optional parameter specifies how the masking filter should
behave with respect to user variables. If true, then a statement like</p>
<div><pre><span></span>set @a = (select ssn from customer where id = 1);
</pre></div>


<p>will be rejected if <code>ssn</code> is a column that should be masked.</p>
<div><pre><span></span>check_user_variables=false
</pre></div>


<p>The default value is <code>true</code>.</p>
<h4 id="check_unions"><code>check_unions</code></h4>
<p>This optional parameter specifies how the masking filter should
behave with respect to UNIONs. If true, then a statement like</p>
<div><pre><span></span>SELECT a FROM t1 UNION select b from t2;
</pre></div>


<p>will be rejected if <code>b</code> is a column that should be masked.</p>
<div><pre><span></span>check_unions=false
</pre></div>


<p>The default value is <code>true</code>.</p>
<h4 id="check_subqueries"><code>check_subqueries</code></h4>
<p>This optional parameter specifies how the masking filter should
behave with respect to subqueries. If true, then a statement like</p>
<div><pre><span></span>SELECT * FROM (SELECT a as b FROM t1) as t2;
</pre></div>


<p>will be rejected if <code>a</code> is a column that should be masked.</p>
<div><pre><span></span>check_subqueries=false
</pre></div>


<p>The default value is <code>true</code>.</p>
<h2 id="rules_1">Rules</h2>
<p>The masking rules are expressed as a JSON object.</p>
<p>The top-level object is expected to contain a key <code>rules</code> whose
value is an array of rule objects.</p>
<div><pre><span></span>{
    "rules": [ ... ]
}
</pre></div>


<p>Each rule in the rules array is a JSON object, expected to
contain the keys <code>replace</code>, <code>with</code>, <code>applies_to</code> and
<code>exempted</code>. The two former ones are obligatory and the two
latter ones optional.</p>
<div><pre><span></span>{
    "rules": [
        {
            "replace": { ... },
            "with": { ... },
            "applies_to": [ ... ],
            "exempted": [ ... ]
        }
    ]
}
</pre></div>


<h3 id="replace"><code>replace</code></h3>
<p>The value of this key is an object that specifies the column
whose values should be masked. The object must contain the key
<code>column</code> and may contain the keys <code>table</code> and <code>database</code>. The
value of these keys must be a string.</p>
<p>If only <code>column</code> is specified, then a column with that name
matches irrespective of the table and database. If <code>table</code>
is specified, then the column matches only if it is in a table
with the specified name, and if <code>database</code> is specified when
the column matches only if it is in a database with the
specified name.</p>
<div><pre><span></span>{
    "rules": [
        {
            "replace": {
                "database": "db1",
                "table": "person",
                "column": "ssn"
            },
            "with": { ... },
            "applies_to": [ ... ],
            "exempted": [ ... ]
        }
    ]
}
</pre></div>


<p><strong>NOTE</strong> If a rule contains a table/database then if the resultset
does <em>not</em> contain table/database information, it will always be
considered a match if the column matches. For instance, given the
rule above, if there is a table <code>person2</code>, also containing an <code>ssn</code>
field, then a query like</p>
<div><pre><span></span>SELECT ssn FROM person2;
</pre></div>


<p>will not return masked values, but a query like</p>
<div><pre><span></span>SELECT ssn FROM person UNION SELECT ssn FROM person2;
</pre></div>


<p>will <em>only</em> return masked values, even if the <code>ssn</code> values from
<code>person2</code> in principle should not be masked. The same effect is
observed even with a nonsensical query like</p>
<div><pre><span></span>SELECT ssn FROM person2 UNION SELECT ssn FROM person2;
</pre></div>


<p>even if nothing from <code>person2</code> should be masked. The reason is that
as the resultset contains no table information, the values must be
masked if the column name matches, as otherwise the masking could
easily be circumvented with a query like</p>
<div><pre><span></span>SELECT ssn FROM person UNION SELECT ssn FROM person;
</pre></div>


<p>The optional key <code>match</code> makes partial replacement of the original
value possible: only the matched part would be replaced
with the fill character.
The <code>match</code> value must be a valid pcre2 regular expression.</p>
<div><pre><span></span>            "replace": {
                "column": "ssn",
                "match": "(123)"
            },
            "with": {
                "fill": "X#"
            }
</pre></div>


<h3 id="obfuscate"><code>obfuscate</code></h3>
<p>The obfuscate rule allows the obfuscation of the value
by passing it through an obfuscation algorithm.
Current solution uses a non-reversible obfuscation approach.</p>
<p>However, note that although it is in principle impossible to obtain the
original value from the obfuscated one, if the range of possible original
values is limited, it is straightforward to figure out the possible
original values by running all possible values through the obfuscation
algorithm and then comparing the results.</p>
<p>The minimal configuration is:</p>
<div><pre><span></span>            "obfuscate": {
                "column": "name"
            }
</pre></div>


<p>Output example for Db field <code>name</code> = 'remo'</p>
<div><pre><span></span>SELECT name from db1.tbl1;`

+------+
| name |
+------+
| $-~) |
+------+
</pre></div>


<h3 id="with"><code>with</code></h3>
<p>The value of this key is an object that specifies what the value of the matched
column should be replaced with for the <code>replace</code> rule. Currently, the object
is expected to contain either the key <code>value</code> or the key <code>fill</code>.
The value of both must be a string with length greater than zero.
If both keys are specified, <code>value</code> takes precedence.
If <code>fill</code> is not specified, the default <code>X</code> is used as its value.</p>
<p>If <code>value</code> is specified, then its value is used to replace the actual value
verbatim and the length of the specified value must match the actual returned
value (from the server) exactly. If the lengths do not match, the value of
<code>fill</code> is used to mask the actual value.</p>
<p>When the value of <code>fill</code> (fill-value) is used for masking the returned value,
the fill-value is used as many times as necessary to match the length of the
return value. If required, only a part of the fill-value may be used in the end
of the mask value to get the lengths to match.</p>
<div><pre><span></span>{
    "rules": [
        {
            "replace": {
                "column": "ssn"
            },
            "with": {
                "value": "XXX-XX-XXXX"
            },
            "applies_to": [ ... ],
            "exempted": [ ... ]
        },
        {
            "replace": {
                "column": "age"
            },
            "with": {
                "fill": "*"
            },
            "applies_to": [ ... ],
            "exempted": [ ... ]
        },
        {
            "replace": {
                "column": "creditcard"
            },
            "with": {
                "value": "1234123412341234",
                "fill": "0"
            },
            "applies_to": [ ... ],
            "exempted": [ ... ]
        },
    ]
}
</pre></div>


<h3 id="applies_to"><code>applies_to</code></h3>
<p>With this <em>optional</em> key, whose value must be an array of strings,
it can be specified what users the rule is applied to. Each string
should be a MariaDB account string, that is, <code>%</code> is a wildcard.</p>
<div><pre><span></span>{
    "rules": [
        {
            "replace": { ... },
            "with": { ... },
            "applies_to": [ "'alice'@'host'", "'bob'@'%'" ],
            "exempted": [ ... ]
        }
    ]
}
</pre></div>


<p>If this key is not specified, then the masking is performed for all
users, except the ones exempted using the key <code>exempted</code>.</p>
<h3 id="exempted"><code>exempted</code></h3>
<p>With this <em>optional</em> key, whose value must be an array of strings,
it can be specified what users the rule is <em>not</em> applied to. Each
string should be a MariaDB account string, that is, <code>%</code> is a wildcard.</p>
<div><pre><span></span>{
    "rules": [
        {
            "replace": { ... },
            "with": { ... },
            "applies_to": [ ... ],
            "exempted": [ "'admin'" ]
        }
    ]
}
</pre></div>


<h2 id="module-commands">Module commands</h2>
<p>Read <a href="/kb/en/mariadb-maxscale-2302-module-commands/">Module Commands</a> documentation for details
about module commands.</p>
<p>The masking filter supports the following module commands.</p>
<h3 id="reload"><code>reload</code></h3>
<p>Reload the rules from the rules file. The new rules are taken into use
only if the loading succeeds without any errors.</p>
<div><pre><span></span>MaxScale&gt; call command masking reload MyMaskingFilter
</pre></div>


<p><code>MyMaskingFilter</code> refers to a particular filter section in the
MariaDB MaxScale configuration file.</p>
<h2 id="example">Example</h2>
<p>In the following we configure a masking filter <em>MyMasking</em> that should always log a
warning if a masking rule matches a column that is of a type that cannot be masked,
and that should abort the client connection if a resultset package is larger than
16MB. The rules for the masking filter are in the file <code>masking_rules.json</code>.</p>
<h3 id="configuration_1">Configuration</h3>
<div><pre><span></span>[MyMasking]
type=filter
module=masking
warn_type_mismatch=always
large_payload=abort
rules=masking_rules.json

[MyService]
type=service
...
filters=MyMasking
</pre></div>


<h3 id="masking_rulesjson"><code>masking_rules.json</code></h3>
<p>The rules specify that the data of a column whose name is <code>ssn</code>, should
be replaced with the string <em>012345-ABCD</em>. If the length of the data is
not exactly the same as the length of the replacement value, then the
data should be replaced with as many <em>X</em> characters as needed.</p>
<div><pre><span></span>{
    "rules": [
        {
            "replace": {
                "column": "ssn"
            },
            "with": {
                "value": "012345-ABCD",
                "fill": "X"
            }
        }
    ]
}
</pre></div>
    </div>


        
            <div id="subscribe" class="well well-small hide hidden-print"
                 data-subscribe-url="/kb/en/mariadb-maxscale-2302-masking/+subscriptions/add"
                 data-unsubscribe-url="/kb/en/mariadb-maxscale-2302-masking/+subscriptions/remove">
            </div>
        

        
        
    
        <div class="simple_section_nav">
            <ul class="nav nav-pills">
                
                    <li><a href="/kb/en/mariadb-maxscale-2302-lua-filter/">
                        ←  Lua Filter
                    </a>
                    </li>
                
                
                    <li><a href="/kb/en/maxscale-23-02-filters/">
                        ↑ MaxScale 23.02 Filters ↑
                    </a>
                    </li>
                
                
                    <li class="pull-right"><a href="/kb/en/mariadb-maxscale-2302-maxrows/">
                         Maxrows →
                    </a>
                    </li>
                
            </ul>
        </div>
    

        

        
        <h2>Comments</h2>
        
    
    <div id="comments" data-node-id="12137" data-comments-url="/kb/en/mariadb-maxscale-2302-masking/+comments"
         data-reply-url="/kb/en/mariadb-maxscale-2302-masking/comments/post/">
        Comments loading...
    </div>

        

    </div>


                    <div id="content_disclaimer" class="graybox">
                        Content reproduced on this site is the property of its respective owners,
                        and this content is not reviewed in advance by MariaDB. The views, information and opinions
                        expressed by this content do not necessarily represent those of MariaDB or any other party.
                    </div>
                </div>
            </section>

            
                <div id="right_bar" class="col-md-2">
                    
    
        
        <ul class="section_navigation well well-small hidden-xs hidden-sm">
            
                <li class="parent"><a href="/kb/en/maxscale-23-02-filters/">
                    ↑ MaxScale 23.02 Filters ↑
                </a>
                </li>
            
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-2302-binlog-filter/">
                            
                             Binlog Filter
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-2302-cache/">
                            
                             Cache
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-2302-comment-filter/">
                            
                             Comment Filter
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-2302-consistent-critical-read-filter/">
                            
                             Consistent Critical Read Filter
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-2302-hintfilter/">
                            
                             Hintfilter
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-2302-lua-filter/">
                            
                             Lua Filter
                        </a>
                    </li>
                
            
                
                    <li class="active">
                        <span> Masking</span>
                        
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-2302-maxrows/">
                            
                             Maxrows
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-2302-named-server-filter/">
                            
                             Named Server Filter
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-2302-query-log-all-filter/">
                            
                             Query Log All Filter
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-2302-regex-filter/">
                            
                             Regex Filter
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-2302-rewrite-filter/">
                            
                             Rewrite Filter
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-2302-tee-filter/">
                            
                             Tee Filter
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-2302-throttle/">
                            
                             Throttle
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-2302-top-filter/">
                            
                             Top Filter
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-maxscale-2302-transaction-performance-monitoring-filter/">
                            
                             Transaction Performance Monitoring Filter
                        </a>
                    </li>
                
            
        </ul>
    
    

                </div>
            
        </div>
    </div>
</div>

<!-- Footer -->
<footer id="footer">
    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-xs-12">
                    <ul class="list-inline text-center footer-nav">
                        <li>
                            <h5>
                                <a href="https://mariadb.com/products" title="Products">Products</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/services" title="Services">Services</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/pricing" title="Pricing">Pricing</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/resources" title="Resources">Resources</a>
                            </h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/about-us" title="About MariaDB">About Us</a></h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/download" title="Download">Download MariaDB</a></h5>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="row row-10">
                
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div id="block-footerformcontact" class="block block-block-content block-block-contentd754ee1b-3cc9-40e7-9ef4-f504f1197fb1">
                        
                            <h5 style="font-weight: 400;">Subscribe to our newsletter!</h5>
                            <script src="//app-sj15.marketo.com/js/forms2/js/forms2.min.js"></script><form id="mktoForm_1498"></form>
                            <script>
                                <!--//--><![CDATA[// ><!--
                                MktoForms2.loadForm("//app-sj15.marketo.com", "573-PXI-984", 1498);
                                //--><!]]]]><![CDATA[>
                                //--><!]]>
                            </script>
                        
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div class="footer-copyright">
                        <div class="text-center">
                            <ul class="list-inline no-margin">
                                <li>
                                    <a href="/legal" title="Legal">Legal</a>
                                </li>
                                <li>
                                    <a href="/privacy-policy" title="Privacy Policy">Privacy Policy</a>
                                </li>
                                <li>
                                    <a href="/cookie-policy/" title="Cookies">Cookie Policy</a>
                                </li>
                            </ul>
                            <p>Copyright &copy; 2024 MariaDB. All rights reserved.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</footer>
</div>

<div id="ajax_loading">
    <img src="/kb/static/images/ajax-loader.a51c5608d01a.gif" />
</div>

    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MK2847"
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MK2847');</script>
    <!-- End Google Tag Manager -->

</body>

<script type="text/javascript" src="/kb/static/js/main.1587e3a666fc.js" charset="utf-8"></script>

</html>