<?xml version="1.0" encoding="utf-8"?>
<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title>MariaDB Knowledge Base Comments for: Generated (Virtual and Persistent/Stored) Columns</title><link>https://mariadb.com/kb/en/generated-columns/+comments/feed/</link><description></description><atom:link href="https://mariadb.com/kb/en/generated-columns/+comments/feed/" rel="self"></atom:link><language>en-us</language><lastBuildDate>Mon, 18 Mar 2024 19:04:58 +0000</lastBuildDate><item><title>Re: Future plans to allow deterministic functions in virtual column definitions?</title><link>https://mariadb.com/kb/en/generated-columns/+comments/3623</link><description>&lt;p&gt;Not at the moment, sorry. But you can create a task at jira.mariadb.org to make sure your request isn't forgotten.&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Sergei Golubchik</dc:creator><guid>https://mariadb.com/kb/en/generated-columns/+comments/3623</guid></item><item><title>Future plans to allow deterministic functions in virtual column definitions?</title><link>https://mariadb.com/kb/en/generated-columns/+comments/3616</link><description>&lt;p&gt;Are there plans to add support for using deterministic stored functions in the definition of a virtual column?&lt;/p&gt;
&lt;p&gt;I could just make a new view that selects all the entries from the table and then applies the functions to the new columns, but I would prefer to keep the data in the same table rather than in a separate view.  More importantly, the virtual columns allow me to refer to the value of previously-defined columns but defining a view for this derived data either requires me to use a doubly-nested subquery or to manually expand the column definitions until they no longer require reference to previous columns.&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/"> </dc:creator><guid>https://mariadb.com/kb/en/generated-columns/+comments/3616</guid></item><item><title>Re: Avoiding warnings</title><link>https://mariadb.com/kb/en/generated-columns/+comments/3464</link><description>&lt;p&gt;Thanks! I changed the variable, and things are working again... until the next reboot...&lt;/p&gt;
&lt;p&gt;Is the preferred way of persisting this to put it in /etc/my.cnf, or should I start mysqld with "--sql_mode" set appropriately?&lt;/p&gt;
&lt;p&gt;Jan&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Jan Steinman</dc:creator><guid>https://mariadb.com/kb/en/generated-columns/+comments/3464</guid></item><item><title>Re: Avoiding warnings</title><link>https://mariadb.com/kb/en/generated-columns/+comments/3463</link><description>&lt;p&gt;Yes, see STRICT_TRANS_TABLES and STRICT_ALL_TABLES values in &lt;a href="/kb/en/sql_mode/"&gt;sql_mode&lt;/a&gt; variable.&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Sergei Golubchik</dc:creator><guid>https://mariadb.com/kb/en/generated-columns/+comments/3463</guid></item><item><title>Re: Avoiding warnings</title><link>https://mariadb.com/kb/en/generated-columns/+comments/3460</link><description>&lt;p&gt;How can one avoid getting warnings when there is an attempt to change a generated column?&lt;/p&gt;
&lt;p&gt;I'm doing data entry using Sequel Pro (on Mac), and I will often duplicate and edit a row that is similar to the one I need.&lt;/p&gt;
&lt;p&gt;It used to let me do that, and would simply "fix" the generated column appropriately. For example, I often use a generated column to show the day of the week for a DATE column. On duplication, modification of the DATE field, and saving, the day of week would change properly.&lt;/p&gt;
&lt;p&gt;But now, I get a notifier: "Unable to write row. The value specified for generated column 'Day' in table 's_product_sales_log' ignored."&lt;/p&gt;
&lt;p&gt;It was successfully ignoring such things, but then I had a power failure, and then something changed. I must have changed some dynamic variable to get it to work properly before.&lt;/p&gt;
&lt;p&gt;In grepping through the variables, I see:&lt;/p&gt;
&lt;p&gt;• innodb_strict_mode     OFF&lt;/p&gt;
&lt;ul start="1"&gt;&lt;li&gt;sql_warnings     OFF
&lt;/li&gt;&lt;/ul&gt;
&lt;p&gt;Is there something else I need to set to allow this?&lt;/p&gt;
&lt;p&gt;Some of my schemas have four or more generated columns. Tabbing through and putting NULL in each one, when all I want to do is have a duplicate record that differs by ONE field, is very tedious!&lt;/p&gt;
&lt;p&gt;Thanks!&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Jan Steinman</dc:creator><guid>https://mariadb.com/kb/en/generated-columns/+comments/3460</guid></item><item><title>Re: Virtual (Computed) Columns</title><link>https://mariadb.com/kb/en/generated-columns/+comments/2972</link><description>&lt;p&gt;Thank you description.
If Virtual generate when we the table queried, Could you explain How is the index create and work when you create index on Virtual column (not PERSISTENT).&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Hamoon Mohammadian Pour</dc:creator><guid>https://mariadb.com/kb/en/generated-columns/+comments/2972</guid></item><item><title>Re: Virtual (Computed) Columns</title><link>https://mariadb.com/kb/en/generated-columns/+comments/2167</link><description>&lt;p&gt;For &lt;code&gt;PERSISTENT&lt;/code&gt; columns non-deterministic expressions of course are meaningless. For &lt;code&gt;VIRTUAL&lt;/code&gt; columns it could make sense. Though, it would be the same as &lt;code&gt;SELECT&lt;/code&gt; with explicitly written expression. So yes, that my post is stupid.&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">guest guest</dc:creator><guid>https://mariadb.com/kb/en/generated-columns/+comments/2167</guid></item><item><title>Re: Virtual (Computed) Columns</title><link>https://mariadb.com/kb/en/generated-columns/+comments/2148</link><description>&lt;p&gt;Computed columns can only come from static, deterministic values.&lt;/p&gt;
&lt;p&gt;You may find that "unfortunate," but I am having trouble understanding your desired semantics.&lt;/p&gt;
&lt;p&gt;Do you intend the value of your expression to be frozen upon first evaluation, or rather to be updated (with NOW()) on every access?&lt;/p&gt;
&lt;p&gt;The former can be done with a function or a simple UPDATE statement. The latter would seem to be quite costly.&lt;/p&gt;
&lt;p&gt;One can only imagine the overhead involved in allowing computed columns to be made up of Any Damn Thing™ one wanted to have there. Should RAND() be allowed, for example?&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Jan Steinman</dc:creator><guid>https://mariadb.com/kb/en/generated-columns/+comments/2148</guid></item><item><title>Re: Virtual (Computed) Columns</title><link>https://mariadb.com/kb/en/generated-columns/+comments/2147</link><description>&lt;p&gt;Unfortunately, TIMESTAMPDIFF doesn't work with NOW() in computed columns in MariaDB.&lt;br&gt;
&lt;code&gt;years INT(3) AS (TIMESTAMPDIFF (YEAR, date, NOW() ) )&lt;/code&gt;&lt;br&gt;in CREATE TABLE results in
"Function or expression is not allowed for column 'years'"&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">guest guest</dc:creator><guid>https://mariadb.com/kb/en/generated-columns/+comments/2147</guid></item><item><title>Re: Virtual Columns</title><link>https://mariadb.com/kb/en/generated-columns/+comments/1650</link><description>&lt;p&gt;The &lt;a href="/kb/en/editing-help/"&gt;editing help&lt;/a&gt; page gives details on formatting. I've tidied up your post above - there's lots you can do, just not HTML :)&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Ian Gilfillan</dc:creator><guid>https://mariadb.com/kb/en/generated-columns/+comments/1650</guid></item><item><title>Re: Restrictions</title><link>https://mariadb.com/kb/en/generated-columns/+comments/1644</link><description>&lt;p&gt;(You guys REALLY need an "Edit" button...)&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Jan Steinman</dc:creator><guid>https://mariadb.com/kb/en/generated-columns/+comments/1644</guid></item><item><title>Re: Restrictions</title><link>https://mariadb.com/kb/en/generated-columns/+comments/1643</link><description>&lt;p&gt;Let's try some &amp;lt;code&amp;gt;:&lt;/p&gt;
&lt;pre class="fixed"&gt;ALTER TABLE `z_test`
    ADD `Last_name_bit_length` INT(5)
        AS (BIT_LENGTH(`Name_Last`)) PERSISTENT
        AFTER `Name_Last`;

MariaDB [EcoReality]&amp;gt; SELECT Name_Last, Last_name_bit_length from z_test;
+------------+----------------------+
| Name_Last  | Last_name_bit_length |
+------------+----------------------+
| Bartfast   |                   64 |
| Flintstone |                   80 |
| Huston     |                   48 |
| Bah        |                   24 |
+------------+----------------------+
4 rows in set (0.00 sec)
&lt;/pre&gt;&lt;p&gt;Ah, that's better. :-)&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Jan Steinman</dc:creator><guid>https://mariadb.com/kb/en/generated-columns/+comments/1643</guid></item><item><title>Re: Restrictions</title><link>https://mariadb.com/kb/en/generated-columns/+comments/1642</link><description>&lt;p&gt;"Their value can be a not deterministic function, except if use in an index or a constraint."&lt;/p&gt;
&lt;p&gt;In 10.1.6 (at least), you can use non-deterministic functions, but apparently the 252 character limitation still exists.&lt;/p&gt;
&lt;p&gt;I'd show you, but I'm frustrated with the UI here. How did you get the &amp;lt;pre&amp;gt;&amp;lt;/pre&amp;gt; to work in your comment?&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Jan Steinman</dc:creator><guid>https://mariadb.com/kb/en/generated-columns/+comments/1642</guid></item><item><title>Re: Virtual Columns</title><link>https://mariadb.com/kb/en/generated-columns/+comments/1641</link><description>&lt;p&gt;(I don't understand why this forum doesn't allow a bit of prettifying HTML...)-:&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Jan Steinman</dc:creator><guid>https://mariadb.com/kb/en/generated-columns/+comments/1641</guid></item><item><title>Re: Virtual Columns</title><link>https://mariadb.com/kb/en/generated-columns/+comments/1640</link><description>&lt;p&gt;&lt;em&gt;By the way, I don't understand why constant expressions could not be accepted.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;They apparently work in 10.1.6:&lt;/p&gt;
&lt;pre class="fixed"&gt;ALTER TABLE `z_test` ADD `Const` INT(5)  AS (`ID` + 1) PERSISTENT AFTER `ID`;

MariaDB [EcoReality]&amp;gt; SELECT ID, Const from z_test;
+----+-------+
| ID | Const |
+----+-------+
|  1 |     2 |
|  2 |     3 |
|  3 |     4 |
|  4 |     5 |
+----+-------+
4 rows in set (0.00 sec)
&lt;/pre&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Jan Steinman</dc:creator><guid>https://mariadb.com/kb/en/generated-columns/+comments/1640</guid></item><item><title>Re: Updating PERSISTENT columns?</title><link>https://mariadb.com/kb/en/generated-columns/+comments/1612</link><description>&lt;p&gt;Data in PERSISTENT columns is always up to date. You don't have to do anything to force updates.&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Federico Razzoli</dc:creator><guid>https://mariadb.com/kb/en/generated-columns/+comments/1612</guid></item><item><title>Updating PERSISTENT columns?</title><link>https://mariadb.com/kb/en/generated-columns/+comments/1609</link><description>&lt;p&gt;What happens when the data that determines a PERSISTENT column changes? Is there a built-in change-detection and update mechanism? Or is there some way to force an update?&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Jan Steinman</dc:creator><guid>https://mariadb.com/kb/en/generated-columns/+comments/1609</guid></item><item><title>Re: Virtual Columns</title><link>https://mariadb.com/kb/en/generated-columns/+comments/1356</link><description>&lt;p&gt;Someone has benchmarked a database table using this resource and measure the performance of both VIRTUAL and PERSISTENT  column types? Just curious because I'm seeing that some overhead for a big table will be implied when reading data and writing data when the column is PERSISTENT...just curious. Cheers, WB&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Wagner Bianchi</dc:creator><guid>https://mariadb.com/kb/en/generated-columns/+comments/1356</guid></item><item><title>Restrictions</title><link>https://mariadb.com/kb/en/generated-columns/+comments/1354</link><description>&lt;p&gt;This article quotes some restrictions existing in other DBMSs but does not say that MariaDB has important limitations not existing in other products.
For instances the SQL Server computed columns are described as:&lt;/p&gt;
&lt;p&gt;A computed column is computed from an expression that can use other columns in the same table. The expression can be a noncomputed column name, constant, function, and any combination of these connected by one or more operators. The expression cannot be a subquery.&lt;/p&gt;
&lt;p&gt;Which means that MS computed columns have not some major MariaDB virtual column restrictions:&lt;/p&gt;
&lt;ol start="1"&gt;&lt;li&gt;Their value can be a constant.
&lt;/li&gt;&lt;li&gt;Their value can be a not deterministic function, except if use in an index or a constraint.
&lt;/li&gt;&lt;li&gt;There is apparently no limitation on the length of the expression.
&lt;/li&gt;&lt;/ol&gt;
&lt;p&gt;All these limitation are bad and really limit the interest of virtual columns. Limitation on constant and expression length are not justifiable.&lt;/p&gt;
&lt;p&gt;About the limitation on deterministic expressions, this is simply the necessity of this feature that is questionnable.
Indeed, a feature is necessary if it enables to do things that cannot be done by other mean. For instance:&lt;/p&gt;
&lt;pre class="fixed"&gt;create table emp2 (
id int(6) NOT NULL ,
name char(12) NOT NULL,
birth date NOT NULL,
hired date NOT NULL,
agehired int(3) as (timestampdiff(year,birth,hired)) virtual);
&lt;/pre&gt;&lt;pre class="fixed"&gt;select * from emp2;
&lt;/pre&gt;&lt;pre class="fixed"&gt;id  name    birth       hired       agehired
 1  John    1986-01-25  2010-06-02        24
 2  Henry   1987-06-07  2008-04-01        20
 3  George  1981-08-10  2010-06-02        28
 4  Sam     1979-11-22  2007-10-10        27
 5  James   1992-05-13  2009-12-14        17
 6  Bill    1986-09-11  2008-02-10        21
 7  Mat     1975-07-17  2011-05-15        35
&lt;/pre&gt;&lt;p&gt;This is Ok, however the same result can be obtained with the table:&lt;/p&gt;
&lt;pre class="fixed"&gt;create table emp1 (
id int(6) NOT NULL ,
name char(12) NOT NULL,
birth date NOT NULL,
hired date NOT NULL);
&lt;/pre&gt;&lt;p&gt;with the query:&lt;/p&gt;
&lt;pre class="fixed"&gt;select *, timestampdiff(year,birth,hired) agehired from emp1;
&lt;/pre&gt;&lt;p&gt;Therefore, virtual columns appears as just a query wording facility without bringing a real new concept.&lt;/p&gt;
&lt;p&gt;Things would be different if non deterministic expressions would be accepted.
Firstly it would make possible to add useful things such as an AGE column returning the same result than saying:&lt;/p&gt;
&lt;pre class="fixed"&gt;select *, timestampdiff(year,birth,curdate()) age from emp1;
&lt;/pre&gt;&lt;p&gt;But even more, it would make possible to do things that are not possible by other means:&lt;/p&gt;
&lt;pre class="fixed"&gt;create table randx (
row int key auto_increment);
insert into randx values(default),(default),(default),(default);
&lt;/pre&gt;&lt;p&gt;A query such as:&lt;/p&gt;
&lt;pre class="fixed"&gt;select row, rand() from randx where rand() &amp;lt; 0.5;
&lt;/pre&gt;&lt;p&gt;can return result such as:&lt;/p&gt;
&lt;pre class="fixed"&gt;row rand()
1   0.3253647185166969000000000000000
2   0.5974436510330473100000000000000
3   0.4231471795804306900000000000000
&lt;/pre&gt;&lt;p&gt;This apparently strange result comes from the fact that the rand() function is called on each appearance in the query.
However, if it were possible to do;&lt;/p&gt;
&lt;pre class="fixed"&gt;create table randx (
row int key auto_increment,
val double as (rand()) virtual);
&lt;/pre&gt;&lt;p&gt;Providing that a column value is evaluated only once per row, as many DBMSs do, the query:&lt;/p&gt;
&lt;pre class="fixed"&gt;select row, val from randx where val &amp;lt; 0.5;
&lt;/pre&gt;&lt;p&gt;would never return rows with val &amp;gt;= 0.5.&lt;/p&gt;
&lt;p&gt;Of course restrictions such as not using this virtual column for indexing or constraint would apply.&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Olivier Bertrand</dc:creator><guid>https://mariadb.com/kb/en/generated-columns/+comments/1354</guid></item><item><title>Re: Virtual Columns</title><link>https://mariadb.com/kb/en/generated-columns/+comments/1353</link><description>&lt;p&gt;Thanks, the wording is incorrect and will be changed. I'm also unsure as to why constants are not accepted!&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Ian Gilfillan</dc:creator><guid>https://mariadb.com/kb/en/generated-columns/+comments/1353</guid></item><item><title>Re: Virtual Columns</title><link>https://mariadb.com/kb/en/generated-columns/+comments/1352</link><description>&lt;p&gt;"A virtual column is a column in a table that has its value automatically calculated using either a deterministic expression, or the values of other fields in the table."&lt;/p&gt;
&lt;p&gt;This seems to say that it is possible to use an expression that does not refer to other fields in the tables. However, to my knowledge, such an expression is either not deterministic or constant. In both cases it is rejected by MariaDB.&lt;/p&gt;
&lt;p&gt;By the way, I don't understand why constant expressions could not be accepted.&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Olivier Bertrand</dc:creator><guid>https://mariadb.com/kb/en/generated-columns/+comments/1352</guid></item><item><title>Alter Table Re: Virtual Columns</title><link>https://mariadb.com/kb/en/generated-columns/+comments/1017</link><description>&lt;p&gt;from this KB:   "ALTER TABLE's MODIFY and CHANGE clauses are supported for PERSISTENT columns, but not for VIRTUAL columns."&lt;/p&gt;
&lt;p&gt;I somehow understood that phrase to mean "no alter table for the virtual column once the virtual column is established"&lt;/p&gt;
&lt;p&gt;I was trying to modify a "regular" column (which, further, had never contained any data) into a virtual one which in my opinion meant I was not modifying the virtual column (it was not yet "virtual"!).  This did NOT work.  Dropping my column and making a virtual column during the "first go round" works brilliantly.&lt;/p&gt;
&lt;p&gt;Perhaps the "alter table" information in the KB could be made clearer.  i.e. "Existing columns can not be altered into virtual columns."&lt;/p&gt;
&lt;p&gt;Interestingly, the expression clause for virtual columns CAN be altered -- that is what I thought you had only one chance at . . .&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Felix Bachofner</dc:creator><guid>https://mariadb.com/kb/en/generated-columns/+comments/1017</guid></item><item><title>Expression limited to 252 characters</title><link>https://mariadb.com/kb/en/generated-columns/+comments/908</link><description>&lt;p&gt;Too bad that an important limitation isn't mentioned: the expression is limited to 252 characters.&lt;/p&gt;
&lt;pre class="fixed"&gt;ERROR 1470 (HY000): String 'XXXXXXXXXX' is too long for VIRTUAL COLUMN EXPRESSION (should be no longer than 252)
&lt;/pre&gt;&lt;p&gt;I would have hoped to be able to use virtual columns for reducing complexity in multiple applications by containing the logic in the database. Unfortunately, even a simple CASE statement with a few options will quickly exceed the 252 character limit.&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Alex Hermann</dc:creator><guid>https://mariadb.com/kb/en/generated-columns/+comments/908</guid></item><item><title>Re: Virtual Columns</title><link>https://mariadb.com/kb/en/generated-columns/+comments/272</link><description>&lt;p&gt;It's really up to the tool authors. We would love for them to support our entire feature set. Over time I'm sure they will, especially if their users request it. :)&lt;/p&gt;
&lt;p&gt;On Windows I know &lt;a href="http://www.heidisql.com/"&gt;HeidiSQL&lt;/a&gt;, which we ship with the Windows version of MariaDB, does support some MariaDB features such as &lt;a href="/kb/en/pluggable-authentication/"&gt;pluggable authentication&lt;/a&gt; (I don't know if they support virtual columns).&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Daniel Bartholomew</dc:creator><guid>https://mariadb.com/kb/en/generated-columns/+comments/272</guid></item><item><title>Re: Virtual Columns</title><link>https://mariadb.com/kb/en/generated-columns/+comments/271</link><description>&lt;p&gt;Do you know of any support for this (and other cool MariaDB features) in third-party tools? Or are we limited to CLI use?&lt;/p&gt;
&lt;p&gt;I note that Sequel Pro lets me see the results after entering a CREATE TABLE manually, but there's no way to manipulate the virtual/persistent column definitions.&lt;/p&gt;
&lt;p&gt;Any interest in a phpMyAdmin hack to at least partially support this?&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Jan Steinman</dc:creator><guid>https://mariadb.com/kb/en/generated-columns/+comments/271</guid></item><item><title>Re: Virtual Columns</title><link>https://mariadb.com/kb/en/generated-columns/+comments/30</link><description>&lt;p&gt;According to Andrey Zhakov's description on MySQL Forge, subqueries are not allowed, but this information is missing from this article.&lt;/p&gt;
&lt;p&gt;As a general heuristic, you can also consider that the calculation used for virtual columns must be deterministic. A subquery based on some other data is not deterministic, as the underlying data can change.&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Henrik Ingo</dc:creator><guid>https://mariadb.com/kb/en/generated-columns/+comments/30</guid></item><item><title>Re: Virtual Columns</title><link>https://mariadb.com/kb/en/generated-columns/+comments/26</link><description>&lt;p&gt;Are subqueries supported?&lt;/p&gt;
&lt;p&gt;CREATE TABLE `table1` (
  `a` int(11) NOT NULL,
  `b` varchar(32) DEFAULT NULL,
  `d` varchar(5) AS (SELECT count(*) from table2) PERSISTENT
)&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Thomas B.</dc:creator><guid>https://mariadb.com/kb/en/generated-columns/+comments/26</guid></item></channel></rss>