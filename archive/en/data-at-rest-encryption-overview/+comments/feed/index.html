<?xml version="1.0" encoding="utf-8"?>
<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title>MariaDB Knowledge Base Comments for: Data-at-Rest Encryption Overview</title><link>https://mariadb.com/kb/en/data-at-rest-encryption-overview/+comments/feed/</link><description></description><atom:link href="https://mariadb.com/kb/en/data-at-rest-encryption-overview/+comments/feed/" rel="self"></atom:link><language>en-us</language><lastBuildDate>Mon, 23 Dec 2024 04:20:16 +0000</lastBuildDate><item><title>Re: Data-at-Rest Encryption Overview</title><link>https://mariadb.com/kb/en/data-at-rest-encryption-overview/+comments/5047</link><description>&lt;p&gt;Hello to everyone,&lt;/p&gt;
&lt;p&gt;Would you know, please, if we TDE is available on MariaDB Community Edition (latest release). Thanks a lot !&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Sebastian Sajaroff</dc:creator><guid>https://mariadb.com/kb/en/data-at-rest-encryption-overview/+comments/5047</guid></item><item><title>Re: Data at Rest Encryption</title><link>https://mariadb.com/kb/en/data-at-rest-encryption-overview/+comments/3301</link><description>&lt;p&gt;The Korean page is behind.  The content you're looking for was moved to &lt;a href="/kb/en/encryption-key-management/"&gt;Encryption Key Management&lt;/a&gt;, &lt;a href="/kb/en/encrypting-data-for-innodb-xtradb/"&gt;Encrypting Data for InnoDB/XtraDB&lt;/a&gt;, and &lt;a href="/kb/en/encrypting-data-for-aria/"&gt;Encrypting Data for Aria&lt;/a&gt; to allow for more detailed explanations without crowding the overview.&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Kenneth Dyer</dc:creator><guid>https://mariadb.com/kb/en/data-at-rest-encryption-overview/+comments/3301</guid></item><item><title>Re: Data at Rest Encryption</title><link>https://mariadb.com/kb/en/data-at-rest-encryption-overview/+comments/3300</link><description>&lt;p&gt;Could this page be updated to include the detail on the equivalent korean page?    &lt;a href="https://mariadb.com/kb/ko/data-at-rest-encryption/"&gt;https://mariadb.com/kb/ko/data-at-rest-encryption/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;There is a lot more detail on there about settings around encryption that is not on the English version; which look like the very things I am after - BUT I can't read them.&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Nick Bolton</dc:creator><guid>https://mariadb.com/kb/en/data-at-rest-encryption-overview/+comments/3300</guid></item><item><title>Detecting Encrypted Tables</title><link>https://mariadb.com/kb/en/data-at-rest-encryption-overview/+comments/2749</link><description>&lt;p&gt;You cannot always tell which tables are encrypted or not via SHOW CREATE TABLE, but you can with (ENCRYPTION_SCHEME=1 for encrypted tables, 0 for non-encrypted tables):&amp;lt;br&amp;gt;&lt;/p&gt;
&lt;p&gt;&lt;code class="fixed" style="white-space:pre-wrap"&gt;SELECT * FROM INFORMATION_SCHEMA.INNODB_TABLESPACES_ENCRYPTION;&lt;/code&gt;&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Chris Calender</dc:creator><guid>https://mariadb.com/kb/en/data-at-rest-encryption-overview/+comments/2749</guid></item><item><title>Re: Backups with Data at Rest Encryption </title><link>https://mariadb.com/kb/en/data-at-rest-encryption-overview/+comments/2611</link><description>&lt;p&gt;Ok,  found  a (slightly cryptic) explanation here, on slide 18, under 4.&lt;/p&gt;
&lt;p&gt;&lt;a href="http://www.slideshare.net/AmazonWebServices/encryption-and-key-management-in-aws"&gt;http://www.slideshare.net/AmazonWebServices/encryption-and-key-management-in-aws&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;The cipherblob we get with GenerateDataKey and store on disk, actually contains encrypted master key id + datakey.&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Vladislav Vaintroub</dc:creator><guid>https://mariadb.com/kb/en/data-at-rest-encryption-overview/+comments/2611</guid></item><item><title>Re: Backups with Data at Rest Encryption </title><link>https://mariadb.com/kb/en/data-at-rest-encryption-overview/+comments/2610</link><description>&lt;div style="margin-left:2em"&gt;&lt;p&gt;Does the aws-kms-key contain master key id?&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;We don't record it ourselves, the contents of the file is just cipherblob from GenerateDataKey() response. 
But AWS knows which keys was used. The question "how does it know" interesting, I'll check the KMS documentation. &lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Vladislav Vaintroub</dc:creator><guid>https://mariadb.com/kb/en/data-at-rest-encryption-overview/+comments/2610</guid></item><item><title>Re: Backups with Data at Rest Encryption </title><link>https://mariadb.com/kb/en/data-at-rest-encryption-overview/+comments/2609</link><description>&lt;p&gt;AWS KMS does not need or accept master key id for Decrypt, it only needs it for GenerateDataKey/Encrypt.
&lt;a href="http://docs.aws.amazon.com/kms/latest/APIReference/API_Decrypt.html"&gt;http://docs.aws.amazon.com/kms/latest/APIReference/API_Decrypt.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;As you can see, Decrypt actually *returns* the master-key-id that was used for GenerateDataKey  its response (how does it know it, I have no idea, never checked), in addition to Plaintext that we use.&lt;/p&gt;
&lt;p&gt;Thus:
- rotate does KMS-GenerateDataKey., It *needs* master key id.  ditto CREATE/ALTER TABLE with new key ids, or
- decrypt(at the startup time) does KMS-Decrypt(). It *does  not need* master-key-id.  It can decrypt multiple local keys, backed by different CMK, or by single CMK that was transparently rotated by AWS.&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Vladislav Vaintroub</dc:creator><guid>https://mariadb.com/kb/en/data-at-rest-encryption-overview/+comments/2609</guid></item><item><title>Re: Backups with Data at Rest Encryption </title><link>https://mariadb.com/kb/en/data-at-rest-encryption-overview/+comments/2608</link><description>&lt;p&gt;When a key is rotated in AWS KMS, it keeps the same key alias and earlier versions of the key are still available for decryption. Take a look at &lt;a href="http://docs.aws.amazon.com/kms/latest/developerguide/rotate-keys.html"&gt;http://docs.aws.amazon.com/kms/latest/developerguide/rotate-keys.html&lt;/a&gt; for more information. Local key rotation, done by MariaDB Server, causes the new version of the key to be written to a file in your datadir. Old versions of the key are kept as well, since they'll be needed to decrypt tables/pages/logs encrypted using earlier versions of the key. When you're certain that an older version of a key is no longer needed, you can delete the corresponding file from the datadir.&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Kolbe Kegel</dc:creator><guid>https://mariadb.com/kb/en/data-at-rest-encryption-overview/+comments/2608</guid></item><item><title>Re: Backups with Data at Rest Encryption </title><link>https://mariadb.com/kb/en/data-at-rest-encryption-overview/+comments/2607</link><description>&lt;p&gt;If I understand correctly, the plugin will start rotate keys process and use newly specified master key to create new local key to encrypt. However, since it's pointing to different master key, how does it decrypt previous local key so that tables can be decrypted prior to rotation. If they don't need to be decrypted, how are they decrypted in during database operation since previous local key can not be decrypted with previous master key id.&lt;/p&gt;
&lt;p&gt;Does the aws-kms-key contain master key id?&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Vlad Tokarskiy</dc:creator><guid>https://mariadb.com/kb/en/data-at-rest-encryption-overview/+comments/2607</guid></item><item><title>Re: Backups with Data at Rest Encryption </title><link>https://mariadb.com/kb/en/data-at-rest-encryption-overview/+comments/2606</link><description>&lt;p&gt;Just enabling annual rotation on AWS does not have any effect until the local keys are rotated.&lt;/p&gt;
&lt;p&gt;One approach would be to  enable rotation of the key in AWS, and use aws_key_management_rotate_key once a year (so that you're sure that master key has rotated) &lt;/p&gt;
&lt;p&gt;Another approach would be to use a  different master_key_id for new version 
- create several master keys in AWS IAM, and change aws_key_management_master_key_id  prior to rotating keys with  aws_key_management_rotate_key&lt;/p&gt;
&lt;p&gt;I'm not sure how all this relates to galera.  Whenever new key or  key version is created (implicitly, with CREATE/ALTER table if you specify encryption id), or via rotate_key, the new "data" key is created is stored locally in aws-kms-key.x.y . Those keys are not exchanged between servers via replication or galera. &lt;/p&gt;
&lt;p&gt;CREATE TABLE always picks up the latest version of the key. &lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Vladislav Vaintroub</dc:creator><guid>https://mariadb.com/kb/en/data-at-rest-encryption-overview/+comments/2606</guid></item><item><title>Re: Backups with Data at Rest Encryption </title><link>https://mariadb.com/kb/en/data-at-rest-encryption-overview/+comments/2604</link><description>&lt;p&gt;Is recommended way to rotate keys using plugin aws_key_management_rotate_key option and configure appropriate permissions in AWS or setup AWS IAM to rotate the key. In galera cluster would it be better to use AWS IAM to rotate instead of individual servers rotating.&lt;/p&gt;
&lt;p&gt;Also, once the key is rotated, will "create table" pick up current key or it must be specified?&lt;/p&gt;
&lt;p&gt;Thank you for your feedback&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Vlad Tokarskiy</dc:creator><guid>https://mariadb.com/kb/en/data-at-rest-encryption-overview/+comments/2604</guid></item><item><title>Re: Backups with Data at Rest Encryption </title><link>https://mariadb.com/kb/en/data-at-rest-encryption-overview/+comments/2603</link><description>&lt;p&gt;This is the question about AWS Key Management plugin, I assume?&lt;/p&gt;
&lt;p&gt;If AWS rotates its master key, it does not remove the old one. That means it is still able to decrypt old keys stored in the datadir.&lt;/p&gt;
&lt;p&gt;Same is true about local keys. Rotation does not remove the old keys, they are kept in the datadir. They can be deleted when they are not used. But we don't do this.  Keys are not used, after Innodb keys rotation completes, and, in case you encrypt binlogs, after binlogs using that key are removed.&lt;/p&gt;
&lt;p&gt;There is no automatic way to restore data on servers not connected to AWS.&lt;/p&gt;
&lt;p&gt; If you want to do this, you need to do what server does, namely decrypt keys to get plaintext, and for that &lt;/p&gt;
&lt;p&gt;a) decrypt the aws-kms.x.y files inside the datadir yourself. You can do it with AWS KMS API called Decrypt, or even using aws-cli for example. You need the plaintext keys for every file&lt;/p&gt;
&lt;p&gt;b) write your own aws_key_management plugin that would work with plaintext instead of sending files to AWS&lt;/p&gt;
&lt;p&gt;Maybe, you can reuse file_key_management given plaintext keys, if you're not using rotation, but I have not checked that myself.&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Vladislav Vaintroub</dc:creator><guid>https://mariadb.com/kb/en/data-at-rest-encryption-overview/+comments/2603</guid></item><item><title>Re: Backups with Data at Rest Encryption </title><link>https://mariadb.com/kb/en/data-at-rest-encryption-overview/+comments/2602</link><description>&lt;p&gt;The LVM snapshot should be of the entire directory, which will include the encrypted data keys stored locally, so local key rotation is not a concern when restoring from a snapshot. You will still need access to the Customer Master Key in AWS in order to decrypt those data keys. Key Rotation in AWS KMS "currently retains all prior backing keys so that decryption of encrypted data can take place transparently" (see &lt;a href="http://docs.aws.amazon.com/kms/latest/developerguide/rotate-keys.html"&gt;http://docs.aws.amazon.com/kms/latest/developerguide/rotate-keys.html&lt;/a&gt;), so rotating your CMK is not a concern when restoring from a snapshot. If you *delete* your CMK, you will be unable to decrypt the data keys (and thus unable to decrypt your data). Your MariaDB instance must be able to connect to AWS KMS in order to decrypt the data; there is no way to decrypt the encrypted data keys without access to the correct CMK in AWS KMS.&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Kolbe Kegel</dc:creator><guid>https://mariadb.com/kb/en/data-at-rest-encryption-overview/+comments/2602</guid></item><item><title>Re: Backups with Data at Rest Encryption </title><link>https://mariadb.com/kb/en/data-at-rest-encryption-overview/+comments/2601</link><description>&lt;p&gt;Using LVM snapshots leaves the data encrypted which is a good thing. However, what happens if the key(either local or AWS) gets rotated? &lt;/p&gt;
&lt;p&gt;How do you restore data on servers not connected to AWS?&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Vlad Tokarskiy</dc:creator><guid>https://mariadb.com/kb/en/data-at-rest-encryption-overview/+comments/2601</guid></item><item><title>Re: Backups with Data at Rest Encryption </title><link>https://mariadb.com/kb/en/data-at-rest-encryption-overview/+comments/2547</link><description>&lt;p&gt;We use LVM snapshots for our servers here at MariaDB.&lt;/p&gt;
&lt;p&gt;&lt;a href="https://mariadb.com/kb/en/mariadb-enterprise/mariadb-enterprise-backup-guide/#lvm-logical-volume-management"&gt;https://mariadb.com/kb/en/mariadb-enterprise/mariadb-enterprise-backup-guide/#lvm-logical-volume-management&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;The other common option would be replicating to a backup server and where you could perform blocking backups.&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Bryan Alsdorf</dc:creator><guid>https://mariadb.com/kb/en/data-at-rest-encryption-overview/+comments/2547</guid></item><item><title>Backups with Data at Rest Encryption </title><link>https://mariadb.com/kb/en/data-at-rest-encryption-overview/+comments/2546</link><description>&lt;p&gt;Having support for data-at-rest encryption is awesome, but I have to admit I'm a bit puzzled on how to get a viable backup-strategy with encryption in place as xtrabackup wont work with it enabled.&lt;/p&gt;
&lt;p&gt;Can someone advice on a good way to implement hot backups with encryption enabled ?&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Johan Eriksson</dc:creator><guid>https://mariadb.com/kb/en/data-at-rest-encryption-overview/+comments/2546</guid></item><item><title>Re: Data at Rest Encryption</title><link>https://mariadb.com/kb/en/data-at-rest-encryption-overview/+comments/2347</link><description>&lt;p&gt;The exact wording is "the plugin will use AES with the 128-bit keys in the CTR mode for encrypting tablespace pages". Because tablespace pages are always encrypted with a 128-bit tablespace key. Which is different for every tablespace and it is generated from the user-specified key, which might be 128-, 192-, or 256-bit.&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Sergei Golubchik</dc:creator><guid>https://mariadb.com/kb/en/data-at-rest-encryption-overview/+comments/2347</guid></item><item><title>Re: Data at Rest Encryption</title><link>https://mariadb.com/kb/en/data-at-rest-encryption-overview/+comments/2346</link><description>&lt;p&gt;I'm a bit puzzled here -- there is said that 128, 192 or 256-bit keys are supported, but later AES_CTR and AES_CBC modes talk only about 128bit keys. What piece of information am I missing?&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Honza Horak</dc:creator><guid>https://mariadb.com/kb/en/data-at-rest-encryption-overview/+comments/2346</guid></item><item><title>Re: Data at Rest Encryption</title><link>https://mariadb.com/kb/en/data-at-rest-encryption-overview/+comments/2260</link><description>&lt;p&gt;A page is a fixed-size unit (see the &lt;a href="https://dev.mysql.com/doc/internals/en/innodb-page-structure.html"&gt;MySQL docs&lt;/a&gt; for a detailed overview), usually 16KB, but can be changed by adjusting &lt;a href="/kb/en/xtradbinnodb-server-system-variables/#innodb_page_size"&gt;innodb_page_size&lt;/a&gt;&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Ian Gilfillan</dc:creator><guid>https://mariadb.com/kb/en/data-at-rest-encryption-overview/+comments/2260</guid></item><item><title>Re: Data at Rest Encryption</title><link>https://mariadb.com/kb/en/data-at-rest-encryption-overview/+comments/2259</link><description>&lt;p&gt;Using the parameter innodb-encryption-rotate-key-age ,  in "Re-encrypt in background all pages that were encrypted with a key at least that many versions old" what do you mean by "page"?&lt;/p&gt;
&lt;p&gt;Thanks&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Dba Btissam</dc:creator><guid>https://mariadb.com/kb/en/data-at-rest-encryption-overview/+comments/2259</guid></item></channel></rss>