<!DOCTYPE html>
<html>
<head data-cookie-domain=""
      data-cookie-path="/">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="apple-touch-icon" sizes="180x180" href="/kb/static/images/favicons/apple-touch-icon.159e713979be.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/kb/static/images/favicons/favicon-32x32.bc0ac1d5d11e.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/kb/static/images/favicons/favicon-16x16.5801f8f0f34e.png">
    <link rel="shortcut icon" href="/kb/static/images/favicons/favicon.d122d305dee4.ico" type="image/x-icon" />

    <title>Amazon Web Services (AWS) Key Management Service (KMS) Encryption Plugin Setup Guide - Source - MariaDB Knowledge Base</title>

    <link href="/kb/static/css/main.f7633538c846.css" rel="stylesheet" type="text/css" />

    
        <meta name="robots" content="noindex, nofollow">
    

    

    <!-- FB Open Graph tags -->
    <meta property="og:title" content="Amazon Web Services (AWS) Key Management Service (KMS) Encryption Plugin Setup Guide - Source" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://mariadb.com/kb/en/aws-key-management-encryption-plugin-setup-guide/+source/" />
    <meta property="og:image" content="http://mariadb.comaskmonty-logo.png" />
    <meta property="og:site_name" content="MariaDB KnowledgeBase" />
    <meta property="fb:admins" content="514852603" />
    <meta property="og:description" content="" />

    <meta name="description" content="" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet"/>
    
</head>
<body class="mpkb nodes autoresize nodes_source jqui" id="nodes_source">





<div id="menu-mobile" class="visible-sm visible-xs">

    <div>
        <div id="mobile-close-menu" class="text-right">
            <a href="javascript:void(0)" title="Close Menu" id="back-main" class="toggle-menu">X<span></span></a>
        </div>
    </div>
    <div class="mainmenu-mobile">
        <ul class="ls-none ul-menu">
            <li data-sub="submenu5"><a class="open-form-search" href="/kb/search/" title="Search">Search </a></li>
            <li data-sub="submenu0"><a href="/products" title="Products">Products</a><span class="arrow-main"></span></li>
            <li data-sub="submenu1"><a href="/services" title="Services">Services</a><span class="arrow-main"></span></li>
            <li data-sub="submenu2"><a href="/resources" title="Resources">Resources</a><span class="arrow-main"></span></li>
            <li data-sub="submenu3"><a href="/about-us" title="About">About</a><span class="arrow-main"></span></li>
            <li data-sub="submenu4"><a href="/contact" title="Contact">Contact</a></li>
        </ul>
    </div>

    <div class="nav-top-mobile">
        <div class="select-box form">

            <ul class="inline-block-md mb-none top-nav">
                <li>

                </li>
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/aws-key-management-encryption-plugin-setup-guide/+source/"> Login</a>
                    </li>
                
            </ul>



        </div>
        <p class="text-center copyright">Copyright &copy; 2025 MariaDB. All rights reserved.</p>
    </div>
</div>
<div class="violator-wrap d-none" id="top_violator">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12">
                <div class="violator-outer">
                    <div class="violator-inner">
                        <div class="row">
                            <div class="col-xs-12 col-sm-9 col-lg-7 col-lg-offset-2" id="top_violator_content">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="content-link" target="_blank" rel="nofollow noreferrer">
                                    <span>The Ultimate Guide to High Availability with MariaDB</span>
                                </a>
                            </div>
                            <div class="col-xs-12 col-sm-3" id="top_violator_cta">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="btn btn-mariadb" target="_blank" rel="nofollow noreferrer">Download Now</a>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-link close-btn">
                        <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24" width="15px" height="15px"><path d="M 4.9902344 3.9902344 A 1.0001 1.0001 0 0 0 4.2929688 5.7070312 L 10.585938 12 L 4.2929688 18.292969 A 1.0001 1.0001 0 1 0 5.7070312 19.707031 L 12 13.414062 L 18.292969 19.707031 A 1.0001 1.0001 0 1 0 19.707031 18.292969 L 13.414062 12 L 19.707031 5.7070312 A 1.0001 1.0001 0 0 0 18.980469 3.9902344 A 1.0001 1.0001 0 0 0 18.292969 4.2929688 L 12 10.585938 L 5.7070312 4.2929688 A 1.0001 1.0001 0 0 0 4.9902344 3.9902344 z"/></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="wrapper">
<div id="top-nav">
    <div class="container">
        <ul class="hidden-sm hidden-xs" >
            <li><a href="https://mariadb.com/kb/">Knowledge Base</a></li>
            <li><a href="https://mariadb.com/contact/">Contact</a></li>
            
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/aws-key-management-encryption-plugin-setup-guide/+source/" rel="nofollow">Login</a>
                    </li>
                
            
            
            <li id="search-form">
                <form action="/kb/en/+search/" method="get" id="search-block-form" accept-charset="UTF-8">
                    <input id="search" title="Enter the terms you wish to search for."
                           placeholder="Search . . ." type="text"
                           name="q" value="" size="15" maxlength="128" class="form-text"
                           data-autocomplete-url="/kb/en/+search/autocomplete/">
                    <input type="hidden" name="quick" value="1" />
                    <input type="hidden" name="source" value="kb" />
                </form>
            </li>
            <li><a id="search-toggler" href="/kb/search/">Search</a></li>
            
        </ul>
    </div>
</div>
<div id="navbar-bottom" class="navbar">
    <div class="container">
        
        
        
        
        <div class="row">
            <div class="col-md-3 col-sm-9 col-xs-9">
                <a class="brand" href="/" title="MariaDB">
                    <img src="/kb/static/images/logo-2018-black.95f5978ae14d.png">
                </a>
            </div>
            <div class="col-md-9 hidden-sm hidden-xs">
                <div class="main-menu">
                    <ul id="main-menu" class="nav navbar-nav inline-block-sm">
    <li class="has-sub full-menu">
        <a href="/products" title="Products">Products</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/solutions" title="Solutions">Solutions</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/resources" title="Resources">Resources</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/about-us" title="Company">Company</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/pricing" title="Pricing">Pricing</a>
    </li>
    
    <li class="">
        <a class="button electric-eel small top-bar-right-download" href="/downloads/">Download</a>
    </li>
</ul>
                </div>
            </div>
            <div class="col-md-3 visible-sm visible-xs col-sm-3 col-xs-3 ps-rv">
                <div class="navbar-header text-right pull-right">
                    <button type="button" class="menu-control toggle-menu" id="open-menu">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="main">
    <div class="container">
        

        <div id="subheader1" class="clearfix">
            <div class="pull-left">
                
                <div id="breadcrumbs" class="breadcrumb">
                    <a href="/kb/en/">Knowledge Base</a>
                    


    
    » <a class="crumb" href="/kb/en/documentation/">MariaDB Server Documentation</a>
    

    
    » <a class="crumb" href="/kb/en/mariadb-administration/">MariaDB Administration</a>
    

    
    » <a class="crumb" href="/kb/en/user-server-security/">User &amp; Server Security</a>
    

    
    » <a class="crumb" href="/kb/en/securing-mariadb/">Securing MariaDB</a>
    

    
    » <a class="crumb" href="/kb/en/securing-mariadb-encryption/">Encryption</a>
    

    
    » <a class="crumb" href="/kb/en/encryption-data-at-rest-encryption/">Data-at-Rest Encryption</a>
    

    
    » <a class="crumb" href="/kb/en/key-management-and-encryption-plugins/">Key Management and Encryption Plugins</a>
    


    » <a class="node_link crumb" href="/kb/en/aws-key-management-encryption-plugin-setup-guide/">Amazon Web Services (AWS) Key Management Service (KMS) Encryption Plugin Setup Guide</a>


                </div>
                
            </div>
        </div>
    </div>
    <div class="container" id="container-main">
        <div class="row">
            
            
                
                <aside id="sidebar-first" class="sidebar col-md-2 hidden-xs hidden-sm hidden-print">
                    
                        
                        <ul id="category_menu" class="nav nav-pills nav-stacked">
                            <li><a href="/kb/en/">Home</a></li>
                            
                                
                                    <li><a href="/kb/en/+questions/">Open Questions</a></li>
                                
                                <li><a href="/kb/en/documentation/">MariaDB Server</a></li>
                                <li><a href="/kb/en/maxscale/">MariaDB MaxScale</a></li>
                                <li><a href="/kb/en/mariadb-columnstore/">MariaDB ColumnStore</a></li>
                                <li><a href="/kb/en/connectors/">Connectors</a></li>
                            

                        </ul>
                    

                    
                        <div>
    

<div class="well well-small box actions"><div>

        <a class="btn btn-block btn-small" href="/kb/en/aws-key-management-encryption-plugin-setup-guide/">Return to article</a>
    
</div>
</div>

</div>
                    

                    

































                </aside>
            
            
            
                
            
            
            <section id="content" class="limited_width col-md-10 clearfix">
                
                    <h1>Amazon Web Services (AWS) Key Management Service (KMS) Encryption Plugin Setup Guide - Source</h1>
                

                



                <div>
                    

    

    
    <div class="revision_info">
        <dl class="table">
            <dt>Revision</dt>
            <dd><a href="/kb/en/aws-key-management-encryption-plugin-setup-guide/+r/126541/">126541</a></dd>
            <dt>User</dt>
            <dd>
<span class="user" id="user-2087">
<a href="/kb/user/id/2087" title="Kolbe Kegel">Kolbe Kegel</a>
</span></dd>
            <dt>Date</dt>
            <dd>

<span class="datetime" title="2023-05-30 12:20">2023-05-30 12:20</span></dd>
        </dl>
    </div>
    


    

    
        
        <textarea id="answer_source" class="creole_source autogrow">&lt;&lt;toc&gt;&gt;

== Overview

MariaDB contains a robust, full instance, at-rest encryption. This feature uses a flexible plugin interface to allow actual encryption to be done using a key management approach that meets the customer&#39;s needs. MariaDB Server, starting with MariaDB 10.2, includes a plugin that uses the Amazon Web Services (AWS) Key Management Service (KMS) to facilitate separation of responsibilities and remote logging &amp; auditing of key access requests.

Rather than storing the encryption key in a local file, this plugin keeps the master key in AWS KMS. When you first start MariaDB, the AWS KMS plugin will connect to the AWS Key Management Service and ask it to generate a new key. MariaDB will store that key on-disk in an encrypted form. The key stored on-disk cannot be used to decrypt the data; rather, on each startup, MariaDB connects to AWS KMS and has the service decrypt the locally-stored key(s). The decrypted key is stored in-memory as long as the MariaDB server process is running, and that in-memory decrypted key is used to encrypt the local data.

This guide is based on CentOS 7, using systemd with SELinux enabled. Some steps will differ if you use other operating systems or configurations.

== Installing the Plugin&#39;s Package

The AWS Key Management plugin depends on the [[https://github.com/aws/aws-sdk-cpp|AWS SDK for C++]], which uses the [[https://github.com/aws/aws-sdk-cpp/blob/master/LICENSE|Apache License, Version 2.0]]. This license is not compatible with MariaDB Server&#39;s [[mariadb-license|GPL 2.0 license]], so we are not able to distribute packages that contain the AWS Key Management plugin. Therefore, the only way to currently obtain the plugin is to install it from source.

=== Installing from Source

When [[compiling-mariadb-from-source|compiling MariaDB from source]], the AWS Key Management plugin is not built by default in MariaDB 10.1, but it is built by default in MariaDB 10.2 and later, on systems that support it.

Compilation is controlled by the ##-DPLUGIN_AWS_KEY_MANAGEMENT=DYNAMIC -DAWS_SDK_EXTERNAL_PROJECT=1## [[generic-build-instructions/#using-cmake|cmake]] arguments.

The plugin uses [[https://github.com/awslabs/aws-sdk-cpp | AWS C++ SDK]], which introduces the following restrictions:
* The plugin can only be built on Windows, Linux and macOS.
* The plugin requires that one of the following compilers is used: ##gcc## 4.8 or later, ##clang## 3.3 or later, Visual Studio 2013 or later.
* On Unix, the ##libcurl## development package (e.g. ##libcurl3-dev## on Debian Jessie), ##uuid## development package and ##openssl## need to be installed.
* You may need to use a newer version of [[generic-build-instructions/#using-cmake|cmake]] than is provided by default in your OS.

== Installing the Plugin

Even after the package that contains the plugin&#39;s shared library is installed on the operating system, the plugin is not actually installed by MariaDB by default. There are two methods that can be used to install the plugin with MariaDB.

The first method can be used to install the plugin without restarting the server. You can install the plugin dynamically by executing [[install-soname|INSTALL SONAME]] or [[install-plugin|INSTALL PLUGIN]]. For example:

&lt;&lt;sql&gt;&gt;
INSTALL SONAME &#39;aws_key_management&#39;;
&lt;&lt;/sql&gt;&gt;

The second method can be used to tell the server to load the plugin when it starts up. The plugin can be installed this way by providing the [[mysqld-options/#-plugin-load|--plugin-load]] or the [[mysqld-options/#-plugin-load-add|--plugin-load-add]] options. This can be specified as a command-line argument to [[mysqld-options|mysqld]] or it can be specified in a relevant server [[configuring-mariadb-with-option-files/#option-groups|option group]] in an [[configuring-mariadb-with-option-files|option file]]. For example:

&lt;&lt;code&gt;&gt;
[mariadb]
...
plugin_load_add = aws_key_management
&lt;&lt;/code&gt;&gt;

== Sign up for Amazon Web Services
If you already have an AWS account, you can skip this section.

# Load http://aws.amazon.com/.
# Click &#34;Create a Free Account&#34; and complete the steps.
# You&#39;ll need to enter credit card information. Charges related only to your use of the AWS KMS service should be limited to about $1/month for the single master key we will create. If you use other services, additional charges may apply. Consult AWS Cloud Pricing Principles https://aws.amazon.com/pricing/ for more information about pricing of AWS services.
# You&#39;ll need to complete the AWS identify verification process.

== Create an IAM User and/or Role
After creating an account or logging in to an existing account, follow these steps to create an IAM User or Role with restricted privileges that will use (but not administer) your master encryption key.

If you intend to run MariaDB Server on an EC2 instance, you should create a Role (or modify an existing Role already attached to your instance). If you intent to run MariaDB Server outside of AWS, you may want to create a User.

=== Creating an IAM Role

# Load the Identity and Access Management Console at https://console.aws.amazon.com/iam/.
# Click &#34;Roles&#34; in the left-hand sidebar
# Click &#34;Create new role&#34;
# Select &#34;AWS Service Role&#34;
# Click the &#34;Select&#34; button next to &#34;Amazon EC2 / Allows EC2 instances to call AWS services on your behalf.&#34;
# Do not select any policies on the &#34;Attach Policy&#34; screen. Click &#34;Next Step&#34;
# Click &#34;Next Step&#34;
# Give your Role a &#34;Role name&#34;
# Click &#34;Create role&#34;

=== Creating an IAM User

# Load the Identity and Access Management Console at https://console.aws.amazon.com/iam/.
# Click &#34;Users&#34; in the left-hand sidebar.\\
&lt;&lt;image slug=aws-kms-create-new-user style=&#34;max-height:300px;max-width:500px&#34; href=&#34;/kb/en/mariadb-enterprise-aws-kms-encryption-plugin-setup-guide/+image/aws-kms-create-new-user&#34;&gt;&gt;
# Click the &#34;Create New Users&#34; button
# Enter a single User Name of your choosing. We&#39;ll use &#34;MDBEnc&#34; for this demonstration. Keep the &#34;Generate an access key for each user&#34; box checked.\\
&lt;&lt;image slug=aws-kms-enter-user-names style=&#34;max-height:300px;max-width:500px&#34; href=&#34;/kb/en/mariadb-enterprise-aws-kms-encryption-plugin-setup-guide/+image/aws-kms-enter-user-names&#34;&gt;&gt;
# Click &#34;Create&#34;.
# Click &#34;Show User Security Credentials&#34;.\\
&lt;&lt;image slug=aws-kms-show-security-credentials style=&#34;max-height:300px;max-width:500px&#34; href=&#34;/kb/en/mariadb-enterprise-aws-kms-encryption-plugin-setup-guide/+image/aws-kms-show-security-credentials&#34;&gt;&gt;
# Copy the Access Key ID and Secret Access Key. Optionally, you can click &#34;Download Credentials&#34;. We will need these in order for local programs to interact with AWS using its API.\\
&lt;&lt;image slug=aws-kms-copy-security-credentials style=&#34;max-height:300px;max-width:500px&#34; href=&#34;/kb/en/mariadb-enterprise-aws-kms-encryption-plugin-setup-guide/+image/aws-kms-copy-security-credentials&#34;&gt;&gt;
# Create a file on your computer to hold the credentials for this user. We&#39;ll use this file later. It should have this structure: &lt;&lt;code inline=false&gt;&gt;[default]
aws_access_key_id = AKIAIG6IZ6TKF52FVV5A
aws_secret_access_key = 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
&lt;&lt;/code&gt;&gt;
# Click &#34;Close&#34;. If prompted because you did not Download Credentials, ensure that you&#39;ve saved them somewhere, and click &#34;Close&#34;.

== Create a Master Encryption Key
Now, we&#39;ll create a master encryption key. This key can //never// be retrieved by //any// application or user. This key is used remotely to encrypt (and decrypt) the actual encryption keys that will be used by MariaDB. If this key is deleted or you lose access to it, you will be unable to use the contents of your MariaDB data directory.

# Click &#34;Encryption Keys&#34; in the left-hand sidebar.
# Click the &#34;Get Started Now&#34; button.
# Use the &#34;Filter&#34; dropdown to choose the region where you&#39;d like to create your master key. 
# Click the &#34;Create Key&#34; button.\\
&lt;&lt;image slug=aws-kms-create-key style=&#34;max-height:300px;max-width:500px&#34; href=&#34;/kb/en/mariadb-enterprise-aws-kms-encryption-plugin-setup-guide/+image/aws-kms-create-key&#34;&gt;&gt;
# Enter an Alias and Description of your choosing.
# Click &#34;Next Step&#34;.
# Do **not** check the box to make your IAM Role or IAM User user a Key Administrator.
# Click &#34;Next Step&#34; again.
# Check the boxes to give your IAM Role and/or IAM User permissions to use this key.\\
&lt;&lt;image slug=aws-kms-key-usage-permissions style=&#34;max-height:300px;max-width:500px&#34; href=&#34;/kb/en/mariadb-enterprise-aws-kms-encryption-plugin-setup-guide/+image/aws-kms-key-usage-permissions&#34;&gt;&gt;
# Click &#34;Next Step&#34;.
# Click &#34;Finish&#34;.

You should now see your key listed in the console:

&lt;&lt;image slug=aws-kms-key-list-console style=&#34;max-height:300px;max-width:500px&#34; href=&#34;/kb/en/mariadb-enterprise-aws-kms-encryption-plugin-setup-guide/+image/aws-kms-key-list-console&#34;&gt;&gt;

You&#39;ll use the &#34;Alias&#34; you provided when you configure MariaDB later.

We now have a Customer Master Key and an IAM user that has privileges to access it using access credentials. This is enough to begin using the AWS KMS plugin.

== Configure AWS Credentials

There are a number of ways to give the IAM credentials to the AWS KMS plugin. The plugin supports reading credentials from all standard locations used across the various AWS API clients.

The easiest approach is to run MariaDB Server in an EC2 instance that has an IAM Role with User access to the CMK you wish to use. You can give key access privileges to a Role already attached to your EC2 instance, or you can create a new IAM Role and attach it to an already-running EC2 instance. If you&#39;ve done that, no further credentials management is required and you do not need to create a ##credentials## file.

If you&#39;re not running MariaDB Server on an EC2 instance, you can also place the credentials in the MariaDB data directory. The AWS API client looks for a ##credentials## file in the ##.aws## subdirectory of the home directory of the user running the client process. In the case of MariaDB, its home directory is its ##datadir##.

# Create a ##credentials## file that MariaDB can read. Use the region you selected when creating the key. Master keys cannot be used across regions. For example:&lt;&lt;code inline=false&gt;&gt;$ cat /var/lib/mysql/.aws/credentials
[default]
aws_access_key_id = AKIAIG6IZ6TKF52FVV5A
aws_secret_access_key = o7CEf7KhZfsVF9cS0a2roqqZNmuzXtIR869zpSBT
region = us-east-1
&lt;&lt;/code&gt;&gt;
# Change the permissions of the file so that it it is owned by, and can only be read by, the ##mysql## user:&lt;&lt;code inline=false&gt;&gt;chown mysql /var/lib/mysql/.aws/credentials
chmod 600 /var/lib/mysql/.aws/credentials
&lt;&lt;/code&gt;&gt;

== Configure MariaDB

# Create a new option file to tell MariaDB to enable encryption functionality and to use the AWS KMS plugin. Create a new file under ##/etc/my.cnf.d/## (or wherever your OS may have you create such files) with contents like this:

&lt;&lt;code&gt;&gt;
[mariadb]
plugin_load_add = aws_key_management
aws-key-management = FORCE_PLUS_PERMANENT
aws-key-management-master-key-id = alias/mariadb-encryption
aws-key-management-region = us-east-1
!include /etc/my.cnf.d/enable_encryption.preset
&lt;&lt;/code&gt;&gt;

# Append the &#34;Alias&#34; value you copied above to ##alias/## to use as the value for the ##aws-key-management-master-key-id## option.

Note that you **must** include ##aws-key-management-region## in your .cnf file if you are not using the us-east-1 region.

Now, you have told MariaDB to use the AWS KMS plugin and you&#39;ve put credentials for the plugin in a location where the plugin will find them. The /etc/my.cnf.d/enable_encryption.preset file contains a set of options that enable all available encryption functionality.

When you start MariaDB, the AWS KMS plugin will connect to the AWS Key Management Service and ask it to generate a new key. MariaDB will store that key on-disk in an encrypted form. The key stored on-disk cannot be used to decrypt the data; rather, on each startup, MariaDB must connect to AWS KMS and have the service decrypt the locally-stored key. The decrypted version is stored in-memory as long as the MariaDB server process is running, and that in-memory decrypted key is used to encrypt the local data.

=== SELinux and Outbound Connections from MariaDB
Because MariaDB needs to connect to the AWS KMS service, you must ensure that the host has outbound network connectivity over port 443 to AWS and you must ensure that local policies allow the MariaDB server process to make those outbound connections. By default, SELinux restricts MariaDB from making such connections.

The most simple way to cause SELinux to allow outbound HTTPS connections from MariaDB is to enable to mysql_connect_any boolean, like this:

&lt;&lt;code&gt;&gt;
setsebool -P mysql_connect_any 1
&lt;&lt;/code&gt;&gt;

There are more complex alternatives that have a more granular effect, but those are beyond the scope of this document.

== Start MariaDB

Start MariaDB using the ##systemctl## tool:
&lt;&lt;code&gt;&gt;
systemctl start mariadb
&lt;&lt;/code&gt;&gt;

If you do not use systemd, you may have to start MariaDB using some other mechanism.

You should see journal output similar to this:

&lt;&lt;code&gt;&gt;
# journalctl --no-pager -o cat -u mariadb.service

[Note] /usr/sbin/mysqld (mysqld 10.1.9-MariaDB-enterprise-log) starting as process 19831 ...
[Note] AWS KMS plugin: generated encrypted datakey for key id=1, version=1
[Note] AWS KMS plugin: loaded key 1, version 1, key length 128 bit
[Note] InnoDB: Using mutexes to ref count buffer pool pages
[Note] InnoDB: The InnoDB memory heap is disabled
[Note] InnoDB: Mutexes and rw_locks use GCC atomic builtins
[Note] InnoDB: Memory barrier is not used
[Note] InnoDB: Compressed tables use zlib 1.2.7
[Note] InnoDB: Using CPU crc32 instructions
[Note] InnoDB: Initializing buffer pool, size = 2.0G
[Note] InnoDB: Completed initialization of buffer pool
[Note] InnoDB: Highest supported file format is Barracuda.
[Note] InnoDB: 128 rollback segment(s) are active.
[Note] InnoDB: Waiting for purge to start
[Note] InnoDB:  Percona XtraDB (http://www.percona.com) 5.6.26-74.0 started; log sequence number 1616819
[Note] InnoDB: Dumping buffer pool(s) not yet started
[Note] Plugin &#39;FEEDBACK&#39; is disabled.
[Note] AWS KMS plugin: generated encrypted datakey for key id=2, version=1
[Note] AWS KMS plugin: loaded key 2, version 1, key length 128 bit
[Note] Using encryption key id 2 for temporary files
[Note] Server socket created on IP: &#39;::&#39;.
[Note] Reading of all Master_info entries succeded
[Note] Added new Master_info &#39;&#39; to hash table
[Note] /usr/sbin/mysqld: ready for connections.
&lt;&lt;/code&gt;&gt;

Note the several lines of output that refer explicitly to the &#34;AWS KMS plugin&#34;. You can see that the plugin generates a &#34;datakey&#34;, loads that data key, and then later generates and loads a second data key. The 2nd data key is used to encrypt temporary files and temporary tables.

You can see the encrypted keys stored on-disk in the datadir:

&lt;&lt;code&gt;&gt;
# ls -l /var/lib/mysql/aws*
-rw-rw----. 1 mysql mysql 188 Feb 25 18:55 /var/lib/mysql/aws-kms-key.1.1
-rw-rw----. 1 mysql mysql 188 Feb 25 18:55 /var/lib/mysql/aws-kms-key.2.1
&lt;&lt;/code&gt;&gt;

Note that those keys are not useful alone. They are encrypted. When MariaDB starts up, the AWS KMS plugin decrypts those keys by interacting with AWS KMS.

For maximum security, you should start from an empty datadir and run [[mariadb-install-db]] after configuring encryption. Then you should re-import your data so that it is fully encrypted. Use ##sudo## to run ##mariadb-install-db## so that it finds your credentials file:

&lt;&lt;code wrap=true&gt;&gt;
# sudo -u mysql mariadb-install-db
Installing MariaDB/MySQL system tables in &#39;/var/lib/mysql&#39; ...
2016-02-25 23:16:06 139731553998976 [Note] /usr/sbin/mysqld (mysqld 10.1.11-MariaDB-enterprise-log) starting as process 39551 ...
2016-02-25 23:16:07 139731553998976 [Note] AWS KMS plugin: generated encrypted datakey for key id=1, version=1
2016-02-25 23:16:07 139731553998976 [Note] AWS KMS plugin: loaded key 1, version 1, key length 128 bit
...
&lt;&lt;/code&gt;&gt;

== Create Encrypted Tables

With ##innodb-encrypt-tables=ON##, new InnoDB tables will be encrypted by default, using the key ID set in ##innodb_default_encryption_key_id## (default 1). With ##innodb-encrypt-tables=FORCE## enabled, it is not possible to manually bypass encryption when creating a table.

You can cause the AWS KMS plugin to create new encryption keys at-will by specifying a new ENCRYPTION_KEY_ID when creating a table:

&lt;&lt;code&gt;&gt;
MariaDB [test]&gt; create table t1 (id serial, v varchar(32)) ENCRYPTION_KEY_ID=3;
Query OK, 0 rows affected (0.91 sec)
&lt;&lt;/code&gt;&gt;

&lt;&lt;code&gt;&gt;
[Note] AWS KMS plugin: generated encrypted datakey for key id=3, version=1
[Note] AWS KMS plugin: loaded key 3, version 1, key length 128 bit
&lt;&lt;/code&gt;&gt;

&lt;&lt;code&gt;&gt;
# ls -l /var/lib/mysql/aws*
-rw-rw----. 1 mysql mysql 188 Feb 25 18:55 /var/lib/mysql/aws-kms-key.1.1
-rw-rw----. 1 mysql mysql 188 Feb 25 18:55 /var/lib/mysql/aws-kms-key.2.1
-rw-rw----. 1 mysql mysql 188 Feb 25 19:10 /var/lib/mysql/aws-kms-key.3.1
&lt;&lt;/code&gt;&gt;

Read more about encrypting data in the [[data-at-rest-encryption#encrypting-data|Data at Rest Encryption]] section of the MariaDB Documentation.

== AWS KMS Plugin Option Reference

* ##aws_key_management_master_key_id##: AWS KMS Customer Master Key ID (ARN or alias prefixed by ##alias/##) for master encryption key. Used to create new data keys. If not set, no new data keys will be created.
* ##aws_key_management_rotate_key##: Set this variable to a data key ID to perform rotation of the key to the master key given in ##aws_key_management_master_key_id##. Specify -1 to rotate all keys.

* ##aws_key_management_key_spec##: Encryption algorithm used to create new keys. Allowed values are AES_128 (default) or AES_256.
* ##aws_key_management_log_level##: Logging for AWS API. Allowed values, in increasing verbosity, are &#34;Off&#34; (default), &#34;Fatal&#34;, &#34;Error&#34;, &#34;Warn&#34;, &#34;Info&#34;, &#34;Debug&#34;, and &#34;Trace&#34;.

== Next Steps

For more information about advanced usage, including strategies to manage credentials, enforce separation of responsibilities, and even require 2-factor authentication to start your MariaDB server, please review [[aws-key-management-encryption-plugin-advanced-usage|Amazon Web Services (AWS) Key Management Service (KMS) Encryption Plugin Advanced Usage]].</textarea>
    


                    <div id="content_disclaimer" class="graybox">
                        Content reproduced on this site is the property of its respective owners,
                        and this content is not reviewed in advance by MariaDB. The views, information and opinions
                        expressed by this content do not necessarily represent those of MariaDB or any other party.
                    </div>
                </div>
            </section>

            
        </div>
    </div>
</div>

<!-- Footer -->
<footer id="footer">
    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-xs-12">
                    <ul class="list-inline text-center footer-nav">
                        <li>
                            <h5>
                                <a href="https://mariadb.com/products" title="Products">Products</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/solutions" title="Solutions">Solutions</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/resources" title="Resources">Resources</a>
                            </h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/about-us" title="About MariaDB">Company</a></h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/pricing" title="Pricing">Pricing</a>
                            </h5>
                        </li>
                        
                        
                        <li>
                            <h5><a href="https://mariadb.com/downloads" title="Download">Download MariaDB</a></h5>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="row row-10">
                
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div id="block-footerformcontact" class="block block-block-content block-block-contentd754ee1b-3cc9-40e7-9ef4-f504f1197fb1">
                        
                            <h5 style="font-weight: 400;">Subscribe to our newsletter!</h5>
                            <script src="//app-sj15.marketo.com/js/forms2/js/forms2.min.js"></script><form id="mktoForm_1498"></form>
                            <script>
                                <!--//--><![CDATA[// ><!--
                                MktoForms2.loadForm("//app-sj15.marketo.com", "573-PXI-984", 1498);
                                //--><!]]]]><![CDATA[>
                                //--><!]]>
                            </script>
                        
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div class="footer-copyright">
                        <div class="text-center">
                            <ul class="list-inline no-margin">
                                <li>
                                    <a href="/legal" title="Legal">Legal</a>
                                </li>
                                <li>
                                    <a href="/privacy-policy" title="Privacy Policy">Privacy Policy</a>
                                </li>
                                <li>
                                    <a href="/cookie-policy/" title="Cookies">Cookie Policy</a>
                                </li>
                            </ul>
                            <p>Copyright &copy; 2025 MariaDB. All rights reserved.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</footer>
</div>

<div id="ajax_loading">
    <img src="/kb/static/images/ajax-loader.a51c5608d01a.gif" />
</div>

    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MK2847"
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MK2847');</script>
    <!-- End Google Tag Manager -->

</body>

<script type="text/javascript" src="/kb/static/js/main.1587e3a666fc.js" charset="utf-8"></script>

</html>