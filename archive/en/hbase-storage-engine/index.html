<!DOCTYPE html>
<html>
<head data-cookie-domain=""
      data-cookie-path="/">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="apple-touch-icon" sizes="180x180" href="/kb/static/images/favicons/apple-touch-icon.159e713979be.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/kb/static/images/favicons/favicon-32x32.bc0ac1d5d11e.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/kb/static/images/favicons/favicon-16x16.5801f8f0f34e.png">
    <link rel="shortcut icon" href="/kb/static/images/favicons/favicon.d122d305dee4.ico" type="image/x-icon" />

    <title>HBase Storage Engine - MariaDB Knowledge Base</title>

    <link href="/kb/static/css/main.f7633538c846.css" rel="stylesheet" type="text/css" />

    

    

    <!-- FB Open Graph tags -->
    <meta property="og:title" content="HBase Storage Engine" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://mariadb.com/kb/en/hbase-storage-engine/" />
    <meta property="og:image" content="http://mariadb.comaskmonty-logo.png" />
    <meta property="og:site_name" content="MariaDB KnowledgeBase" />
    <meta property="fb:admins" content="514852603" />
    <meta property="og:description" content="Data mapping from HBase to SQL." />

    <meta name="description" content="Data mapping from HBase to SQL." />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet"/>
    
</head>
<body class="mpkb nodes products nodes_view jqui" id="nodes_view">





<div id="menu-mobile" class="visible-sm visible-xs">

    <div>
        <div id="mobile-close-menu" class="text-right">
            <a href="javascript:void(0)" title="Close Menu" id="back-main" class="toggle-menu">X<span></span></a>
        </div>
    </div>
    <div class="mainmenu-mobile">
        <ul class="ls-none ul-menu">
            <li data-sub="submenu5"><a class="open-form-search" href="/kb/search/" title="Search">Search </a></li>
            <li data-sub="submenu0"><a href="/products" title="Products">Products</a><span class="arrow-main"></span></li>
            <li data-sub="submenu1"><a href="/services" title="Services">Services</a><span class="arrow-main"></span></li>
            <li data-sub="submenu2"><a href="/resources" title="Resources">Resources</a><span class="arrow-main"></span></li>
            <li data-sub="submenu3"><a href="/about-us" title="About">About</a><span class="arrow-main"></span></li>
            <li data-sub="submenu4"><a href="/contact" title="Contact">Contact</a></li>
        </ul>
    </div>

    <div class="nav-top-mobile">
        <div class="select-box form">

            <ul class="inline-block-md mb-none top-nav">
                <li>

                </li>
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/hbase-storage-engine/"> Login</a>
                    </li>
                
            </ul>



        </div>
        <p class="text-center copyright">Copyright &copy; 2024 MariaDB. All rights reserved.</p>
    </div>
</div>
<div class="violator-wrap d-none" id="top_violator">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12">
                <div class="violator-outer">
                    <div class="violator-inner">
                        <div class="row">
                            <div class="col-xs-12 col-sm-9 col-lg-7 col-lg-offset-2" id="top_violator_content">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="content-link" target="_blank" rel="nofollow noreferrer">
                                    <span>The Ultimate Guide to High Availability with MariaDB</span>
                                </a>
                            </div>
                            <div class="col-xs-12 col-sm-3" id="top_violator_cta">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="btn btn-mariadb" target="_blank" rel="nofollow noreferrer">Download Now</a>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-link close-btn">
                        <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24" width="15px" height="15px"><path d="M 4.9902344 3.9902344 A 1.0001 1.0001 0 0 0 4.2929688 5.7070312 L 10.585938 12 L 4.2929688 18.292969 A 1.0001 1.0001 0 1 0 5.7070312 19.707031 L 12 13.414062 L 18.292969 19.707031 A 1.0001 1.0001 0 1 0 19.707031 18.292969 L 13.414062 12 L 19.707031 5.7070312 A 1.0001 1.0001 0 0 0 18.980469 3.9902344 A 1.0001 1.0001 0 0 0 18.292969 4.2929688 L 12 10.585938 L 5.7070312 4.2929688 A 1.0001 1.0001 0 0 0 4.9902344 3.9902344 z"/></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="wrapper">
<div id="top-nav">
    <div class="container">
        <ul class="hidden-sm hidden-xs" >
            <li><a href="https://mariadb.com/kb/">Knowledge Base</a></li>
            <li><a href="https://mariadb.com/contact/">Contact</a></li>
            
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/hbase-storage-engine/" rel="nofollow">Login</a>
                    </li>
                
            
            
            <li id="search-form">
                <form action="/kb/en/+search/" method="get" id="search-block-form" accept-charset="UTF-8">
                    <input id="search" title="Enter the terms you wish to search for."
                           placeholder="Search . . ." type="text"
                           name="q" value="" size="15" maxlength="128" class="form-text"
                           data-autocomplete-url="/kb/en/+search/autocomplete/">
                    <input type="hidden" name="quick" value="1" />
                    <input type="hidden" name="source" value="kb" />
                </form>
            </li>
            <li><a id="search-toggler" href="/kb/search/">Search</a></li>
            
        </ul>
    </div>
</div>
<div id="navbar-bottom" class="navbar">
    <div class="container">
        
        
        
        
        <div class="row">
            <div class="col-md-3 col-sm-9 col-xs-9">
                <a class="brand" href="/" title="MariaDB">
                    <img src="/kb/static/images/logo-2018-black.95f5978ae14d.png">
                </a>
            </div>
            <div class="col-md-9 hidden-sm hidden-xs">
                <div class="main-menu">
                    <ul id="main-menu" class="nav navbar-nav inline-block-sm">
    <li class="has-sub full-menu">
        <a href="/products" title="Products">Products</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/services" title="Services">Services</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/pricing" title="Pricing">Pricing</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/resources" title="Resources">Resources</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/about-us" title="About Us">About Us</a>
    </li>
    <li class="">
        <a class="button electric-eel small top-bar-right-download" href="/downloads/">Download</a>
    </li>
</ul>
                </div>
            </div>
            <div class="col-md-3 visible-sm visible-xs col-sm-3 col-xs-3 ps-rv">
                <div class="navbar-header text-right pull-right">
                    <button type="button" class="menu-control toggle-menu" id="open-menu">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="main">
    <div class="container">
        

        <div id="subheader1" class="clearfix">
            <div class="pull-left">
                
                <div id="breadcrumbs" class="breadcrumb">
                    <a href="/kb/en/">Knowledge Base</a>
                    


    
    » <a class="crumb" href="/kb/en/training-tutorials/">Training &amp; Tutorials</a>
    

    
    » <a class="crumb" href="/kb/en/advanced-mariadb-articles/">Advanced MariaDB Articles</a>
    

    
    » <a class="crumb" href="/kb/en/development-articles/">Development Articles</a>
    

    
    » <a class="crumb" href="/kb/en/outdated-pages/">Outdated pages</a>
    


    » <a class="node_link crumb" href="/kb/en/hbase-storage-engine/">HBase Storage Engine</a>


                </div>
                
            </div>
        </div>
    </div>
    <div class="container" id="container-main">
        <div class="row">
            
            
                
                <aside id="sidebar-first" class="sidebar col-md-2 hidden-xs hidden-sm hidden-print">
                    
                        
                        <ul id="category_menu" class="nav nav-pills nav-stacked">
                            <li><a href="/kb/en/">Home</a></li>
                            
                                
                                    <li><a href="/kb/en/+questions/">Open Questions</a></li>
                                
                                <li><a href="/kb/en/documentation/">MariaDB Server</a></li>
                                <li><a href="/kb/en/maxscale/">MariaDB MaxScale</a></li>
                                <li><a href="/kb/en/mariadb-columnstore/">MariaDB ColumnStore</a></li>
                                <li><a href="/kb/en/connectors/">Connectors</a></li>
                            

                        </ul>
                    

                    
<div>



<div class="well well-small box actions"><div>

        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/hbase-storage-engine/+history" rel="nofollow">History</a>
        
        
        
        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/hbase-storage-engine/+source/">Source</a>
        
        <a class="btn btn-block btn-blue btn-sm flag" href="/kb/en/hbase-storage-engine/+flag"
                data-flag-url="/kb/en/hbase-storage-engine/+flag" rel="nofollow">
                Flag as Spam / Inappropriate</a>
        
        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/hbase-storage-engine/+translate/">
                Translate</a>
        

</div>
</div>





<div class="well well-small box node_info"><div>

    <dl>
        <dt>Created</dt>
        <dd>

<span class="datetime" title="2012-05-28 15:34">12 years, 7 months ago</span></dd>

        <dt>Modified</dt>
        <dd>

<span class="datetime" title="2016-02-27 21:52">8 years, 10 months ago</span></dd>

        <dt>Type</dt>
        <dd>article</dd>

        <dt>Status</dt>
        <dd>active</dd>

        <dt>License</dt>
        <dd>
            
                <a href="/kb/en/hbase-storage-engine/+license/">CC BY-SA / Gnu FDL</a>
            
        </dd>

        
    </dl>

    
    <ul class="rss_feeds">
        <li><a href="/kb/en/hbase-storage-engine/+history/feed/">
            History</a>
        </li>
        <li><a href="/kb/en/hbase-storage-engine/+comments/feed/">
            Comments</a>
        </li>
    </ul>
    

</div>
</div>





    
    
    

<div class="well well-small box attachments"><div><div class="edit_link pull-right"><a href="/kb/en/hbase-storage-engine/+edit/attachments/">Edit</a></div><h5>Attachments</h5></div><div>

        
            <div class="no_data">No attachments exist</div>
        
    
</div>
</div>

    



    
    
        

<div class="well well-small box"><div><h5>Localized Versions</h5></div><div>

        <ul>
            
            <li><a href="/kb/it/hbase-storage-engine/">Lo Storage Engine HBase</a> [it]</li>
            
        </ul>
        
</div>
</div>

    






</div>


                    

































                </aside>
            
            
            
                
            
            
                
            
            <section id="content" class="limited_width col-md-8 clearfix">
                
                    <h1>HBase Storage Engine</h1>
                

                



                <div>
                    
    

    
    
    

    <div class="node creole">
        
        
        


    
    <div class="answer formatted">
        <p>Data mapping from HBase to SQL</p>
<p>The Jira task for this is <a href="https://jira.mariadb.org/browse/MDEV-122">MDEV-122</a></p>
<div class="cstm-style redbox" style="text-align:center;font-family:Droid Sans;font-weight:bold;"><p>Nobody is working on this feature ATM. See <a href="/kb/en/cassandra-storage-engine/">Cassandra Storage Engine</a> for a related development that has reached the release stage.</p>
</div><div class="cstm-style redbox" style="text-align:center;font-size:0.8em;font-family:Droid Sans;"><p>This page describes a feature that's under development. The feature has not been released (even in beta), its interface and function may change, etc.</p>
</div><div class="table_of_contents well well-small">
<h3>Contents</h3>
 <ol class="toc">

    <li class=""><a href="#hbase-data-model-and-operations" title="Hbase data model and operations">Hbase data model and operations</a>    <ol class="toc">

        <li class=""><a href="#11-hbase-data-model" title="1.1 HBase data model">1.1 HBase data model</a></li>

        <li class=""><a href="#12-hbase-read-operations" title="1.2 Hbase read operations">1.2 Hbase read operations</a>    </ol>
</li>

    <li class=""><a href="#2-per-cell-mapping" title="2. Per-cell mapping">2. Per-cell mapping</a>    <ol class="toc">

        <li class=""><a href="#21-table-definition" title="2.1 Table definition">2.1 Table definition</a></li>

        <li class=""><a href="#22-queries-in-per-cell-mapping" title="2.2 Queries in per-cell mapping">2.2 Queries in per-cell mapping</a></li>

        <li class=""><a href="#23-mapping-of-sql-statements" title="2.3 Mapping of SQL statements">2.3 Mapping of SQL statements</a>        <ol class="toc">

            <li class=""><a href="#mapping-for-select" title="Mapping for SELECT">Mapping for SELECT</a>            <ol class="toc">

                <li class=""><a href="#multiple-non-equality-conditions" title="Multiple non-equality conditions">Multiple non-equality conditions</a>            </ol>
</li>

            <li class=""><a href="#mapping-for-insert" title="Mapping for INSERT">Mapping for INSERT</a></li>

            <li class=""><a href="#mapping-for-delete" title="Mapping for DELETE">Mapping for DELETE</a></li>

            <li class=""><a href="#mapping-for-update" title="Mapping for UPDATE">Mapping for UPDATE</a>        </ol>
    </ol>
</li>

    <li class=""><a href="#3-per-row-mapping" title="3. Per-row mapping">3. Per-row mapping</a>    <ol class="toc">

        <li class=""><a href="#32-mapping-definition" title="3.2 Mapping definition">3.2 Mapping definition</a></li>

        <li class=""><a href="#321-required-improvements-in-dynamic-columns" title="3.2.1 Required improvements in Dynamic Columns">3.2.1 Required improvements in Dynamic Columns</a></li>

        <li class=""><a href="#33-queries-in-per-row-mapping" title="3.3 Queries in per-row mapping">3.3 Queries in per-row mapping</a></li>

        <li class=""><a href="#34-efficient-execution-for-per-row-mapping" title="3.4 Efficient execution for per-row mapping">3.4 Efficient execution for per-row mapping</a>        <ol class="toc">

            <li class=""><a href="#341-predicate-analysis" title="3.4.1 Predicate analysis">3.4.1 Predicate analysis</a></li>

            <li class=""><a href="#342-dynamic-columns-optimizations" title="3.4.2 Dynamic columns optimizations">3.4.2 Dynamic columns optimizations</a></li>

            <li class=""><a href="#solution-1-on-demand-reads" title="Solution #1: on-demand reads">Solution #1: on-demand reads</a></li>

            <li class=""><a href="#solution-2-list-of-reads" title="Solution #2: List of reads">Solution #2: List of reads</a>        </ol>
</li>

        <li class=""><a href="#35-mapping-of-sql-statements" title="3.5 Mapping of SQL statements">3.5 Mapping of SQL statements</a>        <ol class="toc">

            <li class=""><a href="#select" title="SELECT">SELECT</a></li>

            <li class=""><a href="#insert" title="INSERT">INSERT</a></li>

            <li class=""><a href="#delete" title="DELETE">DELETE</a></li>

            <li class=""><a href="#update" title="UPDATE">UPDATE</a>        </ol>
    </ol>
</li>

    <li class=""><a href="#4-select-columns-mapping" title="4. Select-columns mapping">4. Select-columns mapping</a></li>

    <li class=""><a href="#5-comparison-of-the-mappings" title="5. Comparison of the mappings">5. Comparison of the mappings</a></li>

    <li class=""><a href="#6-interfacing-with-hbase" title="6. Interfacing with HBase">6. Interfacing with HBase</a>    <ol class="toc">

        <li class=""><a href="#61-use-thrift" title="6.1 Use Thrift">6.1 Use Thrift</a></li>

        <li class=""><a href="#62-re-implement-hbases-network-protocol" title="6.2 Re-implement HBase&#39;s network protocol">6.2 Re-implement HBase&#39;s network protocol</a></li>

        <li class=""><a href="#63-use-jnihbase-client-protocol" title="6.3 Use JNI+HBase client protocol">6.3 Use JNI+HBase client protocol</a>    </ol>
</li>

    <li class=""><a href="#7-consistency-transactions-etc" title="7. Consistency, transactions, etc">7. Consistency, transactions, etc</a></li>

    <li class=""><a href="#8-batching" title="8. Batching">8. Batching</a></li>

    <li class=""><a href="#9-results-of-discussion-with-monty" title="9. Results of discussion with Monty">9. Results of discussion with Monty</a> </ol>
</li>
</div>
<h2 class="anchored_heading" id="hbase-data-model-and-operations">Hbase data model and operations</h2>
<h3 class="anchored_heading" id="11-hbase-data-model">1.1 HBase data model</h3>
<ul start="1"><li>An HBase table consists of rows, which are identified by row key. 
</li><li>Each row has an arbitrary (potentially, very large) number of columns.
</li><li>Columns are split into column groups, column groups define how the columns 
  are stored (not reading some column groups is an optimization).
</li><li>Each (row, column) combination can have multiple versions of the data,
  identified by timestamp.
</li></ul>
<h3 class="anchored_heading" id="12-hbase-read-operations">1.2 Hbase read operations</h3>
<p>HBase API defines two ways to read data:</p>
<ul start="1"><li>Point lookup: get record for a given row_key.
</li></ul>
<ul start="1"><li>Point scan: read all records in [startRow, stopRow) range. 
</li></ul>
<p>Both kinds of scans allow to specify:</p>
<ul start="1"><li>A column family we're interested in 
</li><li>A particular column we're interested in
</li></ul>
<p>The default behavior for versioned columns is to return only the most recent
version.  HBase API also allows to ask for </p>
<ul start="1"><li>versions of columns that were valid at some specific timestamp value;
</li><li>all versions that were valid within a specifed [minStamp, maxStamp)
  interval.
</li><li>N most recent versions
We'll refer to the above as [VersionedDataConds].
</li></ul>
<p>One can see two ways to map HBase tables to SQL tables:</p>
<ul start="1"><li>Per-cell mapping 
</li><li>Per-row mapping
</li></ul>
<h2 class="anchored_heading" id="2-per-cell-mapping">2. Per-cell mapping</h2>
<p>HBase shell has 'scan' command, here's an example of its output:</p>
<pre class="fixed">hbase(main):007:0&gt; scan 'testtable'
 ROW COLUMN+CELL
  myrow-1 column=colfam1:q1, timestamp=1297345476469, value=value-1
  myrow-2 column=colfam1:q2, timestamp=1297345495663, value=value-2
  myrow-2 column=colfam1:q3, timestamp=1297345508999, value=value-3
</pre><p>Here, one HBase row produces multiple rows in the query output. Each 
output row represents one (row_id, column) combination, so rows with 
multiple columns (and multiple revisions of column data) can be easily 
represented.</p>
<h3 class="anchored_heading" id="21-table-definition">2.1 Table definition</h3>
<p>Mapping could be defined as follows:</p>
<pre class="fixed"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">hbase_tbl_cells</span> <span class="p">(</span>
  <span class="n">row_id</span> <span class="nb">binary</span><span class="p">(</span><span class="n">MAX_HBASE_ROWID_LEN</span><span class="p">),</span>
  <span class="n">column_family</span> <span class="nb">binary</span><span class="p">(</span><span class="n">MAX_HBASE_COLFAM_LEN</span><span class="p">),</span>
  <span class="k">column_name</span> <span class="nb">binary</span><span class="p">(</span><span class="n">MAX_HBASE_NAME_LEN</span><span class="p">),</span>
  <span class="k">timestamp</span> <span class="k">TIMESTAMP</span><span class="p">,</span>
  <span class="n">value</span> <span class="nb">BLOB</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">row_id</span><span class="p">,</span> <span class="n">column_family</span><span class="p">,</span> <span class="k">column_name</span><span class="p">,</span> <span class="k">timestamp</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">hbase_cell</span><span class="p">;</span>
</pre><p>There is no need for dynamic columns in this mapping.</p>
<ul start="1"><li>NOTE: It is nice to have SQL table DDLs independent of the content of
  the backend hbase table. This saves us from the need to synchronize
  table DDLs between hbase and mysql (NDB cluster had to do this and they
  have ended up implementing a very complex system to do this).
</li></ul>
<h3 class="anchored_heading" id="22-queries-in-per-cell-mapping">2.2 Queries in per-cell mapping</h3>
<pre class="fixed"><span class="o">#</span> <span class="n">Point</span><span class="o">-</span><span class="k">select</span><span class="p">:</span>
<span class="k">SELECT</span> <span class="n">value</span> 
<span class="k">FROM</span> <span class="n">hbase_cell</span>
<span class="k">WHERE</span> 
  <span class="n">row_id</span><span class="o">=</span><span class="s1">&#39;hbase_row_id&#39;</span> <span class="k">AND</span> 
  <span class="n">column_family</span><span class="o">=</span><span class="s1">&#39;hbase_column_family&#39;</span> <span class="k">AND</span> <span class="k">column_name</span><span class="o">=</span><span class="s1">&#39;hbase_column&#39;</span>
  <span class="p">...</span>
</pre><pre class="fixed"><span class="o">#</span>  <span class="n">Range</span> <span class="k">select</span><span class="p">:</span>
<span class="o">#</span>   <span class="p">(</span><span class="n">the</span> <span class="n">example</span> <span class="n">uses</span> <span class="k">BETWEEN</span> <span class="n">but</span> <span class="n">we</span> <span class="n">will</span> <span class="n">support</span> <span class="n">arbitrary</span> <span class="n">predicates</span><span class="p">)</span>
<span class="k">SELECT</span> <span class="n">value</span> 
<span class="k">FROM</span> <span class="n">hbase_cell</span>
<span class="k">WHERE</span> 
  <span class="n">row_id</span> <span class="k">BETWEEN</span> <span class="s1">&#39;hbase_row_id1&#39;</span> <span class="k">AND</span> <span class="s1">&#39;hbase_row_id2&#39;</span> <span class="k">AND</span> 
  <span class="n">column_family</span><span class="o">=</span><span class="s1">&#39;hbase_column_family&#39;</span> <span class="k">AND</span> <span class="k">column_name</span><span class="o">=</span><span class="s1">&#39;hbase_column&#39;</span>
</pre><pre class="fixed"><span class="o">#</span> <span class="k">Update</span> <span class="n">a</span> <span class="n">value</span> <span class="k">for</span> <span class="err">{</span><span class="k">row</span><span class="p">,</span> <span class="k">column</span><span class="err">}</span>
<span class="k">UPDATE</span> <span class="n">hbase_cell</span> <span class="k">SET</span> <span class="n">value</span><span class="o">=</span><span class="s1">&#39;value&#39;</span> 
<span class="k">WHERE</span> <span class="n">row_id</span><span class="o">=</span><span class="s1">&#39;hbase_row&#39;</span> <span class="k">AND</span> 
      <span class="n">column_family</span><span class="o">=</span><span class="s1">&#39;col_family&#39;</span> <span class="k">AND</span> <span class="k">column_name</span><span class="o">=</span><span class="s1">&#39;col_name&#39;</span>
</pre><pre class="fixed"><span class="o">#</span> <span class="k">Add</span> <span class="n">a</span> <span class="k">column</span> <span class="k">into</span> <span class="k">row</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">hbase_cell</span> <span class="k">values</span> <span class="p">(</span><span class="s1">&#39;hbase_row&#39;</span><span class="p">,</span> <span class="s1">&#39;col_family&#39;</span><span class="p">,</span><span class="s1">&#39;col_name&#39;</span><span class="p">,</span><span class="s1">&#39;value&#39;</span><span class="p">);</span>
</pre><p>Note that</p>
<ul start="1"><li>accessing versioned data is easy: one can read some particular version, versions within a date range, etc
</li><li>it is also easy to select all columns from a certain column family.
</li></ul>
<h3 class="anchored_heading" id="23-mapping-of-sql-statements">2.3 Mapping of SQL statements</h3>
<h4 class="anchored_heading" id="mapping-for-select">Mapping for SELECT</h4>
<p>The table is defined as having a </p>
<pre class="fixed">  PRIMARY KEY (row_id, column_family, column_name, timestamp)
</pre><p>which allows to make use of range optimizer to get ranges on</p>
<ul start="1"><li>rowid
</li><li>rowid, column_family
</li><li>rowid, column_family, column_name
</li><li>...
</li></ul>
<p>If a range specifies one row, we can read it with HTable.get(), otherwise we'll have to use HTable.getScanner() and make use of the obtained scanner.</p>
<h5 class="anchored_heading" id="multiple-non-equality-conditions">Multiple non-equality conditions</h5>
<p>HBase API allows to scan a range of rows, retrieving only certain column name
or certain column families. In our SQL mapping, this can be written as:</p>
<pre class="fixed">SELECT value
FROM hbase_cell
WHERE
  row_id BETWEEN 'hbase_row_id1' AND 'hbase_row_id2' AND
  column_family='hbase_column_family'                           (*)
</pre><p>If we feed this into the range optimizer, it will produce a range:</p>
<pre class="fixed">  ('hbase_row_id1', 'hbase_column_family') &lt;= (row_id, column_family) &lt;=
  ('hbase_row_id2', 'hbase_column_family')
</pre><p>which includes all column families for records which satisfy</p>
<pre class="fixed">  'hbase_row_id1' &lt; rowid &lt; 'hbase_row_id2'
</pre><p>This will cause extra data to be read.</p>
<p>Possible solutions:</p>
<ul start="1"><li>Extend multi-range-read interface to walk the 'SEL_ARG graph' instead of
  list of ranges. This will allow to capture the exact form of conditions 
  like (*).
</li><li>Implement table condition pushdown and and perform independent condition analysis.
</li><li>Define more indexes, so that ranges are "dense".
   <sup> what about  (row_id BETWEEN $X AND $Y) AND (timestamp BETWEEN $T1 AND
   $T2) ?  No matter which index you define, the range list will not be
   identical to the WHERE clause.</sup>
</li></ul>
<h4 class="anchored_heading" id="mapping-for-insert">Mapping for INSERT</h4>
<p>INSERT will be translated into HTable.checkAndPut(..., value=NULL) call. That way, attempt to insert a {rowid, column} that already exists will fail.</p>
<h4 class="anchored_heading" id="mapping-for-delete">Mapping for DELETE</h4>
<p>MySQL/MariaDB's storage engine API handles DELETEs like this:</p>
<ul start="1"><li>Use some way to read the record that should be deleted
</li><li>call handler-&gt;ha_delete_row(). It will delete the row that was last read.
</li></ul>
<p>ha_hbase_cell can remember {rowid, column_name} of the record, and then use HBase.checkAndDelete() call, so that we're sure we're deleting what we've read.</p>
<p>If we get a statement in form of</p>
<pre class="fixed"><span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">hbase_cell</span> 
<span class="k">WHERE</span> <span class="n">rowid</span><span class="o">=</span><span class="s1">&#39;hbase_row_id&#39;</span> <span class="k">AND</span> <span class="n">column_family</span><span class="o">=</span><span class="s1">&#39;...&#39;</span> <span class="k">AND</span> <span class="k">column_name</span><span class="o">=</span><span class="s1">&#39;...&#39;</span><span class="p">;</span>
</pre><p>then reading the record is redundant (we could just make one HBase.checkAndDelete() call). This will require some form of query pushdown, though.</p>
<h4 class="anchored_heading" id="mapping-for-update">Mapping for UPDATE</h4>
<p>UPDATEs are similar to deletes as long as row_id, column_family, and column_name fields are not changed (that is, only column_value changes).  Like with DELETEs:</p>
<ul start="1"><li>HBase.checkAndPut() call can be used to make sure we're updating what we've read
</li><li>one-point UPDATEs may need a shortcut so that we don't have to read the value before we make an update.
</li></ul>
<p>If UPDATE statement changes row_id, column_family, or column_name field, it becomes totally different. HBase doesn't allow to change rowid of a record. We can only remove the record with old rowid, and insert a record with the new rowid.  HBase doesn't support multi-row transactions, so we'll want to insert the new variant of the record before we have deleted the old one (I assume that data duplication is better than data loss).</p>
<p>For first milestone, we could disallow UPDATEs that change row_id, column_family or column_name.</p>
<h2 class="anchored_heading" id="3-per-row-mapping">3. Per-row mapping</h2>
<p>Let each row in HBase table be mapped into a row from SQL point of view:</p>
<pre class="fixed">SELECT * FROM hbase_table;

row-id column1 column2  column3  column4  ...
------ ------- -------  -------  -------  
row1    data1   data2
row2                     data3    
row3    data4                      data5
</pre><p>The problem is that the set of columns in a HBase table is not fixed and is
potentially is very large. The solution is to put all columns into one blob column
and use Dynamic Columns (<a href="http://kb.askmonty.org/en/dynamic-columns">http://kb.askmonty.org/en/dynamic-columns</a>) functions
to pack/extract values of individual columns:</p>
<pre class="fixed">row-id dyn_columns
------ ------------------------------
row1   {column1=data1,column2=data2}
row2   {column3=data3}
row3   {column1=data4,column4=data5}
</pre><h3 class="anchored_heading" id="32-mapping-definition">3.2 Mapping definition</h3>
<p>Table DDL could look like this:</p>
<pre class="fixed"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">hbase_tbl_rows</span> <span class="p">(</span>
  <span class="n">row_id</span> <span class="nb">BINARY</span><span class="p">(</span><span class="n">MAX_HBASE_ROWID_LEN</span><span class="p">),</span>
  <span class="n">columns</span> <span class="nb">BLOB</span><span class="p">,</span>  <span class="c1">-- All columns/values packed in dynamic column format</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">row_id</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">hbase_row</span><span class="p">;</span>
</pre><p>(TODO: Does Hbase have MAX_HBASE_ROWID_LEN limit? What is it? We can ignore
this. Let the user define 'row_id' column with whatever limit he desires; don't do operations with rows that have row_id longer than the limit)</p>
<p>Functions for reading data:</p>
<pre class="fixed">  COLUMN_GET(dynamic_column, column_nr as type)
  COLUMN_EXISTS(dynamic_column, column_nr);
  COLUMN_LIST(dynamic_column);
</pre><p>Functions for data modification:</p>
<pre class="fixed">  COLUMN_ADD(dynamic_column, column_nr,  value [as type], ...)
  COLUMN_DELETE(dynamic_column, column_nr, column_nr, ...);
</pre><h3 class="anchored_heading" id="321-required-improvements-in-dynamic-columns">3.2.1 Required improvements in Dynamic Columns</h3>
<p>Dynamic column functions cannot be used as-is:</p>
<ul start="1"><li><strong>HBase columns have string names, Dynamic Columns have numbers</strong> (see column_nr parameter for the above functions).  The set of column names in HBase is potentially very large, there is no way to get a list of all names: we won't be able to solve this with enum-style mapping, we'll need real support for string names.
</li></ul>
<ul start="1"><li><strong>HBase has column families, Dynamic Columns do not </strong>. Column family is not just a ':' in the column name. For example, HBase API allows to request "all columns from within a certain column family".
</li></ul>
<ul start="1"><li><strong>HBase supports versioned data, Dynamic Columns do not</strong>.  A possible limited solution is to have global/session @@hbase_timestamp variable which will globally specify the required data version.
</li></ul>
<ul start="1"><li>(See also note below about efficient execution)
</li></ul>
<p>Names for dynamic columns are covered in  <a href="https://jira.mariadb.org/browse/MDEV-377">MDEV-377</a></p>
<h3 class="anchored_heading" id="33-queries-in-per-row-mapping">3.3 Queries in per-row mapping</h3>
<pre class="fixed"><span class="o">#</span> <span class="n">Point</span><span class="o">-</span><span class="k">select</span><span class="p">,</span> <span class="k">get</span> <span class="n">value</span> <span class="k">of</span> <span class="n">one</span> <span class="k">column</span>
<span class="k">SELECT</span> <span class="n">COLUMN_GET</span><span class="p">(</span><span class="n">hbase_tbl</span><span class="p">.</span><span class="n">columns</span><span class="p">,</span> <span class="s1">&#39;column_name&#39;</span> <span class="k">AS</span> <span class="nb">INTEGER</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">hbase_tbl</span>
<span class="k">WHERE</span> 
  <span class="n">row_id</span><span class="o">=</span><span class="s1">&#39;hbase_row_id&#39;</span><span class="p">;</span>
</pre><pre class="fixed"><span class="o">#</span>  <span class="n">Range</span> <span class="k">select</span><span class="p">:</span>
<span class="o">#</span>   <span class="p">(</span><span class="n">the</span> <span class="n">example</span> <span class="n">uses</span> <span class="k">BETWEEN</span> <span class="n">but</span> <span class="n">we</span> <span class="n">will</span> <span class="n">support</span> <span class="n">arbitrary</span> <span class="n">predicates</span><span class="p">)</span>
<span class="k">SELECT</span> <span class="n">COLUMN_GET</span><span class="p">(</span><span class="n">hbase_tbl</span><span class="p">.</span><span class="n">columns</span><span class="p">,</span> <span class="s1">&#39;column_name&#39;</span> <span class="k">AS</span> <span class="nb">INTEGER</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">hbase_tbl</span>
<span class="k">WHERE</span> 
  <span class="n">row_id</span> <span class="k">BETWEEN</span> <span class="s1">&#39;hbase_row_id1&#39;</span> <span class="k">AND</span> <span class="s1">&#39;hbase_row_id2&#39;</span><span class="p">;</span>
</pre><pre class="fixed"><span class="o">#</span> <span class="k">Update</span> <span class="k">or</span> <span class="k">add</span> <span class="n">a</span> <span class="k">column</span> <span class="k">for</span> <span class="n">a</span> <span class="k">row</span>
<span class="k">UPDATE</span> <span class="n">hbase_tbl</span> <span class="k">SET</span> <span class="n">columns</span><span class="o">=</span><span class="n">COLUMN_ADD</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="s1">&#39;column_name&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span> <span class="k">WHERE</span> <span class="n">row_id</span><span class="o">=</span><span class="s1">&#39;hbase_row_id1&#39;</span><span class="p">;</span>
</pre><p>Use of COLUMN_ADD like above will make no check whether column_name=X already
existed for that row. If it did, it will be silently overwritten.</p>
<p>ATTENTION: There seems to be no easy way to do something that would be like
SQL's INSERT statement, i.e. which would fail if the data you're changing
already exists.</p>
<p>One can write a convoluted IF(..., ....) expression will do the
store-if-not-exist operation, but it's bad when basic operations require
convoluted expressions.</p>
<p>ATTENTION: One could also question whether a statement with semantics of 
"store this data irrespectively of what was there before" has any value for
"remote" storage engine, where you're not the only one who's modifying the
data.</p>
<pre class="fixed"><span class="o">#</span> <span class="k">Set</span> <span class="k">all</span> <span class="n">columns</span> <span class="k">at</span> <span class="n">once</span><span class="p">,</span> <span class="n">overwriting</span> <span class="n">the</span> <span class="n">content</span> <span class="n">that</span> <span class="n">was</span> <span class="n">there</span>
<span class="k">UPDATE</span> <span class="n">hbase_tbl</span> <span class="k">SET</span> <span class="n">columns</span><span class="o">=</span><span class="p">...</span> <span class="k">WHERE</span> <span class="n">row_id</span><span class="o">=</span><span class="s1">&#39;hbase_row_id1&#39;</span><span class="p">;</span>

<span class="k">UPDATE</span> <span class="n">hbase_tbl</span> <span class="k">SET</span> <span class="n">columns</span><span class="o">=</span><span class="n">COLUMN_CREATE</span><span class="p">(</span><span class="s1">&#39;column1&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">)</span> <span class="k">WHERE</span> <span class="n">row_id</span><span class="o">=</span><span class="s1">&#39;row1&#39;</span><span class="p">;</span>
</pre><p>Note that the lsat statement will cause all columns except for 'column1' to be
deleted for row 'row1'. This seems logical for SQL but there is no such
operation in HBase.</p>
<pre class="fixed"><span class="o">#</span> <span class="k">Insert</span> <span class="n">a</span> <span class="k">new</span> <span class="k">row</span> <span class="k">with</span> <span class="k">column</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">hbase_tbl</span> <span class="p">(</span><span class="n">row_id</span><span class="p">,</span> <span class="n">columns</span><span class="p">)</span> <span class="k">VALUES</span>
  <span class="p">(</span><span class="s1">&#39;hbase_row_id&#39;</span><span class="p">,</span> <span class="n">COLUMN_CREATE</span><span class="p">(</span><span class="s1">&#39;column_name&#39;</span><span class="p">,</span> <span class="s1">&#39;column-value&#39;</span><span class="p">));</span>
</pre><p>Q: It's not clear how to access versioned data? Can we go without versioned 
   data for the first milestone? 
   (and then, use @@hbase_timestamp for the second milestone?)</p>
<p>Q: It's not clear how to select "all columns from column family X".</p>
<h3 class="anchored_heading" id="34-efficient-execution-for-per-row-mapping">3.4 Efficient execution for per-row mapping</h3>
<h4 class="anchored_heading" id="341-predicate-analysis">3.4.1 Predicate analysis</h4>
<p>The table declares:</p>
<pre class="fixed">  row_id BINARY(MAX_HBASE_ROWID_LEN),
  ...
  PRIMARY KEY (row_id)
</pre><p>which allows to use range/ref optimizer to extract ranges over the row_id
column. </p>
<p>One can also imagine a realistic query which uses conditions on hbase column
names:</p>
<pre class="fixed"><span class="k">SELECT</span> <span class="n">column_get</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="s1">&#39;some_data&#39;</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">hbase_tbl</span> 
<span class="k">WHERE</span> 
  <span class="n">row_id</span> <span class="k">BETWEEN</span> <span class="s1">&#39;first_interesting_row&#39;</span> <span class="k">and</span> <span class="s1">&#39;last_interesting_row&#39;</span> <span class="k">AND</span> 
  <span class="n">column_get</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="s1">&#39;attribute&#39;</span> <span class="k">as</span> <span class="n">string</span><span class="p">)</span><span class="o">=</span><span class="s1">&#39;eligible&#39;</span><span class="p">;</span>
</pre><p>Range optimizer is unable to catch conditions in form of</p>
<pre class="fixed"><span class="n">column_get</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="s1">&#39;attribute&#39;</span> <span class="k">as</span> <span class="n">string</span><span class="p">)</span><span class="o">=</span><span class="s1">&#39;eligible&#39;</span>
</pre><p>We'll need to either extend it, or create another condition analyzer.</p>
<h4 class="anchored_heading" id="342-dynamic-columns-optimizations">3.4.2 Dynamic columns optimizations</h4>
<p>Currently, MariaDB works with Dynamic Columns with this scenario:</p>
<ol start="1"><li>When the record is read, the entire blob (=all columns) is read into memory
</li><li>The query operates on the blob with Dynamic Columns Functions (reads and updates values for some columns, etc)
</li><li>[If this is an UPDATE] the entire blob is written back to the table
</li></ol>
<p>If we use this approach with HBase, we will cause a lot of overhead with
reading/writing of unneeded data.</p>
<h4 class="anchored_heading" id="solution-1-on-demand-reads">Solution #1: on-demand reads</h4>
<ul start="1"><li>When table record is read, don't read any columns, return a blob handle.
</li><li>Dynamic Column functions will use the handle to read particular columns. The column is read from HBase only when its value is requested.
</li></ul>
<p>This scheme ensures there are no redundant data reads, at the cost making extra mysqld&lt;-&gt;HBase roundtrips (which are likely to be expensive)</p>
<h4 class="anchored_heading" id="solution-2-list-of-reads">Solution #2: List of reads</h4>
<ul start="1"><li>Walk through the query and find all references to hbase_table.columns.
</li><li>Collect the names of columns that are read, and retrieve only these columns.
</li></ul>
<p>This may cause redundant data reads, for example for</p>
<pre class="fixed">  <span class="k">SELECT</span> <span class="n">COLUMN_GET</span><span class="p">(</span><span class="n">hbase_tbl</span><span class="p">,</span> <span class="s1">&#39;column1&#39;</span> <span class="k">AS</span> <span class="nb">INTEGER</span><span class="p">)</span> 
  <span class="k">FROM</span> <span class="n">hbase_tbl</span>
  <span class="k">WHERE</span> 
    <span class="n">row_id</span> <span class="k">BETWEEN</span> <span class="s1">&#39;hbase_row_id1&#39;</span> <span class="k">AND</span> <span class="s1">&#39;hbase_row_id2&#39;</span> <span class="k">AND</span> 
    <span class="n">COLUMN_GET</span><span class="p">(</span><span class="n">hbase_tbl</span><span class="p">,</span> <span class="s1">&#39;column2&#39;</span> <span class="k">AS</span> <span class="nb">INTEGER</span><span class="p">)</span><span class="o">=</span><span class="mi">1</span>
</pre><p>column1 will be read for rows which have column2!=1. This still seems to 
be better than making extra roundtrips.</p>
<p>There is a question of what should be done when the query has references like</p>
<pre class="fixed">  COLUMN_GET(hbase_tbl, {non-const-item} AS ...) 
</pre><p>where it is not possible to tell in advance which columns must be read. Possible approaches are</p>
<ul start="1"><li>retrieve all columns
</li><li>fetch columns on demand
</li><li>stop the query with an error.
</li></ul>
<h3 class="anchored_heading" id="35-mapping-of-sql-statements">3.5 Mapping of SQL statements</h3>
<h4 class="anchored_heading" id="select">SELECT</h4>
<p>See above sections: we'll be able to analyze condition on row_id, and a list of columns we need to read. That will give sufficient info to do either an HTable.get() call, or call HTable.getScanner() and use the scanner.</p>
<h4 class="anchored_heading" id="insert">INSERT</h4>
<p>INSERT should make sure it actually creates the row, it should not overwrite existing rows. This is not trivial in HBase.  The closest we can get is to make a number of 
HTable.checkAndPut() calls, with the checks that we're not overwriting the data.</p>
<p>This will cause INSERT ('row_id', COLUMN_CREATE('column1', 'data')) to succeed even if the table already had a row with  ('row_id', COLUMN_CREATE('column2', 'data')).</p>
<p>Another possible problem is that INSERT can fail mid-way (we will insert only some columns of the record).</p>
<h4 class="anchored_heading" id="delete">DELETE</h4>
<p>DELETE seems to be ok: we can delete all {rowid, column_name} combinations for the given row_id.  I'm not sure, perhaps this will require multiple HBase calls.</p>
<h4 class="anchored_heading" id="update">UPDATE</h4>
<p>Just like with per-cell mapping, UPDATEs that change the row_id are actually deletions followed by inserts. We can disallow them in the first milestone.</p>
<p>The most frequent form of UPDATE is expected to be one that changes the value of a column:</p>
<pre class="fixed"><span class="k">UPDATE</span> <span class="n">hbase_tbl</span> <span class="k">SET</span> <span class="n">columns</span><span class="o">=</span><span class="n">COLUMN_ADD</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="s1">&#39;column_name&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span> 
<span class="k">WHERE</span> 
  <span class="n">row_id</span><span class="o">=</span><span class="s1">&#39;hbase_row_id1&#39;</span> <span class="k">AND</span> <span class="n">COLUMN_GET</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="s1">&#39;column_name&#39;</span><span class="p">)</span><span class="o">=</span><span class="s1">&#39;foo&#39;</span><span class="p">;</span>
</pre><p>For that one, we need modified Dynamic Column Functions that will represent *changes* in the set of columns (and not *state*),  so that we can avoid reading columns and writing them back.</p>
<h2 class="anchored_heading" id="4-select-columns-mapping">4. Select-columns mapping</h2>
<p>This is a simplification of the per-row mapping. Suppose, the user is only interested in particular columns with names  `column1` and `column2`.  They create a table with this definition:</p>
<pre class="fixed"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">hbase_tbl_cells</span> <span class="p">(</span>
  <span class="n">row_id</span> <span class="nb">binary</span><span class="p">(</span><span class="n">MAX_HBASE_ROWID_LEN</span><span class="p">),</span>
  <span class="n">column1</span>  <span class="k">TYPE</span><span class="p">,</span>
  <span class="n">column2</span>  <span class="k">TYPE</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">row_id</span><span class="p">),</span>
  <span class="k">KEY</span><span class="p">(</span><span class="n">column1</span><span class="p">),</span>
  <span class="k">KEY</span><span class="p">(</span><span class="n">column2</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">hbase_columns</span><span class="p">;</span>
</pre><p>and then access it. Access is done like in per-row mapping, but without use of dynamic columns.  </p>
<p>This mapping imposes lots of restrictions: it is only possible to select a fixed set of columns, there is no way to specify version of the data, etc.</p>
<h2 class="anchored_heading" id="5-comparison-of-the-mappings">5. Comparison of the mappings</h2>
<p>If we select two columns from a certain row, per-cell mapping produces
"vertical" result, while per-row mapping produces "horizontal" result.</p>
<pre class="fixed"><span class="o">#</span> <span class="n">Per</span><span class="o">-</span><span class="n">cell</span><span class="p">:</span>
<span class="k">SELECT</span> <span class="k">column_name</span><span class="p">,</span> <span class="n">value</span> 
<span class="k">FROM</span> <span class="n">hbase_cell</span>
<span class="k">WHERE</span> 
  <span class="n">row_id</span><span class="o">=</span><span class="s1">&#39;hbase_row_id1&#39;</span> <span class="k">AND</span> 
  <span class="n">column_family</span><span class="o">=</span><span class="s1">&#39;col_fam&#39;</span> <span class="k">AND</span> <span class="k">column_name</span> <span class="k">IN</span> <span class="p">(</span><span class="s1">&#39;column1&#39;</span><span class="p">,</span><span class="s1">&#39;column2&#39;</span><span class="p">)</span>
<span class="o">+</span><span class="c1">-------------+-------+</span>
<span class="o">|</span> <span class="k">column_name</span> <span class="o">|</span> <span class="n">value</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">-------------+-------+</span>
<span class="o">|</span> <span class="n">column1</span>     <span class="o">|</span> <span class="n">val1</span>  <span class="o">|</span>
<span class="o">|</span> <span class="n">column2</span>     <span class="o">|</span> <span class="n">val2</span>  <span class="o">|</span>
<span class="o">+</span><span class="c1">-------------+-------+</span>
</pre><pre class="fixed"><span class="o">#</span> <span class="n">Per</span> <span class="k">row</span><span class="p">:</span>
<span class="k">SELECT</span> 
  <span class="n">COLUMN_GET</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="s1">&#39;col_fam:column1&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">column1</span><span class="p">,</span>  
  <span class="n">COLUMN_GET</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="s1">&#39;col_fam:column2&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">column2</span><span class="p">,</span>
<span class="k">FROM</span> <span class="n">hbase_row</span>
<span class="k">WHERE</span> 
  <span class="n">row_id</span><span class="o">=</span><span class="s1">&#39;hbase_row_id1&#39;</span> 
<span class="o">+</span><span class="c1">---------+---------+</span>
<span class="o">|</span> <span class="n">column1</span> <span class="o">|</span> <span class="n">column2</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">---------+---------+</span>
<span class="o">|</span> <span class="n">val1</span>    <span class="o">|</span> <span class="n">val2</span>    <span class="o">|</span>
<span class="o">+</span><span class="c1">---------+---------+</span>
</pre><p>Per-cell mapping:</p>
<ul start="1"><li>Allows a finer control over selection of versioned data (easy to specify
  [range of] versions to select), column families, etc.
</li><li>Is more suitable for cases when one needs to select an arbitrarily-long list
  of columns. 
</li></ul>
<p>Per-row (or select-columns) mapping is easier when:</p>
<ul start="1"><li>one is accessing a limited set of columns
</li><li>one needs to access multiple columns from multiple rows (in per-cell mapping
  this will require an [inefficient?] self-join).
</li></ul>
<h2 class="anchored_heading" id="6-interfacing-with-hbase">6. Interfacing with HBase</h2>
<p>HBase is in Java, and its native client API is a java library.  We need to
interface with it from C++ storage engine code. Possible options are:</p>
<h3 class="anchored_heading" id="61-use-thrift">6.1 Use Thrift</h3>
<p>This requires HBase installation to run a Thrift server</p>
<h3 class="anchored_heading" id="62-re-implement-hbases-network-protocol">6.2 Re-implement HBase's network protocol</h3>
<ul start="1"><li>It seems to be a custom-made RPC protocol.
</li><li>There is an independent re-implementation here: <a href="https://github.com/stumbleupon/asynchbase">https://github.com/stumbleupon/asynchbase</a>. It is 10K lines of Java code, which gives an idea about HBase's protocol complexity
<ul start="1"><li>It seems to support only a subset of features? I.e. I was unable to find mention of pushed down conditions support?
</li><li>Look in <code>HBaseRpc.java</code> for <code>"Unofficial Hadoop / HBase RPC protocol documentation"</code>
</li></ul>
</li></ul>
<h3 class="anchored_heading" id="63-use-jnihbase-client-protocol">6.3 Use JNI+HBase client protocol</h3>
<ul start="1"><li>not sure how complex this is
</li><li>Mark has mentioned this has an unacceptable overhead?
</li></ul>
<h2 class="anchored_heading" id="7-consistency-transactions-etc">7. Consistency, transactions, etc</h2>
<ul start="1"><li>HBase has single-record transactions. Does this mean that HBase storage
  engine will have MyISAM-like characteristics? e.g. if we fail in the
  middle of a multi-row UPDATE, there is no way to go back.
</li></ul>
<ul start="1"><li>Q: Are the writes important at all? (e.g. if we've had the first version with
  provide read-only access, would that be useful?) 
  A: Yes?
</li></ul>
<h2 class="anchored_heading" id="8-batching">8. Batching</h2>
<p>Q: will we need joins, i.e. do I need to implement Multi-Range-Read and
support Batched Key Access right away?</p>
<h2 class="anchored_heading" id="9-results-of-discussion-with-monty">9. Results of discussion with Monty</h2>
<ul start="1"><li>Per-row mapping seems to be much more useful than per-cell mapping, because a lot of users have queries that retrieve lots of columns for lots of rows (is this so?)
</li><li>Dynamic column format will support string column names (see <a href="https://jira.mariadb.org/browse/MDEV-377">MDEV-377</a>)
</li><li>For the first milestone, forget about dynamic column concerns mentioned in "Efficient execution for per-row mapping".  It is sufficient that all columns are returned as one blob that physically contains all columns.
</li></ul>

    </div>


        
            <div id="subscribe" class="well well-small hide hidden-print"
                 data-subscribe-url="/kb/en/hbase-storage-engine/+subscriptions/add"
                 data-unsubscribe-url="/kb/en/hbase-storage-engine/+subscriptions/remove">
            </div>
        

        
        
    
        <div class="simple_section_nav">
            <ul class="nav nav-pills">
                
                    <li><a href="/kb/en/explain-formatjson-in-mysql/">
                        ← EXPLAIN FORMAT=JSON in MySQL
                    </a>
                    </li>
                
                
                    <li><a href="/kb/en/outdated-pages/">
                        ↑ Outdated pages ↑
                    </a>
                    </li>
                
                
                    <li class="pull-right"><a href="/kb/en/leveldb/">
                        LevelDB Storage Engine →
                    </a>
                    </li>
                
            </ul>
        </div>
    

        

        
        <h2>Comments</h2>
        
    
    <div id="comments" data-node-id="2764" data-comments-url="/kb/en/hbase-storage-engine/+comments"
         data-reply-url="/kb/en/hbase-storage-engine/comments/post/">
        Comments loading...
    </div>

        

    </div>


                    <div id="content_disclaimer" class="graybox">
                        Content reproduced on this site is the property of its respective owners,
                        and this content is not reviewed in advance by MariaDB. The views, information and opinions
                        expressed by this content do not necessarily represent those of MariaDB or any other party.
                    </div>
                </div>
            </section>

            
                <div id="right_bar" class="col-md-2">
                    
    
        
        <ul class="section_navigation well well-small hidden-xs hidden-sm">
            
                <li class="parent"><a href="/kb/en/outdated-pages/">
                    ↑ Outdated pages ↑
                </a>
                </li>
            
            
                
                    <li>
                        <a href="/kb/en/dbt3-benchmark-queries/">
                            
                            DBT3 Benchmark Queries
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/explain-format-json-differences/">
                            
                            EXPLAIN FORMAT=JSON Differences From MySQL
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/explain-formatjson-in-mysql/">
                            
                            EXPLAIN FORMAT=JSON in MySQL
                        </a>
                    </li>
                
            
                
                    <li class="active">
                        <span>HBase Storage Engine</span>
                        
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/leveldb/">
                            
                            LevelDB Storage Engine
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/leveldb-storage-engine-development/">
                            
                            LevelDB Storage Engine Development
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/leveldb-storage-engine-ms1/">
                            
                            LevelDB Storage Engine MS1
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/leveldb-storage-engine-ms2/">
                            
                            LevelDB Storage Engine MS2
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/stuff-in-mysql-56/">
                            
                            Stuff in MySQL 5.6
                        </a>
                    </li>
                
            
        </ul>
    
    

                </div>
            
        </div>
    </div>
</div>

<!-- Footer -->
<footer id="footer">
    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-xs-12">
                    <ul class="list-inline text-center footer-nav">
                        <li>
                            <h5>
                                <a href="https://mariadb.com/products" title="Products">Products</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/services" title="Services">Services</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/pricing" title="Pricing">Pricing</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/resources" title="Resources">Resources</a>
                            </h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/about-us" title="About MariaDB">About Us</a></h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/download" title="Download">Download MariaDB</a></h5>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="row row-10">
                
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div id="block-footerformcontact" class="block block-block-content block-block-contentd754ee1b-3cc9-40e7-9ef4-f504f1197fb1">
                        
                            <h5 style="font-weight: 400;">Subscribe to our newsletter!</h5>
                            <script src="//app-sj15.marketo.com/js/forms2/js/forms2.min.js"></script><form id="mktoForm_1498"></form>
                            <script>
                                <!--//--><![CDATA[// ><!--
                                MktoForms2.loadForm("//app-sj15.marketo.com", "573-PXI-984", 1498);
                                //--><!]]]]><![CDATA[>
                                //--><!]]>
                            </script>
                        
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div class="footer-copyright">
                        <div class="text-center">
                            <ul class="list-inline no-margin">
                                <li>
                                    <a href="/legal" title="Legal">Legal</a>
                                </li>
                                <li>
                                    <a href="/privacy-policy" title="Privacy Policy">Privacy Policy</a>
                                </li>
                                <li>
                                    <a href="/cookie-policy/" title="Cookies">Cookie Policy</a>
                                </li>
                            </ul>
                            <p>Copyright &copy; 2024 MariaDB. All rights reserved.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</footer>
</div>

<div id="ajax_loading">
    <img src="/kb/static/images/ajax-loader.a51c5608d01a.gif" />
</div>

    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MK2847"
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MK2847');</script>
    <!-- End Google Tag Manager -->

</body>

<script type="text/javascript" src="/kb/static/js/main.1587e3a666fc.js" charset="utf-8"></script>

</html>