<!DOCTYPE html>
<html>
<head data-cookie-domain=""
      data-cookie-path="/">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="apple-touch-icon" sizes="180x180" href="/kb/static/images/favicons/apple-touch-icon.159e713979be.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/kb/static/images/favicons/favicon-32x32.bc0ac1d5d11e.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/kb/static/images/favicons/favicon-16x16.5801f8f0f34e.png">
    <link rel="shortcut icon" href="/kb/static/images/favicons/favicon.d122d305dee4.ico" type="image/x-icon" />

    <title>The Optimizer Cost Model from MariaDB 11.0 - MariaDB Knowledge Base</title>

    <link href="/kb/static/css/main.f7633538c846.css" rel="stylesheet" type="text/css" />

    

    

    <!-- FB Open Graph tags -->
    <meta property="og:title" content="The Optimizer Cost Model from MariaDB 11.0" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://mariadb.com/kb/en/the-optimizer-cost-model-from-mariadb-11-0/" />
    <meta property="og:image" content="http://mariadb.comaskmonty-logo.png" />
    <meta property="og:site_name" content="MariaDB KnowledgeBase" />
    <meta property="fb:admins" content="514852603" />
    <meta property="og:description" content="The optimizer cost model in MariaDB 11.0." />

    <meta name="description" content="The optimizer cost model in MariaDB 11.0." />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet"/>
    
</head>
<body class="mpkb nodes products nodes_view jqui" id="nodes_view">





<div id="menu-mobile" class="visible-sm visible-xs">

    <div>
        <div id="mobile-close-menu" class="text-right">
            <a href="javascript:void(0)" title="Close Menu" id="back-main" class="toggle-menu">X<span></span></a>
        </div>
    </div>
    <div class="mainmenu-mobile">
        <ul class="ls-none ul-menu">
            <li data-sub="submenu5"><a class="open-form-search" href="/kb/search/" title="Search">Search </a></li>
            <li data-sub="submenu0"><a href="/products" title="Products">Products</a><span class="arrow-main"></span></li>
            <li data-sub="submenu1"><a href="/services" title="Services">Services</a><span class="arrow-main"></span></li>
            <li data-sub="submenu2"><a href="/resources" title="Resources">Resources</a><span class="arrow-main"></span></li>
            <li data-sub="submenu3"><a href="/about-us" title="About">About</a><span class="arrow-main"></span></li>
            <li data-sub="submenu4"><a href="/contact" title="Contact">Contact</a></li>
        </ul>
    </div>

    <div class="nav-top-mobile">
        <div class="select-box form">

            <ul class="inline-block-md mb-none top-nav">
                <li>

                </li>
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/the-optimizer-cost-model-from-mariadb-11-0/"> Login</a>
                    </li>
                
            </ul>



        </div>
        <p class="text-center copyright">Copyright &copy; 2024 MariaDB. All rights reserved.</p>
    </div>
</div>
<div class="violator-wrap d-none" id="top_violator">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12">
                <div class="violator-outer">
                    <div class="violator-inner">
                        <div class="row">
                            <div class="col-xs-12 col-sm-9 col-lg-7 col-lg-offset-2" id="top_violator_content">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="content-link" target="_blank" rel="nofollow noreferrer">
                                    <span>The Ultimate Guide to High Availability with MariaDB</span>
                                </a>
                            </div>
                            <div class="col-xs-12 col-sm-3" id="top_violator_cta">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="btn btn-mariadb" target="_blank" rel="nofollow noreferrer">Download Now</a>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-link close-btn">
                        <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24" width="15px" height="15px"><path d="M 4.9902344 3.9902344 A 1.0001 1.0001 0 0 0 4.2929688 5.7070312 L 10.585938 12 L 4.2929688 18.292969 A 1.0001 1.0001 0 1 0 5.7070312 19.707031 L 12 13.414062 L 18.292969 19.707031 A 1.0001 1.0001 0 1 0 19.707031 18.292969 L 13.414062 12 L 19.707031 5.7070312 A 1.0001 1.0001 0 0 0 18.980469 3.9902344 A 1.0001 1.0001 0 0 0 18.292969 4.2929688 L 12 10.585938 L 5.7070312 4.2929688 A 1.0001 1.0001 0 0 0 4.9902344 3.9902344 z"/></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="wrapper">
<div id="top-nav">
    <div class="container">
        <ul class="hidden-sm hidden-xs" >
            <li><a href="https://mariadb.com/kb/">Knowledge Base</a></li>
            <li><a href="https://mariadb.com/contact/">Contact</a></li>
            
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/the-optimizer-cost-model-from-mariadb-11-0/" rel="nofollow">Login</a>
                    </li>
                
            
            
            <li id="search-form">
                <form action="/kb/en/+search/" method="get" id="search-block-form" accept-charset="UTF-8">
                    <input id="search" title="Enter the terms you wish to search for."
                           placeholder="Search . . ." type="text"
                           name="q" value="" size="15" maxlength="128" class="form-text"
                           data-autocomplete-url="/kb/en/+search/autocomplete/">
                    <input type="hidden" name="quick" value="1" />
                    <input type="hidden" name="source" value="kb" />
                </form>
            </li>
            <li><a id="search-toggler" href="/kb/search/">Search</a></li>
            
        </ul>
    </div>
</div>
<div id="navbar-bottom" class="navbar">
    <div class="container">
        
        
        
        
        <div class="row">
            <div class="col-md-3 col-sm-9 col-xs-9">
                <a class="brand" href="/" title="MariaDB">
                    <img src="/kb/static/images/logo-2018-black.95f5978ae14d.png">
                </a>
            </div>
            <div class="col-md-9 hidden-sm hidden-xs">
                <div class="main-menu">
                    <ul id="main-menu" class="nav navbar-nav inline-block-sm">
    <li class="has-sub full-menu">
        <a href="/products" title="Products">Products</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/services" title="Services">Services</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/pricing" title="Pricing">Pricing</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/resources" title="Resources">Resources</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/about-us" title="About Us">About Us</a>
    </li>
    <li class="">
        <a class="button electric-eel small top-bar-right-download" href="/downloads/">Download</a>
    </li>
</ul>
                </div>
            </div>
            <div class="col-md-3 visible-sm visible-xs col-sm-3 col-xs-3 ps-rv">
                <div class="navbar-header text-right pull-right">
                    <button type="button" class="menu-control toggle-menu" id="open-menu">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="main">
    <div class="container">
        

        <div id="subheader1" class="clearfix">
            <div class="pull-left">
                
                <div id="breadcrumbs" class="breadcrumb">
                    <a href="/kb/en/">Knowledge Base</a>
                    


    
    » <a class="crumb" href="/kb/en/training-tutorials/">Training &amp; Tutorials</a>
    

    
    » <a class="crumb" href="/kb/en/advanced-mariadb-articles/">Advanced MariaDB Articles</a>
    

    
    » <a class="crumb" href="/kb/en/development-articles/">Development Articles</a>
    

    
    » <a class="crumb" href="/kb/en/mariadb-internals-documentation/">MariaDB Internals Documentation</a>
    

    
    » <a class="crumb" href="/kb/en/mariadb-internals-documentation-query-optimizer/">Query Optimizer</a>
    


    » <a class="node_link crumb" href="/kb/en/the-optimizer-cost-model-from-mariadb-11-0/">The Optimizer Cost Model from MariaDB 11.0</a>


                </div>
                
            </div>
        </div>
    </div>
    <div class="container" id="container-main">
        <div class="row">
            
            
                
                <aside id="sidebar-first" class="sidebar col-md-2 hidden-xs hidden-sm hidden-print">
                    
                        
                        <ul id="category_menu" class="nav nav-pills nav-stacked">
                            <li><a href="/kb/en/">Home</a></li>
                            
                                
                                    <li><a href="/kb/en/+questions/">Open Questions</a></li>
                                
                                <li><a href="/kb/en/documentation/">MariaDB Server</a></li>
                                <li><a href="/kb/en/maxscale/">MariaDB MaxScale</a></li>
                                <li><a href="/kb/en/mariadb-columnstore/">MariaDB ColumnStore</a></li>
                                <li><a href="/kb/en/connectors/">Connectors</a></li>
                            

                        </ul>
                    

                    
<div>



<div class="well well-small box actions"><div>

        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/the-optimizer-cost-model-from-mariadb-11-0/+history" rel="nofollow">History</a>
        
        
        
        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/the-optimizer-cost-model-from-mariadb-11-0/+source/">Source</a>
        
        <a class="btn btn-block btn-blue btn-sm flag" href="/kb/en/the-optimizer-cost-model-from-mariadb-11-0/+flag"
                data-flag-url="/kb/en/the-optimizer-cost-model-from-mariadb-11-0/+flag" rel="nofollow">
                Flag as Spam / Inappropriate</a>
        
        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/the-optimizer-cost-model-from-mariadb-11-0/+translate/">
                Translate</a>
        

</div>
</div>





<div class="well well-small box node_info"><div>

    <dl>
        <dt>Created</dt>
        <dd>

<span class="datetime" title="2022-12-21 17:24">1 year, 7 months ago</span></dd>

        <dt>Modified</dt>
        <dd>

<span class="datetime" title="2022-12-29 14:06">1 year, 7 months ago</span></dd>

        <dt>Type</dt>
        <dd>article</dd>

        <dt>Status</dt>
        <dd>active</dd>

        <dt>License</dt>
        <dd>
            
                <a href="/kb/en/the-optimizer-cost-model-from-mariadb-11-0/+license/">CC BY-SA / Gnu FDL</a>
            
        </dd>

        
    </dl>

    
    <ul class="rss_feeds">
        <li><a href="/kb/en/the-optimizer-cost-model-from-mariadb-11-0/+history/feed/">
            History</a>
        </li>
        <li><a href="/kb/en/the-optimizer-cost-model-from-mariadb-11-0/+comments/feed/">
            Comments</a>
        </li>
    </ul>
    

</div>
</div>





    
    
    

<div class="well well-small box attachments"><div><div class="edit_link pull-right"><a href="/kb/en/the-optimizer-cost-model-from-mariadb-11-0/+edit/attachments/">Edit</a></div><h5>Attachments</h5></div><div>

        
            <div class="no_data">No attachments exist</div>
        
    
</div>
</div>

    



    
    






</div>


                    

































                </aside>
            
            
            
                
            
            
                
            
            <section id="content" class="limited_width col-md-8 clearfix">
                
                    <h1>The Optimizer Cost Model from MariaDB 11.0</h1>
                

                



                <div>
                    
    

    
    
    

    <div class="node creole">
        
        
        


    
    <div class="answer formatted">
        <div class="table_of_contents well well-small">
<h3>Contents</h3>
 <ol class="toc">

    <li class=""><a href="#background" title="Background">Background</a></li>

    <li class=""><a href="#new-cost-model" title="New Cost Model">New Cost Model</a></li>

    <li class=""><a href="#description-of-the-different-cost-variables" title="Description of the Different Cost Variables">Description of the Different Cost Variables</a></li>

    <li class=""><a href="#other-optimizer-cost-changes" title="Other Optimizer Cost Changes">Other Optimizer Cost Changes</a></li>

    <li class=""><a href="#other-notable-plan-changes" title="Other Notable Plan Changes">Other Notable Plan Changes</a></li>

    <li class=""><a href="#when-the-optimizer-changes-matter" title="When the Optimizer Changes Matter">When the Optimizer Changes Matter</a></li>

    <li class=""><a href="#changing-costs" title="Changing Costs">Changing Costs</a>    <ol class="toc">

        <li class=""><a href="#in-configuration-files-and-command-line" title="In Configuration Files (and Command Line)">In Configuration Files (and Command Line)</a></li>

        <li class=""><a href="#from-sql" title="From SQL">From SQL</a></li>

        <li class=""><a href="#examples-of-changing-costs" title="Examples of Changing Costs">Examples of Changing Costs</a>    </ol>
</li>

    <li class=""><a href="#for-storage-engine-developers" title="For Storage Engine Developers">For Storage Engine Developers</a> </ol>
</li>
</div>
<h2 class="anchored_heading" id="background">Background</h2>
<p>Before <a href="/kb/en/what-is-mariadb-110/">MariaDB 11.0</a>, the MariaDB Query optimizer used a 'basic cost' of 1 for:</p>
<ul start="1"><li>One disk access
</li><li>Fetching a key
</li><li>Fetching a row based on the rowid (= unique row identifier) from the key
</li></ul>
<p>There were some smaller costs:</p>
<ul start="1"><li>filter lookup: 0.01
</li><li>Examining a where clause: 0.20
</li><li>Comparing two keys: 0.05
</li><li>Fetching a row through an index from a temporary memory table: 0.05
</li></ul>
<p>The above costs are reasonable for finding out the best index to use.
However, they where not good for finding out if we should use a table scan,
index scan or range lookup. The cost for the different engines were
not properly calibrated.</p>
<h2 class="anchored_heading" id="new-cost-model">New Cost Model</h2>
<p>In <a href="/kb/en/what-is-mariadb-110/">MariaDB 11.0</a> we have fixed the above shortcomings by changing the
basic cost for 'storage engine operations' to be 1 millisecond. This
means that for most queries the query cost (<code>LAST_QUERY_COST</code>) should be
close (or at least proportional) to the time the server is spending in
the storage engine + join_cache + sorting.</p>
<p>Note that the user level costs are in <strong>microseconds</strong> (as milliseconds
would have so many zero's that it makes it hard to compare values).</p>
<p>The engine costs have also been separated into smaller parts to make things more
accurate.</p>
<p>The "disk"-read cost now assumes a mid level SSD disk with 400MB/second. This can be changed by the end user by modifying <code>OPTIMIZER_DISK_READ_COST</code>.</p>
<p>All engine specific costs are visible in
<code>information_schema.optimizer_costs</code>.</p>
<p>For example:</p>
<p>The "default" cost for an engine can be found with:</p>
<pre class="fixed"> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">optimizer_costs</span> <span class="k">where</span> <span class="n">engine</span><span class="o">=</span><span class="ss">&quot;default&quot;</span><span class="err">\</span><span class="k">G</span>
<span class="o">***************************</span> <span class="mi">1</span><span class="p">.</span> <span class="k">row</span> <span class="o">***************************</span>
                         <span class="n">ENGINE</span><span class="p">:</span> <span class="k">default</span>
       <span class="n">OPTIMIZER_DISK_READ_COST</span><span class="p">:</span> <span class="mi">10</span><span class="p">.</span><span class="mi">240000</span>
<span class="n">OPTIMIZER_INDEX_BLOCK_COPY_COST</span><span class="p">:</span> <span class="mi">0</span><span class="p">.</span><span class="mi">035600</span>
     <span class="n">OPTIMIZER_KEY_COMPARE_COST</span><span class="p">:</span> <span class="mi">0</span><span class="p">.</span><span class="mi">011361</span>
        <span class="n">OPTIMIZER_KEY_COPY_COST</span><span class="p">:</span> <span class="mi">0</span><span class="p">.</span><span class="mi">015685</span>
      <span class="n">OPTIMIZER_KEY_LOOKUP_COST</span><span class="p">:</span> <span class="mi">0</span><span class="p">.</span><span class="mi">435777</span>
   <span class="n">OPTIMIZER_KEY_NEXT_FIND_COST</span><span class="p">:</span> <span class="mi">0</span><span class="p">.</span><span class="mi">082347</span>
      <span class="n">OPTIMIZER_DISK_READ_RATIO</span><span class="p">:</span> <span class="mi">0</span><span class="p">.</span><span class="mi">020000</span>
        <span class="n">OPTIMIZER_ROW_COPY_COST</span><span class="p">:</span> <span class="mi">0</span><span class="p">.</span><span class="mi">060866</span>
      <span class="n">OPTIMIZER_ROW_LOOKUP_COST</span><span class="p">:</span> <span class="mi">0</span><span class="p">.</span><span class="mi">130839</span>
   <span class="n">OPTIMIZER_ROW_NEXT_FIND_COST</span><span class="p">:</span> <span class="mi">0</span><span class="p">.</span><span class="mi">045916</span>
   <span class="n">OPTIMIZER_ROWID_COMPARE_COST</span><span class="p">:</span> <span class="mi">0</span><span class="p">.</span><span class="mi">002653</span>
      <span class="n">OPTIMIZER_ROWID_COPY_COST</span><span class="p">:</span> <span class="mi">0</span><span class="p">.</span><span class="mi">002653</span>
</pre><p>The above costs are the default (base) for all engines and should be reasonable for engines that does not have a clustered index (like <a href="/kb/en/myisam/">MyISAM</a>, <a href="/kb/en/aria/">Aria</a> etc).  The default costs can be changed by specifying just the cost as an argument, like <code>mariadbd --optimizer-disk-read-cost=20</code> or from SQL: <code>set global optimizer_disk_read_cost=20</code>. An engine specific cost can be tuned by prefixing the cost with the engine name, like <code>set global innodb.optimizer_disk_read_cost=20</code>. </p>
<p>An engine can tune some or all of the above cost in the storage engine interface.
Here follows the cost for the <a href="/kb/en/innodb/">InnoDB storage engine</a>.</p>
<pre class="fixed"><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">optimizer_costs</span> <span class="k">where</span> <span class="n">engine</span><span class="o">=</span><span class="ss">&quot;innodb&quot;</span><span class="err">\</span><span class="k">G</span>
<span class="o">***************************</span> <span class="mi">1</span><span class="p">.</span> <span class="k">row</span> <span class="o">***************************</span>
                         <span class="n">ENGINE</span><span class="p">:</span> <span class="n">InnoDB</span>
       <span class="n">OPTIMIZER_DISK_READ_COST</span><span class="p">:</span> <span class="mi">10</span><span class="p">.</span><span class="mi">240000</span>
<span class="n">OPTIMIZER_INDEX_BLOCK_COPY_COST</span><span class="p">:</span> <span class="mi">0</span><span class="p">.</span><span class="mi">035600</span>
     <span class="n">OPTIMIZER_KEY_COMPARE_COST</span><span class="p">:</span> <span class="mi">0</span><span class="p">.</span><span class="mi">011361</span>
        <span class="n">OPTIMIZER_KEY_COPY_COST</span><span class="p">:</span> <span class="mi">0</span><span class="p">.</span><span class="mi">015685</span>
      <span class="n">OPTIMIZER_KEY_LOOKUP_COST</span><span class="p">:</span> <span class="mi">0</span><span class="p">.</span><span class="mi">791120</span>
   <span class="n">OPTIMIZER_KEY_NEXT_FIND_COST</span><span class="p">:</span> <span class="mi">0</span><span class="p">.</span><span class="mi">099000</span>
      <span class="n">OPTIMIZER_DISK_READ_RATIO</span><span class="p">:</span> <span class="mi">0</span><span class="p">.</span><span class="mi">020000</span>
        <span class="n">OPTIMIZER_ROW_COPY_COST</span><span class="p">:</span> <span class="mi">0</span><span class="p">.</span><span class="mi">060870</span>
      <span class="n">OPTIMIZER_ROW_LOOKUP_COST</span><span class="p">:</span> <span class="mi">0</span><span class="p">.</span><span class="mi">765970</span>
   <span class="n">OPTIMIZER_ROW_NEXT_FIND_COST</span><span class="p">:</span> <span class="mi">0</span><span class="p">.</span><span class="mi">070130</span>
   <span class="n">OPTIMIZER_ROWID_COMPARE_COST</span><span class="p">:</span> <span class="mi">0</span><span class="p">.</span><span class="mi">002653</span>
      <span class="n">OPTIMIZER_ROWID_COPY_COST</span><span class="p">:</span> <span class="mi">0</span><span class="p">.</span><span class="mi">002653</span>
</pre><p>As can be seen, the <code>ROW_LOOKUP_COST</code> is close to the <code>KEY_LOOKUP_COST</code>,
which is because InnoDB has clustered primary key indexes and is using it
to find the row from a secondary index.</p>
<p>Some engines, like <code>HEAP</code>/<code>MEMORY</code> implement their own cost
functions as different indexes in the same engine can have different costs. This is
why some of the cost numbers for these engines are 0.</p>
<p>There are also some SQL level costs that are independent of the storage engine:</p>
<pre class="fixed"><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">global_variables</span> <span class="k">where</span> <span class="n">variable_name</span> <span class="k">like</span> <span class="ss">&quot;%where%cost%&quot;</span> <span class="k">or</span> <span class="n">variable_name</span> <span class="k">like</span> <span class="ss">&quot;%scan%cost%&quot;</span><span class="p">;</span>
<span class="o">+</span><span class="c1">---------------------------+----------------+</span>
<span class="o">|</span> <span class="n">VARIABLE_NAME</span>             <span class="o">|</span> <span class="n">VARIABLE_VALUE</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------------+----------------+</span>
<span class="o">|</span> <span class="n">OPTIMIZER_SCAN_SETUP_COST</span> <span class="o">|</span> <span class="mi">10</span><span class="p">.</span><span class="mi">000000</span>      <span class="o">|</span>
<span class="o">|</span> <span class="n">OPTIMIZER_WHERE_COST</span>      <span class="o">|</span> <span class="mi">0</span><span class="p">.</span><span class="mi">032000</span>       <span class="o">|</span>
<span class="o">+</span><span class="c1">---------------------------+----------------+</span>
</pre><h2 class="anchored_heading" id="description-of-the-different-cost-variables">Description of the Different Cost Variables</h2>
<p>Time and cost are quite interchangeable in the new cost model. Below we will use cost for most
things, except for <code>OPTIMIZER_DISK_READ_COST</code> as one should use published/tested timings for the SSD/harddisk if one wants to change the value..</p>
<div class="cstm-style darkheader-nospace-borders"><table><tr><th>Variable</th><th>Type</th><th>Description</th></tr>
<tr><td><code>OPTIMIZER_DISK_READ_COST</code></td><td>Engine</td><td>Time in microseconds to read a 4K block from a disk/SSD. The default is set for a 400MB/second SSD</td></tr>
<tr><td><code>OPTIMIZER_INDEX_BLOCK_COPY_COST</code></td><td>Engine</td><td>Cost to lock and a copy a block from the global cache to a local cache. This cost is added for every block accessed, independent of whether they are cached or not</td></tr>
<tr><td><code>OPTIMIZER_KEY_COMPARE_COST</code></td><td>Engine</td><td>Cost to compare two keys</td></tr>
<tr><td><code>OPTIMIZER_KEY_COPY_COST</code></td><td>Engine</td><td>Cost to copy a key from the index to a local buffer as part of searching for a key</td></tr>
<tr><td><code>OPTIMIZER_KEY_LOOKUP_COST</code></td><td>Engine</td><td>Cost to find a key entry in the index (index read)</td></tr>
<tr><td><code>OPTIMIZER_KEY_NEXT_FIND_COST</code></td><td>Engine</td><td>Cost to find the next key in the index (index next)</td></tr>
<tr><td><code>OPTIMIZER_DISK_READ_RATIO</code></td><td>Engine</td><td>The ratio of BLOCK_NOT_IN_CACHE/CACHE_READS. The cost of disk usage is calculated as <code>estimated_blocks</code> * <code>OPTIMIZER_DISK_READ_RATIO</code> * <code><code>OPTIMIZER_DISK_READ_COST</code></code>. A value of 0 means that all blocks are always in the cache. A value of 1 means that a block is never in the cache</td></tr>
<tr><td><code>OPTIMIZER_ROW_COPY_COST</code></td><td>Engine</td><td>Cost of copying a row to a local buffer. Should be slightly more than <code>OPTIMIZER_KEY_COPY_COST</code></td></tr>
<tr><td><code>OPTIMIZER_ROW_LOOKUP_COST</code></td><td>Engine</td><td>Cost to find a row based on the rowid (Rowid is stored in the index together with the key)</td></tr>
<tr><td><code>OPTIMIZER_ROW_NEXT_FIND_COST</code></td><td>Engine</td><td>Cost of finding the next row</td></tr>
<tr><td><code>OPTIMIZER_ROWID_COMPARE_COST</code></td><td>Engine</td><td>Cost of comparing two rowids</td></tr>
<tr><td><code> OPTIMIZER_ROWID_COPY_COST</code></td><td>Engine</td><td>Cost of copying a rowid from the index</td></tr>
<tr><td><code> OPTIMIZER_SCAN_SETUP_COST</code></td><td>Session</td><td>Cost of starting a table or index scan. This has a low value to encourage the optimizer to use index lookup also tables with very few rows</td></tr>
<tr><td><code>OPTIMIZER_WHERE_COST</code></td><td>Session</td><td>Cost to execute the <code>WHERE</code> clause for every found row. Increasing this variable will encourage the optimizer to find plans which read fewer rows</td></tr>
</table>
</div><p>More information of the costs and how they were calculated can be found in the <code>Docs/optimizer_costs.txt</code> file in the <a href="/kb/en/getting-the-mariadb-source-code/">MariaDB Source distributions</a>.</p>
<h2 class="anchored_heading" id="other-optimizer-cost-changes">Other Optimizer Cost Changes</h2>
<ul start="1"><li>When counting disk accesses, we assume that all rows and index data are cached for the duration of the query. This is to avoid the following problem:
<ul start="1"><li>table t1 with 1 million_rows is scanned
<ul start="1"><li>For each row we do a lookup in table t2, which has only 10 rows
</li></ul>
</li></ul>
</li></ul>
<p>If we would count all lookups in t2, there would be 1 million lookups. If this would be the case, the optimizer would choose to use a join cache on the rows in t1 and do a table scan over t2.</p>
<ul start="1"><li>The cost of sorting (filesort) is now more accurate,  which allows the optimizer to better choose between index scan and filesort for <code>ORDER BY/GROUP BY</code> queries.
</li></ul>
<p>A lot of rule-based cost has been changed to be cost-based:</p>
<ul start="1"><li>The decision to use an index (and which index) for resolving <code>ORDER BY/GROUP BY</code> were only partly cost-based before.
</li><li>The old optimizer would limit the number of ‘expected key lookups’ to 10% of the number of rows. This would cause the optimizer to use an index to scan a big part of a table when a full table scan would be much faster. This code is now removed.
</li><li>InnoDB would limit the number of rows in a range to 50% of the total rows, which would confuse the optimizer for big ranges. The cap is now removed.
</li><li>If there was a usable filter for an index, it was sometimes used without checking the complete cost of the filter.
</li><li>‘Aggregate distinct optimization with indexes’ is now cost-based. This will change many queries from "Using index for group-by (scanning)” to “Using index for group-by”.
</li></ul>
<h2 class="anchored_heading" id="other-notable-plan-changes">Other Notable Plan Changes</h2>
<ul start="1"><li>Indexes can now be used for <code>ORDER BY/GROUP BY</code> in sub queries (instead of filesort)
</li><li>Derived tables and queries with <code>UNION</code> can now create a distinct key (instead of a key with duplicates) to speed up key accesses.
</li><li>Indexes with more used key parts are preferred if the number of resulting rows is the same:
<ul start="1"><li><code class="fixed" style="white-space:pre-wrap"><span class="k">WHERE</span> <span class="n">key_part_1</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">and</span> <span class="n">key_part_2</span> <span class="o">&lt;</span> <span class="mi">10</span>
</code>
</li><li>This will now use a <code>RANGE</code> over both key parts instead of using lookups on key_part_1.
</li></ul>
</li><li>For very small tables, index lookup is preferred over table scan.
</li><li><code>EXPLAIN</code> does not report "Using index" for scans using a clustered primary key as technically this a table scan.
</li></ul>
<h2 class="anchored_heading" id="when-the-optimizer-changes-matter">When the Optimizer Changes Matter</h2>
<p>The new, improved optimizer should be able to find a better plan</p>
<ul start="1"><li>If you are using queries with more than two tables.
</li><li>If you have indexes with a lot of identical values.
</li><li>If you are using ranges that cover more than 10% of a table.
<ul start="1"><li><code class="fixed" style="white-space:pre-wrap"><span class="k">WHERE</span> <span class="k">key</span> <span class="k">between</span> <span class="mi">1</span> <span class="k">and</span> <span class="mi">1000</span>  <span class="c1">-- Table has values 1-2000 </span>
</code>
</li></ul>
</li><li>If you have complex queries when not all used columns are or can be indexed.
<ul><li>In which case you may need to depend on selectivity to get the right plan.
</li></ul>
</li><li>If you are using queries mixing different storage engines.
<ul start="1"><li>Like using tables from both InnoDB and Memory in the same query.
</li></ul>
</li><li>If you have had to use <code>FORCE INDEX</code> to get a good plan.
</li><li>If using <a href="/kb/en/analyze-table/">ANALYZE TABLE</a> made your plans worse (or not good enough).
</li><li>If your queries have lots of derived tables (subselects).
</li><li>You are using <code>ORDER BY / GROUP BY</code> that could be resolved via indexes.
</li></ul>
<h2 class="anchored_heading" id="changing-costs">Changing Costs</h2>
<p>All engine and “SQL level” cost variables can be changed via
MariaDB startup options, in configuration files or dynamically using SQL.</p>
<h3 class="anchored_heading" id="in-configuration-files-and-command-line">In Configuration Files (and Command Line)</h3>
<pre class="fixed">[mariadbd]
# Archive is using a hard disk (typical seek is 8-10 ms)
archive.OPTIMIZER_DISK_READ_COST=8000
# All other engines are using an SSD.
OPTIMIZER_DISK_READ_COST=10.240000
</pre><h3 class="anchored_heading" id="from-sql">From SQL</h3>
<pre class="fixed"><span class="o">#</span> <span class="n">Tell</span> <span class="n">optimizer</span> <span class="k">to</span> <span class="n">find</span> <span class="n">a</span> <span class="n">plan</span> <span class="k">with</span> <span class="k">as</span> <span class="n">few</span> <span class="n">accepted</span> <span class="k">rows</span> <span class="k">as</span> <span class="n">possible</span>
<span class="k">SET</span> <span class="k">SESSION</span> <span class="n">OPTIMIZER_WHERE_COST</span><span class="o">=</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
<span class="o">#</span> <span class="n">Inform</span> <span class="n">the</span> <span class="n">optimizer</span> <span class="n">that</span> <span class="n">InnoDB</span> <span class="n">buffer</span> <span class="n">pool</span> <span class="n">has</span> <span class="n">a</span> <span class="mi">80</span><span class="o">%</span> <span class="n">hit</span> <span class="n">rate</span>
<span class="k">SET</span> <span class="k">GLOBAL</span> <span class="n">innodb</span><span class="p">.</span><span class="n">OPTIMIZER_DISK_READ_RATIO</span><span class="o">=</span><span class="mi">0</span><span class="p">.</span><span class="mi">20</span><span class="p">;</span>
</pre><ul start="1"><li>Note engine costs are <code>GLOBAL</code> while other costs can also be <code>SESSION</code>.
</li><li>To keep things fast, engine-specific costs are stored in the table definition (TABLE_SHARE). One effect of this is that if one changes the cost for an engine, it will only take effect when new, not previously cached tables are accessed. You can use <a href="/kb/en/flush/">FLUSH TABLES</a> to force the table to use the new costs at next access.
</li></ul>
<h3 class="anchored_heading" id="examples-of-changing-costs">Examples of Changing Costs</h3>
<ul start="1"><li><code>OPTIMIZER_WHERE_COST</code> is added as a cost for for all 'accepted rows'. Increasing this variable will cause the optimizer to choose plans with less estimated rows.
</li><li>One can specify the kind of disk used by the system by changing <code>OPTIMIZER_DISK_READ_COST</code>. This should be the time to do a random read of a 4096 byte block.
</li><li>The cost of a potential disk read is calculated as <code>OPTIMIZER_DISK_READ_COST * OPTIMIZER_DISK_READ_RATIO</code>. Increasing <code>OPTIMIZER_DISK_READ_RATIO</code> will inform the optimizer that not all data is cached.
</li><li><code>OPTIMIZER_SCAN_SETUP_COST</code> will increase the cost of a table scan. One can increase this to avoid using table scans.
</li></ul>
<h2 class="anchored_heading" id="for-storage-engine-developers">For Storage Engine Developers</h2>
<p>The costs for an engine are set the following way when the engine plugin is loaded/initialized:</p>
<ul start="1"><li>Copy the "default" storage engine costs to the plugin engine costs.
<ul start="1"><li>#handlerton-&gt;costs<code> points to the engine specific cost data.</code>
</li></ul>
</li><li>Call <code>handlerton-&gt;update_optimizer_costs()</code> to let the storage engine update the costs.
</li><li>Apply all user specific engine costs (from configuration files/startup) to the engine costs structure.
</li><li>When a TABLE_SHARE is created, the costs are copied from <code>handlerton-&gt;costs</code> to <code>TABLE_SHARE.optimizer_costs</code> . <code>handler::update_optimizer_costs()</code> is called to allow the engine to tune the cost for this specific table instance. This is done to avoid having to take any "cost" mutex while running queries.
</li><li>User changes to engine costs are stored in the data pointed to by <code>handlerton-&gt;costs</code>. This is why <a href="/kb/en/flush/">FLUSH TABLES</a> is needed to activate new engine costs.
</li><li>To speed up cost access for the optimizer, <code>handler::set_optimizer_costs()</code> is called for each query to copy <code>OPTIMIZER_WHERE_COST</code> and <code>OPTIMIZER_SCAN_SETUP_COST</code> to the engine cost structure.</li></ul>

    </div>


        
            <div id="subscribe" class="well well-small hide hidden-print"
                 data-subscribe-url="/kb/en/the-optimizer-cost-model-from-mariadb-11-0/+subscriptions/add"
                 data-unsubscribe-url="/kb/en/the-optimizer-cost-model-from-mariadb-11-0/+subscriptions/remove">
            </div>
        

        
        
    
        <div class="simple_section_nav">
            <ul class="nav nav-pills">
                
                    <li><a href="/kb/en/rowid-filtering-optimization/">
                        ← Rowid Filtering Optimization
                    </a>
                    </li>
                
                
                    <li><a href="/kb/en/mariadb-internals-documentation-query-optimizer/">
                        ↑ Query Optimizer ↑
                    </a>
                    </li>
                
                
            </ul>
        </div>
    

        

        
        <h2>Comments</h2>
        
    
    <div id="comments" data-node-id="11919" data-comments-url="/kb/en/the-optimizer-cost-model-from-mariadb-11-0/+comments"
         data-reply-url="/kb/en/the-optimizer-cost-model-from-mariadb-11-0/comments/post/">
        Comments loading...
    </div>

        

    </div>


                    <div id="content_disclaimer" class="graybox">
                        Content reproduced on this site is the property of its respective owners,
                        and this content is not reviewed in advance by MariaDB. The views, information and opinions
                        expressed by this content do not necessarily represent those of MariaDB or any other party.
                    </div>
                </div>
            </section>

            
                <div id="right_bar" class="col-md-2">
                    
    
        
        <ul class="section_navigation well well-small hidden-xs hidden-sm">
            
                <li class="parent"><a href="/kb/en/mariadb-internals-documentation-query-optimizer/">
                    ↑ Query Optimizer ↑
                </a>
                </li>
            
            
                
                    <li>
                        <a href="/kb/en/optimization-strategies/">
                            <span class="pull-right not_primary"></span>
                            Optimization Strategies
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/optimizations-for-derived-tables/">
                            <span class="pull-right not_primary"></span>
                            Optimizations for Derived Tables
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/mariadb-internals-documentation-optimizer-trace/">
                            
                            Optimizer Trace
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/statistics-for-optimizing-queries/">
                            <span class="pull-right not_primary"></span>
                            Statistics for Optimizing Queries
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/table-elimination/">
                            <span class="pull-right not_primary"></span>
                            Table Elimination
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/block-based-join-algorithms/">
                            
                            Block-Based Join Algorithms
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/condition-selectivity-computation-internals/">
                            
                            Condition Selectivity Computation Internals
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/extended-keys/">
                            
                            Extended Keys
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/minmax-optimization/">
                            
                            MIN/MAX optimization
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/notes-when-an-index-cannot-be-used/">
                            
                            Notes When an Index Cannot Be Used
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/optimizer-debugging-with-gdb/">
                            
                            Optimizer Debugging With GDB
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/optimizer-development/">
                            
                            Optimizer Development
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/optimizer_max_sel_arg_weight/">
                            
                            optimizer_max_sel_arg_weight
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/range-optimizer/">
                            
                            Range Optimizer
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/rowid-filtering-optimization/">
                            <span class="pull-right not_primary"></span>
                            Rowid Filtering Optimization
                        </a>
                    </li>
                
            
                
                    <li class="active">
                        <span>The Optimizer Cost Model from MariaDB 11.0</span>
                        
                    </li>
                
            
        </ul>
    
    

                </div>
            
        </div>
    </div>
</div>

<!-- Footer -->
<footer id="footer">
    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-xs-12">
                    <ul class="list-inline text-center footer-nav">
                        <li>
                            <h5>
                                <a href="https://mariadb.com/products" title="Products">Products</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/services" title="Services">Services</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/pricing" title="Pricing">Pricing</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/resources" title="Resources">Resources</a>
                            </h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/about-us" title="About MariaDB">About Us</a></h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/download" title="Download">Download MariaDB</a></h5>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="row row-10">
                
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div id="block-footerformcontact" class="block block-block-content block-block-contentd754ee1b-3cc9-40e7-9ef4-f504f1197fb1">
                        
                            <h5 style="font-weight: 400;">Subscribe to our newsletter!</h5>
                            <script src="//app-sj15.marketo.com/js/forms2/js/forms2.min.js"></script><form id="mktoForm_1498"></form>
                            <script>
                                <!--//--><![CDATA[// ><!--
                                MktoForms2.loadForm("//app-sj15.marketo.com", "573-PXI-984", 1498);
                                //--><!]]]]><![CDATA[>
                                //--><!]]>
                            </script>
                        
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div class="footer-copyright">
                        <div class="text-center">
                            <ul class="list-inline no-margin">
                                <li>
                                    <a href="/legal" title="Legal">Legal</a>
                                </li>
                                <li>
                                    <a href="/privacy-policy" title="Privacy Policy">Privacy Policy</a>
                                </li>
                                <li>
                                    <a href="/cookie-policy/" title="Cookies">Cookie Policy</a>
                                </li>
                            </ul>
                            <p>Copyright &copy; 2024 MariaDB. All rights reserved.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</footer>
</div>

<div id="ajax_loading">
    <img src="/kb/static/images/ajax-loader.a51c5608d01a.gif" />
</div>

    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MK2847"
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MK2847');</script>
    <!-- End Google Tag Manager -->

</body>

<script type="text/javascript" src="/kb/static/js/main.1587e3a666fc.js" charset="utf-8"></script>

</html>