<!DOCTYPE html>
<html>
<head data-cookie-domain=""
      data-cookie-path="/">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="apple-touch-icon" sizes="180x180" href="/kb/static/images/favicons/apple-touch-icon.159e713979be.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/kb/static/images/favicons/favicon-32x32.bc0ac1d5d11e.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/kb/static/images/favicons/favicon-16x16.5801f8f0f34e.png">
    <link rel="shortcut icon" href="/kb/static/images/favicons/favicon.d122d305dee4.ico" type="image/x-icon" />

    <title>Semi-join Materialization Strategy - MariaDB Knowledge Base</title>

    <link href="/kb/static/css/main.f7633538c846.css" rel="stylesheet" type="text/css" />

    

    

    <!-- FB Open Graph tags -->
    <meta property="og:title" content="Semi-join Materialization Strategy" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://mariadb.com/kb/en/semi-join-materialization-strategy/" />
    <meta property="og:image" content="http://mariadb.comaskmonty-logo.png" />
    <meta property="og:site_name" content="MariaDB KnowledgeBase" />
    <meta property="fb:admins" content="514852603" />
    <meta property="og:description" content="Semi-join Materialization is a subquery materialization used for Semi-join subqueries." />

    <meta name="description" content="Semi-join Materialization is a subquery materialization used for Semi-join subqueries." />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet"/>
    
</head>
<body class="mpkb nodes products nodes_view jqui" id="nodes_view">





<div id="menu-mobile" class="visible-sm visible-xs">

    <div>
        <div id="mobile-close-menu" class="text-right">
            <a href="javascript:void(0)" title="Close Menu" id="back-main" class="toggle-menu">X<span></span></a>
        </div>
    </div>
    <div class="mainmenu-mobile">
        <ul class="ls-none ul-menu">
            <li data-sub="submenu5"><a class="open-form-search" href="/kb/search/" title="Search">Search </a></li>
            <li data-sub="submenu0"><a href="/products" title="Products">Products</a><span class="arrow-main"></span></li>
            <li data-sub="submenu1"><a href="/services" title="Services">Services</a><span class="arrow-main"></span></li>
            <li data-sub="submenu2"><a href="/resources" title="Resources">Resources</a><span class="arrow-main"></span></li>
            <li data-sub="submenu3"><a href="/about-us" title="About">About</a><span class="arrow-main"></span></li>
            <li data-sub="submenu4"><a href="/contact" title="Contact">Contact</a></li>
        </ul>
    </div>

    <div class="nav-top-mobile">
        <div class="select-box form">

            <ul class="inline-block-md mb-none top-nav">
                <li>

                </li>
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/semi-join-materialization-strategy/"> Login</a>
                    </li>
                
            </ul>



        </div>
        <p class="text-center copyright">Copyright &copy; 2025 MariaDB. All rights reserved.</p>
    </div>
</div>
<div class="violator-wrap d-none" id="top_violator">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12">
                <div class="violator-outer">
                    <div class="violator-inner">
                        <div class="row">
                            <div class="col-xs-12 col-sm-9 col-lg-7 col-lg-offset-2" id="top_violator_content">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="content-link" target="_blank" rel="nofollow noreferrer">
                                    <span>The Ultimate Guide to High Availability with MariaDB</span>
                                </a>
                            </div>
                            <div class="col-xs-12 col-sm-3" id="top_violator_cta">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="btn btn-mariadb" target="_blank" rel="nofollow noreferrer">Download Now</a>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-link close-btn">
                        <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24" width="15px" height="15px"><path d="M 4.9902344 3.9902344 A 1.0001 1.0001 0 0 0 4.2929688 5.7070312 L 10.585938 12 L 4.2929688 18.292969 A 1.0001 1.0001 0 1 0 5.7070312 19.707031 L 12 13.414062 L 18.292969 19.707031 A 1.0001 1.0001 0 1 0 19.707031 18.292969 L 13.414062 12 L 19.707031 5.7070312 A 1.0001 1.0001 0 0 0 18.980469 3.9902344 A 1.0001 1.0001 0 0 0 18.292969 4.2929688 L 12 10.585938 L 5.7070312 4.2929688 A 1.0001 1.0001 0 0 0 4.9902344 3.9902344 z"/></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="wrapper">
<div id="top-nav">
    <div class="container">
        <ul class="hidden-sm hidden-xs" >
            <li><a href="https://mariadb.com/kb/">Knowledge Base</a></li>
            <li><a href="https://mariadb.com/contact/">Contact</a></li>
            
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/semi-join-materialization-strategy/" rel="nofollow">Login</a>
                    </li>
                
            
            
            <li id="search-form">
                <form action="/kb/en/+search/" method="get" id="search-block-form" accept-charset="UTF-8">
                    <input id="search" title="Enter the terms you wish to search for."
                           placeholder="Search . . ." type="text"
                           name="q" value="" size="15" maxlength="128" class="form-text"
                           data-autocomplete-url="/kb/en/+search/autocomplete/">
                    <input type="hidden" name="quick" value="1" />
                    <input type="hidden" name="source" value="kb" />
                </form>
            </li>
            <li><a id="search-toggler" href="/kb/search/">Search</a></li>
            
        </ul>
    </div>
</div>
<div id="navbar-bottom" class="navbar">
    <div class="container">
        
        
        
        
        <div class="row">
            <div class="col-md-3 col-sm-9 col-xs-9">
                <a class="brand" href="/" title="MariaDB">
                    <img src="/kb/static/images/logo-2018-black.95f5978ae14d.png">
                </a>
            </div>
            <div class="col-md-9 hidden-sm hidden-xs">
                <div class="main-menu">
                    <ul id="main-menu" class="nav navbar-nav inline-block-sm">
    <li class="has-sub full-menu">
        <a href="/products" title="Products">Products</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/services" title="Services">Services</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/pricing" title="Pricing">Pricing</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/resources" title="Resources">Resources</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/about-us" title="About Us">About Us</a>
    </li>
    <li class="">
        <a class="button electric-eel small top-bar-right-download" href="/downloads/">Download</a>
    </li>
</ul>
                </div>
            </div>
            <div class="col-md-3 visible-sm visible-xs col-sm-3 col-xs-3 ps-rv">
                <div class="navbar-header text-right pull-right">
                    <button type="button" class="menu-control toggle-menu" id="open-menu">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="main">
    <div class="container">
        

        <div id="subheader1" class="clearfix">
            <div class="pull-left">
                
                <div id="breadcrumbs" class="breadcrumb">
                    <a href="/kb/en/">Knowledge Base</a>
                    


    
    » <a class="crumb" href="/kb/en/documentation/">MariaDB Server Documentation</a>
    

    
    » <a class="crumb" href="/kb/en/replication-cluster-multi-master/">High Availability &amp; Performance Tuning</a>
    

    
    » <a class="crumb" href="/kb/en/optimization-and-tuning/">Optimization and Tuning</a>
    

    
    » <a class="crumb" href="/kb/en/query-optimizations/">Query Optimizations</a>
    

    
    » <a class="crumb" href="/kb/en/optimization-strategies/">Optimization Strategies</a>
    


    » <a class="node_link crumb" href="/kb/en/semi-join-materialization-strategy/">Semi-join Materialization Strategy</a>


                </div>
                
            </div>
        </div>
    </div>
    <div class="container" id="container-main">
        <div class="row">
            
            
                
                <aside id="sidebar-first" class="sidebar col-md-2 hidden-xs hidden-sm hidden-print">
                    
                        
                        <ul id="category_menu" class="nav nav-pills nav-stacked">
                            <li><a href="/kb/en/">Home</a></li>
                            
                                
                                    <li><a href="/kb/en/+questions/">Open Questions</a></li>
                                
                                <li><a href="/kb/en/documentation/">MariaDB Server</a></li>
                                <li><a href="/kb/en/maxscale/">MariaDB MaxScale</a></li>
                                <li><a href="/kb/en/mariadb-columnstore/">MariaDB ColumnStore</a></li>
                                <li><a href="/kb/en/connectors/">Connectors</a></li>
                            

                        </ul>
                    

                    
<div>



<div class="well well-small box actions"><div>

        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/semi-join-materialization-strategy/+history" rel="nofollow">History</a>
        
        
        
        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/semi-join-materialization-strategy/+source/">Source</a>
        
        <a class="btn btn-block btn-blue btn-sm flag" href="/kb/en/semi-join-materialization-strategy/+flag"
                data-flag-url="/kb/en/semi-join-materialization-strategy/+flag" rel="nofollow">
                Flag as Spam / Inappropriate</a>
        
        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/semi-join-materialization-strategy/+translate/">
                Translate</a>
        

</div>
</div>





<div class="well well-small box node_info"><div>

    <dl>
        <dt>Created</dt>
        <dd>

<span class="datetime" title="2011-12-23 00:14">13 years, 1 month ago</span></dd>

        <dt>Modified</dt>
        <dd>

<span class="datetime" title="2024-09-06 12:36">5 months, 1 week ago</span></dd>

        <dt>Type</dt>
        <dd>article</dd>

        <dt>Status</dt>
        <dd>active</dd>

        <dt>License</dt>
        <dd>
            
                <a href="/kb/en/semi-join-materialization-strategy/+license/">CC BY-SA / Gnu FDL</a>
            
        </dd>

        
    </dl>

    
    <ul class="rss_feeds">
        <li><a href="/kb/en/semi-join-materialization-strategy/+history/feed/">
            History</a>
        </li>
        <li><a href="/kb/en/semi-join-materialization-strategy/+comments/feed/">
            Comments</a>
        </li>
    </ul>
    

</div>
</div>





    
    
    

<div class="well well-small box attachments"><div><div class="edit_link pull-right"><a href="/kb/en/semi-join-materialization-strategy/+edit/attachments/">Edit</a></div><h5>Attachments</h5></div><div>

        
            <ul>
                
                    <li><a href="/kb/en/semi-join-materialization-strategy/+image/sj-materialization1">sj-materialization1</a>
                    </li>
                
            </ul>
        
    
</div>
</div>

    



    
    
        

<div class="well well-small box"><div><h5>Localized Versions</h5></div><div>

        <ul>
            
            <li><a href="/kb/it/semi-join-materialization-strategy/">La strategia Semi-join Materialization</a> [it]</li>
            
        </ul>
        
</div>
</div>

    






</div>


                    

































                </aside>
            
            
            
                
            
            
                
            
            <section id="content" class="limited_width col-md-8 clearfix">
                
                    <h1>Semi-join Materialization Strategy</h1>
                

                



                <div>
                    
    

    
    
    

    <div class="node creole">
        
        
        


    
    <div class="answer formatted">
        <div class="table_of_contents well well-small">
<h3>Contents</h3>
 <ol class="toc">

    <li class=""><a href="#the-idea" title="The idea">The idea</a></li>

    <li class=""><a href="#semi-join-materialization-in-action" title="Semi-join materialization in action">Semi-join materialization in action</a>    <ol class="toc">

        <li class=""><a href="#materialization-scan" title="Materialization-Scan">Materialization-Scan</a></li>

        <li class=""><a href="#materialization-lookup" title="Materialization-Lookup">Materialization-Lookup</a>    </ol>
</li>

    <li class=""><a href="#subqueries-with-grouping" title="Subqueries with grouping">Subqueries with grouping</a></li>

    <li class=""><a href="#factsheet" title="Factsheet">Factsheet</a> </ol>
</li>
</div>
<p>Semi-join Materialization is a special kind of subquery materialization used for <a href="/kb/en/semi-join-subquery-optimizations/">Semi-join subqueries</a>.  It actually includes two strategies:</p>
<ul start="1"><li>Materialization/lookup
</li><li>Materialization/scan
</li></ul>
<h2 class="anchored_heading" id="the-idea">The idea</h2>
<p>Consider a query that finds countries in Europe which have big cities:</p>
<pre class="fixed"><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">Country</span> 
<span class="k">where</span> <span class="n">Country</span><span class="p">.</span><span class="n">code</span> <span class="k">IN</span> <span class="p">(</span><span class="k">select</span> <span class="n">City</span><span class="p">.</span><span class="n">Country</span> 
                       <span class="k">from</span> <span class="n">City</span> 
                       <span class="k">where</span> <span class="n">City</span><span class="p">.</span><span class="n">Population</span> <span class="o">&gt;</span> <span class="mi">7</span><span class="o">*</span><span class="mi">1000</span><span class="o">*</span><span class="mi">1000</span><span class="p">)</span>
      <span class="k">and</span> <span class="n">Country</span><span class="p">.</span><span class="n">continent</span><span class="o">=</span><span class="s1">&#39;Europe&#39;</span>
</pre><p>The subquery is uncorrelated, that is, we can run it independently of the upper query. The idea of semi-join materialization is to do just that, and fill a temporary table with possible values of the City.country field of big cities, and then do a join with countries in Europe:</p>
<p><img src="/kb/en/semi-join-materialization-strategy/+image/sj-materialization1" alt="sj-materialization1" title="sj-materialization1"></p>
<p>The join can be done in two directions:</p>
<ol start="1"><li>From the materialized table to countries in Europe
</li><li>From countries in Europe to the materialized table
</li></ol>
<p>The first way involves doing a full scan on the materialized table, so we call it "Materialization-scan".</p>
<p>If you run a join from Countries to the materialized table, the cheapest way to find a match in the materialized table is to make a lookup on its primary key (it has one: we used it to remove duplicates). Because of that, we call the strategy "Materialization-lookup".</p>
<h2 class="anchored_heading" id="semi-join-materialization-in-action">Semi-join materialization in action</h2>
<h3 class="anchored_heading" id="materialization-scan">Materialization-Scan</h3>
<p>If we chose to look for cities with a population greater than 7 million, the optimizer will use Materialization-Scan and <code>EXPLAIN</code> will show this:</p>
<pre class="fixed wrap"><span class="n">MariaDB</span> <span class="p">[</span><span class="n">world</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">explain</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">Country</span> <span class="k">where</span> <span class="n">Country</span><span class="p">.</span><span class="n">code</span> <span class="k">IN</span> 
  <span class="p">(</span><span class="k">select</span> <span class="n">City</span><span class="p">.</span><span class="n">Country</span> <span class="k">from</span> <span class="n">City</span> <span class="k">where</span>  <span class="n">City</span><span class="p">.</span><span class="n">Population</span> <span class="o">&gt;</span> <span class="mi">7</span><span class="o">*</span><span class="mi">1000</span><span class="o">*</span><span class="mi">1000</span><span class="p">);</span>
<span class="o">+</span><span class="c1">----+--------------+-------------+--------+--------------------+------------+---------+--------------------+------+-----------------------+</span>
<span class="o">|</span> <span class="n">id</span> <span class="o">|</span> <span class="n">select_type</span>  <span class="o">|</span> <span class="k">table</span>       <span class="o">|</span> <span class="k">type</span>   <span class="o">|</span> <span class="n">possible_keys</span>      <span class="o">|</span> <span class="k">key</span>        <span class="o">|</span> <span class="n">key_len</span> <span class="o">|</span> <span class="k">ref</span>                <span class="o">|</span> <span class="k">rows</span> <span class="o">|</span> <span class="n">Extra</span>                 <span class="o">|</span>
<span class="o">+</span><span class="c1">----+--------------+-------------+--------+--------------------+------------+---------+--------------------+------+-----------------------+</span>
<span class="o">|</span>  <span class="mi">1</span> <span class="o">|</span> <span class="k">PRIMARY</span>      <span class="o">|</span> <span class="o">&lt;</span><span class="n">subquery2</span><span class="o">&gt;</span> <span class="o">|</span> <span class="k">ALL</span>    <span class="o">|</span> <span class="n">distinct_key</span>       <span class="o">|</span> <span class="k">NULL</span>       <span class="o">|</span> <span class="k">NULL</span>    <span class="o">|</span> <span class="k">NULL</span>               <span class="o">|</span>   <span class="mi">15</span> <span class="o">|</span>                       <span class="o">|</span>
<span class="o">|</span>  <span class="mi">1</span> <span class="o">|</span> <span class="k">PRIMARY</span>      <span class="o">|</span> <span class="n">Country</span>     <span class="o">|</span> <span class="n">eq_ref</span> <span class="o">|</span> <span class="k">PRIMARY</span>            <span class="o">|</span> <span class="k">PRIMARY</span>    <span class="o">|</span> <span class="mi">3</span>       <span class="o">|</span> <span class="n">world</span><span class="p">.</span><span class="n">City</span><span class="p">.</span><span class="n">Country</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>                       <span class="o">|</span>
<span class="o">|</span>  <span class="mi">2</span> <span class="o">|</span> <span class="n">MATERIALIZED</span> <span class="o">|</span> <span class="n">City</span>        <span class="o">|</span> <span class="n">range</span>  <span class="o">|</span> <span class="n">Population</span><span class="p">,</span><span class="n">Country</span> <span class="o">|</span> <span class="n">Population</span> <span class="o">|</span> <span class="mi">4</span>       <span class="o">|</span> <span class="k">NULL</span>               <span class="o">|</span>   <span class="mi">15</span> <span class="o">|</span> <span class="k">Using</span> <span class="k">index</span> <span class="n">condition</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">----+--------------+-------------+--------+--------------------+------------+---------+--------------------+------+-----------------------+</span>
<span class="mi">3</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">01</span> <span class="n">sec</span><span class="p">)</span>
</pre><p>Here, you can see:</p>
<ul start="1"><li>There are still two <code>SELECT</code>s (look for columns with <code class="fixed" style="white-space:pre-wrap">id=1</code> and <code class="fixed" style="white-space:pre-wrap">id=2</code>)
</li><li>The second select (with <code>id=2</code>) has <code class="fixed" style="white-space:pre-wrap">select_type=MATERIALIZED</code>. This means it will be executed and its results will be stored in a temporary table with a unique key over all columns. The unique key is there to prevent the table from containing any duplicate records.
</li><li>The first select received the table name <code class="fixed" style="white-space:pre-wrap">subquery2</code>.  This is the table that we got as a result of the materialization of the select with <code>id=2</code>.
</li></ul>
<p>The optimizer chose to do a full scan over the materialized table, so this is an example of a use of the Materialization-Scan strategy.</p>
<p>As for execution costs, we're going to read 15 rows from table City, write 15 rows to materialized table, read them back (the optimizer assumes there won't be any duplicates), and then do 15 eq_ref accesses to table Country.  In total, we'll do 45 reads and 15 writes.</p>
<p>By comparison, if you run the <code>EXPLAIN</code> with semi-join optimizations disabled, you'll get this:</p>
<pre class="fixed wrap"><span class="n">MariaDB</span> <span class="p">[</span><span class="n">world</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">explain</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">Country</span> <span class="k">where</span> <span class="n">Country</span><span class="p">.</span><span class="n">code</span> <span class="k">IN</span> 
  <span class="p">(</span><span class="k">select</span> <span class="n">City</span><span class="p">.</span><span class="n">Country</span> <span class="k">from</span> <span class="n">City</span> <span class="k">where</span>  <span class="n">City</span><span class="p">.</span><span class="n">Population</span> <span class="o">&gt;</span> <span class="mi">7</span><span class="o">*</span><span class="mi">1000</span><span class="o">*</span><span class="mi">1000</span><span class="p">);</span>
<span class="o">+</span><span class="c1">----+--------------------+---------+-------+--------------------+------------+---------+------+------+------------------------------------+</span>
<span class="o">|</span> <span class="n">id</span> <span class="o">|</span> <span class="n">select_type</span>        <span class="o">|</span> <span class="k">table</span>   <span class="o">|</span> <span class="k">type</span>  <span class="o">|</span> <span class="n">possible_keys</span>      <span class="o">|</span> <span class="k">key</span>        <span class="o">|</span> <span class="n">key_len</span> <span class="o">|</span> <span class="k">ref</span>  <span class="o">|</span> <span class="k">rows</span> <span class="o">|</span> <span class="n">Extra</span>                              <span class="o">|</span>
<span class="o">+</span><span class="c1">----+--------------------+---------+-------+--------------------+------------+---------+------+------+------------------------------------+</span>
<span class="o">|</span>  <span class="mi">1</span> <span class="o">|</span> <span class="k">PRIMARY</span>            <span class="o">|</span> <span class="n">Country</span> <span class="o">|</span> <span class="k">ALL</span>   <span class="o">|</span> <span class="k">NULL</span>               <span class="o">|</span> <span class="k">NULL</span>       <span class="o">|</span> <span class="k">NULL</span>    <span class="o">|</span> <span class="k">NULL</span> <span class="o">|</span>  <span class="mi">239</span> <span class="o">|</span> <span class="k">Using</span> <span class="k">where</span>                        <span class="o">|</span>
<span class="o">|</span>  <span class="mi">2</span> <span class="o">|</span> <span class="n">DEPENDENT</span> <span class="n">SUBQUERY</span> <span class="o">|</span> <span class="n">City</span>    <span class="o">|</span> <span class="n">range</span> <span class="o">|</span> <span class="n">Population</span><span class="p">,</span><span class="n">Country</span> <span class="o">|</span> <span class="n">Population</span> <span class="o">|</span> <span class="mi">4</span>       <span class="o">|</span> <span class="k">NULL</span> <span class="o">|</span>   <span class="mi">15</span> <span class="o">|</span> <span class="k">Using</span> <span class="k">index</span> <span class="n">condition</span><span class="p">;</span> <span class="k">Using</span> <span class="k">where</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">----+--------------------+---------+-------+--------------------+------------+---------+------+------+------------------------------------+</span>
</pre><p>...which is a plan to do <code>(239 + 239*15) = 3824</code> table reads.</p>
<h3 class="anchored_heading" id="materialization-lookup">Materialization-Lookup</h3>
<p>Let's modify the query slightly and look for countries which have cities with a population over one millon (instead of seven): </p>
<pre class="fixed wrap"><span class="n">MariaDB</span> <span class="p">[</span><span class="n">world</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">explain</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">Country</span> <span class="k">where</span> <span class="n">Country</span><span class="p">.</span><span class="n">code</span> <span class="k">IN</span> 
  <span class="p">(</span><span class="k">select</span> <span class="n">City</span><span class="p">.</span><span class="n">Country</span> <span class="k">from</span> <span class="n">City</span> <span class="k">where</span>  <span class="n">City</span><span class="p">.</span><span class="n">Population</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="o">*</span><span class="mi">1000</span><span class="o">*</span><span class="mi">1000</span><span class="p">)</span> <span class="p">;</span>
<span class="o">+</span><span class="c1">----+--------------+-------------+--------+--------------------+--------------+---------+------+------+-----------------------+</span>
<span class="o">|</span> <span class="n">id</span> <span class="o">|</span> <span class="n">select_type</span>  <span class="o">|</span> <span class="k">table</span>       <span class="o">|</span> <span class="k">type</span>   <span class="o">|</span> <span class="n">possible_keys</span>      <span class="o">|</span> <span class="k">key</span>          <span class="o">|</span> <span class="n">key_len</span> <span class="o">|</span> <span class="k">ref</span>  <span class="o">|</span> <span class="k">rows</span> <span class="o">|</span> <span class="n">Extra</span>                 <span class="o">|</span>
<span class="o">+</span><span class="c1">----+--------------+-------------+--------+--------------------+--------------+---------+------+------+-----------------------+</span>
<span class="o">|</span>  <span class="mi">1</span> <span class="o">|</span> <span class="k">PRIMARY</span>      <span class="o">|</span> <span class="n">Country</span>     <span class="o">|</span> <span class="k">ALL</span>    <span class="o">|</span> <span class="k">PRIMARY</span>            <span class="o">|</span> <span class="k">NULL</span>         <span class="o">|</span> <span class="k">NULL</span>    <span class="o">|</span> <span class="k">NULL</span> <span class="o">|</span>  <span class="mi">239</span> <span class="o">|</span>                       <span class="o">|</span>
<span class="o">|</span>  <span class="mi">1</span> <span class="o">|</span> <span class="k">PRIMARY</span>      <span class="o">|</span> <span class="o">&lt;</span><span class="n">subquery2</span><span class="o">&gt;</span> <span class="o">|</span> <span class="n">eq_ref</span> <span class="o">|</span> <span class="n">distinct_key</span>       <span class="o">|</span> <span class="n">distinct_key</span> <span class="o">|</span> <span class="mi">3</span>       <span class="o">|</span> <span class="n">func</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>                       <span class="o">|</span>
<span class="o">|</span>  <span class="mi">2</span> <span class="o">|</span> <span class="n">MATERIALIZED</span> <span class="o">|</span> <span class="n">City</span>        <span class="o">|</span> <span class="n">range</span>  <span class="o">|</span> <span class="n">Population</span><span class="p">,</span><span class="n">Country</span> <span class="o">|</span> <span class="n">Population</span>   <span class="o">|</span> <span class="mi">4</span>       <span class="o">|</span> <span class="k">NULL</span> <span class="o">|</span>  <span class="mi">238</span> <span class="o">|</span> <span class="k">Using</span> <span class="k">index</span> <span class="n">condition</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">----+--------------+-------------+--------+--------------------+--------------+---------+------+------+-----------------------+</span>
<span class="mi">3</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</pre><p>The <code>EXPLAIN</code> output is similar to the one which used Materialization-scan, except that:</p>
<ul start="1"><li>the <code class="fixed" style="white-space:pre-wrap">&lt;subquery2&gt;</code> table is accessed with the <code>eq_ref</code> access method
</li><li>the access uses an index named <code class="fixed" style="white-space:pre-wrap">distinct_key</code>
</li></ul>
<p>This means that the optimizer is planning to do index lookups into the materialized table. In other words, we're going to use the Materialization-lookup strategy.</p>
<p>With <code class="fixed" style="white-space:pre-wrap">optimizer_switch='semijoin=off,materialization=off'</code>), one will get this <code>EXPLAIN</code>:</p>
<pre class="fixed wrap"><span class="n">MariaDB</span> <span class="p">[</span><span class="n">world</span><span class="p">]</span><span class="o">&gt;</span> <span class="k">explain</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">Country</span> <span class="k">where</span> <span class="n">Country</span><span class="p">.</span><span class="n">code</span> <span class="k">IN</span> 
  <span class="p">(</span><span class="k">select</span> <span class="n">City</span><span class="p">.</span><span class="n">Country</span> <span class="k">from</span> <span class="n">City</span> <span class="k">where</span>  <span class="n">City</span><span class="p">.</span><span class="n">Population</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="o">*</span><span class="mi">1000</span><span class="o">*</span><span class="mi">1000</span><span class="p">)</span> <span class="p">;</span>
<span class="o">+</span><span class="c1">----+--------------------+---------+----------------+--------------------+---------+---------+------+------+-------------+</span>
<span class="o">|</span> <span class="n">id</span> <span class="o">|</span> <span class="n">select_type</span>        <span class="o">|</span> <span class="k">table</span>   <span class="o">|</span> <span class="k">type</span>           <span class="o">|</span> <span class="n">possible_keys</span>      <span class="o">|</span> <span class="k">key</span>     <span class="o">|</span> <span class="n">key_len</span> <span class="o">|</span> <span class="k">ref</span>  <span class="o">|</span> <span class="k">rows</span> <span class="o">|</span> <span class="n">Extra</span>       <span class="o">|</span>
<span class="o">+</span><span class="c1">----+--------------------+---------+----------------+--------------------+---------+---------+------+------+-------------+</span>
<span class="o">|</span>  <span class="mi">1</span> <span class="o">|</span> <span class="k">PRIMARY</span>            <span class="o">|</span> <span class="n">Country</span> <span class="o">|</span> <span class="k">ALL</span>            <span class="o">|</span> <span class="k">NULL</span>               <span class="o">|</span> <span class="k">NULL</span>    <span class="o">|</span> <span class="k">NULL</span>    <span class="o">|</span> <span class="k">NULL</span> <span class="o">|</span>  <span class="mi">239</span> <span class="o">|</span> <span class="k">Using</span> <span class="k">where</span> <span class="o">|</span>
<span class="o">|</span>  <span class="mi">2</span> <span class="o">|</span> <span class="n">DEPENDENT</span> <span class="n">SUBQUERY</span> <span class="o">|</span> <span class="n">City</span>    <span class="o">|</span> <span class="n">index_subquery</span> <span class="o">|</span> <span class="n">Population</span><span class="p">,</span><span class="n">Country</span> <span class="o">|</span> <span class="n">Country</span> <span class="o">|</span> <span class="mi">3</span>       <span class="o">|</span> <span class="n">func</span> <span class="o">|</span>   <span class="mi">18</span> <span class="o">|</span> <span class="k">Using</span> <span class="k">where</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">----+--------------------+---------+----------------+--------------------+---------+---------+------+------+-------------+</span>
</pre><p>One can see that both plans will do a full scan on the <code>Country</code> table. For the second step, MariaDB will fill the materialized table (238 rows read from table City and written to the temporary table) and then do a unique key lookup for each record in table <code>Country</code>, which works out to 238 unique key lookups. In total, the second step will cost <code>(239+238) = 477</code> reads and <code>238</code> temp.table writes.</p>
<p>Execution of the latter (<code>DEPENDENT SUBQUERY</code>) plan reads 18 rows using an index on <code>City.Country</code> for each record it receives for table <code>Country</code>. This works out to a cost of <code>(18*239) = 4302</code> reads.  Had there been fewer subquery invocations, this plan would have been better than the one with Materialization.  By the way, MariaDB has an option to use such a query plan, too (see <a href="/kb/en/firstmatch-strategy/">FirstMatch Strategy</a>), but it did not choose it.</p>
<h2 class="anchored_heading" id="subqueries-with-grouping">Subqueries with grouping</h2>
<p>MariaDB is able to use Semi-join materialization strategy when the subquery has grouping (other semi-join strategies are not applicable in this case).</p>
<p>This allows for efficient execution of queries that search for the best/last element in a certain group. </p>
<p>For example, let's find cities that have the biggest population on their continent: </p>
<pre class="fixed wrap"><span class="k">explain</span> 
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">City</span> 
<span class="k">where</span> <span class="n">City</span><span class="p">.</span><span class="n">Population</span> <span class="k">in</span> <span class="p">(</span><span class="k">select</span> <span class="k">max</span><span class="p">(</span><span class="n">City</span><span class="p">.</span><span class="n">Population</span><span class="p">)</span> <span class="k">from</span> <span class="n">City</span><span class="p">,</span> <span class="n">Country</span> 
                          <span class="k">where</span> <span class="n">City</span><span class="p">.</span><span class="n">Country</span><span class="o">=</span><span class="n">Country</span><span class="p">.</span><span class="n">Code</span> 
                          <span class="k">group</span> <span class="k">by</span> <span class="n">Continent</span><span class="p">)</span>
<span class="o">+</span><span class="c1">------+--------------+-------------+------+---------------+------------+---------+----------------------------------+------+-----------------+</span>
<span class="o">|</span> <span class="n">id</span>   <span class="o">|</span> <span class="n">select_type</span>  <span class="o">|</span> <span class="k">table</span>       <span class="o">|</span> <span class="k">type</span> <span class="o">|</span> <span class="n">possible_keys</span> <span class="o">|</span> <span class="k">key</span>        <span class="o">|</span> <span class="n">key_len</span> <span class="o">|</span> <span class="k">ref</span>                              <span class="o">|</span> <span class="k">rows</span> <span class="o">|</span> <span class="n">Extra</span>           <span class="o">|</span>
<span class="o">+</span><span class="c1">------+--------------+-------------+------+---------------+------------+---------+----------------------------------+------+-----------------+</span>
<span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span> <span class="k">PRIMARY</span>      <span class="o">|</span> <span class="o">&lt;</span><span class="n">subquery2</span><span class="o">&gt;</span> <span class="o">|</span> <span class="k">ALL</span>  <span class="o">|</span> <span class="n">distinct_key</span>  <span class="o">|</span> <span class="k">NULL</span>       <span class="o">|</span> <span class="k">NULL</span>    <span class="o">|</span> <span class="k">NULL</span>                             <span class="o">|</span>  <span class="mi">239</span> <span class="o">|</span>                 <span class="o">|</span>
<span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span> <span class="k">PRIMARY</span>      <span class="o">|</span> <span class="n">City</span>        <span class="o">|</span> <span class="k">ref</span>  <span class="o">|</span> <span class="n">Population</span>    <span class="o">|</span> <span class="n">Population</span> <span class="o">|</span> <span class="mi">4</span>       <span class="o">|</span> <span class="o">&lt;</span><span class="n">subquery2</span><span class="o">&gt;</span><span class="p">.</span><span class="k">max</span><span class="p">(</span><span class="n">City</span><span class="p">.</span><span class="n">Population</span><span class="p">)</span> <span class="o">|</span>    <span class="mi">1</span> <span class="o">|</span>                 <span class="o">|</span>
<span class="o">|</span>    <span class="mi">2</span> <span class="o">|</span> <span class="n">MATERIALIZED</span> <span class="o">|</span> <span class="n">Country</span>     <span class="o">|</span> <span class="k">ALL</span>  <span class="o">|</span> <span class="k">PRIMARY</span>       <span class="o">|</span> <span class="k">NULL</span>       <span class="o">|</span> <span class="k">NULL</span>    <span class="o">|</span> <span class="k">NULL</span>                             <span class="o">|</span>  <span class="mi">239</span> <span class="o">|</span> <span class="k">Using</span> <span class="k">temporary</span> <span class="o">|</span>
<span class="o">|</span>    <span class="mi">2</span> <span class="o">|</span> <span class="n">MATERIALIZED</span> <span class="o">|</span> <span class="n">City</span>        <span class="o">|</span> <span class="k">ref</span>  <span class="o">|</span> <span class="n">Country</span>       <span class="o">|</span> <span class="n">Country</span>    <span class="o">|</span> <span class="mi">3</span>       <span class="o">|</span> <span class="n">world</span><span class="p">.</span><span class="n">Country</span><span class="p">.</span><span class="n">Code</span>               <span class="o">|</span>   <span class="mi">18</span> <span class="o">|</span>                 <span class="o">|</span>
<span class="o">+</span><span class="c1">------+--------------+-------------+------+---------------+------------+---------+----------------------------------+------+-----------------+</span>
<span class="mi">4</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</pre><p>the cities are:</p>
<pre class="fixed">+------+-------------------+---------+------------+
| ID   | Name              | Country | Population |
+------+-------------------+---------+------------+
| 1024 | Mumbai (Bombay)   | IND     |   10500000 |
| 3580 | Moscow            | RUS     |    8389200 |
| 2454 | Macao             | MAC     |     437500 |
|  608 | Cairo             | EGY     |    6789479 |
| 2515 | Ciudad de México | MEX     |    8591309 |
|  206 | São Paulo        | BRA     |    9968485 |
|  130 | Sydney            | AUS     |    3276207 |
+------+-------------------+---------+------------+
</pre><h2 class="anchored_heading" id="factsheet">Factsheet</h2>
<p>Semi-join materialization</p>
<ul start="1"><li>Can be used for uncorrelated IN-subqueries. The subselect may use grouping and/or aggregate functions.
</li><li>Is shown in <code>EXPLAIN</code> as <code class="fixed" style="white-space:pre-wrap">type=MATERIALIZED</code> for the subquery, and a line with
<code class="fixed" style="white-space:pre-wrap">table=&lt;subqueryN&gt;</code> in the parent subquery.
</li><li>Is enabled when one has both <code class="fixed" style="white-space:pre-wrap">materialization=on</code> and <code class="fixed" style="white-space:pre-wrap">semijoin=on</code> in the <a href="/kb/en/server-system-variables/#optimizer_switch">optimizer_switch</a> variable.
</li><li>The <code class="fixed" style="white-space:pre-wrap">materialization=on|off</code> flag is shared with <a href="/kb/en/non-semi-join-subquery-optimizations/#materialization-for-non-correlated-in-subqueries">Non-semijoin materialization</a>.</li></ul>

    </div>


        
            <div id="subscribe" class="well well-small hide hidden-print"
                 data-subscribe-url="/kb/en/semi-join-materialization-strategy/+subscriptions/add"
                 data-unsubscribe-url="/kb/en/semi-join-materialization-strategy/+subscriptions/remove">
            </div>
        

        
        
    
        <div class="simple_section_nav">
            <ul class="nav nav-pills">
                
                    <li><a href="/kb/en/loosescan-strategy/">
                        ← LooseScan Strategy
                    </a>
                    </li>
                
                
                    <li><a href="/kb/en/optimization-strategies/">
                        ↑ Optimization Strategies ↑
                    </a>
                    </li>
                
                
                    <li class="pull-right"><a href="/kb/en/improvements-to-order-by/">
                        Improvements to ORDER BY Optimization →
                    </a>
                    </li>
                
            </ul>
        </div>
    

        

        
        <h2>Comments</h2>
        
    
    <div id="comments" data-node-id="1997" data-comments-url="/kb/en/semi-join-materialization-strategy/+comments"
         data-reply-url="/kb/en/semi-join-materialization-strategy/comments/post/">
        Comments loading...
    </div>

        

    </div>


                    <div id="content_disclaimer" class="graybox">
                        Content reproduced on this site is the property of its respective owners,
                        and this content is not reviewed in advance by MariaDB. The views, information and opinions
                        expressed by this content do not necessarily represent those of MariaDB or any other party.
                    </div>
                </div>
            </section>

            
                <div id="right_bar" class="col-md-2">
                    
    
        
        <ul class="section_navigation well well-small hidden-xs hidden-sm">
            
                <li class="parent"><a href="/kb/en/optimization-strategies/">
                    ↑ Optimization Strategies ↑
                </a>
                </li>
            
            
                
                    <li>
                        <a href="/kb/en/duplicateweedout-strategy/">
                            
                            DuplicateWeedout Strategy
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/firstmatch-strategy/">
                            
                            FirstMatch Strategy
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/loosescan-strategy/">
                            
                            LooseScan Strategy
                        </a>
                    </li>
                
            
                
                    <li class="active">
                        <span>Semi-join Materialization Strategy</span>
                        
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/improvements-to-order-by/">
                            
                            Improvements to ORDER BY Optimization
                        </a>
                    </li>
                
            
        </ul>
    
    

                </div>
            
        </div>
    </div>
</div>

<!-- Footer -->
<footer id="footer">
    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-xs-12">
                    <ul class="list-inline text-center footer-nav">
                        <li>
                            <h5>
                                <a href="https://mariadb.com/products" title="Products">Products</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/services" title="Services">Services</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/pricing" title="Pricing">Pricing</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/resources" title="Resources">Resources</a>
                            </h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/about-us" title="About MariaDB">About Us</a></h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/download" title="Download">Download MariaDB</a></h5>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="row row-10">
                
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div id="block-footerformcontact" class="block block-block-content block-block-contentd754ee1b-3cc9-40e7-9ef4-f504f1197fb1">
                        
                            <h5 style="font-weight: 400;">Subscribe to our newsletter!</h5>
                            <script src="//app-sj15.marketo.com/js/forms2/js/forms2.min.js"></script><form id="mktoForm_1498"></form>
                            <script>
                                <!--//--><![CDATA[// ><!--
                                MktoForms2.loadForm("//app-sj15.marketo.com", "573-PXI-984", 1498);
                                //--><!]]]]><![CDATA[>
                                //--><!]]>
                            </script>
                        
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div class="footer-copyright">
                        <div class="text-center">
                            <ul class="list-inline no-margin">
                                <li>
                                    <a href="/legal" title="Legal">Legal</a>
                                </li>
                                <li>
                                    <a href="/privacy-policy" title="Privacy Policy">Privacy Policy</a>
                                </li>
                                <li>
                                    <a href="/cookie-policy/" title="Cookies">Cookie Policy</a>
                                </li>
                            </ul>
                            <p>Copyright &copy; 2025 MariaDB. All rights reserved.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</footer>
</div>

<div id="ajax_loading">
    <img src="/kb/static/images/ajax-loader.a51c5608d01a.gif" />
</div>

    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MK2847"
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MK2847');</script>
    <!-- End Google Tag Manager -->

</body>

<script type="text/javascript" src="/kb/static/js/main.1587e3a666fc.js" charset="utf-8"></script>

</html>