<!DOCTYPE html>
<html>
<head data-cookie-domain=""
      data-cookie-path="/">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="apple-touch-icon" sizes="180x180" href="/kb/static/images/favicons/apple-touch-icon.159e713979be.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/kb/static/images/favicons/favicon-32x32.bc0ac1d5d11e.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/kb/static/images/favicons/favicon-16x16.5801f8f0f34e.png">
    <link rel="shortcut icon" href="/kb/static/images/favicons/favicon.d122d305dee4.ico" type="image/x-icon" />

    <title>The MariaDB Jupyter Kernel - Main Components and Architecture - Source - MariaDB Knowledge Base</title>

    <link href="/kb/static/css/main.b9e1e104f007.css" rel="stylesheet" type="text/css" />

    
        <meta name="robots" content="noindex, nofollow">
    

    <!-- FB Open Graph tags -->
    <meta property="og:title" content="The MariaDB Jupyter Kernel - Main Components and Architecture - Source" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://mariadb.com/kb/en/the-mariadb-jupyter-kernel-main-components-and-architecture/+source/" />
    <meta property="og:image" content="http://mariadb.comaskmonty-logo.png" />
    <meta property="og:site_name" content="MariaDB KnowledgeBase" />
    <meta property="fb:admins" content="514852603" />
    <meta property="og:description" content="" />

    <meta name="description" content="" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet"/>
    
</head>
<body class="mpkb nodes autoresize nodes_source jqui" id="nodes_source">





<div id="menu-mobile" class="visible-sm visible-xs">

    <div>
        <div id="mobile-close-menu" class="text-right">
            <a href="javascript:void(0)" title="Close Menu" id="back-main" class="toggle-menu">X<span></span></a>
        </div>
    </div>
    <div class="mainmenu-mobile">
        <ul class="ls-none ul-menu">
            <li data-sub="submenu5"><a class="open-form-search" href="/kb/search/" title="Search">Search </a></li>
            <li data-sub="submenu0"><a href="/products" title="Products">Products</a><span class="arrow-main"></span></li>
            <li data-sub="submenu1"><a href="/services" title="Services">Services</a><span class="arrow-main"></span></li>
            <li data-sub="submenu2"><a href="/resources" title="Resources">Resources</a><span class="arrow-main"></span></li>
            <li data-sub="submenu3"><a href="/about-us" title="About">About</a><span class="arrow-main"></span></li>
            <li data-sub="submenu4"><a href="/contact" title="Contact">Contact</a></li>
        </ul>
    </div>

    <div class="nav-top-mobile">
        <div class="select-box form">

            <ul class="inline-block-md mb-none top-nav">
                <li>

                </li>
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/the-mariadb-jupyter-kernel-main-components-and-architecture/+source/"> Login</a>
                    </li>
                
            </ul>



        </div>
        <p class="text-center copyright">Copyright &copy; 2024 MariaDB. All rights reserved.</p>
    </div>
</div>
<div id="wrapper">
<div id="top-nav">
    <div class="container">
        <ul class="hidden-sm hidden-xs" >
            <li><a href="https://mariadb.com/kb/">Knowledge Base</a></li>
            <li><a href="https://mariadb.com/contact/">Contact</a></li>
            
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/the-mariadb-jupyter-kernel-main-components-and-architecture/+source/" rel="nofollow">Login</a>
                    </li>
                
            
            
            <li id="search-form">
                <form action="/kb/en/+search/" method="get" id="search-block-form" accept-charset="UTF-8">
                    <input id="search" title="Enter the terms you wish to search for."
                           placeholder="Search . . ." type="text"
                           name="q" value="" size="15" maxlength="128" class="form-text"
                           data-autocomplete-url="/kb/en/+search/autocomplete/">
                    <input type="hidden" name="quick" value="1" />
                    <input type="hidden" name="source" value="kb" />
                </form>
            </li>
            <li><a id="search-toggler" href="/kb/search/">Search</a></li>
            
        </ul>
    </div>
</div>
<div id="navbar-bottom" class="navbar">
    <div class="container">
        
        
        
        
        <div class="row">
            <div class="col-md-3 col-sm-9 col-xs-9">
                <a class="brand" href="/" title="MariaDB">
                    <img src="/kb/static/images/logo-2018-black.95f5978ae14d.png">
                </a>
            </div>
            <div class="col-md-9 hidden-sm hidden-xs">
                <div class="main-menu">
                    <ul id="main-menu" class="nav navbar-nav inline-block-sm">
    <li class="has-sub full-menu">
        <a href="/products" title="Products">Products</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/services" title="Services">Services</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/pricing" title="Pricing">Pricing</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/resources" title="Resources">Resources</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/about-us" title="About Us">About Us</a>
    </li>
    <li class="">
        <a class="button electric-eel small top-bar-right-download" href="/downloads/">Download</a>
    </li>
</ul>
                </div>
            </div>
            <div class="col-md-3 visible-sm visible-xs col-sm-3 col-xs-3 ps-rv">
                <div class="navbar-header text-right pull-right">
                    <button type="button" class="menu-control toggle-menu" id="open-menu">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="main">
    <div class="container">
        

        <div id="subheader1" class="clearfix">
            <div class="pull-left">
                
                <div id="breadcrumbs" class="breadcrumb">
                    <a href="/kb/en/">Knowledge Base</a>
                    


    
    » <a class="crumb" href="/kb/en/server-client-software/">Server &amp; Client Software</a>
    

    
    » <a class="crumb" href="/kb/en/client-libraries/">Client Libraries</a>
    

    
    » <a class="crumb" href="/kb/en/connectors/">Application Programming Interfaces</a>
    

    
    » <a class="crumb" href="/kb/en/using-the-mariadb-jupyter-kernel/">The MariaDB Jupyter kernel</a>
    


    » <a class="node_link crumb" href="/kb/en/the-mariadb-jupyter-kernel-main-components-and-architecture/">The MariaDB Jupyter Kernel - Main Components and Architecture</a>


                </div>
                
            </div>
        </div>
    </div>
    <div class="container" id="container-main">
        <div class="row">
            
            
                
                <aside id="sidebar-first" class="sidebar col-md-2 hidden-xs hidden-sm hidden-print">
                    
                        
                        <ul id="category_menu" class="nav nav-pills nav-stacked">
                            <li><a href="/kb/en/">Home</a></li>
                            
                                
                                    <li><a href="/kb/en/+questions/">Open Questions</a></li>
                                
                                <li><a href="/kb/en/documentation/">MariaDB Server</a></li>
                                <li><a href="/kb/en/maxscale/">MariaDB MaxScale</a></li>
                                <li><a href="/kb/en/mariadb-columnstore/">MariaDB ColumnStore</a></li>
                                <li><a href="/kb/en/connectors/">Connectors</a></li>
                            

                        </ul>
                    

                    
                        <div>
    

<div class="well well-small box actions"><div>

        <a class="btn btn-block btn-small" href="/kb/en/the-mariadb-jupyter-kernel-main-components-and-architecture/">Return to article</a>
    
</div>
</div>

</div>
                    

                    

































                </aside>
            
            
            
                
            
            
            <section id="content" class="limited_width col-md-10 clearfix">
                
                    <h1>The MariaDB Jupyter Kernel - Main Components and Architecture - Source</h1>
                

                



                <div>
                    

    

    
    <div class="revision_info">
        <dl class="table">
            <dt>Revision</dt>
            <dd><a href="/kb/en/the-mariadb-jupyter-kernel-main-components-and-architecture/+r/105732/">105732</a></dd>
            <dt>User</dt>
            <dd>
<span class="user" id="user-6663">
<a href="/kb/user/id/6663" title="Robert Bindar">Robert Bindar</a>
</span></dd>
            <dt>Date</dt>
            <dd>

<span class="datetime" title="2021-03-29 20:51">2021-03-29 20:51</span></dd>
        </dl>
    </div>
    


    

    
        
        <textarea id="answer_source" class="creole_source autogrow">= Architecture

The [[https://github.com/MariaDB/mariadb_kernel|mariadb_kernel]] project is made out of several components. These components were created to perform various functions such as: interfacing with the [[https://jupyter-client.readthedocs.io/en/stable/messaging.html|Jupyter protocol API]], parsing the input texts that the user writes in the notebook cells, magic commands execution or even just abstracting away certain interactions that we suspect might change in the future.

Here’s a diagram displaying the relationship between all the main components of the kernel.

{{architecture}}
&lt;&lt;toc&gt;&gt;

When you start a notebook in [[https://jupyterlab.readthedocs.io/en/stable/|JupyterLab]], Jupyter spawns an instance of [[main-components-and-architecture/#mariadbkernel|MariaDBKernel]].
The kernel then creates a [[main-components-and-architecture/#clientconfig|ClientConfig]] object to read {{{mariadb_config.json}}}. If the kernel detects based on the configuration settings that a MariaDB server is up and running, it creates a [[main-components-and-architecture/#mariadbclient|MariaDBClient]] object that is responsible for talking to the server.
If no server is detected, based on the config options, the kernel might start a MariaDB Server instance for you. This server instance is abstracted via the [[main-components-and-architecture/#mariadbserver|MariaDBServer]] type.

Now the startup stage is done, the kernel is idle and waiting for the user to start writing code and executing the Notebook cells.

For each notebook that the user creates, Jupyter spawns a new instance of the MariaDB kernel.

When the user executes a code cell, [[main-components-and-architecture/#mariadbkernel|MariaDBKernel]] receives a message from Jupyter. This message contains, along with other options, the code that the user wrote in the cell.
The kernel then creates a [[main-components-and-architecture/#codeparser|CodeParser]] object and it gets from the parser the SQL statements found in the code text and a list of magic objects that the user tries to execute.

The kernel uses [[main-components-and-architecture/#mariadbclient|MariaDBClient]] to execute the SQL statements, get the results and display back in the notebook the output and then it executes the magic commands in the order they were found in the code.

The [[main-components-and-architecture/#codeparser|CodeParser]] object basically parses the code and puts all the SQL statements in a list. When the parser encounters a magic command, it uses a [[main-components-and-architecture/#magicfactory|MagicFactory]] object to create the right magic object based on the name of the magic, the arguments passed to that magic and the current state saved in the kernel that can potentially be used by the magic when it is executed.

Now that you have the bottom-up picture of how the components of the kernel interact with each other internally, here&#39;s a diagram showing how the kernel fits within the entire picture:

{{jupyter_interaction}} 

= Components

=== MariaDBKernel

This class inherits from the [[https://github.com/ipython/ipykernel/blob/master/ipykernel/kernelbase.py|ipykernel.kernelbase.Kernel]] type which implements the [[https://jupyter-client.readthedocs.io/en/stable/messaging.html|Jupyter client protocol]] and all the machinery that makes things move in the big picture.

=== ClientConfig

ClientConfig stores the default configuration of the kernel and it parses and loads the options passed by the user in {{{mariadb_config.json}}}, if one is found.
ClientConfig looks for {{{mariadb_config.json}}} in {{{~/.jupyter/}}} by default or in the path provided by the user in the [[https://jupyter.readthedocs.io/en/latest/use/jupyter-directories.html#envvar-JUPYTER_CONFIG_DIR|JUPYTER_CONFIG_DIR]] environment variable.

[[main-components-and-architecture/#mariadbkernel|MariaDBKernel]] and other kernel components use this class for getting the arguments to pass to the MariaDB client or to alter some internal behaviors of the kernel.

=== MariaDBClient

This class is an abstraction of the MariaDB command line client.
MariaDBClient is capable of controlling a sub-process running the [[https://mariadb.com/kb/en/mysql-command-line-client/|mariadb]] client binary and it does so using the [[https://pexpect.readthedocs.io/en/stable/|Pexpect]] package.

The kernel uses this class to start/stop MariaDB clients or to run SQL statements written by the users in notebooks. Basically any communication with the MariaDB database itself is handled via this class. 

=== MariaDBServer

This component abstracts away a MariaDB Server instance. It provides mechanisms for starting or stopping a server instance and for synchronizing the kernel with a server instance that is either ready to receive client connections or is safely stopped.

This class is used by the kernel when the kernel is loaded and it doesn’t detect a running instance of MariaDB Server based on the default or custom configuration. In this case, depending on whether the user chose this behavior, the kernel will start a server to be used for quick testing scenarios when the user wants to rapidly try some statements in a notebook.

=== CodeParser

This class parses the code of one notebook cell and derives two types of data from it:
a list of strings containing the SQL statements found in the code and a list of
magic objects created based on the names and arguments of the magic commands written by the user in that cell.

CodeParser uses the [[main-components-and-architecture/#magicfactory|MagicFactory]] component to create the right magic objects, be it {{{line magics}}}, {{{cell magics}}}, {{{%line}}}, {{{%lsmagic}}}, etc.

=== MagicFactory

This class creates the right magic objects based on the name and arguments of a magic command and a name:type mapping stored internally.
This class also creates objects of type {{{ErrorMagic}}} when the user writes magic commands that are not supported by the kernel. The execution of such {{{ErrorMagic}}} objects in the kernel results in an error being displayed in the notebook.

=== MariaMagic

The parent class of all the magic commands. It is an interface that defines the API all magic commands should implement to be compatible with the kernel.

=== CellMagic

This class inherits from [[main-components-and-architecture/#mariamagic|MariaMagic]]. It is an abstract class that is supposed to provide basic functionalities to all magic commands of type {{{cell}}}.

A cell magic is a shortcut a user can write into a notebook cell.
The cell magic is written under the form {{{%%magic}}} and in principle it operates over the entire code of the cell it is written in, e.g:
{{{
------cell
%%magic_python
from matplotlib import pyplot
x = [1,2,3]
print(x)
pyplot.plot(x)
------end of cell
}}}

=== Delimiter

This component implements the {{{%%delimiter}}} cell magic command.

Its purpose is to run an SQL statement using a different
delimiter than the default &#34;;&#34;. The main usecase is [[stored-procedures|stored procedures]] and [[stored-functions|stored functions]], e.g:

{{{
--------cell
%%delimiter //
CREATE PROCEDURE proc ()
 BEGIN
  select 1;
 END;
//
--------end-of-cell
}}}

Note that the SQL statement needs to end with the
delimiter specified by the magic command.    

=== LineMagic

This class inherits from [[main-components-and-architecture/#mariamagic|MariaMagic]]. It is an abstract class that is supposed to provide basic functionality to all magic commands of type {{{line}}}.

A line magic is a shortcut a user can write into a notebook cell.
The line magic is written under the form {{{%magic}}} and in principle, it only sees what is passed as arguments by the user, e.g. {{{%magic arg1 arg2}}}

=== LSMagic

This magic command prints the list of magics supported by the kernel along with a help text guiding the user on how to use them.

=== Line

The whole purpose of this magic command is to allow the user to display
the result of the last query (e.g. {{{SELECT}}}, {{{SHOW}}},...) in a nice and simple
[[https://matplotlib.org/|matplotlib]] plot.

Internally, the Line class receives the data of the last query from the kernel
as a [[https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html|Pandas DataFrame]], it generates a plot {{{PNG}}} image, wraps the image into                                                                                                             
a nice [[https://jupyter-client.readthedocs.io/en/stable/messaging.html#display-data|display_data]] Jupyter message and then sends it further.

=== DF

The {{{%df}}} magic writes the result of the last query executed in the notebook
into an external {{{CSV}}} formatted file.

The purpose of this magic command is to allow users to export query
data from their MariaDB databases and then quickly import it
into a Python Notebook where more complex analytics can be performed.

If no arguments are specified, the kernel writes the data into a
{{{CSV}}} file named {{{last_query.csv}}}.

=== Bar

The purpose of this magic command is to allow the user to display
the result of the last query (e.g. {{{SELECT}}}, {{{SHOW}}},...) in a nice and simple
[[https://matplotlib.org/|matplotlib]] plot.

Internally, the Bar class receives the data of the last query from the kernel
as a [[https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html|Pandas DataFrame]], it generates a plot {{{PNG}}} image, wraps the image into                                                                                                             
a nice [[https://jupyter-client.readthedocs.io/en/stable/messaging.html#display-data|display_data]] Jupyter message and then sends it further.

=== Pie

The purpose of this magic command is to allow the user to display
the result of the last query (e.g. {{{SELECT}}}, {{{SHOW}}},...) in a nice and simple
[[https://matplotlib.org/|matplotlib]] plot.

Internally, the Pie class receives the data of the last query from the kernel
as a [[https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html|Pandas DataFrame]], it generates a plot {{{PNG}}} image, wraps the image into                                                                                                             
a nice [[https://jupyter-client.readthedocs.io/en/stable/messaging.html#display-data|display_data]] Jupyter message and then sends it further.</textarea>
    


                    <div id="content_disclaimer" class="graybox">
                        Content reproduced on this site is the property of its respective owners,
                        and this content is not reviewed in advance by MariaDB. The views, information and opinions
                        expressed by this content do not necessarily represent those of MariaDB or any other party.
                    </div>
                </div>
            </section>

            
        </div>
    </div>
</div>

<!-- Footer -->
<footer id="footer">
    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-xs-12">
                    <ul class="list-inline text-center footer-nav">
                        <li>
                            <h5>
                                <a href="https://mariadb.com/products" title="Products">Products</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/services" title="Services">Services</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/pricing" title="Pricing">Pricing</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/resources" title="Resources">Resources</a>
                            </h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/about-us" title="About MariaDB">About Us</a></h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/download" title="Download">Download MariaDB</a></h5>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="row row-10">
                
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div id="block-footerformcontact" class="block block-block-content block-block-contentd754ee1b-3cc9-40e7-9ef4-f504f1197fb1">
                        
                            <h5 style="font-weight: 400;">Subscribe to our newsletter!</h5>
                            <script src="//app-sj15.marketo.com/js/forms2/js/forms2.min.js"></script><form id="mktoForm_1498"></form>
                            <script>
                                <!--//--><![CDATA[// ><!--
                                MktoForms2.loadForm("//app-sj15.marketo.com", "573-PXI-984", 1498);
                                //--><!]]]]><![CDATA[>
                                //--><!]]>
                            </script>
                        
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div class="footer-copyright">
                        <div class="text-center">
                            <ul class="list-inline no-margin">
                                <li>
                                    <a href="/legal" title="Legal">Legal</a>
                                </li>
                                <li>
                                    <a href="/privacy-policy" title="Privacy Policy">Privacy Policy</a>
                                </li>
                                <li>
                                    <a href="/cookie-policy/" title="Cookies">Cookie Policy</a>
                                </li>
                            </ul>
                            <p>Copyright &copy; 2024 MariaDB. All rights reserved.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</footer>
</div>

<div id="ajax_loading">
    <img src="/kb/static/images/ajax-loader.a51c5608d01a.gif" />
</div>

    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MK2847"
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MK2847');</script>
    <!-- End Google Tag Manager -->

</body>

<script type="text/javascript" src="/kb/static/js/main.fed4ec768178.js" charset="utf-8"></script>

</html>