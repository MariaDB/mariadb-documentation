<!DOCTYPE html>
<html>
<head data-cookie-domain=""
      data-cookie-path="/">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="apple-touch-icon" sizes="180x180" href="/kb/static/images/favicons/apple-touch-icon.159e713979be.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/kb/static/images/favicons/favicon-32x32.bc0ac1d5d11e.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/kb/static/images/favicons/favicon-16x16.5801f8f0f34e.png">
    <link rel="shortcut icon" href="/kb/static/images/favicons/favicon.d122d305dee4.ico" type="image/x-icon" />

    <title>Progress Reporting - MariaDB Knowledge Base</title>

    <link href="/kb/static/css/main.f7633538c846.css" rel="stylesheet" type="text/css" />

    

    

    <!-- FB Open Graph tags -->
    <meta property="og:title" content="Progress Reporting" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://mariadb.com/kb/en/progress-reporting/" />
    <meta property="og:image" content="http://mariadb.comaskmonty-logo.png" />
    <meta property="og:site_name" content="MariaDB KnowledgeBase" />
    <meta property="fb:admins" content="514852603" />
    <meta property="og:description" content="Progress reporting for long running commands." />

    <meta name="description" content="Progress reporting for long running commands." />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet"/>
    
</head>
<body class="mpkb nodes products nodes_view jqui" id="nodes_view">





<div id="menu-mobile" class="visible-sm visible-xs">

    <div>
        <div id="mobile-close-menu" class="text-right">
            <a href="javascript:void(0)" title="Close Menu" id="back-main" class="toggle-menu">X<span></span></a>
        </div>
    </div>
    <div class="mainmenu-mobile">
        <ul class="ls-none ul-menu">
            <li data-sub="submenu5"><a class="open-form-search" href="/kb/search/" title="Search">Search </a></li>
            <li data-sub="submenu0"><a href="/products" title="Products">Products</a><span class="arrow-main"></span></li>
            <li data-sub="submenu1"><a href="/services" title="Services">Services</a><span class="arrow-main"></span></li>
            <li data-sub="submenu2"><a href="/resources" title="Resources">Resources</a><span class="arrow-main"></span></li>
            <li data-sub="submenu3"><a href="/about-us" title="About">About</a><span class="arrow-main"></span></li>
            <li data-sub="submenu4"><a href="/contact" title="Contact">Contact</a></li>
        </ul>
    </div>

    <div class="nav-top-mobile">
        <div class="select-box form">

            <ul class="inline-block-md mb-none top-nav">
                <li>

                </li>
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/progress-reporting/"> Login</a>
                    </li>
                
            </ul>



        </div>
        <p class="text-center copyright">Copyright &copy; 2024 MariaDB. All rights reserved.</p>
    </div>
</div>
<div class="violator-wrap d-none" id="top_violator">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12">
                <div class="violator-outer">
                    <div class="violator-inner">
                        <div class="row">
                            <div class="col-xs-12 col-sm-9 col-lg-7 col-lg-offset-2" id="top_violator_content">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="content-link" target="_blank" rel="nofollow noreferrer">
                                    <span>The Ultimate Guide to High Availability with MariaDB</span>
                                </a>
                            </div>
                            <div class="col-xs-12 col-sm-3" id="top_violator_cta">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="btn btn-mariadb" target="_blank" rel="nofollow noreferrer">Download Now</a>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-link close-btn">
                        <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24" width="15px" height="15px"><path d="M 4.9902344 3.9902344 A 1.0001 1.0001 0 0 0 4.2929688 5.7070312 L 10.585938 12 L 4.2929688 18.292969 A 1.0001 1.0001 0 1 0 5.7070312 19.707031 L 12 13.414062 L 18.292969 19.707031 A 1.0001 1.0001 0 1 0 19.707031 18.292969 L 13.414062 12 L 19.707031 5.7070312 A 1.0001 1.0001 0 0 0 18.980469 3.9902344 A 1.0001 1.0001 0 0 0 18.292969 4.2929688 L 12 10.585938 L 5.7070312 4.2929688 A 1.0001 1.0001 0 0 0 4.9902344 3.9902344 z"/></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="wrapper">
<div id="top-nav">
    <div class="container">
        <ul class="hidden-sm hidden-xs" >
            <li><a href="https://mariadb.com/kb/">Knowledge Base</a></li>
            <li><a href="https://mariadb.com/contact/">Contact</a></li>
            
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/progress-reporting/" rel="nofollow">Login</a>
                    </li>
                
            
            
            <li id="search-form">
                <form action="/kb/en/+search/" method="get" id="search-block-form" accept-charset="UTF-8">
                    <input id="search" title="Enter the terms you wish to search for."
                           placeholder="Search . . ." type="text"
                           name="q" value="" size="15" maxlength="128" class="form-text"
                           data-autocomplete-url="/kb/en/+search/autocomplete/">
                    <input type="hidden" name="quick" value="1" />
                    <input type="hidden" name="source" value="kb" />
                </form>
            </li>
            <li><a id="search-toggler" href="/kb/search/">Search</a></li>
            
        </ul>
    </div>
</div>
<div id="navbar-bottom" class="navbar">
    <div class="container">
        
        
        
        
        <div class="row">
            <div class="col-md-3 col-sm-9 col-xs-9">
                <a class="brand" href="/" title="MariaDB">
                    <img src="/kb/static/images/logo-2018-black.95f5978ae14d.png">
                </a>
            </div>
            <div class="col-md-9 hidden-sm hidden-xs">
                <div class="main-menu">
                    <ul id="main-menu" class="nav navbar-nav inline-block-sm">
    <li class="has-sub full-menu">
        <a href="/products" title="Products">Products</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/services" title="Services">Services</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/pricing" title="Pricing">Pricing</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/resources" title="Resources">Resources</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/about-us" title="About Us">About Us</a>
    </li>
    <li class="">
        <a class="button electric-eel small top-bar-right-download" href="/downloads/">Download</a>
    </li>
</ul>
                </div>
            </div>
            <div class="col-md-3 visible-sm visible-xs col-sm-3 col-xs-3 ps-rv">
                <div class="navbar-header text-right pull-right">
                    <button type="button" class="menu-control toggle-menu" id="open-menu">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="main">
    <div class="container">
        

        <div id="subheader1" class="clearfix">
            <div class="pull-left">
                
                <div id="breadcrumbs" class="breadcrumb">
                    <a href="/kb/en/">Knowledge Base</a>
                    


    
    » <a class="crumb" href="/kb/en/training-tutorials/">Training &amp; Tutorials</a>
    

    
    » <a class="crumb" href="/kb/en/advanced-mariadb-articles/">Advanced MariaDB Articles</a>
    

    
    » <a class="crumb" href="/kb/en/development-articles/">Development Articles</a>
    

    
    » <a class="crumb" href="/kb/en/mariadb-internals-documentation/">MariaDB Internals Documentation</a>
    

    
    » <a class="crumb" href="/kb/en/using-mariadb-with-your-programs-api/">Using MariaDB with Your Programs (API)</a>
    


    » <a class="node_link crumb" href="/kb/en/progress-reporting/">Progress Reporting</a>


                </div>
                
            </div>
        </div>
    </div>
    <div class="container" id="container-main">
        <div class="row">
            
            
                
                <aside id="sidebar-first" class="sidebar col-md-2 hidden-xs hidden-sm hidden-print">
                    
                        
                        <ul id="category_menu" class="nav nav-pills nav-stacked">
                            <li><a href="/kb/en/">Home</a></li>
                            
                                
                                    <li><a href="/kb/en/+questions/">Open Questions</a></li>
                                
                                <li><a href="/kb/en/documentation/">MariaDB Server</a></li>
                                <li><a href="/kb/en/maxscale/">MariaDB MaxScale</a></li>
                                <li><a href="/kb/en/mariadb-columnstore/">MariaDB ColumnStore</a></li>
                                <li><a href="/kb/en/connectors/">Connectors</a></li>
                            

                        </ul>
                    

                    
<div>



<div class="well well-small box actions"><div>

        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/progress-reporting/+history" rel="nofollow">History</a>
        
        
        
        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/progress-reporting/+source/">Source</a>
        
        <a class="btn btn-block btn-blue btn-sm flag" href="/kb/en/progress-reporting/+flag"
                data-flag-url="/kb/en/progress-reporting/+flag" rel="nofollow">
                Flag as Spam / Inappropriate</a>
        
        <a class="btn btn-block btn-blue btn-sm" href="/kb/en/progress-reporting/+translate/">
                Translate</a>
        

</div>
</div>





<div class="well well-small box node_info"><div>

    <dl>
        <dt>Created</dt>
        <dd>

<span class="datetime" title="2011-06-30 09:54">13 years, 6 months ago</span></dd>

        <dt>Modified</dt>
        <dd>

<span class="datetime" title="2023-05-23 10:50">1 year, 7 months ago</span></dd>

        <dt>Type</dt>
        <dd>article</dd>

        <dt>Status</dt>
        <dd>active</dd>

        <dt>License</dt>
        <dd>
            
                <a href="/kb/en/progress-reporting/+license/">CC BY-SA / Gnu FDL</a>
            
        </dd>

        
    </dl>

    
    <ul class="rss_feeds">
        <li><a href="/kb/en/progress-reporting/+history/feed/">
            History</a>
        </li>
        <li><a href="/kb/en/progress-reporting/+comments/feed/">
            Comments</a>
        </li>
    </ul>
    

</div>
</div>





    
    
    

<div class="well well-small box attachments"><div><div class="edit_link pull-right"><a href="/kb/en/progress-reporting/+edit/attachments/">Edit</a></div><h5>Attachments</h5></div><div>

        
            <div class="no_data">No attachments exist</div>
        
    
</div>
</div>

    



    
    






</div>


                    

































                </aside>
            
            
            
                
            
            
                
            
            <section id="content" class="limited_width col-md-8 clearfix">
                
                    <h1>Progress Reporting</h1>
                

                



                <div>
                    
    

    
    
    

    <div class="node creole">
        
        
        


    
    <div class="answer formatted">
        <div class="table_of_contents well well-small">
<h3>Contents</h3>
 <ol class="toc">

    <li class=""><a href="#what-is-progress-reporting" title="What is Progress Reporting?">What is Progress Reporting?</a></li>

    <li class=""><a href="#supported-commands" title="Supported Commands">Supported Commands</a>    <ol class="toc">

        <li class=""><a href="#limitations" title="Limitations">Limitations</a>    </ol>
</li>

    <li class=""><a href="#enabling-and-disabling-progress-reporting" title="Enabling and Disabling Progress Reporting">Enabling and Disabling Progress Reporting</a></li>

    <li class=""><a href="#clients-which-support-progress-reporting" title="Clients Which Support Progress Reporting">Clients Which Support Progress Reporting</a></li>

    <li class=""><a href="#progress-reporting-in-the-mysql-command-line-client" title="Progress Reporting in the mysql Command Line Client">Progress Reporting in the mysql Command Line Client</a></li>

    <li class=""><a href="#how-to-add-support-for-progress-reporting-to-a-client" title="How to Add Support for Progress Reporting to a Client">How to Add Support for Progress Reporting to a Client</a></li>

    <li class=""><a href="#how-to-add-support-for-progress-reporting-to-a-storage-engine" title="How to Add Support for Progress Reporting to a Storage Engine">How to Add Support for Progress Reporting to a Storage Engine</a></li>

    <li class=""><a href="#examples-to-look-at-in-the-mariadb-source" title="Examples to Look at in the MariaDB Source:">Examples to Look at in the MariaDB Source:</a></li>

    <li class=""><a href="#format-of-progress-packets" title="Format of Progress Packets">Format of Progress Packets</a></li>

    <li class=""><a href="#see-also" title="See Also">See Also</a> </ol>
</li>
</div><p>
MariaDB supports progress reporting for some long running commands.</p>
<h2 class="anchored_heading" id="what-is-progress-reporting">What is Progress Reporting?</h2>
<p>Progress reporting means that:</p>
<ul start="1"><li>There is a <code>Progress</code> column
  in <a href="/kb/en/show-processlist/">SHOW PROCESSLIST</a> which shows the total progress
  (0-100%)
</li><li><a href="/kb/en/information-schema-processlist-table/">INFORMATION_SCHEMA.PROCESSLIST</a> has three columns which allow you to see in which process stage we are and how much of that stage is completed:
<ul start="1"><li><code>STAGE</code>
</li><li><code>MAX_STAGE</code>
</li><li><code>PROGRESS</code> (within current stage).
</li></ul>
</li><li>The client receives progress messages which it can display to the user to
  indicate how long the command will take.
</li></ul>
<p>We have separate progress reporting for stages because different stages take
different amounts of time.</p>
<h2 class="anchored_heading" id="supported-commands">Supported Commands</h2>
<p>Currently, the following commands can send progress report messages to the
client:</p>
<ul start="1"><li><a href="/kb/en/alter-table/">ALTER TABLE</a>
</li><li><a href="/kb/en/create-index/">CREATE INDEX</a>
</li><li><a href="/kb/en/drop-index/">DROP INDEX</a>
</li><li><a href="/kb/en/load-data-infile/">LOAD DATA INFILE</a> (not <code>LOAD DATA LOCAL INFILE</code>, as in that case we
  don't know the size of the file).
</li></ul>
<p>Some Aria storage engine operations also support progress messages:</p>
<ul start="1"><li><a href="/kb/en/check-table/">CHECK TABLE</a>
</li><li><a href="/kb/en/repair-table/">REPAIR TABLE</a>
</li><li><a href="/kb/en/analyze-table/">ANALYZE TABLE</a>
</li><li><a href="/kb/en/optimize-table/">OPTIMIZE TABLE</a>
</li></ul>
<h3 class="anchored_heading" id="limitations">Limitations</h3>
<p>Although the above commands support progress reporting, there are some limitations to what progress is reported. To be specific, when executing one of these commands against an InnoDB table with <a href="/kb/en/innodb-online-ddl-operations-with-algorithminplace/">ALGORITHM=INPLACE</a> (which is the default in <a href="/kb/en/what-is-mariadb-100/">MariaDB 10.0</a>+), progress is only reported during the merge sort phase while reconstructing indexes.</p>
<h2 class="anchored_heading" id="enabling-and-disabling-progress-reporting">Enabling and Disabling Progress Reporting</h2>
<p><code>mysqld</code> (the MariaDB server) automatically sends progress report messages to clients that support the new protocol, using the value of the <a href="/kb/en/server-system-variables/#progress_report_time">progress_report_time</a> variable. They are sent every
max(<code>global.progress_report_time</code> , <code>progress_report_time</code>) seconds (by default 5). You can disable the sending of progress report messages to the client by setting either the local variable (affects only the current connection) or the global variable (affects all connections) to <code>0</code>.</p>
<p>If the extra column in <code>SHOW PROCESSLIST</code> gives you a compatibility problem,
you can disable it by starting <code>mysqld</code> with the <code class="fixed" style="white-space:pre-wrap">--old</code> flag.</p>
<h2 class="anchored_heading" id="clients-which-support-progress-reporting">Clients Which Support Progress Reporting</h2>
<ul start="1"><li>The <a href="/kb/en/mariadb-command-line-client/"><code>mariadb</code> command line client</a>
</li><li>The <code>mytop</code> that comes with MariaDB has a <code>'%'</code> column which shows
  the progress.
</li></ul>
<h2 class="anchored_heading" id="progress-reporting-in-the-mysql-command-line-client">Progress Reporting in the mysql Command Line Client</h2>
<p>Progress reporting is enabled by default in the <a href="/kb/en/mariadb-command-line-client/">mariadb client</a>. You can
disable it with <code class="fixed" style="white-space:pre-wrap">--disable-progress-reports</code>. It is automatically disabled in
batch mode.</p>
<p>When enabled, for every supported command you get a progress report like:</p>
<pre class="fixed">ALTER TABLE my_mail ENGINE=aria;
Stage: 1 of 2 'copy to tmp table'  5.37% of stage done
</pre><p>This is updated every <a href="/kb/en/server-system-variables/#progress_report_time">progress_report_time</a> seconds (the default is 5). If the global <code>progress_report_time</code> is higher, this will be used. You can also disable error reporting by setting the variable to <code>0</code>.</p>
<h2 class="anchored_heading" id="how-to-add-support-for-progress-reporting-to-a-client">How to Add Support for Progress Reporting to a Client</h2>
<p>You need to use the <a href="/kb/en/what-is-mariadb-53/">MariaDB 5.3</a> or later client library. You can check that the library
supports progress reporting by doing:</p>
<pre class="fixed"><span class="cp">#ifdef CLIENT_PROGRESS</span>
</pre><p>To enable progress reporting to the client you need to add
<code>CLIENT_PROGRESS</code> to the <code>connect_flag</code> in <code>mysql_real_connect()</code>:</p>
<pre class="fixed"><span class="n">mysql_real_connect</span><span class="p">(</span><span class="n">mysql</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span>
                   <span class="n">database</span><span class="p">,</span> <span class="n">opt_mysql_port</span><span class="p">,</span> <span class="n">opt_mysql_unix_port</span><span class="p">,</span>
                   <span class="n">connect_flag</span> <span class="o">|</span> <span class="n">CLIENT_PROGRESS</span><span class="p">);</span>
</pre><p>Then you need to provide a callback function for progress reports:</p>
<pre class="fixed"><span class="k">static</span> <span class="kt">void</span> <span class="nf">report_progress</span><span class="p">(</span><span class="k">const</span> <span class="n">MYSQL</span> <span class="o">*</span><span class="n">mysql</span><span class="p">,</span> <span class="n">uint</span> <span class="n">stage</span><span class="p">,</span> <span class="n">uint</span> <span class="n">max_stage</span><span class="p">,</span>
                            <span class="kt">double</span> <span class="n">progress</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">proc_info</span><span class="p">,</span>
                            <span class="n">uint</span> <span class="n">proc_info_length</span><span class="p">);</span>

<span class="n">mysql_options</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mysql</span><span class="p">,</span> <span class="n">MYSQL_PROGRESS_CALLBACK</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span> <span class="n">report_progress</span><span class="p">);</span>
</pre><p>The above <code>report_progress</code> function will be called for each
progress message.</p>
<p>This is the implementation used by <code>mysql.cc</code>:</p>
<pre class="fixed"><span class="n">uint</span> <span class="n">last_progress_report_length</span><span class="p">;</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">report_progress</span><span class="p">(</span><span class="k">const</span> <span class="n">MYSQL</span> <span class="o">*</span><span class="n">mysql</span><span class="p">,</span> <span class="n">uint</span> <span class="n">stage</span><span class="p">,</span> <span class="n">uint</span> <span class="n">max_stage</span><span class="p">,</span>
                            <span class="kt">double</span> <span class="n">progress</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">proc_info</span><span class="p">,</span>
                            <span class="n">uint</span> <span class="n">proc_info_length</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">uint</span> <span class="n">length</span><span class="o">=</span> <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Stage: %d of %d &#39;%.*s&#39; %6.3g%% of stage done&quot;</span><span class="p">,</span>
                      <span class="n">stage</span><span class="p">,</span> <span class="n">max_stage</span><span class="p">,</span> <span class="n">proc_info_length</span><span class="p">,</span> <span class="n">proc_info</span><span class="p">,</span> 
                      <span class="n">progress</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">length</span> <span class="o">&lt;</span> <span class="n">last_progress_report_length</span><span class="p">)</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%*s&quot;</span><span class="p">,</span> <span class="n">last_progress_report_length</span> <span class="o">-</span> <span class="n">length</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">);</span>
  <span class="n">putc</span><span class="p">(</span><span class="sc">&#39;\r&#39;</span><span class="p">,</span> <span class="n">stdout</span><span class="p">);</span>
  <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
  <span class="n">last_progress_report_length</span><span class="o">=</span> <span class="n">length</span><span class="p">;</span>
<span class="p">}</span>
</pre><p>If you want only one number for the total progress, you can calculate it with:</p>
<pre class="fixed"><span class="kt">double</span> <span class="n">total_progress</span><span class="o">=</span>
 <span class="p">((</span><span class="n">stage</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span> <span class="n">max_stage</span> <span class="o">*</span> <span class="mf">100.00</span> <span class="o">+</span> <span class="n">progress</span> <span class="o">/</span> <span class="n">max_stage</span><span class="p">);</span>
</pre><div class="cstm-style greenbox"><p><strong>Note:</strong> <code>proc_info</code> is totally independent of stage. You can have many
different <code>proc_info</code> values within a stage. The idea behind <code>proc_info</code> is
to give the user more information about what the server is doing.</p>
</div><h2 class="anchored_heading" id="how-to-add-support-for-progress-reporting-to-a-storage-engine">How to Add Support for Progress Reporting to a Storage Engine</h2>
<p>The functions to use for progress reporting are:</p>
<pre class="fixed"><span class="kt">void</span> <span class="nf">thd_progress_init</span><span class="p">(</span><span class="n">MYSQL_THD</span> <span class="n">thd</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">max_stage</span><span class="p">);</span>
</pre><p>Initialize progress reporting with stages. This is mainly used for
commands that are totally executed within the engine, like <code>CHECK TABLE</code>.
You should not use this for operations that could be called by, for example,
<code>ALTER TABLE</code> as this has already called the function.</p>
<p><code>max_stage</code> is the number of stages your storage engine will have.</p>
<pre class="fixed"><span class="kt">void</span> <span class="nf">thd_progress_report</span><span class="p">(</span><span class="n">MYSQL_THD</span> <span class="n">thd</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">progress</span><span class="p">,</span>
                         <span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">max_progress</span><span class="p">);</span>
</pre><p>The above is used for reporting progress.</p>
<ul start="1"><li><code>progress</code> is how much of the file/rows/keys you have gone through.
</li><li><code>max_progress</code> is the max number of rows you will go through.
</li></ul>
<p>You can call this with varying numbers, but normally the ratio
<code>progress/max_progress</code> should be increasing.</p>
<p>This function can be called even if you are not using stages, for example when
enabling keys as part of <code>ALTER TABLE</code> or <code>ADD INDEX</code>.</p>
<pre class="fixed"><span class="kt">void</span> <span class="nf">thd_progress_next_stage</span><span class="p">(</span><span class="n">MYSQL_THD</span> <span class="n">thd</span><span class="p">);</span>
</pre><p>To go to the next stage in a multi-stage process initiated by
<code>thd_progress_init()</code>:</p>
<pre class="fixed"><span class="kt">void</span> <span class="nf">thd_progress_end</span><span class="p">(</span><span class="n">MYSQL_THD</span> <span class="n">thd</span><span class="p">);</span>
</pre><p>End progress reporting;  Sets 'Progress' back to 0 in <code>SHOW PROCESSLIST</code>.</p>
<pre class="fixed"><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="nf">thd_proc_info</span><span class="p">(</span><span class="n">thd</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">stage</span> <span class="n">name</span><span class="err">&#39;</span><span class="p">);</span>
</pre><p>This sets the name of the current status/stage that is displayed in
<code>SHOW PROCESSLIST</code> and in the client. It's recommended that you call
this between stages and thus before <code>thd_progress_report()</code> and
<code>thd_progress_next_stage()</code>.</p>
<p>This functions returns the last used <code>proc_info</code>.  It's recommended that
you restore <code>proc_info</code> to its original value when you are done
processing.</p>
<div class="cstm-style greenbox"><p><strong>Note:</strong> <code>thd_proc_info()</code> is totally independent of stage. You can have
many different <code>proc_info</code> values within a stage to give the user more
information about what is going on.</p>
</div><h2 class="anchored_heading" id="examples-to-look-at-in-the-mariadb-source">Examples to Look at in the MariaDB Source:</h2>
<ul start="1"><li><code>client/mysql.cc</code> for an example of how to use reporting.
</li><li><code>libmysql/client.c:cli_safe_read()</code> to see how progress packets are handled
  in client
</li><li><code>sql/protocol.cc::net_send_progress_packet()</code> for how progress packets are
  handled in server.
</li></ul>
<h2 class="anchored_heading" id="format-of-progress-packets">Format of Progress Packets</h2>
<p>The progress packet is sent as an error packet with error number <code>65535</code>.</p>
<p>It contains the following data (in addition to the error header):</p>
<div class="cstm-style darkheader-nospace-borders"><table><tr><th>Option</th><th>Number of bytes</th><th>Other info</th></tr>
<tr><td>1</td><td>1</td><td>Number of strings. For future</td></tr>
<tr><td>Stage</td><td>1</td><td>Stage from 1 - Max_stage</td></tr>
<tr><td>Max_stage</td><td>1</td><td>Max number of stages</td></tr>
<tr><td>Progress</td><td>3</td><td>Progress in <code>% * 1000</code></td></tr>
<tr><td>Status_length</td><td>1-2</td><td>Packet length of string in <code>net_field_length()</code> format</td></tr>
<tr><td>Status</td><td>Status_length</td><td>Status / Stage name</td></tr>
</table>
</div><h2 class="anchored_heading" id="see-also">See Also</h2>
<ul start="1"><li><a href="/kb/en/what-is-mariadb-53/">What is MariaDB 5.3</a></li></ul>

    </div>


        
            <div id="subscribe" class="well well-small hide hidden-print"
                 data-subscribe-url="/kb/en/progress-reporting/+subscriptions/add"
                 data-unsubscribe-url="/kb/en/progress-reporting/+subscriptions/remove">
            </div>
        

        
        
    
        <div class="simple_section_nav">
            <ul class="nav nav-pills">
                
                    <li><a href="/kb/en/non-blocking-client-library/">
                        ← Non-Blocking Client Library
                    </a>
                    </li>
                
                
                    <li><a href="/kb/en/using-mariadb-with-your-programs-api/">
                        ↑ Using MariaDB with Your Programs (API) ↑
                    </a>
                    </li>
                
                
            </ul>
        </div>
    

        

        
        <h2>Comments</h2>
        
    
    <div id="comments" data-node-id="1669" data-comments-url="/kb/en/progress-reporting/+comments"
         data-reply-url="/kb/en/progress-reporting/comments/post/">
        Comments loading...
    </div>

        

    </div>


                    <div id="content_disclaimer" class="graybox">
                        Content reproduced on this site is the property of its respective owners,
                        and this content is not reviewed in advance by MariaDB. The views, information and opinions
                        expressed by this content do not necessarily represent those of MariaDB or any other party.
                    </div>
                </div>
            </section>

            
                <div id="right_bar" class="col-md-2">
                    
    
        
        <ul class="section_navigation well well-small hidden-xs hidden-sm">
            
                <li class="parent"><a href="/kb/en/using-mariadb-with-your-programs-api/">
                    ↑ Using MariaDB with Your Programs (API) ↑
                </a>
                </li>
            
            
                
                    <li>
                        <a href="/kb/en/error-codes/">
                            
                            Error Codes
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/libmariadb/">
                            
                            libMariaDB
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/libmysqld/">
                            
                            libmysqld
                        </a>
                    </li>
                
            
                
                    <li>
                        <a href="/kb/en/non-blocking-client-library/">
                            
                            Non-Blocking Client Library
                        </a>
                    </li>
                
            
                
                    <li class="active">
                        <span>Progress Reporting</span>
                        
                    </li>
                
            
        </ul>
    
    

                </div>
            
        </div>
    </div>
</div>

<!-- Footer -->
<footer id="footer">
    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-xs-12">
                    <ul class="list-inline text-center footer-nav">
                        <li>
                            <h5>
                                <a href="https://mariadb.com/products" title="Products">Products</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/services" title="Services">Services</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/pricing" title="Pricing">Pricing</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/resources" title="Resources">Resources</a>
                            </h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/about-us" title="About MariaDB">About Us</a></h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/download" title="Download">Download MariaDB</a></h5>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="row row-10">
                
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div id="block-footerformcontact" class="block block-block-content block-block-contentd754ee1b-3cc9-40e7-9ef4-f504f1197fb1">
                        
                            <h5 style="font-weight: 400;">Subscribe to our newsletter!</h5>
                            <script src="//app-sj15.marketo.com/js/forms2/js/forms2.min.js"></script><form id="mktoForm_1498"></form>
                            <script>
                                <!--//--><![CDATA[// ><!--
                                MktoForms2.loadForm("//app-sj15.marketo.com", "573-PXI-984", 1498);
                                //--><!]]]]><![CDATA[>
                                //--><!]]>
                            </script>
                        
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div class="footer-copyright">
                        <div class="text-center">
                            <ul class="list-inline no-margin">
                                <li>
                                    <a href="/legal" title="Legal">Legal</a>
                                </li>
                                <li>
                                    <a href="/privacy-policy" title="Privacy Policy">Privacy Policy</a>
                                </li>
                                <li>
                                    <a href="/cookie-policy/" title="Cookies">Cookie Policy</a>
                                </li>
                            </ul>
                            <p>Copyright &copy; 2024 MariaDB. All rights reserved.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</footer>
</div>

<div id="ajax_loading">
    <img src="/kb/static/images/ajax-loader.a51c5608d01a.gif" />
</div>

    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MK2847"
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MK2847');</script>
    <!-- End Google Tag Manager -->

</body>

<script type="text/javascript" src="/kb/static/js/main.1587e3a666fc.js" charset="utf-8"></script>

</html>