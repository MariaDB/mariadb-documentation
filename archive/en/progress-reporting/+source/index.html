<!DOCTYPE html>
<html>
<head data-cookie-domain=""
      data-cookie-path="/">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="apple-touch-icon" sizes="180x180" href="/kb/static/images/favicons/apple-touch-icon.159e713979be.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/kb/static/images/favicons/favicon-32x32.bc0ac1d5d11e.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/kb/static/images/favicons/favicon-16x16.5801f8f0f34e.png">
    <link rel="shortcut icon" href="/kb/static/images/favicons/favicon.d122d305dee4.ico" type="image/x-icon" />

    <title>Progress Reporting - Source - MariaDB Knowledge Base</title>

    <link href="/kb/static/css/main.f7633538c846.css" rel="stylesheet" type="text/css" />

    
        <meta name="robots" content="noindex, nofollow">
    

    

    <!-- FB Open Graph tags -->
    <meta property="og:title" content="Progress Reporting - Source" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://mariadb.com/kb/en/progress-reporting/+source/" />
    <meta property="og:image" content="http://mariadb.comaskmonty-logo.png" />
    <meta property="og:site_name" content="MariaDB KnowledgeBase" />
    <meta property="fb:admins" content="514852603" />
    <meta property="og:description" content="" />

    <meta name="description" content="" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet"/>
    
</head>
<body class="mpkb nodes autoresize nodes_source jqui" id="nodes_source">





<div id="menu-mobile" class="visible-sm visible-xs">

    <div>
        <div id="mobile-close-menu" class="text-right">
            <a href="javascript:void(0)" title="Close Menu" id="back-main" class="toggle-menu">X<span></span></a>
        </div>
    </div>
    <div class="mainmenu-mobile">
        <ul class="ls-none ul-menu">
            <li data-sub="submenu5"><a class="open-form-search" href="/kb/search/" title="Search">Search </a></li>
            <li data-sub="submenu0"><a href="/products" title="Products">Products</a><span class="arrow-main"></span></li>
            <li data-sub="submenu1"><a href="/services" title="Services">Services</a><span class="arrow-main"></span></li>
            <li data-sub="submenu2"><a href="/resources" title="Resources">Resources</a><span class="arrow-main"></span></li>
            <li data-sub="submenu3"><a href="/about-us" title="About">About</a><span class="arrow-main"></span></li>
            <li data-sub="submenu4"><a href="/contact" title="Contact">Contact</a></li>
        </ul>
    </div>

    <div class="nav-top-mobile">
        <div class="select-box form">

            <ul class="inline-block-md mb-none top-nav">
                <li>

                </li>
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/progress-reporting/+source/"> Login</a>
                    </li>
                
            </ul>



        </div>
        <p class="text-center copyright">Copyright &copy; 2024 MariaDB. All rights reserved.</p>
    </div>
</div>
<div class="violator-wrap d-none" id="top_violator">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12">
                <div class="violator-outer">
                    <div class="violator-inner">
                        <div class="row">
                            <div class="col-xs-12 col-sm-9 col-lg-7 col-lg-offset-2" id="top_violator_content">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="content-link" target="_blank" rel="nofollow noreferrer">
                                    <span>The Ultimate Guide to High Availability with MariaDB</span>
                                </a>
                            </div>
                            <div class="col-xs-12 col-sm-3" id="top_violator_cta">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="btn btn-mariadb" target="_blank" rel="nofollow noreferrer">Download Now</a>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-link close-btn">
                        <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24" width="15px" height="15px"><path d="M 4.9902344 3.9902344 A 1.0001 1.0001 0 0 0 4.2929688 5.7070312 L 10.585938 12 L 4.2929688 18.292969 A 1.0001 1.0001 0 1 0 5.7070312 19.707031 L 12 13.414062 L 18.292969 19.707031 A 1.0001 1.0001 0 1 0 19.707031 18.292969 L 13.414062 12 L 19.707031 5.7070312 A 1.0001 1.0001 0 0 0 18.980469 3.9902344 A 1.0001 1.0001 0 0 0 18.292969 4.2929688 L 12 10.585938 L 5.7070312 4.2929688 A 1.0001 1.0001 0 0 0 4.9902344 3.9902344 z"/></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="wrapper">
<div id="top-nav">
    <div class="container">
        <ul class="hidden-sm hidden-xs" >
            <li><a href="https://mariadb.com/kb/">Knowledge Base</a></li>
            <li><a href="https://mariadb.com/contact/">Contact</a></li>
            
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/progress-reporting/+source/" rel="nofollow">Login</a>
                    </li>
                
            
            
            <li id="search-form">
                <form action="/kb/en/+search/" method="get" id="search-block-form" accept-charset="UTF-8">
                    <input id="search" title="Enter the terms you wish to search for."
                           placeholder="Search . . ." type="text"
                           name="q" value="" size="15" maxlength="128" class="form-text"
                           data-autocomplete-url="/kb/en/+search/autocomplete/">
                    <input type="hidden" name="quick" value="1" />
                    <input type="hidden" name="source" value="kb" />
                </form>
            </li>
            <li><a id="search-toggler" href="/kb/search/">Search</a></li>
            
        </ul>
    </div>
</div>
<div id="navbar-bottom" class="navbar">
    <div class="container">
        
        
        
        
        <div class="row">
            <div class="col-md-3 col-sm-9 col-xs-9">
                <a class="brand" href="/" title="MariaDB">
                    <img src="/kb/static/images/logo-2018-black.95f5978ae14d.png">
                </a>
            </div>
            <div class="col-md-9 hidden-sm hidden-xs">
                <div class="main-menu">
                    <ul id="main-menu" class="nav navbar-nav inline-block-sm">
    <li class="has-sub full-menu">
        <a href="/products" title="Products">Products</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/services" title="Services">Services</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/pricing" title="Pricing">Pricing</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/resources" title="Resources">Resources</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/about-us" title="About Us">About Us</a>
    </li>
    <li class="">
        <a class="button electric-eel small top-bar-right-download" href="/downloads/">Download</a>
    </li>
</ul>
                </div>
            </div>
            <div class="col-md-3 visible-sm visible-xs col-sm-3 col-xs-3 ps-rv">
                <div class="navbar-header text-right pull-right">
                    <button type="button" class="menu-control toggle-menu" id="open-menu">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="main">
    <div class="container">
        

        <div id="subheader1" class="clearfix">
            <div class="pull-left">
                
                <div id="breadcrumbs" class="breadcrumb">
                    <a href="/kb/en/">Knowledge Base</a>
                    


    
    » <a class="crumb" href="/kb/en/training-tutorials/">Training &amp; Tutorials</a>
    

    
    » <a class="crumb" href="/kb/en/advanced-mariadb-articles/">Advanced MariaDB Articles</a>
    

    
    » <a class="crumb" href="/kb/en/development-articles/">Development Articles</a>
    

    
    » <a class="crumb" href="/kb/en/mariadb-internals-documentation/">MariaDB Internals Documentation</a>
    

    
    » <a class="crumb" href="/kb/en/using-mariadb-with-your-programs-api/">Using MariaDB with Your Programs (API)</a>
    


    » <a class="node_link crumb" href="/kb/en/progress-reporting/">Progress Reporting</a>


                </div>
                
            </div>
        </div>
    </div>
    <div class="container" id="container-main">
        <div class="row">
            
            
                
                <aside id="sidebar-first" class="sidebar col-md-2 hidden-xs hidden-sm hidden-print">
                    
                        
                        <ul id="category_menu" class="nav nav-pills nav-stacked">
                            <li><a href="/kb/en/">Home</a></li>
                            
                                
                                    <li><a href="/kb/en/+questions/">Open Questions</a></li>
                                
                                <li><a href="/kb/en/documentation/">MariaDB Server</a></li>
                                <li><a href="/kb/en/maxscale/">MariaDB MaxScale</a></li>
                                <li><a href="/kb/en/mariadb-columnstore/">MariaDB ColumnStore</a></li>
                                <li><a href="/kb/en/connectors/">Connectors</a></li>
                            

                        </ul>
                    

                    
                        <div>
    

<div class="well well-small box actions"><div>

        <a class="btn btn-block btn-small" href="/kb/en/progress-reporting/">Return to article</a>
    
</div>
</div>

</div>
                    

                    

































                </aside>
            
            
            
                
            
            
            <section id="content" class="limited_width col-md-10 clearfix">
                
                    <h1>Progress Reporting - Source</h1>
                

                



                <div>
                    

    

    
    <div class="revision_info">
        <dl class="table">
            <dt>Revision</dt>
            <dd><a href="/kb/en/progress-reporting/+r/126060/">126060</a></dd>
            <dt>User</dt>
            <dd>
<span class="user" id="user-7">
<a href="/kb/user/id/7" title="Michael Widenius">Michael Widenius</a>
</span></dd>
            <dt>Date</dt>
            <dd>

<span class="datetime" title="2023-05-23 10:50">2023-05-23 10:50</span></dd>
        </dl>
    </div>
    


    

    
        
        <textarea id="answer_source" class="creole_source autogrow">&lt;&lt;toc&gt;&gt;
MariaDB supports progress reporting for some long running commands.

== What is Progress Reporting?

Progress reporting means that:

* There is a ##Progress## column
  in [[show-processlist|SHOW PROCESSLIST]] which shows the total progress
  (0-100%)
* [[information-schema-processlist-table|INFORMATION_SCHEMA.PROCESSLIST]] has three columns which allow you to see in which process stage we are and how much of that stage is completed:
** ##STAGE##
** ##MAX_STAGE##
** ##PROGRESS## (within current stage).
* The client receives progress messages which it can display to the user to
  indicate how long the command will take.

We have separate progress reporting for stages because different stages take
different amounts of time.

== Supported Commands

Currently, the following commands can send progress report messages to the
client:

* [[alter-table|ALTER TABLE]]
* [[create-index|CREATE INDEX]]
* [[drop-index|DROP INDEX]]
* [[load-data-infile|LOAD DATA INFILE]] (not ##LOAD DATA LOCAL INFILE##, as in that case we
  don&#39;t know the size of the file).

Some Aria storage engine operations also support progress messages:

* [[check-table|CHECK TABLE]]
* [[repair-table|REPAIR TABLE]]
* [[analyze-table|ANALYZE TABLE]]
* [[optimize-table|OPTIMIZE TABLE]]

=== Limitations

Although the above commands support progress reporting, there are some limitations to what progress is reported. To be specific, when executing one of these commands against an InnoDB table with [[innodb-online-ddl-operations-with-algorithminplace|ALGORITHM=INPLACE]] (which is the default in MariaDB 10.0+), progress is only reported during the merge sort phase while reconstructing indexes.

== Enabling and Disabling Progress Reporting

##mysqld## (the MariaDB server) automatically sends progress report messages to clients that support the new protocol, using the value of the [[server-system-variables#progress_report_time|progress_report_time]] variable. They are sent every
max(##global.progress_report_time## , ##progress_report_time##) seconds (by default 5). You can disable the sending of progress report messages to the client by setting either the local variable (affects only the current connection) or the global variable (affects all connections) to ##0##.

If the extra column in ##SHOW PROCESSLIST## gives you a compatibility problem,
you can disable it by starting ##mysqld## with the &lt;&lt;code&gt;&gt;--old&lt;&lt;/code&gt;&gt; flag.

== Clients Which Support Progress Reporting

* The [[mariadb-command-line-client|##mariadb## command line client]]
* The ##mytop## that comes with MariaDB has a ##&#39;%&#39;## column which shows
  the progress.

== Progress Reporting in the mysql Command Line Client

Progress reporting is enabled by default in the [[mariadb-command-line-client|mariadb client]]. You can
disable it with &lt;&lt;code&gt;&gt;--disable-progress-reports&lt;&lt;/code&gt;&gt;. It is automatically disabled in
batch mode.

When enabled, for every supported command you get a progress report like:

&lt;&lt;code&gt;&gt;
ALTER TABLE my_mail ENGINE=aria;
Stage: 1 of 2 &#39;copy to tmp table&#39;  5.37% of stage done
&lt;&lt;/code&gt;&gt;

This is updated every [[server-system-variables#progress_report_time|progress_report_time]] seconds (the default is 5). If the global ##progress_report_time## is higher, this will be used. You can also disable error reporting by setting the variable to ##0##.

== How to Add Support for Progress Reporting to a Client

You need to use the MariaDB 5.3 or later client library. You can check that the library
supports progress reporting by doing:

&lt;&lt;code lang=c inline=false&gt;&gt;
#ifdef CLIENT_PROGRESS
&lt;&lt;/code&gt;&gt;

To enable progress reporting to the client you need to add
##CLIENT_PROGRESS## to the ##connect_flag## in ##mysql_real_connect()##:

&lt;&lt;code lang=c inline=false&gt;&gt;
mysql_real_connect(mysql, host, user, password,
                   database, opt_mysql_port, opt_mysql_unix_port,
                   connect_flag | CLIENT_PROGRESS);
&lt;&lt;/code&gt;&gt;

Then you need to provide a callback function for progress reports:

&lt;&lt;code lang=c inline=false&gt;&gt;
static void report_progress(const MYSQL *mysql, uint stage, uint max_stage,
                            double progress, const char *proc_info,
                            uint proc_info_length);

mysql_options(&amp;mysql, MYSQL_PROGRESS_CALLBACK, (void*) report_progress);
&lt;&lt;/code&gt;&gt;

The above ##report_progress## function will be called for each
progress message.

This is the implementation used by ##mysql.cc##:

&lt;&lt;code lang=c inline=false&gt;&gt;
uint last_progress_report_length;

static void report_progress(const MYSQL *mysql, uint stage, uint max_stage,
                            double progress, const char *proc_info,
                            uint proc_info_length)
{
  uint length= printf(&#34;Stage: %d of %d &#39;%.*s&#39; %6.3g%% of stage done&#34;,
                      stage, max_stage, proc_info_length, proc_info, 
                      progress);
  if (length &lt; last_progress_report_length)
    printf(&#34;%*s&#34;, last_progress_report_length - length, &#34;&#34;);
  putc(&#39;\r&#39;, stdout);
  fflush(stdout);
  last_progress_report_length= length;
}
&lt;&lt;/code&gt;&gt;

If you want only one number for the total progress, you can calculate it with:

&lt;&lt;code lang=c inline=false&gt;&gt;
double total_progress=
 ((stage -1) / (double) max_stage * 100.00 + progress / max_stage);
&lt;&lt;/code&gt;&gt;

&lt;&lt;style class=&#34;greenbox&#34;&gt;&gt;
**Note:** ##proc_info## is totally independent of stage. You can have many
different ##proc_info## values within a stage. The idea behind ##proc_info## is
to give the user more information about what the server is doing.
&lt;&lt;/style&gt;&gt;

== How to Add Support for Progress Reporting to a Storage Engine

The functions to use for progress reporting are:

&lt;&lt;code lang=c inline=false&gt;&gt;
void thd_progress_init(MYSQL_THD thd, unsigned int max_stage);
&lt;&lt;/code&gt;&gt;

Initialize progress reporting with stages. This is mainly used for
commands that are totally executed within the engine, like ##CHECK TABLE##.
You should not use this for operations that could be called by, for example,
##ALTER TABLE## as this has already called the function.

##max_stage## is the number of stages your storage engine will have.

&lt;&lt;code lang=c inline=false&gt;&gt;
void thd_progress_report(MYSQL_THD thd, unsigned long long progress,
                         unsigned long long max_progress);
&lt;&lt;/code&gt;&gt;

The above is used for reporting progress.

* ##progress## is how much of the file/rows/keys you have gone through.
* ##max_progress## is the max number of rows you will go through.

You can call this with varying numbers, but normally the ratio
##progress/max_progress## should be increasing.

This function can be called even if you are not using stages, for example when
enabling keys as part of ##ALTER TABLE## or ##ADD INDEX##.

&lt;&lt;code lang=c inline=false&gt;&gt;
void thd_progress_next_stage(MYSQL_THD thd);
&lt;&lt;/code&gt;&gt;

To go to the next stage in a multi-stage process initiated by
##thd_progress_init()##:

&lt;&lt;code lang=c inline=false&gt;&gt;
void thd_progress_end(MYSQL_THD thd);
&lt;&lt;/code&gt;&gt;

End progress reporting;  Sets &#39;Progress&#39; back to 0 in ##SHOW PROCESSLIST##.

&lt;&lt;code lang=c inline=false&gt;&gt;
const char *thd_proc_info(thd, &#39;stage name&#39;);
&lt;&lt;/code&gt;&gt;

This sets the name of the current status/stage that is displayed in
##SHOW PROCESSLIST## and in the client. It&#39;s recommended that you call
this between stages and thus before ##thd_progress_report()## and
##thd_progress_next_stage()##.

This functions returns the last used ##proc_info##.  It&#39;s recommended that
you restore ##proc_info## to its original value when you are done
processing.

&lt;&lt;style class=&#34;greenbox&#34;&gt;&gt;
**Note:** ##thd_proc_info()## is totally independent of stage. You can have
many different ##proc_info## values within a stage to give the user more
information about what is going on.
&lt;&lt;/style&gt;&gt;

== Examples to Look at in the MariaDB Source:

* ##client/mysql.cc## for an example of how to use reporting.
* ##libmysql/client.c:cli_safe_read()## to see how progress packets are handled
  in client
* ##sql/protocol.cc::net_send_progress_packet()## for how progress packets are
  handled in server.

== Format of Progress Packets

The progress packet is sent as an error packet with error number ##65535##.

It contains the following data (in addition to the error header):

&lt;&lt;style class=&#34;darkheader-nospace-borders&#34;&gt;&gt;
|= Option |= Number of bytes |= Other info
| 1 | 1 | Number of strings. For future |
| Stage | 1 | Stage from 1 - Max_stage |
| Max_stage | 1 | Max number of stages |
| Progress | 3 | Progress in ##% * 1000## |
| Status_length | 1-2 | Packet length of string in ##net_field_length()## format |
| Status | Status_length | Status / Stage name|
&lt;&lt;/style&gt;&gt;

== See Also

* [[what-is-mariadb-53|What is MariaDB 5.3]]</textarea>
    


                    <div id="content_disclaimer" class="graybox">
                        Content reproduced on this site is the property of its respective owners,
                        and this content is not reviewed in advance by MariaDB. The views, information and opinions
                        expressed by this content do not necessarily represent those of MariaDB or any other party.
                    </div>
                </div>
            </section>

            
        </div>
    </div>
</div>

<!-- Footer -->
<footer id="footer">
    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-xs-12">
                    <ul class="list-inline text-center footer-nav">
                        <li>
                            <h5>
                                <a href="https://mariadb.com/products" title="Products">Products</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/services" title="Services">Services</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/pricing" title="Pricing">Pricing</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/resources" title="Resources">Resources</a>
                            </h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/about-us" title="About MariaDB">About Us</a></h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/download" title="Download">Download MariaDB</a></h5>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="row row-10">
                
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div id="block-footerformcontact" class="block block-block-content block-block-contentd754ee1b-3cc9-40e7-9ef4-f504f1197fb1">
                        
                            <h5 style="font-weight: 400;">Subscribe to our newsletter!</h5>
                            <script src="//app-sj15.marketo.com/js/forms2/js/forms2.min.js"></script><form id="mktoForm_1498"></form>
                            <script>
                                <!--//--><![CDATA[// ><!--
                                MktoForms2.loadForm("//app-sj15.marketo.com", "573-PXI-984", 1498);
                                //--><!]]]]><![CDATA[>
                                //--><!]]>
                            </script>
                        
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div class="footer-copyright">
                        <div class="text-center">
                            <ul class="list-inline no-margin">
                                <li>
                                    <a href="/legal" title="Legal">Legal</a>
                                </li>
                                <li>
                                    <a href="/privacy-policy" title="Privacy Policy">Privacy Policy</a>
                                </li>
                                <li>
                                    <a href="/cookie-policy/" title="Cookies">Cookie Policy</a>
                                </li>
                            </ul>
                            <p>Copyright &copy; 2024 MariaDB. All rights reserved.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</footer>
</div>

<div id="ajax_loading">
    <img src="/kb/static/images/ajax-loader.a51c5608d01a.gif" />
</div>

    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MK2847"
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MK2847');</script>
    <!-- End Google Tag Manager -->

</body>

<script type="text/javascript" src="/kb/static/js/main.1587e3a666fc.js" charset="utf-8"></script>

</html>