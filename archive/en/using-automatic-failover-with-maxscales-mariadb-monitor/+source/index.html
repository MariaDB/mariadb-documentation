<!DOCTYPE html>
<html>
<head data-cookie-domain=""
      data-cookie-path="/">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="apple-touch-icon" sizes="180x180" href="/kb/static/images/favicons/apple-touch-icon.159e713979be.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/kb/static/images/favicons/favicon-32x32.bc0ac1d5d11e.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/kb/static/images/favicons/favicon-16x16.5801f8f0f34e.png">
    <link rel="shortcut icon" href="/kb/static/images/favicons/favicon.d122d305dee4.ico" type="image/x-icon" />

    <title>Using Automatic Failover with MaxScale&#39;s MariaDB Monitor - Source - MariaDB Knowledge Base</title>

    <link href="/kb/static/css/main.f7633538c846.css" rel="stylesheet" type="text/css" />

    
        <meta name="robots" content="noindex, nofollow">
    

    

    <!-- FB Open Graph tags -->
    <meta property="og:title" content="Using Automatic Failover with MaxScale&amp;#39;s MariaDB Monitor - Source" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://mariadb.com/kb/en/using-automatic-failover-with-maxscales-mariadb-monitor/+source/" />
    <meta property="og:image" content="http://mariadb.comaskmonty-logo.png" />
    <meta property="og:site_name" content="MariaDB KnowledgeBase" />
    <meta property="fb:admins" content="514852603" />
    <meta property="og:description" content="" />

    <meta name="description" content="" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="//fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet"/>
    
</head>
<body class="mpkb nodes autoresize nodes_source jqui" id="nodes_source">





<div id="menu-mobile" class="visible-sm visible-xs">

    <div>
        <div id="mobile-close-menu" class="text-right">
            <a href="javascript:void(0)" title="Close Menu" id="back-main" class="toggle-menu">X<span></span></a>
        </div>
    </div>
    <div class="mainmenu-mobile">
        <ul class="ls-none ul-menu">
            <li data-sub="submenu5"><a class="open-form-search" href="/kb/search/" title="Search">Search </a></li>
            <li data-sub="submenu0"><a href="/products" title="Products">Products</a><span class="arrow-main"></span></li>
            <li data-sub="submenu1"><a href="/services" title="Services">Services</a><span class="arrow-main"></span></li>
            <li data-sub="submenu2"><a href="/resources" title="Resources">Resources</a><span class="arrow-main"></span></li>
            <li data-sub="submenu3"><a href="/about-us" title="About">About</a><span class="arrow-main"></span></li>
            <li data-sub="submenu4"><a href="/contact" title="Contact">Contact</a></li>
        </ul>
    </div>

    <div class="nav-top-mobile">
        <div class="select-box form">

            <ul class="inline-block-md mb-none top-nav">
                <li>

                </li>
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/using-automatic-failover-with-maxscales-mariadb-monitor/+source/"> Login</a>
                    </li>
                
            </ul>



        </div>
        <p class="text-center copyright">Copyright &copy; 2025 MariaDB. All rights reserved.</p>
    </div>
</div>
<div class="violator-wrap d-none" id="top_violator">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12">
                <div class="violator-outer">
                    <div class="violator-inner">
                        <div class="row">
                            <div class="col-xs-12 col-sm-9 col-lg-7 col-lg-offset-2" id="top_violator_content">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="content-link" target="_blank" rel="nofollow noreferrer">
                                    <span>The Ultimate Guide to High Availability with MariaDB</span>
                                </a>
                            </div>
                            <div class="col-xs-12 col-sm-3" id="top_violator_cta">
                                <a href="https://go.mariadb.com/high-availability-guide-MariaDB-whitepaper.html" class="btn btn-mariadb" target="_blank" rel="nofollow noreferrer">Download Now</a>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-link close-btn">
                        <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 24 24" width="15px" height="15px"><path d="M 4.9902344 3.9902344 A 1.0001 1.0001 0 0 0 4.2929688 5.7070312 L 10.585938 12 L 4.2929688 18.292969 A 1.0001 1.0001 0 1 0 5.7070312 19.707031 L 12 13.414062 L 18.292969 19.707031 A 1.0001 1.0001 0 1 0 19.707031 18.292969 L 13.414062 12 L 19.707031 5.7070312 A 1.0001 1.0001 0 0 0 18.980469 3.9902344 A 1.0001 1.0001 0 0 0 18.292969 4.2929688 L 12 10.585938 L 5.7070312 4.2929688 A 1.0001 1.0001 0 0 0 4.9902344 3.9902344 z"/></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="wrapper">
<div id="top-nav">
    <div class="container">
        <ul class="hidden-sm hidden-xs" >
            <li><a href="https://mariadb.com/kb/">Knowledge Base</a></li>
            <li><a href="https://mariadb.com/contact/">Contact</a></li>
            
                
                    <li>
                        <a href="/kb/user/login?next=/kb/en/using-automatic-failover-with-maxscales-mariadb-monitor/+source/" rel="nofollow">Login</a>
                    </li>
                
            
            
            <li id="search-form">
                <form action="/kb/en/+search/" method="get" id="search-block-form" accept-charset="UTF-8">
                    <input id="search" title="Enter the terms you wish to search for."
                           placeholder="Search . . ." type="text"
                           name="q" value="" size="15" maxlength="128" class="form-text"
                           data-autocomplete-url="/kb/en/+search/autocomplete/">
                    <input type="hidden" name="quick" value="1" />
                    <input type="hidden" name="source" value="kb" />
                </form>
            </li>
            <li><a id="search-toggler" href="/kb/search/">Search</a></li>
            
        </ul>
    </div>
</div>
<div id="navbar-bottom" class="navbar">
    <div class="container">
        
        
        
        
        <div class="row">
            <div class="col-md-3 col-sm-9 col-xs-9">
                <a class="brand" href="/" title="MariaDB">
                    <img src="/kb/static/images/logo-2018-black.95f5978ae14d.png">
                </a>
            </div>
            <div class="col-md-9 hidden-sm hidden-xs">
                <div class="main-menu">
                    <ul id="main-menu" class="nav navbar-nav inline-block-sm">
    <li class="has-sub full-menu">
        <a href="/products" title="Products">Products</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/solutions" title="Solutions">Solutions</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/resources" title="Resources">Resources</a>
    </li>
    <li class="has-sub full-menu">
        <a href="/about-us" title="Company">Company</a>
    </li>
    <li class="has-sub full-menu active">
        <a href="/pricing" title="Pricing">Pricing</a>
    </li>
    
    <li class="">
        <a class="button electric-eel small top-bar-right-download" href="/downloads/">Download</a>
    </li>
</ul>
                </div>
            </div>
            <div class="col-md-3 visible-sm visible-xs col-sm-3 col-xs-3 ps-rv">
                <div class="navbar-header text-right pull-right">
                    <button type="button" class="menu-control toggle-menu" id="open-menu">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="main">
    <div class="container">
        

        <div id="subheader1" class="clearfix">
            <div class="pull-left">
                
                <div id="breadcrumbs" class="breadcrumb">
                    <a href="/kb/en/">Knowledge Base</a>
                    


    
    » <a class="crumb" href="/kb/en/maxscale/">MariaDB MaxScale</a>
    

    
    » <a class="crumb" href="/kb/en/mariadb-maxscale-21-06/">MariaDB MaxScale 21.06</a>
    

    
    » <a class="crumb" href="/kb/en/mariadb-maxscale-2106-maxscale-21-06-monitors/">MaxScale 21.06 Monitors</a>
    

    
    » <a class="crumb" href="/kb/en/maxscale-mariadb-monitor-usage/">MaxScale MariaDB Monitor Usage</a>
    

    
    » <a class="crumb" href="/kb/en/maxscale-mariadb-monitor-usage-mariadb-monitor/">MariaDB Monitor</a>
    


    » <a class="node_link crumb" href="/kb/en/using-automatic-failover-with-maxscales-mariadb-monitor/">Using Automatic Failover with MaxScale&#39;s MariaDB Monitor</a>


                </div>
                
            </div>
        </div>
    </div>
    <div class="container" id="container-main">
        <div class="row">
            
            
                
                <aside id="sidebar-first" class="sidebar col-md-2 hidden-xs hidden-sm hidden-print">
                    
                        
                        <ul id="category_menu" class="nav nav-pills nav-stacked">
                            <li><a href="/kb/en/">Home</a></li>
                            
                                
                                    <li><a href="/kb/en/+questions/">Open Questions</a></li>
                                
                                <li><a href="/kb/en/documentation/">MariaDB Server</a></li>
                                <li><a href="/kb/en/maxscale/">MariaDB MaxScale</a></li>
                                <li><a href="/kb/en/mariadb-columnstore/">MariaDB ColumnStore</a></li>
                                <li><a href="/kb/en/connectors/">Connectors</a></li>
                            

                        </ul>
                    

                    
                        <div>
    

<div class="well well-small box actions"><div>

        <a class="btn btn-block btn-small" href="/kb/en/using-automatic-failover-with-maxscales-mariadb-monitor/">Return to article</a>
    
</div>
</div>

</div>
                    

                    

































                </aside>
            
            
            
                
            
            
            <section id="content" class="limited_width col-md-10 clearfix">
                
                    <h1>Using Automatic Failover with MaxScale&#39;s MariaDB Monitor - Source</h1>
                

                



                <div>
                    

    

    
    <div class="revision_info">
        <dl class="table">
            <dt>Revision</dt>
            <dd><a href="/kb/en/using-automatic-failover-with-maxscales-mariadb-monitor/+r/151061/">151061</a></dd>
            <dt>User</dt>
            <dd>
<span class="user" id="user-16293">
<a href="/kb/user/id/16293" title="Shwetha CM">Shwetha CM</a>
</span></dd>
            <dt>Date</dt>
            <dd>

<span class="datetime" title="2025-04-30 08:19">2025-04-30 08:19</span></dd>
        </dl>
    </div>
    


    

    
        
        <textarea id="answer_source" class="creole_source autogrow">&lt;&lt;toc&gt;&gt;

= Overview

MaxScale&#39;s [[mariadb-maxscale-2302-mariadb-monitor|MariaDB Monitor (mariadbmon)]] monitors [[standard-replication|MariaDB replication]] deployments.

When the primary server fails, MariaDB Monitor can promote a replica server to be the new primary server automatically.

= How MariaDB Monitor uses Cooperative Locks

When automatic failover is enabled for MariaDB Monitor, it does the following:

1. It selects the replica server with the latest GTID position to be the new primary server.

2. If the new primary server has unprocessed relay logs, then it cancels and restarts the failover process after a short wait.

3. It prepares the new primary server:

* It stops its replica threads by executing [[stop-replica|STOP REPLICA]] and [[reset-replica|RESET REPLICA]].
* It configures it to allow writes by setting [[server-system-variables/#read_only|read_only]] to OFF.
* If the handle_events parameter is true, then it enable events that were previously enabled on the old primary server.
* If the promotion_sql_file parameter is set, then the script referred to by the parameter is executed.
* If there is an external master, then it configures that replication by executing [[change-master-to|CHANGE MASTER TO]] and [[start-replica|START REPLICA]].

4. It redirects all replica servers to replicate to the new primary server:

* It stops its replica threads by executing [[stop-replica|STOP REPLICA]] and [[reset-replica|RESET REPLICA]].
* It configures that replication by executing [[change-master-to|CHANGE MASTER TO]] and [[start-replica|START REPLICA]].

5. It checks that all slaves are replicating properly by executing [[show-replica-status|SHOW REPLICA STATUS]].

= Configuring Automatic Failover

1. Configure automatic failover by configuring several parameter for the MariaDB Monitor in ##maxscale.cnf##.

&lt;&lt;style class=&#34;darkheader-nospace-borders left&#34;&gt;&gt;
|= Parameter |= Description |
| failcount  | • This parameter defines the number of monitoring checks that must pass before a primary server is considered to be down. \\ • The default value is 5. \\ • The total wait time can be calculated as: (##monitor_interval + backend_connect_timeout) * failcount## |
| auto_failover  | • When this parameter is enabled, the monitor will automatically failover to a new primary server if the primary server fails. \\ • When this parameter is disabled, the monitor will not automatic failover to a new primary server if the primary server fails, so failover must be performed manually. \\ • This parameter is disabled by default.|
| auto_rejoin  | • When this parameter is enabled, the monitor will attempt to automatically configure new replica servers to replicate from the primary server when they come online. \\ • When this parameter is disabled, the monitor will not attempt to automatically configure new replica servers to replicate from the primary server when they come online, so they must be configured manually. \\ • TThis parameter is disabled by default. |
| switchover_on_low_disk_space  | • When this parameter is enabled, the monitor will automatically switchover to a new primary server if the primary server is low on disk space. \\ • When this parameter is disabled, the monitor will automatically switchover to a new primary server if the primary server is low on disk space, so switchover must be performed manually. \\ • This parameter requires the ##disk_space_threshold## parameter to be set for the server or the monitor. \\ • This parameter requires the ##disk_space_check_interval## parameter to be set for the monitor. \\ • This parameter is disabled by default. | 
| enforce_simple_topology  | • When this parameter is enabled, the monitor assumes that the topology of the cluster only consists of a single primary server, which has multiple replica servers. \\ • When this parameter is disabled, the monitor does not make assumptions about the topology of the cluster. \\ • This parameter implicitly sets the ##assume_unique_hostnames, auto_failover, and auto_rejoin## parameters. |
| replication_user  | • This parameter is used by the monitor to set the ##MASTER_USER## option when executing the [[change-master-to|CHANGE MASTER TO]] statement. \\ • If this parameter is not set, then the monitor uses the monitor user. |
| replication_password  | • This parameter is used by the monitor to set the ##MASTER_PASSWORD## option when executing the [[change-master-to|CHANGE MASTER TO]] statement. \\ • If this parameter is not set, then the monitor uses the monitor user&#39;s password. |
| replication_master_ssl  | • This parameter is used by the monitor to set the ##MASTER_SSL## option when executing the [[change-master-to|CHANGE MASTER TO]] statement. \\ • If this parameter is not set, then the monitor does not enable TLS.t |
| failover_timeout  | • This parameter defines the maximum amount of time allowed to perform a failover. \\ • If failover times out, then a message is logged to the MaxScale log, and automatic failover is disabled. |
| switchover_timeout  | • This parameter defines the maximum amount of time allowed to perform a switchover. \\ • If switchover times out, then a message is logged to the MaxScale log, and automatic failover is disabled.|
| verify_master_failure  | • When this parameter is enabled, if the monitor detects that the primary server failed, it will execute [[show-replica-status|SHOW REPLICA STATUS]] to verify that the replica servers have also detected the failure. \\ • If a replica has received an event within ##master_failure_timeout## duration, the primary is not considered down when deciding whether to failover, even if the monitor cannot connect to the primary. |
| master_failure_timeout  | • This parameter defines the timeout for ##verify_master_failure##. \\ • The default value is 10 seconds. |
|servers_no_promotion |  • This parameter defines a comma-separated list of servers that should not be chosen to be primary server. |
|promotion_sql_file |  • This parameter defines an SQL script that should be executed on the new primary server during failover or switchover. |
|demotion_sql_file |  • This parameter defines an SQL script that should be executed on the old primary server during failover or switchover when it is demoted to be a replica server. \\ • The script is also executed when a server is automatically added to the cluster due to the auto_rejoin parameter. |
|handle_events |  • When this parameter is enabled, the monitor enables events on the new primary server that were previously enabled on the old primary server. \\ • The monitor also disables the events on the old primary server. |
&lt;&lt;/style&gt;&gt;

For example:

&lt;&lt;code&gt;&gt;
[repl-cluster]
type                     = monitor
module                   = mariadbmon
...
auto_failover            = true
auto_rejoin              = true
replication_user         = repl
replication_password     = passwd
replication_master_ssl   = true
&lt;&lt;/code&gt;&gt;

2. Restart the MaxScale instance.

&lt;&lt;code&gt;&gt;
$ sudo systemctl restart maxscale
&lt;&lt;/code&gt;&gt;</textarea>
    


                    <div id="content_disclaimer" class="graybox">
                        Content reproduced on this site is the property of its respective owners,
                        and this content is not reviewed in advance by MariaDB. The views, information and opinions
                        expressed by this content do not necessarily represent those of MariaDB or any other party.
                    </div>
                </div>
            </section>

            
        </div>
    </div>
</div>

<!-- Footer -->
<footer id="footer">
    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-xs-12">
                    <ul class="list-inline text-center footer-nav">
                        <li>
                            <h5>
                                <a href="https://mariadb.com/products" title="Products">Products</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/solutions" title="Solutions">Solutions</a>
                            </h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/resources" title="Resources">Resources</a>
                            </h5>
                        </li>
                        <li>
                            <h5><a href="https://mariadb.com/about-us" title="About MariaDB">Company</a></h5>
                        </li>
                        <li>
                            <h5>
                                <a href="https://mariadb.com/pricing" title="Pricing">Pricing</a>
                            </h5>
                        </li>
                        
                        
                        <li>
                            <h5><a href="https://mariadb.com/downloads" title="Download">Download MariaDB</a></h5>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="row row-10">
                
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div id="block-footerformcontact" class="block block-block-content block-block-contentd754ee1b-3cc9-40e7-9ef4-f504f1197fb1">
                        
                            <h5 style="font-weight: 400;">Subscribe to our newsletter!</h5>
                            <script src="//app-sj15.marketo.com/js/forms2/js/forms2.min.js"></script><form id="mktoForm_1498"></form>
                            <script>
                                <!--//--><![CDATA[// ><!--
                                MktoForms2.loadForm("//app-sj15.marketo.com", "573-PXI-984", 1498);
                                //--><!]]]]><![CDATA[>
                                //--><!]]>
                            </script>
                        
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 col-xs-12 item col-md-offset-4">
                    <div class="footer-copyright">
                        <div class="text-center">
                            <ul class="list-inline no-margin">
                                <li>
                                    <a href="/legal" title="Legal">Legal</a>
                                </li>
                                <li>
                                    <a href="/privacy-policy" title="Privacy Policy">Privacy Policy</a>
                                </li>
                                <li>
                                    <a href="/cookie-policy/" title="Cookies">Cookie Policy</a>
                                </li>
                            </ul>
                            <p>Copyright &copy; 2025 MariaDB. All rights reserved.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</footer>
</div>

<div id="ajax_loading">
    <img src="/kb/static/images/ajax-loader.a51c5608d01a.gif" />
</div>

    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MK2847"
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MK2847');</script>
    <!-- End Google Tag Manager -->

</body>

<script type="text/javascript" src="/kb/static/js/main.1587e3a666fc.js" charset="utf-8"></script>

</html>