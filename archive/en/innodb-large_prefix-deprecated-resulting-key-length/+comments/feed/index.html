<?xml version="1.0" encoding="utf-8"?>
<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title>MariaDB Knowledge Base Comments for: innodb large_prefix deprecated- resulting key length?</title><link>https://mariadb.com/kb/en/innodb-large_prefix-deprecated-resulting-key-length/+comments/feed/</link><description></description><atom:link href="https://mariadb.com/kb/en/innodb-large_prefix-deprecated-resulting-key-length/+comments/feed/" rel="self"></atom:link><language>en-us</language><lastBuildDate>Mon, 14 Apr 2025 12:36:58 +0000</lastBuildDate><item><title>Re: innodb large_prefix deprecated- resulting key length?</title><link>https://mariadb.com/kb/en/innodb-large_prefix-deprecated-resulting-key-length/+comments/3901</link><description>&lt;p&gt;The code was changed in &lt;a href="/kb/en/mariadb-10217-release-notes/"&gt;MariaDB 10.2.17&lt;/a&gt; and &lt;a href="/kb/en/mariadb-1039-release-notes/"&gt;MariaDB 10.3.9&lt;/a&gt; by a &lt;a href="https://github.com/MariaDB/server/commit/de469a2f297b02c169d43ac1f6a0a6f63a913a81"&gt;bug fix related to incorrectly defined length of the InnoDB persistent statistics tables&lt;/a&gt;. Another part of the bug  &lt;a href="https://jira.mariadb.org/browse/MDEV-14637"&gt;MDEV-14637&lt;/a&gt; was that the InnoDB &lt;code&gt;FOREIGN KEY&lt;/code&gt; metadata tables define the length of some columns inaccurately. In its internal data modification operations, InnoDB ignores the maximum length, and this could cause InnoDB to deadlock during a page split when a too small record size is predicted.&lt;/p&gt;
&lt;p&gt;Because of this bug, in the above mentioned fix we had to slightly relax the constraints so that the semi-internal InnoDB persistent statistics tables can be created with a sufficient size of the &lt;code&gt;table_name&lt;/code&gt; column even when the smallest &lt;code&gt;innodb_page_size=4k&lt;/code&gt; is being used. The function &lt;code&gt;ha_innobase::max_supported_key_length()&lt;/code&gt; was changed to return 1173 instead of 768 bytes for &lt;code&gt;innodb_page_size=4k&lt;/code&gt;. For &lt;code&gt;innodb_page_size=8k&lt;/code&gt; the limit is 1536, and for larger page sizes, 3500 bytes.&lt;/p&gt;
&lt;p&gt;The function &lt;code&gt;handler::max_supported_key_length()&lt;/code&gt; is inaccurate, because it is geared towards heap-organized storage engines, such as MyISAM and Aria. In InnoDB, the length of a secondary index record depends not only on the secondary index key columns but also the &lt;code&gt;PRIMARY KEY&lt;/code&gt; columns. So, this function is returning a conservative value for InnoDB, to leave some room for the &lt;code&gt;PRIMARY KEY&lt;/code&gt;. It would be better to let the storage engine calculate and validate the record size in each index.&lt;/p&gt;
&lt;p&gt;For the largest-size index records in InnoDB, define a &lt;code&gt;PRIMARY KEY&lt;/code&gt; with 16 columns and a secondary key with a selection of 16 columns that are not part of the primary key.&lt;/p&gt;
</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Marko Mäkelä</dc:creator><guid>https://mariadb.com/kb/en/innodb-large_prefix-deprecated-resulting-key-length/+comments/3901</guid></item></channel></rss>